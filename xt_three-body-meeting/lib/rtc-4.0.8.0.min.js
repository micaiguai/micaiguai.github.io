/*! rtc-4.0.8.0 2024-09-27 03:17:26 */
var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(e){for(var t,r,n,o=e.length,i=0,a="";i<o;){if(t=255&e.charCodeAt(i++),i==o){a=(a+=base64EncodeChars.charAt(t>>2))+base64EncodeChars.charAt((3&t)<<4)+"==";break}if(r=e.charCodeAt(i++),i==o){a=(a=(a+=base64EncodeChars.charAt(t>>2))+base64EncodeChars.charAt((3&t)<<4|(240&r)>>4))+base64EncodeChars.charAt((15&r)<<2)+"=";break}n=e.charCodeAt(i++),a=(a=(a=(a+=base64EncodeChars.charAt(t>>2))+base64EncodeChars.charAt((3&t)<<4|(240&r)>>4))+base64EncodeChars.charAt((15&r)<<2|(192&n)>>6))+base64EncodeChars.charAt(63&n)}return a}function base64decode(e){for(var t,r,n,o,i=e.length,a=0,s="";a<i;){for(;t=base64DecodeChars[255&e.charCodeAt(a++)],a<i&&-1==t;);if(-1==t)break;for(;r=base64DecodeChars[255&e.charCodeAt(a++)],a<i&&-1==r;);if(-1==r)break;s+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(a++)))return s}while(n=base64DecodeChars[n],a<i&&-1==n);if(-1==n)break;s+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(o=255&e.charCodeAt(a++)))return s}while(o=base64DecodeChars[o],a<i&&-1==o);if(-1==o)break;s+=String.fromCharCode((3&n)<<6|o)}return s}function utf16to8(e){for(var t,r="",n=e.length,o=0;o<n;o++)1<=(t=e.charCodeAt(o))&&t<=127?r+=e.charAt(o):r=2047<t?(r=(r+=String.fromCharCode(224|t>>12&15))+String.fromCharCode(128|t>>6&63))+String.fromCharCode(128|t>>0&63):(r+=String.fromCharCode(192|t>>6&31))+String.fromCharCode(128|t>>0&63);return r}function utf8to16(e){for(var t,r,n,o="",i=e.length,a=0;a<i;)switch((t=e.charCodeAt(a++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=e.charAt(a-1);break;case 12:case 13:r=e.charCodeAt(a++),o+=String.fromCharCode((31&t)<<6|63&r);break;case 14:r=e.charCodeAt(a++),n=e.charCodeAt(a++),o+=String.fromCharCode((15&t)<<12|(63&r)<<6|(63&n)<<0)}return o}function doit(){var e=document.f;e.output.value=base64encode(utf16to8(e.source.value)),e.decode.value=utf8to16(base64decode(e.output.value))}function SdpSerializer(e){for(var u={},o=[],t=!1,r=!1,n=!1,i=!1,a=e.split("\r\n"),s=0;s<a.length;s++){var d=a[s];t||0==d.indexOf("m=audio")?(t=!0,l("audio"),(d=a[s+1])&&0==d.indexOf("m=video")&&(i=t=!1)):r||0==d.indexOf("m=video")?(r=!0,l("video"),(d=a[s+1])&&0==d.indexOf("m=application")&&(i=r=!1)):n||0==d.indexOf("m=application")?(n=!0,l("data")):o.push(d)}function l(t){var e,r;if(u[t])d=="a=mid:"+t?((e=a[s-1])&&(u[t].direction=e.split("a=")[1],u[t].attributes.pop(1)),i=!0,u[t]["a=mid:"+t]={line:d,attributes:[]}):i?0==d.indexOf("a=crypto:")?u[t].crypto[d.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=d:0==d.indexOf("a=rtpmap:")?(r=d.split("a=rtpmap:")[1].split(" "),u[t].payload[r[0]]=r[1],function e(){(d=a[s+1])&&-1==d.indexOf("a=rtpmap:")&&-1==d.indexOf("m=")&&(-1!=d.indexOf("a=ssrc")&&u[t].ssrc.push(d),-1==d.indexOf("a=ssrc")&&(u[t].payload[r[0]]+="\r\n"+d),s++,e())}()):u[t]["a=mid:"+t].attributes.push(d):u[t].attributes.push(d);else if(u[t]={line:d,attributes:[],payload:{},ssrc:[],crypto:{}},-1!=d.indexOf("RTP/SAVPF"))for(var n=d.split("RTP/SAVPF ")[1].split(" "),o=0;o<n.length;o++)u[t].payload[n[o]]=""}function c(e){if(u[e]){for(var t=[],r="",n=0;n<u[e].ssrc.length;n++){var o=u[e].ssrc[n];""==r?r=o:r+="\r\n"+o,-1==o.indexOf("cname:")&&-1==o.indexOf("a=ssrc-group:")||t.push([]),0<t.length&&t[t.length-1].push(o)}u[e].ssrc=t,u[e].ssrcStr=r}}function p(e,t){if(u[t]){e+=u[t].line+"\r\n";for(var r=0;r<u[t].attributes.length;r++)e+=u[t].attributes[r]+"\r\n";u[t].direction&&(e+="a="+u[t].direction+"\r\n"),e+="a=mid:"+t+"\r\n";for(var n,r=0;r<u[t]["a=mid:"+t].attributes.length;r++)u[t]["a=mid:"+t].attributes[r]&&(e+=u[t]["a=mid:"+t].attributes[r]+"\r\n");for(n in u[t].crypto)e+=u[t].crypto[n]+"\r\n";if(-1!=u[t].line.indexOf("RTP/SAVPF"))for(var o=u[t].line.split("RTP/SAVPF ")[1].split(" "),i=0;i<o.length;i++){var a=o[i];a&&(e+="a=rtpmap:"+a+" "+u[t].payload[a]+"\r\n")}for(var s=0;s<u[t].ssrc.length;s++)for(var d=u[t].ssrc[s],l=0;l<d.length;l++)e+=d[l]+"\r\n"}return e}function h(r){return{mLine:r,payload:function(e){return u[this.mLine]&&u[this.mLine].payload[e]||log.error(e,"doesn'nt exits."),{payload:e,mLine:this.mLine,newLine:function(e){u[this.mLine].payload[this.payload]+="\r\n"+e},remove:function(){var e=this.payload,t=this.mLine;if(u[t]&&-1!=u[t].line.indexOf(e)&&(u[t].payload[e]&&delete u[t].payload[e],-1!=u[t].line.indexOf("RTP/SAVPF"))){for(var r=u[t].line.split("RTP/SAVPF ")[1].split(" "),n=0;n<r.length;n++)r[n]==e&&delete r[n];r=swap(r),u[t].line=u[t].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+r.join(" ")}},order:function(e){var t=this.payload,r=e,e=this.mLine;if(u[e]&&-1!=u[e].line.indexOf(t)&&-1!=u[e].line.indexOf("RTP/SAVPF")){for(var n=u[e].line.split("RTP/SAVPF ")[1].split(" "),o=[],i=0;i<n.length;i++)n[i]==t&&(o[r]=n[i],delete n[i]);for(i=0;i<n.length;i++)i<r&&(o[i]=n[i]),r<=i&&(o[i+1]=n[i]);o=swap(o),u[e].line=u[e].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+o.join(" ")}}}},remove:function(){var e=this.mLine;u[e]&&delete u[e];for(var t=0;t<o.length;t++)if(-1!=o[t].indexOf("a=group")){var r=o[t].split("a=group:BUNDLE ")[1].split(" ");o[t]="a=group:BUNDLE";for(var n=0;n<r.length;n++)r[n]!=e&&(o[t]+=" "+r[n])}},isRejected:function(){var e=u[this.mLine].line.split("m="+this.mLine)[1];return 0==parseInt(e)},crypto:function(e){var t=u[this.mLine].crypto[e];return{mLine:this.mLine,remove:function(){t&&delete u[this.mLine].crypto[e]},newLine:function(e){u[this.mLine].crypto[e.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=e}}},track:function(t){var e=u[r].ssrc[t];return{ssrc:e,set:function(e){u[this.mLine].ssrc[t]=e},mLine:this.mLine,remove:function(){e&&(delete u[r].ssrc[t],u[r].ssrc=swap(u[r].ssrc))}}}}}c("audio"),c("video"),c("data"),this.deserialize=function(){for(var e="",t=0;t<o.length;t++)e+=o[t]+"\r\n";return e=p(e,"audio"),e=p(e,"video"),e=p(e,"data")},this.audio=h("audio"),this.video=h("video"),this.data=h("data"),this._inner=u}function swap(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t}!function(e,t){"function"==typeof define&&define.amd?define([],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(this,function(){"use strict";function p(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}try{Object.defineProperty(p.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}p.isLong=function(e){return!0===(e&&e.__isLong__)};var o={},i={},r=(p.fromInt=function(e,t){var r,n;return t?0<=(e>>>=0)&&e<256&&(n=i[e])?n:(r=new p(e,(0|e)<0?-1:0,!0),0<=e&&e<256&&(i[e]=r),r):-128<=(e|=0)&&e<128&&(n=o[e])?n:(r=new p(e,e<0?-1:0,!1),-128<=e&&e<128&&(o[e]=r),r)},p.fromNumber=function(e,t){return t=!!t,isNaN(e)||!isFinite(e)?p.ZERO:!t&&e<=-a?p.MIN_VALUE:!t&&a<=e+1?p.MAX_VALUE:t&&n<=e?p.MAX_UNSIGNED_VALUE:e<0?p.fromNumber(-e,t).negate():new p(e%r|0,e/r|0,t)},p.fromBits=function(e,t,r){return new p(e,t,r)},p.fromString=function(e,t,r){if(0===e.length)throw Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return p.ZERO;if("number"==typeof t&&(r=t,t=!1),(r=r||10)<2||36<r)throw Error("radix out of range: "+r);var n;if(0<(n=e.indexOf("-")))throw Error('number format error: interior "-" character: '+e);if(0===n)return p.fromString(e.substring(1),t,r).negate();for(var o=p.fromNumber(Math.pow(r,8)),i=p.ZERO,a=0;a<e.length;a+=8){var s=Math.min(8,e.length-a),d=parseInt(e.substring(a,a+s),r);i=(s<8?(s=p.fromNumber(Math.pow(r,s)),i.multiply(s)):i=i.multiply(o)).add(p.fromNumber(d))}return i.unsigned=t,i},p.fromValue=function(e){return e instanceof p?e:"number"==typeof e?p.fromNumber(e):"string"==typeof e?p.fromString(e):new p(e.low,e.high,e.unsigned)},4294967296),n=r*r,a=n/2,h=p.fromInt(1<<24);return p.ZERO=p.fromInt(0),p.UZERO=p.fromInt(0,!0),p.ONE=p.fromInt(1),p.UONE=p.fromInt(1,!0),p.NEG_ONE=p.fromInt(-1),p.MAX_VALUE=p.fromBits(-1,2147483647,!1),p.MAX_UNSIGNED_VALUE=p.fromBits(-1,-1,!0),p.MIN_VALUE=p.fromBits(0,-2147483648,!1),p.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},p.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*r+(this.low>>>0):this.high*r+(this.low>>>0)},p.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix out of range: "+e);if(this.isZero())return"0";var t,r,n;if(this.isNegative())return this.equals(p.MIN_VALUE)?(t=p.fromNumber(e),n=(r=this.divide(t)).multiply(t).subtract(this),r.toString(e)+n.toInt().toString(e)):"-"+this.negate().toString(e);for(var o=p.fromNumber(Math.pow(e,6),this.unsigned),i=(n=this,"");;){var a=n.divide(o),s=(n.subtract(a.multiply(o)).toInt()>>>0).toString(e);if((n=a).isZero())return s+i;for(;s.length<6;)s="0"+s;i=""+s+i}},p.prototype.getHighBits=function(){return this.high},p.prototype.getHighBitsUnsigned=function(){return this.high>>>0},p.prototype.getLowBits=function(){return this.low},p.prototype.getLowBitsUnsigned=function(){return this.low>>>0},p.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(p.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},p.prototype.isZero=function(){return 0===this.high&&0===this.low},p.prototype.isNegative=function(){return!this.unsigned&&this.high<0},p.prototype.isPositive=function(){return this.unsigned||0<=this.high},p.prototype.isOdd=function(){return 1==(1&this.low)},p.prototype.isEven=function(){return 0==(1&this.low)},p.eq=p.prototype.equals=function(e){return p.isLong(e)||(e=p.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},p.neq=p.prototype.notEquals=function(e){return!this.equals(e)},p.prototype.lt=p.prototype.lessThan=function(e){return this.compare(e)<0},p.prototype.lte=p.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},p.prototype.gt=p.prototype.greaterThan=function(e){return 0<this.compare(e)},p.prototype.gte=p.prototype.greaterThanOrEqual=function(e){return 0<=this.compare(e)},p.prototype.compare=function(e){var t,r;return p.isLong(e)||(e=p.fromValue(e)),this.equals(e)?0:(t=this.isNegative(),r=e.isNegative(),t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1)},p.prototype.neg=p.prototype.negate=function(){return!this.unsigned&&this.equals(p.MIN_VALUE)?p.MIN_VALUE:this.not().add(p.ONE)},p.prototype.add=function(e){p.isLong(e)||(e=p.fromValue(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,a=65535&e.high,s=e.low>>>16,d=0,l=0,u=0,c=0;return l+=(u=u+((c+=o+(65535&e.low))>>>16)+(n+s))>>>16,p.fromBits((u&=65535)<<16|(c&=65535),((d+=(l+=r+a)>>>16)+(t+i)&65535)<<16|(l&=65535),this.unsigned)},p.prototype.sub=p.prototype.subtract=function(e){return p.isLong(e)||(e=p.fromValue(e)),this.add(e.negate())},p.prototype.mul=p.prototype.multiply=function(e){var t,r,n,o,i,a,s,d,l,u,c;return this.isZero()||(e=p.isLong(e)?e:p.fromValue(e)).isZero()?p.ZERO:this.equals(p.MIN_VALUE)?e.isOdd()?p.MIN_VALUE:p.ZERO:e.equals(p.MIN_VALUE)?this.isOdd()?p.MIN_VALUE:p.ZERO:this.isNegative()?e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate():e.isNegative()?this.multiply(e.negate()).negate():this.lessThan(h)&&e.lessThan(h)?p.fromNumber(this.toNumber()*e.toNumber(),this.unsigned):(t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,a=65535&e.high,s=e.low>>>16,c=(c=u=l=d=0)+((l=l+((u+=o*(e=65535&e.low))>>>16)+n*e)>>>16)+((l=(l&65535)+o*s)>>>16),p.fromBits((l&=65535)<<16|(u&=65535),(d=(d=(d+=(c+=r*e)>>>16)+((c=(c&65535)+n*s)>>>16)+((c=(c&65535)+o*a)>>>16))+(t*e+r*s+n*a+o*i)&65535)<<16|(c&=65535),this.unsigned))},p.prototype.div=p.prototype.divide=function(e){if((e=p.isLong(e)?e:p.fromValue(e)).isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?p.UZERO:p.ZERO;var t,r,n;if(this.equals(p.MIN_VALUE))return e.equals(p.ONE)||e.equals(p.NEG_ONE)?p.MIN_VALUE:e.equals(p.MIN_VALUE)?p.ONE:(n=this.shiftRight(1).divide(e).shiftLeft(1)).equals(p.ZERO)?e.isNegative()?p.ONE:p.NEG_ONE:(t=this.subtract(e.multiply(n)),n.add(t.divide(e)));if(e.equals(p.MIN_VALUE))return this.unsigned?p.UZERO:p.ZERO;if(this.isNegative())return e.isNegative()?this.negate().divide(e.negate()):this.negate().divide(e).negate();if(e.isNegative())return this.divide(e.negate()).negate();for(r=p.ZERO,t=this;t.greaterThanOrEqual(e);){n=Math.max(1,Math.floor(t.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),i=o<=48?1:Math.pow(2,o-48),a=p.fromNumber(n),s=a.multiply(e);s.isNegative()||s.greaterThan(t);)s=(a=p.fromNumber(n-=i,this.unsigned)).multiply(e);a.isZero()&&(a=p.ONE),r=r.add(a),t=t.subtract(s)}return r},p.prototype.mod=p.prototype.modulo=function(e){return p.isLong(e)||(e=p.fromValue(e)),this.subtract(this.divide(e).multiply(e))},p.prototype.not=function(){return p.fromBits(~this.low,~this.high,this.unsigned)},p.prototype.and=function(e){return p.isLong(e)||(e=p.fromValue(e)),p.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},p.prototype.or=function(e){return p.isLong(e)||(e=p.fromValue(e)),p.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},p.prototype.xor=function(e){return p.isLong(e)||(e=p.fromValue(e)),p.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},p.prototype.shl=p.prototype.shiftLeft=function(e){return p.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?p.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):p.fromBits(0,this.low<<e-32,this.unsigned)},p.prototype.shr=p.prototype.shiftRight=function(e){return p.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?p.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):p.fromBits(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},p.prototype.shru=p.prototype.shiftRightUnsigned=function(e){var t,r;return p.isLong(e)&&(e=e.toInt()),0===(e&=63)?this:(t=this.high,e<32?(r=this.low,p.fromBits(r>>>e|t<<32-e,t>>>e,this.unsigned)):p.fromBits(32===e?t:t>>>e-32,0,this.unsigned))},p.prototype.toSigned=function(){return this.unsigned?new p(this.low,this.high,!1):this},p.prototype.toUnsigned=function(){return this.unsigned?this:new p(this.low,this.high,!0)},p}),!function(e,t){"function"==typeof define&&define.amd?define(["long"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var e;try{e=require("long")}catch(e){}return t(e)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}(this,function(s){"use strict";function f(e,t,r){if(void 0===e&&(e=f.DEFAULT_CAPACITY),void 0===t&&(t=f.DEFAULT_ENDIAN),!(r=void 0===r?f.DEFAULT_NOASSERT:r)){if((e|=0)<0)throw RangeError("Illegal capacity");t=!!t,r=!!r}this.buffer=0===e?i:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=r}f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=s||null;var a=f.prototype;a.__isByteBuffer__;try{Object.defineProperty(a,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}try{var i=new ArrayBuffer(0)}catch(e){i=""}var r=String.fromCharCode;function d(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function l(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+r.apply(String,e);1024<e.length+arguments.length&&(t.push(r.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function n(e,t,r,n,o){var i,a,s=8*o-n-1,d=(1<<s)-1,l=d>>1,u=-7,c=r?o-1:0,p=r?-1:1,o=e[t+c];for(c+=p,i=o&(1<<-u)-1,o>>=-u,u+=s;0<u;i=256*i+e[t+c],c+=p,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=n;0<u;a=256*a+e[t+c],c+=p,u-=8);if(0===i)i=1-l;else{if(i===d)return a?NaN:1/0*(o?-1:1);a+=Math.pow(2,n),i-=l}return(o?-1:1)*a*Math.pow(2,i-n)}function o(e,t,r,n,o,i){var a,s,d=8*i-o-1,l=(1<<d)-1,u=l>>1,c=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,h=n?1:-1,i=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+u?c/n:c*Math.pow(2,1-u))*n&&(a++,n/=2),l<=a+u?(s=0,a=l):1<=a+u?(s=(t*n-1)*Math.pow(2,o),a+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,o),a=0));8<=o;e[r+p]=255&s,p+=h,s/=256,o-=8);for(a=a<<o|s,d+=o;0<d;e[r+p]=255&a,p+=h,a/=256,d-=8);e[r+p-h]|=128*i}f.accessor=function(){return Uint8Array},f.allocate=function(e,t,r){return new f(e,t,r)},f.concat=function(e,t,r,n){"boolean"!=typeof t&&"string"==typeof t||(n=r,r=t,t=void 0);for(var o,i=0,a=0,s=e.length;a<s;++a)f.isByteBuffer(e[a])||(e[a]=f.wrap(e[a],t)),0<(o=e[a].limit-e[a].offset)&&(i+=o);if(0===i)return new f(0,r,n);for(var d,l=new f(i,r,n),a=0;a<s;)(o=(d=e[a++]).limit-d.offset)<=0||(l.view.set(d.view.subarray(d.offset,d.limit),l.offset),l.offset+=o);return l.limit=l.offset,l.offset=0,l},f.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},f.type=function(){return ArrayBuffer},f.wrap=function(e,t,r,n){if("string"!=typeof t&&(n=r,r=t,t=void 0),"string"==typeof e)switch(t=void 0===t?"utf8":t){case"base64":return f.fromBase64(e,r);case"hex":return f.fromHex(e,r);case"binary":return f.fromBinary(e,r);case"utf8":return f.fromUTF8(e,r);case"debug":return f.fromDebug(e,r);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var o;if(f.isByteBuffer(e))(o=a.clone.call(e)).markedOffset=-1;else if(e instanceof Uint8Array)o=new f(0,r,n),0<e.length&&(o.buffer=e.buffer,o.offset=e.byteOffset,o.limit=e.byteOffset+e.byteLength,o.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)o=new f(0,r,n),0<e.byteLength&&(o.buffer=e,o.offset=0,o.limit=e.byteLength,o.view=0<e.byteLength?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(o=new f(e.length,r,n)).limit=e.length;for(var i=0;i<e.length;++i)o.view[i]=e[i]}return o},a.writeBitSet=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=t,o=e.length,i=o>>3,a=0;for(t+=this.writeVarint32(o,t);i--;)d=1&!!e[a++]|(1&!!e[a++])<<1|(1&!!e[a++])<<2|(1&!!e[a++])<<3|(1&!!e[a++])<<4|(1&!!e[a++])<<5|(1&!!e[a++])<<6|(1&!!e[a++])<<7,this.writeByte(d,t++);if(a<o){for(var s=0,d=0;a<o;)d|=(1&!!e[a++])<<s++;this.writeByte(d,t++)}return r?(this.offset=t,this):t-n},a.readBitSet=function(e){var t=void 0===e,r=(t&&(e=this.offset),this.readVarint32(e)),n=r.value,o=n>>3,i=0,a=[];for(e+=r.length;o--;)d=this.readByte(e++),a[i++]=!!(1&d),a[i++]=!!(2&d),a[i++]=!!(4&d),a[i++]=!!(8&d),a[i++]=!!(16&d),a[i++]=!!(32&d),a[i++]=!!(64&d),a[i++]=!!(128&d);if(i<n)for(var s=0,d=this.readByte(e++);i<n;)a[i++]=!!(d>>s++&1);return t&&(this.offset=e),a},a.readBytes=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}t=this.slice(t,t+e);return r&&(this.offset+=e),t},a.writeBytes=a.append,a.writeInt8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=1)&&this.resize((n*=2)>t?n:t),this.view[--t]=e,r&&(this.offset+=1),this},a.writeByte=a.writeInt8,a.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}e=this.view[e];return 128==(128&e)&&(e=-(255-e+1)),t&&(this.offset+=1),e},a.readByte=a.readInt8,a.writeUint8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=1)&&this.resize((n*=2)>t?n:t),this.view[--t]=e,r&&(this.offset+=1),this},a.writeUInt8=a.writeUint8,a.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}e=this.view[e];return t&&(this.offset+=1),e},a.readUInt8=a.readUint8,a.writeInt16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=2)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},a.writeShort=a.writeInt16,a.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),32768==(32768&r)&&(r=-(65535-r+1)),t&&(this.offset+=2),r},a.readShort=a.readInt16,a.writeUint16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=2)&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},a.writeUInt16=a.writeUint16,a.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),t&&(this.offset+=2),r},a.readUInt16=a.readUint16,a.writeInt32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=4)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},a.writeInt=a.writeInt32,a.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0,r=this.littleEndian?(r=this.view[e+2]<<16,(r=(r|=this.view[e+1]<<8)|this.view[e])+(this.view[e+3]<<24>>>0)):(r=this.view[e+1]<<16,(r=(r|=this.view[e+2]<<8)|this.view[e+3])+(this.view[e]<<24>>>0));return r|=0,t&&(this.offset+=4),r},a.readInt=a.readInt32,a.writeUint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=4)&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},a.writeUInt32=a.writeUint32,a.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0,r=this.littleEndian?(r=this.view[e+2]<<16,(r=(r|=this.view[e+1]<<8)|this.view[e])+(this.view[e+3]<<24>>>0)):(r=this.view[e+1]<<16,(r=(r|=this.view[e+2]<<8)|this.view[e+3])+(this.view[e]<<24>>>0));return t&&(this.offset+=4),r},a.readUInt32=a.readUint32,s&&(a.writeInt64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=s.fromNumber(e);else if("string"==typeof e)e=s.fromString(e);else if(!(e&&e instanceof s))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=s.fromNumber(e):"string"==typeof e&&(e=s.fromString(e));var n=this.buffer.byteLength,n=(n<(t+=8)&&this.resize((n*=2)>t?n:t),t-=8,e.low),e=e.high;return this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n,this.view[(t+=4)+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e,this.view[t+=4]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),r&&(this.offset+=8),this},a.writeLong=a.writeInt64,a.readInt64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0,e=(this.littleEndian?(r=this.view[e+2]<<16,r=(r=(r|=this.view[e+1]<<8)|this.view[e])+(this.view[e+3]<<24>>>0),n=this.view[(e+=4)+2]<<16,n=(n=(n|=this.view[e+1]<<8)|this.view[e])+(this.view[e+3]<<24>>>0)):(n=this.view[e+1]<<16,n=(n=(n|=this.view[e+2]<<8)|this.view[e+3])+(this.view[e]<<24>>>0),r=this.view[(e+=4)+1]<<16,r=(r=(r|=this.view[e+2]<<8)|this.view[e+3])+(this.view[e]<<24>>>0)),new s(r,n,!1));return t&&(this.offset+=8),e},a.readLong=a.readInt64,a.writeUint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=s.fromNumber(e);else if("string"==typeof e)e=s.fromString(e);else if(!(e&&e instanceof s))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=s.fromNumber(e):"string"==typeof e&&(e=s.fromString(e));var n=this.buffer.byteLength,n=(n<(t+=8)&&this.resize((n*=2)>t?n:t),t-=8,e.low),e=e.high;return this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n,this.view[(t+=4)+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e,this.view[t+=4]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),r&&(this.offset+=8),this},a.writeUInt64=a.writeUint64,a.readUint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0,e=(this.littleEndian?(r=this.view[e+2]<<16,r=(r=(r|=this.view[e+1]<<8)|this.view[e])+(this.view[e+3]<<24>>>0),n=this.view[(e+=4)+2]<<16,n=(n=(n|=this.view[e+1]<<8)|this.view[e])+(this.view[e+3]<<24>>>0)):(n=this.view[e+1]<<16,n=(n=(n|=this.view[e+2]<<8)|this.view[e+3])+(this.view[e]<<24>>>0),r=this.view[(e+=4)+1]<<16,r=(r=(r|=this.view[e+2]<<8)|this.view[e+3])+(this.view[e]<<24>>>0)),new s(r,n,!0));return t&&(this.offset+=8),e},a.readUInt64=a.readUint64),a.writeFloat32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=4)&&this.resize((n*=2)>t?n:t),o(this.view,e,t-=4,this.littleEndian,23,4),r&&(this.offset+=4),this},a.writeFloat=a.writeFloat32,a.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}e=n(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),e},a.readFloat=a.readFloat32,a.writeFloat64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=this.buffer.byteLength;return n<(t+=8)&&this.resize((n*=2)>t?n:t),o(this.view,e,t-=8,this.littleEndian,52,8),r&&(this.offset+=8),this},a.writeDouble=a.writeFloat64,a.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}e=n(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),e},a.readDouble=a.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},f.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},f.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},a.writeVarint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=f.calculateVarint32(e),o=this.buffer.byteLength;for(o<(t+=n)&&this.resize((o*=2)>t?o:t),t-=n,e>>>=0;128<=e;)this.view[t++]=127&e|128,e>>>=7;return this.view[t++]=e,r?(this.offset=t,this):n},a.writeVarint32ZigZag=function(e,t){return this.writeVarint32(f.zigZagEncode32(e),t)},a.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=0,o=0;do{if(!this.noAssert&&e>this.limit)throw(r=Error("Truncated")).truncated=!0,r}while(r=this.view[e++],n<5&&(o|=(127&r)<<7*n),++n,0!=(128&r));return o|=0,t?(this.offset=e,o):{value:o,length:n}},a.readVarint32ZigZag=function(e){e=this.readVarint32(e);return"object"==typeof e?e.value=f.zigZagDecode32(e.value):e=f.zigZagDecode32(e),e},s&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(e){"number"==typeof e?e=s.fromNumber(e):"string"==typeof e&&(e=s.fromString(e));var t=e.toInt()>>>0,r=e.shiftRightUnsigned(28).toInt()>>>0,e=e.shiftRightUnsigned(56).toInt()>>>0;return 0==e?0==r?t<16384?t<128?1:2:t<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:e<128?9:10},f.zigZagEncode64=function(e){return"number"==typeof e?e=s.fromNumber(e,!1):"string"==typeof e?e=s.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(e){return"number"==typeof e?e=s.fromNumber(e,!1):"string"==typeof e?e=s.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(s.ONE).toSigned().negate()).toSigned()},a.writeVarint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=s.fromNumber(e);else if("string"==typeof e)e=s.fromString(e);else if(!(e&&e instanceof s))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=s.fromNumber(e,!1):"string"==typeof e?e=s.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned());var n=f.calculateVarint64(e),o=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0,a=e.shiftRightUnsigned(56).toInt()>>>0,e=this.buffer.byteLength;switch(e<(t+=n)&&this.resize((e*=2)>t?e:t),t-=n,n){case 10:this.view[t+9]=a>>>7&1;case 9:this.view[t+8]=9!==n?128|a:127&a;case 8:this.view[t+7]=8!==n?i>>>21|128:i>>>21&127;case 7:this.view[t+6]=7!==n?i>>>14|128:i>>>14&127;case 6:this.view[t+5]=6!==n?i>>>7|128:i>>>7&127;case 5:this.view[t+4]=5!==n?128|i:127&i;case 4:this.view[t+3]=4!==n?o>>>21|128:o>>>21&127;case 3:this.view[t+2]=3!==n?o>>>14|128:o>>>14&127;case 2:this.view[t+1]=2!==n?o>>>7|128:o>>>7&127;case 1:this.view[t]=1!==n?128|o:127&o}return r?(this.offset+=n,this):n},a.writeVarint64ZigZag=function(e,t){return this.writeVarint64(f.zigZagEncode64(e),t)},a.readVarint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,n=0,o=0,i=0,n=127&(a=this.view[e++]);if(128&a&&(n|=(127&(a=this.view[e++]))<<7,128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[e++]))<<14,128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[e++]))<<21,128&a||this.noAssert&&void 0===a)&&(o=127&(a=this.view[e++]),128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<7,128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<14,128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<21,128&a||this.noAssert&&void 0===a)&&(i=127&(a=this.view[e++]),128&a||this.noAssert&&void 0===a)&&(i|=(127&(a=this.view[e++]))<<7,128&a||this.noAssert&&void 0===a))throw Error("Buffer overrun");var a=s.fromBits(n|o<<28,o>>>4|i<<24,!1);return t?(this.offset=e,a):{value:a,length:e-r}},a.readVarint64ZigZag=function(e){e=this.readVarint64(e);return e&&e.value instanceof s?e.value=f.zigZagDecode64(e.value):e=f.zigZagDecode64(e),e}),a.writeCString=function(e,t){var r=void 0===t;r&&(t=this.offset);var n,o=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(n=0;n<o;++n)if(0===e.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}o=p.calculateUTF16asUTF8(d(e))[1],t+=o+1;var i=this.buffer.byteLength;return i<t&&this.resize((i*=2)>t?i:t),t-=o+1,p.encodeUTF16toUTF8(d(e),function(e){this.view[t++]=e}.bind(this)),this.view[t++]=0,r?(this.offset=t,this):o},a.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=e,o=-1;return p.decodeUTF8toUTF16(function(){if(0===o)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(o=this.view[e++])?null:o}.bind(this),r=l(),!0),t?(this.offset=e,r()):{string:r(),length:e-n}},a.writeIString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=t,o=p.calculateUTF16asUTF8(d(e),this.noAssert)[1],i=(t+=4+o,this.buffer.byteLength);if(i<t&&this.resize((i*=2)>t?i:t),t-=4+o,this.littleEndian?(this.view[t+3]=o>>>24&255,this.view[t+2]=o>>>16&255,this.view[t+1]=o>>>8&255,this.view[t]=255&o):(this.view[t]=o>>>24&255,this.view[t+1]=o>>>16&255,this.view[t+2]=o>>>8&255,this.view[t+3]=255&o),t+=4,p.encodeUTF16toUTF8(d(e),function(e){this.view[t++]=e}.bind(this)),t!==n+4+o)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+o));return r?(this.offset=t,this):t-n},a.readIString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=e,n=this.readUint32(e),n=this.readUTF8String(n,f.METRICS_BYTES,e+=4);return e+=n.length,t?(this.offset=e,n.string):{string:n.string,length:e-r}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",a.writeUTF8String=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=t,o=p.calculateUTF16asUTF8(d(e))[1],i=(t+=o,this.buffer.byteLength);return i<t&&this.resize((i*=2)>t?i:t),t-=o,p.encodeUTF16toUTF8(d(e),function(e){this.view[t++]=e}.bind(this)),r?(this.offset=t,this):t-n},a.writeString=a.writeUTF8String,f.calculateUTF8Chars=function(e){return p.calculateUTF16asUTF8(d(e))[0]},f.calculateString=f.calculateUTF8Bytes=function(e){return p.calculateUTF16asUTF8(d(e))[1]},a.readUTF8String=function(e,t,r){"number"==typeof t&&(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),void 0===t&&(t=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,i=0,a=r;if(t===f.METRICS_CHARS){if(o=l(),p.decodeUTF8(function(){return i<e&&r<this.limit?this.view[r++]:null}.bind(this),function(e){++i,p.UTF8toUTF16(e,o)}),i!==e)throw RangeError("Illegal range: Truncated data, "+i+" == "+e)}else{if(t!==f.METRICS_BYTES)throw TypeError("Unsupported metrics: "+t);if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}var s=r+e;if(p.decodeUTF8toUTF16(function(){return r<s?this.view[r++]:null}.bind(this),o=l(),this.noAssert),r!==s)throw RangeError("Illegal range: Truncated data, "+r+" == "+s)}return n?(this.offset=r,o()):{string:o(),length:r-a}},a.readString=a.readUTF8String,a.writeVString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=t,o=p.calculateUTF16asUTF8(d(e),this.noAssert)[1],i=f.calculateVarint32(o),a=(t+=i+o,this.buffer.byteLength);if(a<t&&this.resize((a*=2)>t?a:t),t=(t-=i+o)+this.writeVarint32(o,t),p.encodeUTF16toUTF8(d(e),function(e){this.view[t++]=e}.bind(this)),t!==n+o+i)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+o+i));return r?(this.offset=t,this):t-n},a.readVString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,n=this.readVarint32(e),n=this.readUTF8String(n.value,f.METRICS_BYTES,e+=n.length);return e+=n.length,t?(this.offset=e,n.string):{string:n.string,length:e-r}},a.append=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,t=(e=e instanceof f?e:f.wrap(e,t)).limit-e.offset;return t<=0||((o=this.buffer.byteLength)<(r+=t)&&this.resize((o*=2)>r?o:r),r-=t,this.view.set(e.view.subarray(e.offset,e.limit),r),e.offset+=t,n&&(this.offset+=t)),this},a.appendTo=function(e,t){return e.append(this,t),this},a.assert=function(e){return this.noAssert=!e,this},a.capacity=function(){return this.buffer.byteLength},a.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},a.clone=function(e){var t=new f(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},a.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r,n,o;return 0===e&&t===this.buffer.byteLength||(0==(r=t-e)?(this.buffer=i,this.view=null,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=0):(n=new ArrayBuffer(r),(o=new Uint8Array(n)).set(this.view.subarray(e,t)),this.buffer=n,this.view=o,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=r)),this},a.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r,n;return e===t?new f(0,this.littleEndian,this.noAssert):((n=new f(r=t-e,this.littleEndian,this.noAssert)).offset=0,n.limit=r,0<=n.markedOffset&&(n.markedOffset-=e),this.copyTo(n,0,e,t),n)},a.copyTo=function(e,t,r,n){var o,i;if(!this.noAssert&&!f.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(i=void 0===t)?e.offset:0|t,r=(o=void 0===r)?this.offset:0|r,n=void 0===n?this.limit:0|n,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(r<0||n>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var a=n-r;return 0==a?e:(e.ensureCapacity(t+a),e.view.set(this.view.subarray(r,n),t),o&&(this.offset+=a),i&&(e.offset+=a),this)},a.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},a.fill=function(e,t,r){var n=void 0===t;if(n&&(t=this.offset),"string"==typeof e&&0<e.length&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(!(r<=t)){for(;t<r;)this.view[t++]=e;n&&(this.offset=t)}return this},a.flip=function(){return this.limit=this.offset,this.offset=0,this},a.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},a.order=function(e){if(this.noAssert||"boolean"==typeof e)return this.littleEndian=!!e,this;throw TypeError("Illegal littleEndian: Not a boolean")},a.LE=function(e){return this.littleEndian=void 0===e||!!e,this},a.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},a.prepend=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,i,a,t=(e=e instanceof f?e:f.wrap(e,t)).limit-e.offset;return t<=0||(0<(o=t-r)?(i=new ArrayBuffer(this.buffer.byteLength+o),(a=new Uint8Array(i)).set(this.view.subarray(r,this.buffer.byteLength),t),this.buffer=i,this.view=a,this.offset+=o,0<=this.markedOffset&&(this.markedOffset+=o),this.limit+=o,r+=o):new Uint8Array(this.buffer),this.view.set(e.view.subarray(e.offset,e.limit),r-t),e.offset=e.limit,n&&(this.offset-=t)),this},a.prependTo=function(e,t){return e.prepend(this,t),this},a.printDebug=function(e){(e="function"!=typeof e?console.log.bind(console):e)(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},a.remaining=function(){return this.limit-this.offset},a.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},a.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}var t;return this.buffer.byteLength<e&&(e=new ArrayBuffer(e),(t=new Uint8Array(e)).set(this.view),this.buffer=e,this.view=t),this},a.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e!==t&&Array.prototype.reverse.call(this.view.subarray(e,t)),this},a.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},a.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=e,r.limit=t,r},a.toBuffer=function(e){var t=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}return e||0!==t||r!==this.buffer.byteLength?t===r?i:(e=new ArrayBuffer(r-t),new Uint8Array(e).set(new Uint8Array(this.buffer).subarray(t,r),0),e):this.buffer},a.toArrayBuffer=a.toBuffer,a.toString=function(e,t,r){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(r=t=e="utf8"),e){case"utf8":return this.toUTF8(t,r);case"base64":return this.toBase64(t,r);case"hex":return this.toHex(t,r);case"binary":return this.toBinary(t,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var u,c=function(){for(var e={},o=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],a=[],t=0,r=o.length;t<r;++t)a[o[t]]=t;return e.encode=function(e,t){for(var r,n;null!==(r=e());)t(o[r>>2&63]),n=(3&r)<<4,null!==(r=e())?(t(o[63&((n|=r>>4&15)|r>>4&15)]),n=(15&r)<<2,null!==(r=e())?(t(o[63&(n|r>>6&3)]),t(o[63&r])):(t(o[63&n]),t(61))):(t(o[63&n]),t(61),t(61))},e.decode=function(e,t){var r,n,o;function i(e){throw Error("Illegal character code: "+e)}for(;null!==(r=e());)if(void 0===(n=a[r])&&i(r),null!==(r=e())&&(void 0===(o=a[r])&&i(r),t(n<<2>>>0|(48&o)>>4),null!==(r=e()))){if(void 0===(n=a[r])){if(61===r)break;i(r)}if(t((15&o)<<4>>>0|(60&n)>>2),null!==(r=e())){if(void 0===(o=a[r])){if(61===r)break;i(r)}t((3&n)<<6>>>0|o)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}(),p=(a.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||t<e)throw RangeError("begin, end");var r;return c.encode(function(){return e<t?this.view[e++]:null}.bind(this),r=l()),r()},f.fromBase64=function(e,t){if("string"!=typeof e)throw TypeError("str");var r=new f(e.length/4*3,t),n=0;return c.decode(d(e),function(e){r.view[n++]=e}),r.limit=n,r},f.btoa=function(e){return f.fromBinary(e).toBase64()},f.atob=function(e){return f.fromBase64(e).toBinary()},a.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||t<e)throw RangeError("begin, end");if(e===t)return"";for(var r=[],n=[];e<t;)r.push(this.view[e++]),1024<=r.length&&(n.push(String.fromCharCode.apply(String,r)),r=[]);return n.join("")+String.fromCharCode.apply(String,r)},f.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var r,n=0,o=e.length,i=new f(o,t);n<o;){if(255<(r=e.charCodeAt(n)))throw RangeError("illegal char code: "+r);i.view[n++]=r}return i.limit=o,i},a.toDebug=function(e){for(var t,r=-1,n=this.buffer.byteLength,o="",i="",a="";r<n;){if(-1!==r&&(o+=(t=this.view[r])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e)&&(i+=32<t&&t<127?String.fromCharCode(t):"."),++r,e&&0<r&&r%16==0&&r!==n){for(;o.length<51;)o+=" ";a+=o+i+"\n",o=i=""}r===this.offset&&r===this.limit?o+=r===this.markedOffset?"!":"|":r===this.offset?o+=r===this.markedOffset?"[":"<":r===this.limit?o+=r===this.markedOffset?"]":">":o+=r===this.markedOffset?"'":e||0!==r&&r!==n?" ":""}if(e&&" "!==o){for(;o.length<51;)o+=" ";a+=o+i+"\n"}return e?a:o},f.fromDebug=function(e,t,r){for(var n,o,i=e.length,a=new f((i+1)/3|0,t,r),s=0,d=0,l=!1,u=!1,c=!1,p=!1,h=!1;s<i;){switch(n=e.charAt(s++)){case"!":if(!r){if(u||c||p){h=!0;break}u=c=p=!0}a.offset=a.markedOffset=a.limit=d,l=!1;break;case"|":if(!r){if(u||p){h=!0;break}u=p=!0}a.offset=a.limit=d,l=!1;break;case"[":if(!r){if(u||c){h=!0;break}u=c=!0}a.offset=a.markedOffset=d,l=!1;break;case"<":if(!r){if(u){h=!0;break}u=!0}a.offset=d,l=!1;break;case"]":if(!r){if(p||c){h=!0;break}p=c=!0}a.limit=a.markedOffset=d,l=!1;break;case">":if(!r){if(p){h=!0;break}p=!0}a.limit=d,l=!1;break;case"'":if(!r){if(c){h=!0;break}c=!0}a.markedOffset=d,l=!1;break;case" ":l=!1;break;default:if(!r&&l)h=!0;else{if(o=parseInt(n+e.charAt(s++),16),!r&&(isNaN(o)||o<0||255<o))throw TypeError("Illegal str: Not a debug encoded string");a.view[d++]=o,l=!0}}if(h)throw TypeError("Illegal str: Invalid symbol at "+s)}if(!r){if(!u||!p)throw TypeError("Illegal str: Missing offset or limit");if(d<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+d+" < "+i)}return a},a.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var r,n=new Array(t-e);e<t;)(r=this.view[e++])<16?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},f.fromHex=function(e,t,r){if(!r){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var n,o=e.length,i=new f(o/2|0,t),a=0,s=0;a<o;a+=2){if(n=parseInt(e.substring(a,a+2),16),!r&&(!isFinite(n)||n<0||255<n))throw TypeError("Illegal str: Contains non-hex characters");i.view[s++]=n}return i.limit=s,i},u={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<128?t(127&r):(r<2048?t(r>>6&31|192):(r<65536?t(r>>12&15|224):(t(r>>18&7|240),t(r>>12&63|128)),t(r>>6&63|128)),t(63&r|128)),r=null},decodeUTF8:function(e,t){for(var r,n,o,i,a=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(r=e());)if(0==(128&r))t(r);else if(192==(224&r))null===(n=e())&&a([r,n]),t((31&r)<<6|63&n);else if(224==(240&r))null!==(n=e())&&null!==(o=e())||a([r,n,o]),t((15&r)<<12|(63&n)<<6|63&o);else{if(240!=(248&r))throw RangeError("Illegal starting byte: "+r);null!==(n=e())&&null!==(o=e())&&null!==(i=e())||a([r,n,o,i]),t((7&r)<<18|(63&n)<<12|(63&o)<<6|63&i)}},UTF16toUTF8:function(e,t){for(var r,n=null;null!==(r=null!==n?n:e());)55296<=r&&r<=57343&&null!==(n=e())&&56320<=n&&n<=57343?(t(1024*(r-55296)+n-56320+65536),n=null):t(r);null!==n&&t(n)},UTF8toUTF16:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<=65535?t(r):(t(55296+((r-=65536)>>10)),t(r%1024+56320)),r=null},encodeUTF16toUTF8:function(e,t){u.UTF16toUTF8(e,function(e){u.encodeUTF8(e,t)})},decodeUTF8toUTF16:function(e,t){u.decodeUTF8(e,function(e){u.UTF8toUTF16(e,t)})},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,r=0;null!==(t=e());)r+=t<128?1:t<2048?2:t<65536?3:4;return r},calculateUTF16asUTF8:function(e){var t=0,r=0;return u.UTF16toUTF8(e,function(e){++t,r+=e<128?1:e<2048?2:e<65536?3:4}),[t,r]}});return a.toUTF8=function(t,r){if(void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}var e;try{p.decodeUTF8toUTF16(function(){return t<r?this.view[t++]:null}.bind(this),e=l())}catch(e){if(t!==r)throw RangeError("Illegal range: Truncated data, "+t+" != "+r)}return e()},f.fromUTF8=function(e,t,r){var n,o;if(r||"string"==typeof e)return n=new f(p.calculateUTF16asUTF8(d(e),!0)[1],t,r),o=0,p.encodeUTF16toUTF8(d(e),function(e){n.view[o++]=e}),n.limit=o,n;throw TypeError("Illegal str: Not a string")},f}),!function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.log4javascript=e()}(function(){function isUndefined(e){return void 0===e}function EventSupport(){}Array.prototype.push||(Array.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(0<this.length){for(var e=this[0],t=0,r=this.length-1;t<r;t++)this[t]=this[t+1];return this.length=this.length-1,e}}),Array.prototype.splice||(Array.prototype.splice=function(e,t){for(var r=this.slice(e+t),n=this.slice(e,e+t),o=(this.length=e,[]),i=0,a=arguments.length;i<a;i++)o[i]=arguments[i];for(var s=2<o.length?r=o.slice(2).concat(r):r,i=0,a=s.length;i<a;i++)this.push(s[i]);return n}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(e){if(e instanceof Array){this.eventTypes=e,this.eventListeners={};for(var t=0,r=this.eventTypes.length;t<r;t++)this.eventListeners[this.eventTypes[t]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+e+"'"),this.eventListeners[e].push(t)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+e+"'"),array_remove(this.eventListeners[e],t)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(e,t){if(array_contains(this.eventTypes,e))for(var r=this.eventListeners[e],n=0,o=r.length;n<o;n++)r[n](this,e,t);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+e+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;function toStr(e){return e&&e.toString?e.toString():String(e)}function getExceptionMessage(e){return e.message||e.description||toStr(e)}function getUrlFileName(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return e.substr(t+1)}function getExceptionStringRep(e){if(e){var t="Exception: "+getExceptionMessage(e);try{e.lineNumber&&(t+=" on line number "+e.lineNumber),e.fileName&&(t+=" in file "+getUrlFileName(e.fileName))}catch(e){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&e.stack&&(t+=newLine+"Stack trace:"+newLine+e.stack),t}return null}function bool(e){return Boolean(e)}function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}log4javascript.version="1.4.11",log4javascript.edition="log4javascript";var urlEncode=void 0!==window.encodeURIComponent?function(e){return encodeURIComponent(e)}:function(e){return escape(e).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};function array_remove(e,t){for(var r=-1,n=0,o=e.length;n<o;n++)if(e[n]===t){r=n;break}0<=r&&e.splice(r,1)}function array_contains(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]==t)return!0;return!1}function extractBooleanFromParam(e,t){return isUndefined(e)?t:bool(e)}function extractStringFromParam(e,t){return isUndefined(e)?t:String(e)}function extractIntFromParam(t,r){if(isUndefined(t))return r;try{var e=parseInt(t,10);return isNaN(e)?r:e}catch(e){return logLog.warn("Invalid int param "+t,e),r}}function extractFunctionFromParam(e,t){return"function"==typeof e?e:t}function isError(e){return e instanceof Error}Function.prototype.apply||(Function.prototype.apply=function(obj,args){for(var methodName="__apply__",argsStrings=(void 0!==obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this,[]),i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(e){for(var t=[],r=1,n=arguments.length;r<n;r++)t[r-1]=arguments[r];return this.apply(e,t)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(e){this.quietMode=bool(e)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(e){this.alertAllErrors=e},debug:function(e){this.debugMessages.push(e)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(e,t){},error:function(e,t){1!=++this.numberOfErrors&&!this.alertAllErrors||this.quietMode||(e="log4javascript error: "+e,t&&(e+=newLine+newLine+"Original error: "+getExceptionStringRep(t)),alert(e))}};function handleError(e,t){logLog.error(e,t),log4javascript.dispatchEvent("error",{message:e,exception:t})}log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled),useTimeStampsInMilliseconds=(log4javascript.setEnabled=function(e){enabled=bool(e)},log4javascript.isEnabled=function(){return enabled},!0),showStackTraces=(log4javascript.setTimeStampsInMilliseconds=function(e){useTimeStampsInMilliseconds=bool(e)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)},!1),Level=(log4javascript.setShowStackTraces=function(e){showStackTraces=bool(e)},function(e,t){this.level=e,this.name=t});function Timer(e,t){this.name=e,this.level=isUndefined(t)?Level.INFO:t,this.start=new Date}Level.prototype={toString:function(){return this.name},equals:function(e){return this.level==e.level},isGreaterOrEqual:function(e){return this.level>=e.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";function Logger(e){this.name=e,this.parent=null,this.children=[];var r=[],t=null,n=this.name===rootLoggerName,o=this.name===nullLoggerName,i=null,a=!1,s=(this.addChild=function(e){this.children.push(e),e.parent=this,e.invalidateAppenderCache()},!0),d=(this.getAdditivity=function(){return s},this.setAdditivity=function(e){var t=s!=e;s=e,t&&this.invalidateAppenderCache()},this.addAppender=function(e){o?handleError("Logger.addAppender: you may not add an appender to the null logger"):e instanceof log4javascript.Appender?array_contains(r,e)||(r.push(e),e.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(e)+"') is not a subclass of Appender")},this.removeAppender=function(e){array_remove(r,e),e.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var e=r.length;if(0<e){for(var t=0;t<e;t++)r[t].setRemovedFromLogger(this);r.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){var e;return null!==i&&!a||(e=n||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders(),i=e.concat(r),a=!1),i},this.invalidateAppenderCache=function(){a=!0;for(var e=0,t=this.children.length;e<t;e++)this.children[e].invalidateAppenderCache()},this.log=function(e,t){if(enabled&&e.isGreaterOrEqual(this.getEffectiveLevel())){for(var r=t.length-1,n=t[r],o=(1<t.length&&isError(n)&&(a=n,r--),[]),i=0;i<=r;i++)o[i]=t[i];var a,n=new LoggingEvent(this,new Date,e,o,a);this.callAppenders(n),avdEngineHandle&&avdEngineHandle.appSign&&avdEngineHandle.appFunName&&e.level>=avdEngineHandle.levelValue&&(a=this.formatTimestamp(new Date),a=(a+=e+" - ")+o.toString(),avdEngineHandle.appFunName(avdEngineHandle.appSign,a)),avdEngineHandle&&avdEngineHandle.bugout&&(e==Level.TRACE?avdEngineHandle.bugout.trace(o.toString()):e==Level.DEBUG?avdEngineHandle.bugout.debug(o.toString()):e!=Level.INFO&&e==Level.ERROR?avdEngineHandle.bugout.error(o.toString()):avdEngineHandle.bugout.info(o.toString()))}"undefined"!=typeof logAjax&&logAjax.enabled&&e.level>=logAjax.level&&saveLog(e.name,t[0],t[1])},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+" "+e.getMilliseconds()+"]: "},this.callAppenders=function(e){for(var t=this.getEffectiveAppenders(),r=0,n=t.length;r<n;r++)t[r].doAppend(e)},this.setLevel=function(e){n&&null===e?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):e instanceof Level?t=e:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return t},this.getEffectiveLevel=function(){for(var e=this;null!==e;e=e.parent){var t=e.getLevel();if(null!==t)return t}},this.group=function(e,t){if(enabled)for(var r=this.getEffectiveAppenders(),n=0,o=r.length;n<o;n++)r[n].group(e,t)},this.groupEnd=function(){if(enabled)for(var e=this.getEffectiveAppenders(),t=0,r=e.length;t<r;t++)e[t].groupEnd()},{});this.time=function(e,t){enabled&&(isUndefined(e)?handleError("Logger.time: a name for the timer must be supplied"):!t||t instanceof Level?d[e]=new Timer(e,t):handleError("Logger.time: level supplied to timer "+e+" is not an instance of log4javascript.Level"))},this.timeEnd=function(e){var t,r;enabled&&(isUndefined(e)?handleError("Logger.timeEnd: a name for the timer must be supplied"):d[e]?(r=(t=d[e]).getElapsedTime(),this.log(t.level,["Timer "+toStr(e)+" completed in "+r+"ms"]),delete d[e]):logLog.warn("Logger.timeEnd: no timer found with name "+e))},this.assert=function(e){if(enabled&&!e){for(var t=[],r=1,n=arguments.length;r<n;r++)t.push(arguments[r]);(t=0<t.length?t:["Assertion Failure"]).push(newLine),t.push(e),this.log(Level.ERROR,t)}},this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(e){return e.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName),defaultLogger=(rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(e){var t,r;return"string"!=typeof e&&logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(e=anonymousLoggerName)+" supplied, returning anonymous logger"),e==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),loggers[e]||(t=new Logger(e),loggers[e]=t,loggerNames.push(e),(-1<(r=e.lastIndexOf("."))?(r=e.substring(0,r),log4javascript.getLogger(r)):rootLogger).addChild(t)),loggers[e]},null),nullLogger=(log4javascript.getDefaultLogger=function(){return defaultLogger=defaultLogger||createDefaultLogger()},null),LoggingEvent=(log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName)).setLevel(Level.OFF),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}},function(e,t,r,n,o){this.logger=e,this.timeStamp=t,this.timeStampInMilliseconds=t.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=r,this.messages=n,this.exception=o}),Layout=(LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent,function(){}),Appender=(Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(e){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(e)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(e){return this.isTimeStampsInMilliseconds()?e.timeStampInMilliseconds:e.timeStampInSeconds},getDataValues:function(e,t){var r=[[this.loggerKey,e.logger.name],[this.timeStampKey,this.getTimeStampValue(e)],[this.levelKey,e.level.name],[this.urlKey,window.location.href],[this.messageKey,t?e.getCombinedMessages():e.messages]];if(this.isTimeStampsInMilliseconds()||r.push([this.millisecondsKey,e.milliseconds]),e.exception&&r.push([this.exceptionKey,getExceptionStringRep(e.exception)]),this.hasCustomFields())for(var n=0,o=this.customFields.length;n<o;n++){var i=this.customFields[n].value;"function"==typeof i&&(i=i(this,e)),r.push([this.customFields[n].name,i])}return r},setKeys:function(e,t,r,n,o,i,a){this.loggerKey=extractStringFromParam(e,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(t,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(r,this.defaults.levelKey),this.messageKey=extractStringFromParam(n,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(o,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(i,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(a,this.defaults.millisecondsKey)},setCustomField:function(e,t){for(var r=!1,n=0,o=this.customFields.length;n<o;n++)this.customFields[n].name===e&&(this.customFields[n].value=t,r=!0);r||this.customFields.push({name:e,value:t})},hasCustomFields:function(){return 0<this.customFields.length},formatWithException:function(e){var t=this.format(e);return e.exception&&this.ignoresThrowable()&&(t+=e.getThrowableStrRep()),t},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout,function(){}),SimpleDateFormat;function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(e){this.combineMessages=extractBooleanFromParam(e,!0),this.customFields=[]}function escapeNewLines(e){return e.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(e,t){this.readable=extractBooleanFromParam(e,!1),this.combineMessages=extractBooleanFromParam(t,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(e,t,r){var p=[];return function e(t,r,o){var n,i,a,s,d,l,u;function c(e){for(var t=splitIntoLines(e),r=1,n=t.length;r<n;r++)t[r]=o+t[r];return t.join(newLine)}if(o=o||"",null===t)return"null";if(void 0===t)return"undefined";if("string"==typeof t)return c(t);if("object"==typeof t&&array_contains(p,t)){try{l=toStr(t)}catch(e){l="Error formatting property. Details: "+getExceptionStringRep(e)}return l+" [already expanded]"}if(t instanceof Array&&0<r){for(p.push(t),l="["+newLine,a=r-1,s=o+"  ",d=[],n=0,i=t.length;n<i;n++)try{u=e(t[n],a,s),d.push(s+u)}catch(e){d.push(s+"Error formatting array member. Details: "+getExceptionStringRep(e))}return l+=d.join(","+newLine)+newLine+o+"]"}if("[object Date]"==Object.prototype.toString.call(t))return t.toString();if("object"==typeof t&&0<r){for(n in p.push(t),l="{"+newLine,a=r-1,s=o+"  ",d=[],t)try{u=e(t[n],a,s),d.push(s+n+": "+u)}catch(e){d.push(s+n+": Error formatting property. Details: "+getExceptionStringRep(e))}return l+=d.join(","+newLine)+newLine+o+"}"}return c(toStr(t))}(e,t,r)}function PatternLayout(e){this.pattern=e||PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(e){enabled&&e.level.level>=this.threshold.level&&this.append(e)},Appender.prototype.append=function(e){},Appender.prototype.setLayout=function(e){e instanceof Layout?this.layout=e:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(e){e instanceof Level?this.threshold=e:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(e){this.loggers.push(e)},Appender.prototype.setRemovedFromLogger=function(e){array_remove(this.loggers,e)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(e){return e.level.name+" - "+e.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(e){return e.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(e){var t=e.messages,e=e.exception;return e?t.concat([e]):t},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(e){return e.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(e){var t,r,n=this;function o(e){return e="string"==typeof e?e:toStr(e),"<log4javascript:message><![CDATA["+n.escapeCdata(e)+"]]></log4javascript:message>"}var i='<log4javascript:event logger="'+e.logger.name+'" timestamp="'+this.getTimeStampValue(e)+'"';if(this.isTimeStampsInMilliseconds()||(i+=' milliseconds="'+e.milliseconds+'"'),i+=' level="'+e.level.name+'">'+newLine,this.combineMessages)i+=o(e.getCombinedMessages());else{for(i+="<log4javascript:messages>"+newLine,t=0,r=e.messages.length;t<r;t++)i+=o(e.messages[t])+newLine;i+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(t=0,r=this.customFields.length;t<r;t++)i+='<log4javascript:customfield name="'+this.customFields[t].name+'"><![CDATA['+this.customFields[t].value.toString()+"]]></log4javascript:customfield>"+newLine;return e.exception&&(i+="<log4javascript:exception><![CDATA["+getExceptionStringRep(e.exception)+"]]></log4javascript:exception>"+newLine),i+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(e){var t,r,l=this,n=this.getDataValues(e,this.combineMessages),o="{"+this.lineBreak;for(t=0,r=n.length-1;t<=r;t++)o+=this.tab+'"'+n[t][0]+'"'+this.colon+function e(t,r,n){var o=typeof t;if(t instanceof Date)i=String(t.getTime());else if(n&&t instanceof Array){for(var i="["+l.lineBreak,a=0,s=t.length;a<s;a++){var d=r+l.tab;i+=d+e(t[a],d,!1),a<t.length-1&&(i+=","),i+=l.lineBreak}i+=r+"]"}else i="number"!=o&&"boolean"!=o?'"'+escapeNewLines(toStr(t).replace(/\"/g,'\\"'))+'"':t;return i}(n[t][1],this.tab,!0),t<r&&(o+=","),o+=this.lineBreak;return o+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(e){for(var t=this.getDataValues(e),r=[],n=0,o=t.length;n<o;n++){var i=t[n][1]instanceof Date?String(t[n][1].getTime()):t[n][1];r.push(urlEncode(t[n][0])+"="+urlEncode(i))}return r.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(e){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout,!function(){function n(e,t,r){return(e=new Date(e,t,r,0,0,0)).setMilliseconds(0),e}function h(e,t){for(;e.length<t;)e="0"+e;return e}function f(e,t,r){return 4<=t?e:e.substr(0,Math.max(r,t))}function m(e,t){return h(""+e,t)}var g=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,y=["January","February","March","April","May","June","July","August","September","October","November","December"],v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b={G:0,y:3,M:4,w:2,W:2,D:2,d:2,F:2,E:1,a:0,H:2,k:2,K:2,h:2,m:2,s:2,S:2,Z:5};Date.prototype.getDifference=function(e){return this.getTime()-e.getTime()},Date.prototype.isBefore=function(e){return this.getTime()<e.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(e){return this.getUTCTime()-e.getUTCTime()},Date.prototype.getPreviousSunday=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),e=new Date(e.getTime()-864e5*this.getDay());return n(e.getFullYear(),e.getMonth(),e.getDate())},Date.prototype.getWeekInYear=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=n(this.getFullYear(),0,1),t=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return 7-r.getDay()<e&&t--,t},Date.prototype.getWeekInMonth=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=n(this.getFullYear(),this.getMonth(),1),t=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return e<=7-r.getDay()&&t++,t},Date.prototype.getDayInYear=function(){var e=n(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(e)/864e5)},(SimpleDateFormat=function(e){this.formatString=e}).prototype.setMinimalDaysInFirstWeek=function(e){this.minimalDaysInFirstWeek=e},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?1:this.minimalDaysInFirstWeek};SimpleDateFormat.prototype.format=function(e){for(var t,r="",n=this.formatString;t=g.exec(n);){var o=t[1],i=t[2],a=t[3],s=t[4];if(o)r+="''"==o?"'":o.substring(1,o.length-1);else if(!a)if(s)r+=s;else if(i){var o=i.charAt(0),d=i.length,l="";switch(o){case"G":l="AD";break;case"y":l=e.getFullYear();break;case"M":l=e.getMonth();break;case"w":l=e.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":l=e.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":l=e.getDayInYear();break;case"d":l=e.getDate();break;case"F":l=1+Math.floor((e.getDate()-1)/7);break;case"E":l=v[e.getDay()];break;case"a":l=12<=e.getHours()?"PM":"AM";break;case"H":l=e.getHours();break;case"k":l=e.getHours()||24;break;case"K":l=e.getHours()%12;break;case"h":l=e.getHours()%12||12;break;case"m":l=e.getMinutes();break;case"s":l=e.getSeconds();break;case"S":l=e.getMilliseconds();break;case"Z":l=e.getTimezoneOffset()}switch(b[o]){case 0:r+=f(l,d,2);break;case 1:r+=f(l,d,3);break;case 2:r+=m(l,d);break;case 3:r+=d<=3?(""+l).substr(2,2):m(l,d);break;case 4:r+=3<=d?f(y[l],d,d):m(l+1,d);break;case 5:var u=0<l?"-":"+",c=Math.abs(l),p=""+Math.floor(c/60);r+=u+h(p,2)+h(""+c%60,2)}}n=n.substr(t.index+t[0].length)}return r}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(e){for(var t,r=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,n="",o=this.pattern;t=r.exec(o);){var i=t[0],a=t[1],s=t[2],d=t[3],l=t[5],u=t[6];if(u)n+=""+u;else{var c,p="";switch(d){case"a":case"m":for(var h=0,f=(l&&(h=parseInt(l,10),isNaN(h))&&(handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character '"+d+"' - should be a number"),h=0),"a"===d?e.messages[0]:e.messages),m=0,g=f.length;m<g;m++)0<m&&" "!==p.charAt(p.length-1)&&(p+=" "),p+=0===h?f[m]:formatObjectExpansion(f[m],h);break;case"c":var y,v,b=e.logger.name;p=!l||(y=parseInt(l,10))>=(v=e.logger.name.split(".")).length?b:v.slice(v.length-y).join(".");break;case"d":b=PatternLayout.ISO8601_DATEFORMAT;l&&("ISO8601"==(b=l)?b=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==b?b=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==b&&(b=PatternLayout.DATETIME_DATEFORMAT)),p=new SimpleDateFormat(b).format(e.timeStamp);break;case"f":this.hasCustomFields()&&(v=0,l&&(v=parseInt(l,10),isNaN(v)?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - should be a number"):0===v?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - must be greater than zero"):v>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - there aren't that many custom fields"):v-=1),p=y="function"==typeof(y=this.customFields[v].value)?y(this,e):y);break;case"n":p=newLine;break;case"p":p=e.level.name;break;case"r":p=""+e.timeStamp.getDifference(applicationStartDate);break;case"%":p="%";break;default:p=i}if(s&&(c=parseInt(s.substr(1),10))<(u=p.length)&&(p=p.substring(u-c,u)),a)if("-"==a.charAt(0))for(c=parseInt(a.substr(1),10);p.length<c;)p+=" ";else for(c=parseInt(a,10);p.length<c;)p=" "+p;n+=p}o=o.substr(t.index+t[0].length)}return n},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(e){alert(this.getLayout().formatWithException(e))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(t){function e(){var e=i.getLayout().formatWithException(t);return"string"==typeof e?[e]:e}var r,n,o,i=this;(r=window.console)&&r.log?(n=e(),r[o=r.debug&&Level.DEBUG.isGreaterOrEqual(t.level)?"debug":r.info&&Level.INFO.equals(t.level)?"info":r.warn&&Level.WARN.equals(t.level)?"warn":r.error&&t.level.isGreaterOrEqual(Level.ERROR)?"error":"log"].apply?r[o].apply(r,n):r[o](n)):"undefined"!=typeof opera&&opera.postError&&opera.postError(e())},BrowserConsoleAppender.prototype.group=function(e){window.console&&window.console.group&&window.console.group(e)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(e){for(var t,r,n=0,o=xmlHttpFactories.length;n<o;n++){r=xmlHttpFactories[n];try{return t=r(),withCredentialsSupported=r==xhrFactory&&"withCredentials"in t,getXmlHttp=r,t}catch(e){}}e?e():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")},ConsoleAppender,oldOnload;function isHttpRequestSuccessful(e){return isUndefined(e.status)||0===e.status||200<=e.status&&e.status<300||1223==e.status}function AjaxAppender(a,s){var o=this,d=!0,i=(a||(handleError("AjaxAppender: URL must be specified in constructor"),d=!1),this.defaults.timed),l=this.defaults.waitForResponse,u=this.defaults.batchSize,t=this.defaults.timerInterval,c=this.defaults.requestSuccessCallback,p=this.defaults.failCallback,h=this.defaults.postVarName,f=this.defaults.sendAllOnUnload,m=this.defaults.contentType,r=null,g=[],y=[],v=[],b=!1,_=!1;function n(e){if(!_)return 1;handleError("AjaxAppender: configuration option '"+e+"' may not be set after the appender has been initialized")}function S(){var e;if(d&&enabled)if(b=!0,l)0<y.length?C(E(e=y.shift()),S):(b=!1,i&&I());else{for(;e=y.shift();)C(E(e));b=!1,i&&I()}}function w(){var e=!1;if(d&&enabled){for(var t,r=o.getLayout().allowBatching()?u:1,n=[];t=g.shift();)n.push(t),g.length>=r&&(y.push(n),n=[]);0<n.length&&y.push(n),e=0<y.length,i=l=!1,S()}return e}function E(e){for(var t,r=[],n="";t=e.shift();)r.push(o.getLayout().formatWithException(t));return n=1==e.length?r.join(""):o.getLayout().batchHeader+r.join(o.getLayout().batchSeparator)+o.getLayout().batchFooter,m==o.defaults.contentType&&(0<(n=o.getLayout().returnsPostData?n:urlEncode(h)+"="+urlEncode(n)).length&&(n+="&"),n+="layout="+urlEncode(o.getLayout().toString())),n}function I(){window.setTimeout(S,t)}function T(){var e="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(e),d=!1,p&&p(e)}function C(e,t){try{var r=getXmlHttp(T);if(d){r.onreadystatechange=function(){var e;4==r.readyState&&(isHttpRequestSuccessful(r)?(c&&c(r),t&&t(r)):(handleError(e="AjaxAppender.append: XMLHttpRequest request to URL "+a+" returned status code "+r.status),p&&p(e)),r.onreadystatechange=emptyFunction,r=null)},r.open("POST",a,!0),s&&withCredentialsSupported&&(r.withCredentials=!0);try{for(var n,o=0;n=v[o++];)r.setRequestHeader(n.name,n.value);r.setRequestHeader("Content-Type",m)}catch(e){var i="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(i),d=!1,void(p&&p(i))}r.send(e)}}catch(e){i="AjaxAppender.append: error sending log message to "+a;handleError(i,e),d=!1,p&&p(i+". Details: "+getExceptionStringRep(e))}}this.getSessionId=function(){return r},this.setSessionId=function(e){r=extractStringFromParam(e,null),this.layout.setCustomField("sessionid",r)},this.setLayout=function(e){n("layout")&&(this.layout=e,null!==r)&&this.setSessionId(r)},this.isTimed=function(){return i},this.setTimed=function(e){n("timed")&&(i=bool(e))},this.getTimerInterval=function(){return t},this.setTimerInterval=function(e){n("timerInterval")&&(t=extractIntFromParam(e,t))},this.isWaitForResponse=function(){return l},this.setWaitForResponse=function(e){n("waitForResponse")&&(l=bool(e))},this.getBatchSize=function(){return u},this.setBatchSize=function(e){n("batchSize")&&(u=extractIntFromParam(e,u))},this.isSendAllOnUnload=function(){return f},this.setSendAllOnUnload=function(e){n("sendAllOnUnload")&&(f=extractBooleanFromParam(e,f))},this.setRequestSuccessCallback=function(e){c=extractFunctionFromParam(e,c)},this.setFailCallback=function(e){p=extractFunctionFromParam(e,p)},this.getPostVarName=function(){return h},this.setPostVarName=function(e){n("postVarName")&&(h=extractStringFromParam(e,h))},this.getHeaders=function(){return v},this.addHeader=function(e,t){"content-type"==e.toLowerCase()?m=t:v.push({name:e,value:t})},this.sendAll=S,this.sendAllRemaining=w,this.append=function(e){if(d){_||(_=!0,f&&(t=window.onbeforeunload,window.onbeforeunload=function(){t&&t(),w()}),i&&I()),g.push(e);var t,e=this.getLayout().allowBatching()?u:1;if(g.length>=e){for(var r,n=[];r=g.shift();)n.push(r);y.push(n),i||l&&b||S()}}}}function setCookie(e,t,r,n){var o;n=n?"; path="+n:"",r=r?((o=new Date).setTime(o.getTime()+24*r*60*60*1e3),"; expires="+o.toGMTString()):"",document.cookie=escape(e)+"="+escape(t)+r+n}function getCookie(e){for(var t=escape(e)+"=",r=document.cookie.split(";"),n=0,o=r.length;n<o;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return unescape(i.substring(t.length,i.length))}return null}function getBaseUrl(){for(var e,t=document.getElementsByTagName("script"),r=0,n=t.length;r<n;++r)if(-1!=t[r].src.indexOf("log4javascript"))return-1==(e=t[r].src.lastIndexOf("/"))?"":t[r].src.substr(0,e+1);return null}function isLoaded(e){try{return bool(e.loaded)}catch(e){return!1}}function padWithSpaces(e,t){if(e.length<t){for(var r=[],n=Math.max(0,t-e.length),o=0;o<n;o++)r[o]=" ";e+=r.join("")}return e}function createDefaultLogger(){var e=log4javascript.getLogger(defaultLoggerName),t=new log4javascript.PopUpAppender;return e.addAppender(t),e}return AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender,function(){var ee=[],te=1;function e(e,t,r,n,o){this.create(!1,null,e,t,r,n,o,this.defaults.focusPopUp)}function t(e,t,r,n,o,i){this.create(!0,e,t,r,n,o,i,!1)}(ConsoleAppender=function(){}).prototype=new Appender,ConsoleAppender.prototype.create=function(H,t,L,s,d,l,u,N){function r(e){return!h||(handleError(j+": configuration option '"+e+"' may not be set after the appender has been initialized"),!1)}function n(){return f&&y&&!m}var o,e,c,i,p=this,a=!1,h=!1,f=!1,m=!1,g=[],y=!0,B=te++,v=(s=extractBooleanFromParam(s,this.defaults.initiallyMinimized),L=extractBooleanFromParam(L,this.defaults.lazyInit),d=extractBooleanFromParam(d,this.defaults.useDocumentWrite),this.defaults.newestMessageAtTop),b=this.defaults.scrollToLatestMessage,_=(l=l||this.defaults.width,u=u||this.defaults.height,this.defaults.maxMessages),S=this.defaults.showCommandLine,w=this.defaults.commandLineObjectExpansionDepth,E=this.defaults.showHideButton,I=this.defaults.showCloseButton,j=(this.setLayout(this.defaults.layout),H?"InPageAppender":"PopUpAppender"),T=(this.isNewestMessageAtTop=function(){return v},this.setNewestMessageAtTop=function(e){v=bool(e),n()&&c().setNewestAtTop(v)},this.isScrollToLatestMessage=function(){return b},this.setScrollToLatestMessage=function(e){b=bool(e),n()&&c().setScrollToLatest(b)},this.getWidth=function(){return l},this.setWidth=function(e){r("width")&&(l=extractStringFromParam(e,l))},this.getHeight=function(){return u},this.setHeight=function(e){r("height")&&(u=extractStringFromParam(e,u))},this.getMaxMessages=function(){return _},this.setMaxMessages=function(e){_=extractIntFromParam(e,_),n()&&c().setMaxMessages(_)},this.isShowCommandLine=function(){return S},this.setShowCommandLine=function(e){S=bool(e),n()&&c().setShowCommandLine(S)},this.isShowHideButton=function(){return E},this.setShowHideButton=function(e){E=bool(e),n()&&c().setShowHideButton(E)},this.isShowCloseButton=function(){return I},this.setShowCloseButton=function(e){I=bool(e),n()&&c().setShowCloseButton(I)},this.getCommandLineObjectExpansionDepth=function(){return w},this.setCommandLineObjectExpansionDepth=function(e){w=extractIntFromParam(e,w)},s);function V(e,t){this.loggingEvent=e,this.levelName=e.level.name,this.formattedMessage=t}function F(e,t){this.name=e,this.initiallyExpanded=t}function q(){}this.isInitiallyMinimized=function(){return s},this.setInitiallyMinimized=function(e){r("initiallyMinimized")&&(s=bool(e),T=s)},this.isUseDocumentWrite=function(){return d},this.setUseDocumentWrite=function(e){r("useDocumentWrite")&&(d=bool(e))},V.prototype.append=function(){c().log(this.levelName,this.formattedMessage)},F.prototype.append=function(){c().group(this.name,this.initiallyExpanded)},q.prototype.append=function(){c().groupEnd()};function G(){$(),a?m&&A&&e():o(),$()&&z()}this.append=function(e){var t;y&&(t=p.getLayout().formatWithException(e),g.push(new V(e,t)),G())},this.group=function(e,t){y&&(g.push(new F(e,t)),G())},this.groupEnd=function(){y&&(g.push(new q),G())};var C,R,W,P,k,x,M,A,O,z=function(){for(;0<g.length;)g.shift().append();N&&c().focus()},U=(this.setAddedToLogger=function(e){this.loggers.push(e),enabled&&!L&&o()},this.clear=function(){n()&&c().clearLog(),g.length=0},this.focus=function(){n()&&c().focus()},this.focusCommandLine=function(){n()&&c().focusCommandLine()},this.focusSearch=function(){n()&&c().focusSearch()},window),Y=(this.getCommandWindow=function(){return U},this.setCommandWindow=function(e){U=e},this.executeLastCommand=function(){n()&&c().evalLastCommand()},new PatternLayout("%m")),D=(this.getCommandLayout=function(){return Y},this.setCommandLayout=function(e){Y=e},this.evalCommandAndAppend=function(e){var t={appendResult:!0,isError:!1},r="";try{!U.eval&&U.execScript&&U.execScript("null");var n,o={},i=0;for(len=D.length;i<len;i++)o[D[i][0]]=D[i][1];var a=[],s=function(e){a.push([e,U[e]])};s("appender"),U.appender=p,s("commandReturnValue"),U.commandReturnValue=t,s("commandLineFunctionsHash"),U.commandLineFunctionsHash=o;for(i=0,len=D.length;i<len;i++)!function(e){s(e),U[e]=function(){return this.commandLineFunctionsHash[e](p,arguments,t)}}(D[i][0]);for(r=isUndefined(n=U===window&&U.execScript?(s("evalExpr"),s("result"),window.evalExpr=e,U.execScript("window.result=eval(window.evalExpr);"),window.result):U.eval(e))?n:formatObjectExpansion(n,w),i=0,len=a.length;i<len;i++)U[a[i][0]]=a[i][1]}catch(e){r="Error evaluating command: "+getExceptionStringRep(e),t.isError=!0}t.appendResult&&(n=">>> "+e,isUndefined(r)||(n+=newLine+r),e=t.isError?Level.ERROR:Level.INFO,r=new LoggingEvent(null,new Date,e,[n],null),e=this.getLayout(),this.setLayout(Y),this.append(r),this.setLayout(e))},ee.concat([])),K=(this.addCommandLineFunction=function(e,t){D.push([e,t])},"log4javascriptCommandHistory"),X=(this.storeCommandHistory=function(e){setCookie(K,e.join(","))},function(e){var t=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"\t<head>","\t\t<title>log4javascript</title>",'\t\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\t\t\x3c!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work --\x3e",'\t\t<meta http-equiv="X-UA-Compatible" content="IE=7" />','\t\t<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','\t\t\x3c!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]--\x3e','\t\t\x3c!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]--\x3e','\t\t<script type="text/javascript">',"\t\t\t//<![CDATA[","\t\t\tvar loggingEnabled = true;","\t\t\tvar logQueuedEventsTimer = null;","\t\t\tvar logEntries = [];","\t\t\tvar logEntriesAndSeparators = [];","\t\t\tvar logItems = [];","\t\t\tvar renderDelay = 100;","\t\t\tvar unrenderedLogItemsExist = false;","\t\t\tvar rootGroup, currentGroup = null;","\t\t\tvar loaded = false;","\t\t\tvar currentLogItem = null;","\t\t\tvar logMainContainer;","","\t\t\tfunction copyProperties(obj, props) {","\t\t\t\tfor (var i in props) {","\t\t\t\t\tobj[i] = props[i];","\t\t\t\t}","\t\t\t}","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItem() {","\t\t\t}","","\t\t\tLogItem.prototype = {","\t\t\t\tmainContainer: null,","\t\t\t\twrappedContainer: null,","\t\t\t\tunwrappedContainer: null,","\t\t\t\tgroup: null,","","\t\t\t\tappendToLog: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].appendToLog();","\t\t\t\t\t}","\t\t\t\t\tthis.group.update();","\t\t\t\t},","","\t\t\t\tdoRemove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].remove();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = null;","\t\t\t\t\t\tthis.wrappedElementContainer = null;","\t\t\t\t\t\tthis.mainElementContainer = null;","\t\t\t\t\t}","\t\t\t\t\tif (this.group && removeFromGroup) {","\t\t\t\t\t\tthis.group.removeChild(this, doUpdate);","\t\t\t\t\t}","\t\t\t\t\tif (this === currentLogItem) {","\t\t\t\t\t\tcurrentLogItem = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\trender: function() {},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visit(this);","\t\t\t\t},","","\t\t\t\tgetUnwrappedDomContainer: function() {","\t\t\t\t\treturn this.group.unwrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetWrappedDomContainer: function() {","\t\t\t\t\treturn this.group.wrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetMainDomContainer: function() {","\t\t\t\t\treturn this.group.mainElementContainer.contentDiv;","\t\t\t\t}","\t\t\t};","","\t\t\tLogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContainerElement() {","\t\t\t}","","\t\t\tLogItemContainerElement.prototype = {","\t\t\t\tappendToLog: function() {","\t\t\t\t\tvar insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","\t\t\t\t\tif (insertBeforeFirst) {","\t\t\t\t\t\tthis.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.containerDomNode.appendChild(this.mainDiv);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction SeparatorElementContainer(containerDomNode) {","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "separator";','\t\t\t\tthis.mainDiv.innerHTML = "&nbsp;";',"\t\t\t}","","\t\t\tSeparatorElementContainer.prototype = new LogItemContainerElement();","","\t\t\tSeparatorElementContainer.prototype.remove = function() {","\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\tthis.mainDiv = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Separator() {","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tSeparator.prototype = new LogItem();","","\t\t\tcopyProperties(Separator.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","\t\t\t\tthis.group = group;","\t\t\t\tthis.containerDomNode = containerDomNode;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.isWrapped = isWrapped;","\t\t\t\tthis.expandable = false;","","\t\t\t\tif (this.isRoot) {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.contentDiv = logMainContainer.appendChild(document.createElement("div"));','\t\t\t\t\t\tthis.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentDiv = logMainContainer;","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tvar groupElementContainer = this;","\t\t\t\t\t",'\t\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\t\tthis.mainDiv.className = "group";',"",'\t\t\t\t\tthis.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tthis.headingDiv.className = "groupheading";',"",'\t\t\t\t\tthis.expander = this.headingDiv.appendChild(document.createElement("span"));','\t\t\t\t\tthis.expander.className = "expander unselectable greyedout";',"\t\t\t\t\tthis.expander.unselectable = true;",'\t\t\t\t\tvar expanderText = this.group.expanded ? "-" : "+";',"\t\t\t\t\tthis.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","\t\t\t\t\t",'\t\t\t\t\tthis.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'\t\t\t\t\tthis.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tvar contentCssClass = this.group.expanded ? "expanded" : "collapsed";','\t\t\t\t\tthis.contentDiv.className = "groupcontent " + contentCssClass;',"","\t\t\t\t\tthis.expander.onclick = function() {","\t\t\t\t\t\tif (groupElementContainer.group.expandable) {","\t\t\t\t\t\t\tgroupElementContainer.group.toggleExpanded();","\t\t\t\t\t\t}","\t\t\t\t\t};","\t\t\t\t}","\t\t\t}","","\t\t\tGroupElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(GroupElementContainer.prototype, {","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tvar oldCssClass, newCssClass, expanderText;","\t\t\t\t\t\tif (this.group.expanded) {",'\t\t\t\t\t\t\tnewCssClass = "expanded";','\t\t\t\t\t\t\toldCssClass = "collapsed";','\t\t\t\t\t\t\texpanderText = "-";',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tnewCssClass = "collapsed";','\t\t\t\t\t\t\toldCssClass = "expanded";','\t\t\t\t\t\t\texpanderText = "+";',"\t\t\t\t\t\t}","\t\t\t\t\t\treplaceClass(this.contentDiv, newCssClass, oldCssClass);","\t\t\t\t\t\tthis.expanderTextNode.nodeValue = expanderText;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tthis.headingDiv = null;","\t\t\t\t\t\tthis.expander.onclick = null;","\t\t\t\t\t\tthis.expander = null;","\t\t\t\t\t\tthis.expanderTextNode = null;","\t\t\t\t\t\tthis.contentDiv = null;","\t\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\t// Invert the order of the log entries","\t\t\t\t\tvar node = null;","","\t\t\t\t\t// Remove all the log container nodes","\t\t\t\t\tvar childDomNodes = [];","\t\t\t\t\twhile ((node = this.contentDiv.firstChild)) {","\t\t\t\t\t\tthis.contentDiv.removeChild(node);","\t\t\t\t\t\tchildDomNodes.push(node);","\t\t\t\t\t}","","\t\t\t\t\t// Put them all back in reverse order","\t\t\t\t\twhile ((node = childDomNodes.pop())) {","\t\t\t\t\t\tthis.contentDiv.appendChild(node);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tif (this.group.expandable) {",'\t\t\t\t\t\t\tremoveClass(this.expander, "greyedout");',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\taddClass(this.expander, "greyedout");',"\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tif (this.isRoot) {",'\t\t\t\t\t\tthis.contentDiv.innerHTML = "";',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Group(name, isRoot, initiallyExpanded) {","\t\t\t\tthis.name = name;","\t\t\t\tthis.group = null;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.initiallyExpanded = initiallyExpanded;","\t\t\t\tthis.elementContainers = [];","\t\t\t\tthis.children = [];","\t\t\t\tthis.expanded = initiallyExpanded;","\t\t\t\tthis.rendered = false;","\t\t\t\tthis.expandable = false;","\t\t\t}","","\t\t\tGroup.prototype = new LogItem();","","\t\t\tcopyProperties(Group.prototype, {","\t\t\t\taddChild: function(logItem) {","\t\t\t\t\tthis.children.push(logItem);","\t\t\t\t\tlogItem.group = this;","\t\t\t\t},","","\t\t\t\trender: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tvar unwrappedDomContainer, wrappedDomContainer;","\t\t\t\t\t\tif (this.isRoot) {","\t\t\t\t\t\t\tunwrappedDomContainer = logMainContainer;","\t\t\t\t\t\t\twrappedDomContainer = logMainContainer;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tunwrappedDomContainer = this.getUnwrappedDomContainer();","\t\t\t\t\t\t\twrappedDomContainer = this.getWrappedDomContainer();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tvar mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","\t\t\t\t\t\tthis.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tthis.expanded = !this.expanded;","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\texpand: function() {","\t\t\t\t\tif (!this.expanded) {","\t\t\t\t\t\tthis.toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitGroup(this);","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].reverseChildren();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tvar previouslyExpandable = this.expandable;","\t\t\t\t\tthis.expandable = (this.children.length !== 0);","\t\t\t\t\tif (this.expandable !== previouslyExpandable) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].update();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tflatten: function() {","\t\t\t\t\tvar visitor = new GroupFlattener();","\t\t\t\t\tthis.accept(visitor);","\t\t\t\t\treturn visitor.logEntriesAndSeparators;","\t\t\t\t},","","\t\t\t\tremoveChild: function(child, doUpdate) {","\t\t\t\t\tarray_remove(this.children, child);","\t\t\t\t\tchild.group = null;","\t\t\t\t\tif (doUpdate) {","\t\t\t\t\t\tthis.update();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].remove(false, false);","\t\t\t\t\t}","\t\t\t\t\tthis.children = [];","\t\t\t\t\tthis.update();","\t\t\t\t\tif (this === currentGroup) {","\t\t\t\t\t\tcurrentGroup = this.group;","\t\t\t\t\t}","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].serialize(items);","\t\t\t\t\t}","\t\t\t\t\tif (this !== currentGroup) {","\t\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_END]);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clear();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryElementContainer() {","\t\t\t}","","\t\t\tLogEntryElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(LogEntryElementContainer.prototype, {","\t\t\t\tremove: function() {","\t\t\t\t\tthis.doRemove();","\t\t\t\t},","","\t\t\t\tdoRemove: function() {","\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\tthis.contentElement = null;","\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentElement.innerHTML = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {",'\t\t\t\t\tvar oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','\t\t\t\t\tvar newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"\t\t\t\t\treplaceClass(this.mainDiv, newCssClass, oldCssClass);","\t\t\t\t},","","\t\t\t\tclearSearch: function() {",'\t\t\t\t\tremoveClass(this.mainDiv, "searchmatch");','\t\t\t\t\tremoveClass(this.mainDiv, "searchnonmatch");',"\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryWrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");',"\t\t\t\tthis.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"\t\t\t\tthis.contentElement = this.mainDiv;","\t\t\t}","","\t\t\tLogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t} else {","\t\t\t\t\tthis.contentElement.innerHTML = wrappedContent;","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','\t\t\t\tthis.pre = this.mainDiv.appendChild(document.createElement("pre"));',"\t\t\t\tthis.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.pre.className = "unwrapped";',"\t\t\t\tthis.contentElement = this.pre;","\t\t\t}","","\t\t\tLogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryUnwrappedElementContainer.prototype.remove = function() {","\t\t\t\tthis.doRemove();","\t\t\t\tthis.pre = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryMainElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','\t\t\t\tthis.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","\t\t\t}","","\t\t\tLogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntry(level, formattedMessage) {","\t\t\t\tthis.level = level;","\t\t\t\tthis.formattedMessage = formattedMessage;","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tLogEntry.prototype = new LogItem();","","\t\t\tcopyProperties(LogEntry.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar logEntry = this;","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","","\t\t\t\t\t// Support for the CSS attribute white-space in IE for Windows is","\t\t\t\t\t// non-existent pre version 6 and slightly odd in 6, so instead","\t\t\t\t\t// use two different HTML elements","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\tthis.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content != this.content) {","\t\t\t\t\t\tif (isIe && (content !== this.formattedMessage)) {",'\t\t\t\t\t\t\tcontent = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\t}","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].setContent(content, wrappedContent);","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.content = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tgetSearchMatches: function() {","\t\t\t\t\tvar matches = [];","\t\t\t\t\tvar i, len;","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tvar unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','\t\t\t\t\t\tvar wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = unwrappedEls.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tvar els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = els.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, els[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn matches;","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].setSearchMatch(isMatch);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclearSearch: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clearSearch();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitLogEntry(this);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemVisitor() {","\t\t\t}","","\t\t\tLogItemVisitor.prototype = {","\t\t\t\tvisit: function(logItem) {","\t\t\t\t},","","\t\t\t\tvisitParent: function(logItem) {","\t\t\t\t\tif (logItem.group) {","\t\t\t\t\t\tlogItem.group.accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitChildren: function(logItem) {","\t\t\t\t\tfor (var i = 0, len = logItem.children.length; i < len; i++) {","\t\t\t\t\t\tlogItem.children[i].accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitLogEntry: function(logEntry) {","\t\t\t\t\tthis.visit(logEntry);","\t\t\t\t},","","\t\t\t\tvisitSeparator: function(separator) {","\t\t\t\t\tthis.visit(separator);","\t\t\t\t},","","\t\t\t\tvisitGroup: function(group) {","\t\t\t\t\tthis.visit(group);","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupFlattener() {","\t\t\t\tthis.logEntriesAndSeparators = [];","\t\t\t}","","\t\t\tGroupFlattener.prototype = new LogItemVisitor();","","\t\t\tGroupFlattener.prototype.visitGroup = function(group) {","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitLogEntry = function(logEntry) {","\t\t\t\tthis.logEntriesAndSeparators.push(logEntry);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitSeparator = function(separator) {","\t\t\t\tthis.logEntriesAndSeparators.push(separator);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\twindow.onload = function() {","\t\t\t\t// Sort out document.domain","\t\t\t\tif (location.search) {",'\t\t\t\t\tvar queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"\t\t\t\t\tfor (var i = 0, len = queryBits.length; i < len; i++) {",'\t\t\t\t\t\tnameValueBits = queryBits[i].split("=");','\t\t\t\t\t\tif (nameValueBits[0] == "log4javascript_domain") {',"\t\t\t\t\t\t\tdocument.domain = nameValueBits[1];","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","","\t\t\t\t// Create DOM objects",'\t\t\t\tlogMainContainer = $("log");',"\t\t\t\tif (isIePre7) {",'\t\t\t\t\taddClass(logMainContainer, "oldIe");',"\t\t\t\t}","",'\t\t\t\trootGroup = new Group("root", true);',"\t\t\t\trootGroup.render();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\t","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t\ttoggleLoggingEnabled();","\t\t\t\ttoggleSearchEnabled();","\t\t\t\ttoggleSearchFilter();","\t\t\t\ttoggleSearchHighlight();","\t\t\t\tapplyFilters();","\t\t\t\tcheckAllLevels();","\t\t\t\ttoggleWrap();","\t\t\t\ttoggleNewestAtTop();","\t\t\t\ttoggleScrollToLatest();","\t\t\t\trenderQueuedLogItems();","\t\t\t\tloaded = true;",'\t\t\t\t$("command").value = "";','\t\t\t\t$("command").autocomplete = "off";','\t\t\t\t$("command").onkeydown = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","\t\t\t\t\t\tevalCommandLine();","\t\t\t\t\t\tstopPropagation(evt);","\t\t\t\t\t} else if (evt.keyCode == 27) { // Escape",'\t\t\t\t\t\tthis.value = "";',"\t\t\t\t\t\tthis.focus();","\t\t\t\t\t} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","\t\t\t\t\t\tcurrentCommandIndex = Math.max(0, currentCommandIndex - 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","\t\t\t\t\t\tcurrentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keypress moving the caret in Firefox",'\t\t\t\t$("command").onkeypress = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keyup event blurring the input in Opera",'\t\t\t\t$("command").onkeyup = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 27 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t\tthis.focus();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Add document keyboard shortcuts","\t\t\t\tdocument.onkeydown = function keyEventHandler(evt) {","\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tswitch (evt.keyCode) {","\t\t\t\t\t\tcase 69: // Ctrl + shift + E: re-execute last command","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tevalLastCommand();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 75: // Ctrl + shift + K: focus search","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusSearch();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 40: // Ctrl + shift + down arrow: focus command line","\t\t\t\t\t\tcase 76: // Ctrl + shift + L: focus command line","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusCommandLine();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Workaround to make sure log div starts at the correct size","\t\t\t\tsetTimeout(setLogContainerHeight, 20);","","\t\t\t\tsetShowCommandLine(showCommandLine);","\t\t\t\tdoSearch();","\t\t\t};","","\t\t\twindow.onunload = function() {","\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\tappender.unload();","\t\t\t\t}","\t\t\t\tappender = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction toggleLoggingEnabled() {",'\t\t\t\tsetLoggingEnabled($("enableLogging").checked);',"\t\t\t}","","\t\t\tfunction setLoggingEnabled(enable) {","\t\t\t\tloggingEnabled = enable;","\t\t\t}","","\t\t\tvar appender = null;","","\t\t\tfunction setAppender(appenderParam) {","\t\t\t\tappender = appenderParam;","\t\t\t}","","\t\t\tfunction setShowCloseButton(showCloseButton) {",'\t\t\t\t$("closeButton").style.display = showCloseButton ? "inline" : "none";',"\t\t\t}","","\t\t\tfunction setShowHideButton(showHideButton) {",'\t\t\t\t$("hideButton").style.display = showHideButton ? "inline" : "none";',"\t\t\t}","","\t\t\tvar newestAtTop = false;","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContentReverser() {","\t\t\t}","\t\t\t","\t\t\tLogItemContentReverser.prototype = new LogItemVisitor();","\t\t\t","\t\t\tLogItemContentReverser.prototype.visitGroup = function(group) {","\t\t\t\tgroup.reverseChildren();","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction setNewestAtTop(isNewestAtTop) {","\t\t\t\tvar oldNewestAtTop = newestAtTop;","\t\t\t\tvar i, iLen, j, jLen;","\t\t\t\tnewestAtTop = Boolean(isNewestAtTop);","\t\t\t\tif (oldNewestAtTop != newestAtTop) {","\t\t\t\t\tvar visitor = new LogItemContentReverser();","\t\t\t\t\trootGroup.accept(visitor);","","\t\t\t\t\t// Reassemble the matches array","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tvar matchIndex = 0;","\t\t\t\t\t\tvar matches = [];","\t\t\t\t\t\tvar actOnLogEntry = function(logEntry) {","\t\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\t\tfor (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","\t\t\t\t\t\t\t\tmatches[matchIndex] = logEntryMatches[j];","\t\t\t\t\t\t\t\tif (currentMatch && logEntryMatches[j].equals(currentMatch)) {","\t\t\t\t\t\t\t\t\tcurrentMatchIndex = matchIndex;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tmatchIndex++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t};","\t\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\t\tfor (i = logEntries.length - 1; i >= 0; i--) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfor (i = 0, iLen = logEntries.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tcurrentSearch.matches = matches;","\t\t\t\t\t\tif (currentMatch) {","\t\t\t\t\t\t\tcurrentMatch.setCurrent();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (scrollToLatest) {","\t\t\t\t\t\tdoScrollToLatest();","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\t$("newestAtTop").checked = isNewestAtTop;',"\t\t\t}","","\t\t\tfunction toggleNewestAtTop() {",'\t\t\t\tvar isNewestAtTop = $("newestAtTop").checked;',"\t\t\t\tsetNewestAtTop(isNewestAtTop);","\t\t\t}","","\t\t\tvar scrollToLatest = true;","","\t\t\tfunction setScrollToLatest(isScrollToLatest) {","\t\t\t\tscrollToLatest = isScrollToLatest;","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}",'\t\t\t\t$("scrollToLatest").checked = isScrollToLatest;',"\t\t\t}","","\t\t\tfunction toggleScrollToLatest() {",'\t\t\t\tvar isScrollToLatest = $("scrollToLatest").checked;',"\t\t\t\tsetScrollToLatest(isScrollToLatest);","\t\t\t}","","\t\t\tfunction doScrollToLatest() {","\t\t\t\tvar l = logMainContainer;",'\t\t\t\tif (typeof l.scrollTop != "undefined") {',"\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\tl.scrollTop = 0;","\t\t\t\t\t} else {","\t\t\t\t\t\tvar latestLogEntry = l.lastChild;","\t\t\t\t\t\tif (latestLogEntry) {","\t\t\t\t\t\t\tl.scrollTop = l.scrollHeight;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tvar closeIfOpenerCloses = true;","","\t\t\tfunction setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","\t\t\t\tcloseIfOpenerCloses = isCloseIfOpenerCloses;","\t\t\t}","","\t\t\tvar maxMessages = null;","","\t\t\tfunction setMaxMessages(max) {","\t\t\t\tmaxMessages = max;","\t\t\t\tpruneLogEntries();","\t\t\t}","","\t\t\tvar showCommandLine = false;","","\t\t\tfunction setShowCommandLine(isShowCommandLine) {","\t\t\t\tshowCommandLine = isShowCommandLine;","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("commandLine").style.display = showCommandLine ? "block" : "none";',"\t\t\t\t\tsetCommandInputWidth();","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusCommandLine() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("command").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusSearch() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("searchBox").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction getLogItems() {","\t\t\t\tvar items = [];","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tlogItems[i].serialize(items);","\t\t\t\t}","\t\t\t\treturn items;","\t\t\t}","","\t\t\tfunction setLogItems(items) {","\t\t\t\tvar loggingReallyEnabled = loggingEnabled;","\t\t\t\t// Temporarily turn logging on","\t\t\t\tloggingEnabled = true;","\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {","\t\t\t\t\tswitch (items[i][0]) {","\t\t\t\t\t\tcase LogItem.serializedItemKeys.LOG_ENTRY:","\t\t\t\t\t\t\tlog(items[i][1], items[i][2]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_START:","\t\t\t\t\t\t\tgroup(items[i][1]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_END:","\t\t\t\t\t\t\tgroupEnd();","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tloggingEnabled = loggingReallyEnabled;","\t\t\t}","","\t\t\tfunction log(logLevel, formattedMessage) {","\t\t\t\tif (loggingEnabled) {","\t\t\t\t\tvar logEntry = new LogEntry(logLevel, formattedMessage);","\t\t\t\t\tlogEntries.push(logEntry);","\t\t\t\t\tlogEntriesAndSeparators.push(logEntry);","\t\t\t\t\tlogItems.push(logEntry);","\t\t\t\t\tcurrentGroup.addChild(logEntry);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction renderQueuedLogItems() {","\t\t\t\tlogQueuedEventsTimer = null;","\t\t\t\tvar pruned = pruneLogEntries();","","\t\t\t\t// Render any unrendered log entries and apply the current search to them","\t\t\t\tvar initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tif (!logItems[i].rendered) {","\t\t\t\t\t\tlogItems[i].render();","\t\t\t\t\t\tlogItems[i].appendToLog();","\t\t\t\t\t\tif (currentSearch && (logItems[i] instanceof LogEntry)) {","\t\t\t\t\t\t\tcurrentSearch.applyTo(logItems[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (pruned) {","\t\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}","\t\t\t\tunrenderedLogItemsExist = false;","\t\t\t}","","\t\t\tfunction pruneLogEntries() {","\t\t\t\tif ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","\t\t\t\t\tvar numberToDelete = logEntriesAndSeparators.length - maxMessages;","\t\t\t\t\tvar prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tcurrentSearch.removeMatches(prunedLogEntries);","\t\t\t\t\t}","\t\t\t\t\tvar group;","\t\t\t\t\tfor (var i = 0; i < numberToDelete; i++) {","\t\t\t\t\t\tgroup = logEntriesAndSeparators[i].group;","\t\t\t\t\t\tarray_remove(logItems, logEntriesAndSeparators[i]);","\t\t\t\t\t\tarray_remove(logEntries, logEntriesAndSeparators[i]);","\t\t\t\t\t\tlogEntriesAndSeparators[i].remove(true, true);","\t\t\t\t\t\tif (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","\t\t\t\t\t\t\tarray_remove(logItems, group);","\t\t\t\t\t\t\tgroup.remove(true, true);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tlogEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","\t\t\t\t\treturn true;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction group(name, startExpanded) {","\t\t\t\tif (loggingEnabled) {",'\t\t\t\t\tinitiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"\t\t\t\t\tvar newGroup = new Group(name, false, initiallyExpanded);","\t\t\t\t\tcurrentGroup.addChild(newGroup);","\t\t\t\t\tcurrentGroup = newGroup;","\t\t\t\t\tlogItems.push(newGroup);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction groupEnd() {","\t\t\t\tcurrentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","\t\t\t}","","\t\t\tfunction mainPageReloaded() {","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tvar separator = new Separator();","\t\t\t\tlogEntriesAndSeparators.push(separator);","\t\t\t\tlogItems.push(separator);","\t\t\t\tcurrentGroup.addChild(separator);","\t\t\t}","","\t\t\tfunction closeWindow() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.close(true);","\t\t\t\t} else {","\t\t\t\t\twindow.close();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hide() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.hide();","\t\t\t\t}","\t\t\t}","","\t\t\tvar mainWindow = window;",'\t\t\tvar windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","\t\t\tfunction setMainWindow(win) {","\t\t\t\tmainWindow = win;","\t\t\t\tmainWindow[windowId] = window;","\t\t\t\t// If this is a pop-up, poll the opener to see if it's closed","\t\t\t\tif (opener && closeIfOpenerCloses) {","\t\t\t\t\tpollOpener();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction pollOpener() {","\t\t\t\tif (closeIfOpenerCloses) {","\t\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\t\tsetTimeout(pollOpener, 500);","\t\t\t\t\t} else {","\t\t\t\t\t\tcloseWindow();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction mainWindowExists() {","\t\t\t\ttry {","\t\t\t\t\treturn (mainWindow && !mainWindow.closed &&","\t\t\t\t\t\tmainWindow[windowId] == window);","\t\t\t\t} catch (ex) {}","\t\t\t\treturn false;","\t\t\t}","",'\t\t\tvar logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","\t\t\tfunction getCheckBox(logLevel) {",'\t\t\t\treturn $("switch_" + logLevel);',"\t\t\t}","","\t\t\tfunction getIeWrappedLogContainer() {",'\t\t\t\treturn $("log_wrapped");',"\t\t\t}","","\t\t\tfunction getIeUnwrappedLogContainer() {",'\t\t\t\treturn $("log_unwrapped");',"\t\t\t}","","\t\t\tfunction applyFilters() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (getCheckBox(logLevels[i]).checked) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tupdateSearchFromFilters();","\t\t\t}","","\t\t\tfunction toggleAllLevels() {",'\t\t\t\tvar turnOn = $("switch_ALL").checked;',"\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tgetCheckBox(logLevels[i]).checked = turnOn;","\t\t\t\t\tif (turnOn) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction checkAllLevels() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (!getCheckBox(logLevels[i]).checked) {",'\t\t\t\t\t\tgetCheckBox("ALL").checked = false;',"\t\t\t\t\t\treturn;","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\tgetCheckBox("ALL").checked = true;',"\t\t\t}","","\t\t\tfunction clearLog() {","\t\t\t\trootGroup.clear();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tlogEntries = [];","\t\t\t\tlogItems = [];","\t\t\t\tlogEntriesAndSeparators = [];"," \t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction toggleWrap() {",'\t\t\t\tvar enable = $("wrap").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "wrap");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "wrap");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------- */","","\t\t\t// Search","","\t\t\tvar searchTimer = null;","","\t\t\tfunction scheduleSearch() {","\t\t\t\ttry {","\t\t\t\t\tclearTimeout(searchTimer);","\t\t\t\t} catch (ex) {","\t\t\t\t\t// Do nothing","\t\t\t\t}","\t\t\t\tsearchTimer = setTimeout(doSearch, 500);","\t\t\t}","","\t\t\tfunction Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","\t\t\t\tthis.searchTerm = searchTerm;","\t\t\t\tthis.isRegex = isRegex;","\t\t\t\tthis.searchRegex = searchRegex;","\t\t\t\tthis.isCaseSensitive = isCaseSensitive;","\t\t\t\tthis.matches = [];","\t\t\t}","","\t\t\tSearch.prototype = {","\t\t\t\thasMatches: function() {","\t\t\t\t\treturn this.matches.length > 0;","\t\t\t\t},","","\t\t\t\thasVisibleMatches: function() {","\t\t\t\t\tif (this.hasMatches()) {","\t\t\t\t\t\tfor (var i = 0; i < this.matches.length; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn false;","\t\t\t\t},","","\t\t\t\tmatch: function(logEntry) {","\t\t\t\t\tvar entryText = String(logEntry.formattedMessage);","\t\t\t\t\tvar matchesSearch = false;","\t\t\t\t\tif (this.isRegex) {","\t\t\t\t\t\tmatchesSearch = this.searchRegex.test(entryText);","\t\t\t\t\t} else if (this.isCaseSensitive) {","\t\t\t\t\t\tmatchesSearch = (entryText.indexOf(this.searchTerm) > -1);","\t\t\t\t\t} else {","\t\t\t\t\t\tmatchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","\t\t\t\t\t}","\t\t\t\t\treturn matchesSearch;","\t\t\t\t},","","\t\t\t\tgetNextVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the first match","\t\t\t\t\tfor (i = 0; i <= currentMatchIndex; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tgetPreviousVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex - 1; i >= 0; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the last match","\t\t\t\t\tfor (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tapplyTo: function(logEntry) {","\t\t\t\t\tvar doesMatch = this.match(logEntry);","\t\t\t\t\tif (doesMatch) {","\t\t\t\t\t\tlogEntry.group.expand();","\t\t\t\t\t\tlogEntry.setSearchMatch(true);","\t\t\t\t\t\tvar logEntryContent;","\t\t\t\t\t\tvar wrappedLogEntryContent;",'\t\t\t\t\t\tvar searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','\t\t\t\t\t\tvar searchTermReplacementEndTag = "<" + "/span>";','\t\t\t\t\t\tvar preTagName = isIe ? "pre" : "span";','\t\t\t\t\t\tvar preStartTag = "<" + preTagName + " class=\\"pre\\">";','\t\t\t\t\t\tvar preEndTag = "<" + "/" + preTagName + ">";',"\t\t\t\t\t\tvar startIndex = 0;","\t\t\t\t\t\tvar searchIndex, matchedText, textBeforeMatch;","\t\t\t\t\t\tif (this.isRegex) {",'\t\t\t\t\t\t\tvar flags = this.isCaseSensitive ? "g" : "gi";','\t\t\t\t\t\t\tvar capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","\t\t\t\t\t\t\t// Replace the search term with temporary tokens for the start and end tags",'\t\t\t\t\t\t\tvar rnd = ("" + Math.random()).substr(2);','\t\t\t\t\t\t\tvar startToken = "%%s" + rnd + "%%";','\t\t\t\t\t\t\tvar endToken = "%%e" + rnd + "%%";','\t\t\t\t\t\t\tlogEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","\t\t\t\t\t\t\t// Escape the HTML to get rid of angle brackets","\t\t\t\t\t\t\tlogEntryContent = escapeHtml(logEntryContent);","","\t\t\t\t\t\t\t// Substitute the proper HTML back in for the search match","\t\t\t\t\t\t\tvar result;","\t\t\t\t\t\t\tvar searchString = logEntryContent;",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\twhile ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","\t\t\t\t\t\t\t\tvar endTokenIndex = searchString.indexOf(endToken, searchIndex);","\t\t\t\t\t\t\t\tmatchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","\t\t\t\t\t\t\t\ttextBeforeMatch = searchString.substring(startIndex, searchIndex);","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","\t\t\t\t\t\t\t\t\tpreEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = endTokenIndex + endToken.length;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tlogEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += searchString.substr(startIndex);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\tvar searchTermReplacementLength = searchTermReplacementStartTag.length +","\t\t\t\t\t\t\t\tthis.searchTerm.length + searchTermReplacementEndTag.length;","\t\t\t\t\t\t\tvar searchTermLength = this.searchTerm.length;","\t\t\t\t\t\t\tvar searchTermLowerCase = this.searchTerm.toLowerCase();","\t\t\t\t\t\t\tvar logTextLowerCase = logEntry.formattedMessage.toLowerCase();","\t\t\t\t\t\t\twhile ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","\t\t\t\t\t\t\t\tmatchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","\t\t\t\t\t\t\t\ttextBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","\t\t\t\t\t\t\t\tvar searchTermReplacement = searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\tpreStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = searchIndex + searchTermLength;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","\t\t\t\t\t\t\tlogEntryContent += preStartTag + textAfterLastMatch + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += textAfterLastMatch;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tlogEntry.setContent(logEntryContent, wrappedLogEntryContent);","\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\tthis.matches = this.matches.concat(logEntryMatches);","\t\t\t\t\t} else {","\t\t\t\t\t\tlogEntry.setSearchMatch(false);","\t\t\t\t\t\tlogEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","\t\t\t\t\t}","\t\t\t\t\treturn doesMatch;","\t\t\t\t},","","\t\t\t\tremoveMatches: function(logEntries) {","\t\t\t\t\tvar matchesToRemoveCount = 0;","\t\t\t\t\tvar currentMatchRemoved = false;","\t\t\t\t\tvar matchesToRemove = [];","\t\t\t\t\tvar i, iLen, j, jLen;","","\t\t\t\t\t// Establish the list of matches to be removed","\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\tfor (j = 0, jLen = logEntries.length; j < jLen; j++) {","\t\t\t\t\t\t\tif (this.matches[i].belongsTo(logEntries[j])) {","\t\t\t\t\t\t\t\tmatchesToRemove.push(this.matches[i]);","\t\t\t\t\t\t\t\tif (i === currentMatchIndex) {","\t\t\t\t\t\t\t\t\tcurrentMatchRemoved = true;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Set the new current match index if the current match has been deleted","\t\t\t\t\t// This will be the first match that appears after the first log entry being","\t\t\t\t\t// deleted, if one exists; otherwise, it's the first match overall","\t\t\t\t\tvar newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","\t\t\t\t\tif (currentMatchRemoved) {","\t\t\t\t\t\tfor (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","\t\t\t\t\t\t\t\tnewMatch = this.matches[i];","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Remove the matches","\t\t\t\t\tfor (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","\t\t\t\t\t\tarray_remove(this.matches, matchesToRemove[i]);","\t\t\t\t\t\tmatchesToRemove[i].remove();","\t\t\t\t\t}","","\t\t\t\t\t// Set the new match, if one exists","\t\t\t\t\tif (this.hasVisibleMatches()) {","\t\t\t\t\t\tif (newMatch === null) {","\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t// Get the index of the new match","\t\t\t\t\t\t\tvar newMatchIndex = 0;","\t\t\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tif (newMatch === this.matches[i]) {","\t\t\t\t\t\t\t\t\tnewMatchIndex = i;","\t\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tsetCurrentMatchIndex(newMatchIndex);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tcurrentMatchIndex = null;","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tfunction getPageOffsetTop(el, container) {","\t\t\t\tvar currentEl = el;","\t\t\t\tvar y = 0;","\t\t\t\twhile (currentEl && currentEl != container) {","\t\t\t\t\ty += currentEl.offsetTop;","\t\t\t\t\tcurrentEl = currentEl.offsetParent;","\t\t\t\t}","\t\t\t\treturn y;","\t\t\t}","","\t\t\tfunction scrollIntoView(el) {","\t\t\t\tvar logContainer = logMainContainer;","\t\t\t\t// Check if the whole width of the element is visible and centre if not",'\t\t\t\tif (!$("wrap").checked) {',"\t\t\t\t\tvar logContainerLeft = logContainer.scrollLeft;","\t\t\t\t\tvar logContainerRight = logContainerLeft  + logContainer.offsetWidth;","\t\t\t\t\tvar elLeft = el.offsetLeft;","\t\t\t\t\tvar elRight = elLeft + el.offsetWidth;","\t\t\t\t\tif (elLeft < logContainerLeft || elRight > logContainerRight) {","\t\t\t\t\t\tlogContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Check if the whole height of the element is visible and centre if not","\t\t\t\tvar logContainerTop = logContainer.scrollTop;","\t\t\t\tvar logContainerBottom = logContainerTop  + logContainer.offsetHeight;","\t\t\t\tvar elTop = getPageOffsetTop(el) - getToolBarsHeight();","\t\t\t\tvar elBottom = elTop + el.offsetHeight;","\t\t\t\tif (elTop < logContainerTop || elBottom > logContainerBottom) {","\t\t\t\t\tlogContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","\t\t\t\tthis.logEntryLevel = logEntryLevel;","\t\t\t\tthis.spanInMainDiv = spanInMainDiv;","\t\t\t\tif (isIe) {","\t\t\t\t\tthis.spanInUnwrappedPre = spanInUnwrappedPre;","\t\t\t\t\tthis.spanInWrappedDiv = spanInWrappedDiv;","\t\t\t\t}","\t\t\t\tthis.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","\t\t\t}","","\t\t\tMatch.prototype = {","\t\t\t\tequals: function(match) {","\t\t\t\t\treturn this.mainSpan === match.mainSpan;","\t\t\t\t},","","\t\t\t\tsetCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\taddClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\taddClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t\t// Scroll the visible one into view",'\t\t\t\t\t\tvar elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"\t\t\t\t\t\tscrollIntoView(elementToScroll);","\t\t\t\t\t} else {",'\t\t\t\t\t\taddClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t\tscrollIntoView(this.spanInMainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tbelongsTo: function(logEntry) {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\treturn isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn isDescendant(this.spanInMainDiv, logEntry.mainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetNotCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tremoveClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\tremoveClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tisOrphan: function() {","\t\t\t\t\treturn isOrphan(this.mainSpan);","\t\t\t\t},","","\t\t\t\tisVisible: function() {","\t\t\t\t\treturn getCheckBox(this.logEntryLevel).checked;","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.spanInUnwrappedPre = null;","\t\t\t\t\t\tthis.spanInWrappedDiv = null;","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.spanInMainDiv = null;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tvar currentSearch = null;","\t\t\tvar currentMatchIndex = null;","","\t\t\tfunction doSearch() {",'\t\t\t\tvar searchBox = $("searchBox");',"\t\t\t\tvar searchTerm = searchBox.value;",'\t\t\t\tvar isRegex = $("searchRegex").checked;','\t\t\t\tvar isCaseSensitive = $("searchCaseSensitive").checked;',"\t\t\t\tvar i;","",'\t\t\t\tif (searchTerm === "") {','\t\t\t\t\t$("searchReset").disabled = true;','\t\t\t\t\t$("searchNav").style.display = "none";','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(searchBox, "hasmatches");','\t\t\t\t\tremoveClass(searchBox, "nomatches");',"\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tlogEntries[i].clearSearch();","\t\t\t\t\t\tlogEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","\t\t\t\t\t}","\t\t\t\t\tcurrentSearch = null;","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t} else {",'\t\t\t\t\t$("searchReset").disabled = false;','\t\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\t\tvar searchRegex;","\t\t\t\t\tvar regexValid;","\t\t\t\t\tif (isRegex) {","\t\t\t\t\t\ttry {",'\t\t\t\t\t\t\tsearchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"\t\t\t\t\t\t\tregexValid = true;",'\t\t\t\t\t\t\treplaceClass(searchBox, "validregex", "invalidregex");','\t\t\t\t\t\t\tsearchBox.title = "Valid regex";',"\t\t\t\t\t\t} catch (ex) {","\t\t\t\t\t\t\tregexValid = false;",'\t\t\t\t\t\t\treplaceClass(searchBox, "invalidregex", "validregex");','\t\t\t\t\t\t\tsearchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tsearchBox.title = "";','\t\t\t\t\t\tremoveClass(searchBox, "validregex");','\t\t\t\t\t\tremoveClass(searchBox, "invalidregex");',"\t\t\t\t\t}",'\t\t\t\t\taddClass(document.body, "searching");',"\t\t\t\t\tcurrentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tcurrentSearch.applyTo(logEntries[i]);","\t\t\t\t\t}","\t\t\t\t\tsetLogContainerHeight();","","\t\t\t\t\t// Highlight the first search match","\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction updateSearchFromFilters() {","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (currentSearch.hasMatches()) {","\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\tcurrentMatchIndex = 0;","\t\t\t\t\t\t}","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tif (currentMatch.isVisible()) {","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tcurrentMatch.setNotCurrent();","\t\t\t\t\t\t\t// Find the next visible match, if one exists","\t\t\t\t\t\t\tvar nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","\t\t\t\t\t\t\tif (nextVisibleMatchIndex > -1) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(nextVisibleMatchIndex);","\t\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction refreshCurrentMatch() {","\t\t\t\tif (currentSearch && currentSearch.hasVisibleMatches()) {","\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t}","\t\t\t}","","\t\t\tfunction displayMatches() {",'\t\t\t\treplaceClass($("searchBox"), "hasmatches", "nomatches");','\t\t\t\t$("searchBox").title = "" + currentSearch.matches.length + " matches found";','\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction displayNoMatches() {",'\t\t\t\treplaceClass($("searchBox"), "nomatches", "hasmatches");','\t\t\t\t$("searchBox").title = "No matches found";','\t\t\t\t$("searchNav").style.display = "none";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchEnabled(enable) {",'\t\t\t\tenable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','\t\t\t\t$("searchBox").disabled = !enable;','\t\t\t\t$("searchReset").disabled = !enable;','\t\t\t\t$("searchRegex").disabled = !enable;','\t\t\t\t$("searchNext").disabled = !enable;','\t\t\t\t$("searchPrevious").disabled = !enable;','\t\t\t\t$("searchCaseSensitive").disabled = !enable;','\t\t\t\t$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"\t\t\t\t\t\tcurrentSearch && currentSearch.hasVisibleMatches()) ?",'\t\t\t\t\t"block" : "none";',"\t\t\t\tif (enable) {",'\t\t\t\t\tremoveClass($("search"), "greyedout");','\t\t\t\t\taddClass(document.body, "searching");','\t\t\t\t\tif ($("searchHighlight").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t}",'\t\t\t\t\tif ($("searchFilter").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t\t}",'\t\t\t\t\t$("searchDisable").checked = !enable;',"\t\t\t\t} else {",'\t\t\t\t\taddClass($("search"), "greyedout");','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");','\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchFilter() {",'\t\t\t\tvar enable = $("searchFilter").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\tfunction toggleSearchHighlight() {",'\t\t\t\tvar enable = $("searchHighlight").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction clearSearch() {",'\t\t\t\t$("searchBox").value = "";',"\t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction searchNext() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'\t\t\t\t\tif (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(nextMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction searchPrevious() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'\t\t\t\t\tif (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(previousMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCurrentMatchIndex(index) {","\t\t\t\tcurrentMatchIndex = index;","\t\t\t\tcurrentSearch.matches[currentMatchIndex].setCurrent();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// CSS Utilities","","\t\t\tfunction addClass(el, cssClass) {","\t\t\t\tif (!hasClass(el, cssClass)) {","\t\t\t\t\tif (el.className) {",'\t\t\t\t\t\tel.className += " " + cssClass;',"\t\t\t\t\t} else {","\t\t\t\t\t\tel.className = cssClass;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hasClass(el, cssClass) {","\t\t\t\tif (el.className) {",'\t\t\t\t\tvar classNames = el.className.split(" ");',"\t\t\t\t\treturn array_contains(classNames, cssClass);","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction removeClass(el, cssClass) {","\t\t\t\tif (hasClass(el, cssClass)) {","\t\t\t\t\t// Rebuild the className property",'\t\t\t\t\tvar existingClasses = el.className.split(" ");',"\t\t\t\t\tvar newClasses = [];","\t\t\t\t\tfor (var i = 0, len = existingClasses.length; i < len; i++) {","\t\t\t\t\t\tif (existingClasses[i] != cssClass) {","\t\t\t\t\t\t\tnewClasses[newClasses.length] = existingClasses[i];","\t\t\t\t\t\t}","\t\t\t\t\t}",'\t\t\t\t\tel.className = newClasses.join(" ");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction replaceClass(el, newCssClass, oldCssClass) {","\t\t\t\tremoveClass(el, oldCssClass);","\t\t\t\taddClass(el, newCssClass);","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// Other utility functions","","\t\t\tfunction getElementsByClass(el, cssClass, tagName) {","\t\t\t\tvar elements = el.getElementsByTagName(tagName);","\t\t\t\tvar matches = [];","\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {","\t\t\t\t\tif (hasClass(elements[i], cssClass)) {","\t\t\t\t\t\tmatches.push(elements[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn matches;","\t\t\t}","","\t\t\t// Syntax borrowed from Prototype library","\t\t\tfunction $(id) {","\t\t\t\treturn document.getElementById(id);","\t\t\t}","","\t\t\tfunction isDescendant(node, ancestorNode) {","\t\t\t\twhile (node != null) {","\t\t\t\t\tif (node === ancestorNode) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t\tnode = node.parentNode;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction isOrphan(node) {","\t\t\t\tvar currentNode = node;","\t\t\t\twhile (currentNode) {","\t\t\t\t\tif (currentNode == document.body) {","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","\t\t\t\t\tcurrentNode = currentNode.parentNode;","\t\t\t\t}","\t\t\t\treturn true;","\t\t\t}","","\t\t\tfunction escapeHtml(str) {",'\t\t\t\treturn str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"\t\t\t}","","\t\t\tfunction getWindowWidth() {","\t\t\t\tif (window.innerWidth) {","\t\t\t\t\treturn window.innerWidth;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientWidth) {","\t\t\t\t\treturn document.documentElement.clientWidth;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientWidth;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getWindowHeight() {","\t\t\t\tif (window.innerHeight) {","\t\t\t\t\treturn window.innerHeight;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientHeight) {","\t\t\t\t\treturn document.documentElement.clientHeight;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientHeight;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getToolBarsHeight() {",'\t\t\t\treturn $("switches").offsetHeight;',"\t\t\t}","","\t\t\tfunction getChromeHeight() {","\t\t\t\tvar height = getToolBarsHeight();","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\theight += $("commandLine").offsetHeight;',"\t\t\t\t}","\t\t\t\treturn height;","\t\t\t}","","\t\t\tfunction setLogContainerHeight() {","\t\t\t\tif (logMainContainer) {","\t\t\t\t\tvar windowHeight = getWindowHeight();",'\t\t\t\t\t$("body").style.height = getWindowHeight() + "px";','\t\t\t\t\tlogMainContainer.style.height = "" +','\t\t\t\t\t\tMath.max(0, windowHeight - getChromeHeight()) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCommandInputWidth() {","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\t$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','\t\t\t\t\t\t($("evaluateButton").offsetWidth + 13)) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\twindow.onresize = function() {","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t};","","\t\t\tif (!Array.prototype.push) {","\t\t\t\tArray.prototype.push = function() {","\t\t\t        for (var i = 0, len = arguments.length; i < len; i++){","\t\t\t            this[this.length] = arguments[i];","\t\t\t        }","\t\t\t        return this.length;","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.pop) {","\t\t\t\tArray.prototype.pop = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar val = this[this.length - 1];","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn val;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.shift) {","\t\t\t\tArray.prototype.shift = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar firstItem = this[0];","\t\t\t\t\t\tfor (var i = 0, len = this.length - 1; i < len; i++) {","\t\t\t\t\t\t\tthis[i] = this[i + 1];","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn firstItem;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.splice) {","\t\t\t\tArray.prototype.splice = function(startIndex, deleteCount) {","\t\t\t\t\tvar itemsAfterDeleted = this.slice(startIndex + deleteCount);","\t\t\t\t\tvar itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","\t\t\t\t\tthis.length = startIndex;","\t\t\t\t\t// Copy the arguments into a proper Array object","\t\t\t\t\tvar argumentsArray = [];","\t\t\t\t\tfor (var i = 0, len = arguments.length; i < len; i++) {","\t\t\t\t\t\targumentsArray[i] = arguments[i];","\t\t\t\t\t}","\t\t\t\t\tvar itemsToAppend = (argumentsArray.length > 2) ?","\t\t\t\t\t\titemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","\t\t\t\t\tfor (i = 0, len = itemsToAppend.length; i < len; i++) {","\t\t\t\t\t\tthis.push(itemsToAppend[i]);","\t\t\t\t\t}","\t\t\t\t\treturn itemsDeleted;","\t\t\t\t};","\t\t\t}","","\t\t\tfunction array_remove(arr, val) {","\t\t\t\tvar index = -1;","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] === val) {","\t\t\t\t\t\tindex = i;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (index >= 0) {","\t\t\t\t\tarr.splice(index, 1);","\t\t\t\t\treturn index;","\t\t\t\t} else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction array_removeFromStart(array, numberToRemove) {","\t\t\t\tif (Array.prototype.splice) {","\t\t\t\t\tarray.splice(0, numberToRemove);","\t\t\t\t} else {","\t\t\t\t\tfor (var i = numberToRemove, len = array.length; i < len; i++) {","\t\t\t\t\t\tarray[i - numberToRemove] = array[i];","\t\t\t\t\t}","\t\t\t\t\tarray.length = array.length - numberToRemove;","\t\t\t\t}","\t\t\t\treturn array;","\t\t\t}","","\t\t\tfunction array_contains(arr, val) {","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] == val) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction getErrorMessage(ex) {","\t\t\t\tif (ex.message) {","\t\t\t\t\treturn ex.message;","\t\t\t\t} else if (ex.description) {","\t\t\t\t\treturn ex.description;","\t\t\t\t}",'\t\t\t\treturn "" + ex;',"\t\t\t}","","\t\t\tfunction moveCaretToEnd(input) {","\t\t\t\tif (input.setSelectionRange) {","\t\t\t\t\tinput.focus();","\t\t\t\t\tvar length = input.value.length;","\t\t\t\t\tinput.setSelectionRange(length, length);","\t\t\t\t} else if (input.createTextRange) {","\t\t\t\t\tvar range = input.createTextRange();","\t\t\t\t\trange.collapse(false);","\t\t\t\t\trange.select();","\t\t\t\t}","\t\t\t\tinput.focus();","\t\t\t}","","\t\t\tfunction stopPropagation(evt) {","\t\t\t\tif (evt.stopPropagation) {","\t\t\t\t\tevt.stopPropagation();",'\t\t\t\t} else if (typeof evt.cancelBubble != "undefined") {',"\t\t\t\t\tevt.cancelBubble = true;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction getEvent(evt) {","\t\t\t\treturn evt ? evt : event;","\t\t\t}","","\t\t\tfunction getTarget(evt) {","\t\t\t\treturn evt.target ? evt.target : evt.srcElement;","\t\t\t}","","\t\t\tfunction getRelatedTarget(evt) {","\t\t\t\tif (evt.relatedTarget) {","\t\t\t\t\treturn evt.relatedTarget;","\t\t\t\t} else if (evt.srcElement) {","\t\t\t\t\tswitch(evt.type) {",'\t\t\t\t\t\tcase "mouseover":',"\t\t\t\t\t\t\treturn evt.fromElement;",'\t\t\t\t\t\tcase "mouseout":',"\t\t\t\t\t\t\treturn evt.toElement;","\t\t\t\t\t\tdefault:","\t\t\t\t\t\t\treturn evt.srcElement;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction cancelKeyEvent(evt) {","\t\t\t\tevt.returnValue = false;","\t\t\t\tstopPropagation(evt);","\t\t\t}","","\t\t\tfunction evalCommandLine() {",'\t\t\t\tvar expr = $("command").value;',"\t\t\t\tevalCommand(expr);",'\t\t\t\t$("command").value = "";',"\t\t\t}","","\t\t\tfunction evalLastCommand() {","\t\t\t\tif (lastCommand != null) {","\t\t\t\t\tevalCommand(lastCommand);","\t\t\t\t}","\t\t\t}","","\t\t\tvar lastCommand = null;","\t\t\tvar commandHistory = [];","\t\t\tvar currentCommandIndex = 0;","","\t\t\tfunction evalCommand(expr) {","\t\t\t\tif (appender) {","\t\t\t\t\tappender.evalCommandAndAppend(expr);","\t\t\t\t} else {",'\t\t\t\t\tvar prefix = ">>> " + expr + "\\r\\n";',"\t\t\t\t\ttry {",'\t\t\t\t\t\tlog("INFO", prefix + eval(expr));',"\t\t\t\t\t} catch (ex) {",'\t\t\t\t\t\tlog("ERROR", prefix + "Error: " + getErrorMessage(ex));',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Update command history","\t\t\t\tif (expr != commandHistory[commandHistory.length - 1]) {","\t\t\t\t\tcommandHistory.push(expr);","\t\t\t\t\t// Update the appender","\t\t\t\t\tif (appender) {","\t\t\t\t\t\tappender.storeCommandHistory(commandHistory);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tcurrentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","\t\t\t\tlastCommand = expr;","\t\t\t}","\t\t\t//]]>","\t\t<\/script>",'\t\t<style type="text/css">',"\t\t\tbody {","\t\t\t\tbackground-color: white;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0;","\t\t\t\tmargin: 0;","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t\toverflow: hidden;","\t\t\t}","","\t\t\tdiv#switchesContainer input {","\t\t\t\tmargin-bottom: 0;","\t\t\t}","","\t\t\tdiv.toolbar {","\t\t\t\tborder-top: solid #ffffff 1px;","\t\t\t\tborder-bottom: solid #aca899 1px;","\t\t\t\tbackground-color: #f1efe7;","\t\t\t\tpadding: 3px 5px;","\t\t\t\tfont-size: 68.75%;","\t\t\t}","","\t\t\tdiv.toolbar, div#search input {","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t}","","\t\t\tdiv.toolbar input.button {","\t\t\t\tpadding: 0 5px;","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv.toolbar input.hidden {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#switches input#clearButton {","\t\t\t\tmargin-left: 20px;","\t\t\t}","","\t\t\tdiv#levels label {","\t\t\t\tfont-weight: bold;","\t\t\t}","","\t\t\tdiv#levels label, div#options label {","\t\t\t\tmargin-right: 5px;","\t\t\t}","","\t\t\tdiv#levels label#wrapLabel {","\t\t\t\tfont-weight: normal;","\t\t\t}","","\t\t\tdiv#search label {","\t\t\t\tmargin-right: 10px;","\t\t\t}","","\t\t\tdiv#search label.searchboxlabel {","\t\t\t\tmargin-right: 0;","\t\t\t}","","\t\t\tdiv#search input {","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv#search input.validregex {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#search input.invalidregex {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#searchNav {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine input#command {","\t\t\t\tfont-size: 100%;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t}","","\t\t\tdiv#commandLine input#evaluateButton {","\t\t\t}","","\t\t\t*.greyedout {","\t\t\t\tcolor: gray !important;","\t\t\t\tborder-color: gray !important;","\t\t\t}","","\t\t\t*.greyedout *.alwaysenabled { color: black; }","","\t\t\t*.unselectable {","\t\t\t\t-khtml-user-select: none;","\t\t\t\t-moz-user-select: none;","\t\t\t\tuser-select: none;","\t\t\t}","","\t\t\tdiv#log {","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 75%;","\t\t\t\twidth: 100%;","\t\t\t\toverflow: auto;","\t\t\t\tclear: both;","\t\t\t\tposition: relative;","\t\t\t}","","\t\t\tdiv.group {","\t\t\t\tborder-color: #cccccc;","\t\t\t\tborder-style: solid;","\t\t\t\tborder-width: 1px 0 1px 1px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupheading span.expander {","\t\t\t\tborder: solid black 1px;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 0.833em;","\t\t\t\tbackground-color: #eeeeee;","\t\t\t\tposition: relative;","\t\t\t\ttop: -1px;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0 2px;","\t\t\t\tcursor: pointer;","\t\t\t\tcursor: hand;","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupcontent {","\t\t\t\tmargin-left: 10px;","\t\t\t\tpadding-bottom: 2px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.group div.expanded {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.group div.collapsed {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\t*.logentry {","\t\t\t\toverflow: visible;","\t\t\t\tdisplay: none;","\t\t\t\twhite-space: pre;","\t\t\t}","","\t\t\tspan.pre {","\t\t\t\twhite-space: pre;","\t\t\t}","\t\t\t","\t\t\tpre.unwrapped {","\t\t\t\tdisplay: inline !important;","\t\t\t}","","\t\t\tpre.unwrapped pre.pre, div.wrapped pre.pre {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.wrapped pre.pre {","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tbody.searching *.logentry span.currentmatch {","\t\t\t\tcolor: white !important;","\t\t\t\tbackground-color: green !important;","\t\t\t}","","\t\t\tbody.searching div.searchhighlight *.logentry span.searchterm {","\t\t\t\tcolor: black;","\t\t\t\tbackground-color: yellow;","\t\t\t}","","\t\t\tdiv.wrap *.logentry {","\t\t\t\twhite-space: normal !important;","\t\t\t\tborder-width: 0 0 1px 0;","\t\t\t\tborder-color: #dddddd;","\t\t\t\tborder-style: dotted;","\t\t\t}","","\t\t\tdiv.wrap #log_wrapped, #log_unwrapped {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.wrap #log_unwrapped, #log_wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.pre {","\t\t\t\toverflow: visible;","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrap *.logentry pre.unwrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.wrapped {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.searchfilter *.searchnonmatch {","\t\t\t\tdisplay: none !important;","\t\t\t}","","\t\t\tdiv#log *.TRACE, label#label_TRACE {","\t\t\t\tcolor: #666666;","\t\t\t}","","\t\t\tdiv#log *.DEBUG, label#label_DEBUG {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#log *.INFO, label#label_INFO {","\t\t\t\tcolor: #000099;","\t\t\t}","","\t\t\tdiv#log *.WARN, label#label_WARN {","\t\t\t\tcolor: #999900;","\t\t\t}","","\t\t\tdiv#log *.ERROR, label#label_ERROR {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#log *.FATAL, label#label_FATAL {","\t\t\t\tcolor: #660066;","\t\t\t}","","\t\t\tdiv.TRACE#log *.TRACE,","\t\t\tdiv.DEBUG#log *.DEBUG,","\t\t\tdiv.INFO#log *.INFO,","\t\t\tdiv.WARN#log *.WARN,","\t\t\tdiv.ERROR#log *.ERROR,","\t\t\tdiv.FATAL#log *.FATAL {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv#log div.separator {","\t\t\t\tbackground-color: #cccccc;","\t\t\t\tmargin: 5px 0;","\t\t\t\tline-height: 1px;","\t\t\t}","\t\t</style>","\t</head>","",'\t<body id="body">','\t\t<div id="switchesContainer">','\t\t\t<div id="switches">','\t\t\t\t<div id="levels" class="toolbar">',"\t\t\t\t\tFilters:",'\t\t\t\t\t<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','\t\t\t\t\t<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','\t\t\t\t\t<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','\t\t\t\t\t<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','\t\t\t\t\t<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','\t\t\t\t\t<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','\t\t\t\t\t<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"\t\t\t\t</div>",'\t\t\t\t<div id="search" class="toolbar">','\t\t\t\t\t<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','\t\t\t\t\t<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','\t\t\t\t\t<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','\t\t\t\t\t<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','\t\t\t\t\t<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','\t\t\t\t\t<div id="searchNav">','\t\t\t\t\t\t<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','\t\t\t\t\t\t<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','\t\t\t\t\t\t<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','\t\t\t\t\t\t<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"\t\t\t\t\t</div>","\t\t\t\t</div>",'\t\t\t\t<div id="options" class="toolbar">',"\t\t\t\t\tOptions:",'\t\t\t\t\t<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','\t\t\t\t\t<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','\t\t\t\t\t<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','\t\t\t\t\t<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','\t\t\t\t\t<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','\t\t\t\t\t<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','\t\t\t\t\t<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>",'\t\t<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','\t\t<div id="commandLine" class="toolbar">','\t\t\t<div id="commandLineContainer">','\t\t\t\t<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','\t\t\t\t<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"\t\t\t</div>","\t\t</div>","\t</body>","</html>",""];e.open();for(var r=0,n=t.length;r<n;r++)e.writeln(t[r]);e.close()}),J=(this.setEventTypes(["load","unload"]),function(){var e=c(),t=(e.setAppender(p),e.setNewestAtTop(v),e.setScrollToLatest(b),e.setMaxMessages(_),e.setShowCommandLine(S),e.setShowHideButton(E),e.setShowCloseButton(I),e.setMainWindow(window),getCookie(K));t&&(e.commandHistory=t.split(","),e.currentCommandIndex=e.commandHistory.length),p.dispatchEvent("load",{win:e})}),Q=(this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),m||(logLog.debug("really doing unload "+this),h=f=!(m=!0),p.dispatchEvent("unload",{}))},function(e,t,r,n){var o=setInterval(function(){try{m&&clearInterval(o),e(c())&&(clearInterval(o),r())}catch(e){clearInterval(o),y=!1,handleError(n,e)}},t)}),Z=function(){var e=document.domain!=location.hostname;return d?"":getBaseUrl()+"console_uncompressed.html"+(e?"?log4javascript_domain="+escape(document.domain):"")},$=H?(C=null,R=[],W=!(this.addCssProperty=function(e,t){r("cssProperties")&&R.push([e,t])}),k=uniqueId+"_InPageAppender_"+B,this.hide=function(){a&&h&&(n()&&c().$("command").blur(),P.style.display="none",T=!0)},this.show=function(){a&&(h?(P.style.display="block",this.setShowCommandLine(S),T=!1):W||e(!0))},this.isVisible=function(){return!T&&!m},this.close=function(e){m||e&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(P.parentNode.removeChild(P),this.unload())},i=function(){var t="InPageAppender.open: unable to create console iframe";function r(){try{s||p.show(),J(),f=!0,z()}catch(e){y=!1,handleError(t,e)}}function e(){try{function e(e){return isLoaded(e)}d&&X(c().document),e(c())?r():Q(e,100,r,t)}catch(e){y=!1,handleError(t,e)}}T=!1,(P=C.appendChild(document.createElement("div"))).style.width=l,P.style.height=u,P.style.border="solid gray 1px";for(var n=0,o=R.length;n<o;n++)P.style[R[n][0]]=R[n][1];function i(e){try{return bool(e)&&bool(e.document)}catch(e){return!1}}var a=d?"":" src='"+Z()+"'";P.innerHTML="<iframe id='"+k+"' name='"+k+"' width='100%' height='100%' frameborder='0'"+a+" scrolling='no'></iframe>",m=!1;i(c())?e():Q(i,100,e,t),h=!0},e=function(e){!e&&s||(e=function(){if(t)try{var e=document.getElementById(t);1==e.nodeType&&(C=e),i()}catch(e){handleError("InPageAppender.init: invalid container element '"+t+"' supplied",e)}else(C=document.createElement("div")).style.position="fixed",C.style.left="0",C.style.right="0",C.style.bottom="0",document.body.appendChild(C),p.addCssProperty("borderWidth","1px 0 0 0"),p.addCssProperty("zIndex",1e6),i()},pageLoaded&&t&&t.appendChild?(C=t,i()):pageLoaded?e():log4javascript.addEventListener("load",e),W=!0)},o=function(){e(),a=!0},c=function(){var e=window.frames[k];if(e)return e},function(){return!(!y||m)&&(f=!(!h||f||!c()||!isLoaded(c()))||f)}):(x=p.defaults.useOldPopUp,M=p.defaults.complainAboutPopUpBlocking,A=this.defaults.reopenWhenClosed,this.isUseOldPopUp=function(){return x},this.setUseOldPopUp=function(e){r("useOldPopUp")&&(x=bool(e))},this.isComplainAboutPopUpBlocking=function(){return M},this.setComplainAboutPopUpBlocking=function(e){r("complainAboutPopUpBlocking")&&(M=bool(e))},this.isFocusPopUp=function(){return N},this.setFocusPopUp=function(e){N=bool(e)},this.isReopenWhenClosed=function(){return A},this.setReopenWhenClosed=function(e){A=bool(e)},this.close=function(){logLog.debug("close "+this);try{O.close(),this.unload()}catch(e){}},this.hide=function(){logLog.debug("hide "+this),n()&&this.close()},this.show=function(){logLog.debug("show "+this),h||i()},this.isVisible=function(){return $()},i=function(){var e="width="+l+",height="+u+",status,resizable",t="";try{var r=window.frameElement;r&&(t="_"+r.tagName+"_"+(r.name||r.id||""))}catch(e){t="_inaccessibleParentFrame"}function n(e){if(m)return!0;try{return bool(e)&&e.closed}catch(e){}return!1}function o(){m||p.unload()}r="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+B+t;x&&d||(r=r+"_"+uniqueId);function i(){c().setCloseIfOpenerCloses(!x||!d),J(),f=!0,z(),Q(n,500,o,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{O=window.open(Z(),r,e),h=!(m=!1),O&&O.document?d&&x&&isLoaded(O)?(O.mainPageReloaded(),i()):(d&&X(O.document),isLoaded(O)?i():Q(function(e){return bool(e)&&isLoaded(e)},100,i,"PopUpAppender.init: unable to create console window")):(y=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),M&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging."))}catch(e){handleError("PopUpAppender.init: error creating pop-up",e)}},e=function(){s||i()},o=function(){e(),a=!0},c=function(){return O},function(){if(y&&!isUndefined(O)&&!m){if(O.closed||f&&isUndefined(O.closed))return p.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!f&&isLoaded(O)&&(f=!0)}return y&&f&&!m});this.getConsoleWindow=c},ConsoleAppender.addGlobalCommandLineFunction=function(e,t){ee.push([e,t])},(e.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},e.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=e,(t.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},t.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=t,log4javascript.InlineAppender=t}(),function(){var y={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},v=["script","pre"],b=["br","img","hr","param","link","area","input","col","base","meta"],_="  ";function S(e,t,r,n,o){function i(e){for(var t=e.style.cssText.split(";"),r="",n=0,o=t.length;n<o;n++){var i=t[n].split(":"),a=[];/^\s*$/.test(i[0])||a.push(trim(i[0]).toLowerCase()+":"+trim(i[1])),r=a.join(";")}return r}"string"!=typeof r&&(r=""),n=!!n,o=!!o;if(!(t=void 0===t||!!t)||e.nodeType==y.DOCUMENT_FRAGMENT_NODE){for(s="",h=0,f=e.childNodes.length;h<f;h++)s+=S(e.childNodes[h],!0,r+_);return s}switch(e.nodeType){case y.ELEMENT_NODE:var a=e.tagName.toLowerCase(),s=n?newLine+r:"",d=(s+="<",(d=e).prefix||(d.outerHTML&&new RegExp("<([^:]+):"+d.tagName+"[^>]*>","i").test(d.outerHTML)?RegExp.$1.toLowerCase():"")),l=!!d;for(l&&(s+=d+":"),s+=a,h=0,f=e.attributes.length;h<f;h++){var u=e.attributes[h];u.specified&&null!==u.nodeValue&&"style"!==u.nodeName.toLowerCase()&&"string"==typeof u.nodeValue&&0!==u.nodeName.indexOf("_moz")&&(s=(s+=" "+u.nodeName.toLowerCase()+'="')+u.nodeValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")+'"')}if(e.style.cssText&&""!==i(e)&&(s+=' style="'+i(e)+'"'),array_contains(b,a)||l&&!e.hasChildNodes())s+="/>";else{s+=">";for(var c=!(1===e.childNodes.length&&e.childNodes[0].nodeType===y.TEXT_NODE),p=array_contains(v,a),h=0,f=e.childNodes.length;h<f;h++)s+=S(e.childNodes[h],!0,r+_,c,p);d="</"+a+">";s+=c?newLine+r+d:d}return s;case y.TEXT_NODE:if((l=e).nodeType==y.TEXT_NODE&&/^[ \t\r\n]*$/.test(l.nodeValue))s="";else{if(o)s=e.nodeValue;else{var m=splitIntoLines(trim(e.nodeValue)),g=[];for(h=0,f=m.length;h<f;h++)g[h]=trim(m[h]);s=g.join(newLine+r)}n&&(s=newLine+r+s)}return s;case y.CDATA_SECTION_NODE:return"<![CDATA["+e.nodeValue+"]]>"+newLine;case y.DOCUMENT_NODE:for(s="",h=0,f=e.childNodes.length;h<f;h++)s+=S(e.childNodes[h],!0,r);return s;default:return""}}function e(){ConsoleAppender.addGlobalCommandLineFunction("$",function(e,t,r){return document.getElementById(t[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(e,t,r){for(var n=[],o=0,i=t.length;o<i;o++)n[o]=function(e){var t,r=0;for(t in e)r=Math.max(toStr(t).length,r);var n=[];for(t in e){var o,i="  "+padWithSpaces(toStr(t),r+2);try{o=splitIntoLines(toStr(e[t])).join(padWithSpaces(newLine,r+6))}catch(e){o="[Error obtaining property. Details: "+getExceptionMessage(e)+"]"}n.push(i+o)}return n.join(newLine)}(t[o]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(e,t,r){for(var n=[],o=0,i=t.length;o<i;o++)n[o]=S(t[o]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(e,t,r){var n,o;return 0===t.length||""===t[0]?(n=window,o="Command line set to run in main window"):t[0].window==t[0]?(n=t[0],o="Command line set to run in frame '"+t[0].name+"'"):(n=window.frames[t[0]])?o="Command line set to run in frame '"+t[0]+"'":(r.isError=!0,o="Frame '"+t[0]+"' does not exist",n=e.getCommandWindow()),e.setCommandWindow(n),o}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(e,t,r){r.appendResult=!1,e.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(e,t,r){var n,o=[];for(n in t[0])o.push(n);return o}),ConsoleAppender.addGlobalCommandLineFunction("values",function(e,t,r){var n,o=[];for(n in t[0])try{o.push(t[0][n])}catch(e){logLog.warn("values(): Unable to obtain value for key "+n+". Details: "+getExceptionMessage(e))}return o}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(e,t,r){var n=parseInt(t[0],10);return isNaN(n)||n<0?(r.isError=!0,t[0]+" is not a valid expansion depth"):(e.setCommandLineObjectExpansionDepth(n),"Object expansion depth set to "+n)})}e()}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener?window.addEventListener("load",log4javascript.setDocumentReady,!1):window.attachEvent?window.attachEvent("onload",log4javascript.setDocumentReady):(oldOnload=window.onload,"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(e){oldOnload&&oldOnload(e),log4javascript.setDocumentReady()}),log4javascript},this),!function(e,t){"function"==typeof define&&define.amd?define(["bytebuffer"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(w,e){"use strict";var o,i,a,l,t,s,r,d,n,u={};function c(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null}function p(e){this.tn=new c(e),this.proto3=!1}function h(e,t){var r=-1,n=1;if("-"==e.charAt(0)&&(n=-1,e=e.substring(1)),a.NUMBER_DEC.test(e))r=parseInt(e);else if(a.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!a.NUMBER_OCT.test(e))throw Error("illegal id value: "+(n<0?"-":"")+e);r=parseInt(e.substring(1),8)}if(r=n*r|0,!t&&r<0)throw Error("illegal id value: "+(n<0?"-":"")+e);return r}function f(e){var t=1;if("-"==e.charAt(0)&&(t=-1,e=e.substring(1)),a.NUMBER_DEC.test(e))return t*parseInt(e,10);if(a.NUMBER_HEX.test(e))return t*parseInt(e.substring(2),16);if(a.NUMBER_OCT.test(e))return t*parseInt(e.substring(1),8);if("inf"===e)return t*(1/0);if("nan"===e)return NaN;if(a.NUMBER_FLT.test(e))return t*parseFloat(e);throw Error("illegal number value: "+(t<0?"-":"")+e)}function m(e,t,r){void 0===e[t]?e[t]=r:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(r))}function g(e){this.ns=new s.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}}function y(e,t){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new d.Element(e.keyType,null,!0,e.syntax),this.valueElem=new d.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),t)for(var r=Object.keys(t),n=0;n<r.length;n++){var o=this.keyElem.valueFromString(r[n]),i=this.valueElem.verifyValue(t[r[n]]);this.map[this.keyElem.valueToString(o)]={key:o,value:i}}}function v(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}return u.ByteBuffer=w,u.Long=w.Long||null,u.VERSION="5.0.1",u.WIRE_TYPES={},u.WIRE_TYPES.VARINT=0,u.WIRE_TYPES.BITS64=1,u.WIRE_TYPES.LDELIM=2,u.WIRE_TYPES.STARTGROUP=3,u.WIRE_TYPES.ENDGROUP=4,u.WIRE_TYPES.BITS32=5,u.PACKABLE_WIRE_TYPES=[u.WIRE_TYPES.VARINT,u.WIRE_TYPES.BITS64,u.WIRE_TYPES.BITS32],u.TYPES={int32:{name:"int32",wireType:u.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:u.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:u.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:u.WIRE_TYPES.VARINT,defaultValue:u.Long?u.Long.ZERO:void 0},uint64:{name:"uint64",wireType:u.WIRE_TYPES.VARINT,defaultValue:u.Long?u.Long.UZERO:void 0},sint64:{name:"sint64",wireType:u.WIRE_TYPES.VARINT,defaultValue:u.Long?u.Long.ZERO:void 0},bool:{name:"bool",wireType:u.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:u.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:u.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:u.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:u.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:u.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:u.WIRE_TYPES.BITS64,defaultValue:u.Long?u.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:u.WIRE_TYPES.BITS64,defaultValue:u.Long?u.Long.ZERO:void 0},float:{name:"float",wireType:u.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:u.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:u.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:u.WIRE_TYPES.STARTGROUP,defaultValue:null}},u.MAP_KEY_TYPES=[u.TYPES.int32,u.TYPES.sint32,u.TYPES.sfixed32,u.TYPES.uint32,u.TYPES.fixed32,u.TYPES.int64,u.TYPES.sint64,u.TYPES.sfixed64,u.TYPES.uint64,u.TYPES.fixed64,u.TYPES.bool,u.TYPES.string,u.TYPES.bytes],u.ID_MIN=1,u.ID_MAX=536870911,u.convertFieldsToCamelCase=!1,u.populateAccessors=!0,u.populateDefaults=!0,u.Util=((o={}).IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),o.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,r=0;r<e.length;r++){try{t=e[r]()}catch(e){continue}break}if(t)return t;throw Error("XMLHttpRequest is not supported")},o.fetch=function(e,r){if(r&&"function"!=typeof r&&(r=null),o.IS_NODE){var t=require("fs");if(r)t.readFile(e,function(e,t){r(e?null:""+t)});else try{return t.readFileSync(e)}catch(e){return null}}else{var n=o.XHR();if(n.open("GET",e,!!r),n.setRequestHeader("Accept","text/plain"),"function"==typeof n.overrideMimeType&&n.overrideMimeType("text/plain"),!r)return n.send(null),200==n.status||0==n.status&&"string"==typeof n.responseText?n.responseText:null;n.onreadystatechange=function(){4==n.readyState&&(200==n.status||0==n.status&&"string"==typeof n.responseText?r(n.responseText):r(null))},4!=n.readyState&&n.send(null)}},o.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},o),u.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},u.DotProto=(a=(i=u).Lang,n={},(r=c.prototype)._readString=function(){var e='"'===this._stringOpen?a.STRING_DQ:a.STRING_SQ,t=(e.lastIndex=this.index-1,e.exec(this.source));if(t)return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,t[1];throw Error("unterminated string")},r.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,t,r;do{for(e=!1;a.WHITESPACE.test(r=this.source.charAt(this.index));)if("\n"===r&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index)){if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line}else{if("*"!==(r=this.source.charAt(this.index)))return"/";do{if("\n"===r&&++this.line,++this.index===this.source.length)return null}while(t=r,r=this.source.charAt(this.index),"*"!==t||"/"!==r);++this.index}e=!0}}while(e);if(this.index===this.source.length)return null;var n=this.index;if(a.DELIM.lastIndex=0,!a.DELIM.test(this.source.charAt(n++)))for(;n<this.source.length&&!a.DELIM.test(this.source.charAt(n));)++n;var o=this.source.substring(this.index,this.index=n);return'"'!==o&&"'"!==o||(this._stringOpen=o),o},r.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},r.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},r.omit=function(e){return this.peek()===e&&(this.next(),!0)},r.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=c,(r=p.prototype).parse=function(){var e,t,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},n=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!n||null!==r.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!a.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),r.package=e;break;case"import":if(!n)throw Error("unexpected 'import'");"public"!==(e=this.tn.peek())&&!(t="weak"===e)||this.tn.next(),e=this._readString(),this.tn.skip(";"),t||r.imports.push(e);break;case"syntax":if(!n)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),n=!1;break;case"enum":this._parseEnum(r),n=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete r.name,r},p.parse=function(e){return new p(e).parse()},r._readString=function(){var e,t="";do{if("'"!==(e=this.tn.next())&&'"'!==e)throw Error("illegal string delimiter: "+e)}while(t+=this.tn.next(),this.tn.skip(e),'"'===this.tn.peek());return t},r._readValue=function(e){var t=this.tn.peek();if('"'===t||"'"===t)return this._readString();if(this.tn.next(),a.NUMBER.test(t))return f(t);if(a.BOOL.test(t))return"true"===t.toLowerCase();if(e&&a.TYPEREF.test(t))return t;throw Error("illegal value: "+t)},r._parseOption=function(e,t){var r=this.tn.next(),n=!1;if("("===r&&(n=!0,r=this.tn.next()),!a.TYPEREF.test(r))throw Error("illegal option name: "+r);var o=r;n&&(this.tn.skip(")"),o="("+o+")",r=this.tn.peek(),a.FQTYPEREF.test(r))&&(o+=r,this.tn.next()),this.tn.skip("="),this._parseOptionValue(e,o),t||this.tn.skip(";")},r._parseOptionValue=function(e,t){var r;if("{"!==this.tn.peek())m(e.options,t,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!a.NAME.test(r))throw Error("illegal option name: "+t+"."+r);this.tn.omit(":")?m(e.options,t+"."+r,this._readValue(!0)):this._parseOptionValue(e,t+"."+r)}},r._parseService=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal service name at line "+this.tn.line+": "+t);var r={name:t,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if("option"===t)this._parseOption(r);else{if("rpc"!==t)throw Error("illegal service token: "+t);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},r._parseServiceRPC=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal rpc service method name: "+t);var r=t,n={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(n.request_stream=!0,t=this.tn.next()),!a.TYPEREF.test(t))throw Error("illegal rpc service request type: "+t);if(n.request=t,this.tn.skip(")"),"returns"!==(t=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+t);if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(n.response_stream=!0,t=this.tn.next()),n.response=t,this.tn.skip(")"),"{"===(t=this.tn.peek())){for(this.tn.next();"}"!==(t=this.tn.next());){if("option"!==t)throw Error("illegal rpc service token: "+t);this._parseOption(n)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[r]=n},r._parseMessage=function(e,t){var r=!!t,n=this.tn.next(),o={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!a.NAME.test(n))throw Error("illegal "+(r?"group":"message")+" name: "+n);for(o.name=n,r&&(this.tn.skip("="),t.id=h(this.tn.next()),o.isGroup=!0),"["===this.tn.peek()&&t&&this._parseFieldOptions(t),this.tn.skip("{");"}"!==(n=this.tn.next());)if(a.RULE.test(n))this._parseMessageField(o,n);else if("oneof"===n)this._parseMessageOneOf(o);else if("enum"===n)this._parseEnum(o);else if("message"===n)this._parseMessage(o);else if("option"===n)this._parseOption(o);else if("service"===n)this._parseService(o);else if("extensions"===n)o.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(o);else{if(!a.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(o,"optional",n)}return this.tn.omit(";"),e.messages.push(o),o},r._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},r._parseMessageField=function(e,t,r){if(!a.RULE.test(t))throw Error("illegal message field rule: "+t);var n,o={rule:t,type:"",name:"",options:{},id:0};if("map"===t){if(r)throw Error("illegal type: "+r);if(this.tn.skip("<"),n=this.tn.next(),!a.TYPE.test(n)&&!a.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(o.keytype=n,this.tn.skip(","),n=this.tn.next(),!a.TYPE.test(n)&&!a.TYPEREF.test(n))throw Error("illegal message field: "+n);if(o.type=n,this.tn.skip(">"),n=this.tn.next(),!a.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=h(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}else if("group"===(r=void 0!==r?r:this.tn.next())){t=this._parseMessage(e,o);if(!/^[A-Z]/.test(t.name))throw Error("illegal group name: "+t.name);o.type=t.name,o.name=t.name.toLowerCase(),this.tn.omit(";")}else{if(!a.TYPE.test(r)&&!a.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(o.type=r,n=this.tn.next(),!a.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=h(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}return e.fields.push(o),o},r._parseMessageOneOf=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal oneof name: "+t);var r,n=t,o=[];for(this.tn.skip("{");"}"!==(t=this.tn.next());)(r=this._parseMessageField(e,"optional",t)).oneof=n,o.push(r.id);this.tn.omit(";"),e.oneofs[n]=o},r._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},r._parseEnum=function(e){var t={name:"",values:[],options:{}},r=this.tn.next();if(!a.NAME.test(r))throw Error("illegal name: "+r);for(t.name=r,this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(t);else{if(!a.NAME.test(r))throw Error("illegal name: "+r);this.tn.skip("=");var n={name:r,id:h(this.tn.next(),!0)};"["===(r=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),t.values.push(n)}this.tn.omit(";"),e.enums.push(t)},r._parseExtensionRanges=function(){var e,t,r,n=[];do{for(t=[];;){switch(e=this.tn.next()){case"min":r=i.ID_MIN;break;case"max":r=i.ID_MAX;break;default:r=f(e)}if(t.push(r),2===t.length)break;if("to"!==this.tn.peek()){t.push(r);break}this.tn.next()}}while(n.push(t),this.tn.omit(","));return this.tn.skip(";"),n},r._parseExtend=function(e){var t=this.tn.next();if(!a.TYPEREF.test(t))throw Error("illegal extend reference: "+t);var r={ref:t,fields:[]};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if(a.RULE.test(t))this._parseMessageField(r,t);else{if(!a.TYPEREF.test(t))throw Error("illegal extend token: "+t);if(!this.proto3)throw Error("illegal field rule: "+t);this._parseMessageField(r,"optional",t)}return this.tn.omit(";"),e.messages.push(r),r},r.toString=function(){return"Parser at line "+this.tn.line},n.Parser=p,n),u.Reflect=function(h){function u(e,t,r){this.builder=e,this.parent=t,this.name=r,this.className}function a(e,t,r,n,o){u.call(this,e,t,r),this.className="Namespace",this.children=[],this.options=n||{},this.syntax=o||"proto2"}var s={},e=u.prototype;e.fqn=function(){for(var e=this.name,t=this;null!=(t=t.parent);)e=t.name+"."+e;return e},e.toString=function(e){return(e?this.className+" ":"")+this.fqn()},e.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},s.T=u;try{var t=a.prototype=Object.create(u.prototype)}catch(e){t=""}t.getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],r=0,n=this.children.length;r<n;++r)this.children[r]instanceof e&&t.push(this.children[r]);return t},t.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof c.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof c.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},t.getChild=function(e){for(var t="number"==typeof e?"id":"name",r=0,n=this.children.length;r<n;++r)if(this.children[r][t]===e)return this.children[r];return null},t.resolve=function(e,t){var r,n="string"==typeof e?e.split("."):e,o=this,i=0;if(""===n[i]){for(;null!==o.parent;)o=o.parent;i++}do{do{if(!(o instanceof s.Namespace)){o=null;break}if(!(r=o.getChild(n[i]))||!(r instanceof s.T)||t&&!(r instanceof s.Namespace)){o=null;break}}while(o=r,++i<n.length);if(null!=o)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=o);return o},t.qn=function(e){for(var t=[],r=e;t.unshift(r.name),null!==(r=r.parent););for(var n=1;n<=t.length;n++){var o=t.slice(t.length-n);if(e===this.resolve(o,e instanceof s.Namespace))return o.join(".")}return e.fqn()},t.build=function(){for(var e,t={},r=this.children,n=0,o=r.length;n<o;++n)(e=r[n])instanceof a&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},t.buildOpt=function(){for(var e={},t=Object.keys(this.options),r=0,n=t.length;r<n;++r){var o=t[r],i=this.options[t[r]];e[o]=i}return e},t.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},s.Namespace=a;function l(e,t,r,n){if(this.type=e,this.resolvedType=t,this.isMapKey=r,this.syntax=n,r&&h.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)}e=l.prototype;function d(e,t){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new h.Long(e.low,e.high,void 0===t?e.unsigned:t);if("string"==typeof e)return h.Long.fromString(e,t||!1,10);if("number"==typeof e)return h.Long.fromNumber(e,t||!1);throw Error("not convertible to Long")}l.defaultFieldValue=function(e){if(void 0===(e="string"==typeof e?h.TYPES[e]:e).defaultValue)throw Error("default value for type "+e.name+" is not supported");return e==h.TYPES.bytes?new w(0):e.defaultValue},e.verifyValue=function(t){var r=this;function n(e,t){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+e+" ("+t+")")}switch(this.type){case h.TYPES.int32:case h.TYPES.sint32:case h.TYPES.sfixed32:return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),4294967295<t?0|t:t;case h.TYPES.uint32:case h.TYPES.fixed32:return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),t<0?t>>>0:t;case h.TYPES.int64:case h.TYPES.sint64:case h.TYPES.sfixed64:if(h.Long)try{return d(t,!1)}catch(e){n(typeof t,e.message)}else n(typeof t,"requires Long.js");case h.TYPES.uint64:case h.TYPES.fixed64:if(h.Long)try{return d(t,!0)}catch(e){n(typeof t,e.message)}else n(typeof t,"requires Long.js");case h.TYPES.bool:return"boolean"!=typeof t&&n(typeof t,"not a boolean"),t;case h.TYPES.float:case h.TYPES.double:return"number"!=typeof t&&n(typeof t,"not a number"),t;case h.TYPES.string:return"string"==typeof t||t&&t instanceof String||n(typeof t,"not a string"),""+t;case h.TYPES.bytes:return w.isByteBuffer(t)?t:w.wrap(t,"base64");case h.TYPES.enum:for(var e=this.resolvedType.getChildren(h.Reflect.Enum.Value),o=0;o<e.length;o++){if(e[o].name==t)return e[o].id;if(e[o].id==t)return e[o].id}if("proto3"===this.syntax)return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),(4294967295<t||t<0)&&n(typeof t,"not in range for uint32"),t;n(t,"not a valid enum value");case h.TYPES.group:case h.TYPES.message:if(t&&"object"==typeof t||n(typeof t,"object expected"),t instanceof this.resolvedType.clazz)return t;if(t instanceof h.Builder.Message){var o,i={};for(o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);t=i}return new this.resolvedType.clazz(t)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+t+" (undefined type "+this.type+")")},e.calculateLength=function(e,t){if(null===t)return 0;var r;switch(this.type){case h.TYPES.int32:return t<0?w.calculateVarint64(t):w.calculateVarint32(t);case h.TYPES.uint32:return w.calculateVarint32(t);case h.TYPES.sint32:return w.calculateVarint32(w.zigZagEncode32(t));case h.TYPES.fixed32:case h.TYPES.sfixed32:case h.TYPES.float:return 4;case h.TYPES.int64:case h.TYPES.uint64:return w.calculateVarint64(t);case h.TYPES.sint64:return w.calculateVarint64(w.zigZagEncode64(t));case h.TYPES.fixed64:case h.TYPES.sfixed64:return 8;case h.TYPES.bool:return 1;case h.TYPES.enum:return w.calculateVarint32(t);case h.TYPES.double:return 8;case h.TYPES.string:return r=w.calculateUTF8Bytes(t),w.calculateVarint32(r)+r;case h.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");return w.calculateVarint32(t.remaining())+t.remaining();case h.TYPES.message:return r=this.resolvedType.calculate(t),w.calculateVarint32(r)+r;case h.TYPES.group:return(r=this.resolvedType.calculate(t))+w.calculateVarint32(e<<3|h.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")},e.encodeValue=function(e,t,r){if(null!==t)switch(this.type){case h.TYPES.int32:t<0?r.writeVarint64(t):r.writeVarint32(t);break;case h.TYPES.uint32:r.writeVarint32(t);break;case h.TYPES.sint32:r.writeVarint32ZigZag(t);break;case h.TYPES.fixed32:r.writeUint32(t);break;case h.TYPES.sfixed32:r.writeInt32(t);break;case h.TYPES.int64:case h.TYPES.uint64:r.writeVarint64(t);break;case h.TYPES.sint64:r.writeVarint64ZigZag(t);break;case h.TYPES.fixed64:r.writeUint64(t);break;case h.TYPES.sfixed64:r.writeInt64(t);break;case h.TYPES.bool:"string"==typeof t?r.writeVarint32("false"===t.toLowerCase()?0:!!t):r.writeVarint32(t?1:0);break;case h.TYPES.enum:r.writeVarint32(t);break;case h.TYPES.float:r.writeFloat32(t);break;case h.TYPES.double:r.writeFloat64(t);break;case h.TYPES.string:r.writeVString(t);break;case h.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");var n=t.offset;r.writeVarint32(t.remaining()),r.append(t),t.offset=n;break;case h.TYPES.message:n=(new w).LE();this.resolvedType.encode(t,n),r.writeVarint32(n.offset),r.append(n.flip());break;case h.TYPES.group:this.resolvedType.encode(t,r),r.writeVarint32(e<<3|h.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")}return r},e.decode=function(e,t,r){if(t!=this.type.wireType)throw Error("Unexpected wire type for element");var n,o;switch(this.type){case h.TYPES.int32:return 0|e.readVarint32();case h.TYPES.uint32:return e.readVarint32()>>>0;case h.TYPES.sint32:return 0|e.readVarint32ZigZag();case h.TYPES.fixed32:return e.readUint32()>>>0;case h.TYPES.sfixed32:return 0|e.readInt32();case h.TYPES.int64:return e.readVarint64();case h.TYPES.uint64:return e.readVarint64().toUnsigned();case h.TYPES.sint64:return e.readVarint64ZigZag();case h.TYPES.fixed64:return e.readUint64();case h.TYPES.sfixed64:return e.readInt64();case h.TYPES.bool:return!!e.readVarint32();case h.TYPES.enum:return e.readVarint32();case h.TYPES.float:return e.readFloat();case h.TYPES.double:return e.readDouble();case h.TYPES.string:return e.readVString();case h.TYPES.bytes:if(o=e.readVarint32(),e.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+e.remaining());return(n=e.clone()).limit=n.offset+o,e.offset+=o,n;case h.TYPES.message:return o=e.readVarint32(),this.resolvedType.decode(e,o);case h.TYPES.group:return this.resolvedType.decode(e,-1,r)}throw Error("[INTERNAL] Illegal decode type")},e.valueFromString=function(e){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case h.TYPES.int32:case h.TYPES.sint32:case h.TYPES.sfixed32:case h.TYPES.uint32:case h.TYPES.fixed32:return this.verifyValue(parseInt(e));case h.TYPES.int64:case h.TYPES.sint64:case h.TYPES.sfixed64:case h.TYPES.uint64:case h.TYPES.fixed64:return this.verifyValue(e);case h.TYPES.bool:return"true"===e;case h.TYPES.string:return this.verifyValue(e);case h.TYPES.bytes:return w.fromBinary(e)}},e.valueToString=function(e){if(this.isMapKey)return this.type===h.TYPES.bytes?e.toString("binary"):e.toString();throw Error("valueToString() called on non-map-key element")},s.Element=l;var c=function(e,t,r,n,o,i){a.call(this,e,t,r,n,i),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!o,this._fields=null,this._fieldsById=null,this._fieldsByName=null};try{var r=c.prototype=Object.create(a.prototype)}catch(e){r=""}r.build=function(e){if(this.clazz&&!e)return this.clazz;var t=function(c,a){function s(e,t){c.Builder.Message.call(this);for(var r,n=0,o=l.length;n<o;++n)this[l[n].name]=null;for(n=0,o=d.length;n<o;++n){var i=d[n];this[i.name]=i.repeated?[]:i.map?new c.Map(i):null,!i.required&&"proto3"!==a.syntax||null===i.defaultValue||(this[i.name]=i.defaultValue)}if(0<arguments.length)if(1!==arguments.length||null===e||"object"!=typeof e||!("function"!=typeof e.encode||e instanceof s)||Array.isArray(e)||e instanceof c.Map||w.isByteBuffer(e)||e instanceof ArrayBuffer||c.Long&&e instanceof c.Long)for(n=0,o=arguments.length;n<o;++n)void 0!==(r=arguments[n])&&this.$set(d[n].name,r);else this.$set(e)}var d=a.getChildren(c.Reflect.Message.Field),l=a.getChildren(c.Reflect.Message.OneOf);try{var i=s.prototype=Object.create(c.Builder.Message.prototype)}catch(e){i=""}i.add=function(e,t,r){var n=a._fieldsByName[e];if(!r){if(!n)throw Error(this+"#"+e+" is undefined");if(!(n instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+e+" is not a repeated field");t=n.verifyValue(t,!0)}return null===this[e]&&(this[e]=[]),this[e].push(t),this},i.$add=i.add,i.set=function(e,t,r){if(e&&"object"==typeof e)for(var n in r=t,e)e.hasOwnProperty(n)&&void 0!==(t=e[n])&&this.$set(n,t,r);else{var o,i=a._fieldsByName[e];if(r)this[e]=t;else{if(!i)throw Error(this+"#"+e+" is not a field: undefined");if(!(i instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+i.toString(!0));this[i.name]=t=i.verifyValue(t)}i&&i.oneof&&(o=this[i.oneof.name],null!==t?(null!==o&&o!==i.name&&(this[o]=null),this[i.oneof.name]=i.name):o===e&&(this[i.oneof.name]=null))}return this},i.$set=i.set,i.get=function(e,t){if(t)return this[e];t=a._fieldsByName[e];if(!(t&&t instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(t instanceof c.Reflect.Message.Field)return this[t.name];throw Error(this+"#"+e+" is not a field: "+t.toString(!0))},i.$get=i.get;for(var e=0;e<d.length;e++){var t=d[e];t instanceof c.Reflect.Message.ExtensionField||a.builder.options.populateAccessors&&!function(r){function e(e,t){return this[r.name]=t?e:r.verifyValue(e),this}function t(){return this[r.name]}var n=(n=r.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")})).substring(0,1).toUpperCase()+n.substring(1),o=r.originalName.replace(/([A-Z])/g,function(e){return"_"+e});null===a.getChild("set"+n)&&(i["set"+n]=e),null===a.getChild("set_"+o)&&(i["set_"+o]=e),null===a.getChild("get"+n)&&(i["get"+n]=t),null===a.getChild("get_"+o)&&(i["get_"+o]=t)}(t)}function p(e,r,n,o){if(null===e||"object"!=typeof e){if(o&&o instanceof c.Reflect.Enum){var t=c.Reflect.Enum.getName(o.object,e);if(null!==t)return t}return e}if(w.isByteBuffer(e))return r?e.toBase64():e.toBuffer();if(c.Long.isLong(e))return n?e.toString():c.Long.fromValue(e);var i;if(Array.isArray(e))i=[],e.forEach(function(e,t){i[t]=p(e,r,n,o)});else if(i={},e instanceof c.Map)for(var a=e.entries(),s=a.next();!s.done;s=a.next())i[e.keyElem.valueToString(s.value[0])]=p(s.value[1],r,n,e.valueElem.resolvedType);else{var d,l=e.$type,u=void 0;for(d in e)e.hasOwnProperty(d)&&(l&&(u=l.getChild(d))?i[d]=p(e[d],r,n,u.resolvedType):i[d]=p(e[d],r,n))}return i}return i.encode=function(t,e){"boolean"==typeof t&&(e=t,t=void 0);var r=!1,n=(t||(t=new w,r=!0),t.littleEndian);try{return a.encode(this,t.LE(),e),(r?t.flip():t).LE(n)}catch(e){throw t.LE(n),e}},s.encode=function(e,t,r){return new s(e).encode(t,r)},i.calculate=function(){return a.calculate(this)},i.encodeDelimited=function(e,t){var r=!1,n=(e||(e=new w,r=!0),(new w).LE());return a.encode(this,n,t).flip(),e.writeVarint32(n.remaining()),e.append(n),r?e.flip():e},i.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},i.toArrayBuffer=i.encodeAB,i.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},i.toBuffer=i.encodeNB,i.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},i.toBase64=i.encode64,i.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},i.toHex=i.encodeHex,i.toRaw=function(e,t){return p(this,!!e,!!t,this.$type)},i.encodeJSON=function(){return JSON.stringify(p(this,!0,!0,this.$type))},s.decode=function(t,r,e){"string"==typeof r&&(e=r,r=-1),"string"==typeof t&&(t=w.wrap(t,e||"base64"));r=(t=w.isByteBuffer(t)?t:w.wrap(t)).littleEndian;try{var n=a.decode(t.LE());return t.LE(r),n}catch(e){throw t.LE(r),e}},s.decodeDelimited=function(t,e){if("string"==typeof t&&(t=w.wrap(t,e||"base64")),(t=w.isByteBuffer(t)?t:w.wrap(t)).remaining()<1)return null;var e=t.offset,r=t.readVarint32();if(t.remaining()<r)return t.offset=e,null;try{var n=a.decode(t.slice(t.offset,t.offset+r).LE());return t.offset+=r,n}catch(e){throw t.offset+=r,e}},s.decode64=function(e){return s.decode(e,"base64")},s.decodeHex=function(e){return s.decode(e,"hex")},s.decodeJSON=function(e){return new s(JSON.parse(e))},i.toString=function(){return a.toString()},Object.defineProperty&&(Object.defineProperty(s,"$options",{value:a.buildOpt()}),Object.defineProperty(i,"$options",{value:s.$options}),Object.defineProperty(s,"$type",{value:a}),Object.defineProperty(i,"$type",{value:a})),s}(h,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,o=this.children.length;n<o;n++)if((r=this.children[n])instanceof i||r instanceof c||r instanceof y){if(t.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");t[r.name]=r.build()}else if(r instanceof c.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof c.OneOf||r instanceof g))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=t},r.encode=function(e,t,r){for(var n,o,i,a=null,s=0,d=this._fields.length;s<d;++s)o=e[(n=this._fields[s]).name],n.required&&null===o?null===a&&(a=n):n.encode(r?o:n.verifyValue(o),t,e);if(null!==a)throw(i=Error("Missing at least one required field for "+this.toString(!0)+": "+a)).encoded=t,i;return t},r.calculate=function(e){for(var t,r,n=0,o=0,i=this._fields.length;o<i;++o){if(r=e[(t=this._fields[o]).name],t.required&&null===r)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);n+=t.calculate(r,e)}return n},r.decode=function(e,t,r){t="number"==typeof t?t:-1;for(var n,o,i,a,s=e.offset,d=new this.clazz;e.offset<s+t||-1===t&&0<e.remaining();){if(o=(a=e.readVarint32())>>>3,(n=7&a)===h.WIRE_TYPES.ENDGROUP){if(o!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+o+" ("+(r?r+" expected":"not a group")+")");break}if(i=this._fieldsById[o])i.repeated&&!i.options.packed?d[i.name].push(i.decode(n,e)):i.map?(a=i.decode(n,e),d[i.name].set(a[0],a[1])):(d[i.name]=i.decode(n,e),i.oneof&&(null!==(a=d[i.oneof.name])&&a!==i.name&&(d[a]=null),d[i.oneof.name]=i.name));else switch(n){case h.WIRE_TYPES.VARINT:e.readVarint32();break;case h.WIRE_TYPES.BITS32:e.offset+=4;break;case h.WIRE_TYPES.BITS64:e.offset+=8;break;case h.WIRE_TYPES.LDELIM:var l=e.readVarint32();e.offset+=l;break;case h.WIRE_TYPES.STARTGROUP:for(;function e(t,r){var n=r.readVarint32(),o=7&n,i=n>>>3;switch(o){case h.WIRE_TYPES.VARINT:for(;128==(128&(n=r.readUint8())););break;case h.WIRE_TYPES.BITS64:r.offset+=8;break;case h.WIRE_TYPES.LDELIM:n=r.readVarint32(),r.offset+=n;break;case h.WIRE_TYPES.STARTGROUP:e(i,r);break;case h.WIRE_TYPES.ENDGROUP:if(i===t)return;throw Error("Illegal GROUPEND after unknown group: "+i+" ("+t+" expected)");case h.WIRE_TYPES.BITS32:r.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+t+": "+o)}return 1}(o,e););break;default:throw Error("Illegal wire type for unknown field "+o+" in "+this.toString(!0)+"#decode: "+n)}}for(var u,c=0,p=this._fields.length;c<p;++c)if(null===d[(i=this._fields[c]).name])if("proto3"===this.syntax)d[i.name]=i.defaultValue;else{if(i.required)throw(u=Error("Missing at least one required field for "+this.toString(!0)+": "+i.name)).decoded=d,u;h.populateDefaults&&null!==i.defaultValue&&(d[i.name]=i.defaultValue)}return d},s.Message=c;function p(e,t,r,n,o,i,a,s,d,l){u.call(this,e,t,i),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=n||null,this.type=o,this.resolvedType=null,this.id=a,this.options=s||{},this.defaultValue=null,this.oneof=d||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof c.ExtensionField||(this.name=h.Util.toCamelCase(this.name))}try{var n=p.prototype=Object.create(u.prototype)}catch(e){n=""}n.build=function(){this.element=new l(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new l(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=l.defaultFieldValue(this.type)},n.verifyValue=function(e,t){t=t||!1;var r=this;function n(e,t){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+e+" ("+t+")")}if(null===e)return this.required&&n(typeof e,"required"),"proto3"===this.syntax&&this.type!==h.TYPES.message&&n(typeof e,"proto3 field without field presence cannot be null"),null;if(!this.repeated||t)return this.map&&!t?e instanceof h.Map?e:(e instanceof Object||n(typeof e,"expected ProtoBuf.Map or raw object for map field"),new h.Map(this,e)):(!this.repeated&&Array.isArray(e)&&n(typeof e,"no array expected"),this.element.verifyValue(e));Array.isArray(e)||(e=[e]);for(var o=[],i=0;i<e.length;i++)o.push(this.element.verifyValue(e[i]));return o},n.hasWirePresence=function(e,t){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&t[this.oneof.name]===this.name)return!0;switch(this.type){case h.TYPES.int32:case h.TYPES.sint32:case h.TYPES.sfixed32:case h.TYPES.uint32:case h.TYPES.fixed32:return 0!==e;case h.TYPES.int64:case h.TYPES.sint64:case h.TYPES.sfixed64:case h.TYPES.uint64:case h.TYPES.fixed64:return 0!==e.low||0!==e.high;case h.TYPES.bool:return e;case h.TYPES.float:case h.TYPES.double:return 0!==e;case h.TYPES.string:return 0<e.length;case h.TYPES.bytes:return 0<e.remaining();case h.TYPES.enum:return 0!==e;case h.TYPES.message:return null!==e;default:return!0}},n.encode=function(t,o,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(!(null===t||this.repeated&&0==t.length))try{if(this.repeated)if(this.options.packed&&0<=h.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){o.writeVarint32(this.id<<3|h.WIRE_TYPES.LDELIM),o.ensureCapacity(o.offset+=1);for(var r=o.offset,n=0;n<t.length;n++)this.element.encodeValue(this.id,t[n],o);var i,a=o.offset-r,s=w.calculateVarint32(a);1<s&&(i=o.slice(r,o.offset),r+=s-1,o.offset=r,o.append(i)),o.writeVarint32(a,r-s)}else for(n=0;n<t.length;n++)o.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t[n],o);else this.map?t.forEach(function(e,t,r){var n=w.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+w.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);o.writeVarint32(this.id<<3|h.WIRE_TYPES.LDELIM),o.writeVarint32(n),o.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,t,o),o.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,o)},this):this.hasWirePresence(t,e)&&(o.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t,o))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return o},n.calculate=function(t,e){if(t=this.verifyValue(t),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return 0;var r,n,o=0;try{if(this.repeated)if(this.options.packed&&0<=h.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(o+=w.calculateVarint32(this.id<<3|h.WIRE_TYPES.LDELIM),r=n=0;r<t.length;r++)n+=this.element.calculateLength(this.id,t[r]);o=o+w.calculateVarint32(n)+n}else for(r=0;r<t.length;r++)o=(o+=w.calculateVarint32(this.id<<3|this.type.wireType))+this.element.calculateLength(this.id,t[r]);else this.map?t.forEach(function(e,t,r){t=w.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+w.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);o=(o+=w.calculateVarint32(this.id<<3|h.WIRE_TYPES.LDELIM))+w.calculateVarint32(t)+t},this):this.hasWirePresence(t,e)&&(o=(o+=w.calculateVarint32(this.id<<3|this.type.wireType))+this.element.calculateLength(this.id,t))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return o},n.decode=function(e,t,r){if(!(!this.map&&e==this.type.wireType||!r&&this.repeated&&this.options.packed&&e==h.WIRE_TYPES.LDELIM||this.map&&e==h.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==h.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=h.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){n=t.readVarint32();for(var n=t.offset+n,o=[];t.offset<n;)o.push(this.decode(this.type.wireType,t,!0));return o}if(this.map){var i=l.defaultFieldValue(this.keyType),a=l.defaultFieldValue(this.type);if(n=t.readVarint32(),t.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+t.remaining());var s=t.clone();for(s.limit=s.offset+n,t.offset+=n;0<s.remaining();){var d=s.readVarint32(),d=(e=7&d,d>>>3);if(1==d)i=this.keyElement.decode(s,e,d);else{if(2!=d)throw Error("Unexpected tag in map field key/value submessage");a=this.element.decode(s,e,d)}}return[i,a]}return this.element.decode(t,e,this.id)},s.Message.Field=p;function o(e,t,r,n,o,i,a){p.call(this,e,t,r,null,n,o,i,a),this.extension}try{o.prototype=Object.create(p.prototype)}catch(e){o.prototype=null}s.Message.ExtensionField=o;s.Message.OneOf=function(e,t,r){u.call(this,e,t,r),this.fields=[]};var i=function(e,t,r,n,o){a.call(this,e,t,r,n,o),this.className="Enum",this.object=null};i.getName=function(e,t){for(var r,n=Object.keys(e),o=0;o<n.length;++o)if(e[r=n[o]]===t)return r;return null};try{var f=i.prototype=Object.create(a.prototype)}catch(e){f=i.prototype=null}f&&(f.build=function(e){if(this.object&&!e)return this.object;for(var t=new h.Builder.Enum,r=this.getChildren(i.Value),n=0,o=r.length;n<o;++n)t[r[n].name]=r[n].id;return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=t}),s.Enum=i;function m(e,t,r,n){u.call(this,e,t,r),this.className="Enum.Value",this.id=n}try{m.prototype=Object.create(u.prototype)}catch(e){m.prototype=null}s.Enum.Value=m;var g=function(e,t,r,n){u.call(this,e,t,r),this.field=n};try{g.prototype=Object.create(u.prototype)}catch(e){g.prototype=null}s.Extension=g;var y=function(e,t,r,n){a.call(this,e,t,r,n),this.className="Service",this.clazz=null};try{var v=y.prototype=Object.create(a.prototype)}catch(e){v=null}v&&(v.build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(t,o){for(var i=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,r){setTimeout(r.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=i.prototype=Object.create(t.Builder.Service.prototype),r=o.getChildren(t.Reflect.Service.RPCMethod),n=0;n<r.length;n++)!function(n){e[n.name]=function(e,r){try{try{e=n.resolvedRequestType.clazz.decode(w.wrap(e))}catch(e){if(!(e instanceof TypeError))throw e}if(null===e||"object"!=typeof e)throw Error("Illegal arguments");e instanceof n.resolvedRequestType.clazz||(e=new n.resolvedRequestType.clazz(e)),this.rpcImpl(n.fqn(),e,function(e,t){if(e)r(e);else{null===t&&(t="");try{t=n.resolvedResponseType.clazz.decode(t)}catch(e){}t&&t instanceof n.resolvedResponseType.clazz?r(null,t):r(Error("Illegal response type received in service method "+o.name+"#"+n.name))}})}catch(e){setTimeout(r.bind(this,e),0)}},i[n.name]=function(e,t,r){new i(e)[n.name](t,r)},Object.defineProperty&&(Object.defineProperty(i[n.name],"$options",{value:n.buildOpt()}),Object.defineProperty(e[n.name],"$options",{value:i[n.name].$options}))}(r[n]);return Object.defineProperty&&(Object.defineProperty(i,"$options",{value:o.buildOpt()}),Object.defineProperty(e,"$options",{value:i.$options}),Object.defineProperty(i,"$type",{value:o}),Object.defineProperty(e,"$type",{value:o})),i}(h,this)}),s.Service=y;function b(e,t,r,n){u.call(this,e,t,r),this.className="Service.Method",this.options=n||{}}try{var _=b.prototype=Object.create(u.prototype)}catch(e){_=null}_&&(_.buildOpt=t.buildOpt),s.Service.Method=b;function S(e,t,r,n,o,i,a,s){b.call(this,e,t,r,s),this.className="Service.RPCMethod",this.requestName=n,this.responseName=o,this.requestStream=i,this.responseStream=a,this.resolvedRequestType=null,this.resolvedResponseType=null}try{S.prototype=Object.create(b.prototype)}catch(e){S.prototype=null}return s.Service.RPCMethod=S,s}(u),u.Builder=(t=(l=u).Lang,s=u.Reflect,r=g.prototype,g.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},g.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},g.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},g.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},g.isExtend=function(e){return"string"==typeof e.ref},r.reset=function(){return this.ptr=this.ns,this},r.define=function(e){if("string"==typeof e&&t.TYPEREF.test(e))return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new s.Namespace(this,this.ptr,e)),this.ptr=t},this),this;throw Error("illegal namespace: "+e)},r.create=function(e){if(e){if(Array.isArray(e)){if(0===e.length)return this;e=e.slice()}else e=[e];for(var t=[e];0<t.length;){if(e=t.pop(),!Array.isArray(e))throw Error("not a valid namespace: "+JSON.stringify(e));for(;0<e.length;){var r=e.shift();if(g.isMessage(r)){var o=new s.Message(this,this.ptr,r.name,r.options,r.isGroup,r.syntax),n={},i=(r.oneofs&&Object.keys(r.oneofs).forEach(function(e){o.addChild(n[e]=new s.Message.OneOf(this,o,e))},this),r.fields&&r.fields.forEach(function(e){if(null!==o.getChild(0|e.id))throw Error("duplicate or invalid field id in "+o.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+o.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=n[e.oneof]))throw Error("illegal oneof in "+o.name+"#"+e.name+": "+e.oneof);e=new s.Message.Field(this,o,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,r.syntax),t&&t.fields.push(e),o.addChild(e)},this),[]);if(r.enums&&r.enums.forEach(function(e){i.push(e)}),r.messages&&r.messages.forEach(function(e){i.push(e)}),r.services&&r.services.forEach(function(e){i.push(e)}),r.extensions&&("number"==typeof r.extensions[0]?o.extensions=[r.extensions]:o.extensions=r.extensions),this.ptr.addChild(o),0<i.length){t.push(e),e=i,i=null,this.ptr=o,o=null;continue}i=null}else if(g.isEnum(r))o=new s.Enum(this,this.ptr,r.name,r.options,r.syntax),r.values.forEach(function(e){o.addChild(new s.Enum.Value(this,o,e.name,e.id))},this),this.ptr.addChild(o);else if(g.isService(r))o=new s.Service(this,this.ptr,r.name,r.options),Object.keys(r.rpc).forEach(function(e){var t=r.rpc[e];o.addChild(new s.Service.RPCMethod(this,o,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(o);else{if(!g.isExtend(r))throw Error("not a valid definition: "+JSON.stringify(r));if(o=this.ptr.resolve(r.ref,!0))r.fields.forEach(function(t){if(null!==o.getChild(0|t.id))throw Error("duplicate extended field id in "+o.name+": "+t.id);if(o.extensions){var r=!1;if(o.extensions.forEach(function(e){t.id>=e[0]&&t.id<=e[1]&&(r=!0)}),!r)throw Error("illegal extended field id in "+o.name+": "+t.id+" (not within valid ranges)")}var e=t.name,e=(this.options.convertFieldsToCamelCase&&(e=l.Util.toCamelCase(e)),new s.Message.ExtensionField(this,o,t.rule,t.type,this.ptr.fqn()+"."+e,t.id,t.options)),n=new s.Extension(this,this.ptr,t.name,e);e.extension=n,this.ptr.addChild(n),o.addChild(e)},this);else if(!/\.?google\.protobuf\./.test(r.ref))throw Error("extended message "+r.ref+" is not defined")}o=r=null}e=null,this.ptr=this.ptr.parent}this.resolved=!1,this.result=null}return this},r.import=function(t,e){var r="/";if("string"==typeof e){if(l.Util.IS_NODE&&(e=require("path").resolve(e)),!0===this.files[e])return this.reset();this.files[e]=!0}else if("object"==typeof e){var n=e.root,n=((0<=(n=l.Util.IS_NODE?require("path").resolve(n):n).indexOf("\\")||0<=e.file.indexOf("\\"))&&(r="\\"),n+r+e.file);if(!0===this.files[n])return this.reset();this.files[n]=!0}if(t.imports&&0<t.imports.length){var o,n=!1;"object"==typeof e?(this.importRoot=e.root,n=!0,o=this.importRoot,e=e.file,(0<=o.indexOf("\\")||0<=e.indexOf("\\"))&&(r="\\")):"string"==typeof e?this.importRoot?o=this.importRoot:0<=e.indexOf("/")?""===(o=e.replace(/\/[^\/]*$/,""))&&(o="/"):0<=e.indexOf("\\")?(o=e.replace(/\\[^\\]*$/,""),r="\\"):o=".":o=null;for(var i=0;i<t.imports.length;i++)if("string"==typeof t.imports[i]){if(!o)throw Error("cannot determine import root");var a=t.imports[i];if("google/protobuf/descriptor.proto"!==a&&!0!==this.files[a=o+r+a]){/\.proto$/i.test(a)&&!l.DotProto&&(a=a.replace(/\.proto$/,".json"));var s=l.Util.fetch(a);if(null===s)throw Error("failed to import '"+a+"' in '"+e+"': file not found");/\.json$/i.test(a)?this.import(JSON.parse(s+""),a):this.import(l.DotProto.Parser.parse(s),a)}}else e?/\.(\w+)$/.test(e)?this.import(t.imports[i],e.replace(/^(.+)\.(\w+)$/,function(e,t,r){return t+"_import"+i+"."+r})):this.import(t.imports[i],e+"_import"+i):this.import(t.imports[i]);n&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&function t(r){r.messages&&r.messages.forEach(function(e){e.syntax=r.syntax,t(e)}),r.enums&&r.enums.forEach(function(e){e.syntax=r.syntax})}(t);var d=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){d.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=d),t.enums&&(this.create(t.enums),this.ptr=d),t.services&&(this.create(t.services),this.ptr=d),t.extends&&this.create(t.extends),this.reset()},r.resolveAll=function(){var e;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof s.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof s.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=l.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(e=(this.ptr instanceof s.Message.ExtensionField?this.ptr.extension:this.ptr).parent.resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if((this.ptr.resolvedType=e)instanceof s.Enum){if(this.ptr.type=l.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==e.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(e instanceof s.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=e.isGroup?l.TYPES.group:l.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=l.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof l.Reflect.Service.Method){if(!(this.ptr instanceof l.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((e=this.ptr.parent.resolve(this.ptr.requestName,!0))&&e instanceof l.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=e,!((e=this.ptr.parent.resolve(this.ptr.responseName,!0))&&e instanceof l.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=e}else if(!(this.ptr instanceof l.Reflect.Message.OneOf||this.ptr instanceof l.Reflect.Extension||this.ptr instanceof l.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},r.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(var t="string"==typeof e?e.split("."):e,r=this.result,n=0;n<t.length;n++){if(!r[t[n]]){r=null;break}r=r[t[n]]}return r},r.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},r.toString=function(){return"Builder"},g.Message=function(){},g.Enum=function(){},g.Service=function(){},g),u.Map=(d=u.Reflect,(n=y.prototype).clear=function(){this.map={}},n.delete=function(e){var e=this.keyElem.valueToString(this.keyElem.verifyValue(e)),t=e in this.map;return delete this.map[e],t},n.entries=function(){for(var e,t=[],r=Object.keys(this.map),n=0;n<r.length;n++)t.push([(e=this.map[r[n]]).key,e.value]);return v(t)},n.keys=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return v(e)},n.values=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return v(e)},n.forEach=function(e,t){for(var r,n=Object.keys(this.map),o=0;o<n.length;o++)e.call(t,(r=this.map[n[o]]).value,r.key,this)},n.set=function(e,t){e=this.keyElem.verifyValue(e),t=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(e)]={key:e,value:t},this},n.get=function(e){e=this.keyElem.valueToString(this.keyElem.verifyValue(e));if(e in this.map)return this.map[e].value},n.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},y),u.loadProto=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=void 0),u.loadJson(u.DotProto.Parser.parse(e),t,r)},u.protoFromString=u.loadProto,u.loadProtoFile=function(t,r,n){var e;return r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r?u.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null===e)r(Error("Failed to fetch file"));else try{r(null,u.loadProto(e,n,t))}catch(e){r(e)}}):null===(e=u.Util.fetch("object"==typeof t?t.root+"/"+t.file:t))?null:u.loadProto(e,n,t)},u.protoFromFile=u.loadProtoFile,u.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=u.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=u.populateAccessors),new u.Builder(e)},u.loadJson=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=null),t&&"object"==typeof t||(t=u.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,r),t.resolveAll(),t},u.loadJsonFile=function(t,r,n){var e;return r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r?u.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null===e)r(Error("Failed to fetch file"));else try{r(null,u.loadJson(JSON.parse(e),n,t))}catch(e){r(e)}}):null===(e=u.Util.fetch("object"==typeof t?t.root+"/"+t.file:t))?null:u.loadJson(JSON.parse(e),n,t)},u}),SdpSerializer.SerializeASBandwidth=function(e,t){return t=t||{},e=(e=(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+(t.audio||50)+"\r\n")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(t.video||256)+"\r\n")).replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+(t.data||1638400)+"\r\n")},SdpSerializer.SerializePTime=function(e,t){return e=(e=e.replace("a=fmtp:111 minptime=10","a=fmtp:111 minptime="+((t=t||{}).minptime||10))).replace("a=maxptime:60","a=maxptime:"+(t.maxptime||60))},SdpSerializer.SerializeGoogleMinBitrate=function(e,t){return e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\na=rtpmap:120 VP8/90000\r\na=fmtp:120 \t\t\t\t\t\t\tx-google-min-bitrate="+(t||10)+"\r\n")},SdpSerializer.RTPOverTCP=function(e){return e.replace(/a=candidate:.*udp.*\r\n/g,"")};var SDPTransform=function(){function i(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return s.apply(null,n)}var u={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"sdptype",reg:/^sdptype:([\w-_]*)/,format:"sdptype:%s"},{push:"t3s",reg:/^t3:(\w*) ([\S|]*)/,names:["type","config"],format:"t3:%s %s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s",t=(t+=null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v");return null!=e.generation&&(t+=" generation %d"),t=(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value)&&(t+=":%s"),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]},a=(Object.keys(u).forEach(function(e){u[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),function(e){return String(Number(e))===e?Number(e):e}),c=function(e,t,r,n){if(n&&!r)t[n]=a(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=a(e[o+1]))},r=RegExp.prototype.test.bind(/^([a-z])=(.*)/),t=(this.parse=function(e){var t={},d=[],l=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(d.push({rtp:[],fmtp:[]}),l=d[d.length-1]);for(var n,o,i,a=0;a<(u[t]||[]).length;a+=1){var s=u[t][a];if(s.reg.test(r))return n=l,o=r,void 0,i=void 0,i=(s=s).name&&s.names,s.push&&!n[s.push]?n[s.push]=[]:i&&!n[s.name]&&(n[s.name]={}),i=s.push?{}:i?n[s.name]:n,c(o.match(s.reg),i,s.names,s.name),void(s.push&&n[s.push].push(i))}}),t.media=d,t},this.paramReducer=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=a(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e},this.parseParams=function(e){return e.split(/\;\s?/).reduce(paramReducer,{})},this.parseFmtpConfig=this.parseParams,this.parsePayloads=function(e){return e.split(" ").map(Number)},this.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(a),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},this.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(paramReducer,{})})},this.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=a(e):(t=a(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})},/%[sdv%]/g),s=function(e){var r=1,n=arguments,o=n.length;return e.replace(t,function(e){if(o<=r)return e;var t=n[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},d=["v","o","s","i","u","e","p","c","b","t","r","z","a"],l=["i","c","b","a"];this.writer=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||d,n=t.innerOrder||l,o=[];return r.forEach(function(r){u[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(i(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(i(r,t,e))})})}),e.media.forEach(function(e){o.push(i("m",u.m[0],e)),n.forEach(function(r){u[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(i(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(i(r,t,e))})})})}),o.join("\r\n")+"\r\n"},this.mediaWriter=function(e,t){t=t||{},null==e.payloads&&(e.payloads="");t.outerOrder;var t=t.innerOrder||l,n=[];return n.push(i("m",u.m[0],e)),t.forEach(function(r){u[r].forEach(function(t){t.name in e&&null!=e[t.name]?n.push(i(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){n.push(i(r,t,e))})})}),n.join("\r\n")+"\r\n"},this.ssrcGroupsAndSsrcsWriter=function(e,t,r){r=r||{};var n=r.innerOrder||l,o=[];return e&&e.forEach(function(r){n.forEach(function(t){u[t].forEach(function(e){"ssrcGroups"==e.push&&o.push(i(t,e,r))})})}),t&&t.forEach(function(r){n.forEach(function(t){u[t].forEach(function(e){"ssrcs"==e.push&&o.push(i(t,e,r))})})}),o.join("\r\n")+"\r\n"}};function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}function debugout(){var e,t,r,s=this;s.realTimeLoggingOn=!0,s.useTimestamps=!1,s.useLocalStorage=!1,s.recordLogs=!0,s.autoTrim=!0,s.maxLines=2e5,s.tailNumLines=100,s.logFilename="debugout.txt",s.maxDepth=25,s.depth=0,s.parentSizes=[0],s.currentResult="",s.startTime=new Date,s.output="",s.logLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},this.version=function(){return"0.5.0"},this.getLog=function(){var e,t=new Date;return s.recordLogs||s.log("[debugout.js] log recording is off."),s.useLocalStorage&&(e=window.localStorage.getItem("debugout.js"))&&(e=JSON.parse(e),s.startTime=new Date(e.startTime),s.output=e.log,t=new Date(e.lastLog)),s.output+"\n---- Log retrieved: "+t+" ----\n"+s.formatSessionDuration(s.startTime,t)},this.tail=function(e){e=e||s.tailLines;return s.trimLog(s.getLog(),e)},this.search=function(e){for(var t=s.output.split("\n"),r=new RegExp(e),n=[],o=0;o<t.length;o++){var i="["+o+"] ";t[o].match(r)&&n.push(i+t[o])}var a=n.join("\n");return a=0==a.length?'Nothing found for "'+e+'".':a},this.getSlice=function(e,t){return s.output.split("\n").slice(e,e+t).join("\n")},this.downloadLog=function(){var e="data:text/plain;charset=utf-8,",t=s.getLog(),t=(e+=encodeURIComponent(t),document.createElement("a"));t.href=e,t.target="_blank",t.download=s.logFilename,document.body.appendChild(t),t.click(),t.remove()},this.clear=function(){var e=new Date;s.output="---- Log cleared: "+e+" ----\n",s.useLocalStorage&&(e={startTime:s.startTime,log:s.output,lastLog:e},e=JSON.stringify(e),window.localStorage.setItem("debugout.js",e)),s.realTimeLoggingOn&&console.log("[debugout.js] clear()")},this.track=function(e){s.log(s.logLevel.track,e)},this.debug=function(e){s.log(s.logLevel.debug,e)},this.info=function(e){s.log(s.logLevel.info,e)},this.error=function(e){s.log(s.logLevel.error,e)},this.log=function(e,t){s.realTimeLoggingOn&&(e==this.logLevel.trace?console.trace(t):e==this.logLevel.debug?console.debug(t):e!=this.logLevel.info&&e==this.logLevel.error?console.error(t):console.info(t));var r=s.determineType(t);null!=r&&s.recordLogs&&(r=s.formatType(r,t),s.useTimestamps&&(t=new Date,s.output+=s.formatTimestamp(t)),e==this.logLevel.trace?s.output+="TRACK - ":e==this.logLevel.debug?s.output+="DEBUG - ":e!=this.logLevel.info&&e==this.logLevel.error?s.output+="ERROR - ":s.output+="INFO - ",s.output+=r+"\n",s.autoTrim&&(s.output=s.trimLog(s.output,s.maxLines)),s.useLocalStorage)&&(t=new Date,e={startTime:s.startTime,log:s.output,lastLog:t},e=JSON.stringify(e),window.localStorage.setItem("debugout.js",e)),s.depth=0,s.parentSizes=[0],s.currentResult=""},this.determineType=function(e){var t;return null!=e?"object"==(t=typeof e)?null==e.length?"function"==typeof e.getTime?"Date":"function"==typeof e.test?"RegExp":"Object":"Array":t:null},this.formatType=function(e,t){if(s.maxDepth&&s.depth>=s.maxDepth)return"... (max-depth reached)";switch(e){case"Object":s.currentResult+="{\n",s.depth++,s.parentSizes.push(s.objectSize(t));var r,n=0;for(r in t){s.currentResult+=s.indentsForDepth(s.depth),s.currentResult+=r+": ";var o=s.determineType(t[r]);(i=s.formatType(o,t[r]))&&(s.currentResult+=i),n!=s.parentSizes[s.depth]-1&&(s.currentResult+=","),s.currentResult+="\n",n++}if(s.depth--,s.parentSizes.pop(),s.currentResult+=s.indentsForDepth(s.depth),s.currentResult+="}",0==s.depth)return s.currentResult;break;case"Array":s.currentResult+="[",s.depth++,s.parentSizes.push(t.length);for(var i,n=0;n<t.length;n++)"Object"!=(o=s.determineType(t[n]))&&"Array"!=o||(s.currentResult+="\n"+s.indentsForDepth(s.depth)),(i=s.formatType(o,t[n]))?(s.currentResult+=i,n!=s.parentSizes[s.depth]-1&&(s.currentResult+=", "),"Array"==o&&(s.currentResult+="\n")):(n!=s.parentSizes[s.depth]-1&&(s.currentResult+=", "),"Object"==o&&n!=s.parentSizes[s.depth]-1||(s.currentResult+="\n"));if(s.depth--,s.parentSizes.pop(),s.currentResult+="]",0==s.depth)return s.currentResult;break;case"function":for(var a=(t+="").split("\n"),n=0;n<a.length;n++)a[n].match(/\}/)&&s.depth--,s.currentResult+=s.indentsForDepth(s.depth),a[n].match(/\{/)&&s.depth++,s.currentResult+=a[n]+"\n";return s.currentResult;case"RegExp":return"/"+t.source+"/";case"Date":case"string":return 0<s.depth||0==t.length?'"'+t+'"':t;case"boolean":return t?"true":"false";case"number":return t+""}},this.indentsForDepth=function(e){for(var t="",r=0;r<e;r++)t+="\t";return t},this.trimLog=function(e,t){e=e.split("\n");return(e=e.length>t?e.slice(e.length-t):e).join("\n")},this.lines=function(){return s.output.split("\n").length},this.formatSessionDuration=function(e,t){var t=t-e,e=Math.floor(t/1e3/60/60),r=("0"+e).slice(-2),e=(t-=1e3*e*60*60,Math.floor(t/1e3/60)),n=("0"+e).slice(-2),e=(t-=1e3*e*60,Math.floor(t/1e3));return"---- Session duration: "+r+":"+n+":"+("0"+e).slice(-2)+" ----"},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+" "+e.getMilliseconds()+"]: "},this.objectSize=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},s.useLocalStorage&&(e=window.localStorage.getItem("debugout.js"))&&(e=JSON.parse(e),s.output=e.log,t=new Date(e.startTime),r=new Date(e.lastLog),s.output+="\n---- Session end: "+e.lastLog+" ----\n",s.output+=s.formatSessionDuration(t,r),s.output+="\n\n"),s.output+="---- Session started: "+s.startTime+" ----\n\n"}!function(T){("function"==typeof define&&define.amd?define:function(e){window.when=e()})(function(){function m(e,t,r,n){return s(e).then(t,r,n)}function a(e,t){this.then=e,this.inspect=t}function s(t){return c(function(e){e(t)})}function c(e){function t(e){d&&(s=o(e),u(d,s),d=I)}function r(e){t(l(e))}function n(e){d&&u(d,function n(o){var i=new a(function(e,t,r){try{return"function"==typeof r?n(r(o)):i}catch(e){return n(e)}});return i}(e))}var s,d=[];try{e(t,r,n)}catch(e){r(e)}return new a(function(o,i,a){return c(function(t,r,n){d?d.push(function(e){e.then(o,i,a).then(t,r,n)}):h(function(){s.then(o,i,a).then(t,r,n)})})},function(){return s?s.inspect():{state:"pending"}})}function o(o){return o instanceof a?o:o===Object(o)&&"then"in o?c(function(t,r,n){h(function(){try{var e=o.then;"function"==typeof e?b(e,o,t,r,n):t(i(o))}catch(e){r(e)}})}):i(o)}function i(t){var r=new a(function(e){try{return"function"==typeof e?o(e(t)):r}catch(e){return l(e)}},function(){return n(t)});return r}function l(r){var n=new a(function(e,t){try{return"function"==typeof t?o(t(r)):n}catch(e){return l(e)}},function(){return t(r)});return n}function u(r,n){h(function(){for(var e,t=0;e=r[t++];)e(n)})}function d(e,f,t,r,n){return m(e,function(h){return c(function(t,r,e){function n(e){a(e)}function o(e){i(e)}var i,a,s,d=h.length>>>0,l=Math.max(0,Math.min(f,d)),u=[],c=d-l+1,p=[];if(l)for(a=function(e){p.push(e),--c||(i=a=g,r(p))},i=function(e){u.push(e),--l||(i=a=g,t(u))},s=0;s<d;++s)s in h&&m(h[s],o,n,e);else t(u)}).then(t,r,n)})}function r(e,t,r,n){return p(e,g).then(t,r,n)}function p(e,l,u){return m(e,function(d){return c(function(r,n,o){var e,t,i,a=e=d.length>>>0,s=[];if(a)for(t=function(e,t){m(e,l,u).then(function(e){s[t]=e,--a||r(s)},n,o)},i=0;i<e;i++)i in d?t(d[i],i):--a;else r(s)})})}function n(e){return{state:"fulfilled",value:e}}function t(e){return{state:"rejected",reason:e}}function h(e){1===S.push(e)&&_(f)}function f(){for(var e,t=0;e=S[t++];)e();S=[]}function g(e){return e}var y,v,b,_,S,w,e,E,I;return m.defer=function(){var o,i,e={promise:I,resolve:I,reject:I,notify:I,resolver:{resolve:I,reject:I,notify:I}};return e.promise=o=c(function(t,r,n){e.resolve=e.resolver.resolve=function(e){return i?s(e):(i=!0,t(e),o)},e.reject=e.resolver.reject=function(e){return i?s(l(e)):(i=!0,r(e),o)},e.notify=e.resolver.notify=function(e){return n(e),e}}),e},m.resolve=s,m.reject=function(e){return m(e,l)},m.join=function(){return p(arguments,g)},m.all=r,m.map=function(e,t){return p(e,t)},m.reduce=function(e,i){var t=b(v,arguments,1);return m(e,function(e){var o=e.length;return t[0]=function(e,r,n){return m(e,function(t){return m(r,function(e){return i(t,e,n,o)})})},y.apply(e,t)})},m.settle=function(e){return p(e,n,t)},m.any=function(e,t,r,n){return d(e,1,function(e){return t?t(e[0]):e[0]},r,n)},m.some=d,m.isPromise=function(e){return e&&"function"==typeof e.then},m.promise=c,a.prototype={otherwise:function(e){return this.then(I,e)},ensure:function(e){function t(){return s(e())}return this.then(t,t).yield2(this)},yield2:function(e){return this.then(function(){return e})},spread:function(t){return this.then(function(e){return r(e,function(e){return t.apply(I,e)})})},always:function(e,t){return this.then(e,e,t)}},S=[],w=T.setTimeout,_="function"==typeof setImmediate?setImmediate.bind(T):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(e){w(e,0)},e=(E=Function.prototype).call,b=E.bind?e.bind(e):function(e,t){return e.apply(t,v.call(arguments,2))},v=(E=[]).slice,y=E.reduce||function(e){var t,r=0,n=Object(this),o=n.length>>>0,i=arguments;if(i.length<=1)for(;;){if(r in n){t=n[r++];break}if(++r>=o)throw new TypeError}else t=i[1];for(;r<o;++r)r in n&&(t=e(t,n[r],r,n));return t},m})}(this),EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=500,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,r,n,o,i,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(isUndefined(r=this._events[e]))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];r.apply(this,o)}else if(isObject(r)){for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];for(n=(a=r.slice()).length,i=0;i<n;i++)a[i].apply(this,o)}return!0},EventEmitter.prototype.addListener=function(e,t){if(isFunction(t))return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(t=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&0<t&&this._events[e].length>t&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace)&&console.trace(),this;throw TypeError("listener must be a function")},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){var r;if(isFunction(t))return r=!1,n.listener=t,this.on(e,n),this;throw TypeError("listener must be a function");function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}},EventEmitter.prototype.removeListener=function(e,t){var r,n,o,i;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events&&this._events[e])if(o=(r=this._events[e]).length,n=-1,r===t||isFunction(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(r)){for(i=o;0<i--;)if(r[i]===t||r[i].listener&&r[i].listener===t){n=i;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,r;if(this._events)if(this._events.removeListener)if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);this.removeAllListeners("removeListener"),this._events={}}else{if(isFunction(r=this._events[e]))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);delete this._events[e]}else 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e];return this},EventEmitter.prototype.listeners=function(e){e=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[];return e},EventEmitter.listenerCount=function(e,t){e=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0;return e},!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).zrender={})}(this,function(e){"use strict";var E=function(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1},a=new function(){this.browser=new E,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow="undefined"!=typeof window};"object"==typeof wx&&"function"==typeof wx.getSystemInfoSync?(a.wxa=!0,a.touchEventsSupported=!0):"undefined"==typeof document&&"undefined"!=typeof self?a.worker=!0:"undefined"==typeof navigator?(a.node=!0,a.svgSupported=!0):($=navigator.userAgent,t=(he=a).browser,se=$.match(/Firefox\/([\d.]+)/),j=$.match(/MSIE\s([\d.]+)/)||$.match(/Trident\/.+?rv:(([\d.]+))/),Z=$.match(/Edge?\/([\d.]+)/),$=/micromessenger/i.test($),se&&(t.firefox=!0,t.version=se[1]),j&&(t.ie=!0,t.version=j[1]),Z&&(t.edge=!0,t.version=Z[1],t.newEdge=18<+Z[1].split(".")[0]),$&&(t.weChat=!0),he.svgSupported="undefined"!=typeof SVGRect,he.touchEventsSupported="ontouchstart"in window&&!t.ie&&!t.edge,he.pointerEventsSupported="onpointerdown"in window&&(t.edge||t.ie&&11<=+t.version),he.domSupported="undefined"!=typeof document,se=document.documentElement.style,he.transform3dSupported=(t.ie&&"transition"in se||t.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in se)&&!("OTransition"in se),he.transformSupported=he.transform3dSupported||t.ie&&9<=+t.version);var I=12,T="sans-serif",Q=I+"px "+T;var R,P,x=function(e){var t={};if("undefined"!=typeof JSON)for(var r=0;r<e.length;r++){var n=String.fromCharCode(r+32),o=(e.charCodeAt(r)-20)/100;t[n]=o}return t}("007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N"),M={createCanvas:function(){return"undefined"!=typeof document&&document.createElement("canvas")},measureText:function(e,t){if(R||(r=M.createCanvas(),R=r&&r.getContext("2d")),R)return P!==t&&(P=R.font=t||Q),R.measureText(e);e=e||"",t=t||Q;var r=/^([0-9]*?)px$/.exec(t),n=+(r&&r[1])||I,o=0;if(0<=t.indexOf("mono"))o=n*e.length;else for(var i=0;i<e.length;i++){var a=x[e[i]];o+=null==a?n:a*n}return{width:o}},loadImage:function(e,t,r){var n=new Image;return n.onload=t,n.onerror=r,n.src=e,n}};var H=ce(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(e,t){return e["[object "+t+"]"]=!0,e},{}),N=ce(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(e,t){return e["[object "+t+"Array]"]=!0,e},{}),B=Object.prototype.toString,j=Array.prototype,V=j.forEach,F=j.filter,q=j.slice,G=j.map,Z=function(){}.constructor,$=Z?Z.prototype:null,ee="__proto__",te=2311;function re(){return te++}function ne(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"undefined"!=typeof console&&console.error.apply(console,e)}function oe(e){if(null==e||"object"!=typeof e)return e;var t=e,r=B.call(e);if("[object Array]"===r){if(!Me(e))for(var t=[],n=0,o=e.length;n<o;n++)t[n]=oe(e[n])}else if(N[r]){if(!Me(e)){var i=e.constructor;if(i.from)t=i.from(e);else{t=new i(e.length);for(n=0,o=e.length;n<o;n++)t[n]=e[n]}}}else if(!H[r]&&!Me(e)&&!Se(e))for(var a in t={},e)e.hasOwnProperty(a)&&a!==ee&&(t[a]=oe(e[a]));return t}function ie(e,t,r){if(!ve(t)||!ve(e))return r?oe(t):e;for(var n in t){var o,i;t.hasOwnProperty(n)&&n!==ee&&(o=e[n],!ve(i=t[n])||!ve(o)||fe(i)||fe(o)||Se(i)||Se(o)||be(i)||be(o)||Me(i)||Me(o)?!r&&n in e||(e[n]=oe(t[n])):ie(o,i,r))}return e}function O(e,t){if(Object.assign)Object.assign(e,t);else for(var r in t)t.hasOwnProperty(r)&&r!==ee&&(e[r]=t[r]);return e}function ae(e,t,r){for(var n=U(t),o=0;o<n.length;o++){var i=n[o];(r?null!=t[i]:null==e[i])&&(e[i]=t[i])}return e}var se=M.createCanvas;function de(e,t){if(e){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r}return-1}function le(e,t,r){if(e="prototype"in e?e.prototype:e,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames)for(var n=Object.getOwnPropertyNames(t),o=0;o<n.length;o++){var i=n[o];"constructor"!==i&&(r?null!=t[i]:null==e[i])&&(e[i]=t[i])}else ae(e,t,r)}function ue(e){return!!e&&"string"!=typeof e&&"number"==typeof e.length}function w(e,t,r){if(e&&t)if(e.forEach&&e.forEach===V)e.forEach(t,r);else if(e.length===+e.length)for(var n=0,o=e.length;n<o;n++)t.call(r,e[n],n,e);else for(var i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}function L(e,t,r){if(!e)return[];if(!t)return Ce(e);if(e.map&&e.map===G)return e.map(t,r);for(var n=[],o=0,i=e.length;o<i;o++)n.push(t.call(r,e[o],o,e));return n}function ce(e,t,r,n){if(e&&t){for(var o=0,i=e.length;o<i;o++)r=t.call(n,r,e[o],o,e);return r}}function pe(e,t,r){if(!e)return[];if(!t)return Ce(e);if(e.filter&&e.filter===F)return e.filter(t,r);for(var n=[],o=0,i=e.length;o<i;o++)t.call(r,e[o],o,e)&&n.push(e[o]);return n}function U(e){if(!e)return[];if(Object.keys)return Object.keys(e);var t,r=[];for(t in e)e.hasOwnProperty(t)&&r.push(t);return r}var he=$&&me($.bind)?$.call.bind($.bind):function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return function(){return e.apply(t,r.concat(q.call(arguments)))}};function fe(e){return Array.isArray?Array.isArray(e):"[object Array]"===B.call(e)}function me(e){return"function"==typeof e}function ge(e){return"string"==typeof e}function ye(e){return"number"==typeof e}function ve(e){var t=typeof e;return"function"==t||!!e&&"object"==t}function be(e){return!!H[B.call(e)]}function _e(e){return!!N[B.call(e)]}function Se(e){return"object"==typeof e&&"number"==typeof e.nodeType&&"object"==typeof e.ownerDocument}function we(e){return null!=e.colorStops}function Ee(e){return null!=e.image}function Ie(e){return e!=e}function A(e,t){return null!=e?e:t}function Te(e,t,r){return null!=e?e:null!=t?t:r}function Ce(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return q.apply(e,t)}function Re(e){var t;return"number"==typeof e?[e,e,e,e]:2===(t=e.length)?[e[0],e[1],e[0],e[1]]:3===t?[e[0],e[1],e[2],e[1]]:e}function Pe(e,t){if(!e)throw new Error(t)}function ke(e){return null==e?null:"function"==typeof e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var xe="__ec_primitive__";function Me(e){return e[xe]}Oe.prototype.get=function(e){return this.data.hasOwnProperty(e)?this.data[e]:null},Oe.prototype.set=function(e,t){return this.data[e]=t},Oe.prototype.each=function(e,t){for(var r in this.data)this.data.hasOwnProperty(r)&&e.call(t,this.data[r],r)},Oe.prototype.keys=function(){return U(this.data)},Oe.prototype.removeKey=function(e){delete this.data[e]};var Ae=Oe;function Oe(e){this.data={};var r=fe(e),n=(this.data={},this);function t(e,t){r?n.set(e,t):n.set(t,e)}e instanceof Oe?e.each(t):e&&w(e,t)}function Ue(e,t){var r,e=Object.create?Object.create(e):((r=function(){}).prototype=e,new r);return t&&O(e,t),e}function De(e){e=e.style;e.webkitUserSelect="none",e.userSelect="none",e.webkitTapHighlightColor="rgba(0,0,0,0)",e["-webkit-touch-callout"]="none"}function He(e,t){return e.hasOwnProperty(t)}function Le(){}var Ne=180/Math.PI,t=Object.freeze({__proto__:null,guid:re,logError:ne,clone:oe,merge:ie,mergeAll:function(e,t){for(var r=e[0],n=1,o=e.length;n<o;n++)r=ie(r,e[n],t);return r},extend:O,defaults:ae,createCanvas:se,indexOf:de,inherits:function(e,t){var r,n=e.prototype;function o(){}for(r in o.prototype=t.prototype,e.prototype=new o,n)n.hasOwnProperty(r)&&(e.prototype[r]=n[r]);(e.prototype.constructor=e).superClass=t},mixin:le,isArrayLike:ue,each:w,map:L,reduce:ce,filter:pe,find:function(e,t,r){if(e&&t)for(var n=0,o=e.length;n<o;n++)if(t.call(r,e[n],n,e))return e[n]},keys:U,bind:he,curry:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(){return e.apply(this,t.concat(q.call(arguments)))}},isArray:fe,isFunction:me,isString:ge,isStringSafe:function(e){return"[object String]"===B.call(e)},isNumber:ye,isObject:ve,isBuiltInObject:be,isTypedArray:_e,isDom:Se,isGradientObject:we,isImagePatternObject:Ee,isRegExp:function(e){return"[object RegExp]"===B.call(e)},eqNaN:Ie,retrieve:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e.length;r<n;r++)if(null!=e[r])return e[r]},retrieve2:A,retrieve3:Te,slice:Ce,normalizeCssArray:Re,assert:Pe,trim:ke,setAsPrimitive:function(e){e[xe]=!0},isPrimitive:Me,HashMap:Ae,createHashMap:function(e){return new Ae(e)},concatArray:function(e,t){for(var r=new e.constructor(e.length+t.length),n=0;n<e.length;n++)r[n]=e[n];for(var o=e.length,n=0;n<t.length;n++)r[n+o]=t[n];return r},createObject:Ue,disableUserSelect:De,hasOwn:He,noop:Le,RADIAN_TO_DEGREE:Ne}),Be=function(e,t){return(Be=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}))(e,t)};function i(e,t){function r(){this.constructor=e}Be(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function je(e,t){return[e=null==e?0:e,t=null==t?0:t]}function Ve(e){return[e[0],e[1]]}function Fe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function qe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Ge(e){return Math.sqrt(We(e))}function We(e){return e[0]*e[0]+e[1]*e[1]}function ze(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Ye(e,t){var r=Ge(t);return 0===r?(e[0]=0,e[1]=0):(e[0]=t[0]/r,e[1]=t[1]/r),e}function Ke(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var Xe=Ke;function Je(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var Qe=Je;function Ze(e,t,r,n){return e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e}function $e(e,t,r){var n=t[0],t=t[1];return e[0]=r[0]*n+r[2]*t+r[4],e[1]=r[1]*n+r[3]*t+r[5],e}function et(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function tt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}var rt=Object.freeze({__proto__:null,create:je,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},clone:Ve,set:function(e,t,r){return e[0]=t,e[1]=r,e},add:Fe,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},sub:qe,len:Ge,length:Ge,lenSquare:We,lengthSquare:We,mul:function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},div:function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},scale:ze,normalize:Ye,distance:Ke,dist:Xe,distanceSquare:Je,distSquare:Qe,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},lerp:Ze,applyTransform:$e,min:et,max:tt}),nt=function(e,t){this.target=e,this.topTarget=t&&t.topTarget},ot=(it.prototype._dragStart=function(e){for(var t=e.target;t&&!t.draggable;)t=t.parent||t.__hostTarget;t&&((this._draggingTarget=t).dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.handler.dispatchToElement(new nt(t,e),"dragstart",e.event))},it.prototype._drag=function(e){var t,r,n,o,i=this._draggingTarget;i&&(t=e.offsetX,r=e.offsetY,n=t-this._x,o=r-this._y,this._x=t,this._y=r,i.drift(n,o,e),this.handler.dispatchToElement(new nt(i,e),"drag",e.event),n=this.handler.findHover(t,r,i).target,o=this._dropTarget,i!==(this._dropTarget=n))&&(o&&n!==o&&this.handler.dispatchToElement(new nt(o,e),"dragleave",e.event),n)&&n!==o&&this.handler.dispatchToElement(new nt(n,e),"dragenter",e.event)},it.prototype._dragEnd=function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.handler.dispatchToElement(new nt(t,e),"dragend",e.event),this._dropTarget&&this.handler.dispatchToElement(new nt(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null},it);function it(e){(this.handler=e).on("mousedown",this._dragStart,this),e.on("mousemove",this._drag,this),e.on("mouseup",this._dragEnd,this)}st.prototype.on=function(e,t,r,n){this._$handlers||(this._$handlers={});var o=this._$handlers;if("function"==typeof t&&(n=r,r=t,t=null),r&&e){var i=this._$eventProcessor;null!=t&&i&&i.normalizeQuery&&(t=i.normalizeQuery(t)),o[e]||(o[e]=[]);for(var a=0;a<o[e].length;a++)if(o[e][a].h===r)return this;i={h:r,query:t,ctx:n||this,callAtLast:r.zrEventfulCallAtLast},t=o[e].length-1,n=o[e][t];n&&n.callAtLast?o[e].splice(t,0,i):o[e].push(i)}return this},st.prototype.isSilent=function(e){var t=this._$handlers;return!t||!t[e]||!t[e].length},st.prototype.off=function(e,t){var r=this._$handlers;if(r)if(e)if(t){if(r[e]){for(var n=[],o=0,i=r[e].length;o<i;o++)r[e][o].h!==t&&n.push(r[e][o]);r[e]=n}r[e]&&0===r[e].length&&delete r[e]}else delete r[e];else this._$handlers={};return this},st.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(this._$handlers){var n=this._$handlers[e],o=this._$eventProcessor;if(n)for(var i=t.length,a=n.length,s=0;s<a;s++){var d=n[s];if(!o||!o.filter||null==d.query||o.filter(e,d.query))switch(i){case 0:d.h.call(d.ctx);break;case 1:d.h.call(d.ctx,t[0]);break;case 2:d.h.call(d.ctx,t[0],t[1]);break;default:d.h.apply(d.ctx,t)}}o&&o.afterTrigger&&o.afterTrigger(e)}return this},st.prototype.triggerWithContext=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(this._$handlers){var n=this._$handlers[e],o=this._$eventProcessor;if(n)for(var i=t.length,a=t[i-1],s=n.length,d=0;d<s;d++){var l=n[d];if(!o||!o.filter||null==l.query||o.filter(e,l.query))switch(i){case 0:l.h.call(a);break;case 1:l.h.call(a,t[0]);break;case 2:l.h.call(a,t[0],t[1]);break;default:l.h.apply(a,t.slice(1,i-1))}}o&&o.afterTrigger&&o.afterTrigger(e)}return this};var at=st;function st(e){e&&(this._$eventProcessor=e)}var dt=Math.log(2);function lt(e,t,r,n,o,i){var a,s=n+"-"+o,d=e.length;if(i.hasOwnProperty(s))return i[s];if(1===t)return a=Math.round(Math.log((1<<d)-1&~o)/dt),e[r][a];for(var l=n|1<<r,u=r+1;n&1<<u;)u++;for(var c=0,p=0,h=0;p<d;p++){var f=1<<p;f&o||(c+=(h%2?-1:1)*e[r][p]*lt(e,t-1,u,l,o|f,i),h++)}return i[s]=c}function ut(e,t){var r=[[e[0],e[1],1,0,0,0,-t[0]*e[0],-t[0]*e[1]],[0,0,0,e[0],e[1],1,-t[1]*e[0],-t[1]*e[1]],[e[2],e[3],1,0,0,0,-t[2]*e[2],-t[2]*e[3]],[0,0,0,e[2],e[3],1,-t[3]*e[2],-t[3]*e[3]],[e[4],e[5],1,0,0,0,-t[4]*e[4],-t[4]*e[5]],[0,0,0,e[4],e[5],1,-t[5]*e[4],-t[5]*e[5]],[e[6],e[7],1,0,0,0,-t[6]*e[6],-t[6]*e[7]],[0,0,0,e[6],e[7],1,-t[7]*e[6],-t[7]*e[7]]],n={},o=lt(r,8,0,0,0,n);if(0!==o){for(var i=[],a=0;a<8;a++)for(var s=0;s<8;s++)null==i[s]&&(i[s]=0),i[s]+=((a+s)%2?-1:1)*lt(r,7,0===a?1:0,1<<a,1<<s,n)/o*t[a];return function(e,t,r){var n=t*i[6]+r*i[7]+1;e[0]=(t*i[0]+r*i[1]+i[2])/n,e[1]=(t*i[3]+r*i[4]+i[5])/n}}}var ct="___zrEVENTSAVED";function pt(e,t,r,n,o){if(t.getBoundingClientRect&&a.domSupported&&!ht(t)){var i=t[ct]||(t[ct]={}),t=function(e,t,r){for(var n=r?"invTrans":"trans",o=t[n],i=t.srcCoords,a=[],s=[],d=!0,l=0;l<4;l++){var u=e[l].getBoundingClientRect(),c=2*l,p=u.left,u=u.top;a.push(p,u),d=d&&i&&p===i[c]&&u===i[1+c],s.push(e[l].offsetLeft,e[l].offsetTop)}return d&&o?o:(t.srcCoords=a,t[n]=r?ut(s,a):ut(a,s))}(function(e,t){var r=t.markers;if(!r){r=t.markers=[];for(var n=["left","right"],o=["top","bottom"],i=0;i<4;i++){var a=document.createElement("div"),s=a.style,d=i%2,l=(i>>1)%2;s.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",n[d]+":0",o[l]+":0",n[1-d]+":auto",o[1-l]+":auto",""].join("!important;"),e.appendChild(a),r.push(a)}}return r}(t,i),i,o);if(t)return t(e,r,n),1}}function ht(e){return"CANVAS"===e.nodeName.toUpperCase()}var ft=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,mt=[],gt=a.browser.firefox&&+a.browser.version.split(".")[0]<39;function yt(e,t,r,n){return r=r||{},n?vt(e,t,r):gt&&null!=t.layerX&&t.layerX!==t.offsetX?(r.zrX=t.layerX,r.zrY=t.layerY):null!=t.offsetX?(r.zrX=t.offsetX,r.zrY=t.offsetY):vt(e,t,r),r}function vt(e,t,r){if(a.domSupported&&e.getBoundingClientRect){var n,o=t.clientX,t=t.clientY;if(ht(e))return n=e.getBoundingClientRect(),r.zrX=o-n.left,void(r.zrY=t-n.top);if(pt(mt,e,o,t))return r.zrX=mt[0],void(r.zrY=mt[1])}r.zrX=r.zrY=0}function bt(e){return e||window.event}function _t(e,t,r){var n;return null==(t=bt(t)).zrX&&((n=t.type)&&0<=n.indexOf("touch")?(n=("touchend"!==n?t.targetTouches:t.changedTouches)[0])&&yt(e,n,t,r):(yt(e,t,t,r),n=function(e){var t=e.wheelDelta;if(t)return t;var r=e.deltaX,e=e.deltaY;return null!=r&&null!=e?3*(0!==e?Math.abs(e):Math.abs(r))*(0<e||!(e<0)&&0<r?-1:1):t}(t),t.zrDelta=n?n/120:-(t.detail||0)/3),e=t.button,null==t.which&&void 0!==e&&ft.test(t.type))&&(t.which=1&e?1:2&e?3:4&e?2:0),t}var St=function(e){e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0},wt=(Et.prototype.recognize=function(e,t,r){return this._doTrack(e,t,r),this._recognize(e)},Et.prototype.clear=function(){return this._track.length=0,this},Et.prototype._doTrack=function(e,t,r){var n=e.touches;if(n){for(var o={points:[],touches:[],target:t,event:e},i=0,a=n.length;i<a;i++){var s=n[i],d=yt(r,s,{});o.points.push([d.zrX,d.zrY]),o.touches.push(s)}this._track.push(o)}},Et.prototype._recognize=function(e){for(var t in Tt)if(Tt.hasOwnProperty(t)){t=Tt[t](this._track,e);if(t)return t}},Et);function Et(){this._track=[]}function It(e){var t=e[1][0]-e[0][0],e=e[1][1]-e[0][1];return Math.sqrt(t*t+e*e)}var Tt={pinch:function(e,t){var r,n=e.length;if(n)return r=(e[n-1]||{}).points,(n=(e[n-2]||{}).points||r)&&1<n.length&&r&&1<r.length?(n=It(r)/It(n),isFinite(n)||(n=1),t.pinchScale=n,n=[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2],t.pinchX=n[0],t.pinchY=n[1],{type:"pinch",target:e[0].target,event:t}):void 0}};function Ct(){St(this.event)}i(kt,Rt=at),kt.prototype.dispose=function(){},kt.prototype.setCursor=function(){};var Rt,Pt=kt;function kt(){var e=null!==Rt&&Rt.apply(this,arguments)||this;return e.handler=null,e}var xt,Mt=function(e,t){this.x=e,this.y=t},At=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],Ot=(i(Ut,xt=at),Ut.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(w(At,function(e){t.on&&t.on(e,this[e],this)},this),t.handler=this),this.proxy=t},Ut.prototype.mousemove=function(e){var t=e.zrX,r=e.zrY,n=Dt(this,t,r),o=this._hovered,i=o.target,n=(i&&!i.__zr&&(i=(o=this.findHover(o.x,o.y)).target),this._hovered=n?new Mt(t,r):this.findHover(t,r)),t=n.target,r=this.proxy;r.setCursor&&r.setCursor(""!=avdEngineHandle.eraserCustomIconPath?avdEngineHandle.eraserCustomIconPath:"default"),i&&t!==i&&this.dispatchToElement(o,"mouseout",e),this.dispatchToElement(n,"mousemove",e),t&&t!==i&&this.dispatchToElement(n,"mouseover",e)},Ut.prototype.mouseout=function(e){var t=e.zrEventControl;"only_globalout"!==t&&this.dispatchToElement(this._hovered,"mouseout",e),"no_globalout"!==t&&this.trigger("globalout",{type:"globalout",event:e})},Ut.prototype.resize=function(){this._hovered=new Mt(0,0)},Ut.prototype.dispatch=function(e,t){e=this[e];e&&e.call(this,t)},Ut.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},Ut.prototype.setCursorStyle=function(e){var t=this.proxy;t.setCursor&&t.setCursor(e)},Ut.prototype.dispatchToElement=function(e,t,r){var n=(e=e||{}).target;if(!n||!n.silent){for(var o="on"+t,i={type:t,event:r,target:(e=e).target,topTarget:e.topTarget,cancelBubble:!1,offsetX:r.zrX,offsetY:r.zrY,gestureEvent:r.gestureEvent,pinchX:r.pinchX,pinchY:r.pinchY,pinchScale:r.pinchScale,wheelDelta:r.zrDelta,zrByTouch:r.zrByTouch,which:r.which,stop:Ct};n&&(n[o]&&(i.cancelBubble=!!n[o].call(n,i)),n.trigger(t,i),n=n.__hostTarget||n.parent,!i.cancelBubble););i.cancelBubble||(this.trigger(t,i),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(e){"function"==typeof e[o]&&e[o].call(e,i),e.trigger&&e.trigger(t,i)}))}},Ut.prototype.findHover=function(e,t,r){for(var n=this.storage.getDisplayList(),o=new Mt(e,t),i=n.length-1;0<=i;i--){var a=void 0;if(n[i]!==r&&!n[i].ignore&&(a=function(e,t,r){if(e[e.rectHover?"rectContain":"contain"](t,r)){for(var n=e,o=void 0,i=!1;n;){if(!(i=n.ignoreClip?!0:i)){var a=n.getClipPath();if(a&&!a.contain(t,r))return!1;n.silent&&(o=!0)}a=n.__hostTarget;n=a||n.parent}return!o||"silent"}return!1}(n[i],e,t))&&(o.topTarget||(o.topTarget=n[i]),"silent"!==a)){o.target=n[i];break}}return o},Ut.prototype.processGesture=function(e,t){this._gestureMgr||(this._gestureMgr=new wt);var r=this._gestureMgr,n=("start"===t&&r.clear(),r.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom));"end"===t&&r.clear(),n&&(t=n.type,e.gestureEvent=t,(r=new Mt).target=n.target,this.dispatchToElement(r,t,n.event))},Ut);function Ut(e,t,r,n){var o=xt.call(this)||this;return o._hovered=new Mt(0,0),o.storage=e,o.painter=t,o.painterRoot=n,r=r||new Pt,o.proxy=null,o.setHandlerProxy(r),o._draggingMgr=new ot(o),o}function Dt(e,t,r){e=e.painter;return t<0||t>e.getWidth()||r<0||r>e.getHeight()}w(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(a){Ot.prototype[a]=function(e){var t,r,n=e.zrX,o=e.zrY,i=Dt(this,n,o);if("mouseup"===a&&i||(r=(t=this.findHover(n,o)).target),"mousedown"===a)this._downEl=r,this._downPoint=[e.zrX,e.zrY],this._upEl=r;else if("mouseup"===a)this._upEl=r;else if("click"===a){if(this._downEl!==this._upEl||!this._downPoint||4<Xe(this._downPoint,[e.zrX,e.zrY]))return;this._downPoint=null}this.dispatchToElement(t,a,e)}});var Ht=32,Lt=7;function Nt(e,t,r,n){var o=t+1;if(o===r)return 1;if(n(e[o++],e[t])<0){for(;o<r&&n(e[o],e[o-1])<0;)o++;var i=e,a=t,s=o;for(s--;a<s;){var d=i[a];i[a++]=i[s],i[s--]=d}}else for(;o<r&&0<=n(e[o],e[o-1]);)o++;return o-t}function Bt(e,t,r,n,o){for(n===t&&n++;n<r;n++){for(var i,a=e[n],s=t,d=n;s<d;)o(a,e[i=s+d>>>1])<0?d=i:s=1+i;var l=n-s;switch(l){case 3:e[s+3]=e[s+2];case 2:e[s+2]=e[s+1];case 1:e[s+1]=e[s];break;default:for(;0<l;)e[s+l]=e[s+l-1],l--}e[s]=a}}function jt(e,t,r,n,o,i){var a=0,s=0,d=1;if(0<i(e,t[r+o])){for(s=n-o;d<s&&0<i(e,t[r+o+d]);)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s),a+=o,d+=o}else{for(s=o+1;d<s&&i(e,t[r+o-d])<=0;)(d=1+((a=d)<<1))<=0&&(d=s);n=a,a=o-(d=s<d?s:d),d=o-n}for(a++;a<d;){var l=a+(d-a>>>1);0<i(e,t[r+l])?a=l+1:d=l}return d}function Vt(e,t,r,n,o,i){var a=0,s=0,d=1;if(i(e,t[r+o])<0){for(s=o+1;d<s&&i(e,t[r+o-d])<0;)(d=1+((a=d)<<1))<=0&&(d=s);var l=a,a=o-(d=s<d?s:d),d=o-l}else{for(s=n-o;d<s&&0<=i(e,t[r+o+d]);)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s),a+=o,d+=o}for(a++;a<d;){var u=a+(d-a>>>1);i(e,t[r+u])<0?d=u:a=u+1}return d}function Ft(x,M){var A,O,U=Lt,D=0,H=(x.length,[]);function t(e){var t=A[e],r=O[e],n=A[e+1],o=O[e+1],e=(O[e]=r+o,e===D-3&&(A[e+1]=A[e+2],O[e+1]=O[e+2]),D--,Vt(x[n],x,t,r,0,M));if(t+=e,0!=(r-=e)&&0!==(o=jt(x[t+r-1],x,n,o,o-1,M)))if(r<=o){var i=t,a=r,e=n,s=o,d=0;for(d=0;d<a;d++)H[d]=x[i+d];var l=0,u=e,c=i;if(x[c++]=x[u++],0==--s)for(d=0;d<a;d++)x[c+d]=H[l+d];else if(1===a){for(d=0;d<s;d++)x[c+d]=x[u+d];x[c+s]=H[l]}else{for(var p,h,f,m=U;;){h=p=0,f=!1;do{if(M(x[u],H[l])<0){if(x[c++]=x[u++],h++,(p=0)==--s){f=!0;break}}else if(x[c++]=H[l++],p++,h=0,1==--a){f=!0;break}}while((p|h)<m);if(f)break;do{if(0!==(p=Vt(x[u],H,l,a,0,M))){for(d=0;d<p;d++)x[c+d]=H[l+d];if(c+=p,l+=p,(a-=p)<=1){f=!0;break}}if(x[c++]=x[u++],0==--s){f=!0;break}if(0!==(h=jt(H[l],x,u,s,0,M))){for(d=0;d<h;d++)x[c+d]=x[u+d];if(c+=h,u+=h,0===(s-=h)){f=!0;break}}if(x[c++]=H[l++],1==--a){f=!0;break}}while(m--,Lt<=p||Lt<=h);if(f)break;m<0&&(m=0),m+=2}if((U=m)<1&&(U=1),1===a){for(d=0;d<s;d++)x[c+d]=x[u+d];x[c+s]=H[l]}else{if(0===a)throw new Error;for(d=0;d<a;d++)x[c+d]=H[l+d]}}}else{var g=t,y=r,v=n,b=o,_=0;for(_=0;_<b;_++)H[_]=x[v+_];var S=g+y-1,w=b-1,E=v+b-1,I=0,T=0;if(x[E--]=x[S--],0==--y)for(I=E-(b-1),_=0;_<b;_++)x[I+_]=H[_];else if(1===b){for(T=(E-=y)+1,I=(S-=y)+1,_=y-1;0<=_;_--)x[T+_]=x[I+_];x[E]=H[w]}else{for(var C=U;;){var R=0,P=0,k=!1;do{if(M(H[w],x[S])<0){if(x[E--]=x[S--],R++,(P=0)==--y){k=!0;break}}else if(x[E--]=H[w--],P++,R=0,1==--b){k=!0;break}}while((R|P)<C);if(k)break;do{if(0!==(R=y-Vt(H[w],x,g,y,y-1,M))){for(y-=R,T=(E-=R)+1,I=(S-=R)+1,_=R-1;0<=_;_--)x[T+_]=x[I+_];if(0===y){k=!0;break}}if(x[E--]=H[w--],1==--b){k=!0;break}if(0!==(P=b-jt(x[S],H,0,b,b-1,M))){for(b-=P,T=(E-=P)+1,I=(w-=P)+1,_=0;_<P;_++)x[T+_]=H[I+_];if(b<=1){k=!0;break}}if(x[E--]=x[S--],0==--y){k=!0;break}}while(C--,Lt<=R||Lt<=P);if(k)break;C<0&&(C=0),C+=2}if((U=C)<1&&(U=1),1===b){for(T=(E-=y)+1,I=(S-=y)+1,_=y-1;0<=_;_--)x[T+_]=x[I+_];x[E]=H[w]}else{if(0===b)throw new Error;for(I=E-(b-1),_=0;_<b;_++)x[I+_]=H[_]}}}}return A=[],O=[],{mergeRuns:function(){for(;1<D;){var e=D-2;if(1<=e&&O[e-1]<=O[e]+O[e+1]||2<=e&&O[e-2]<=O[e]+O[e-1])O[e-1]<O[e+1]&&e--;else if(O[e]>O[e+1])break;t(e)}},forceMergeRuns:function(){for(;1<D;){var e=D-2;0<e&&O[e-1]<O[e+1]&&e--,t(e)}},pushRun:function(e,t){A[D]=e,O[D]=t,D+=1}}}function qt(e,t,r,n){var o=(n=n||e.length)-(r=r||0);if(!(o<2)){var i=0;if(o<Ht)Bt(e,r,n,r+(i=Nt(e,r,n,t)),t);else{var a,s=Ft(e,t),d=function(e){for(var t=0;Ht<=e;)t|=1&e,e>>=1;return e+t}(o);do{}while((i=Nt(e,r,n,t))<d&&(Bt(e,r,r+(a=d<(a=o)?d:o),r+i,t),i=a),s.pushRun(r,i),s.mergeRuns(),r+=i,0!==(o-=i));s.forceMergeRuns()}}}var Gt=1,Wt=4,zt=!1;function Yt(){zt||(zt=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function Kt(e,t){return e.zlevel===t.zlevel?e.z===t.z?e.z2-t.z2:e.z-t.z:e.zlevel-t.zlevel}Jt.prototype.traverse=function(e,t){for(var r=0;r<this._roots.length;r++)this._roots[r].traverse(e,t)},Jt.prototype.getDisplayList=function(e,t){t=t||!1;var r=this._displayList;return!e&&r.length||this.updateDisplayList(t),r},Jt.prototype.updateDisplayList=function(e){this._displayListLen=0;for(var t=this._roots,r=this._displayList,n=0,o=t.length;n<o;n++)this._updateAndAddDisplayable(t[n],null,e);r.length=this._displayListLen,qt(r,Kt)},Jt.prototype._updateAndAddDisplayable=function(e,t,r){if(!e.ignore||r){e.beforeUpdate(),e.update(),e.afterUpdate();var n=e.getClipPath();if(e.ignoreClip)t=null;else if(n){t=t?t.slice():[];for(var o=n,i=e;o;)o.parent=i,o.updateTransform(),t.push(o),o=(i=o).getClipPath()}if(e.childrenRef){for(var a=e.childrenRef(),s=0;s<a.length;s++){var d=a[s];e.__dirty&&(d.__dirty|=Gt),this._updateAndAddDisplayable(d,t,r)}e.__dirty=0}else{n=e;t&&t.length?n.__clipPaths=t:n.__clipPaths&&0<n.__clipPaths.length&&(n.__clipPaths=[]),isNaN(n.z)&&(Yt(),n.z=0),isNaN(n.z2)&&(Yt(),n.z2=0),isNaN(n.zlevel)&&(Yt(),n.zlevel=0),this._displayList[this._displayListLen++]=n}n=e.getDecalElement&&e.getDecalElement(),n=(n&&this._updateAndAddDisplayable(n,t,r),e.getTextGuideLine()),n=(n&&this._updateAndAddDisplayable(n,t,r),e.getTextContent());n&&this._updateAndAddDisplayable(n,t,r)}},Jt.prototype.addRoot=function(e){e.__zr&&e.__zr.storage===this||this._roots.push(e)},Jt.prototype.delRoot=function(e){if(e instanceof Array)for(var t=0,r=e.length;t<r;t++)this.delRoot(e[t]);else{var n=de(this._roots,e);0<=n&&this._roots.splice(n,1)}},Jt.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},Jt.prototype.getRoots=function(){return this._roots},Jt.prototype.dispose=function(){this._displayList=null,this._roots=null};var Xt=Jt;function Jt(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=Kt}var Qt=a.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)},Zt={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},exponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),-(r*Math.pow(2,10*--e)*Math.sin((e-t)*(2*Math.PI)/.4)))},elasticOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},elasticInOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?r*Math.pow(2,10*--e)*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:r*Math.pow(2,-10*--e)*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)},backIn:function(e){return e*e*(2.70158*e-1.70158)},backOut:function(e){return--e*e*(2.70158*e+1.70158)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((1+t)*e-t)*.5:.5*((e-=2)*e*((1+t)*e+t)+2)},bounceIn:function(e){return 1-Zt.bounceOut(1-e)},bounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bounceInOut:function(e){return e<.5?.5*Zt.bounceIn(2*e):.5*Zt.bounceOut(2*e-1)+.5}},$t=Math.pow,er=Math.sqrt,tr=1e-8,rr=er(3),nr=1/3,or=je(),ir=je(),ar=je();function sr(e){return-tr<e&&e<tr}function dr(e){return tr<e||e<-tr}function W(e,t,r,n,o){var i=1-o;return i*i*(i*e+3*o*t)+o*o*(o*n+3*i*r)}function lr(e,t,r,n,o){var i=1-o;return 3*(((t-e)*i+2*(r-t)*o)*i+(n-r)*o*o)}function ur(e,t,r,n,o,i){var a,s,n=n+3*(t-r)-e,r=3*(r-2*t+e),t=3*(t-e),e=e-o,o=r*r-3*n*t,d=r*t-9*n*e,e=t*t-3*r*e,l=0;return sr(o)&&sr(d)?sr(r)?i[0]=0:0<=(a=-t/r)&&a<=1&&(i[l++]=a):sr(t=d*d-4*o*e)?(s=-(e=d/o)/2,0<=(a=-r/n+e)&&a<=1&&(i[l++]=a),0<=s&&s<=1&&(i[l++]=s)):0<t?(t=o*r+1.5*n*(-d-(e=er(t))),0<=(a=(-r-((e=(e=o*r+1.5*n*(-d+e))<0?-$t(-e,nr):$t(e,nr))+(t=t<0?-$t(-t,nr):$t(t,nr))))/(3*n))&&a<=1&&(i[l++]=a)):(e=(2*o*r-3*n*d)/(2*er(o*o*o)),t=Math.acos(e)/3,a=(-r-2*(d=er(o))*(e=Math.cos(t)))/(3*n),s=(-r+d*(e+rr*Math.sin(t)))/(3*n),o=(-r+d*(e-rr*Math.sin(t)))/(3*n),0<=a&&a<=1&&(i[l++]=a),0<=s&&s<=1&&(i[l++]=s),0<=o&&o<=1&&(i[l++]=o)),l}function cr(e,t,r,n,o){var i,a=6*r-12*t+6*e,n=9*t+3*n-3*e-9*r,r=3*t-3*e,t=0;return sr(n)?dr(a)&&0<=(i=-r/a)&&i<=1&&(o[t++]=i):sr(e=a*a-4*n*r)?o[0]=-a/(2*n):0<e&&(e=(-a-(r=er(e)))/(2*n),0<=(i=(-a+r)/(2*n))&&i<=1&&(o[t++]=i),0<=e)&&e<=1&&(o[t++]=e),t}function pr(e,t,r,n,o,i){var a=(t-e)*o+e,t=(r-t)*o+t,r=(n-r)*o+r,s=(t-a)*o+a,t=(r-t)*o+t,o=(t-s)*o+s;i[0]=e,i[1]=a,i[2]=s,i[3]=o,i[4]=o,i[5]=t,i[6]=r,i[7]=n}function z(e,t,r,n){var o=1-n;return o*(o*e+2*n*t)+n*n*r}function hr(e,t,r,n){return 2*((1-n)*(t-e)+n*(r-t))}function fr(e,t,r){r=e+r-2*t;return 0==r?.5:(e-t)/r}function mr(e,t,r,n,o){var i=(t-e)*n+e,t=(r-t)*n+t,n=(t-i)*n+i;o[0]=e,o[1]=i,o[2]=n,o[3]=n,o[4]=t,o[5]=r}var gr=/cubic-bezier\(([0-9,\.e ]+)\)/;function yr(e){e=e&&gr.exec(e);if(e){var t,e=e[1].split(","),r=+ke(e[0]),n=+ke(e[1]),o=+ke(e[2]),i=+ke(e[3]);if(!isNaN(r+n+o+i))return t=[],function(e){return e<=0?0:1<=e?1:ur(0,r,o,1,e,t)&&W(0,n,i,1,t[0])}}}br.prototype.step=function(e,t){if(this._inited||(this._startTime=e+this._delay,this._inited=!0),!this._paused){var r=this._life,n=e-this._startTime-this._pausedTime,o=n/r,i=(o<0&&(o=0),o=Math.min(o,1),this.easingFunc),i=i?i(o):o;if(this.onframe(i),1===o){if(!this.loop)return!0;this._startTime=e-n%r,this._pausedTime=0,this.onrestart()}return!1}this._pausedTime+=t},br.prototype.pause=function(){this._paused=!0},br.prototype.resume=function(){this._paused=!1},br.prototype.setEasing=function(e){this.easing=e,this.easingFunc=me(e)?e:Zt[e]||yr(e)};var vr=br;function br(e){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=e.life||1e3,this._delay=e.delay||0,this.loop=e.loop||!1,this.onframe=e.onframe||Le,this.ondestroy=e.ondestroy||Le,this.onrestart=e.onrestart||Le,e.easing&&this.setEasing(e.easing)}var _r=function(e){this.value=e},Sr=(wr.prototype.insert=function(e){e=new _r(e);return this.insertEntry(e),e},wr.prototype.insertEntry=function(e){this.head?((this.tail.next=e).prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},wr.prototype.remove=function(e){var t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t,e.next=e.prev=null,this._len--},wr.prototype.len=function(){return this._len},wr.prototype.clear=function(){this.head=this.tail=null,this._len=0},wr);function wr(){this._len=0}Ir.prototype.put=function(e,t){var r,n,o=this._list,i=this._map,a=null;return null==i[e]&&(n=o.len(),r=this._lastRemovedEntry,n>=this._maxSize&&0<n&&(n=o.head,o.remove(n),delete i[n.key],a=n.value,this._lastRemovedEntry=n),r?r.value=t:r=new _r(t),r.key=e,o.insertEntry(r),i[e]=r),a},Ir.prototype.get=function(e){var e=this._map[e],t=this._list;if(null!=e)return e!==t.tail&&(t.remove(e),t.insertEntry(e)),e.value},Ir.prototype.clear=function(){this._list.clear(),this._map={}},Ir.prototype.len=function(){return this._list.len()};var Er=Ir;function Ir(e){this._list=new Sr,this._maxSize=10,this._map={},this._maxSize=e}var Tr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Cr(e){return(e=Math.round(e))<0?0:255<e?255:e}function Rr(e){return e<0?0:1<e?1:e}function Pr(e){return e.length&&"%"===e.charAt(e.length-1)?Cr(parseFloat(e)/100*255):Cr(parseInt(e,10))}function kr(e){return e.length&&"%"===e.charAt(e.length-1)?Rr(parseFloat(e)/100):Rr(parseFloat(e))}function xr(e,t,r){return r<0?r+=1:1<r&&--r,6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function Mr(e,t,r){return e+(t-e)*r}function Ar(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e}function Or(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var Ur=new Er(20),Dr=null;function Hr(e,t){Dr&&Or(Dr,t),Dr=Ur.put(e,Dr||t.slice())}function Lr(e,t){if(e){t=t||[];var r=Ur.get(e);if(r)return Or(t,r);r=(e+="").replace(/ /g,"").toLowerCase();if(r in Tr)return Or(t,Tr[r]),Hr(e,t),t;var n=r.length;if("#"===r.charAt(0))return 4===n||5===n?0<=(o=parseInt(r.slice(1,4),16))&&o<=4095?(Ar(t,(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,5===n?parseInt(r.slice(4),16)/15:1),Hr(e,t),t):void Ar(t,0,0,0,1):7===n||9===n?0<=(o=parseInt(r.slice(1,7),16))&&o<=16777215?(Ar(t,(16711680&o)>>16,(65280&o)>>8,255&o,9===n?parseInt(r.slice(7),16)/255:1),Hr(e,t),t):void Ar(t,0,0,0,1):void 0;var o=r.indexOf("("),i=r.indexOf(")");if(-1!==o&&i+1===n){var n=r.substr(0,o),a=r.substr(o+1,i-(o+1)).split(","),s=1;switch(n){case"rgba":if(4!==a.length)return 3===a.length?Ar(t,+a[0],+a[1],+a[2],1):Ar(t,0,0,0,1);s=kr(a.pop());case"rgb":return 3!==a.length?void Ar(t,0,0,0,1):(Ar(t,Pr(a[0]),Pr(a[1]),Pr(a[2]),s),Hr(e,t),t);case"hsla":return 4!==a.length?void Ar(t,0,0,0,1):(a[3]=kr(a[3]),Nr(a,t),Hr(e,t),t);case"hsl":return 3!==a.length?void Ar(t,0,0,0,1):(Nr(a,t),Hr(e,t),t);default:return}}Ar(t,0,0,0,1)}}function Nr(e,t){var r=(parseFloat(e[0])%360+360)%360/360,n=kr(e[1]),o=kr(e[2]),n=o<=.5?o*(n+1):o+n-o*n,o=2*o-n;return Ar(t=t||[],Cr(255*xr(o,n,r+1/3)),Cr(255*xr(o,n,r)),Cr(255*xr(o,n,r-1/3)),1),4===e.length&&(t[3]=e[3]),t}function Br(e,t,r){var n,o,i;if(t&&t.length&&0<=e&&e<=1)return r=r||[],e=e*(t.length-1),n=Math.floor(e),i=Math.ceil(e),o=t[n],t=t[i],r[0]=Cr(Mr(o[0],t[0],i=e-n)),r[1]=Cr(Mr(o[1],t[1],i)),r[2]=Cr(Mr(o[2],t[2],i)),r[3]=Rr(Mr(o[3],t[3],i)),r}function jr(e,t,r){var n,o,i,a;if(t&&t.length&&0<=e&&e<=1)return e=e*(t.length-1),n=Math.floor(e),o=Math.ceil(e),a=Lr(t[n]),t=Lr(t[o]),a=Vr([Cr(Mr(a[0],t[0],i=e-n)),Cr(Mr(a[1],t[1],i)),Cr(Mr(a[2],t[2],i)),Rr(Mr(a[3],t[3],i))],"rgba"),r?{color:a,leftIndex:n,rightIndex:o,value:e}:a}function Vr(e,t){var r;if(e&&e.length)return r=e[0]+","+e[1]+","+e[2],"rgba"!==t&&"hsva"!==t&&"hsla"!==t||(r+=","+e[3]),t+"("+r+")"}function Fr(e,t){e=Lr(e);return e?(.299*e[0]+.587*e[1]+.114*e[2])*e[3]/255+(1-e[3])*t:0}var qr=Object.freeze({__proto__:null,parse:Lr,lift:function(e,t){var r=Lr(e);if(r){for(var n=0;n<3;n++)r[n]=t<0?r[n]*(1-t)|0:(255-r[n])*t+r[n]|0,255<r[n]?r[n]=255:r[n]<0&&(r[n]=0);return Vr(r,4===r.length?"rgba":"rgb")}},toHex:function(e){if(e=Lr(e))return((1<<24)+(e[0]<<16)+(e[1]<<8)+ +e[2]).toString(16).slice(1)},fastLerp:Br,fastMapToColor:Br,lerp:jr,mapToColor:jr,modifyHSL:function(e,t,r,n){var o=Lr(e);if(e)return o=function(e){var t,r,n,o,i,a,s,d,l,u;if(e)return u=e[0]/255,t=e[1]/255,r=e[2]/255,s=Math.min(u,t,r),o=((n=Math.max(u,t,r))+s)/2,0==(l=n-s)?a=i=0:(a=o<.5?l/(n+s):l/(2-n-s),s=((n-u)/6+l/2)/l,d=((n-t)/6+l/2)/l,l=((n-r)/6+l/2)/l,u===n?i=l-d:t===n?i=1/3+s-l:r===n&&(i=2/3+d-s),i<0&&(i+=1),1<i&&--i),u=[360*i,a,o],null!=e[3]&&u.push(e[3]),u}(o),null!=t&&(o[0]=(e=t,(e=Math.round(e))<0?0:360<e?360:e)),null!=r&&(o[1]=kr(r)),null!=n&&(o[2]=kr(n)),Vr(Nr(o),"rgba")},modifyAlpha:function(e,t){if((e=Lr(e))&&null!=t)return e[3]=Rr(t),Vr(e,"rgba")},stringify:Vr,lum:Fr,random:function(){return Vr([Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())],"rgb")}}),Gr=Math.round;function Wr(e){var t,r;return e&&"transparent"!==e?"string"==typeof e&&-1<e.indexOf("rgba")&&(r=Lr(e))&&(e="rgb("+r[0]+","+r[1]+","+r[2]+")",t=r[3]):e="none",{color:e,opacity:null==t?1:t}}function zr(e){return e<1e-4&&-1e-4<e}function Yr(e){return Gr(1e3*e)/1e3}function Kr(e){return Gr(1e4*e)/1e4}var Xr={left:"start",right:"end",center:"middle",middle:"middle"};function Jr(e){return e&&!!e.image}function Qr(e){return"linear"===e.type}function Zr(e){return"radial"===e.type}function $r(e){return"url(#"+e+")"}function en(e){e=e.getGlobalScale(),e=Math.max(e[0],e[1]);return Math.max(Math.ceil(Math.log(e)/Math.log(10)),1)}function tn(e){var t=e.x||0,r=e.y||0,n=(e.rotation||0)*Ne,o=A(e.scaleX,1),i=A(e.scaleY,1),a=e.skewX||0,e=e.skewY||0,s=[];return(t||r)&&s.push("translate("+t+"px,"+r+"px)"),n&&s.push("rotate("+n+")"),1===o&&1===i||s.push("scale("+o+","+i+")"),(a||e)&&s.push("skew("+Gr(a*Ne)+"deg, "+Gr(e*Ne)+"deg)"),s.join(" ")}var rn=a.hasGlobalWindow&&me(window.btoa)?function(e){return window.btoa(unescape(e))}:"undefined"!=typeof Buffer?function(e){return Buffer.from(e).toString("base64")}:function(e){return ne("Base64 isn't natively supported in the current environment."),null},nn=Array.prototype.slice;function on(e,t,r){return(t-e)*r+e}function an(e,t,r,n){for(var o=t.length,i=0;i<o;i++)e[i]=on(t[i],r[i],n);return e}function sn(e,t,r,n){for(var o=t.length,i=0;i<o;i++)e[i]=t[i]+r[i]*n;return e}function dn(e,t,r,n){for(var o=t.length,i=o&&t[0].length,a=0;a<o;a++){e[a]||(e[a]=[]);for(var s=0;s<i;s++)e[a][s]=t[a][s]+r[a][s]*n}return e}function ln(e){if(ue(e)){var t=e.length;if(ue(e[0])){for(var r=[],n=0;n<t;n++)r.push(nn.call(e[n]));return r}return nn.call(e)}return e}function un(e){return e[0]=Math.floor(e[0])||0,e[1]=Math.floor(e[1])||0,e[2]=Math.floor(e[2])||0,e[3]=null==e[3]?1:e[3],"rgba("+e.join(",")+")"}function cn(e){return 4===e||5===e}function pn(e){return 1===e||2===e}var hn=[0,0,0,0],fn=(mn.prototype.isFinished=function(){return this._finished},mn.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},mn.prototype.needsAnimate=function(){return 1<=this.keyframes.length},mn.prototype.getAdditiveTrack=function(){return this._additiveTrack},mn.prototype.addKeyframe=function(e,t,r){this._needsSort=!0;var n,o=this.keyframes,i=o.length,a=!1,s=6,d=t,l=(ue(t)?(1==(s=n=ue((n=t)&&n[0])?2:1)&&!ye(t[0])||2==n&&!ye(t[0][0]))&&(a=!0):ye(t)&&!Ie(t)?s=0:ge(t)?isNaN(+t)?(n=Lr(t))&&(d=n,s=3):s=0:we(t)&&((l=O({},d)).colorStops=L(t.colorStops,function(e){return{offset:e.offset,color:Lr(e.color)}}),Qr(t)?s=4:Zr(t)&&(s=5),d=l),0===i?this.valType=s:s===this.valType&&6!==s||(a=!0),this.discrete=this.discrete||a,{time:e,value:d,rawValue:t,percent:0});return r&&(l.easing=r,l.easingFunc=me(r)?r:Zt[r]||yr(r)),o.push(l),l},mn.prototype.prepare=function(e,t){for(var r=this.keyframes,n=(this._needsSort&&r.sort(function(e,t){return e.time-t.time}),this.valType),o=r.length,i=r[o-1],a=this.discrete,s=pn(n),d=cn(n),l=0;l<o;l++){var u=r[l],c=u.value,p=i.value;if(u.percent=u.time/e,!a)if(s&&l!==o-1){_=b=v=y=g=m=f=h=u=void 0;var h=p,f=n,m=u=c,g=h;if(m.push&&g.push){var u=m.length,y=g.length;if(u!==y)if(y<u)m.length=y;else for(var v=u;v<y;v++)m.push(1===f?g[v]:nn.call(g[v]));for(var b=m[0]&&m[0].length,v=0;v<m.length;v++)if(1===f)isNaN(m[v])&&(m[v]=g[v]);else for(var _=0;_<b;_++)isNaN(m[v][_])&&(m[v][_]=g[v][_])}}else if(d){T=I=E=w=S=u=h=void 0;for(var h=c.colorStops,u=p.colorStops,S=h.length,w=u.length,E=w<S?u:h,u=Math.min(S,w),I=E[u-1]||{color:[0,0,0,0],offset:0},T=u;T<Math.max(S,w);T++)E.push({offset:I.offset,color:I.color.slice()})}}if(!a&&5!==n&&t&&this.needsAnimate()&&t.needsAnimate()&&n===t.valType&&!t._finished){this._additiveTrack=t;for(var C=r[0].value,l=0;l<o;l++)0===n?r[l].additiveValue=r[l].value-C:3===n?r[l].additiveValue=sn([],r[l].value,C,-1):pn(n)&&(r[l].additiveValue=(1===n?sn:dn)([],r[l].value,C,-1))}},mn.prototype.step=function(e,t){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var r,n,o,i,a=null!=this._additiveTrack,s=a?"additiveValue":"value",d=this.valType,l=this.keyframes,u=l.length,c=this.propName,p=3===d,h=this._lastFr,f=Math.min;if(1===u)r=n=l[0];else{if(t<0)m=0;else if(t<this._lastFrP){for(var m=f(h+1,u-1);0<=m&&!(l[m].percent<=t);m--);m=f(m,u-2)}else{for(m=h;m<u&&!(l[m].percent>t);m++);m=f(m-1,u-2)}n=l[m+1],r=l[m]}r&&n&&(this._lastFr=m,this._lastFrP=t,h=n.percent-r.percent,o=0==h?1:f((t-r.percent)/h,1),n.easingFunc&&(o=n.easingFunc(o)),f=a?this._additiveValue:p?hn:e[c],(pn(d)||p)&&(f=f||(this._additiveValue=[])),this.discrete?e[c]=(o<1?r:n).rawValue:pn(d)?(1===d?an:function(e,t,r,n){for(var o=t.length,i=o&&t[0].length,a=0;a<o;a++){e[a]||(e[a]=[]);for(var s=0;s<i;s++)e[a][s]=on(t[a][s],r[a][s],n)}})(f,r[s],n[s],o):cn(d)?(h=r[s],i=n[s],e[c]={type:(d=4===d)?"linear":"radial",x:on(h.x,i.x,o),y:on(h.y,i.y,o),colorStops:L(h.colorStops,function(e,t){t=i.colorStops[t];return{offset:on(e.offset,t.offset,o),color:un(an([],e.color,t.color,o))}}),global:i.global},d?(e[c].x2=on(h.x2,i.x2,o),e[c].y2=on(h.y2,i.y2,o)):e[c].r=on(h.r,i.r,o)):p?(an(f,r[s],n[s],o),a||(e[c]=un(f))):(d=on(r[s],n[s],o),a?this._additiveValue=d:e[c]=d),a)&&this._addToTarget(e)}},mn.prototype._addToTarget=function(e){var t=this.valType,r=this.propName,n=this._additiveValue;0===t?e[r]=e[r]+n:3===t?(Lr(e[r],hn),sn(hn,hn,n,1),e[r]=un(hn)):1===t?sn(e[r],e[r],n,1):2===t&&dn(e[r],e[r],n,1)},mn);function mn(e){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=e}r.prototype.getMaxTime=function(){return this._maxTime},r.prototype.getDelay=function(){return this._delay},r.prototype.getLoop=function(){return this._loop},r.prototype.getTarget=function(){return this._target},r.prototype.changeTarget=function(e){this._target=e},r.prototype.when=function(e,t,r){return this.whenWithKeys(e,t,U(t),r)},r.prototype.whenWithKeys=function(e,t,r,n){for(var o=this._tracks,i=0;i<r.length;i++){var a=r[i];if(!(d=o[a])){var s,d=o[a]=new fn(a),l=void 0,u=this._getAdditiveTrack(a);if(u?(l=(s=(s=u.keyframes)[s.length-1])&&s.value,3===u.valType&&(l=l&&un(l))):l=this._target[a],null==l)continue;0<e&&d.addKeyframe(0,ln(l),n),this._trackKeys.push(a)}d.addKeyframe(e,ln(t[a]),n)}return this._maxTime=Math.max(this._maxTime,e),this},r.prototype.pause=function(){this._clip.pause(),this._paused=!0},r.prototype.resume=function(){this._clip.resume(),this._paused=!1},r.prototype.isPaused=function(){return!!this._paused},r.prototype.duration=function(e){return this._maxTime=e,this._force=!0,this},r.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var e=this._doneCbs;if(e)for(var t=e.length,r=0;r<t;r++)e[r].call(this)},r.prototype._abortedCallback=function(){this._setTracksFinished();var e=this.animation,t=this._abortedCbs;if(e&&e.removeClip(this._clip),this._clip=null,t)for(var r=0;r<t.length;r++)t[r].call(this)},r.prototype._setTracksFinished=function(){for(var e=this._tracks,t=this._trackKeys,r=0;r<t.length;r++)e[t[r]].setFinished()},r.prototype._getAdditiveTrack=function(e){var t,r=this._additiveAnimators;if(r)for(var n=0;n<r.length;n++){var o=r[n].getTrack(e);o&&(t=o)}return t},r.prototype.start=function(e){if(!(0<this._started)){this._started=1;for(var t,i=this,a=[],r=this._maxTime||0,n=0;n<this._trackKeys.length;n++){var o=this._trackKeys[n],s=this._tracks[o],o=this._getAdditiveTrack(o),d=s.keyframes,l=d.length;s.prepare(r,o),s.needsAnimate()&&(!this._allowDiscrete&&s.discrete?((o=d[l-1])&&(i._target[s.propName]=o.rawValue),s.setFinished()):a.push(s))}return a.length||this._force?(t=new vr({life:r,loop:this._loop,delay:this._delay||0,onframe:function(e){i._started=2;var t=i._additiveAnimators;if(t){for(var r=!1,n=0;n<t.length;n++)if(t[n]._clip){r=!0;break}r||(i._additiveAnimators=null)}for(n=0;n<a.length;n++)a[n].step(i._target,e);var o=i._onframeCbs;if(o)for(n=0;n<o.length;n++)o[n](i._target,e)},ondestroy:function(){i._doneCallback()}}),this._clip=t,this.animation&&this.animation.addClip(t),e&&t.setEasing(e)):this._doneCallback(),this}},r.prototype.stop=function(e){var t;this._clip&&(t=this._clip,e&&t.onframe(1),this._abortedCallback())},r.prototype.delay=function(e){return this._delay=e,this},r.prototype.during=function(e){return e&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(e)),this},r.prototype.done=function(e){return e&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(e)),this},r.prototype.aborted=function(e){return e&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(e)),this},r.prototype.getClip=function(){return this._clip},r.prototype.getTrack=function(e){return this._tracks[e]},r.prototype.getTracks=function(){var t=this;return L(this._trackKeys,function(e){return t._tracks[e]})},r.prototype.stopTracks=function(e,t){if(!e.length||!this._clip)return!0;for(var r=this._tracks,n=this._trackKeys,o=0;o<e.length;o++){var i=r[e[o]];i&&!i.isFinished()&&(t?i.step(this._target,1):1===this._started&&i.step(this._target,0),i.setFinished())}for(var a=!0,o=0;o<n.length;o++)if(!r[n[o]].isFinished()){a=!1;break}return a&&this._abortedCallback(),a},r.prototype.saveTo=function(e,t,r){if(e){t=t||this._trackKeys;for(var n=0;n<t.length;n++){var o=t[n],i=this._tracks[o];i&&!i.isFinished()&&(i=(i=i.keyframes)[r?0:i.length-1])&&(e[o]=ln(i.rawValue))}}},r.prototype.__changeFinalValue=function(e,t){t=t||U(e);for(var r=0;r<t.length;r++){var n,o=t[r],i=this._tracks[o];i&&1<(n=i.keyframes).length&&(n=n.pop(),i.addKeyframe(n.time,e[o]),i.prepare(this._maxTime,i.getAdditiveTrack()))}};var gn=r;function r(e,t,r,n){this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=e,(this._loop=t)&&n?ne("Can' use additive animation on looped animation."):(this._additiveAnimators=n,this._allowDiscrete=r)}function yn(){return(new Date).getTime()}i(n,vn=at),n.prototype.addClip=function(e){e.animation&&this.removeClip(e),this._head?((this._tail.next=e).prev=this._tail,e.next=null,this._tail=e):this._head=this._tail=e,e.animation=this},n.prototype.addAnimator=function(e){e.animation=this;e=e.getClip();e&&this.addClip(e)},n.prototype.removeClip=function(e){var t,r;e.animation&&(t=e.prev,r=e.next,t?t.next=r:this._head=r,r?r.prev=t:this._tail=t,e.next=e.prev=e.animation=null)},n.prototype.removeAnimator=function(e){var t=e.getClip();t&&this.removeClip(t),e.animation=null},n.prototype.update=function(e){for(var t=yn()-this._pausedTime,r=t-this._time,n=this._head;n;)var o=n.next,n=(n.step(t,r)&&(n.ondestroy(),this.removeClip(n)),o);this._time=t,e||(this.trigger("frame",r),this.stage.update&&this.stage.update())},n.prototype._startLoop=function(){var t=this;this._running=!0,Qt(function e(){t._running&&(Qt(e),t._paused||t.update())})},n.prototype.start=function(){this._running||(this._time=yn(),this._pausedTime=0,this._startLoop())},n.prototype.stop=function(){this._running=!1},n.prototype.pause=function(){this._paused||(this._pauseStart=yn(),this._paused=!0)},n.prototype.resume=function(){this._paused&&(this._pausedTime+=yn()-this._pauseStart,this._paused=!1)},n.prototype.clear=function(){for(var e=this._head;e;){var t=e.next;e.prev=e.next=e.animation=null,e=t}this._head=this._tail=null},n.prototype.isFinished=function(){return null==this._head},n.prototype.animate=function(e,t){t=t||{},this.start();e=new gn(e,t.loop);return this.addAnimator(e),e};var vn,bn=n;function n(e){var t=vn.call(this)||this;return t._running=!1,t._time=0,t._pausedTime=0,t._pauseStart=0,t._paused=!1,t.stage=(e=e||{}).stage||{},t}var _n,Sn=a.domSupported,wn=(_n={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},{mouse:jn=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],touch:["touchstart","touchend","touchmove"],pointer:L(jn,function(e){var t=e.replace("mouse","pointer");return _n.hasOwnProperty(t)?t:e})}),En=["mousemove","mouseup"],In=["pointermove","pointerup"],Tn=!1;function Cn(e){e=e.pointerType;return"pen"===e||"touch"===e}function Rn(e){e&&(e.zrByTouch=!0)}function Pn(e,t){for(var r=t,n=!1;r&&9!==r.nodeType&&!(n=r.domBelongToZr||r!==t&&r===e.painterRoot);)r=r.parentNode;return n}var kn=function(e,t){this.stopPropagation=Le,this.stopImmediatePropagation=Le,this.preventDefault=Le,this.type=t.type,this.target=this.currentTarget=e.dom,this.pointerType=t.pointerType,this.clientX=t.clientX,this.clientY=t.clientY},xn={mousedown:function(e){e=_t(this.dom,e),this.__mayPointerCapture=[e.zrX,e.zrY],this.trigger("mousedown",e)},mousemove:function(e){e=_t(this.dom,e);var t=this.__mayPointerCapture;!t||e.zrX===t[0]&&e.zrY===t[1]||this.__togglePointerCapture(!0),this.trigger("mousemove",e)},mouseup:function(e){e=_t(this.dom,e),this.__togglePointerCapture(!1),this.trigger("mouseup",e)},mouseout:function(e){Pn(this,(e=_t(this.dom,e)).toElement||e.relatedTarget)||(this.__pointerCapturing&&(e.zrEventControl="no_globalout"),this.trigger("mouseout",e))},wheel:function(e){Tn=!0,e=_t(this.dom,e),this.trigger("mousewheel",e)},mousewheel:function(e){Tn||(e=_t(this.dom,e),this.trigger("mousewheel",e))},touchstart:function(e){Rn(e=_t(this.dom,e)),this.__lastTouchMoment=new Date,this.handler.processGesture(e,"start"),xn.mousemove.call(this,e),xn.mousedown.call(this,e)},touchmove:function(e){Rn(e=_t(this.dom,e)),this.handler.processGesture(e,"change"),xn.mousemove.call(this,e)},touchend:function(e){Rn(e=_t(this.dom,e)),this.handler.processGesture(e,"end"),xn.mouseup.call(this,e),+new Date-+this.__lastTouchMoment<300&&xn.click.call(this,e)},pointerdown:function(e){xn.mousedown.call(this,e)},pointermove:function(e){Cn(e)||xn.mousemove.call(this,e)},pointerup:function(e){xn.mouseup.call(this,e)},pointerout:function(e){Cn(e)||xn.mouseout.call(this,e)}},Mn=(w(["click","dblclick","contextmenu"],function(t){xn[t]=function(e){e=_t(this.dom,e),this.trigger(t,e)}}),{pointermove:function(e){Cn(e)||Mn.mousemove.call(this,e)},pointerup:function(e){Mn.mouseup.call(this,e)},mousemove:function(e){this.trigger("mousemove",e)},mouseup:function(e){var t=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",e),t&&(e.zrEventControl="only_globalout",this.trigger("mouseout",e))}});function An(n,o){var i=o.domHandlers;a.pointerEventsSupported?w(wn.pointer,function(t){Un(o,t,function(e){i[t].call(n,e)})}):(a.touchEventsSupported&&w(wn.touch,function(r){Un(o,r,function(e){var t;i[r].call(n,e),(t=o).touching=!0,null!=t.touchTimer&&(clearTimeout(t.touchTimer),t.touchTimer=null),t.touchTimer=setTimeout(function(){t.touching=!1,t.touchTimer=null},700)})}),w(wn.mouse,function(t){Un(o,t,function(e){e=bt(e),o.touching||i[t].call(n,e)})}))}function On(n,o){function e(r){Un(o,r,function(e){var t;e=bt(e),Pn(n,e.target)||(t=e,e=_t(n.dom,new kn(n,t),!0),o.domHandlers[r].call(n,e))},{capture:!0})}a.pointerEventsSupported?w(In,e):a.touchEventsSupported||w(En,e)}function Un(e,t,r,n){e.mounted[t]=r,e.listenerOpts[t]=n,e.domTarget.addEventListener(t,r,n)}function Dn(e){var t,r,n,o,i,a=e.mounted;for(t in a)a.hasOwnProperty(t)&&(r=e.domTarget,o=a[n=t],i=e.listenerOpts[t],r.removeEventListener(n,o,i));e.mounted={}}var Hn,Ln=function(e,t){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=e,this.domHandlers=t},Nn=(i(Bn,Hn=at),Bn.prototype.dispose=function(){Dn(this._localHandlerScope),Sn&&Dn(this._globalHandlerScope)},Bn.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},Bn.prototype.__togglePointerCapture=function(e){var t;this.__mayPointerCapture=null,Sn&&+this.__pointerCapturing^+e&&(this.__pointerCapturing=e,t=this._globalHandlerScope,e?On(this,t):Dn(t))},Bn);function Bn(e,t){var r=Hn.call(this)||this;return r.__pointerCapturing=!1,r.dom=e,r.painterRoot=t,r._localHandlerScope=new Ln(e,xn),Sn&&(r._globalHandlerScope=new Ln(document,Mn)),An(r,r._localHandlerScope),r}var jn=1,Vn=jn=a.hasGlobalWindow?Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1):jn,Fn="#333",qn="#ccc";function Gn(){return[1,0,0,1,0,0]}function Wn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function zn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Yn(e,t,r){var n=t[0]*r[0]+t[2]*r[1],o=t[1]*r[0]+t[3]*r[1],i=t[0]*r[2]+t[2]*r[3],a=t[1]*r[2]+t[3]*r[3],s=t[0]*r[4]+t[2]*r[5]+t[4],r=t[1]*r[4]+t[3]*r[5]+t[5];return e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=s,e[5]=r,e}function Kn(e,t,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+r[0],e[5]=t[5]+r[1],e}function Xn(e,t,r){var n=t[0],o=t[2],i=t[4],a=t[1],s=t[3],t=t[5],d=Math.sin(r),r=Math.cos(r);return e[0]=n*r+a*d,e[1]=-n*d+a*r,e[2]=o*r+s*d,e[3]=-o*d+r*s,e[4]=r*i+d*t,e[5]=r*t-d*i,e}function Jn(e,t,r){var n=r[0],r=r[1];return e[0]=t[0]*n,e[1]=t[1]*r,e[2]=t[2]*n,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*r,e}function Qn(e,t){var r=t[0],n=t[2],o=t[4],i=t[1],a=t[3],t=t[5],s=r*a-i*n;return s?(e[0]=a*(s=1/s),e[1]=-i*s,e[2]=-n*s,e[3]=r*s,e[4]=(n*t-a*o)*s,e[5]=(i*o-r*t)*s,e):null}var jn=Object.freeze({__proto__:null,create:Gn,identity:Wn,copy:zn,mul:Yn,translate:Kn,rotate:Xn,scale:Jn,invert:Qn,clone:function(e){var t=Gn();return zn(t,e),t}}),Zn=Wn;function $n(e){return 5e-5<e||e<-5e-5}var eo=[],to=[],ro=Gn(),no=Math.abs,oo=(o.prototype.getLocalTransform=function(e){return o.getLocalTransform(this,e)},o.prototype.setPosition=function(e){this.x=e[0],this.y=e[1]},o.prototype.setScale=function(e){this.scaleX=e[0],this.scaleY=e[1]},o.prototype.setSkew=function(e){this.skewX=e[0],this.skewY=e[1]},o.prototype.setOrigin=function(e){this.originX=e[0],this.originY=e[1]},o.prototype.needLocalTransform=function(){return $n(this.rotation)||$n(this.x)||$n(this.y)||$n(this.scaleX-1)||$n(this.scaleY-1)||$n(this.skewX)||$n(this.skewY)},o.prototype.updateTransform=function(){var e=this.parent&&this.parent.transform,t=this.needLocalTransform(),r=this.transform;t||e?(r=r||Gn(),t?this.getLocalTransform(r):Zn(r),e&&(t?Yn(r,e,r):zn(r,e)),this.transform=r,this._resolveGlobalScaleRatio(r)):r&&Zn(r)},o.prototype._resolveGlobalScaleRatio=function(e){var t,r,n=this.globalScaleRatio;null!=n&&1!==n&&(this.getGlobalScale(eo),r=((eo[1]-(r=eo[1]<0?-1:1))*n+r)/eo[1]||0,e[0]*=n=((eo[0]-(t=eo[0]<0?-1:1))*n+t)/eo[0]||0,e[1]*=n,e[2]*=r,e[3]*=r),this.invTransform=this.invTransform||Gn(),Qn(this.invTransform,e)},o.prototype.getComputedTransform=function(){for(var e=this,t=[];e;)t.push(e),e=e.parent;for(;e=t.pop();)e.updateTransform();return this.transform},o.prototype.setLocalTransform=function(e){var t,r,n,o;e&&(o=e[0]*e[0]+e[1]*e[1],n=e[2]*e[2]+e[3]*e[3],t=Math.atan2(e[1],e[0]),r=Math.PI/2+t-Math.atan2(e[3],e[2]),n=Math.sqrt(n)*Math.cos(r),o=Math.sqrt(o),this.skewX=r,this.skewY=0,this.rotation=-t,this.x=+e[4],this.y=+e[5],this.scaleX=o,this.scaleY=n,this.originX=0,this.originY=0)},o.prototype.decomposeTransform=function(){var e,t,r;this.transform&&(t=this.parent,e=this.transform,t&&t.transform&&(Yn(to,t.invTransform,e),e=to),t=this.originX,r=this.originY,(t||r)&&(ro[4]=t,ro[5]=r,Yn(to,e,ro),to[4]-=t,to[5]-=r,e=to),this.setLocalTransform(e))},o.prototype.getGlobalScale=function(e){var t=this.transform;return e=e||[],t?(e[0]=Math.sqrt(t[0]*t[0]+t[1]*t[1]),e[1]=Math.sqrt(t[2]*t[2]+t[3]*t[3]),t[0]<0&&(e[0]=-e[0]),t[3]<0&&(e[1]=-e[1])):(e[0]=1,e[1]=1),e},o.prototype.transformCoordToLocal=function(e,t){e=[e,t],t=this.invTransform;return t&&$e(e,e,t),e},o.prototype.transformCoordToGlobal=function(e,t){e=[e,t],t=this.transform;return t&&$e(e,e,t),e},o.prototype.getLineScale=function(){var e=this.transform;return e&&1e-10<no(e[0]-1)&&1e-10<no(e[3]-1)?Math.sqrt(no(e[0]*e[3]-e[2]*e[1])):1},o.prototype.copyTransform=function(e){ao(this,e)},o.getLocalTransform=function(e,t){t=t||[];var r=e.originX||0,n=e.originY||0,o=e.scaleX,i=e.scaleY,a=e.anchorX,s=e.anchorY,d=e.rotation||0,l=e.x,u=e.y,c=e.skewX?Math.tan(e.skewX):0,e=e.skewY?Math.tan(-e.skewY):0;return r||n||a||s?(t[4]=-(a=r+a)*o-c*(s=n+s)*i,t[5]=-s*i-e*a*o):t[4]=t[5]=0,t[0]=o,t[3]=i,t[1]=e*o,t[2]=c*i,d&&Xn(t,t,d),t[4]+=r+l,t[5]+=n+u,t},o.initDefaultProps=((d=o.prototype).scaleX=d.scaleY=d.globalScaleRatio=1,void(d.x=d.y=d.originX=d.originY=d.skewX=d.skewY=d.rotation=d.anchorX=d.anchorY=0)),o);function o(){}var io=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function ao(e,t){for(var r=0;r<io.length;r++){var n=io[r];e[n]=t[n]}}s.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},s.prototype.clone=function(){return new s(this.x,this.y)},s.prototype.set=function(e,t){return this.x=e,this.y=t,this},s.prototype.equal=function(e){return e.x===this.x&&e.y===this.y},s.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},s.prototype.scale=function(e){this.x*=e,this.y*=e},s.prototype.scaleAndAdd=function(e,t){this.x+=e.x*t,this.y+=e.y*t},s.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},s.prototype.dot=function(e){return this.x*e.x+this.y*e.y},s.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},s.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},s.prototype.normalize=function(){var e=this.len();return this.x/=e,this.y/=e,this},s.prototype.distance=function(e){var t=this.x-e.x,e=this.y-e.y;return Math.sqrt(t*t+e*e)},s.prototype.distanceSquare=function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},s.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},s.prototype.transform=function(e){var t,r;if(e)return t=this.x,r=this.y,this.x=e[0]*t+e[2]*r+e[4],this.y=e[1]*t+e[3]*r+e[5],this},s.prototype.toArray=function(e){return e[0]=this.x,e[1]=this.y,e},s.prototype.fromArray=function(e){this.x=e[0],this.y=e[1]},s.set=function(e,t,r){e.x=t,e.y=r},s.copy=function(e,t){e.x=t.x,e.y=t.y},s.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},s.lenSquare=function(e){return e.x*e.x+e.y*e.y},s.dot=function(e,t){return e.x*t.x+e.y*t.y},s.add=function(e,t,r){e.x=t.x+r.x,e.y=t.y+r.y},s.sub=function(e,t,r){e.x=t.x-r.x,e.y=t.y-r.y},s.scale=function(e,t,r){e.x=t.x*r,e.y=t.y*r},s.scaleAndAdd=function(e,t,r,n){e.x=t.x+r.x*n,e.y=t.y+r.y*n},s.lerp=function(e,t,r,n){var o=1-n;e.x=o*t.x+n*r.x,e.y=o*t.y+n*r.y};var S=s;function s(e,t){this.x=e||0,this.y=t||0}var so=Math.min,lo=Math.max,uo=new S,co=new S,po=new S,ho=new S,fo=new S,mo=new S,Y=(v.prototype.union=function(e){var t=so(e.x,this.x),r=so(e.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=lo(e.x+e.width,this.x+this.width)-t:this.width=e.width,isFinite(this.y)&&isFinite(this.height)?this.height=lo(e.y+e.height,this.y+this.height)-r:this.height=e.height,this.x=t,this.y=r},v.prototype.applyTransform=function(e){v.applyTransform(this,this,e)},v.prototype.calculateTransform=function(e){var t=e.width/this.width,r=e.height/this.height,n=Gn();return Kn(n,n,[-this.x,-this.y]),Jn(n,n,[t,r]),Kn(n,n,[e.x,e.y]),n},v.prototype.intersect=function(e,t){if(!e)return!1;e instanceof v||(e=v.create(e));var r,n,o,i,a,s,d,l,u=this.x,c=this.x+this.width,p=this.y,h=this.y+this.height,f=e.x,m=e.x+e.width,g=e.y,e=e.y+e.height,y=!(c<f||m<u||h<g||e<p);return t&&(r=1/0,n=0,o=Math.abs(c-f),i=Math.abs(m-u),a=Math.abs(h-g),s=Math.abs(e-p),d=Math.min(o,i),l=Math.min(a,s),c<f||m<u?n<d&&(n=d,o<i?S.set(mo,-o,0):S.set(mo,i,0)):d<r&&(r=d,o<i?S.set(fo,o,0):S.set(fo,-i,0)),h<g||e<p?n<l&&(n=l,a<s?S.set(mo,0,-a):S.set(mo,0,s)):d<r&&(r=d,a<s?S.set(fo,0,a):S.set(fo,0,-s))),t&&S.copy(t,y?fo:mo),y},v.prototype.contain=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},v.prototype.clone=function(){return new v(this.x,this.y,this.width,this.height)},v.prototype.copy=function(e){v.copy(this,e)},v.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},v.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},v.prototype.isZero=function(){return 0===this.width||0===this.height},v.create=function(e){return new v(e.x,e.y,e.width,e.height)},v.copy=function(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},v.applyTransform=function(e,t,r){var n,o,i,a;r?r[1]<1e-5&&-1e-5<r[1]&&r[2]<1e-5&&-1e-5<r[2]?(n=r[0],o=r[3],i=r[4],a=r[5],e.x=t.x*n+i,e.y=t.y*o+a,e.width=t.width*n,e.height=t.height*o,e.width<0&&(e.x+=e.width,e.width=-e.width),e.height<0&&(e.y+=e.height,e.height=-e.height)):(uo.x=po.x=t.x,uo.y=ho.y=t.y,co.x=ho.x=t.x+t.width,co.y=po.y=t.y+t.height,uo.transform(r),ho.transform(r),co.transform(r),po.transform(r),e.x=so(uo.x,co.x,po.x,ho.x),e.y=so(uo.y,co.y,po.y,ho.y),i=lo(uo.x,co.x,po.x,ho.x),a=lo(uo.y,co.y,po.y,ho.y),e.width=i-e.x,e.height=a-e.y):e!==t&&v.copy(e,t)},v);function v(e,t,r,n){r<0&&(e+=r,r=-r),n<0&&(t+=n,n=-n),this.x=e,this.y=t,this.width=r,this.height=n}var go={};function yo(e,t){var r=go[t=t||Q],n=(r=r||(go[t]=new Er(500))).get(e);return null==n&&(n=M.measureText(e,t).width,r.put(e,n)),n}function vo(e,t,r,n){e=yo(e,t),t=So(t),r=bo(0,e,r),n=_o(0,t,n);return new Y(r,n,e,t)}function bo(e,t,r){return"right"===r?e-=t:"center"===r&&(e-=t/2),e}function _o(e,t,r){return"middle"===r?e-=t/2:"bottom"===r&&(e-=t),e}function So(e){return yo("国",e)}function wo(e,t){return"string"==typeof e?0<=e.lastIndexOf("%")?parseFloat(e)/100*t:parseFloat(e):e}var Eo,Io,To="__zr_normal__",Co=io.concat(["ignore"]),Ro=ce(io,function(e,t){return e[t]=!0,e},{ignore:!1}),Po={},ko=new Y(0,0,0,0),d=(l.prototype._init=function(e){this.attr(e)},l.prototype.drift=function(e,t,r){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0}var n=this.transform;(n=n||(this.transform=[1,0,0,1,0,0]))[4]+=e,n[5]+=t,this.decomposeTransform(),this.markRedraw()},l.prototype.beforeUpdate=function(){},l.prototype.afterUpdate=function(){},l.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},l.prototype.updateInnerText=function(e){var t=this._textContent;if(t&&(!t.ignore||e)){this.textConfig||(this.textConfig={});var e=this.textConfig,r=e.local,n=t.innerTransformable,o=void 0,i=void 0,a=!1,s=(n.parent=r?this:null,!1);if(n.copyTransform(t),null!=e.position){var d=ko;if(e.layoutRect?d.copy(e.layoutRect):d.copy(this.getBoundingRect()),r||d.applyTransform(this.transform),this.calculateTextPosition)this.calculateTextPosition(Po,e,d);else{var l=Po,u=e,c=d,p=u.position||"inside",h=null!=u.distance?u.distance:5,f=c.height,m=c.width,g=f/2,y=c.x,v=c.y,b="left",_="top";if(p instanceof Array)y+=wo(p[0],c.width),v+=wo(p[1],c.height),_=b=null;else switch(p){case"left":y-=h,v+=g,b="right",_="middle";break;case"right":y+=h+m,v+=g,_="middle";break;case"top":y+=m/2,v-=h,b="center",_="bottom";break;case"bottom":y+=m/2,v+=f+h,b="center";break;case"inside":y+=m/2,v+=g,b="center",_="middle";break;case"insideLeft":y+=h,v+=g,_="middle";break;case"insideRight":y+=m-h,v+=g,b="right",_="middle";break;case"insideTop":y+=m/2,v+=h,b="center";break;case"insideBottom":y+=m/2,v+=f-h,b="center",_="bottom";break;case"insideTopLeft":y+=h,v+=h;break;case"insideTopRight":y+=m-h,v+=h,b="right";break;case"insideBottomLeft":y+=h,v+=f-h,_="bottom";break;case"insideBottomRight":y+=m-h,v+=f-h,b="right",_="bottom"}(l=l||{}).x=y,l.y=v,l.align=b,l.verticalAlign=_}n.x=Po.x,n.y=Po.y;o=Po.align,i=Po.verticalAlign,u=e.origin;u&&null!=e.rotation&&(p=c=void 0,p="center"===u?(c=.5*d.width,.5*d.height):(c=wo(u[0],d.width),wo(u[1],d.height)),s=!0,n.originX=-n.x+c+(r?0:d.x),n.originY=-n.y+p+(r?0:d.y))}null!=e.rotation&&(n.rotation=e.rotation);var l=e.offset,r=(l&&(n.x+=l[0],n.y+=l[1],s||(n.originX=-l[0],n.originY=-l[1])),null==e.inside?"string"==typeof e.position&&0<=e.position.indexOf("inside"):e.inside),d=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),s=void 0,n=void 0,S=void 0;r&&this.canBeInsideText()?(s=e.insideFill,n=e.insideStroke,null!=s&&"auto"!==s||(s=this.getInsideTextFill()),null!=n&&"auto"!==n||(n=this.getInsideTextStroke(s),S=!0)):(s=e.outsideFill,n=e.outsideStroke,null!=s&&"auto"!==s||(s=this.getOutsideFill()),null!=n&&"auto"!==n||(n=this.getOutsideStroke(s),S=!0)),(s=s||"#000")===d.fill&&n===d.stroke&&S===d.autoStroke&&o===d.align&&i===d.verticalAlign||(a=!0,d.fill=s,d.stroke=n,d.autoStroke=S,d.align=o,d.verticalAlign=i,t.setDefaultTextStyle(d)),t.__dirty|=Gt,a&&t.dirtyStyle(!0)}},l.prototype.canBeInsideText=function(){return!0},l.prototype.getInsideTextFill=function(){return"#fff"},l.prototype.getInsideTextStroke=function(e){return"#000"},l.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?qn:Fn},l.prototype.getOutsideStroke=function(e){for(var t=this.__zr&&this.__zr.getBackgroundColor(),r="string"==typeof t&&Lr(t),n=(r=r||[255,255,255,1])[3],o=this.__zr.isDarkMode(),i=0;i<3;i++)r[i]=r[i]*n+(o?0:255)*(1-n);return r[3]=1,Vr(r,"rgba")},l.prototype.traverse=function(e,t){},l.prototype.attrKV=function(e,t){"textConfig"===e?this.setTextConfig(t):"textContent"===e?this.setTextContent(t):"clipPath"===e?this.setClipPath(t):"extra"===e?(this.extra=this.extra||{},O(this.extra,t)):this[e]=t},l.prototype.hide=function(){this.ignore=!0,this.markRedraw()},l.prototype.show=function(){this.ignore=!1,this.markRedraw()},l.prototype.attr=function(e,t){if("string"==typeof e)this.attrKV(e,t);else if(ve(e))for(var r=U(e),n=0;n<r.length;n++){var o=r[n];this.attrKV(o,e[o])}return this.markRedraw(),this},l.prototype.saveCurrentToNormalState=function(e){this._innerSaveToNormal(e);for(var t=this._normalState,r=0;r<this.animators.length;r++){var n=this.animators[r],o=n.__fromStateTransition;n.getLoop()||o&&o!==To||(o=(o=n.targetName)?t[o]:t,n.saveTo(o))}},l.prototype._innerSaveToNormal=function(e){var t=(t=this._normalState)||(this._normalState={});e.textConfig&&!t.textConfig&&(t.textConfig=this.textConfig),this._savePrimaryToNormal(e,t,Co)},l.prototype._savePrimaryToNormal=function(e,t,r){for(var n=0;n<r.length;n++){var o=r[n];null==e[o]||o in t||(t[o]=this[o])}},l.prototype.hasState=function(){return 0<this.currentStates.length},l.prototype.getState=function(e){return this.states[e]},l.prototype.ensureState=function(e){var t=this.states;return t[e]||(t[e]={}),t[e]},l.prototype.clearStates=function(e){this.useState(To,!1,e)},l.prototype.useState=function(e,t,r,n){var o=e===To,i=this.hasState();if(i||!o){var a,i=this.currentStates,s=this.stateTransition;if(!(0<=de(i,e))||!t&&1!==i.length){if((a=(a=this.stateProxy&&!o?this.stateProxy(e):a)||this.states&&this.states[e])||o)return o||this.saveCurrentToNormalState(a),(i=!!(a&&a.hoverLayer||n))&&this._toggleHoverLayerFlag(!0),this._applyStateObj(e,a,this._normalState,t,!r&&!this.__inHover&&s&&0<s.duration,s),n=this._textContent,s=this._textGuide,n&&n.useState(e,t,r,i),s&&s.useState(e,t,r,i),o?(this.currentStates=[],this._normalState={}):t?this.currentStates.push(e):this.currentStates=[e],this._updateAnimationTargets(),this.markRedraw(),!i&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Gt),a;ne("State "+e+" not exists.")}}},l.prototype.useStates=function(e,t,r){if(e.length){var n=[],o=this.currentStates,i=e.length,a=i===o.length;if(a)for(var s=0;s<i;s++)if(e[s]!==o[s]){a=!1;break}if(!a){for(s=0;s<i;s++){var d=e[s],l=void 0;(l=(l=this.stateProxy?this.stateProxy(d,e):l)||this.states[d])&&n.push(l)}var u=n[i-1],u=!!(u&&u.hoverLayer||r),r=(u&&this._toggleHoverLayerFlag(!0),this._mergeStates(n)),c=this.stateTransition,r=(this.saveCurrentToNormalState(r),this._applyStateObj(e.join(","),r,this._normalState,!1,!t&&!this.__inHover&&c&&0<c.duration,c),this._textContent),c=this._textGuide;r&&r.useStates(e,t,u),c&&c.useStates(e,t,u),this._updateAnimationTargets(),this.currentStates=e.slice(),this.markRedraw(),!u&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Gt)}}else this.clearStates()},l.prototype._updateAnimationTargets=function(){for(var e=0;e<this.animators.length;e++){var t=this.animators[e];t.targetName&&t.changeTarget(this[t.targetName])}},l.prototype.removeState=function(e){var t,e=de(this.currentStates,e);0<=e&&((t=this.currentStates.slice()).splice(e,1),this.useStates(t))},l.prototype.replaceState=function(e,t,r){var n=this.currentStates.slice(),e=de(n,e),o=0<=de(n,t);0<=e?o?n.splice(e,1):n[e]=t:r&&!o&&n.push(t),this.useStates(n)},l.prototype.toggleState=function(e,t){t?this.useState(e,!0):this.removeState(e)},l.prototype._mergeStates=function(e){for(var t,r={},n=0;n<e.length;n++){var o=e[n];O(r,o),o.textConfig&&O(t=t||{},o.textConfig)}return t&&(r.textConfig=t),r},l.prototype._applyStateObj=function(e,t,r,n,o,i){for(var a=!(t&&n),s=(t&&t.textConfig?(this.textConfig=O({},(n?this:r).textConfig),O(this.textConfig,t.textConfig)):a&&r.textConfig&&(this.textConfig=r.textConfig),{}),d=!1,l=0;l<Co.length;l++){var u=Co[l],c=o&&Ro[u];t&&null!=t[u]?c?(d=!0,s[u]=t[u]):this[u]=t[u]:a&&null!=r[u]&&(c?(d=!0,s[u]=r[u]):this[u]=r[u])}if(!o)for(l=0;l<this.animators.length;l++){var p=this.animators[l],h=p.targetName;p.getLoop()||p.__changeFinalValue(h?(t||r)[h]:t||r)}d&&this._transitionState(e,s,i)},l.prototype._attachComponent=function(e){if(e.__zr&&!e.__hostTarget)throw new Error("Text element has been added to zrender.");if(e===this)throw new Error("Recursive component attachment.");var t=this.__zr;t&&e.addSelfToZr(t),e.__zr=t,e.__hostTarget=this},l.prototype._detachComponent=function(e){e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__hostTarget=null},l.prototype.getClipPath=function(){return this._clipPath},l.prototype.setClipPath=function(e){this._clipPath&&this._clipPath!==e&&this.removeClipPath(),this._attachComponent(e),this._clipPath=e,this.markRedraw()},l.prototype.removeClipPath=function(){var e=this._clipPath;e&&(this._detachComponent(e),this._clipPath=null,this.markRedraw())},l.prototype.getTextContent=function(){return this._textContent},l.prototype.setTextContent=function(e){var t=this._textContent;if(t!==e){if(t&&t!==e&&this.removeTextContent(),e.__zr&&!e.__hostTarget)throw new Error("Text element has been added to zrender.");e.innerTransformable=new oo,this._attachComponent(e),this._textContent=e,this.markRedraw()}},l.prototype.setTextConfig=function(e){this.textConfig||(this.textConfig={}),O(this.textConfig,e),this.markRedraw()},l.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},l.prototype.removeTextContent=function(){var e=this._textContent;e&&(e.innerTransformable=null,this._detachComponent(e),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},l.prototype.getTextGuideLine=function(){return this._textGuide},l.prototype.setTextGuideLine=function(e){this._textGuide&&this._textGuide!==e&&this.removeTextGuideLine(),this._attachComponent(e),this._textGuide=e,this.markRedraw()},l.prototype.removeTextGuideLine=function(){var e=this._textGuide;e&&(this._detachComponent(e),this._textGuide=null,this.markRedraw())},l.prototype.markRedraw=function(){this.__dirty|=Gt;var e=this.__zr;e&&(this.__inHover?e.refreshHover():e.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},l.prototype.dirty=function(){this.markRedraw()},l.prototype._toggleHoverLayerFlag=function(e){this.__inHover=e;var t=this._textContent,r=this._textGuide;t&&(t.__inHover=e),r&&(r.__inHover=e)},l.prototype.addSelfToZr=function(e){if(this.__zr!==e){this.__zr=e;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.addAnimator(t[r]);this._clipPath&&this._clipPath.addSelfToZr(e),this._textContent&&this._textContent.addSelfToZr(e),this._textGuide&&this._textGuide.addSelfToZr(e)}},l.prototype.removeSelfFromZr=function(e){if(this.__zr){this.__zr=null;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.removeAnimator(t[r]);this._clipPath&&this._clipPath.removeSelfFromZr(e),this._textContent&&this._textContent.removeSelfFromZr(e),this._textGuide&&this._textGuide.removeSelfFromZr(e)}},l.prototype.animate=function(e,t,r){var n=e?this[e]:this;if(n)return n=new gn(n,t,r),e&&(n.targetName=e),this.addAnimator(n,e),n;ne('Property "'+e+'" is not existed in element '+this.id)},l.prototype.addAnimator=function(r,e){var t=this.__zr,n=this;r.during(function(){n.updateDuringAnimation(e)}).done(function(){var e=n.animators,t=de(e,r);0<=t&&e.splice(t,1)}),this.animators.push(r),t&&t.animation.addAnimator(r),t&&t.wakeUp()},l.prototype.updateDuringAnimation=function(e){this.markRedraw()},l.prototype.stopAnimation=function(e,t){for(var r=this.animators,n=r.length,o=[],i=0;i<n;i++){var a=r[i];e&&e!==a.scope?o.push(a):a.stop(t)}return this.animators=o,this},l.prototype.animateTo=function(e,t,r){Ao(this,e,t,r)},l.prototype.animateFrom=function(e,t,r){Ao(this,e,t,r,!0)},l.prototype._transitionState=function(e,t,r,n){for(var o=Ao(this,t,r,n),i=0;i<o.length;i++)o[i].__fromStateTransition=e},l.prototype.getBoundingRect=function(){return null},l.prototype.getPaintRect=function(){return null},l.initDefaultProps=((Eo=l.prototype).type="element",Eo.name="",Eo.ignore=Eo.silent=Eo.isGroup=Eo.draggable=Eo.dragging=Eo.ignoreClip=Eo.__inHover=!1,Eo.__dirty=Gt,Io={},void(Object.defineProperty&&(Mo("position","_legacyPos","x","y"),Mo("scale","_legacyScale","scaleX","scaleY"),Mo("origin","_legacyOrigin","originX","originY")))),l);function l(e){this.id=te++,this.animators=[],this.currentStates=[],this.states={},this._init(e)}function xo(e,t,r){Io[e+t+r]||(console.warn("DEPRECATED: '"+e+"' has been deprecated. use '"+t+"', '"+r+"' instead"),Io[e+t+r]=!0)}function Mo(t,r,n,o){function i(t,e){Object.defineProperty(e,0,{get:function(){return t[n]},set:function(e){t[n]=e}}),Object.defineProperty(e,1,{get:function(){return t[o]},set:function(e){t[o]=e}})}Object.defineProperty(Eo,t,{get:function(){var e;return xo(t,n,o),this[r]||(e=this[r]=[],i(this,e)),this[r]},set:function(e){xo(t,n,o),this[n]=e[0],this[o]=e[1],this[r]=e,i(this,e)}})}function Ao(e,t,r,n,o){function i(){l=!0,--d<=0&&(l?u&&u():c&&c())}function a(){--d<=0&&(l?u&&u():c&&c())}var s=[],d=(!function e(t,r,n,o,i,a,s,d){var l=U(o);var u=i.duration;var c=i.delay;var p=i.additive;var h=i.setToFinal;var f=!ve(a);var m=t.animators;var g=[];for(var y=0;y<l.length;y++){var v=l[y],b=o[v];null!=b&&null!=n[v]&&(f||a[v])?!ve(b)||ue(b)||we(b)?g.push(v):r?d||(n[v]=b,t.updateDuringAnimation(r)):e(t,v,n[v],b,i,a&&a[v],s,d):d||(n[v]=b,t.updateDuringAnimation(r),g.push(v))}var _=g.length;if(!p&&_)for(var S,w=0;w<m.length;w++)(E=m[w]).targetName===r&&E.stopTracks(g)&&(S=de(m,E),m.splice(S,1));i.force||(g=pe(g,function(e){return!Do(o[e],n[e])}),_=g.length);if(0<_||i.force&&!s.length){var E,I=void 0,T=void 0,C=void 0;if(d){T={},h&&(I={});for(w=0;w<_;w++){v=g[w];T[v]=n[v],h?I[v]=o[v]:n[v]=o[v]}}else if(h){C={};for(w=0;w<_;w++){v=g[w];C[v]=ln(n[v]),Uo(n,o,v)}}(E=new gn(n,!1,!1,p?pe(m,function(e){return e.targetName===r}):null)).targetName=r,i.scope&&(E.scope=i.scope),h&&I&&E.whenWithKeys(0,I,g),C&&E.whenWithKeys(0,C,g),E.whenWithKeys(null==u?500:u,d?T:o,g).delay(c||0),t.addAnimator(E,r),s.push(E)}}(e,"",e,t,r=r||{},n,s,o),s.length),l=!1,u=r.done,c=r.aborted;d||u&&u(),0<s.length&&r.during&&s[0].during(function(e,t){r.during(t)});for(var p=0;p<s.length;p++){var h=s[p];h.done(i),h.aborted(a),r.force&&h.duration(r.duration),h.start(r.easing)}return s}function Oo(e,t,r){for(var n=0;n<r;n++)e[n]=t[n]}function Uo(e,t,r){if(ue(t[r]))if(ue(e[r])||(e[r]=[]),_e(t[r])){var n=t[r].length;e[r].length!==n&&(e[r]=new t[r].constructor(n),Oo(e[r],t[r],n))}else{var o=t[r],i=e[r],a=o.length;if(ue(o[0]))for(var s=o[0].length,d=0;d<a;d++)i[d]?Oo(i[d],o[d],s):i[d]=Array.prototype.slice.call(o[d]);else Oo(i,o,a);i.length=o.length}else e[r]=t[r]}function Do(e,t){return e===t||ue(e)&&ue(t)&&function(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}(e,t)}le(d,at),le(d,oo);i(u,Ho=d),u.prototype.childrenRef=function(){return this._children},u.prototype.children=function(){return this._children.slice()},u.prototype.childAt=function(e){return this._children[e]},u.prototype.childOfName=function(e){for(var t=this._children,r=0;r<t.length;r++)if(t[r].name===e)return t[r]},u.prototype.childCount=function(){return this._children.length},u.prototype.add=function(e){if(e&&(e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),e.__hostTarget))throw"This elemenet has been used as an attachment";return this},u.prototype.addBefore=function(e,t){var r;return e&&e!==this&&e.parent!==this&&t&&t.parent===this&&0<=(t=(r=this._children).indexOf(t))&&(r.splice(t,0,e),this._doAdd(e)),this},u.prototype.replace=function(e,t){e=de(this._children,e);return 0<=e&&this.replaceAt(t,e),this},u.prototype.replaceAt=function(e,t){var r=this._children,n=r[t];return e&&e!==this&&e.parent!==this&&e!==n&&(r[t]=e,n.parent=null,(r=this.__zr)&&n.removeSelfFromZr(r),this._doAdd(e)),this},u.prototype._doAdd=function(e){e.parent&&e.parent.remove(e);var t=(e.parent=this).__zr;t&&t!==e.__zr&&e.addSelfToZr(t),t&&t.refresh()},u.prototype.remove=function(e){var t=this.__zr,r=this._children,n=de(r,e);return n<0||(r.splice(n,1),e.parent=null,t&&e.removeSelfFromZr(t),t&&t.refresh()),this},u.prototype.removeAll=function(){for(var e=this._children,t=this.__zr,r=0;r<e.length;r++){var n=e[r];t&&n.removeSelfFromZr(t),n.parent=null}return e.length=0,this},u.prototype.eachChild=function(e,t){for(var r=this._children,n=0;n<r.length;n++){var o=r[n];e.call(t,o,n)}return this},u.prototype.traverse=function(e,t){for(var r=0;r<this._children.length;r++){var n=this._children[r],o=e.call(t,n);n.isGroup&&!o&&n.traverse(e,t)}return this},u.prototype.addSelfToZr=function(e){Ho.prototype.addSelfToZr.call(this,e);for(var t=0;t<this._children.length;t++)this._children[t].addSelfToZr(e)},u.prototype.removeSelfFromZr=function(e){Ho.prototype.removeSelfFromZr.call(this,e);for(var t=0;t<this._children.length;t++)this._children[t].removeSelfFromZr(e)},u.prototype.getBoundingRect=function(e){for(var t=new Y(0,0,0,0),r=e||this._children,n=[],o=null,i=0;i<r.length;i++){var a,s=r[i];s.ignore||s.invisible||(a=s.getBoundingRect(),(s=s.getLocalTransform(n))?(Y.applyTransform(t,a,s),(o=o||t.clone()).union(t)):(o=o||a.clone()).union(a))}return o||t};var Ho,Lo=u;function u(e){var t=Ho.call(this)||this;return t.isGroup=!0,t._children=[],t.attr(e),t}Lo.prototype.type="group";var No={},Bo={};c.prototype.add=function(e){e&&(this.storage.addRoot(e),e.addSelfToZr(this),this.refresh())},c.prototype.remove=function(e){e&&(this.storage.delRoot(e),e.removeSelfFromZr(this),this.refresh())},c.prototype.configLayer=function(e,t){this.painter.configLayer&&this.painter.configLayer(e,t),this.refresh()},c.prototype.setBackgroundColor=function(e){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(e),this.refresh(),this._backgroundColor=e,this._darkMode=function(e){if(e){if("string"==typeof e)return Fr(e,1)<.4;if(e.colorStops){for(var t=e.colorStops,r=0,n=t.length,o=0;o<n;o++)r+=Fr(t[o].color,1);return(r/=n)<.4}}return!1}(e)},c.prototype.getBackgroundColor=function(){return this._backgroundColor},c.prototype.setDarkMode=function(e){this._darkMode=e},c.prototype.isDarkMode=function(){return this._darkMode},c.prototype.refreshImmediately=function(e){e||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},c.prototype.refresh=function(){this._needsRefresh=!0,this.animation.start()},c.prototype.flush=function(){this._flush(!1)},c.prototype._flush=function(e){var t,r=yn(),e=(this._needsRefresh&&(t=!0,this.refreshImmediately(e)),this._needsRefreshHover&&(t=!0,this.refreshHoverImmediately()),yn());t?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:e-r})):0<this._sleepAfterStill&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill)&&this.animation.stop()},c.prototype.setSleepAfterStill=function(e){this._sleepAfterStill=e},c.prototype.wakeUp=function(){this.animation.start(),this._stillFrameAccum=0},c.prototype.refreshHover=function(){this._needsRefreshHover=!0},c.prototype.refreshHoverImmediately=function(){this._needsRefreshHover=!1,this.painter.refreshHover&&"canvas"===this.painter.getType()&&this.painter.refreshHover()},c.prototype.resize=function(e){this.painter.resize((e=e||{}).width,e.height),this.handler.resize()},c.prototype.clearAnimation=function(){this.animation.clear()},c.prototype.getWidth=function(){return this.painter.getWidth()},c.prototype.getHeight=function(){return this.painter.getHeight()},c.prototype.setCursorStyle=function(e){this.handler.setCursorStyle(e)},c.prototype.findHover=function(e,t){return this.handler.findHover(e,t)},c.prototype.on=function(e,t,r){return this.handler.on(e,t,r),this},c.prototype.off=function(e,t){this.handler.off(e,t)},c.prototype.trigger=function(e,t){this.handler.trigger(e,t)},c.prototype.clear=function(){for(var e=this.storage.getRoots(),t=0;t<e.length;t++)e[t]instanceof Lo&&e[t].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()},c.prototype.dispose=function(){var e;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,e=this.id,delete Bo[e]};var jo=c;function c(e,t,r){var n=this,o=(this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,r=r||{},this.dom=t,this.id=e,new Xt),i=r.renderer||"canvas";if(No[i]||(i=U(No)[0]),!No[i])throw new Error("Renderer '"+i+"' is not imported. Please import it first.");r.useDirtyRect=null!=r.useDirtyRect&&r.useDirtyRect;i=new No[i](t,o,r,e),t=r.ssr||i.ssrOnly,this.storage=o,this.painter=i,e=a.node||a.worker||t?null:new Nn(i.getViewportRoot(),i.root);this.handler=new Ot(o,i,e,i.root),this.animation=new bn({stage:{update:t?null:function(){return n._flush(!0)}}}),t||this.animation.start()}function Vo(e,t){No[e]=t}var Fo,qo="__zr_style_"+Math.round(10*Math.random()),Go={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},Wo={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}},zo=(Go[qo]=!0,["z","z2","invisible"]),Yo=["invisible"],p=(i(h,Fo=d),h.prototype._init=function(e){for(var t=U(e),r=0;r<t.length;r++){var n=t[r];"style"===n?this.useStyle(e[n]):Fo.prototype.attrKV.call(this,n,e[n])}this.style||this.useStyle({})},h.prototype.beforeBrush=function(){},h.prototype.afterBrush=function(){},h.prototype.innerBeforeBrush=function(){},h.prototype.innerAfterBrush=function(){},h.prototype.shouldBePainted=function(e,t,r,n){var o=this.transform;if(this.ignore||this.invisible||0===this.style.opacity||this.culling&&function(e,t,r){Ko.copy(e.getBoundingRect()),e.transform&&Ko.applyTransform(e.transform);return Xo.width=t,Xo.height=r,!Ko.intersect(Xo)}(this,e,t)||o&&!o[0]&&!o[3])return!1;if(r&&this.__clipPaths)for(var i=0;i<this.__clipPaths.length;++i)if(this.__clipPaths[i].isZeroArea())return!1;if(n&&this.parent)for(var a=this.parent;a;){if(a.ignore)return!1;a=a.parent}return!0},h.prototype.contain=function(e,t){return this.rectContain(e,t)},h.prototype.traverse=function(e,t){e.call(t,this)},h.prototype.rectContain=function(e,t){e=this.transformCoordToLocal(e,t);return this.getBoundingRect().contain(e[0],e[1])},h.prototype.getPaintRect=function(){var e,t,r,n,o,i=this._paintRect;return this._paintRect&&!this.__dirty||(o=this.transform,e=this.getBoundingRect(),t=(n=this.style).shadowBlur||0,r=n.shadowOffsetX||0,n=n.shadowOffsetY||0,i=this._paintRect||(this._paintRect=new Y(0,0,0,0)),o?Y.applyTransform(i,e,o):i.copy(e),(t||r||n)&&(i.width+=2*t+Math.abs(r),i.height+=2*t+Math.abs(n),i.x=Math.min(i.x,i.x+r-t),i.y=Math.min(i.y,i.y+n-t)),o=this.dirtyRectTolerance,i.isZero())||(i.x=Math.floor(i.x-o),i.y=Math.floor(i.y-o),i.width=Math.ceil(i.width+1+2*o),i.height=Math.ceil(i.height+1+2*o)),i},h.prototype.setPrevPaintRect=function(e){e?(this._prevPaintRect=this._prevPaintRect||new Y(0,0,0,0),this._prevPaintRect.copy(e)):this._prevPaintRect=null},h.prototype.getPrevPaintRect=function(){return this._prevPaintRect},h.prototype.animateStyle=function(e){return this.animate("style",e)},h.prototype.updateDuringAnimation=function(e){"style"===e?this.dirtyStyle():this.markRedraw()},h.prototype.attrKV=function(e,t){"style"!==e?Fo.prototype.attrKV.call(this,e,t):this.style?this.setStyle(t):this.useStyle(t)},h.prototype.setStyle=function(e,t){return"string"==typeof e?this.style[e]=t:O(this.style,e),this.dirtyStyle(),this},h.prototype.dirtyStyle=function(e){e||this.markRedraw(),this.__dirty|=2,this._rect&&(this._rect=null)},h.prototype.dirty=function(){this.dirtyStyle()},h.prototype.styleChanged=function(){return!!(2&this.__dirty)},h.prototype.styleUpdated=function(){this.__dirty&=-3},h.prototype.createStyle=function(e){return Ue(Go,e)},h.prototype.useStyle=function(e){e[qo]||(e=this.createStyle(e)),this.__inHover?this.__hoverStyle=e:this.style=e,this.dirtyStyle()},h.prototype.isStyleObject=function(e){return e[qo]},h.prototype._innerSaveToNormal=function(e){Fo.prototype._innerSaveToNormal.call(this,e);var t=this._normalState;e.style&&!t.style&&(t.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,t,zo)},h.prototype._applyStateObj=function(e,t,r,n,o,i){Fo.prototype._applyStateObj.call(this,e,t,r,n,o,i);var a,s=!(t&&n);if(t&&t.style?o?n?a=t.style:(a=this._mergeStyle(this.createStyle(),r.style),this._mergeStyle(a,t.style)):(a=this._mergeStyle(this.createStyle(),(n?this:r).style),this._mergeStyle(a,t.style)):s&&(a=r.style),a)if(o){var d=this.style;if(this.style=this.createStyle(s?{}:d),s)for(var l=U(d),u=0;u<l.length;u++)(p=l[u])in a&&(a[p]=a[p],this.style[p]=d[p]);for(var c=U(a),u=0;u<c.length;u++){var p=c[u];this.style[p]=this.style[p]}this._transitionState(e,{style:a},i,this.getAnimationStyleProps())}else this.useStyle(a);for(var h=this.__inHover?Yo:zo,u=0;u<h.length;u++){p=h[u];t&&null!=t[p]?this[p]=t[p]:s&&null!=r[p]&&(this[p]=r[p])}},h.prototype._mergeStates=function(e){for(var t,r=Fo.prototype._mergeStates.call(this,e),n=0;n<e.length;n++){var o=e[n];o.style&&this._mergeStyle(t=t||{},o.style)}return t&&(r.style=t),r},h.prototype._mergeStyle=function(e,t){return O(e,t),e},h.prototype.getAnimationStyleProps=function(){return Wo},h.initDefaultProps=((p=h.prototype).type="displayable",p.invisible=!1,p.z=0,p.z2=0,p.zlevel=0,p.culling=!1,p.cursor="pointer",p.rectHover=!1,p.incremental=!1,p._rect=null,p.dirtyRectTolerance=0,void(p.__dirty=2|Gt)),h);function h(e){return Fo.call(this,e)||this}var Ko=new Y(0,0,0,0),Xo=new Y(0,0,0,0);var K=Math.min,Jo=Math.max,Qo=Math.sin,Zo=Math.cos,$o=2*Math.PI,ei=je(),ti=je(),ri=je();function ni(e,t,r){if(0!==e.length){for(var n=e[0],o=n[0],i=n[0],a=n[1],s=n[1],d=1;d<e.length;d++)n=e[d],o=K(o,n[0]),i=Jo(i,n[0]),a=K(a,n[1]),s=Jo(s,n[1]);t[0]=o,t[1]=a,r[0]=i,r[1]=s}}function oi(e,t,r,n,o,i){o[0]=K(e,r),o[1]=K(t,n),i[0]=Jo(e,r),i[1]=Jo(t,n)}var ii=[],ai=[];var X={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},si=[],di=[],li=[],ui=[],ci=[],pi=[],hi=Math.min,fi=Math.max,mi=Math.cos,gi=Math.sin,yi=Math.abs,vi=Math.PI,bi=2*vi,_i="undefined"!=typeof Float32Array,Si=[];function wi(e){return Math.round(e/vi*1e8)/1e8%2*vi}f.prototype.increaseVersion=function(){this._version++},f.prototype.getVersion=function(){return this._version},f.prototype.setScale=function(e,t,r){0<(r=r||0)&&(this._ux=yi(r/Vn/e)||0,this._uy=yi(r/Vn/t)||0)},f.prototype.setDPR=function(e){this.dpr=e},f.prototype.setContext=function(e){this._ctx=e},f.prototype.getContext=function(){return this._ctx},f.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},f.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},f.prototype.moveTo=function(e,t){return this._drawPendingPt(),this.addData(X.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},f.prototype.lineTo=function(e,t){var r=yi(e-this._xi),n=yi(t-this._yi),o=r>this._ux||n>this._uy;return this.addData(X.L,e,t),this._ctx&&o&&this._ctx.lineTo(e,t),o?(this._xi=e,this._yi=t,this._pendingPtDist=0):(o=r*r+n*n)>this._pendingPtDist&&(this._pendingPtX=e,this._pendingPtY=t,this._pendingPtDist=o),this},f.prototype.bezierCurveTo=function(e,t,r,n,o,i){return this._drawPendingPt(),this.addData(X.C,e,t,r,n,o,i),this._ctx&&this._ctx.bezierCurveTo(e,t,r,n,o,i),this._xi=o,this._yi=i,this},f.prototype.quadraticCurveTo=function(e,t,r,n){return this._drawPendingPt(),this.addData(X.Q,e,t,r,n),this._ctx&&this._ctx.quadraticCurveTo(e,t,r,n),this._xi=r,this._yi=n,this},f.prototype.arc=function(e,t,r,n,o,i){this._drawPendingPt(),Si[0]=n,Si[1]=o,s=i,(d=wi((a=Si)[0]))<0&&(d+=bi),u=d-a[0],l=a[1],l+=u,!s&&bi<=l-d?l=d+bi:s&&bi<=d-l?l=d-bi:!s&&l<d?l=d+(bi-wi(d-l)):s&&d<l&&(l=d-(bi-wi(l-d))),a[0]=d,a[1]=l;var a,s,d,l,u=(o=Si[1])-(n=Si[0]);return this.addData(X.A,e,t,r,r,n,u,0,i?0:1),this._ctx&&this._ctx.arc(e,t,r,n,o,i),this._xi=mi(o)*r+e,this._yi=gi(o)*r+t,this},f.prototype.arcTo=function(e,t,r,n,o){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(e,t,r,n,o),this},f.prototype.rect=function(e,t,r,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(e,t,r,n),this.addData(X.R,e,t,r,n),this},f.prototype.closePath=function(){this._drawPendingPt(),this.addData(X.Z);var e=this._ctx,t=this._x0,r=this._y0;return e&&e.closePath(),this._xi=t,this._yi=r,this},f.prototype.fill=function(e){e&&e.fill(),this.toStatic()},f.prototype.stroke=function(e){e&&e.stroke(),this.toStatic()},f.prototype.len=function(){return this._len},f.prototype.setData=function(e){var t=e.length;this.data&&this.data.length===t||!_i||(this.data=new Float32Array(t));for(var r=0;r<t;r++)this.data[r]=e[r];this._len=t},f.prototype.appendPath=function(e){for(var t=(e=e instanceof Array?e:[e]).length,r=0,n=this._len,o=0;o<t;o++)r+=e[o].len();_i&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+r));for(o=0;o<t;o++)for(var i=e[o].data,a=0;a<i.length;a++)this.data[n++]=i[a];this._len=n},f.prototype.addData=function(e,t,r,n,o,i,a,s,d){if(this._saveData){var l=this.data;this._len+arguments.length>l.length&&(this._expandData(),l=this.data);for(var u=0;u<arguments.length;u++)l[this._len++]=arguments[u]}},f.prototype._drawPendingPt=function(){0<this._pendingPtDist&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},f.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},f.prototype.toStatic=function(){var e;this._saveData&&(this._drawPendingPt(),(e=this.data)instanceof Array)&&(e.length=this._len,_i)&&11<this._len&&(this.data=new Float32Array(e))},f.prototype.getBoundingRect=function(){li[0]=li[1]=ci[0]=ci[1]=Number.MAX_VALUE,ui[0]=ui[1]=pi[0]=pi[1]=-Number.MAX_VALUE;for(var e,t=this.data,r=0,n=0,o=0,i=0,a=0;a<this._len;){var H=t[a++],L=1===a;switch(L&&(o=r=t[a],i=n=t[a+1]),H){case X.M:r=o=t[a++],n=i=t[a++],ci[0]=o,ci[1]=i,pi[0]=o,pi[1]=i;break;case X.L:oi(r,n,t[a],t[a+1],ci,pi),r=t[a++],n=t[a++];break;case X.C:F=V=y=g=j=m=f=h=p=c=B=N=u=l=d=s=void 0;var s=r,d=n,l=t[a++],u=t[a++],N=t[a++],B=t[a++],c=t[a],p=t[a+1],h=ci,f=pi,m=cr,j=W,g=m(s,l,N,c,ii);h[0]=1/0,h[1]=1/0,f[0]=-1/0,f[1]=-1/0;for(var y=0;y<g;y++){var V=j(s,l,N,c,ii[y]);h[0]=K(V,h[0]),f[0]=Jo(V,f[0])}for(g=m(d,u,B,p,ai),y=0;y<g;y++){var F=j(d,u,B,p,ai[y]);h[1]=K(F,h[1]),f[1]=Jo(F,f[1])}h[0]=K(s,h[0]),f[0]=Jo(s,f[0]),h[0]=K(c,h[0]),f[0]=Jo(c,f[0]),h[1]=K(d,h[1]),f[1]=Jo(d,f[1]),h[1]=K(p,h[1]),f[1]=Jo(p,f[1]),r=t[a++],n=t[a++];break;case X.Q:m=r,A=n,I=t[a++],_=t[a++],E=t[a],v=t[a+1],w=ci,T=pi,e=S=e=b=void 0,b=z,e=Jo(K((S=fr)(m,I,E),1),0),S=Jo(K(S(A,_,v),1),0),I=b(m,I,E,e),e=b(A,_,v,S),w[0]=K(m,E,I),w[1]=K(A,v,e),T[0]=Jo(m,E,I),T[1]=Jo(A,v,e),r=t[a++],n=t[a++];break;case X.A:var v,b=t[a++],_=t[a++],S=t[a++],w=t[a++],E=t[a++],I=t[a++]+E,T=(a+=1,!t[a++]),C=(L&&(o=mi(E)*S+b,i=gi(E)*w+_),D=v=G=q=U=O=A=M=x=k=P=R=C=void 0,b),R=_,P=S,k=w,x=E,M=I,A=T,O=ci,U=pi,q=et,G=tt;if((v=Math.abs(x-M))%$o<1e-4&&1e-4<v)O[0]=C-P,O[1]=R-k,U[0]=C+P,U[1]=R+k;else{ei[0]=Zo(x)*P+C,ei[1]=Qo(x)*k+R,ti[0]=Zo(M)*P+C,ti[1]=Qo(M)*k+R,q(O,ei,ti),G(U,ei,ti),(x%=$o)<0&&(x+=$o),(M%=$o)<0&&(M+=$o),M<x&&!A?M+=$o:x<M&&A&&(x+=$o),A&&(v=M,M=x,x=v);for(var D=0;D<M;D+=Math.PI/2)x<D&&(ri[0]=Zo(D)*P+C,ri[1]=Qo(D)*k+R,q(O,ri,O),G(U,ri,U))}r=mi(I)*S+b,n=gi(I)*w+_;break;case X.R:oi(o=r=t[a++],i=n=t[a++],o+t[a++],i+t[a++],ci,pi);break;case X.Z:r=o,n=i}et(li,li,ci),tt(ui,ui,pi)}return 0===a&&(li[0]=li[1]=ui[0]=ui[1]=0),new Y(li[0],li[1],ui[0]-li[0],ui[1]-li[1])},f.prototype._calculateLength=function(){for(var e=this.data,t=this._len,r=this._ux,n=this._uy,o=0,i=0,a=0,s=0,d=(this._pathSegLen||(this._pathSegLen=[]),this._pathSegLen),l=0,u=0,c=0;c<t;){var p=e[c++],h=1===c,f=(h&&(a=o=e[c],s=i=e[c+1]),-1);switch(p){case X.M:o=a=e[c++],i=s=e[c++];break;case X.L:var m=e[c++],g=(b=e[c++])-i;(yi(R=m-o)>r||yi(g)>n||c===t-1)&&(f=Math.sqrt(R*R+g*g),o=m,i=b);break;case X.C:var y=e[c++],v=e[c++],m=e[c++],b=e[c++],_=e[c++],S=e[c++],f=function(e,t,r,n,o,i,a,s,d){for(var l=e,u=t,c=0,p=1/d,h=1;h<=d;h++){var f=h*p,m=W(e,r,o,a,f),f=W(t,n,i,s,f),g=m-l,y=f-u;c+=Math.sqrt(g*g+y*y),l=m,u=f}return c}(o,i,y,v,m,b,_,S,10),o=_,i=S;break;case X.Q:f=function(e,t,r,n,o,i,a){for(var s=e,d=t,l=0,u=1/a,c=1;c<=a;c++){var p=c*u,h=z(e,r,o,p),p=z(t,n,i,p),f=h-s,m=p-d;l+=Math.sqrt(f*f+m*m),s=h,d=p}return l}(o,i,y=e[c++],v=e[c++],m=e[c++],b=e[c++],10),o=m,i=b;break;case X.A:var _=e[c++],S=e[c++],w=e[c++],E=e[c++],I=e[c++],T=e[c++],C=T+I;c+=1,e[c++];h&&(a=mi(I)*w+_,s=gi(I)*E+S),f=fi(w,E)*hi(bi,Math.abs(T)),o=mi(C)*w+_,i=gi(C)*E+S;break;case X.R:a=o=e[c++],s=i=e[c++];f=2*e[c++]+2*e[c++];break;case X.Z:var R=a-o,g=s-i;f=Math.sqrt(R*R+g*g),o=a,i=s}0<=f&&(l+=d[u++]=f)}return this._pathLen=l},f.prototype.rebuildPath=function(e,t){var r,n,o,i,a,s,d,l,u=this.data,H=this._ux,L=this._uy,N=this._len,c=t<1,p=0,h=0,f=0;if(!c||(this._pathSegLen||this._calculateLength(),a=this._pathSegLen,s=t*this._pathLen))e:for(var m=0;m<N;){var g=u[m++],B=1===m;switch(B&&(r=o=u[m],n=i=u[m+1]),g!==X.L&&0<f&&(e.lineTo(d,l),f=0),g){case X.M:r=o=u[m++],n=i=u[m++],e.moveTo(o,i);break;case X.L:var y=u[m++],v=u[m++],b=yi(y-o),_=yi(v-i);if(H<b||L<_){if(c){if(s<p+(D=a[h++])){var S=(s-p)/D;e.lineTo(o*(1-S)+y*S,i*(1-S)+v*S);break e}p+=D}e.lineTo(y,v),o=y,i=v,f=0}else{b=b*b+_*_;f<b&&(d=y,l=v,f=b)}break;case X.C:var w=u[m++],E=u[m++],I=u[m++],T=u[m++],_=u[m++],b=u[m++];if(c){if(s<p+(D=a[h++])){pr(o,w,I,_,S=(s-p)/D,si),pr(i,E,T,b,S,di),e.bezierCurveTo(si[1],di[1],si[2],di[2],si[3],di[3]);break e}p+=D}e.bezierCurveTo(w,E,I,T,_,b),o=_,i=b;break;case X.Q:w=u[m++],E=u[m++],I=u[m++],T=u[m++];if(c){if(s<p+(D=a[h++])){mr(o,w,I,S=(s-p)/D,si),mr(i,E,T,S,di),e.quadraticCurveTo(si[1],di[1],si[2],di[2]);break e}p+=D}e.quadraticCurveTo(w,E,I,T),o=I,i=T;break;case X.A:var C=u[m++],R=u[m++],P=u[m++],k=u[m++],x=u[m++],M=u[m++],A=u[m++],j=!u[m++],V=k<P?P:k,O=.001<yi(P-k),U=x+M,F=!1;if(c&&(s<p+(D=a[h++])&&(U=x+M*(s-p)/D,F=!0),p+=D),O&&e.ellipse?e.ellipse(C,R,P,k,A,x,U,j):e.arc(C,R,V,x,U,j),F)break e;B&&(r=mi(x)*P+C,n=gi(x)*k+R),o=mi(U)*P+C,i=gi(U)*k+R;break;case X.R:r=o=u[m],n=i=u[m+1],y=u[m++],v=u[m++];var D,M=u[m++],O=u[m++];if(c){if(s<p+(D=a[h++])){A=s-p;e.moveTo(y,v),e.lineTo(y+hi(A,M),v),0<(A-=M)&&e.lineTo(y+M,v+hi(A,O)),0<(A-=O)&&e.lineTo(y+fi(M-A,0),v+O),0<(A-=M)&&e.lineTo(y,v+fi(O-A,0));break e}p+=D}e.rect(y,v,M,O);break;case X.Z:if(c){if(s<p+(D=a[h++])){S=(s-p)/D;e.lineTo(o*(1-S)+r*S,i*(1-S)+n*S);break e}p+=D}e.closePath(),o=r,i=n}}},f.prototype.clone=function(){var e=new f,t=this.data;return e.data=t.slice?t.slice():Array.prototype.slice.call(t),e._len=this._len,e},f.CMD=X,f.initDefaultProps=((Fi=f.prototype)._saveData=!0,Fi._ux=0,Fi._uy=0,Fi._pendingPtDist=0,void(Fi._version=0));var Ei=f;function f(e){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,e&&(this._saveData=!1),this._saveData&&(this.data=[])}function Ii(e,t,r,n,o,i,a){var s;if(0!==o)return s=0,!(t+(o=o)<a&&n+o<a||a<t-o&&a<n-o||e+o<i&&r+o<i||i<e-o&&i<r-o)&&(e===r?Math.abs(i-e)<=o/2:(i=(s=(t-n)/(e-r))*i-a+(e*n-r*t)/(e-r))*i/(s*s+1)<=o/2*o/2)}function Ti(e,t,r,n,o,i,a,s,d,l,u){if(0!==d)return!(t+(d=d)<u&&n+d<u&&i+d<u&&s+d<u||u<t-d&&u<n-d&&u<i-d&&u<s-d||e+d<l&&r+d<l&&o+d<l&&a+d<l||l<e-d&&l<r-d&&l<o-d&&l<a-d)&&function(e,t,r,n,o,i,a,s,d,l,u){var c,p,h,f,m=.005,g=1/0;or[0]=d,or[1]=l;for(var y=0;y<1;y+=.05)ir[0]=W(e,r,o,a,y),ir[1]=W(t,n,i,s,y),(h=Qe(or,ir))<g&&(c=y,g=h);for(var g=1/0,v=0;v<32&&!(m<1e-4);v++)p=c+m,ir[0]=W(e,r,o,a,f=c-m),ir[1]=W(t,n,i,s,f),h=Qe(ir,or),0<=f&&h<g?(c=f,g=h):(ar[0]=W(e,r,o,a,p),ar[1]=W(t,n,i,s,p),f=Qe(ar,or),p<=1&&f<g?(c=p,g=f):m*=.5);return u&&(u[0]=W(e,r,o,a,c),u[1]=W(t,n,i,s,c)),er(g)}(e,t,r,n,o,i,a,s,l,u,null)<=d/2}function Ci(e,t,r,n,o,i,a,s,d){if(0!==a)return!(t+(a=a)<d&&n+a<d&&i+a<d||d<t-a&&d<n-a&&d<i-a||e+a<s&&r+a<s&&o+a<s||s<e-a&&s<r-a&&s<o-a)&&function(e,t,r,n,o,i,a,s,d){var l,u=.005,c=1/0;or[0]=a,or[1]=s;for(var p=0;p<1;p+=.05)ir[0]=z(e,r,o,p),ir[1]=z(t,n,i,p),(g=Qe(or,ir))<c&&(l=p,c=g);for(var c=1/0,h=0;h<32&&!(u<1e-4);h++){var f=l-u,m=l+u,g=(ir[0]=z(e,r,o,f),ir[1]=z(t,n,i,f),Qe(ir,or));0<=f&&g<c?(l=f,c=g):(ar[0]=z(e,r,o,m),ar[1]=z(t,n,i,m),f=Qe(ar,or),m<=1&&f<c?(l=m,c=f):u*=.5)}return d&&(d[0]=z(e,r,o,l),d[1]=z(t,n,i,l)),er(c)}(e,t,r,n,o,i,s,d,null)<=a/2}var Ri=2*Math.PI;function Pi(e){return(e%=Ri)<0&&(e+=Ri),e}var ki=2*Math.PI;function xi(e,t,r,n,o,i){return t<i&&n<i||i<t&&i<n||n===t?0:(r=(i=(i-t)/(n-t))*(r-e)+e)===o?1/0:o<r?1!=i&&0!=i?n<t?1:-1:n<t?.5:-.5:0}var Mi=Ei.CMD,Ai=2*Math.PI,Oi=1e-4;var C=[-1,-1,-1],Ui=[-1,-1];function Di(e,t,r,n,o,i,a,s,d,l){if(t<l&&n<l&&i<l&&s<l||l<t&&l<n&&l<i&&l<s)return 0;var u=ur(t,n,i,s,l,C);if(0===u)return 0;for(var c,p=0,h=-1,f=void 0,m=void 0,g=0;g<u;g++){var y=C[g],v=0===y||1===y?.5:1;W(e,r,o,a,y)<d||(h<0&&(h=cr(t,n,i,s,Ui),Ui[1]<Ui[0]&&1<h&&(c=void 0,c=Ui[0],Ui[0]=Ui[1],Ui[1]=c),f=W(t,n,i,s,Ui[0]),1<h)&&(m=W(t,n,i,s,Ui[1])),2===h?y<Ui[0]?p+=f<t?v:-v:y<Ui[1]?p+=m<f?v:-v:p+=s<m?v:-v:y<Ui[0]?p+=f<t?v:-v:p+=s<f?v:-v)}return p}function Hi(e,t,r,n,o,i,a,s){if(t<s&&n<s&&i<s||s<t&&s<n&&s<i)return 0;c=C,u=(d=t)-2*(l=n)+(u=i),l=2*(l-d),d-=s=s,s=0,sr(u)?dr(l)&&0<=(p=-d/l)&&p<=1&&(c[s++]=p):sr(d=l*l-4*u*d)?0<=(p=-l/(2*u))&&p<=1&&(c[s++]=p):0<d&&(h=(-l-(d=er(d)))/(2*u),0<=(p=(-l+d)/(2*u))&&p<=1&&(c[s++]=p),0<=h)&&h<=1&&(c[s++]=h);var d,l,u,c,p,h,f=s;if(0===f)return 0;var m=fr(t,n,i);if(0<=m&&m<=1){for(var g=0,y=z(t,n,i,m),v=0;v<f;v++){var b=0===C[v]||1===C[v]?.5:1;z(e,r,o,C[v])<a||(C[v]<m?g+=y<t?b:-b:g+=i<y?b:-b)}return g}return b=0===C[0]||1===C[0]?.5:1,z(e,r,o,C[0])<a?0:i<t?b:-b}function Li(e,t,r,n,o){for(var i,a=e.data,s=e.len(),d=0,l=0,u=0,c=0,p=0,h=0;h<s;){var f=a[h++],m=1===h;switch(f===Mi.M&&1<h&&(r||(d+=xi(l,u,c,p,n,o))),m&&(c=l=a[h],p=u=a[h+1]),f){case Mi.M:l=c=a[h++],u=p=a[h++];break;case Mi.L:if(r){if(Ii(l,u,a[h],a[h+1],t,n,o))return!0}else d+=xi(l,u,a[h],a[h+1],n,o)||0;l=a[h++],u=a[h++];break;case Mi.C:if(r){if(Ti(l,u,a[h++],a[h++],a[h++],a[h++],a[h],a[h+1],t,n,o))return!0}else d+=Di(l,u,a[h++],a[h++],a[h++],a[h++],a[h],a[h+1],n,o)||0;l=a[h++],u=a[h++];break;case Mi.Q:if(r){if(Ci(l,u,a[h++],a[h++],a[h],a[h+1],t,n,o))return!0}else d+=Hi(l,u,a[h++],a[h++],a[h],a[h+1],n,o)||0;l=a[h++],u=a[h++];break;case Mi.A:var g=a[h++],y=a[h++],v=a[h++],b=a[h++],_=a[h++],S=a[h++],w=(h+=1,!!(1-a[h++])),E=Math.cos(_)*v+g,I=Math.sin(_)*b+y,T=(m?(c=E,p=I):d+=xi(l,u,E,I,n,o),(n-g)*b/v+g);if(r){if(function(e,t,r,n,o,i,a,s,d){if(0!==a)return a=a,s-=e,d-=t,!(r<(e=Math.sqrt(s*s+d*d))-a||e+a<r)&&(Math.abs(n-o)%ki<1e-4||((o=i?(t=n,n=Pi(o),Pi(t)):(n=Pi(n),Pi(o)))<n&&(o+=ki),(e=Math.atan2(d,s))<0&&(e+=ki),n<=e&&e<=o)||n<=e+ki&&e+ki<=o)}(g,y,b,_,_+S,w,t,T,o))return!0}else d+=function(e,t,r,n,o,i,a,s){if(r<(s-=t)||s<-r)return 0;var t=Math.sqrt(r*r-s*s);if(C[0]=-t,C[1]=t,(r=Math.abs(n-o))<1e-4)return 0;if(Ai-1e-4<=r)return o=Ai,u=i?1:-1,a>=C[n=0]+e&&a<=C[1]+e?u:0;o<n&&(t=n,n=o,o=t),n<0&&(n+=Ai,o+=Ai);for(var d=0,l=0;l<2;l++){var u,c=C[l];a<c+e&&(u=i?1:-1,n<=(c=(c=Math.atan2(s,c))<0?Ai+c:c)&&c<=o||n<=c+Ai&&c+Ai<=o)&&(d+=u=c>Math.PI/2&&c<1.5*Math.PI?-u:u)}return d}(g,y,b,_,_+S,w,T,o);l=Math.cos(_+S)*v+g,u=Math.sin(_+S)*b+y;break;case Mi.R:c=l=a[h++],p=u=a[h++];if(E=c+a[h++],I=p+a[h++],r){if(Ii(c,p,E,p,t,n,o)||Ii(E,p,E,I,t,n,o)||Ii(E,I,c,I,t,n,o)||Ii(c,I,c,p,t,n,o))return!0}else d=(d+=xi(E,p,E,I,n,o))+xi(c,I,c,p,n,o);break;case Mi.Z:if(r){if(Ii(l,u,c,p,t,n,o))return!0}else d+=xi(l,u,c,p,n,o);l=c,u=p}}return r||(e=u,i=p,Math.abs(e-i)<Oi)||(d+=xi(l,u,c,p,n,o)||0),0!==d}var Ni,Bi=ae({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},Go),ji={style:ae({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},Wo.style)},Vi=io.concat(["invisible","culling","z","z2","zlevel","parent"]),J=(i(m,Ni=p),m.prototype.update=function(){var t=this,e=(Ni.prototype.update.call(this),this.style);if(e.decal){var r,n=this._decalEl=this._decalEl||new m,o=(n.buildPath===m.prototype.buildPath&&(n.buildPath=function(e){t.buildPath(e,t.shape)}),n.silent=!0,n.style);for(r in e)o[r]!==e[r]&&(o[r]=e[r]);o.fill=e.fill?e.decal:null,o.decal=null,o.shadowColor=null,e.strokeFirst&&(o.stroke=null);for(var i=0;i<Vi.length;++i)n[Vi[i]]=this[Vi[i]];n.__dirty|=Gt}else this._decalEl&&(this._decalEl=null)},m.prototype.getDecalElement=function(){return this._decalEl},m.prototype._init=function(e){var t=U(e),r=(this.shape=this.getDefaultShape(),this.getDefaultStyle());r&&this.useStyle(r);for(var n=0;n<t.length;n++){var o=t[n],i=e[o];"style"===o?this.style?O(this.style,i):this.useStyle(i):"shape"===o?O(this.shape,i):Ni.prototype.attrKV.call(this,o,i)}this.style||this.useStyle({})},m.prototype.getDefaultStyle=function(){return null},m.prototype.getDefaultShape=function(){return{}},m.prototype.canBeInsideText=function(){return this.hasFill()},m.prototype.getInsideTextFill=function(){var e,t=this.style.fill;if("none"!==t){if(ge(t))return.5<(e=Fr(t,0))?Fn:.2<e?"#eee":qn;if(t)return qn}return Fn},m.prototype.getInsideTextStroke=function(e){var t=this.style.fill;if(ge(t)){var r=this.__zr;if(!(!r||!r.isDarkMode())==Fr(e,0)<.4)return t}},m.prototype.buildPath=function(e,t,r){},m.prototype.pathUpdated=function(){this.__dirty&=~Wt},m.prototype.getUpdatedPathProxy=function(e){return this.path||this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,e),this.path},m.prototype.createPathProxy=function(){this.path=new Ei(!1)},m.prototype.hasStroke=function(){var e=this.style,t=e.stroke;return!(null==t||"none"===t||!(0<e.lineWidth))},m.prototype.hasFill=function(){var e=this.style.fill;return null!=e&&"none"!==e},m.prototype.getBoundingRect=function(){var e,t,r=this._rect,n=this.style,o=!r;return o&&(e=!1,this.path||(e=!0,this.createPathProxy()),t=this.path,(e||this.__dirty&Wt)&&(t.beginPath(),this.buildPath(t,this.shape,!1),this.pathUpdated()),r=t.getBoundingRect()),this._rect=r,this.hasStroke()&&this.path&&0<this.path.len()?(e=this._rectStroke||(this._rectStroke=r.clone()),(this.__dirty||o)&&(e.copy(r),t=n.strokeNoScale?this.getLineScale():1,o=n.lineWidth,this.hasFill()||(n=this.strokeContainThreshold,o=Math.max(o,null==n?4:n)),1e-10<t)&&(e.width+=o/t,e.height+=o/t,e.x-=o/t/2,e.y-=o/t/2),e):r},m.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t),n=this.getBoundingRect(),o=this.style;if(e=r[0],t=r[1],n.contain(e,t)){r=this.path;if(this.hasStroke()){n=o.lineWidth,o=o.strokeNoScale?this.getLineScale():1;if(1e-10<o&&(this.hasFill()||(n=Math.max(n,this.strokeContainThreshold)),Li(r,n/o,!0,e,t)))return!0}if(this.hasFill())return Li(r,0,!1,e,t)}return!1},m.prototype.dirtyShape=function(){this.__dirty|=Wt,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},m.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},m.prototype.animateShape=function(e){return this.animate("shape",e)},m.prototype.updateDuringAnimation=function(e){"style"===e?this.dirtyStyle():"shape"===e?this.dirtyShape():this.markRedraw()},m.prototype.attrKV=function(e,t){"shape"===e?this.setShape(t):Ni.prototype.attrKV.call(this,e,t)},m.prototype.setShape=function(e,t){var r=(r=this.shape)||(this.shape={});return"string"==typeof e?r[e]=t:O(r,e),this.dirtyShape(),this},m.prototype.shapeChanged=function(){return!!(this.__dirty&Wt)},m.prototype.createStyle=function(e){return Ue(Bi,e)},m.prototype._innerSaveToNormal=function(e){Ni.prototype._innerSaveToNormal.call(this,e);var t=this._normalState;e.shape&&!t.shape&&(t.shape=O({},this.shape))},m.prototype._applyStateObj=function(e,t,r,n,o,i){Ni.prototype._applyStateObj.call(this,e,t,r,n,o,i);var a,s=!(t&&n);if(t&&t.shape?o?n?a=t.shape:(a=O({},r.shape),O(a,t.shape)):(a=O({},(n?this:r).shape),O(a,t.shape)):s&&(a=r.shape),a)if(o){this.shape=O({},this.shape);for(var d={},l=U(a),u=0;u<l.length;u++){var c=l[u];"object"==typeof a[c]?this.shape[c]=a[c]:d[c]=a[c]}this._transitionState(e,{shape:d},i)}else this.shape=a,this.dirtyShape()},m.prototype._mergeStates=function(e){for(var t,r=Ni.prototype._mergeStates.call(this,e),n=0;n<e.length;n++){var o=e[n];o.shape&&this._mergeStyle(t=t||{},o.shape)}return t&&(r.shape=t),r},m.prototype.getAnimationStyleProps=function(){return ji},m.prototype.isZeroArea=function(){return!1},m.extend=function(r){i(o,n=m),o.prototype.getDefaultStyle=function(){return oe(r.style)},o.prototype.getDefaultShape=function(){return oe(r.shape)};var n,e,t=o;function o(e){var t=n.call(this,e)||this;return r.init&&r.init.call(t,e),t}for(e in r)"function"==typeof r[e]&&(t.prototype[e]=r[e]);return t},m.initDefaultProps=((Fi=m.prototype).type="path",Fi.strokeContainThreshold=5,Fi.segmentIgnoreThreshold=0,Fi.subPixelOptimize=!1,Fi.autoBatch=!1,void(Fi.__dirty=2|Gt|Wt)),m);function m(e){return Ni.call(this,e)||this}var Fi=J.extend({type:"Arrowline",shape:{x1:0,y1:0,x2:0,y2:0,percent:1,arrowlength:10,arrowtype:1,points:[]},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r,n,o,i,a,s,d,l,u=t.x1,c=t.y1,p=t.x2,h=t.y2,f=t.percent,m=t.arrowlength;0!==f&&(e.moveTo(u,c),f<1&&(p=u*(1-f)+p*f,h=c*(1-f)+h*f),e.lineTo(p,h),1!=t.arrowtype)&&(r=[],d=-(h-c)/(i=Math.sqrt((p-u)*(p-u)+(h-c)*(h-c))),l=(p-u)/i,n=m*(Math.cos(5*Math.PI/6)*l-Math.sin(5*Math.PI/6)*d),o=m*(Math.cos(5*Math.PI/6)*d+Math.sin(5*Math.PI/6)*l),i=u*(1-(f=1-m*(Math.cos(Math.PI/6)-.5)/i))+p*f,a=c*(1-f)+h*f,s=m*(Math.cos(7*Math.PI/6)*l-Math.sin(7*Math.PI/6)*d),m=m*(Math.cos(7*Math.PI/6)*d+Math.sin(7*Math.PI/6)*l),d=u*(1-(f=1-f))+p*f,l=c*(1-f)+h*f,3==t.arrowtype?(r.push([p,h]),r.push([p+n,h-o]),r.push([i,a]),r.push([p+s,h-m]),r.push([p,h])):2==t.arrowtype?(r.push([u,c]),r.push([u-n,c+o]),r.push([d,l]),r.push([u-s,c+m]),r.push([u,c])):4==t.arrowtype&&(r.push([p,h]),r.push([p+n,h-o]),r.push([i,a]),r.push([p+s,h-m]),r.push([p,h]),r.push([u,c]),r.push([u-n,c+o]),r.push([d,l]),r.push([u-s,c+m]),r.push([u,c])),t.points=r,La(e,t,!0))}}),qi=Ei.CMD,Gi=[[],[],[]],Wi=Math.sqrt,zi=Math.atan2;function Yi(e,t){if(t){for(var r,n,o,i,a=e.data,s=e.len(),d=qi.M,l=qi.C,u=qi.L,c=qi.R,p=qi.A,h=qi.Q,f=0,m=0;f<s;){switch(r=a[f++],m=f,n=0,r){case d:case u:n=1;break;case l:n=3;break;case h:n=2;break;case p:var g=t[4],y=t[5],v=Wi(t[0]*t[0]+t[1]*t[1]),b=Wi(t[2]*t[2]+t[3]*t[3]),_=zi(-t[1]/b,t[0]/v);a[f]*=v,a[f++]+=g,a[f]*=b,a[f++]+=y,a[f++]*=v,a[f++]*=b,a[f++]+=_,a[f++]+=_,m=f+=2;break;case c:i[0]=a[f++],i[1]=a[f++],$e(i,i,t),a[m++]=i[0],a[m++]=i[1],i[0]+=a[f++],i[1]+=a[f++],$e(i,i,t),a[m++]=i[0],a[m++]=i[1]}for(o=0;o<n;o++){var S=Gi[o];S[0]=a[f++],S[1]=a[f++],$e(S,S,t),a[m++]=S[0],a[m++]=S[1]}}e.increaseVersion()}}var Ki=Math.sqrt,Xi=Math.sin,Ji=Math.cos,Qi=Math.PI;function Zi(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function $i(e,t){return(e[0]*t[0]+e[1]*t[1])/(Zi(e)*Zi(t))}function ea(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos($i(e,t))}function ta(e,t,r,n,o,i,a,s,d,l,u){var d=d*(Qi/180),c=Ji(d)*(e-r)/2+Xi(d)*(t-n)/2,p=-1*Xi(d)*(e-r)/2+Ji(d)*(t-n)/2,h=c*c/(a*a)+p*p/(s*s),h=(1<h&&(a*=Ki(h),s*=Ki(h)),(o===i?-1:1)*Ki((a*a*(s*s)-a*a*(p*p)-s*s*(c*c))/(a*a*(p*p)+s*s*(c*c)))||0),o=h*a*p/s,h=h*-s*c/a,e=(e+r)/2+Ji(d)*o-Xi(d)*h,r=(t+n)/2+Xi(d)*o+Ji(d)*h,t=ea([1,0],[(c-o)/a,(p-h)/s]),n=[(c-o)/a,(p-h)/s],c=[(-1*c-o)/a,(-1*p-h)/s],o=ea(n,c);$i(n,c)<=-1&&(o=Qi),(o=1<=$i(n,c)?0:o)<0&&(p=Math.round(o/Qi*1e6)/1e6,o=2*Qi+p%2*Qi),u.addData(l,e,r,a,s,t,o,d,i)}var ra=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/gi,na=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;i(aa,oa=J),aa.prototype.applyTransform=function(e){};var oa,ia=aa;function aa(){return null!==oa&&oa.apply(this,arguments)||this}function sa(e){return null!=e.setData}function da(e,t){var r=function(e){var t=new Ei;if(e){var r,n=0,o=0,i=n,a=o,s=Ei.CMD,d=e.match(ra);if(d){for(var l=0;l<d.length;l++){for(var u=d[l],c=u.charAt(0),p=void 0,h=u.match(na)||[],f=h.length,m=0;m<f;m++)h[m]=parseFloat(h[m]);for(var g=0;g<f;){var y=void 0,v=void 0,b=void 0,_=void 0,S=void 0,w=void 0,E=void 0,I=n,T=o,C=void 0,R=void 0;switch(c){case"l":n+=h[g++],o+=h[g++],p=s.L,t.addData(p,n,o);break;case"L":n=h[g++],o=h[g++],p=s.L,t.addData(p,n,o);break;case"m":n+=h[g++],o+=h[g++],p=s.M,t.addData(p,n,o),i=n,a=o,c="l";break;case"M":n=h[g++],o=h[g++],p=s.M,t.addData(p,n,o),i=n,a=o,c="L";break;case"h":n+=h[g++],p=s.L,t.addData(p,n,o);break;case"H":n=h[g++],p=s.L,t.addData(p,n,o);break;case"v":o+=h[g++],p=s.L,t.addData(p,n,o);break;case"V":o=h[g++],p=s.L,t.addData(p,n,o);break;case"C":p=s.C,t.addData(p,h[g++],h[g++],h[g++],h[g++],h[g++],h[g++]),n=h[g-2],o=h[g-1];break;case"c":p=s.C,t.addData(p,h[g++]+n,h[g++]+o,h[g++]+n,h[g++]+o,h[g++]+n,h[g++]+o),n+=h[g-2],o+=h[g-1];break;case"S":y=n,v=o,C=t.len(),R=t.data,r===s.C&&(y+=n-R[C-4],v+=o-R[C-3]),p=s.C,I=h[g++],T=h[g++],n=h[g++],o=h[g++],t.addData(p,y,v,I,T,n,o);break;case"s":y=n,v=o,C=t.len(),R=t.data,r===s.C&&(y+=n-R[C-4],v+=o-R[C-3]),p=s.C,I=n+h[g++],T=o+h[g++],n+=h[g++],o+=h[g++],t.addData(p,y,v,I,T,n,o);break;case"Q":I=h[g++],T=h[g++],n=h[g++],o=h[g++],p=s.Q,t.addData(p,I,T,n,o);break;case"q":I=h[g++]+n,T=h[g++]+o,n+=h[g++],o+=h[g++],p=s.Q,t.addData(p,I,T,n,o);break;case"T":y=n,v=o,C=t.len(),R=t.data,r===s.Q&&(y+=n-R[C-4],v+=o-R[C-3]),n=h[g++],o=h[g++],p=s.Q,t.addData(p,y,v,n,o);break;case"t":y=n,v=o,C=t.len(),R=t.data,r===s.Q&&(y+=n-R[C-4],v+=o-R[C-3]),n+=h[g++],o+=h[g++],p=s.Q,t.addData(p,y,v,n,o);break;case"A":b=h[g++],_=h[g++],S=h[g++],w=h[g++],E=h[g++],ta(I=n,T=o,n=h[g++],o=h[g++],w,E,b,_,S,p=s.A,t);break;case"a":b=h[g++],_=h[g++],S=h[g++],w=h[g++],E=h[g++],ta(I=n,T=o,n+=h[g++],o+=h[g++],w,E,b,_,S,p=s.A,t)}}"z"!==c&&"Z"!==c||(p=s.Z,t.addData(p),n=i,o=a),r=p}t.toStatic()}}return t}(e),e=O({},t);return e.buildPath=function(e){var t;sa(e)?(e.setData(r.data),(t=e.getContext())&&e.rebuildPath(t,1)):r.rebuildPath(t=e,1)},e.applyTransform=function(e){Yi(r,e),this.dirtyShape()},e}function la(e,t){return new ia(da(e,t))}function ua(e,t){t=t||{};var r=new J;return e.shape&&r.setShape(e.shape),r.setStyle(e.style),t.bakeTransform?Yi(r.path,e.getComputedTransform()):t.toLocal?r.setLocalTransform(e.getComputedTransform()):r.copyTransform(e),r.buildPath=e.buildPath,r.applyTransform=r.applyTransform,r.z=e.z,r.z2=e.z2,r.zlevel=e.zlevel,r}var ca=Object.freeze({__proto__:null,createFromString:la,extendFromString:function(e,t){var r,n=da(e,t);function o(e){e=r.call(this,e)||this;return e.applyTransform=n.applyTransform,e.buildPath=n.buildPath,e}return i(o,r=ia),o},mergePath:function(e,t){for(var r=[],n=e.length,o=0;o<n;o++){var i=e[o];r.push(i.getUpdatedPathProxy(!0))}return(t=new J(t)).createPathProxy(),t.buildPath=function(e){var t;sa(e)&&(e.appendPath(r),t=e.getContext())&&e.rebuildPath(t,1)},t},clonePath:ua}),pa=ae({x:0,y:0},Go),ha={style:ae({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},Wo.style)};i(ga,fa=p),ga.prototype.createStyle=function(e){return Ue(pa,e)},ga.prototype._getSize=function(e){var t,r=this.style,n=r[e];return null!=n?n:(n=(n=r.image)&&"string"!=typeof n&&n.width&&n.height?r.image:this.__image)?null==(t=r[r="width"===e?"height":"width"])?n[e]:n[e]/n[r]*t:0},ga.prototype.getWidth=function(){return this._getSize("width")},ga.prototype.getHeight=function(){return this._getSize("height")},ga.prototype.getAnimationStyleProps=function(){return ha},ga.prototype.getBoundingRect=function(){var e=this.style;return this._rect||(this._rect=new Y(e.x||0,e.y||0,this.getWidth(),this.getHeight())),this._rect};var fa,ma=ga;function ga(){return null!==fa&&fa.apply(this,arguments)||this}ma.prototype.type="image";var ya,va=function(){this.cx=0,this.cy=0,this.r=0},ba=(i(_a,ya=J),_a.prototype.getDefaultShape=function(){return new va},_a.prototype.buildPath=function(e,t){e.moveTo(t.cx+t.r,t.cy),e.arc(t.cx,t.cy,t.r,0,2*Math.PI)},_a);function _a(e){return ya.call(this,e)||this}ba.prototype.type="circle";var Sa=Math.round;function wa(e,t,r){var n;return t?((n=Sa(2*e))+Sa(t))%2==0?n/2:(n+(r?1:-1))/2:e}var Ea,Ia=function(){this.x=0,this.y=0,this.width=0,this.height=0},Ta={},Ca=(i(Ra,Ea=J),Ra.prototype.getDefaultShape=function(){return new Ia},Ra.prototype.buildPath=function(e,t){var r,n,o,i,a,s,d,l,u,c,p,h,f,m;this.subPixelOptimize?(r=(a=function(e,t,r){var n,o,i;if(t)return n=t.x,o=t.y,i=t.width,t=t.height,e.x=n,e.y=o,e.width=i,e.height=t,(r=r&&r.lineWidth)&&(e.x=wa(n,r,!0),e.y=wa(o,r,!0),e.width=Math.max(wa(n+i,r,!1)-e.x,0===i?0:1),e.height=Math.max(wa(o+t,r,!1)-e.y,0===t?0:1)),e}(Ta,t,this.style)).x,n=a.y,o=a.width,i=a.height,a.r=t.r,t=a):(r=t.x,n=t.y,o=t.width,i=t.height),t.r?(a=e,p=(t=t).x,h=t.y,f=t.width,m=t.height,t=t.r,f<0&&(p+=f,f=-f),m<0&&(h+=m,m=-m),"number"==typeof t?s=d=l=u=t:t instanceof Array?1===t.length?s=d=l=u=t[0]:2===t.length?(s=l=t[0],d=u=t[1]):3===t.length?(s=t[0],d=u=t[1],l=t[2]):(s=t[0],d=t[1],l=t[2],u=t[3]):s=d=l=u=0,f<s+d&&(s*=f/(c=s+d),d*=f/c),f<l+u&&(l*=f/(c=l+u),u*=f/c),m<d+l&&(d*=m/(c=d+l),l*=m/c),m<s+u&&(s*=m/(c=s+u),u*=m/c),a.moveTo(p+s,h),a.lineTo(p+f-d,h),0!==d&&a.arc(p+f-d,h+d,d,-Math.PI/2,0),a.lineTo(p+f,h+m-l),0!==l&&a.arc(p+f-l,h+m-l,l,0,Math.PI/2),a.lineTo(p+u,h+m),0!==u&&a.arc(p+u,h+m-u,u,Math.PI/2,Math.PI),a.lineTo(p,h+s),0!==s&&a.arc(p+s,h+s,s,Math.PI,1.5*Math.PI)):e.rect(r,n,o,i)},Ra.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},Ra);function Ra(e){return Ea.call(this,e)||this}Ca.prototype.type="rect";var Pa,ka=function(){this.cx=0,this.cy=0,this.rx=0,this.ry=0},xa=(i(Ma,Pa=J),Ma.prototype.getDefaultShape=function(){return new ka},Ma.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=t.rx,t=t.ry,i=.5522848*o,a=.5522848*t;e.moveTo(r-o,n),e.bezierCurveTo(r-o,n-a,r-i,n-t,r,n-t),e.bezierCurveTo(r+i,n-t,r+o,n-a,r+o,n),e.bezierCurveTo(r+o,n+a,r+i,n+t,r,n+t),e.bezierCurveTo(r-i,n+t,r-o,n+a,r-o,n),e.closePath()},Ma);function Ma(e){return Pa.call(this,e)||this}xa.prototype.type="ellipse";var Aa,Oa={},Ua=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1},Da=(i(Ha,Aa=J),Ha.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Ha.prototype.getDefaultShape=function(){return new Ua},Ha.prototype.buildPath=function(e,t){i=(this.subPixelOptimize?(r=(i=function(e,t,r){var n,o,i;if(t)return n=t.x1,o=t.x2,i=t.y1,t=t.y2,e.x1=n,e.x2=o,e.y1=i,e.y2=t,(r=r&&r.lineWidth)&&(Sa(2*n)===Sa(2*o)&&(e.x1=e.x2=wa(n,r,!0)),Sa(2*i)===Sa(2*t))&&(e.y1=e.y2=wa(i,r,!0)),e}(Oa,t,this.style)).x1,n=i.y1,o=i.x2,i):(r=t.x1,n=t.y1,o=t.x2,t)).y2;var r,n,o,i,t=t.percent;0!==t&&(e.moveTo(r,n),t<1&&(o=r*(1-t)+o*t,i=n*(1-t)+i*t),e.lineTo(o,i))},Ha.prototype.pointAt=function(e){var t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]},Ha);function Ha(e){return Aa.call(this,e)||this}function La(e,t,r){var n=t.smooth,o=t.points;if(o&&2<=o.length){if(n)for(var i=function(e,t,r,n){var o,i,a=[],s=[],d=[],l=[];if(n){for(var u=[1/0,1/0],c=[-1/0,-1/0],p=0,h=e.length;p<h;p++)et(u,u,e[p]),tt(c,c,e[p]);et(u,u,n[0]),tt(c,c,n[1])}for(p=0,h=e.length;p<h;p++){var f=e[p];if(r)o=e[p?p-1:h-1],i=e[(p+1)%h];else{if(0===p||p===h-1){a.push(Ve(e[p]));continue}o=e[p-1],i=e[p+1]}qe(s,i,o),ze(s,s,t);var m=Ke(f,o),g=Ke(f,i),y=m+g,y=(0!==y&&(m/=y,g/=y),ze(d,s,-m),ze(l,s,g),Fe([],f,d)),m=Fe([],f,l);n&&(tt(y,y,u),et(y,y,c),tt(m,m,u),et(m,m,c)),a.push(y),a.push(m)}return r&&a.push(a.shift()),a}(o,n,r,t.smoothConstraint),a=(e.moveTo(o[0][0],o[0][1]),o.length),s=0;s<(r?a:a-1);s++){var d=i[2*s],l=i[2*s+1],u=o[(s+1)%a];e.bezierCurveTo(d[0],d[1],l[0],l[1],u[0],u[1])}else{e.moveTo(o[0][0],o[0][1]);for(var s=1,c=o.length;s<c;s++)e.lineTo(o[s][0],o[s][1])}r&&e.closePath()}}Da.prototype.type="line";var Na,Ba=function(){this.points=null,this.smooth=0,this.smoothConstraint=null},ja=(i(Va,Na=J),Va.prototype.getDefaultShape=function(){return new Ba},Va.prototype.buildPath=function(e,t){La(e,t,!0)},Va);function Va(e){return Na.call(this,e)||this}ja.prototype.type="polygon";var Fa,qa=function(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null},Ga=(i(Wa,Fa=J),Wa.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Wa.prototype.getDefaultShape=function(){return new qa},Wa.prototype.buildPath=function(e,t){La(e,t,!1)},Wa);function Wa(e){return Fa.call(this,e)||this}Ga.prototype.type="polyline";Ya.prototype.addColorStop=function(e,t){this.colorStops.push({offset:e,color:t})};var za=Ya;function Ya(e){this.colorStops=e||[]}i(Ja,Ka=za);var Ka,Xa=Ja;function Ja(e,t,r,n,o,i){o=Ka.call(this,o)||this;return o.x=null==e?0:e,o.y=null==t?0:t,o.x2=null==r?1:r,o.y2=null==n?0:n,o.type="linear",o.global=i||!1,o}i($a,Qa=za);var Qa,Za=$a;function $a(e,t,r,n,o){n=Qa.call(this,n)||this;return n.x=null==e?.5:e,n.y=null==t?.5:t,n.r=null==r?.5:r,n.type="radial",n.global=o||!1,n}var es,ts,rs=ae({strokeFirst:!0,font:Q,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},Bi),ns=(i(os,es=p),os.prototype.hasStroke=function(){var e=this.style,t=e.stroke;return null!=t&&"none"!==t&&0<e.lineWidth},os.prototype.hasFill=function(){var e=this.style.fill;return null!=e&&"none"!==e},os.prototype.createStyle=function(e){return Ue(rs,e)},os.prototype.setBoundingRect=function(e){this._rect=e},os.prototype.getBoundingRect=function(){var e,t=this.style;return this._rect||(null!=(e=t.text)?e+="":e="",(e=function(e,t,r,n){var o=((e||"")+"").split("\n");if(1===o.length)return vo(o[0],t,r,n);for(var i=new Y(0,0,0,0),a=0;a<o.length;a++){var s=vo(o[a],t,r,n);0===a?i.copy(s):i.union(s)}return i}(e,t.font,t.textAlign,t.textBaseline)).x+=t.x||0,e.y+=t.y||0,this.hasStroke()&&(t=t.lineWidth,e.x-=t/2,e.y-=t/2,e.width+=t,e.height+=t),this._rect=e),this._rect},os.initDefaultProps=void(os.prototype.dirtyRectTolerance=10),os);function os(){return null!==es&&es.apply(this,arguments)||this}ns.prototype.type="tspan";var is={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},as=U(is),ss={"alignment-baseline":"textBaseline","stop-color":"stopColor"},ds=U(ss),ls=(us.prototype.parse=function(e,t){t=t||{};e=function(e){var t=e=ge(e)?(new DOMParser).parseFromString(e,"text/xml"):e;for(9===t.nodeType&&(t=t.firstChild);"svg"!==t.nodeName.toLowerCase()||1!==t.nodeType;)t=t.nextSibling;return t}(e);if(!e)throw new Error("Illegal svg");this._defsUsePending=[];for(var r,n,o,i=new Lo,a=(this._root=i,[]),s=e.getAttribute("viewBox")||"",d=parseFloat(e.getAttribute("width")||t.width),l=parseFloat(e.getAttribute("height")||t.height),u=(isNaN(d)&&(d=null),isNaN(l)&&(l=null),gs(e,i,null,!0,!1),e.firstChild);u;)this._parseNode(u,i,a,null,!1,!1),u=u.nextSibling;for(var c=this._defs,p=this._defsUsePending,h=0;h<p.length;h++){var f=p[h];f[0].style[f[1]]=c[f[2]]}return this._defsUsePending=[],(r=s&&4<=(e=_s(s)).length?{x:parseFloat(e[0]||0),y:parseFloat(e[1]||0),width:parseFloat(e[2]),height:parseFloat(e[3])}:r)&&null!=d&&null!=l&&(s=r,n=(e={x:0,y:0,width:d,height:l}).width/s.width,o=e.height/s.height,o={scale:n=Math.min(n,o),x:-(s.x+s.width/2)*n+(e.x+e.width/2),y:-(s.y+s.height/2)*n+(e.y+e.height/2)},t.ignoreViewBox||(s=i,(i=new Lo).add(s),s.scaleX=s.scaleY=o.scale,s.x=o.x,s.y=o.y)),t.ignoreRootClip||null==d||null==l||i.setClipPath(new Ca({shape:{x:0,y:0,width:d,height:l}})),{root:i,width:d,height:l,viewBoxRect:r,viewBoxTransform:o,named:a}},us.prototype._parseNode=function(e,t,r,n,o,i){var a,s,d=e.nodeName.toLowerCase(),l=n;if("defs"===d&&(o=!0),"text"===d&&(i=!0),"defs"===d||"switch"===d?a=t:(o||(s=ts[d])&&He(ts,d)&&(a=s.call(this,e,t),(s=e.getAttribute("name"))?(r.push(s={name:s,namedFrom:null,svgNodeTagLower:d,el:a}),"g"===d&&(l=s)):n&&r.push({name:n.name,namedFrom:n,svgNodeTagLower:d,el:a}),t.add(a)),(s=cs[d])&&He(cs,d)&&(n=s.call(this,e),t=e.getAttribute("id"))&&(this._defs[t]=n)),a&&a.isGroup)for(var u=e.firstChild;u;)1===u.nodeType?this._parseNode(u,a,r,l,o,i):3===u.nodeType&&i&&this._parseText(u,a),u=u.nextSibling},us.prototype._parseText=function(e,t){var r=new ns({style:{text:e.textContent},silent:!0,x:this._textX||0,y:this._textY||0}),e=(fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r),n=t,o=n.__selfStyle,o=(o&&(o=o.textBaseline,!(i=o)||"auto"===o||"baseline"===o?i="alphabetic":"before-edge"===o||"text-before-edge"===o?i="top":"after-edge"===o||"text-after-edge"===o?i="bottom":"central"!==o&&"mathematical"!==o||(i="middle"),e.style.textBaseline=i),(o=n.__inheritedStyle)&&(i=o.textAlign,n=i)&&("middle"===i&&(n="center"),e.style.textAlign=n),r.style),i=o.fontSize,e=(i&&i<9&&(o.fontSize=9,r.scaleX*=i/9,r.scaleY*=i/9),(o.fontSize||o.fontFamily)&&[o.fontStyle,o.fontWeight,(o.fontSize||12)+"px",o.fontFamily||"sans-serif"].join(" ")),n=(o.font=e,r.getBoundingRect());return this._textX+=n.width,t.add(r),r},us.internalField=void(ts={g:function(e,t){var r=new Lo;return fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r},rect:function(e,t){var r=new Ca;return fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r.setShape({x:parseFloat(e.getAttribute("x")||"0"),y:parseFloat(e.getAttribute("y")||"0"),width:parseFloat(e.getAttribute("width")||"0"),height:parseFloat(e.getAttribute("height")||"0")}),r.silent=!0,r},circle:function(e,t){var r=new ba;return fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),r:parseFloat(e.getAttribute("r")||"0")}),r.silent=!0,r},line:function(e,t){var r=new Da;return fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r.setShape({x1:parseFloat(e.getAttribute("x1")||"0"),y1:parseFloat(e.getAttribute("y1")||"0"),x2:parseFloat(e.getAttribute("x2")||"0"),y2:parseFloat(e.getAttribute("y2")||"0")}),r.silent=!0,r},ellipse:function(e,t){var r=new xa;return fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),rx:parseFloat(e.getAttribute("rx")||"0"),ry:parseFloat(e.getAttribute("ry")||"0")}),r.silent=!0,r},polygon:function(e,t){var r,n=e.getAttribute("points"),n=(n&&(r=ms(n)),new ja({shape:{points:r||[]},silent:!0}));return fs(t,n),gs(e,n,this._defsUsePending,!1,!1),n},polyline:function(e,t){var r,n=e.getAttribute("points"),n=(n&&(r=ms(n)),new Ga({shape:{points:r||[]},silent:!0}));return fs(t,n),gs(e,n,this._defsUsePending,!1,!1),n},image:function(e,t){var r=new ma;return fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r.setStyle({image:e.getAttribute("xlink:href")||e.getAttribute("href"),x:+e.getAttribute("x"),y:+e.getAttribute("y"),width:+e.getAttribute("width"),height:+e.getAttribute("height")}),r.silent=!0,r},text:function(e,t){var r=e.getAttribute("x")||"0",n=e.getAttribute("y")||"0",o=e.getAttribute("dx")||"0",i=e.getAttribute("dy")||"0",r=(this._textX=parseFloat(r)+parseFloat(o),this._textY=parseFloat(n)+parseFloat(i),new Lo);return fs(t,r),gs(e,r,this._defsUsePending,!1,!0),r},tspan:function(e,t){var r=e.getAttribute("x"),n=e.getAttribute("y"),r=(null!=r&&(this._textX=parseFloat(r)),null!=n&&(this._textY=parseFloat(n)),e.getAttribute("dx")||"0"),n=e.getAttribute("dy")||"0",o=new Lo;return fs(t,o),gs(e,o,this._defsUsePending,!1,!0),this._textX+=parseFloat(r),this._textY+=parseFloat(n),o},path:function(e,t){var r=la(e.getAttribute("d")||"");return fs(t,r),gs(e,r,this._defsUsePending,!1,!1),r.silent=!0,r}}),us);function us(){this._defs={},this._root=null}var cs={lineargradient:function(e){var t=parseInt(e.getAttribute("x1")||"0",10),r=parseInt(e.getAttribute("y1")||"0",10),n=parseInt(e.getAttribute("x2")||"10",10),o=parseInt(e.getAttribute("y2")||"0",10),t=new Xa(t,r,n,o);return ps(e,t),hs(e,t),t},radialgradient:function(e){var t=parseInt(e.getAttribute("cx")||"0",10),r=parseInt(e.getAttribute("cy")||"0",10),n=parseInt(e.getAttribute("r")||"0",10),t=new Za(t,r,n);return ps(e,t),hs(e,t),t}};function ps(e,t){"userSpaceOnUse"===e.getAttribute("gradientUnits")&&(t.global=!0)}function hs(e,t){for(var r,n,o=e.firstChild;o;)1===o.nodeType&&"stop"===o.nodeName.toLocaleLowerCase()&&(r=void 0,r=(n=o.getAttribute("offset"))&&0<n.indexOf("%")?parseInt(n,10)/100:n?parseFloat(n):0,Is(o,n={},n),n=n.stopColor||o.getAttribute("stop-color")||"#000000",t.colorStops.push({offset:r,color:n})),o=o.nextSibling}function fs(e,t){e&&e.__inheritedStyle&&(t.__inheritedStyle||(t.__inheritedStyle={}),ae(t.__inheritedStyle,e.__inheritedStyle))}function ms(e){for(var t=_s(e),r=[],n=0;n<t.length;n+=2){var o=parseFloat(t[n]),i=parseFloat(t[n+1]);r.push([o,i])}return r}function gs(e,t,r,n,o){var i=t,a=i.__inheritedStyle=i.__inheritedStyle||{},s={};if(1===e.nodeType){var d=e;if(d=d.getAttribute("transform")){d=d.replace(/,/g," ");var l=[],u=null;d.replace(Ss,function(e,t,r){return l.push(t,r),""});for(var c=l.length-1;0<c;c-=2){var p=l[c-1],h=_s(l[c]);switch(u=u||Gn(),p){case"translate":Kn(u,u,[parseFloat(h[0]),parseFloat(h[1]||"0")]);break;case"scale":Jn(u,u,[parseFloat(h[0]),parseFloat(h[1]||h[0])]);break;case"rotate":Xn(u,u,-parseFloat(h[0])*ws);break;case"skewX":var f=Math.tan(parseFloat(h[0])*ws);Yn(u,[1,0,f,1,0,0],u);break;case"skewY":f=Math.tan(parseFloat(h[0])*ws);Yn(u,[1,f,0,1,0,0],u);break;case"matrix":u[0]=parseFloat(h[0]),u[1]=parseFloat(h[1]),u[2]=parseFloat(h[2]),u[3]=parseFloat(h[3]),u[4]=parseFloat(h[4]),u[5]=parseFloat(h[5])}}t.setLocalTransform(u)}if(Is(e,a,s),!n){for(var m=e,g=a,y=s,v=0;v<as.length;v++){var b=as[v];null!=(_=m.getAttribute(b))&&(g[is[b]]=_)}for(v=0;v<ds.length;v++){var _,b=ds[v];null!=(_=m.getAttribute(b))&&(y[ss[b]]=_)}}}i.style=i.style||{},null!=a.fill&&(i.style.fill=vs(i,"fill",a.fill,r)),null!=a.stroke&&(i.style.stroke=vs(i,"stroke",a.stroke,r)),w(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(e){null!=a[e]&&(i.style[e]=parseFloat(a[e]))}),w(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(e){null!=a[e]&&(i.style[e]=a[e])}),o&&(i.__selfStyle=s),a.lineDash&&(i.style.lineDash=L(_s(a.lineDash),function(e){return parseFloat(e)})),"hidden"!==a.visibility&&"collapse"!==a.visibility||(i.invisible=!0),"none"===a.display&&(i.ignore=!0)}var ys=/^url\(\s*#(.*?)\)/;function vs(e,t,r,n){var o=r&&r.match(ys);if(!o)return r="none"===r?null:r;r=ke(o[1]),n.push([e,t,r])}var bs=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function _s(e){return e.match(bs)||[]}var Ss=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,ws=Math.PI/180;var Es=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Is(e,t,r){var n,o=e.getAttribute("style");if(o)for(Es.lastIndex=0;null!=(n=Es.exec(o));){var i=n[1],a=He(is,i)?is[i]:null,a=(a&&(t[a]=n[2]),He(ss,i)?ss[i]:null);a&&(r[a]=n[2])}}var Ts=Math.PI,Cs=2*Ts,Rs=Math.sin,Ps=Math.cos,ks=Math.acos,D=Math.atan2,xs=Math.abs,Ms=Math.sqrt,As=Math.max,Os=Math.min,Us=1e-4;function Ds(e,t,r,n,o,i,a){var s=e-r,d=t-n,a=(a?i:-i)/Ms(s*s+d*d),d=a*d,a=-a*s,s=e+d,e=t+a,t=r+d,r=n+a,n=(s+t)/2,l=(e+r)/2,u=t-s,c=r-e,p=u*u+c*c,i=o-i,s=s*r-t*e,r=(c<0?-1:1)*Ms(As(0,i*i*p-s*s)),t=(s*c-u*r)/p,e=(-s*u-c*r)/p,h=(s*c+u*r)/p,s=(-s*u+c*r)/p,u=t-n,c=e-l,r=h-n,p=s-l;return r*r+p*p<u*u+c*c&&(t=h,e=s),{cx:t,cy:e,x0:-d,y0:-a,x1:t*(o/i-1),y1:e*(o/i-1)}}function Hs(e,t){var r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,y,v,b,_,S,w,E,I,T,C,R,P,k,x,M,A=As(t.r,0),O=As(t.r0||0,0),U=0<A;(U||0<O)&&(U||(A=O,O=0),A<O&&(U=A,A=O,O=U),U=t.startAngle,r=t.endAngle,isNaN(U)||isNaN(r)||(n=t.cx,o=t.cy,i=!!t.clockwise,y=xs(r-U),Us<(a=Cs<y&&y%Cs)&&(y=a),Us<A?Cs-Us<y?(e.moveTo(n+A*Ps(U),o+A*Rs(U)),e.arc(n,o,A,U,r,!i),Us<O&&(e.moveTo(n+O*Ps(r),o+O*Rs(r)),e.arc(n,o,O,r,U,i))):(E=w=S=_=b=v=c=u=R=C=T=I=l=d=s=a=void 0,p=A*Ps(U),h=A*Rs(U),f=O*Ps(r),m=O*Rs(r),(g=Us<y)&&((t=t.cornerRadius)&&(a=(t=function(e){if(fe(e)){var t=e.length;if(!t)return e;t=1===t?[e[0],e[0],0,0]:2===t?[e[0],e[0],e[1],e[1]]:3===t?e.concat(e[2]):e}else t=[e,e,e,e];return t}(t))[0],s=t[1],d=t[2],l=t[3]),t=xs(A-O)/2,I=Os(t,d),T=Os(t,l),C=Os(t,a),R=Os(t,s),v=u=As(I,T),b=c=As(C,R),Us<u||Us<c)&&(_=A*Ps(r),S=A*Rs(r),w=O*Ps(U),E=O*Rs(U),y<Ts)&&(t=function(e,t,r,n,o,i,a,s){var d=(s=s-i)*(r=r-e)-(a=a-o)*(n=n-t);if(!(d*d<Us))return[e+(d=(a*(t-i)-s*(e-o))/d)*r,t+d*n]}(p,h,w,E,_,S,f,m))&&(I=p-t[0],T=h-t[1],C=_-t[0],R=S-t[1],y=1/Rs(ks((I*C+T*R)/(Ms(I*I+T*T)*Ms(C*C+R*R)))/2),I=Ms(t[0]*t[0]+t[1]*t[1]),v=Os(u,(A-I)/(1+y)),b=Os(c,(O-I)/(y-1))),g?Us<v?(P=Os(d,v),k=Os(l,v),x=Ds(w,E,p,h,A,P,i),M=Ds(_,S,f,m,A,k,i),e.moveTo(n+x.cx+x.x0,o+x.cy+x.y0),v<u&&P===k?e.arc(n+x.cx,o+x.cy,v,D(x.y0,x.x0),D(M.y0,M.x0),!i):(0<P&&e.arc(n+x.cx,o+x.cy,P,D(x.y0,x.x0),D(x.y1,x.x1),!i),e.arc(n,o,A,D(x.cy+x.y1,x.cx+x.x1),D(M.cy+M.y1,M.cx+M.x1),!i),0<k&&e.arc(n+M.cx,o+M.cy,k,D(M.y1,M.x1),D(M.y0,M.x0),!i))):(e.moveTo(n+p,o+h),e.arc(n,o,A,U,r,!i)):e.moveTo(n+p,o+h),Us<O&&g?Us<b?(P=Os(a,b),x=Ds(f,m,_,S,O,-(k=Os(s,b)),i),M=Ds(p,h,w,E,O,-P,i),e.lineTo(n+x.cx+x.x0,o+x.cy+x.y0),b<c&&P===k?e.arc(n+x.cx,o+x.cy,b,D(x.y0,x.x0),D(M.y0,M.x0),!i):(0<k&&e.arc(n+x.cx,o+x.cy,k,D(x.y0,x.x0),D(x.y1,x.x1),!i),e.arc(n,o,O,D(x.cy+x.y1,x.cx+x.x1),D(M.cy+M.y1,M.cx+M.x1),i),0<P&&e.arc(n+M.cx,o+M.cy,P,D(M.y1,M.x1),D(M.y0,M.x0),!i))):(e.lineTo(n+f,o+m),e.arc(n,o,O,r,U,i)):e.lineTo(n+f,o+m)):e.moveTo(n,o),e.closePath()))}var Ls,Ns=function(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.cornerRadius=0},Bs=(i(js,Ls=J),js.prototype.getDefaultShape=function(){return new Ns},js.prototype.buildPath=function(e,t){Hs(e,t)},js.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},js);function js(e){return Ls.call(this,e)||this}Bs.prototype.type="sector";var Vs=Ei.CMD;function Fs(e,t){return Math.abs(e-t)<1e-5}function qs(H){var o,e,t=H.data,L=H.len(),r=[],n=0,i=0,a=0,s=0;function d(e,t){o&&2<o.length&&r.push(o),o=[e,t]}function l(e,t,r,n){Fs(e,r)&&Fs(t,n)||o.push(e,t,r,n,r,n)}for(var u,c,p,h,f,m,g,y,v,b,_,S,w=0;w<L;){var E=t[w++],N=1===w;switch(N&&(a=n=t[w],s=i=t[w+1],E!==Vs.L&&E!==Vs.C&&E!==Vs.Q||(o=[a,s])),E){case Vs.M:n=a=t[w++],i=s=t[w++],d(a,s);break;case Vs.L:l(n,i,M=t[w++],A=t[w++]),n=M,i=A;break;case Vs.C:o.push(t[w++],t[w++],t[w++],t[w++],n=t[w++],i=t[w++]);break;case Vs.Q:M=t[w++],A=t[w++],P=t[w++],e=t[w++],o.push(n+2/3*(M-n),i+2/3*(A-i),P+2/3*(M-P),e+2/3*(A-e),P,e),n=P,i=e;break;case Vs.A:var I=t[w++],T=t[w++],C=t[w++],R=t[w++],P=t[w++],k=t[w++]+P,x=(w+=1,!t[w++]),M=Math.cos(P)*C+I,A=Math.sin(P)*R+T;N?d(a=M,s=A):l(n,i,M,A);for(var n=Math.cos(k)*C+I,i=Math.sin(k)*R+T,O=(x?-1:1)*Math.PI/2,U=P;x?k<U:U<k;U+=O){var D=x?Math.max(U+O,k):Math.min(U+O,k);u=U,D=D,c=I,p=T,h=C,f=R,m=S=_=b=v=y=g=m=void 0,m=Math.abs(D-u),m=4*Math.tan(m/4)/3,g=D<u?-1:1,y=Math.cos(u),u=Math.sin(u),v=Math.cos(D),D=Math.sin(D),b=v*h+c,_=D*f+p,S=h*m*g,m=f*m*g,o.push(y*h+c-S*u,u*f+p+m*y,b+S*D,_-m*v,b,_)}break;case Vs.R:a=n=t[w++],s=i=t[w++],M=a+t[w++],A=s+t[w++],d(M,s),l(M,s,M,A),l(M,A,a,A),l(a,A,a,s),l(a,s,M,s);break;case Vs.Z:o&&l(n,i,a,s),n=a,i=s}}return o&&2<o.length&&r.push(o),r}function Gs(e,t){var r=qs(e),n=[];t=t||1;for(var o=0;o<r.length;o++){var i=r[o],a=[],s=i[0],d=i[1];a.push(s,d);for(var l=2;l<i.length;){var u=i[l++],c=i[l++],p=i[l++],h=i[l++],f=i[l++],m=i[l++];!function e(t,r,n,o,i,a,s,d,l,u){var c,p,h,f,m,g,y,v,b;Fs(t,n)&&Fs(r,o)&&Fs(i,s)&&Fs(a,d)||(c=(c=2/u)*c,v=s-t,p=d-r,v/=y=Math.sqrt(v*v+p*p),p/=y,m=(y=i-s)*y+(g=a-d)*g,(b=(h=n-t)*h+(f=o-r)*f)<c&&m<c)||(y=-v*y-p*g,b-(g=v*h+p*f)*g<c&&0<=g&&m-y*y<c&&0<=y)?l.push(s,d):(b=[],pr(t,n,i,s,.5,v=[]),pr(r,o,a,d,.5,b),e(v[0],b[0],v[1],b[1],v[2],b[2],v[3],b[3],l,u),e(v[4],b[4],v[5],b[5],v[6],b[6],v[7],b[7],l,u))}(s,d,u,c,p,h,f,m,a,t),s=f,d=m}n.push(a)}return n}function Ws(e,t,r){for(var n=e[t],e=e[1-t],t=Math.abs(n/e),o=Math.ceil(Math.sqrt(t*r)),i=Math.floor(r/o),a=(0===i&&(i=1,o=r),[]),s=0;s<o;s++)a.push(i);var d=r-o*i;if(0<d)for(s=0;s<d;s++)a[s%o]+=1;return a}function zs(e,t,r){for(var n=e.r0,o=e.r,i=e.startAngle,a=e.endAngle,s=Math.abs(a-i),a=s*o,d=o-n,l=a>Math.abs(d),u=Ws([a,d],l?0:1,t),c=(l?s:d)/u.length,p=0;p<u.length;p++)for(var h=(l?d:s)/u[p],f=0;f<u[p];f++){var m={};l?(m.startAngle=i+c*p,m.endAngle=i+c*(p+1),m.r0=n+h*f,m.r=n+h*(f+1)):(m.startAngle=i+h*f,m.endAngle=i+h*(f+1),m.r0=n+c*p,m.r=n+c*(p+1)),m.clockwise=e.clockwise,m.cx=e.cx,m.cy=e.cy,r.push(m)}}function Ys(e,t){var r=e[e.length-1];r&&r[0]===t[0]&&r[1]===t[1]||e.push(t)}function Ks(e,t,r){for(var n,o,i,a,s,d,l=e.length,u=[],c=0;c<l;c++){var p=e[c],h=e[(c+1)%l],f=(n=p[0],p=p[1],o=h[0],h=h[1],i=t.x,a=t.y,s=r.x,f=r.y,d=void 0,d=(s=s-i)*(h=h-p)-(o=o-n)*(f=f-a),Math.abs(d)<1e-6||(i=((n-i)*f-s*(p-a))/d)<0||1<i?null:new S(i*o+n,i*h+p));f&&u.push({projPt:(s=f,a=t,d=r,o=void 0,o=new S,S.sub(o,d,a),o.normalize(),d=new S,S.sub(d,s,a),d.dot(o)),pt:f,idx:c})}if(u.length<2)return[{points:e},{points:e}];u.sort(function(e,t){return e.projPt-t.projPt});for(var m=u[0],g=u[u.length-1],y=(g.idx<m.idx&&(y=m,m=g,g=y),[m.pt.x,m.pt.y]),v=[g.pt.x,g.pt.y],b=[y],_=[v],c=m.idx+1;c<=g.idx;c++)Ys(b,e[c].slice());Ys(b,v),Ys(b,y);for(c=g.idx+1;c<=m.idx+l;c++)Ys(_,e[c%l].slice());return Ys(_,y),Ys(_,v),[{points:b},{points:_}]}function Xs(e){var e=e.points,t=[],r=[],r=(ni(e,t,r),new Y(t[0],t[1],r[0]-t[0],r[1]-t[1])),t=r.width,n=r.height,o=r.x,r=r.y,i=new S,a=new S;return n<t?(i.x=a.x=o+t/2,i.y=r,a.y=r+n):(i.y=a.y=r+n/2,i.x=o,a.x=o+t),Ks(e,i,a)}function Js(e,t,r,n){var o;1===r?n.push(t):(o=Math.floor(r/2),t=e(t),Js(e,t[0],o,n),Js(e,t[1],r-o,n))}function Qs(e,t){var r,n=[],o=e.shape;switch(e.type){case"rect":for(var i=o,a=t,s=n,d=i.width,l=i.height,u=l<d,c=Ws([d,l],u?0:1,a),p=u?"width":"height",h=u?"height":"width",f=u?"x":"y",m=u?"y":"x",g=i[p]/c.length,y=0;y<c.length;y++)for(var v=i[h]/c[y],b=0;b<c[y];b++){var _={};_[f]=y*g,_[m]=b*v,_[p]=g,_[h]=v,_.x+=i.x,_.y+=i.y,s.push(_)}r=Ca;break;case"sector":zs(o,t,n),r=Bs;break;case"circle":zs({r0:0,r:o.r,startAngle:0,endAngle:2*Math.PI,cx:o.cx,cy:o.cy},t,n),r=Bs;break;default:var d=e.getComputedTransform(),l=d?Math.sqrt(Math.max(d[0]*d[0]+d[1]*d[1],d[2]*d[2]+d[3]*d[3])):1,S=L(Gs(e.getUpdatedPathProxy(),l),function(e){for(var t=e,r=[],n=0;n<t.length;)r.push([t[n++],t[n++]]);return r}),w=S.length;if(0===w)Js(Xs,{points:S[0]},t,n);else if(w===t)for(var E=0;E<w;E++)n.push({points:S[E]});else for(var I=0,T=L(S,function(e){var t=[],r=[],r=(ni(e,t,r),(r[1]-t[1])*(r[0]-t[0]));return I+=r,{poly:e,area:r}}),C=(T.sort(function(e,t){return t.area-e.area}),t),E=0;E<w;E++){var R=T[E];if(C<=0)break;var P=E===w-1?C:Math.ceil(R.area/I*t);P<0||(Js(Xs,{points:R.poly},P,n),C-=P)}r=ja}if(!r){for(var k=e,H=t,x=[],M=0;M<H;M++)x.push(ua(k));return x}for(var A,O,U=[],E=0;E<n.length;E++){var D=new r;D.setShape(n[E]),A=e,(O=D).setStyle(A.style),O.z=A.z,O.z2=A.z2,O.zlevel=A.zlevel,U.push(D)}return U}function Zs(e,t){for(var r=e.length,n=e[r-2],o=e[r-1],i=[],a=0;a<t.length;)i[a++]=n,i[a++]=o;return i}function $s(e,t){for(var r,n,o=[],i=[],a=0;a<Math.max(e.length,t.length);a++){var s=e[a],d=t[a],l=void 0,u=void 0;s?d?(r=l=(n=function(e,t){var r=e.length,n=t.length;if(r===n)return[e,t];for(var o=[],i=[],a=r<n?e:t,s=Math.min(r,n),n=Math.abs(n-r)/6,d=Math.ceil(n/((s-2)/6))+1,l=[a[0],a[1]],u=n,c=2;c<s;){var p=a[c-2],h=a[c-1],f=a[c++],m=a[c++],g=a[c++],y=a[c++],v=a[c++],b=a[c++];if(u<=0)l.push(f,m,g,y,v,b);else{for(var _=Math.min(u,d-1)+1,S=1;S<=_;S++){var w=S/_;pr(p,f,g,v,w,o),pr(h,m,y,b,w,i),l.push(o[1],i[1],o[2],i[2],p=o[3],h=i[3]),f=o[5],m=i[5],g=o[6],y=i[6]}u-=_-1}}return a===e?[l,t]:[e,l]}(s,d))[0],n=u=n[1]):(u=Zs(n||s,s),l=s):(l=Zs(r||d,d),u=d),o.push(l),i.push(u)}return[o,i]}function ed(e){for(var t=0,r=0,n=0,o=e.length,i=0,a=o-2;i<o;a=i,i+=2){var s=e[a],d=e[a+1],l=e[i],u=e[i+1],c=s*u-l*d;t+=c,r+=(s+l)*c,n+=(d+u)*c}return 0===t?[e[0]||0,e[1]||0]:[r/t/3,n/t/3,t]}function td(e,t,r,n){for(var o,i=[],a=0;a<e.length;a++){for(var s=e[a],d=t[a],l=ed(s),u=ed(d),c=(null==o&&(o=l[2]<0!=u[2]<0),[]),p=[],h=0,f=1/0,m=[],g=s.length,y=6*function(e,t,r,n){for(var o=(e.length-2)/6,i=1/0,a=0,s=e.length,d=s-2,l=0;l<o;l++){for(var u=6*l,c=0,p=0;p<s;p+=2){var h=0===p?u:(u+p-2)%d+2,f=e[h]-r[0],h=e[1+h]-r[1],f=t[p]-n[0]-f,h=t[p+1]-n[1]-h;c+=f*f+h*h}c<i&&(i=c,a=l)}return a}(s=o?function(e){for(var t=[],r=e.length,n=0;n<r;n+=2)t[n]=e[r-n-2],t[n+1]=e[r-n-1];return t}(s):s,d,l,u),v=g-2,b=0;b<v;b+=2){var _=(y+b)%v+2;c[b+2]=s[_]-l[0],c[b+3]=s[1+_]-l[1]}if(c[0]=s[y]-l[0],c[1]=s[1+y]-l[1],0<r)for(var S=n/r,w=-n/2;w<=n/2;w+=S){for(var E=Math.sin(w),I=Math.cos(w),T=0,b=0;b<s.length;b+=2){var C=c[b],R=c[b+1],P=d[b]-u[0],k=d[b+1]-u[1],x=P*I-k*E,P=P*E+k*I,k=(m[b]=x)-C,x=(m[b+1]=P)-R;T+=k*k+x*x}if(T<f)for(var f=T,h=w,M=0;M<m.length;M++)p[M]=m[M]}else for(var A=0;A<g;A+=2)p[A]=d[A]-u[0],p[A+1]=d[A+1]-u[1];i.push({from:c,to:p,fromCp:l,toCp:u,rotation:-h})}return i}function rd(e){return e.__isCombineMorphing}var nd="__mOriginal_";function od(e,t,r){var n=nd+t,o=e[n]||e[t],i=(e[n]||(e[n]=e[t]),r.replace),a=r.after,s=r.before;e[t]=function(){var e,t=arguments;return s&&s.apply(this,t),e=(i||o).apply(this,t),a&&a.apply(this,t),e}}function id(e,t){var r=nd+t;e[r]&&(e[t]=e[r],e[r]=null)}function ad(e,t){for(var r=0;r<e.length;r++)for(var n=e[r],o=0;o<n.length;){var i=n[o],a=n[o+1];n[o++]=t[0]*i+t[2]*a+t[4],n[o++]=t[1]*i+t[3]*a+t[5]}}function sd(e,E){var t=e.getUpdatedPathProxy(),r=E.getUpdatedPathProxy(),t=$s(qs(t),qs(r)),r=t[0],t=t[1],e=e.getComputedTransform(),n=E.getComputedTransform();e&&ad(r,e),n&&ad(t,n),od(E,"updateTransform",{replace:function(){this.transform=null}}),E.transform=null;var I=td(r,t,10,Math.PI),T=[];od(E,"buildPath",{replace:function(e){for(var t=E.__morphT,r=1-t,n=[],o=0;o<I.length;o++){var i=I[o],a=i.from,s=i.to,d=i.rotation*t,l=i.fromCp,i=i.toCp,u=Math.sin(d),c=Math.cos(d);Ze(n,l,i,t);for(var p=0;p<a.length;p+=2){var h=a[p],f=a[p+1],h=h*r+(y=s[p])*t,f=f*r+(v=s[p+1])*t;T[p]=h*c-f*u+n[0],T[p+1]=h*u+f*c+n[1]}var m=T[0],g=T[1];e.moveTo(m,g);for(p=2;p<a.length;){var y=T[p++],v=T[p++],b=T[p++],_=T[p++],S=T[p++],w=T[p++];m===y&&g===v&&b===S&&_===w?e.lineTo(S,w):e.bezierCurveTo(y,v,b,_,S,w),m=S,g=w}}}})}function dd(e,t,r){var n,o;return e&&t&&(n=r.done,o=r.during,sd(e,t),t.__morphT=0,t.animateTo({__morphT:1},ae({during:function(e){t.dirtyShape(),o&&o(e)},done:function(){id(t,"buildPath"),id(t,"updateTransform"),t.__morphT=-1,t.createPathProxy(),t.dirtyShape(),n&&n()}},r))),t}function ld(r){var n=1/0,o=1/0,i=-1/0,a=-1/0,e=L(r,function(e){var t=e.getBoundingRect(),e=e.getComputedTransform(),r=t.x+t.width/2+(e?e[4]:0),t=t.y+t.height/2+(e?e[5]:0);return n=Math.min(r,n),o=Math.min(t,o),i=Math.max(r,i),a=Math.max(t,a),[r,t]});return L(e,function(e,t){return{cp:e,z:function(e,t,r,n,o,i){e=o===r?0:Math.round(32767*(e-r)/(o-r)),t=i===n?0:Math.round(32767*(t-n)/(i-n));for(var a=0,s=32768;0<s;s/=2){var d=0,l=0;a+=s*s*(3*(d=0<(e&s)?1:d)^(l=0<(t&s)?1:l)),0===l&&(1===d&&(e=s-1-e,t=s-1-t),l=e,e=t,t=l)}return a}(e[0],e[1],n,o,i,a),path:r[t]}}).sort(function(e,t){return e.z-t.z}).map(function(e){return e.path})}function ud(e){return Qs(e.path,e.count)}function cd(){return{fromIndividuals:[],toIndividuals:[],count:0}}var pd,za=Object.freeze({__proto__:null,alignBezierCurves:$s,centroid:ed,isCombineMorphing:rd,isMorphing:function(e){return 0<=e.__morphT},morphPath:dd,combineMorph:function(t,n,e){var o=[],r=(!function e(t){for(var r=0;r<t.length;r++){var n=t[r];rd(n)?e(n.childrenRef()):n instanceof J&&o.push(n)}}(t),o.length);if(!r)return cd();var i=e.dividePath||ud;if((a=i({path:n,count:r})).length!==r)return console.error("Invalid morphing: unmatched splitted path"),cd();for(var o=ld(o),a=ld(a),s=e.done,d=e.during,l=e.individualDelay,u=new oo,c=0;c<r;c++){var p=o[c],h=a[c];h.parent=n,h.copyTransform(u),l||sd(p,h)}function f(e){for(var t=0;t<a.length;t++)a[t].addSelfToZr(e)}function m(){n.__isCombineMorphing=!1,n.__morphT=-1,n.childrenRef=null,id(n,"addSelfToZr"),id(n,"removeSelfFromZr")}n.__isCombineMorphing=!0,n.childrenRef=function(){return a},od(n,"addSelfToZr",{after:function(e){f(e)}}),od(n,"removeSelfFromZr",{after:function(e){for(var t=0;t<a.length;t++)a[t].removeSelfFromZr(e)}});var g=a.length;if(l)for(var y=g,v=function(){0===--y&&(m(),s)&&s()},c=0;c<g;c++){var b=l?ae({delay:(e.delay||0)+l(c,g,o[c],a[c]),done:v},e):e;dd(o[c],a[c],b)}else n.__morphT=0,n.animateTo({__morphT:1},ae({during:function(e){for(var t=0;t<g;t++){var r=a[t];r.__morphT=n.__morphT,r.dirtyShape()}d&&d(e)},done:function(){m();for(var e=0;e<t.length;e++)id(t[e],"updateTransform");s&&s()}},e));return n.__zr&&f(n.__zr),{fromIndividuals:o,toIndividuals:a,count:g}},separateMorph:function(e,t,r){var n=t.length,o=[],i=r.dividePath||ud;if(rd(e)){!function e(t){for(var r=0;r<t.length;r++){var n=t[r];rd(n)?e(n.childrenRef()):n instanceof J&&o.push(n)}}(e.childrenRef());var a=o.length;if(a<n)for(var s=0,d=a;d<n;d++)o.push(ua(o[s++%a]));o.length=n}else{for(var o=i({path:e,count:n}),l=e.getComputedTransform(),d=0;d<o.length;d++)o[d].setLocalTransform(l);if(o.length!==n)return console.error("Invalid morphing: unmatched splitted path"),cd()}o=ld(o),t=ld(t);for(var u=r.individualDelay,d=0;d<n;d++){var c=u?ae({delay:(r.delay||0)+u(d,n,o[d],t[d])},r):r;dd(o[d],t[d],c)}return{fromIndividuals:o,toIndividuals:t,count:t.length}},defaultDividePath:Qs}),hd=(i(fd,pd=J),fd.prototype._updatePathDirty=function(){for(var e=this.shape.paths,t=this.shapeChanged(),r=0;r<e.length;r++)t=t||e[r].shapeChanged();t&&this.dirtyShape()},fd.prototype.beforeBrush=function(){this._updatePathDirty();for(var e=this.shape.paths||[],t=this.getGlobalScale(),r=0;r<e.length;r++)e[r].path||e[r].createPathProxy(),e[r].path.setScale(t[0],t[1],e[r].segmentIgnoreThreshold)},fd.prototype.buildPath=function(e,t){for(var r=t.paths||[],n=0;n<r.length;n++)r[n].buildPath(e,r[n].shape,!0)},fd.prototype.afterBrush=function(){for(var e=this.shape.paths||[],t=0;t<e.length;t++)e[t].pathUpdated()},fd.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),J.prototype.getBoundingRect.call(this)},fd);function fd(){var e=null!==pd&&pd.apply(this,arguments)||this;return e.type="compound",e}var md,gd=[],yd=(i(g,md=p),g.prototype.traverse=function(e,t){e.call(t,this)},g.prototype.useStyle=function(){this.style={}},g.prototype.getCursor=function(){return this._cursor},g.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},g.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},g.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},g.prototype.addDisplayable=function(e,t){(t?this._temporaryDisplayables:this._displayables).push(e),this.markRedraw()},g.prototype.addDisplayables=function(e,t){t=t||!1;for(var r=0;r<e.length;r++)this.addDisplayable(e[r],t)},g.prototype.getDisplayables=function(){return this._displayables},g.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},g.prototype.eachPendingDisplayable=function(e){for(var t=this._cursor;t<this._displayables.length;t++)e&&e(this._displayables[t]);for(t=0;t<this._temporaryDisplayables.length;t++)e&&e(this._temporaryDisplayables[t])},g.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++)(t=this._displayables[e]).parent=this,t.update(),t.parent=null;for(var t,e=0;e<this._temporaryDisplayables.length;e++)(t=this._temporaryDisplayables[e]).parent=this,t.update(),t.parent=null},g.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new Y(1/0,1/0,-1/0,-1/0),t=0;t<this._displayables.length;t++){var r=this._displayables[t],n=r.getBoundingRect().clone();r.needLocalTransform()&&n.applyTransform(r.getLocalTransform(gd)),e.union(n)}this._rect=e}return this._rect},g.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t);if(this.getBoundingRect().contain(r[0],r[1]))for(var n=0;n<this._displayables.length;n++)if(this._displayables[n].contain(e,t))return!0;return!1},g);function g(){var e=null!==md&&md.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}var vd=new Er(50);function bd(e,t,r,n,o){return e?"string"==typeof e?(t&&t.__zrImageSrc===e||!r||(r={hostEl:r,cb:n,cbPayload:o},(n=vd.get(e))?Sd(t=n.image)||n.pending.push(r):((t=M.loadImage(e,_d,_d)).__zrImageSrc=e,vd.put(e,t.__cachedImgObj={image:t,pending:[r]}))),t):e:t}function _d(){var e=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var r=e.pending[t],n=r.cb;n&&n(this,r.cbPayload),r.hostEl.dirty()}e.pending.length=0}function Sd(e){return e&&e.width&&e.height}var wd=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function Ed(e,t,r,n){for(var o=O({},n=n||{}),i=(o.font=t,r=A(r,"..."),o.maxIterations=A(n.maxIterations,2),o.minChar=A(n.minChar,0)),a=(o.cnCharWidth=yo("国",t),o.ascCharWidth=yo("a",t)),s=(o.placeholder=A(n.placeholder,""),e=Math.max(0,e-1)),d=0;d<i&&a<=s;d++)s-=a;n=yo(r,t);return s<n&&(r="",n=0),s=e-n,o.ellipsis=r,o.ellipsisWidth=n,o.contentWidth=s,o.containerWidth=e,o}function Id(e,t){var r=t.containerWidth,n=t.font,o=t.contentWidth;if(!r)return"";var i=yo(e,n);if(!(i<=r)){for(var a=0;;a++){if(i<=o||a>=t.maxIterations){e+=t.ellipsis;break}var s=0===a?function(e,t,r,n){for(var o=0,i=0,a=e.length;i<a&&o<t;i++){var s=e.charCodeAt(i);o+=0<=s&&s<=127?r:n}return i}(e,o,t.ascCharWidth,t.cnCharWidth):0<i?Math.floor(e.length*o/i):0,i=yo(e=e.substr(0,s),n)}""===e&&(e=t.placeholder)}return e}var Td=function(){},Cd=function(e){this.tokens=[],e&&(this.tokens=e)},Rd=function(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]};function Pd(e,t){var r=new Rd;if(null!=e&&(e+=""),e){for(var n,o=t.width,i=t.height,a=t.overflow,s="break"!==a&&"breakAll"!==a||null==o?null:{width:o,accumWidth:0,breakAll:"breakAll"===a},d=wd.lastIndex=0;null!=(n=wd.exec(e));){var l=n.index;d<l&&kd(r,e.substring(d,l),t,s),kd(r,n[2],t,s,n[1]),d=wd.lastIndex}d<e.length&&kd(r,e.substring(d,e.length),t,s);var u,c=[],p=0,h=0,f=t.padding,m="truncate"===a,g="truncate"===t.lineOverflow;e:for(var y=0;y<r.lines.length;y++){for(var v=r.lines[y],b=0,_=0,S=0;S<v.tokens.length;S++){var w=(k=v.tokens[S]).styleName&&t.rich[k.styleName]||{},E=k.textPadding=w.padding,I=E?E[1]+E[3]:0,T=k.font=w.font||t.font,C=(k.contentHeight=So(T),A(w.height,k.contentHeight));if(k.innerHeight=C,E&&(C+=E[0]+E[2]),k.height=C,k.lineHeight=Te(w.lineHeight,t.lineHeight,C),k.align=w&&w.align||t.align,k.verticalAlign=w&&w.verticalAlign||"middle",g&&null!=i&&p+k.lineHeight>i){0<S?(v.tokens=v.tokens.slice(0,S),M(v,_,b),r.lines=r.lines.slice(0,y+1)):r.lines=r.lines.slice(0,y);break e}var R,E=w.width,P=null==E||"auto"===E;"string"==typeof E&&"%"===E.charAt(E.length-1)?(k.percentWidth=E,c.push(k),k.contentWidth=yo(k.text,T)):(P&&(E=(E=w.backgroundColor)&&E.image)&&(R=void 0,Sd(E="string"==typeof(u=E)?(R=vd.get(u))&&R.image:u))&&(k.width=Math.max(k.width,E.width*C/E.height)),null!=(R=m&&null!=o?o-_:null)&&R<k.width?!P||R<I?(k.text="",k.width=k.contentWidth=0):(k.text=function(e,t,r,n,o){if(!t)return"";var i=(e+"").split("\n");o=Ed(t,r,n,o);for(var a=0,s=i.length;a<s;a++)i[a]=Id(i[a],o);return i.join("\n")}(k.text,R-I,T,t.ellipsis,{minChar:t.truncateMinChar}),k.width=k.contentWidth=yo(k.text,T)):k.contentWidth=yo(k.text,T)),k.width+=I,_+=k.width,w&&(b=Math.max(b,k.lineHeight))}M(v,_,b)}r.outerWidth=r.width=A(o,h),r.outerHeight=r.height=A(i,p),r.contentHeight=p,r.contentWidth=h,f&&(r.outerWidth+=f[1]+f[3],r.outerHeight+=f[0]+f[2]);for(y=0;y<c.length;y++){var k,x=(k=c[y]).percentWidth;k.width=parseInt(x,10)/100*r.width}}return r;function M(e,t,r){e.width=t,e.lineHeight=r,p+=r,h=Math.max(h,t)}}function kd(e,t,r,n,o){var i,a,s=""===t,d=o&&r.rich[o]||{},l=e.lines,u=d.font||r.font,c=!1;n?(r=(e=d.padding)?e[1]+e[3]:0,null!=d.width&&"auto"!==d.width?(e=wo(d.width,n.width)+r,0<l.length&&e+n.accumWidth>n.width&&(i=t.split("\n"),c=!0),n.accumWidth=e):(e=Md(t,u,n.width,n.breakAll,n.accumWidth),n.accumWidth=e.accumWidth+r,a=e.linesWidths,i=e.lines)):i=t.split("\n");for(var p=0;p<i.length;p++){var h,f,m=i[p],g=new Td;g.styleName=o,g.text=m,g.isLineHolder=!m&&!s,"number"==typeof d.width?g.width=d.width:g.width=a?a[p]:yo(m,u),p||c?l.push(new Cd([g])):1===(f=(h=(l[l.length-1]||(l[0]=new Cd)).tokens).length)&&h[0].isLineHolder?h[0]=g:!m&&f&&!s||h.push(g)}}var xd=ce(",&?/;] ".split(""),function(e,t){return e[t]=!0,e},{});function Md(e,t,r,n,o){for(var i,a=[],s=[],d="",l="",u=0,c=0,p=0;p<e.length;p++){var h,f,m=e.charAt(p);"\n"===m?(l&&(d+=l,c+=u),a.push(d),s.push(c),l=d="",c=u=0):(h=yo(m,t),f=!n&&(f=void 0,!!(33<=(f=(f=i=m).charCodeAt(0))&&f<=383&&!xd[i])),(a.length?r<c+h:r<o+c+h)?c?(d||l)&&(c=f?(d||(d=l,l="",c=u=0),a.push(d),s.push(c-u),l+=m,d="",u+=h):(l&&(d+=l,l="",u=0),a.push(d),s.push(c),d=m,h)):f?(a.push(l),s.push(u),l=m,u=h):(a.push(m),s.push(h)):(c+=h,f?(l+=m,u+=h):(l&&(d+=l,l="",u=0),d+=m)))}return a.length||d||(d=e,l="",u=0),l&&(d+=l),d&&(a.push(d),s.push(c)),1===a.length&&(c+=o),{accumWidth:c,lines:a,linesWidths:s}}var Ad,Od={fill:"#000"},Ud={style:ae({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},Wo.style)},Dd=(i(y,Ad=p),y.prototype.childrenRef=function(){return this._children},y.prototype.update=function(){Ad.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var t=this._children[e];t.zlevel=this.zlevel,t.z=this.z,t.z2=this.z2,t.culling=this.culling,t.cursor=this.cursor,t.invisible=this.invisible}},y.prototype.updateTransform=function(){var e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):Ad.prototype.updateTransform.call(this)},y.prototype.getLocalTransform=function(e){var t=this.innerTransformable;return t?t.getLocalTransform(e):Ad.prototype.getLocalTransform.call(this,e)},y.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),Ad.prototype.getComputedTransform.call(this)},y.prototype._updateSubTexts=function(){var e;this._childCursor=0,Fd(e=this.style),w(e.rich,Fd),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},y.prototype.addSelfToZr=function(e){Ad.prototype.addSelfToZr.call(this,e);for(var t=0;t<this._children.length;t++)this._children[t].__zr=e},y.prototype.removeSelfFromZr=function(e){Ad.prototype.removeSelfFromZr.call(this,e);for(var t=0;t<this._children.length;t++)this._children[t].__zr=null},y.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var e=new Y(0,0,0,0),t=this._children,r=[],n=null,o=0;o<t.length;o++){var i=t[o],a=i.getBoundingRect(),i=i.getLocalTransform(r);i?(e.copy(a),e.applyTransform(i),(n=n||e.clone()).union(e)):(n=n||a.clone()).union(a)}this._rect=n||e}return this._rect},y.prototype.setDefaultTextStyle=function(e){this._defaultStyle=e||Od},y.prototype.setTextContent=function(e){throw new Error("Can't attach text on another text")},y.prototype._mergeStyle=function(e,t){var r,n;return t&&(r=t.rich,n=e.rich||r&&{},O(e,t),r&&n?(this._mergeRich(n,r),e.rich=n):n&&(e.rich=n)),e},y.prototype._mergeRich=function(e,t){for(var r=U(t),n=0;n<r.length;n++){var o=r[n];e[o]=e[o]||{},O(e[o],t[o])}},y.prototype.getAnimationStyleProps=function(){return Ud},y.prototype._getOrCreateChild=function(e){var t=this._children[this._childCursor];return t&&t instanceof e||(t=new e),(this._children[this._childCursor++]=t).__zr=this.__zr,t.parent=this,t},y.prototype._updatePlainTexts=function(){for(var e,t=this.style,r=t.font||Q,n=t.padding,o=function(e,t){null!=e&&(e+="");var r,n=t.overflow,o=t.padding,i=t.font,a="truncate"===n,s=So(i),d=A(t.lineHeight,s),l=!!t.backgroundColor,u="truncate"===t.lineOverflow,c=t.width,n=(r=null==c||"break"!==n&&"breakAll"!==n?e?e.split("\n"):[]:e?Md(e,t.font,c,"breakAll"===n,0).lines:[]).length*d,p=A(t.height,n);if(p<n&&u&&(u=Math.floor(p/d),r=r.slice(0,u)),e&&a&&null!=c)for(var h=Ed(c,i,t.ellipsis,{minChar:t.truncateMinChar,placeholder:t.placeholder}),f=0;f<r.length;f++)r[f]=Id(r[f],h);for(var u=p,m=0,f=0;f<r.length;f++)m=Math.max(yo(r[f],i),m);return null==c&&(c=m),e=m,o&&(u+=o[0]+o[2],e+=o[1]+o[3],c+=o[1]+o[3]),{lines:r,height:p,outerWidth:e=l?c:e,outerHeight:u,lineHeight:d,calculatedLineHeight:s,contentWidth:m,contentHeight:n,width:c}}(zd(t),t),i=Yd(t),a=!!t.backgroundColor,s=o.outerHeight,d=o.outerWidth,l=o.contentWidth,u=o.lines,c=o.lineHeight,p=this._defaultStyle,h=t.x||0,f=t.y||0,m=t.align||p.align||"left",g=t.verticalAlign||p.verticalAlign||"top",y=h,v=_o(f,o.contentHeight,g),b=((i||n)&&(e=bo(h,d,m),f=_o(f,s,g),i)&&this._renderBackground(t,t,e,f,d,s),v+=c/2,n&&(y=Wd(h,m,n),"top"===g?v+=n[0]:"bottom"===g&&(v-=n[2])),0),i=!1,_=(Gd(("fill"in t?t:(i=!0,p)).fill)),S=(qd("stroke"in t?t.stroke:a||p.autoStroke&&!i?null:(b=2,p.stroke))),w=0<t.textShadowBlur,E=null!=t.width&&("truncate"===t.overflow||"break"===t.overflow||"breakAll"===t.overflow),I=o.calculatedLineHeight,T=0;T<u.length;T++){var C=this._getOrCreateChild(ns),R=C.createStyle();C.useStyle(R),R.text=u[T],R.x=y,R.y=v,m&&(R.textAlign=m),R.textBaseline="middle",R.opacity=t.opacity,R.strokeFirst=!0,w&&(R.shadowBlur=t.textShadowBlur||0,R.shadowColor=t.textShadowColor||"transparent",R.shadowOffsetX=t.textShadowOffsetX||0,R.shadowOffsetY=t.textShadowOffsetY||0),R.stroke=S,R.fill=_,S&&(R.lineWidth=t.lineWidth||b,R.lineDash=t.lineDash,R.lineDashOffset=t.lineDashOffset||0),R.font=r,jd(R,t),v+=c,E&&C.setBoundingRect(new Y(bo(R.x,t.width,R.textAlign),_o(R.y,I,R.textBaseline),l,I))}},y.prototype._updateRichTexts=function(){for(var e=this.style,t=Pd(zd(e),e),r=t.width,n=t.outerWidth,o=t.outerHeight,i=e.padding,a=e.x||0,s=e.y||0,d=this._defaultStyle,l=e.align||d.align,d=e.verticalAlign||d.verticalAlign,a=bo(a,n,l),l=_o(s,o,d),u=a,c=l,p=(i&&(u+=i[3],c+=i[0]),u+r),h=(Yd(e)&&this._renderBackground(e,e,a,l,n,o),!!e.backgroundColor),f=0;f<t.lines.length;f++){for(var m=t.lines[f],g=m.tokens,y=g.length,v=m.lineHeight,b=m.width,_=0,S=u,w=p,E=y-1,I=void 0;_<y&&(!(I=g[_]).align||"left"===I.align);)this._placeToken(I,e,v,c,S,"left",h),b-=I.width,S+=I.width,_++;for(;0<=E&&"right"===(I=g[E]).align;)this._placeToken(I,e,v,c,w,"right",h),b-=I.width,w-=I.width,E--;for(S+=(r-(S-u)-(p-w)-b)/2;_<=E;)I=g[_],this._placeToken(I,e,v,c,S+I.width/2,"center",h),S+=I.width,_++;c+=v}},y.prototype._placeToken=function(e,t,r,n,o,i,a){var s=t.rich[e.styleName]||{},d=(s.text=e.text,e.verticalAlign),l=n+r/2;"top"===d?l=n+e.height/2:"bottom"===d&&(l=n+r-e.height/2);!e.isLineHolder&&Yd(s)&&this._renderBackground(s,t,"right"===i?o-e.width:"center"===i?o-e.width/2:o,l-e.height/2,e.width,e.height);var d=!!s.backgroundColor,n=e.textPadding,r=(n&&(o=Wd(o,i,n),l-=e.height/2-n[0]-e.innerHeight/2),this._getOrCreateChild(ns)),n=r.createStyle(),u=(r.useStyle(n),this._defaultStyle),c=!1,p=0,h=Gd(("fill"in s?s:"fill"in t?t:(c=!0,u)).fill),d=qd("stroke"in s?s.stroke:"stroke"in t?t.stroke:d||a||u.autoStroke&&!c?null:(p=2,u.stroke)),a=0<s.textShadowBlur||0<t.textShadowBlur,c=(n.text=e.text,n.x=o,n.y=l,a&&(n.shadowBlur=s.textShadowBlur||t.textShadowBlur||0,n.shadowColor=s.textShadowColor||t.textShadowColor||"transparent",n.shadowOffsetX=s.textShadowOffsetX||t.textShadowOffsetX||0,n.shadowOffsetY=s.textShadowOffsetY||t.textShadowOffsetY||0),n.textAlign=i,n.textBaseline="middle",n.font=e.font||Q,n.opacity=Te(s.opacity,t.opacity,1),jd(n,s),d&&(n.lineWidth=Te(s.lineWidth,t.lineWidth,p),n.lineDash=A(s.lineDash,t.lineDash),n.lineDashOffset=t.lineDashOffset||0,n.stroke=d),h&&(n.fill=h),e.contentWidth),u=e.contentHeight;r.setBoundingRect(new Y(bo(n.x,c,n.textAlign),_o(n.y,u,n.textBaseline),c,u))},y.prototype._renderBackground=function(e,t,r,n,o,i){var a,s,d,l,u=e.backgroundColor,c=e.borderWidth,p=e.borderColor,h=u&&u.image,f=u&&!h,m=e.borderRadius,g=this,m=((f||e.lineHeight||c&&p)&&((a=this._getOrCreateChild(Ca)).useStyle(a.createStyle()),a.style.fill=null,(d=a.shape).x=r,d.y=n,d.width=o,d.height=i,d.r=m,a.dirtyShape()),f?((l=a.style).fill=u||null,l.fillOpacity=A(e.fillOpacity,1)):h&&((s=this._getOrCreateChild(ma)).onload=function(){g.dirtyStyle()},(d=s.style).image=u.image,d.x=r,d.y=n,d.width=o,d.height=i),c&&p&&((l=a.style).lineWidth=c,l.stroke=p,l.strokeOpacity=A(e.strokeOpacity,1),l.lineDash=e.borderDash,l.lineDashOffset=e.borderDashOffset||0,a.strokeContainThreshold=0,a.hasFill())&&a.hasStroke()&&(l.strokeFirst=!0,l.lineWidth*=2),(a||s).style);m.shadowBlur=e.shadowBlur||0,m.shadowColor=e.shadowColor||"transparent",m.shadowOffsetX=e.shadowOffsetX||0,m.shadowOffsetY=e.shadowOffsetY||0,m.opacity=Te(e.opacity,t.opacity,1)},y.makeFont=function(e){var t="";return(t=Vd(e)?[e.fontStyle,e.fontWeight,Bd(e.fontSize),e.fontFamily||"sans-serif"].join(" "):t)&&ke(t)||e.textFont||e.font},y);function y(e){var t=Ad.call(this)||this;return t.type="text",t._children=[],t._defaultStyle=Od,t.attr(e),t}var Hd={left:!0,right:1,center:1},Ld={top:1,bottom:1,middle:1},Nd=["fontStyle","fontWeight","fontSize","fontFamily"];function Bd(e){return"string"!=typeof e||-1===e.indexOf("px")&&-1===e.indexOf("rem")&&-1===e.indexOf("em")?isNaN(+e)?I+"px":e+"px":e}function jd(e,t){for(var r=0;r<Nd.length;r++){var n=Nd[r],o=t[n];null!=o&&(e[n]=o)}}function Vd(e){return null!=e.fontSize||e.fontFamily||e.fontWeight}function Fd(e){var t;e&&(e.font=Dd.makeFont(e),t=e.align,e.align=null==(t="middle"===t?"center":t)||Hd[t]?t:"left",t=e.verticalAlign,e.verticalAlign=null==(t="center"===t?"middle":t)||Ld[t]?t:"top",e.padding)&&(e.padding=Re(e.padding))}function qd(e,t){return null==e||t<=0||"transparent"===e||"none"===e?null:e.image||e.colorStops?"#000":e}function Gd(e){return null==e||"none"===e?null:e.image||e.colorStops?"#000":e}function Wd(e,t,r){return"right"===t?e-r[1]:"center"===t?e+r[3]/2-r[1]/2:e+r[3]}function zd(e){e=e.text;return null!=e&&(e+=""),e}function Yd(e){return!!(e.backgroundColor||e.lineHeight||e.borderWidth&&e.borderColor)}var Kd,Xd=function(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0},Jd=(i(Qd,Kd=J),Qd.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Qd.prototype.getDefaultShape=function(){return new Xd},Qd.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=Math.max(t.r,0),i=t.startAngle,a=t.endAngle,t=t.clockwise,s=Math.cos(i),d=Math.sin(i);e.moveTo(s*o+r,d*o+n),e.arc(r,n,o,i,a,!t)},Qd);function Qd(e){return Kd.call(this,e)||this}Jd.prototype.type="arc";var Zd=[],$d=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1};function el(e,t,r){var n=e.cpx2,o=e.cpy2;return null!=n||null!=o?[(r?lr:W)(e.x1,e.cpx1,e.cpx2,e.x2,t),(r?lr:W)(e.y1,e.cpy1,e.cpy2,e.y2,t)]:[(r?hr:z)(e.x1,e.cpx1,e.x2,t),(r?hr:z)(e.y1,e.cpy1,e.y2,t)]}i(nl,tl=J),nl.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},nl.prototype.getDefaultShape=function(){return new $d},nl.prototype.buildPath=function(e,t){var r=t.x1,n=t.y1,o=t.x2,i=t.y2,a=t.cpx1,s=t.cpy1,d=t.cpx2,l=t.cpy2,t=t.percent;0!==t&&(e.moveTo(r,n),null==d||null==l?(t<1&&(mr(r,a,o,t,Zd),a=Zd[1],o=Zd[2],mr(n,s,i,t,Zd),s=Zd[1],i=Zd[2]),e.quadraticCurveTo(a,s,o,i)):(t<1&&(pr(r,a,d,o,t,Zd),a=Zd[1],d=Zd[2],o=Zd[3],pr(n,s,l,i,t,Zd),s=Zd[1],l=Zd[2],i=Zd[3]),e.bezierCurveTo(a,s,d,l,o,i)))},nl.prototype.pointAt=function(e){return el(this.shape,e,!1)},nl.prototype.tangentAt=function(e){e=el(this.shape,e,!0);return Ye(e,e)};var tl,rl=nl;function nl(e){return tl.call(this,e)||this}rl.prototype.type="bezier-curve";var ol,il=function(){this.cx=0,this.cy=0,this.width=0,this.height=0},al=(i(sl,ol=J),sl.prototype.getDefaultShape=function(){return new il},sl.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=t.width,t=t.height;e.moveTo(r,n+o),e.bezierCurveTo(r+o,n+o,r+3*o/2,n-o/3,r,n-t),e.bezierCurveTo(r-3*o/2,n-o/3,r-o,n+o,r,n+o),e.closePath()},sl);function sl(e){return ol.call(this,e)||this}al.prototype.type="droplet";var dl,ll=function(){this.cx=0,this.cy=0,this.width=0,this.height=0},ul=(i(cl,dl=J),cl.prototype.getDefaultShape=function(){return new ll},cl.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=t.width,t=t.height;e.moveTo(r,n),e.bezierCurveTo(r+o/2,n-2*t/3,r+2*o,n+t/3,r,n+t),e.bezierCurveTo(r-2*o,n+t/3,r-o/2,n-2*t/3,r,n)},cl);function cl(e){return dl.call(this,e)||this}ul.prototype.type="heart";var pl,hl=Math.PI,fl=Math.sin,ml=Math.cos,gl=function(){this.x=0,this.y=0,this.r=0,this.n=0},yl=(i(vl,pl=J),vl.prototype.getDefaultShape=function(){return new gl},vl.prototype.buildPath=function(e,t){var r=t.n;if(r&&!(r<2)){var n=t.x,o=t.y,i=t.r,a=2*hl/r,s=-hl/2;e.moveTo(n+i*ml(s),o+i*fl(s));for(var d=0,l=r-1;d<l;d++)e.lineTo(n+i*ml(s+=a),o+i*fl(s));e.closePath()}},vl);function vl(e){return pl.call(this,e)||this}yl.prototype.type="isogon";var bl,_l=function(){this.cx=0,this.cy=0,this.r=0,this.r0=0},Sl=(i(wl,bl=J),wl.prototype.getDefaultShape=function(){return new _l},wl.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=2*Math.PI;e.moveTo(r+t.r,n),e.arc(r,n,t.r,0,o,!1),e.moveTo(r+t.r0,n),e.arc(r,n,t.r0,0,o,!0)},wl);function wl(e){return bl.call(this,e)||this}Sl.prototype.type="ring";var El,Il=Math.sin,Tl=Math.cos,Cl=Math.PI/180,Rl=function(){this.cx=0,this.cy=0,this.r=[],this.k=0,this.n=1},Pl=(i(kl,El=J),kl.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},kl.prototype.getDefaultShape=function(){return new Rl},kl.prototype.buildPath=function(e,t){var r,n,o=t.r,i=t.k,a=t.n,s=t.cx,d=t.cy;e.moveTo(s,d);for(var l=0,u=o.length;l<u;l++)for(var c=o[l],p=0;p<=360*a;p++)r=c*Il(i/a*p%360*Cl)*Tl(p*Cl)+s,n=c*Il(i/a*p%360*Cl)*Il(p*Cl)+d,e.lineTo(r,n)},kl);function kl(e){return El.call(this,e)||this}Pl.prototype.type="rose";var xl,Ml=Math.PI,Al=Math.cos,Ol=Math.sin,Ul=function(){this.cx=0,this.cy=0,this.n=3,this.r=0},Dl=(i(Hl,xl=J),Hl.prototype.getDefaultShape=function(){return new Ul},Hl.prototype.buildPath=function(e,t){var r=t.n;if(r&&!(r<2)){var n=t.cx,o=t.cy,i=t.r,a=t.r0,s=(null==a&&(a=4<r?i*Al(2*Ml/r)/Al(Ml/r):i/3),Ml/r),d=-Ml/2,t=n+i*Al(d),l=o+i*Ol(d);d+=s,e.moveTo(t,l);for(var u,c=0,p=2*r-1;c<p;c++)e.lineTo(n+(u=c%2==0?a:i)*Al(d),o+u*Ol(d)),d+=s;e.closePath()}},Hl);function Hl(e){return xl.call(this,e)||this}Dl.prototype.type="star";var Ll,Nl=Math.cos,Bl=Math.sin,jl=function(){this.cx=0,this.cy=0,this.r=0,this.r0=0,this.d=0,this.location="out"},Vl=(i(Fl,Ll=J),Fl.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},Fl.prototype.getDefaultShape=function(){return new jl},Fl.prototype.buildPath=function(e,t){var r,n=t.r,o=t.r0,i=t.d,a=t.cx,s=t.cy,d="out"===t.location?1:-1;if(!(t.location&&n<=o)){var l,u=0,c=1,t=(n+d*o)*Nl(0)-d*i*Nl(0)+a,p=(n+d*o)*Bl(0)-i*Bl(0)+s;for(e.moveTo(t,p);o*++u%(n+d*o)!=0;);for(;l=Math.PI/180*c,r=(n+d*o)*Nl(l)-d*i*Nl((n/o+d)*l)+a,l=(n+d*o)*Bl(l)-i*Bl((n/o+d)*l)+s,e.lineTo(r,l),++c<=o*u/(n+d*o)*360;);}},Fl);function Fl(e){return Ll.call(this,e)||this}Vl.prototype.type="trochoid";function ql(e,t){this.image=e,this.repeat=t,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1}var Gl=[0,0],Wl=[0,0],zl=new S,Yl=new S,Kl=(Xl.prototype.fromBoundingRect=function(e,t){var r=this._corners,n=this._axes,o=e.x,i=e.y,a=o+e.width,e=i+e.height;if(r[0].set(o,i),r[1].set(a,i),r[2].set(a,e),r[3].set(o,e),t)for(var s=0;s<4;s++)r[s].transform(t);S.sub(n[0],r[1],r[0]),S.sub(n[1],r[3],r[0]),n[0].normalize(),n[1].normalize();for(s=0;s<2;s++)this._origin[s]=n[s].dot(r[0])},Xl.prototype.intersect=function(e,t){var r=!0,n=!t;return zl.set(1/0,1/0),Yl.set(0,0),!this._intersectCheckOneSide(this,e,zl,Yl,n,1)&&(r=!1,n)||!this._intersectCheckOneSide(e,this,zl,Yl,n,-1)&&(r=!1,n)||n||S.copy(t,r?zl:Yl),r},Xl.prototype._intersectCheckOneSide=function(e,t,r,n,o,i){for(var a=!0,s=0;s<2;s++){var d=this._axes[s];if(this._getProjMinMaxOnAxis(s,e._corners,Gl),this._getProjMinMaxOnAxis(s,t._corners,Wl),Gl[1]<Wl[0]||Wl[1]<Gl[0]){if(a=!1,o)return a;var l=Math.abs(Wl[0]-Gl[1]),u=Math.abs(Gl[0]-Wl[1]);Math.min(l,u)>n.len()&&(l<u?S.scale(n,d,-l*i):S.scale(n,d,u*i))}else r&&(l=Math.abs(Wl[0]-Gl[1]),u=Math.abs(Gl[0]-Wl[1]),Math.min(l,u)<r.len())&&(l<u?S.scale(r,d,l*i):S.scale(r,d,-u*i))}return a},Xl.prototype._getProjMinMaxOnAxis=function(e,t,r){for(var n=this._axes[e],o=this._origin,i=t[0].dot(n)+o[e],a=i,s=i,d=1;d<t.length;d++)var l=t[d].dot(n)+o[e],a=Math.min(l,a),s=Math.max(l,s);r[0]=a,r[1]=s},Xl);function Xl(e,t){this._corners=[],this._axes=[],this._origin=[0,0];for(var r=0;r<4;r++)this._corners[r]=new S;for(r=0;r<2;r++)this._axes[r]=new S;e&&this.fromBoundingRect(e,t)}Ql.prototype.update=function(e){var t=this.dom.style;t.width=e.width+"px",t.height=e.height+"px",t.left=e.x+"px",t.top=e.y+"px"},Ql.prototype.hide=function(){this.dom.style.opacity="0"},Ql.prototype.show=function(e){var t=this;clearTimeout(this._hideTimeout),this.dom.style.opacity="1",this._hideTimeout=setTimeout(function(){t.hide()},e||1e3)};var Jl=Ql;function Ql(e){var t,r=this.dom=document.createElement("div");for(t in r.className="ec-debug-dirty-rect",e=O({},e),O(e,{backgroundColor:"rgba(0, 0, 255, 0.2)",border:"1px solid #00f"}),r.style.cssText="\nposition: absolute;\nopacity: 0;\ntransition: opacity 0.5s linear;\npointer-events: none;\n",e)e.hasOwnProperty(t)&&(r.style[t]=e[t])}function Zl(e){return isFinite(e)}function $l(e,t,r){for(var n,o,i,a,s,d,l,u,c,p="radial"===t.type?(n=e,o=t,a=(i=r).width,s=i.height,d=Math.min(a,s),l=null==o.x?.5:o.x,u=null==o.y?.5:o.y,c=null==o.r?.5:o.r,o.global||(l=l*a+i.x,u=u*s+i.y,c*=d),l=Zl(l)?l:.5,u=Zl(u)?u:.5,c=0<=c&&Zl(c)?c:.5,n.createRadialGradient(l,u,0,l,u,c)):(o=e,a=r,i=null==(s=t).x?0:s.x,d=null==s.x2?1:s.x2,n=null==s.y?0:s.y,l=null==s.y2?0:s.y2,s.global||(i=i*a.width+a.x,d=d*a.width+a.x,n=n*a.height+a.y,l=l*a.height+a.y),i=Zl(i)?i:0,d=Zl(d)?d:1,n=Zl(n)?n:0,l=Zl(l)?l:0,o.createLinearGradient(i,n,d,l)),h=t.colorStops,f=0;f<h.length;f++)p.addColorStop(h[f].offset,h[f].color);return p}function eu(e){return parseInt(e,10)}function tu(e,t,r){var n=["width","height"][t],o=["clientWidth","clientHeight"][t],i=["paddingLeft","paddingTop"][t],t=["paddingRight","paddingBottom"][t];return null!=r[n]&&"auto"!==r[n]?parseFloat(r[n]):(r=document.defaultView.getComputedStyle(e),(e[o]||eu(r[n])||eu(e.style[n]))-(eu(r[i])||0)-(eu(r[t])||0)|0)}function ru(e){var t,r=e.style,n=r.lineDash&&0<r.lineWidth&&(o=r.lineDash,n=r.lineWidth,o&&"solid"!==o&&0<n?"dashed"===o?[4*n,2*n]:"dotted"===o?[n]:ye(o)?[o]:fe(o)?o:null:null),o=r.lineDashOffset;return n&&(t=r.strokeNoScale&&e.getLineScale?e.getLineScale():1)&&1!==t&&(n=L(n,function(e){return e/t}),o/=t),[n,o]}var nu=new Ei(!0);function ou(e){var t=e.stroke;return!(null==t||"none"===t||!(0<e.lineWidth))}function iu(e){return"string"==typeof e&&"none"!==e}function au(e){e=e.fill;return null!=e&&"none"!==e}function su(e,t){var r;null!=t.fillOpacity&&1!==t.fillOpacity?(r=e.globalAlpha,e.globalAlpha=t.fillOpacity*t.opacity,e.fill(),e.globalAlpha=r):e.fill()}function du(e,t){var r;null!=t.strokeOpacity&&1!==t.strokeOpacity?(r=e.globalAlpha,e.globalAlpha=t.strokeOpacity*t.opacity,e.stroke(),e.globalAlpha=r):e.stroke()}function lu(e,t,r){var r=bd(t.image,t.__image,r);if(Sd(r))return e=e.createPattern(r,t.repeat||"repeat"),"function"==typeof DOMMatrix&&e&&e.setTransform&&((r=new DOMMatrix).translateSelf(t.x||0,t.y||0),r.rotateSelf(0,0,(t.rotation||0)*Ne),r.scaleSelf(t.scaleX||1,t.scaleY||1),e.setTransform(r)),e}var uu=["shadowBlur","shadowOffsetX","shadowOffsetY"],cu=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function pu(e,t,r,n,o){var i,a=!1;if(!n&&t===(r=r||{}))return!1;!n&&t.opacity===r.opacity||(bu(e,o),a=!0,i=Math.max(Math.min(t.opacity,1),0),e.globalAlpha=isNaN(i)?Go.opacity:i),!n&&t.blend===r.blend||(a||(bu(e,o),a=!0),e.globalCompositeOperation=t.blend||Go.blend);for(var s=0;s<uu.length;s++){var d=uu[s];!n&&t[d]===r[d]||(a||(bu(e,o),a=!0),e[d]=e.dpr*(t[d]||0))}return!n&&t.shadowColor===r.shadowColor||(a||(bu(e,o),a=!0),e.shadowColor=t.shadowColor||Go.shadowColor),a}function hu(e,t,r,n,o){var i=_u(t,o.inHover),a=n?null:r&&_u(r,o.inHover)||{};if(i!==a){var s=pu(e,i,a,n,o);(n||i.fill!==a.fill)&&(s||(bu(e,o),s=!0),iu(i.fill))&&(e.fillStyle=i.fill),(n||i.stroke!==a.stroke)&&(s||(bu(e,o),s=!0),iu(i.stroke))&&(e.strokeStyle=i.stroke),!n&&i.opacity===a.opacity||(s||(bu(e,o),s=!0),e.globalAlpha=null==i.opacity?1:i.opacity),t.hasStroke()&&(r=i.lineWidth/(i.strokeNoScale&&t.getLineScale?t.getLineScale():1),e.lineWidth!==r)&&(s||(bu(e,o),s=!0),e.lineWidth=r);for(var d=0;d<cu.length;d++){var l=cu[d],u=l[0];!n&&i[u]===a[u]||(s||(bu(e,o),s=!0),e[u]=i[u]||l[1])}}}function fu(e,t){var t=t.transform,r=e.dpr||1;t?e.setTransform(r*t[0],r*t[1],r*t[2],r*t[3],r*t[4],r*t[5]):e.setTransform(r,0,0,r,0,0)}var mu=1,gu=2,yu=3,vu=4;function bu(e,t){t.batchFill&&e.fill(),t.batchStroke&&e.stroke(),t.batchFill="",t.batchStroke=""}function _u(e,t){return t&&e.__hoverStyle||e.style}function Su(e,t,r,H){var n=t.transform;if(t.shouldBePainted(r.viewWidth,r.viewHeight,!1,!1)){var o=t.__clipPaths,i=r.prevElClipPaths,a=!1,s=!1;if(!i||function(e,t){if(e!==t&&(e||t)){if(!e||!t||e.length!==t.length)return 1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return 1}}(o,i)){if(i&&i.length&&(bu(e,r),e.restore(),s=a=!0,r.prevElClipPaths=null,r.allClipped=!1,r.prevEl=null),o&&o.length){bu(e,r),e.save();for(var L=o,d=e,i=r,N=!1,B=0;B<L.length;B++){var j=L[B],N=N||j.isZeroArea();fu(d,j),d.beginPath(),j.buildPath(d,j.shape),d.clip()}i.allClipped=N,a=!0}r.prevElClipPaths=o}if(r.allClipped)t.__isRendered=!1;else{t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush();var l,u,c,p,h,f,m,g,y,v,b,_,S,V,w,E,I,T,C,R,P,k,x,i=r.prevEl,M=(i||(s=a=!0),t instanceof J&&t.autoBatch&&(o=t.style,M=au(o),l=ou(o),!(o.lineDash||!(+M^+l)||M&&"string"!=typeof o.fill||l&&"string"!=typeof o.stroke||o.strokePercent<1||o.strokeOpacity<1||o.fillOpacity<1))),a=(a||(l=n,o=i.transform,l&&o?l[0]!==o[0]||l[1]!==o[1]||l[2]!==o[2]||l[3]!==o[3]||l[4]!==o[4]||l[5]!==o[5]:l||o)?(bu(e,r),fu(e,t)):M||bu(e,r),_u(t,r.inHover));if(t instanceof J)r.lastDrawType!==mu&&(s=!0,r.lastDrawType=mu),hu(e,t,i,s,r),M&&(r.batchFill||r.batchStroke)||e.beginPath(),n=e,o=t,U=M,w=ou(p=a),E=au(p),I=p.strokePercent,T=I<1,C=!o.path,o.silent&&!T||!C||o.createPathProxy(),R=o.path||nu,P=o.__dirty,U||(h=p.fill,x=p.stroke,f=E&&!!h.colorStops,m=w&&!!x.colorStops,g=E&&!!h.image,y=w&&!!x.image,k=S=_=b=v=void 0,(f||m)&&(k=o.getBoundingRect()),f&&(v=P?$l(n,h,k):o.__canvasFillGradient,o.__canvasFillGradient=v),m&&(b=P?$l(n,x,k):o.__canvasStrokeGradient,o.__canvasStrokeGradient=b),g&&(_=P||!o.__canvasFillPattern?lu(n,h,o):o.__canvasFillPattern,o.__canvasFillPattern=_),y&&(S=P||!o.__canvasStrokePattern?lu(n,x,o):o.__canvasStrokePattern,o.__canvasStrokePattern=_),f?n.fillStyle=v:g&&(_?n.fillStyle=_:E=!1),m?n.strokeStyle=b:y&&(S?n.strokeStyle=S:w=!1)),k=o.getGlobalScale(),R.setScale(k[0],k[1],o.segmentIgnoreThreshold),n.setLineDash&&p.lineDash&&(V=(h=ru(o))[0],O=h[1]),x=!0,(C||P&Wt)&&(R.setDPR(n.dpr),T?R.setContext(null):(R.setContext(n),x=!1),R.reset(),o.buildPath(R,o.shape,U),R.toStatic(),o.pathUpdated()),x&&R.rebuildPath(n,T?I:1),V&&(n.setLineDash(V),n.lineDashOffset=O),U||(p.strokeFirst?(w&&du(n,p),E&&su(n,p)):(E&&su(n,p),w&&du(n,p))),V&&n.setLineDash([]),M&&(r.batchFill=a.fill||"",r.batchStroke=a.stroke||"");else if(t instanceof ns)r.lastDrawType!==yu&&(s=!0,r.lastDrawType=yu),hu(e,t,i,s,r),f=e,v=t,null!=(_=(g=a).text)&&(_+=""),_&&(f.font=g.font||Q,f.textAlign=g.textAlign,f.textBaseline=g.textBaseline,b=m=void 0,f.setLineDash&&g.lineDash&&(m=(v=ru(v))[0],b=v[1]),m&&(f.setLineDash(m),f.lineDashOffset=b),g.strokeFirst?(ou(g)&&f.strokeText(_,g.x,g.y),au(g)&&f.fillText(_,g.x,g.y)):(au(g)&&f.fillText(_,g.x,g.y),ou(g)&&f.strokeText(_,g.x,g.y)),m)&&f.setLineDash([]);else if(t instanceof ma)r.lastDrawType!==gu&&(s=!0,r.lastDrawType=gu),y=i,S=s,pu(e,_u(t,(k=r).inHover),y&&_u(y,k.inHover),S,k),h=e,C=a,(o=(P=t).__image=bd(C.image,P.__image,P,P.onload))&&Sd(o)&&(x=C.x||0,R=C.y||0,T=P.getWidth(),P=P.getHeight(),I=o.width/o.height,null==T&&null!=P?T=P*I:null==P&&null!=T?P=T/I:null==T&&null==P&&(T=o.width,P=o.height),C.sWidth&&C.sHeight?(u=C.sx||0,c=C.sy||0,h.drawImage(o,u,c,C.sWidth,C.sHeight,x,R,T,P)):C.sx&&C.sy?(u=C.sx,c=C.sy,h.drawImage(o,u,c,T-u,P-c,x,R,T,P)):h.drawImage(o,x,R,T,P));else if(t.getTemporalDisplayables){r.lastDrawType!==vu&&(s=!0,r.lastDrawType=vu);var A,F,q=e,O=t,U=r,G=O.getDisplayables(),W=O.getTemporalDisplayables(),z=(q.save(),{prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:U.viewWidth,viewHeight:U.viewHeight,inHover:U.inHover});for(A=O.getCursor(),F=G.length;A<F;A++)(D=G[A]).beforeBrush&&D.beforeBrush(),D.innerBeforeBrush(),Su(q,D,z,A===F-1),D.innerAfterBrush(),D.afterBrush&&D.afterBrush(),z.prevEl=D;for(var D,Y=0,K=W.length;Y<K;Y++)(D=W[Y]).beforeBrush&&D.beforeBrush(),D.innerBeforeBrush(),Su(q,D,z,Y===K-1),D.innerAfterBrush(),D.afterBrush&&D.afterBrush(),z.prevEl=D;O.clearTemporalDisplayables(),O.notClear=!0,q.restore()}M&&H&&bu(e,r),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),(r.prevEl=t).__dirty=0,t.__isRendered=!0}}else t.__dirty&=~Gt,t.__isRendered=!1}function wu(e,t,r){var n=M.createCanvas(),o=t.getWidth(),t=t.getHeight(),i=n.style;return i&&(i.position="absolute",i.left="0",i.top="0",i.width=o+"px",i.height=t+"px",n.setAttribute("data-zr-dom-id",e)),n.width=o*r,n.height=t*r,n}i(Tu,Eu=at),Tu.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},Tu.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},Tu.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},Tu.prototype.setUnpainted=function(){this.__firstTimePaint=!0},Tu.prototype.createBackBuffer=function(){var e=this.dpr;this.domBack=wu("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),1!==e&&this.ctxBack.scale(e,e)},Tu.prototype.createRepaintRects=function(e,t,r,n){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var d=[],l=this.maxRepaintRectCount,u=!1,c=new Y(0,0,0,0);function o(e){if(e.isFinite()&&!e.isZero())if(0===d.length)(t=new Y(0,0,0,0)).copy(e),d.push(t);else{for(var t,r=!1,n=1/0,o=0,i=0;i<d.length;++i){var a=d[i];if(a.intersect(e)){var s=new Y(0,0,0,0);s.copy(a),s.union(e),d[i]=s,r=!0;break}u&&(c.copy(e),c.union(a),s=e.width*e.height,a=a.width*a.height,(a=c.width*c.height-s-a)<n)&&(n=a,o=i)}u&&(d[o].union(e),r=!0),r||((t=new Y(0,0,0,0)).copy(e),d.push(t)),u=u||d.length>=l}}for(var i,a=this.__startIndex;a<this.__endIndex;++a)(s=e[a])&&(h=s.shouldBePainted(r,n,!0,!0),(p=s.__isRendered&&(s.__dirty&Gt||!h)?s.getPrevPaintRect():null)&&o(p),i=h&&(s.__dirty&Gt||!s.__isRendered)?s.getPaintRect():null)&&o(i);for(a=this.__prevStartIndex;a<this.__prevEndIndex;++a){var s,p,h=(s=t[a]).shouldBePainted(r,n,!0,!0);!s||h&&s.__zr||!s.__isRendered||(p=s.getPrevPaintRect())&&o(p)}do{for(var f=!1,a=0;a<d.length;)if(d[a].isZero())d.splice(a,1);else{for(var m=a+1;m<d.length;)d[a].intersect(d[m])?(f=!0,d[a].union(d[m]),d.splice(m,1)):m++;a++}}while(f);return this._paintRects=d},Tu.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},Tu.prototype.resize=function(e,t){var r=this.dpr,n=this.dom,o=n.style,i=this.domBack;o&&(o.width=e+"px",o.height=t+"px"),n.width=e*r,n.height=t*r,i&&(i.width=e*r,i.height=t*r,1!==r)&&this.ctxBack.scale(r,r)},Tu.prototype.clear=function(e,i,t){var r=this.dom,a=this.ctx,n=r.width,o=r.height,s=(i=i||this.clearColor,this.motionBlur&&!e),d=this.lastFrameAlpha,l=this.dpr,u=this,c=(s&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(r,0,0,n/l,o/l)),this.domBack);function p(e,t,r,n){var o;a.clearRect(e,t,r,n),i&&"transparent"!==i&&(o=void 0,we(i)?(o=i.__canvasGradient||$l(a,i,{x:0,y:0,width:r,height:n}),i.__canvasGradient=o):Ee(i)&&(o=lu(a,i,{dirty:function(){u.setUnpainted(),u.__painter.refresh()}})),a.save(),a.fillStyle=o||i,a.fillRect(e,t,r,n),a.restore()),s&&(a.save(),a.globalAlpha=d,a.drawImage(c,e,t,r,n),a.restore())}!t||s?p(0,0,n,o):t.length&&w(t,function(e){p(e.x*l,e.y*l,e.width*l,e.height*l)})};var Eu,Iu=Tu;function Tu(e,t,r){var n,o=Eu.call(this)||this,e=(o.motionBlur=!1,o.lastFrameAlpha=.7,o.dpr=1,o.virtual=!1,o.config={},o.incremental=!1,o.zlevel=0,o.maxRepaintRectCount=5,o.__dirty=!0,o.__firstTimePaint=!0,o.__used=!1,o.__drawIndex=0,o.__startIndex=0,o.__endIndex=0,o.__prevStartIndex=null,o.__prevEndIndex=null,r=r||Vn,"string"==typeof e?n=wu(e,t,r):ve(e)&&(e=(n=e).id),o.id=e,(o.dom=n).style);return e&&(De(n),n.onselectstart=function(){return!1},e.padding="0",e.margin="0",e.borderWidth="0"),o.painter=t,o.dpr=r,o}var Cu=314159;b.prototype.getType=function(){return"canvas"},b.prototype.isSingleCanvas=function(){return this._singleCanvas},b.prototype.getViewportRoot=function(){return this._domRoot},b.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},b.prototype.refresh=function(e){var t=this.storage.getDisplayList(!0),r=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(t,r,e,this._redrawId);for(var o=0;o<n.length;o++){var i,a=n[o],a=this._layers[a];!a.__builtin__&&a.refresh&&(i=0===o?this._backgroundColor:null,a.refresh(i))}return this._opts.useDirtyRect&&(this._prevDisplayList=t.slice()),this},b.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},b.prototype._paintHoverList=function(e){var t=e.length,r=this._hoverlayer;if(r&&r.clear(),t){for(var n,o={inHover:!0,viewWidth:this._width,viewHeight:this._height},i=0;i<t;i++){var a=e[i];a.__inHover&&(r=r||(this._hoverlayer=this.getLayer(1e5)),n||(n=r.ctx).save(),Su(n,a,o,i===t-1))}n&&n.restore()}},b.prototype.getHoverLayer=function(){return this.getLayer(1e5)},b.prototype.paintOne=function(e,t){Su(e,t,{inHover:!1,viewWidth:0,viewHeight:0},!0)},b.prototype._paintList=function(e,t,r,n){var o,i,a;this._redrawId===n&&(r=r||!1,this._updateLayerStatus(e),o=(i=this._doPaintList(e,t,r)).finished,i=i.needsRefreshHover,this._needsManuallyCompositing&&this._compositeManually(),i&&this._paintHoverList(e),o?this.eachLayer(function(e){e.afterBrush&&e.afterBrush()}):(a=this,Qt(function(){a._paintList(e,t,r,n)})))},b.prototype._compositeManually=function(){var t=this.getLayer(Cu).ctx,r=this._domRoot.width,n=this._domRoot.height;t.clearRect(0,0,r,n),this.eachBuiltinLayer(function(e){e.virtual&&t.drawImage(e.dom,0,0,r,n)})},b.prototype._doPaintList=function(h,f,m){for(var g=this,y=[],v=this._opts.useDirtyRect,e=0;e<this._zlevelList.length;e++){var t=this._zlevelList[e],t=this._layers[t];t.__builtin__&&t!==this._hoverlayer&&(t.__dirty||m)&&y.push(t)}for(var b=!0,_=!1,r=function(e){function t(e){var t={inHover:!1,allClipped:!1,prevEl:null,viewWidth:g._width,viewHeight:g._height};for(n=s;n<o.__endIndex;n++){var r=h[n];if(r.__inHover&&(_=!0),g._doPaintEl(r,o,v,e,t,n===o.__endIndex-1),d)if(15<Date.now()-l)break}t.prevElClipPaths&&i.restore()}var r,n,o=y[e],i=o.ctx,a=v&&o.createRepaintRects(h,f,S._width,S._height),s=m?o.__startIndex:o.__drawIndex,d=!m&&o.incremental&&Date.now,l=d&&Date.now(),e=o.zlevel===S._zlevelList[0]?S._backgroundColor:null;o.__startIndex!==o.__endIndex&&(s!==o.__startIndex||(r=h[s]).incremental&&r.notClear&&!m)||o.clear(!1,e,a),-1===s&&(console.error("For some unknown reason. drawIndex is -1"),s=o.__startIndex);if(a)if(0===a.length)n=o.__endIndex;else for(var u=S.dpr,c=0;c<a.length;++c){var p=a[c];i.save(),i.beginPath(),i.rect(p.x*u,p.y*u,p.width*u,p.height*u),i.clip(),t(p),i.restore()}else i.save(),t(),i.restore();o.__drawIndex=n,o.__drawIndex<o.__endIndex&&(b=!1)},S=this,n=0;n<y.length;n++)r(n);return a.wxa&&w(this._layers,function(e){e&&e.ctx&&e.ctx.draw&&e.ctx.draw()}),{finished:b,needsRefreshHover:_}},b.prototype._doPaintEl=function(e,t,r,n,o,i){t=t.ctx;r?(r=e.getPaintRect(),(!n||r&&r.intersect(n))&&(Su(t,e,o,i),e.setPrevPaintRect(r))):Su(t,e,o,i)},b.prototype.getLayer=function(e,t){this._singleCanvas&&!this._needsManuallyCompositing&&(e=Cu);var r=this._layers[e];return r||((r=new Iu("zr_"+e,this,this.dpr)).zlevel=e,r.__builtin__=!0,this._layerConfig[e]?ie(r,this._layerConfig[e],!0):this._layerConfig[e-.01]&&ie(r,this._layerConfig[e-.01],!0),t&&(r.virtual=t),this.insertLayer(e,r),r.initContext()),r},b.prototype.insertLayer=function(e,t){var r,n=this._layers,o=this._zlevelList,i=o.length,a=this._domRoot,s=null,d=-1;if(n[e])ne("ZLevel "+e+" has been used already");else if((r=t)&&(r.__builtin__||"function"==typeof r.resize&&"function"==typeof r.refresh)){if(0<i&&e>o[0]){for(d=0;d<i-1&&!(o[d]<e&&o[d+1]>e);d++);s=n[o[d]]}o.splice(d+1,0,e),(n[e]=t).virtual||(s?(r=s.dom).nextSibling?a.insertBefore(t.dom,r.nextSibling):a.appendChild(t.dom):a.firstChild?a.insertBefore(t.dom,a.firstChild):a.appendChild(t.dom)),t.__painter=this}else ne("Layer of zlevel "+e+" is not valid")},b.prototype.eachLayer=function(e,t){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n];e.call(t,this._layers[o],o)}},b.prototype.eachBuiltinLayer=function(e,t){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],i=this._layers[o];i.__builtin__&&e.call(t,i,o)}},b.prototype.eachOtherLayer=function(e,t){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],i=this._layers[o];i.__builtin__||e.call(t,i,o)}},b.prototype.getLayers=function(){return this._layers},b.prototype._updateLayerStatus=function(e){function t(e){o&&(o.__endIndex!==e&&(o.__dirty=!0),o.__endIndex=e)}if(this.eachBuiltinLayer(function(e,t){e.__dirty=e.__used=!1}),this._singleCanvas)for(var r=1;r<e.length;r++)if((s=e[r]).zlevel!==e[r-1].zlevel||s.incremental){this._needsManuallyCompositing=!0;break}for(var n,o=null,i=0,a=0;a<e.length;a++){var s,d=(s=e[a]).zlevel,l=void 0;n!==d&&(n=d,i=0),s.incremental?((l=this.getLayer(d+.001,this._needsManuallyCompositing)).incremental=!0,i=1):l=this.getLayer(d+(0<i?.01:0),this._needsManuallyCompositing),l.__builtin__||ne("ZLevel "+d+" has been used by unkown layer "+l.id),l!==o&&(l.__used=!0,l.__startIndex!==a&&(l.__dirty=!0),l.__startIndex=a,l.incremental?l.__drawIndex=-1:l.__drawIndex=a,t(a),o=l),s.__dirty&Gt&&!s.__inHover&&(l.__dirty=!0,l.incremental)&&l.__drawIndex<0&&(l.__drawIndex=a)}t(a),this.eachBuiltinLayer(function(e,t){!e.__used&&0<e.getElementCount()&&(e.__dirty=!0,e.__startIndex=e.__endIndex=e.__drawIndex=0),e.__dirty&&e.__drawIndex<0&&(e.__drawIndex=e.__startIndex)})},b.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},b.prototype._clearLayer=function(e){e.clear()},b.prototype.setBackgroundColor=function(e){this._backgroundColor=e,w(this._layers,function(e){e.setUnpainted()})},b.prototype.configLayer=function(e,t){if(t){var r=this._layerConfig;r[e]?ie(r[e],t,!0):r[e]=t;for(var n=0;n<this._zlevelList.length;n++){var o=this._zlevelList[n];o!==e&&o!==e+.01||ie(this._layers[o],r[e],!0)}}},b.prototype.delLayer=function(e){var t=this._layers,r=this._zlevelList,n=t[e];n&&(n.dom.parentNode.removeChild(n.dom),delete t[e],r.splice(de(r,e),1))},b.prototype.resize=function(e,t){if(this._domRoot.style){var r=this._domRoot,n=(r.style.display="none",this._opts),o=this.root;if(null!=e&&(n.width=e),null!=t&&(n.height=t),e=tu(o,0,n),t=tu(o,1,n),r.style.display="",this._width!==e||t!==this._height){for(var i in r.style.width=e+"px",r.style.height=t+"px",this._layers)this._layers.hasOwnProperty(i)&&this._layers[i].resize(e,t);this.refresh(!0)}this._width=e,this._height=t}else{if(null==e||null==t)return;this._width=e,this._height=t,this.getLayer(Cu).resize(e,t)}return this},b.prototype.clearLayer=function(e){e=this._layers[e];e&&e.clear()},b.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},b.prototype.getRenderedCanvas=function(e){if(this._singleCanvas&&!this._compositeManually)return this._layers[Cu].dom;var t=new Iu("image",this,(e=e||{}).pixelRatio||this.dpr),r=(t.initContext(),t.clear(!1,e.backgroundColor||this._backgroundColor),t.ctx);if(e.pixelRatio<=this.dpr){this.refresh();var n=t.dom.width,o=t.dom.height;this.eachLayer(function(e){e.__builtin__?r.drawImage(e.dom,0,0,n,o):e.renderToCanvas&&(r.save(),e.renderToCanvas(r),r.restore())})}else for(var i={inHover:!1,viewWidth:this._width,viewHeight:this._height},a=this.storage.getDisplayList(!0),s=0,d=a.length;s<d;s++){var l=a[s];Su(r,l,i,s===d-1)}return t.dom},b.prototype.getWidth=function(){return this._width},b.prototype.getHeight=function(){return this._height};at=b;function b(e,t,r,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var o=!e.nodeName||"CANVAS"===e.nodeName.toUpperCase();this._opts=r=O({},r||{}),this.dpr=r.devicePixelRatio||Vn,this._singleCanvas=o;(this.root=e).style&&(De(e),e.innerHTML=""),this.storage=t;var i,a,t=this._zlevelList,s=(this._prevDisplayList=[],this._layers);o?(i=(o=e).width,a=o.height,null!=r.width&&(i=r.width),null!=r.height&&(a=r.height),this.dpr=r.devicePixelRatio||1,o.width=i*this.dpr,o.height=a*this.dpr,this._width=i,this._height=a,(i=new Iu(o,this,this.dpr)).__builtin__=!0,i.initContext(),(s[Cu]=i).zlevel=Cu,t.push(Cu),this._domRoot=e):(this._width=tu(e,0,r),this._height=tu(e,1,r),i=this._domRoot=(a=this._width,o=this._height,(s=document.createElement("div")).style.cssText=["position:relative","width:"+a+"px","height:"+o+"px","padding:0","margin:0","border-width:0"].join(";")+";",s),e.appendChild(i))}var Ru=Math.sin,Pu=Math.cos,ku=Math.PI,xu=2*Math.PI,Mu=180/ku,Au=(Ou.prototype.reset=function(e){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,e||4)},Ou.prototype.moveTo=function(e,t){this._add("M",e,t)},Ou.prototype.lineTo=function(e,t){this._add("L",e,t)},Ou.prototype.bezierCurveTo=function(e,t,r,n,o,i){this._add("C",e,t,r,n,o,i)},Ou.prototype.quadraticCurveTo=function(e,t,r,n){this._add("Q",e,t,r,n)},Ou.prototype.arc=function(e,t,r,n,o,i){this.ellipse(e,t,r,r,0,n,o,i)},Ou.prototype.ellipse=function(e,t,r,n,o,i,a,s){var d,l=a-i,s=!s,u=Math.abs(l),c=zr(u-xu)||(s?xu<=l:xu<=-l),p=!1,p=!!c||!zr(u)&&ku<=(0<l?l%xu:l%xu+xu)==!!s,u=e+r*Pu(i),l=t+n*Ru(i),o=(this._start&&this._add("M",u,l),Math.round(o*Mu));c?(c=1/this._p,this._add("A",r,n,o,1,+s,e+r*Pu(i+(d=(s?1:-1)*(xu-c))),t+n*Ru(i+d)),.01<c&&this._add("A",r,n,o,0,+s,u,l)):(i=e+r*Pu(a),d=t+n*Ru(a),this._add("A",r,n,o,+p,+s,i,d))},Ou.prototype.rect=function(e,t,r,n){this._add("M",e,t),this._add("l",r,0),this._add("l",0,n),this._add("l",-r,0),this._add("Z")},Ou.prototype.closePath=function(){0<this._d.length&&this._add("Z")},Ou.prototype._add=function(e,t,r,n,o,i,a,s,d){for(var l=[],u=this._p,c=1;c<arguments.length;c++){var p=arguments[c];if(isNaN(p))return void(this._invalid=!0);l.push(Math.round(p*u)/u)}this._d.push(e+l.join(" ")),this._start="Z"===e},Ou.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},Ou.prototype.getStr=function(){return this._str},Ou);function Ou(){}var Uu="none",Du=Math.round;var Hu=["lineCap","miterLimit","lineJoin"],Lu=L(Hu,function(e){return"stroke-"+e.toLowerCase()});function Nu(e,t,r,n){var o=null==t.opacity?1:t.opacity;if(r instanceof ma)e("opacity",o);else if(null!=(i=(i=t).fill)&&i!==Uu?(e("fill",(i=Wr(t.fill)).color),i=null!=t.fillOpacity?t.fillOpacity*i.opacity*o:i.opacity*o,(n||i<1)&&e("fill-opacity",i)):e("fill",Uu),null!=(i=(i=t).stroke)&&i!==Uu){var i=Wr(t.stroke),a=(e("stroke",i.color),t.strokeNoScale?r.getLineScale():1),a=a?(t.lineWidth||0)/a:0,i=null!=t.strokeOpacity?t.strokeOpacity*i.opacity*o:i.opacity*o,o=t.strokeFirst;!n&&1==a||e("stroke-width",a),(n||o)&&e("paint-order",o?"stroke":"fill"),(n||i<1)&&e("stroke-opacity",i),t.lineDash?(o=(a=ru(r))[0],i=a[1],o&&(i=Du(i||0),e("stroke-dasharray",o.join(",")),i||n)&&e("stroke-dashoffset",i)):n&&e("stroke-dasharray",Uu);for(var s=0;s<Hu.length;s++){var d=Hu[s];(n||t[d]!==Bi[d])&&(d=t[d]||Bi[d])&&e(Lu[s],d)}}else n&&e("stroke",Uu)}var Bu="http://www.w3.org/2000/svg",ju="http://www.w3.org/1999/xlink",Vu="http://www.w3.org/2000/xmlns/",Fu="http://www.w3.org/XML/1998/namespace";function qu(e){return document.createElementNS(Bu,e)}function k(e,t,r,n,o){return{tag:e,attrs:r||{},children:n,text:o,key:t}}function Gu(e,t){var o=(t=t||{}).newline?"\n":"";return function e(t){var r=t.children,n=t.tag;return function(e,t){var r=[];if(t)for(var n in t){var o=t[n];!1!==o&&(!0!==o&&null!=o&&(n+='="'+o+'"'),r.push(n))}return"<"+e+" "+r.join(" ")+">"}(n,t.attrs)+(t.text||"")+(r?o+L(r,e).join(o)+o:"")+"</"+n+">"}(e)}function Wu(e){return{zrId:e,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssClassIdx:0,cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function zu(e,t,r,n){return k("svg","root",{width:e,height:t,xmlns:Bu,"xmlns:xlink":ju,version:"1.1",baseProfile:"full",viewBox:!!n&&"0 0 "+e+" "+t},r)}var Yu={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Ku="transform-origin";var Xu={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function Ju(e,t){var r=t.zrId+"-ani-"+t.cssAnimIdx++;return t.cssAnims[r]=e,r}function Qu(e){return ge(e)?Yu[e]?"cubic-bezier("+Yu[e]+")":yr(e)?e:"":""}function Zu(k,x,M,A){var e=k.animators,t=e.length,r=[];if(k instanceof hd){if(o=function(e,t,l){var u,c,e=e.shape.paths,p={};if(w(e,function(e){var t=Wu(l.zrId),e=(t.animation=!0,Zu(e,{},t,!0),t.cssAnims),r=t.cssNodes,t=U(e),n=t.length;if(n){var o,i,a=e[c=t[n-1]];for(o in a){var s=a[o];p[o]=p[o]||{d:""},p[o].d+=s.d||""}for(i in r){var d=r[i].animation;0<=d.indexOf(c)&&(u=d)}}}),u)return t.d=!1,e=Ju(p,l),u.replace(c,e)}(k,x,M))r.push(o);else if(!t)return}else if(!t)return;for(var n,o,i,a={},s=0;s<t;s++){var d=e[s],l=[d.getMaxTime()/1e3+"s"],u=Qu(d.getClip().easing),c=d.getDelay(),u=(l.push(u||"linear"),c&&l.push(c/1e3+"s"),d.getLoop()&&l.push("infinite"),l.join(" "));a[u]=a[u]||[u,[]],a[u][1].push(d)}function p(e){var t=e[1],r=t.length,n={},o={},i={},f="animation-timing-function";function a(e,t,r){for(var n=e.getTracks(),o=e.getMaxTime(),i=0;i<n.length;i++){var a=n[i];if(a.needsAnimate()){var s=a.keyframes,d=a.propName;if(d=r?r(d):d)for(var l=0;l<s.length;l++){var u=s[l],c=Math.round(u.time/o*100)+"%",p=Qu(u.easing),h=u.rawValue;(ge(h)||ye(h))&&(t[c]=t[c]||{},t[c][d]=u.rawValue,p)&&(t[c][f]=p)}}}}for(var s,d,l=0;l<r;l++)(E=(w=t[l]).targetName)?"shape"===E&&a(w,o):A||a(w,n);for(S in n){var u={},c=(ao(u,k),O(u,n[S]),tn(u)),p=n[S][f];i[S]=c?{transform:c}:{},c=i[S],s=void 0,s=(u=u).originX,u=u.originY,(s||u)&&(c[Ku]=s+"px "+u+"px"),p&&(i[S][f]=p)}var h,m,g,y=!0;for(S in o){i[S]=i[S]||{};var v=!d,p=o[S][f],b=(d=v?new Ei:d).len(),_=(d.reset(),i[S].d=(m=o[S],g=d,_=void 0,_=O({},(h=k).shape),O(_,m),h.buildPath(g,_),(m=new Au).reset(en(h)),g.rebuildPath(m,1),m.generateStr(),m.getStr()),d.len());if(!v&&b!==_){y=!1;break}p&&(i[S][f]=p)}if(!y)for(var S in i)delete i[S].d;if(!A)for(var w,E,l=0;l<r;l++)"style"===(E=(w=t[l]).targetName)&&a(w,i,function(e){return Xu[e]});for(var I,T=U(i),C=!0,l=1;l<T.length;l++){var R=T[l-1],P=T[l];if(i[R][Ku]!==i[P][Ku]){C=!1;break}I=i[R][Ku]}if(C&&I){for(var S in i)i[S][Ku]&&delete i[S][Ku];x[Ku]=I}if(pe(T,function(e){return 0<U(i[e]).length}).length)return Ju(i,M)+" "+e[0]+" both"}for(n in a)(o=p(a[n]))&&r.push(o);r.length&&(i=M.zrId+"-cls-"+M.cssClassIdx++,M.cssNodes["."+i]={animation:r.join(",")},x.class=i)}var $u=Math.round;function ec(e){return e&&ge(e.src)}function tc(e){return e&&me(e.toDataURL)}function rc(T,C,R,P){Nu(function(e,t){var r,n,o,i,a,s,d,l="fill"===e||"stroke"===e;if(l&&(c=t)&&("linear"===c.type||"radial"===c.type)){var u,c=T,p=e,h=P,f={gradientUnits:(w=(w=C)[p]).global?"userSpaceOnUse":"objectBoundingBox"};if(Qr(w))u="linearGradient",f.x1=w.x,f.y1=w.y,f.x2=w.x2,f.y2=w.y2;else{if(!Zr(w))return void ne("Illegal gradient type.");u="radialGradient",f.cx=A(w.x,.5),f.cy=A(w.y,.5),f.r=A(w.r,.5)}for(var m=w.colorStops,g=[],y=0,v=m.length;y<v;++y){var b=100*Kr(m[y].offset)+"%",_=Wr(m[y].color),S=_.color,_=_.opacity,b={offset:b};b["stop-color"]=S,_<1&&(b["stop-opacity"]=_),g.push(k("stop",y+"",b))}var w=Gu(k(u,"",f,g)),E=h.gradientCache,I=E[w];I||(I=h.zrId+"-g"+h.gradientIdx++,E[w]=I,f.id=I,h.defs[I]=k(u,I,f,g)),c[p]=$r(I)}else l&&(Jr(E=t)||(E=E)&&!!E.svgElement)?(w=T,h=e,u=P,c=(f=R).style[h],p={patternUnits:"userSpaceOnUse"},Jr(c)?(o=c.imageWidth,i=c.imageHeight,a=void 0,ge(d=c.image)?a=d:ec(d)?a=d.src:tc(d)&&(a=d.toDataURL()),"undefined"==typeof Image?(Pe(o,d="Image width/height must been given explictly in svg-ssr renderer."),Pe(i,d)):null!=o&&null!=i||(s=function(e,t){var r,n;e&&(r=e.elm,n=e.attrs.width=o||t.width,e=e.attrs.height=i||t.height,r)&&(r.setAttribute("width",n),r.setAttribute("height",e))},(d=bd(a,null,f,function(e){s(n,e),s(r,e)}))&&d.width&&d.height&&(o=o||d.width,i=i||d.height)),r=k("image","img",{href:a,width:o,height:i}),p.width=o,p.height=i):c.svgElement&&(r=oe(c.svgElement),p.width=c.svgWidth,p.height=c.svgHeight),r&&(p.patternTransform=tn(c),n=k("pattern","",p,[r]),f=Gu(n),d=u.patternCache,(a=d[f])||(a=u.zrId+"-p"+u.patternIdx++,d[f]=a,p.id=a,n=u.defs[a]=k("pattern",a,p,[r])),w[h]=$r(a))):T[e]=t},C,R,!1);var e=T,t=P;if(function(e){return e&&(e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY)}(u=(i=R).style)){var r=function(e){var t=e.style,e=e.getGlobalScale();return[t.shadowColor,(t.shadowBlur||0).toFixed(2),(t.shadowOffsetX||0).toFixed(2),(t.shadowOffsetY||0).toFixed(2),e[0],e[1]].join(",")}(i),n=t.shadowCache,o=n[r];if(!o){var i=i.getGlobalScale(),a=i[0],i=i[1];if(!a||!i)return;var s=u.shadowOffsetX||0,d=u.shadowOffsetY||0,l=u.shadowBlur,u=Wr(u.shadowColor),c=u.opacity,u=u.color,l=l/2/a+" "+l/2/i;o=t.zrId+"-s"+t.shadowIdx++,t.defs[o]=k("filter",o,{id:o,x:"-100%",y:"-100%",width:"300%",height:"300%"},[k("feDropShadow","",{dx:s/a,dy:d/i,stdDeviation:l,"flood-color":u,"flood-opacity":c})]),n[r]=o}e.filter=$r(o)}}function nc(e){return zr(e[0]-1)&&zr(e[1])&&zr(e[2])&&zr(e[3]-1)}function oc(e,t,r){var n;!t||zr((n=t)[4])&&zr(n[5])&&nc(t)||(n=r?10:1e4,e.transform=nc(t)?"translate("+$u(t[4]*n)/n+" "+$u(t[5]*n)/n+")":"matrix("+Yr((r=t)[0])+","+Yr(r[1])+","+Yr(r[2])+","+Yr(r[3])+","+Kr(r[4])+","+Kr(r[5])+")")}function ic(e,t,r){for(var n=e.points,o=[],i=0;i<n.length;i++)o.push($u(n[i][0]*r)/r),o.push($u(n[i][1]*r)/r);t.points=o.join(" ")}function ac(e){return!e.smooth}var sc,dc={circle:[(sc=L(["cx","cy","r"],function(e){return"string"==typeof e?[e,e]:e}),function(e,t,r){for(var n=0;n<sc.length;n++){var o=sc[n],i=e[o[0]];null!=i&&(t[o[1]]=$u(i*r)/r)}})],polyline:[ic,ac],polygon:[ic,ac]};function lc(e,t){var r,n,o,i=e.style,a=e.shape,s=dc[e.type],d={},l=t.animation,u="path",c=e.style.strokePercent,p=t.compress&&en(e)||4;return!s||t.willUpdate||s[1]&&!s[1](a)||l&&function(e){for(var t=e.animators,r=0;r<t.length;r++)if("shape"===t[r].targetName)return 1}(e)||c<1?(e.path||e.createPathProxy(),l=e.path,e.shapeChanged()&&(l.beginPath(),e.buildPath(l,e.shape),e.pathUpdated()),r=l.getVersion(),o=(n=e).__svgPathBuilder,n.__svgPathVersion===r&&o&&c===n.__svgPathStrokePercent||((o=o||(n.__svgPathBuilder=new Au)).reset(p),l.rebuildPath(o,c),o.generateStr(),n.__svgPathVersion=r,n.__svgPathStrokePercent=c),d.d=o.getStr()):(u=e.type,l=Math.pow(10,p),s[0](a,d,l)),oc(d,e.transform),rc(d,i,e,t),t.animation&&Zu(e,d,t),k(u,e.id+"",d)}function uc(e,t){if(e instanceof J)return lc(e,t);if(e instanceof ma){var r=e,n=t,o=r.style,i=o.image;if(i&&!ge(i)&&(ec(i)?i=i.src:tc(i)&&(i=i.toDataURL())),i)return a=o.x||0,s=o.y||0,i={href:i,width:o.width,height:o.height},a&&(i.x=a),s&&(i.y=s),oc(i,r.transform),rc(i,o,r,n),n.animation&&Zu(r,i,n),k("image",r.id+"",i)}else if(e instanceof ns){var a=e,s=t,o=a.style,n=o.text;if(null!=n&&(n+=""),n&&!isNaN(o.x)&&!isNaN(o.y)){var r=o.font||Q,i=o.x||0,d=(e=o.y||0,t=So(r),"top"===(d=o.textBaseline)?e+=t/2:"bottom"===d&&(e-=t/2),e),t={"dominant-baseline":"central","text-anchor":Xr[o.textAlign]||o.textAlign};if(Vd(o)){var e="",l=o.fontStyle,u=Bd(o.fontSize);if(!parseFloat(u))return;var c=o.fontFamily||T,p=o.fontWeight;e+="font-size:"+u+";font-family:"+c+";",l&&"normal"!==l&&(e+="font-style:"+l+";"),p&&"normal"!==p&&(e+="font-weight:"+p+";"),t.style=e}else t.style="font: "+r;return n.match(/\s/)&&(t["xml:space"]="preserve"),i&&(t.x=i),d&&(t.y=d),oc(t,a.transform),rc(t,o,a,s),s.animation&&Zu(a,t,s),k("text",a.id+"",t,void 0,n)}}}function cc(e){return document.createTextNode(e)}function pc(e,t,r){e.insertBefore(t,r)}function hc(e,t){e.removeChild(t)}function fc(e,t){e.appendChild(t)}function mc(e){return e.parentNode}function gc(e){return e.nextSibling}function yc(e,t){e.textContent=t}var vc=58,bc=120,_c=k("","");function Sc(e){return void 0===e}function wc(e){return void 0!==e}function Ec(e,t){var r=e.key===t.key;return e.tag===t.tag&&r}function Ic(e){var t,r=e.children,n=e.tag;if(wc(n)){var o=e.elm=qu(n);if(Rc(_c,e),fe(r))for(t=0;t<r.length;++t){var i=r[t];null!=i&&fc(o,Ic(i))}else wc(e.text)&&!ve(e.text)&&fc(o,cc(e.text))}else e.elm=cc(e.text);return e.elm}function Tc(e,t,r,n,o){for(;n<=o;++n){var i=r[n];null!=i&&pc(e,Ic(i),t)}}function Cc(e,t,r,n){for(;r<=n;++r){var o=t[r];null!=o&&(wc(o.tag)?hc(mc(o.elm),o.elm):hc(e,o.elm))}}function Rc(e,t){var r,n=t.elm,o=e&&e.attrs||{},i=t.attrs||{};if(o!==i){for(r in i){var a=i[r];o[r]!==a&&(!0===a?n.setAttribute(r,""):!1===a?n.removeAttribute(r):r.charCodeAt(0)!==bc?n.setAttribute(r,a):"xmlns:xlink"===r||"xmlns"===r?n.setAttributeNS(Vu,r,a):r.charCodeAt(3)===vc?n.setAttributeNS(Fu,r,a):r.charCodeAt(5)===vc?n.setAttributeNS(ju,r,a):n.setAttribute(r,a))}for(r in o)r in i||n.removeAttribute(r)}}function Pc(e,t,r){for(var n,o,i,a=0,s=0,d=t.length-1,l=t[0],u=t[d],c=r.length-1,p=r[0],h=r[c];a<=d&&s<=c;)null==l?l=t[++a]:null==u?u=t[--d]:null==p?p=r[++s]:null==h?h=r[--c]:Ec(l,p)?(kc(l,p),l=t[++a],p=r[++s]):Ec(u,h)?(kc(u,h),u=t[--d],h=r[--c]):Ec(l,h)?(kc(l,h),pc(e,l.elm,gc(u.elm)),l=t[++a],h=r[--c]):p=(Ec(u,p)?(kc(u,p),pc(e,u.elm,l.elm),u=t[--d]):(Sc(n)&&(n=function(e,t,r){for(var n={},o=t;o<=r;++o){var i=e[o].key;void 0!==i&&(null!=n[i]&&console.error("Duplicate key "+i),n[i]=o)}return n}(t,a,d)),Sc(o=n[p.key])||(i=t[o]).tag!==p.tag?pc(e,Ic(p),l.elm):(kc(i,p),t[o]=void 0,pc(e,i.elm,l.elm))),r[++s]);(a<=d||s<=c)&&(d<a?Tc(e,null==r[c+1]?null:r[c+1].elm,r,s,c):Cc(e,t,a,d))}function kc(e,t){var r=t.elm=e.elm,n=e.children,o=t.children;e!==t&&(Rc(e,t),Sc(t.text)?wc(n)&&wc(o)?n!==o&&Pc(r,n,o):wc(o)?(wc(e.text)&&yc(r,""),Tc(r,null,o,0,o.length-1)):wc(n)?Cc(r,n,0,n.length-1):wc(e.text)&&yc(r,""):e.text!==t.text&&(wc(n)&&Cc(r,n,0,n.length-1),yc(r,t.text)))}var xc=0,Mc=(_.prototype.getType=function(){return this.type},_.prototype.getViewportRoot=function(){return this._viewport},_.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},_.prototype.getSvgDom=function(){return this._svgDom},_.prototype.refresh=function(){var e,t,r,n,o;this.root&&((e=this.renderToVNode({willUpdate:!0})).attrs.style="position:absolute;left:0;top:0;user-select:none",Ec(t=this._oldVNode,r=e)?kc(t,r):(o=mc(n=t.elm),Ic(r),null!==o&&(pc(o,r.elm,gc(n)),Cc(o,[t],0,0))),this._oldVNode=e)},_.prototype.renderOneToVNode=function(e){return uc(e,Wu(this._id))},_.prototype.renderToVNode=function(e){e=e||{};var r,o,i,a,s,t=this.storage.getDisplayList(!0),n=this._backgroundColor,d=this._width,l=this._height,u=Wu(this._id),c=(u.animation=e.animation,u.willUpdate=e.willUpdate,u.compress=e.compress,[]),p=(n&&"none"!==n?(p=(n=Wr(n)).color,n=n.opacity,this._bgVNode=k("rect","bg",{width:d,height:l,x:"0",y:"0",id:"0",fill:p,"fill-opacity":n}),c.push(this._bgVNode)):this._bgVNode=null,e.compress?null:this._mainVNode=k("g","main",{},[])),n=(this._paintList(t,u,p?p.children:c),p&&c.push(p),L(U(u.defs),function(e){return u.defs[e]}));return n.length&&c.push(k("defs","defs",{},n)),e.animation&&(r=u.cssNodes,o=u.cssAnims,i=(t=(t={newline:!0})||{}).newline?"\n":"",a=" {"+i,s=i+"}",t=L(U(r),function(t){return t+a+L(U(r[t]),function(e){return e+":"+r[t][e]+";"}).join(i)+s}).join(i),p=L(U(o),function(n){return"@keyframes "+n+a+L(U(o[n]),function(r){return r+a+L(U(o[n][r]),function(e){var t=o[n][r][e];return e+":"+(t="d"===e?'path("'+t+'")':t)+";"}).join(i)+s}).join(i)+s}).join(i),n=t||p?["<![CDATA[",t,p,"]]>"].join(i):"")&&(t=k("style","stl",{},[],n),c.push(t)),zu(d,l,c,e.useViewBox)},_.prototype.renderToString=function(e){return Gu(this.renderToVNode({animation:A((e=e||{}).cssAnimation,!0),willUpdate:!1,compress:!0,useViewBox:A(e.useViewBox,!0)}),{newline:!0})},_.prototype.setBackgroundColor=function(e){this._backgroundColor=e;var t,r=this._bgVNode;r&&r.elm&&(t=(e=Wr(e)).color,e=e.opacity,r.elm.setAttribute("fill",t),e<1)&&r.elm.setAttribute("fill-opacity",e)},_.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},_.prototype._paintList=function(e,t,r){for(var n,o,i,a,s,d,l,u=e.length,c=[],p=0,h=0,f=0;f<u;f++){var m=e[f];if(!m.invisible){for(var g=m.__clipPaths,y=g&&g.length||0,v=I&&I.length||0,b=void 0,b=Math.max(y-1,v-1);0<=b&&(!g||!I||g[b]!==I[b]);b--);for(var _=v-1;b<_;_--)n=c[--p-1];for(var S=b+1;S<y;S++){var w={},E=(o=g[S],i=w,l=E=d=s=void 0,d=(a=t).clipPathCache,E=a.defs,(l=d[o.id])||(s={id:l=a.zrId+"-c"+a.clipPathIdx++},E[d[o.id]=l]=k("clipPath",l,s,[lc(o,a)])),i["clip-path"]=$r(l),k("g","clip-g-"+h++,w,[]));(n?n.children:r).push(E),n=c[p++]=E}var I=g,v=uc(m,t);v&&(n?n.children:r).push(v)}}},_.prototype.resize=function(e,t){var r=this._opts,n=this.root,o=this._viewport;null!=e&&(r.width=e),null!=t&&(r.height=t),n&&o&&(o.style.display="none",e=tu(n,0,r),t=tu(n,1,r),o.style.display=""),(this._width!==e||this._height!==t)&&(this._width=e,this._height=t,o&&((n=o.style).width=e+"px",n.height=t+"px"),r=this._svgDom)&&(r.setAttribute("width",e),r.setAttribute("height",t))},_.prototype.getWidth=function(){return this._width},_.prototype.getHeight=function(){return this._height},_.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},_.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},_.prototype.toDataURL=function(e){var t=encodeURIComponent(this.renderToString()),r="data:image/svg+xml;";return e?(t=rn(t))&&r+"base64,"+t:r+"charset=UTF-8,"+t},_);function _(e,t,r){var n;this.type="svg",this.refreshHover=Ac("refreshHover"),this.configLayer=Ac("configLayer"),this.storage=t,this._opts=r=O({},r),this.root=e,this._id="zr"+xc++,this._oldVNode=zu(r.width,r.height),e&&!r.ssr&&((t=this._viewport=document.createElement("div")).style.cssText="position:relative;overflow:hidden",n=this._svgDom=this._oldVNode.elm=qu("svg"),Rc(null,this._oldVNode),t.appendChild(n),e.appendChild(t)),this.resize(r.width,r.height)}function Ac(e){return function(){ne('In SVG mode painter not support method "'+e+'"')}}Vo("canvas",at),Vo("svg",Mc),e.Arc=Jd,e.ArcShape=Xd,e.BezierCurve=rl,e.BezierCurveShape=$d,e.BoundingRect=Y,e.Circle=ba,e.CircleShape=va,e.CompoundPath=hd,e.Displayable=p,e.Droplet=al,e.DropletShape=il,e.Element=d,e.Ellipse=xa,e.EllipseShape=ka,e.Group=Lo,e.Heart=ul,e.HeartShape=ll,e.Image=ma,e.IncrementalDisplayable=yd,e.Isogon=yl,e.IsogonShape=gl,e.Line=Da,e.LineShape=Ua,e.LinearGradient=Xa,e.OrientedBoundingRect=Kl,e.Path=J,e.Pattern=ql,e.Point=S,e.Polygon=ja,e.PolygonShape=Ba,e.Polyline=Ga,e.PolylineShape=qa,e.RadialGradient=Za,e.Rect=Ca,e.RectShape=Ia,e.Ring=Sl,e.RingShape=_l,e.Rose=Pl,e.RoseShape=Rl,e.Sector=Bs,e.SectorShape=Ns,e.Star=Dl,e.StarShape=Ul,e.TSpan=ns,e.Text=Dd,e.Arrowline=Fi,e.Trochoid=Vl,e.TrochoidShape=jl,e.color=qr,e.dispose=function(e){e.dispose()},e.disposeAll=function(){for(var e in Bo)Bo.hasOwnProperty(e)&&Bo[e].dispose();Bo={}},e.getInstance=function(e){return Bo[e]},e.init=function(e,t){return e=new jo(te++,e,t),Bo[e.id]=e},e.matrix=jn,e.morph=za,e.parseSVG=function(e,t){return(new ls).parse(e,t)},e.path=ca,e.registerPainter=Vo,e.setPlatformAPI=function(e){for(var t in M)e[t]&&(M[t]=e[t])},e.showDebugDirtyRect=function(e,o){o=o||{};var t=e.painter;if(!t.getLayers)throw new Error("Debug dirty rect can only been used on canvas renderer.");if(t.isSingleCanvas())throw new Error("Debug dirty rect can only been used on zrender inited with container.");var i=document.createElement("div"),a=(i.style.cssText="\nposition:absolute;\nleft:0;\ntop:0;\nright:0;\nbottom:0;\npointer-events:none;\n",i.className="ec-debug-dirty-rect-container",[]),r=e.dom;r.appendChild(i),"static"===getComputedStyle(r).position&&(r.style.position="relative"),e.on("rendered",function(){if(t.getLayers){var n=0;t.eachBuiltinLayer(function(e){if(e.debugGetPaintRects)for(var t=e.debugGetPaintRects(),r=0;r<t.length;r++)t[r].width&&t[r].height&&(a[n]||(a[n]=new Jl(o.style),i.appendChild(a[n].dom)),a[n].show(o.autoHideDelay),a[n].update(t[r]),n++)});for(var e=n;e<a.length;e++)a[e].hide()}})},e.util=t,e.vector=rt,e.version="5.3.2",Object.defineProperty(e,"__esModule",{value:!0})}),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mqtt=e()}(function(){return function n(o,i,a){function s(t,e){if(!i[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=i[t]={exports:{}},o[t][0].call(r.exports,function(e){return s(o[t][1][e]||e)},r,r.exports,n,o,i,a)}return i[t].exports}for(var d="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(y,v,e){!function(s,e){"use strict";var n=y("events"),i=y("./store"),d=y("mqtt-packet"),l=y("readable-stream").Writable,t=y("inherits"),r=y("reinterval"),c=y("./validations"),p=y("xtend"),h=e.setImmediate||function(e){s.nextTick(e)},a={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},u={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",6:"User repeat login",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function f(e,t,r){e.emit("packetsend",t),!d.writeToStream(t,e.stream,e.options)&&r?e.stream.once("drain",r):r&&r()}function o(t,r,n,o){t.outgoingStore.put(r,function(e){if(e)return n&&n(e);o(),f(t,r,n)})}function m(){}function g(e,t){var r,o=this;if(!(this instanceof g))return new g(e,t);for(r in this.options=t||{},a)void 0===this.options[r]?this.options[r]=a[r]:this.options[r]=t[r];this.options.clientId="string"==typeof t.clientId?t.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),this.options.customHandleAcks=5===t.protocolVersion&&t.customHandleAcks?t.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=e,this.outgoingStore=t.outgoingStore||new i,this.incomingStore=t.incomingStore||new i,this.queueQoSZero=void 0===t.queueQoSZero||t.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("close",function(){this.connected=!1,clearTimeout(this.connackTimer)}),this.on("connect",function(){var n=this.queue;!function t(){var e,r=n.shift();r&&(e=r.packet,o._sendPacket(e,function(e){r.cb&&r.cb(e),t()}))}()}),this.on("close",function(){null!==o.pingTimer&&(o.pingTimer.clear(),o.pingTimer=null)}),this.on("close",this._setupReconnect),n.EventEmitter.call(this),this._setupStream()}t(g,n.EventEmitter),g.prototype._setupStream=function(){var r=this,e=new l,n=d.parser(this.options),o=null,t=[];function i(){var e;t.length?s.nextTick(a):(e=o,o=null,e())}function a(){var e=t.shift();e?r._handlePacket(e,i):(e=o,o=null,e&&e())}if(this._clearReconnect(),this.stream=this.streamBuilder(this),n.on("packet",function(e){t.push(e)}),e._write=function(e,t,r){o=r,n.parse(e),a()},this.stream.pipe(e),this.stream.on("error",m),this.stream.on("close",function(){var t;(t=r.outgoing)&&Object.keys(t).forEach(function(e){t[e].volatile&&"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])}),r.emit("close")}),(e=Object.create(this.options)).cmd="connect",f(this,e),n.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.emit("error",new Error("Packet has no Authentication Method")),this;this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket&&f(this,p({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){r._cleanUp(!0)},this.options.connectTimeout)},g.prototype._handlePacket=function(e,t){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<e.length)return this.emit("error",new Error("exceeding packets size "+e.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(this.emit("packetreceive",e),e.cmd){case"publish":this._handlePublish(e,t);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(e),t();break;case"pubrel":this._handlePubrel(e,t);break;case"connack":this._handleConnack(e),t();break;case"pingresp":this._handlePingresp(e),t();break;case"disconnect":this._handleDisconnect(e),t()}},g.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},g.prototype.publish=function(e,t,r,n){var o,i=this.options;"function"==typeof r&&(n=r,r=null);if(r=p({qos:0,retain:!1,dup:!1},r),!this._checkDisconnecting(n))switch(o={cmd:"publish",topic:e,payload:t,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===i.protocolVersion&&(o.properties=r.properties,!i.properties&&o.properties&&o.properties.topicAlias||r.properties&&i.properties&&(r.properties.topicAlias&&i.properties.topicAliasMaximum&&r.properties.topicAlias>i.properties.topicAliasMaximum||!i.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete o.properties.topicAlias,r.qos){case 1:case 2:this.outgoing[o.messageId]={volatile:!1,cb:n||m},this._storeProcessing?(this._packetIdsDuringStoreProcessing[o.messageId]=!1,this._storePacket(o,void 0,r.cbStorePut)):this._sendPacket(o,void 0,r.cbStorePut);break;default:this._storeProcessing?this._storePacket(o,n,r.cbStorePut):this._sendPacket(o,n,r.cbStorePut)}return this},g.prototype.subscribe=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,o=[],i=e.shift(),a=i.resubscribe,s=e.pop()||m,d=e.pop(),l=this,u=this.options.protocolVersion;return delete i.resubscribe,"string"==typeof i&&(i=[i]),"function"!=typeof s&&(d=s,s=m),null!==(r=c.validateTopics(i))?(h(s,new Error("Invalid topic "+r)),this):this._checkDisconnecting(s)?this:(r={qos:0},5===u&&(r.nl=!1,r.rap=!1,r.rh=0),d=p(r,d),Array.isArray(i)?i.forEach(function(e){(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<d.qos||a)&&(e={topic:e,qos:d.qos},5===u&&(e.nl=d.nl,e.rap=d.rap,e.rh=d.rh,e.properties=d.properties),o.push(e))}):Object.keys(i).forEach(function(e){var t;(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<i[e].qos||a)&&(t={topic:e,qos:i[e].qos},5===u&&(t.nl=i[e].nl,t.rap=i[e].rap,t.rh=i[e].rh,t.properties=d.properties),o.push(t))}),r={cmd:"subscribe",subscriptions:o,qos:1,retain:!1,dup:!1,messageId:this._nextId()},d.properties&&(r.properties=d.properties),o.length?(this.options.resubscribe&&(n=[],o.forEach(function(e){var t;0<l.options.reconnectPeriod&&(t={qos:e.qos},5===u&&(t.nl=e.nl||!1,t.rap=e.rap||!1,t.rh=e.rh||0,t.properties=e.properties),l._resubscribeTopics[e.topic]=t,n.push(e.topic))}),l.messageIdToTopic[r.messageId]=n),this.outgoing[r.messageId]={volatile:!0,cb:function(e,t){if(!e)for(var r=t.granted,n=0;n<r.length;n+=1)o[n].qos=r[n];s(e,o)}},this._sendPacket(r),this):void s(null,[]))},g.prototype.unsubscribe=function(){for(var e={cmd:"unsubscribe",qos:1,messageId:this._nextId()},t=this,r=new Array(arguments.length),n=0;n<arguments.length;n++)r[n]=arguments[n];var o=r.shift(),i=r.pop()||m,a=r.pop();return"string"==typeof o&&(o=[o]),"function"!=typeof i&&(a=i,i=m),this._checkDisconnecting(i)||("string"==typeof o?e.unsubscriptions=[o]:"object"==typeof o&&o.length&&(e.unsubscriptions=o),this.options.resubscribe&&e.unsubscriptions.forEach(function(e){delete t._resubscribeTopics[e]}),"object"==typeof a&&a.properties&&(e.properties=a.properties),this.outgoing[e.messageId]={volatile:!0,cb:i},this._sendPacket(e)),this},g.prototype.end=function(){var e=this,t=arguments[0],r=arguments[1],n=arguments[2];function o(){e.disconnected=!0,e.incomingStore.close(function(){e.outgoingStore.close(function(){n&&n.apply(null,arguments),e.emit("end")})}),e._deferredReconnect&&e._deferredReconnect()}function i(){e._cleanUp(t,h.bind(null,o),r)}return null!=t&&"boolean"==typeof t||(n=r||m,r=t,t=!1,"object"!=typeof r&&(n=r,r=null,"function"!=typeof n)&&(n=m)),"object"!=typeof r&&(n=r,r=null),n=n||m,this.disconnecting||(this._clearReconnect(),this.disconnecting=!0,!t&&0<Object.keys(this.outgoing).length?this.once("outgoingEmpty",setTimeout.bind(null,i,10)):i()),this},g.prototype.removeOutgoingMessage=function(e){var t=this.outgoing[e]?this.outgoing[e].cb:null;return delete this.outgoing[e],this.outgoingStore.del({messageId:e},function(){t(new Error("Message removed"))}),this},g.prototype.reconnect=function(e){function t(){e?(r.options.incomingStore=e.incomingStore,r.options.outgoingStore=e.outgoingStore):(r.options.incomingStore=null,r.options.outgoingStore=null),r.incomingStore=r.options.incomingStore||new i,r.outgoingStore=r.options.outgoingStore||new i,r.disconnecting=!1,r.disconnected=!1,r._deferredReconnect=null,r._reconnect()}var r=this;return this.disconnecting&&!this.disconnected?this._deferredReconnect=t:t(),this},g.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},g.prototype._setupReconnect=function(){var e=this;!e.disconnecting&&!e.reconnectTimer&&0<e.options.reconnectPeriod&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),e.reconnectTimer=setInterval(function(){e._reconnect()},e.options.reconnectPeriod))},g.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},g.prototype._cleanUp=function(e,t){var r,n=arguments[2];t&&this.stream.on("close",t),e?(0===this.options.reconnectPeriod&&this.options.clean&&(r=this.outgoing)&&Object.keys(r).forEach(function(e){"function"==typeof r[e].cb&&(r[e].cb(new Error("Connection closed")),delete r[e])}),this.stream.destroy()):(e=p({cmd:"disconnect"},n),this._sendPacket(e,h.bind(null,this.stream.end.bind(this.stream)))),this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),t&&!this.connected&&(this.stream.removeListener("close",t),t())},g.prototype._sendPacket=function(e,t,r){if(r=r||m,this.connected){switch(this._shiftPingInterval(),e.cmd){case"publish":break;case"pubrel":return void o(this,e,t,r);default:return void f(this,e,t)}switch(e.qos){case 2:case 1:o(this,e,t,r);break;default:f(this,e,t)}}else this._storePacket(e,t,r)},g.prototype._storePacket=function(e,t,r){r=r||m,0===(e.qos||0)&&this.queueQoSZero||"publish"!==e.cmd?this.queue.push({packet:e,cb:t}):0<e.qos?(t=this.outgoing[e.messageId]?this.outgoing[e.messageId].cb:null,this.outgoingStore.put(e,function(e){if(e)return t&&t(e);r()})):t&&t(new Error("No connection to broker"))},g.prototype._setupPingTimer=function(){var e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=r(function(){e._checkPing()},1e3*this.options.keepalive))},g.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},g.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},g.prototype._handlePingresp=function(){this.pingResp=!0},g.prototype._handleConnack=function(e){var t=this.options,r=5===t.protocolVersion?e.reasonCode:e.returnCode;clearTimeout(this.connackTimer),e.properties&&(e.properties.topicAliasMaximum&&(t.properties||(t.properties={}),t.properties.topicAliasMaximum=e.properties.topicAliasMaximum),e.properties.serverKeepAlive&&t.keepalive&&(t.keepalive=e.properties.serverKeepAlive,this._shiftPingInterval()),e.properties.maximumPacketSize)&&(t.properties||(t.properties={}),t.properties.maximumPacketSize=e.properties.maximumPacketSize),0===r?(this.reconnecting=!1,this._onConnect(e)):0<r&&((t=new Error("Connection refused: "+u[r])).code=r,this.emit("error",t))},g.prototype._handlePublish=function(r,n){n=void 0!==n?n:m;var o=r.topic.toString(),i=r.payload,e=r.qos,a=r.messageId,s=this,t=this.options,d=[0,16,128,131,135,144,145,151,153];switch(e){case 2:t.customHandleAcks(o,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?s.emit("error",e):-1===d.indexOf(t)?s.emit("error",new Error("Wrong reason code for pubrec")):void(t?s._sendPacket({cmd:"pubrec",messageId:a,reasonCode:t},n):s.incomingStore.put(r,function(){s._sendPacket({cmd:"pubrec",messageId:a},n)}))});break;case 1:t.customHandleAcks(o,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?s.emit("error",e):-1===d.indexOf(t)?s.emit("error",new Error("Wrong reason code for puback")):(t||s.emit("message",o,i,r),void s.handleMessage(r,function(e){if(e)return n&&n(e);s._sendPacket({cmd:"puback",messageId:a,reasonCode:t},n)}))});break;case 0:this.emit("message",o,i,r),this.handleMessage(r,n)}},g.prototype.handleMessage=function(e,t){t()},g.prototype._handleAck=function(e){var t,r=e.messageId,n=e.cmd,o=this.outgoing[r]?this.outgoing[r].cb:null,i=this;if(o){switch(n){case"pubcomp":case"puback":var a=e.reasonCode;a&&0<a&&16!==a&&((t=new Error("Publish error: "+u[a])).code=a,o(t,e)),delete this.outgoing[r],this.outgoingStore.del(e,o);break;case"pubrec":var a={cmd:"pubrel",qos:2,messageId:r},s=e.reasonCode;s&&0<s&&16!==s?((t=new Error("Publish error: "+u[s])).code=s,o(t,e)):this._sendPacket(a);break;case"suback":delete this.outgoing[r];for(var d,l=0;l<e.granted.length;l++)0!=(128&e.granted[l])&&(d=this.messageIdToTopic[r])&&d.forEach(function(e){delete i._resubscribeTopics[e]});o(null,e);break;case"unsuback":delete this.outgoing[r],o(null);break;default:i.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},g.prototype._handlePubrel=function(e,r){r=void 0!==r?r:m;var t=e.messageId,n=this,o={cmd:"pubcomp",messageId:t};n.incomingStore.get(e,function(e,t){e?n._sendPacket(o,r):(n.emit("message",t.topic,t.payload,t),n.handleMessage(t,function(e){if(e)return r(e);n.incomingStore.del(t,m),n._sendPacket(o,r)}))})},g.prototype._handleDisconnect=function(e){this.emit("disconnect",e)},g.prototype._nextId=function(){var e=this.nextId++;return 65536===this.nextId&&(this.nextId=1),e},g.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},g.prototype._resubscribe=function(e){var t=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!e.sessionPresent)&&0<t.length)if(this.options.resubscribe)if(5===this.options.protocolVersion)for(var r=0;r<t.length;r++){var n={};n[t[r]]=this._resubscribeTopics[t[r]],n.resubscribe=!0,this.subscribe(n,{properties:n[t[r]].properties})}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},g.prototype._onConnect=function(i){var a;this.disconnected?this.emit("connect",i):((a=this)._setupPingTimer(),this._resubscribe(i),this.connected=!0,function r(){var t=a.outgoingStore.createStream();function n(){a._storeProcessing=!1,a._packetIdsDuringStoreProcessing={}}function o(){t.destroy(),t=null,n()}a.once("close",o),t.on("error",function(e){n(),a.removeListener("close",o),a.emit("error",e)}),t.on("end",function(){var e,t=!0;for(e in a._packetIdsDuringStoreProcessing)if(!a._packetIdsDuringStoreProcessing[e]){t=!1;break}t?(n(),a.removeListener("close",o),a.emit("connect",i)):r()}),function r(){var e,n;t&&(a._storeProcessing=!0,(e=t.read(1))?a._packetIdsDuringStoreProcessing[e.messageId]?r():a.disconnecting||a.reconnectTimer?t.destroy&&t.destroy():(n=a.outgoing[e.messageId]?a.outgoing[e.messageId].cb:null,a.outgoing[e.messageId]={volatile:!1,cb:function(e,t){n&&n(e,t),r()}},a._packetIdsDuringStoreProcessing[e.messageId]=!0,a._sendPacket(e)):t.once("readable",r))}()}())},v.exports=g}.call(this,y("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:92,events:13,inherits:80,"mqtt-packet":84,"readable-stream":108,reinterval:109,xtend:121}],2:[function(e,t,r){!function(a){"use strict";var s,d,l,u=e("readable-stream").Transform,c=e("duplexify"),p=e("base64-js"),h=!1;t.exports=function(e,t){var r,n,o,i;if(t.hostname=t.hostname||t.host,t.hostname)return r="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt",(n=t).hostname||(n.hostname="localhost"),n.path||(n.path="/"),n.wsOptions||(n.wsOptions={}),n=e,o="alis"===(e=t).protocol?"wss":"ws",i=o+"://"+e.hostname+e.path,e.port&&80!==e.port&&443!==e.port&&(i=o+"://"+e.hostname+":"+e.port+e.path),o=i="function"==typeof e.transformWsUrl?e.transformWsUrl(i,e,n):i,(s=t.my).connectSocket({url:o,protocols:r}),(e=new u)._write=function(e,t,r){s.sendSocketMessage({data:e.buffer,success:function(){r()},fail:function(){r(new Error)}})},e._flush=function(e){s.closeSocket({success:function(){e()}})},d=e,l=c.obj(),h||(h=!0,s.onSocketOpen(function(){l.setReadable(d),l.setWritable(d),l.emit("connect")}),s.onSocketMessage(function(e){var t,r;"string"==typeof e.data?(t=p.toByteArray(e.data),t=a.from(t),d.push(t)):((r=new FileReader).addEventListener("load",function(){var e=(e=r.result)instanceof ArrayBuffer?a.from(e):a.from(e,"utf8");d.push(e)}),r.readAsArrayBuffer(e.data))}),s.onSocketClose(function(){l.end(),l.destroy()}),s.onSocketError(function(e){l.destroy(e)})),l;throw new Error("Could not determine host. Specify host manually.")}}.call(this,e("buffer").Buffer)},{"base64-js":10,buffer:12,duplexify:17,"readable-stream":108}],3:[function(e,t,r){"use strict";var n=e("net");t.exports=function(e,t){var r;return t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",r=t.port,t=t.hostname,n.createConnection(r,t)}},{net:11}],4:[function(e,t,r){"use strict";var o=e("tls");t.exports=function(t,r){var n;function e(e){r.rejectUnauthorized&&t.emit("error",e),n.end()}return r.port=r.port||8883,r.host=r.hostname||r.host||"localhost",r.rejectUnauthorized=!1!==r.rejectUnauthorized,delete r.path,(n=o.connect(r)).on("secureConnect",function(){r.rejectUnauthorized&&!n.authorized?n.emit("error",new Error("TLS not authorized")):n.removeListener("error",e)}),n.on("error",e),n}},{tls:11}],5:[function(t,r,e){!function(e){"use strict";var a=t("websocket-stream"),n=t("url"),s=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],d="browser"===e.title;function o(e,t){var r,n,o,i="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.port||("wss"===r.protocol?r.port=443:r.port=80),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={}),d||"wss"!==r.protocol||s.forEach(function(e){r.hasOwnProperty(e)&&!r.wsOptions.hasOwnProperty(e)&&(r.wsOptions[e]=r[e])}),e=e,o=(n=t).protocol+"://"+n.hostname+":"+n.port+n.path,o="function"==typeof n.transformWsUrl?n.transformWsUrl(o,n,e):o;return a(o,[i],t.wsOptions)}r.exports=d?function(e,t){if(t.hostname||(t.hostname=t.host),!t.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");var r=n.parse(document.URL);t.hostname=r.hostname,t.port||(t.port=r.port)}return o(e,t)}:o}.call(this,t("_process"))},{_process:92,url:113,"websocket-stream":118}],6:[function(e,t,r){!function(a,s){"use strict";var d,l,u,c=e("readable-stream").Transform,p=e("duplexify");t.exports=function(e,t){var r,n,o,i;if(t.hostname=t.hostname||t.host,t.hostname)return r="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt",(n=t).hostname||(n.hostname="localhost"),n.path||(n.path="/"),n.wsOptions||(n.wsOptions={}),n=e,t="wxs"===(e=t).protocol?"wss":"ws",o=t+"://"+e.hostname+e.path,e.port&&80!==e.port&&443!==e.port&&(o=t+"://"+e.hostname+":"+e.port+e.path),t=o="function"==typeof e.transformWsUrl?e.transformWsUrl(o,e,n):o,d=wx.connectSocket({url:t,protocols:r}),(e=new c)._write=function(e,t,r){d.send({data:e.buffer,success:function(){r()},fail:function(e){r(new Error(e))}})},e._flush=function(e){d.close({success:function(){e()}})},l=e,(u=p.obj())._destroy=function(e,t){d.close({success:function(){t&&t(e)}})},i=u.destroy,u.destroy=function(){u.destroy=i;var e=this;a.nextTick(function(){d.close({fail:function(){e._destroy(new Error)}})})}.bind(u),d.onOpen(function(){u.setReadable(l),u.setWritable(l),u.emit("connect")}),d.onMessage(function(e){e=(e=e.data)instanceof ArrayBuffer?s.from(e):s.from(e,"utf8");l.push(e)}),d.onClose(function(){u.end(),u.destroy()}),d.onError(function(e){u.destroy(new Error(e.errMsg))}),u;throw new Error("Could not determine host. Specify host manually.")}}.call(this,e("_process"),e("buffer").Buffer)},{_process:92,buffer:12,duplexify:17,"readable-stream":108}],7:[function(e,d,t){!function(o){"use strict";var t=e("xtend"),i=e("readable-stream").Readable,a={objectMode:!0},r={clean:!0},n=e("es6-map");function s(e){if(!(this instanceof s))return new s(e);this.options=e||{},this.options=t(r,e),this._inflights=new n}s.prototype.put=function(e,t){return this._inflights.set(e.messageId,e),t&&t(),this},s.prototype.createStream=function(){var e=new i(a),t=!1,r=[],n=0;return this._inflights.forEach(function(e,t){r.push(e)}),e._read=function(){!t&&n<r.length?this.push(r[n++]):this.push(null)},e.destroy=function(){var e;t||(e=this,t=!0,o.nextTick(function(){e.emit("close")}))},e},s.prototype.del=function(e,t){return(e=this._inflights.get(e.messageId))?(this._inflights.delete(e.messageId),t(null,e)):t&&t(new Error("missing packet")),this},s.prototype.get=function(e,t){return(e=this._inflights.get(e.messageId))?t(null,e):t&&t(new Error("missing packet")),this},s.prototype.close=function(e){this.options.clean&&(this._inflights=null),e&&e()},d.exports=s}.call(this,e("_process"))},{_process:92,"es6-map":67,"readable-stream":108,xtend:121}],8:[function(e,t,r){"use strict";t.exports={validateTopics:function(e){if(0===e.length)return"empty_topic_list";for(var t=0;t<e.length;t++)if(!function(e){for(var t=e.split("/"),r=0;r<t.length;r++)if("+"!==t[r]){if("#"===t[r])return r===t.length-1;if(-1!==t[r].indexOf("+")||-1!==t[r].indexOf("#"))return}return 1}(e[t]))return e[t];return null}}},{}],9:[function(n,d,e){!function(e){"use strict";var o=n("../client"),t=n("../store"),i=n("url"),a=n("xtend"),s={};function r(e,t){if("object"!=typeof e||t||(t=e,e=null),t=t||{},e){e=i.parse(e,!0);if(null!=e.port&&(e.port=Number(e.port)),null===(t=a(e,t)).protocol)throw new Error("Missing protocol");t.protocol=t.protocol.replace(/:$/,"")}var r,n;if((e=t).auth&&((r=e.auth.match(/^(.+):(.+)$/))?(e.username=r[1],e.password=r[2]):e.username=e.auth),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(t.protocol))switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;case"wx":t.protocol="wxs";break;case"ali":t.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+t.protocol+'"!')}}if(s[t.protocol]||(n=-1!==["mqtts","wss"].indexOf(t.protocol),t.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(e,t){return(!n||t%2!=0)&&"function"==typeof s[e]})[0]),!1!==t.clean||t.clientId)return t.protocol&&(t.defaultProtocol=t.protocol),new o(function(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.protocol=t.servers[e._reconnectCount].protocol||t.defaultProtocol,t.hostname=t.host,e._reconnectCount++),s[t.protocol](e,t)},t);throw new Error("Missing clientId for unclean clients")}"browser"!==e.title?(s.mqtt=n("./tcp"),s.tcp=n("./tcp"),s.ssl=n("./tls"),s.tls=n("./tls"),s.mqtts=n("./tls")):(s.wx=n("./wx"),s.wxs=n("./wx"),s.ali=n("./ali"),s.alis=n("./ali")),s.ws=n("./ws"),s.wss=n("./ws"),d.exports=r,d.exports.connect=r,d.exports.MqttClient=o,d.exports.Store=t}.call(this,n("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:92,url:113,xtend:121}],10:[function(e,t,r){"use strict";r.byteLength=function(e){var e=u(e),t=e[0],e=e[1];return 3*(t+e)/4-e},r.toByteArray=function(e){for(var t,r=u(e),n=r[0],r=r[1],o=new l(function(e,t){return 3*(e+t)/4-t}(n,r)),i=0,a=0<r?n-4:n,s=0;s<a;s+=4)t=d[e.charCodeAt(s)]<<18|d[e.charCodeAt(s+1)]<<12|d[e.charCodeAt(s+2)]<<6|d[e.charCodeAt(s+3)],o[i++]=t>>16&255,o[i++]=t>>8&255,o[i++]=255&t;2===r&&(t=d[e.charCodeAt(s)]<<2|d[e.charCodeAt(s+1)]>>4,o[i++]=255&t);1===r&&(t=d[e.charCodeAt(s)]<<10|d[e.charCodeAt(s+1)]<<4|d[e.charCodeAt(s+2)]>>2,o[i++]=t>>8&255,o[i++]=255&t);return o},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,o=[],i=0,a=r-n;i<a;i+=16383)o.push(function(e,t,r){for(var n,o=[],i=t;i<r;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(function(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}(n));return o.join("")}(e,i,a<i+16383?a:i+16383));1==n?(t=e[r-1],o.push(s[t>>2]+s[t<<4&63]+"==")):2==n&&(t=(e[r-2]<<8)+e[r-1],o.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return o.join("")};for(var s=[],d=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)s[o]=n[o],d[n.charCodeAt(o)]=o;function u(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("="),t=(e=-1===e?t:e)===t?0:4-e%4;return[e,t]}d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},{}],11:[function(e,t,r){},{}],12:[function(e,t,r){"use strict";var I=e("base64-js"),i=e("ieee754"),n=(r.Buffer=c,r.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},r.INSPECT_MAX_BYTES=50,2147483647);function d(e){if(n<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=c.prototype,e}function c(e,t,r){if("number"!=typeof e)return o(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}function o(e,t,r){if("string"==typeof e){var n=e,o=t;if(c.isEncoding(o="string"==typeof o&&""!==o?o:"utf8"))return i=0|p(n,o),a=d(i),a=(n=a.write(n,o))!==i?a.slice(0,n):a;throw new TypeError("Unknown encoding: "+o)}if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(M(e,ArrayBuffer)||e&&M(e.buffer,ArrayBuffer)){var i=e,n=t,a=r;if(n<0||i.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<n+(a||0))throw new RangeError('"length" is outside of buffer bounds');return(i=void 0===n&&void 0===a?new Uint8Array(i):void 0===a?new Uint8Array(i,n):new Uint8Array(i,n,a)).__proto__=c.prototype,i}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return c.from(o,t,r);var s=function(e){{var t,r;if(c.isBuffer(e))return t=0|u(e.length),0!==(r=d(t)).length&&e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||A(e.length)?d(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return a(e),d(e<0?0:0|u(e))}function l(e){for(var t=e.length<0?0:0|u(e.length),r=d(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function u(e){if(n<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||M(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return P(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return k(e).length;default:if(o)return n?-1:P(e).length;t=(""+t).toLowerCase(),o=!0}}function h(e,t,r){var n,o=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var i=this,a=t,s=r,d=i.length;(!s||s<0||d<s)&&(s=d);for(var l="",u=a=!a||a<0?0:a;u<s;++u)l+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(i[u]);return l;case"utf8":case"utf-8":return T(this,t,r);case"ascii":var c=this,d=t,p=r,h="";p=Math.min(c.length,p);for(var f=d;f<p;++f)h+=String.fromCharCode(127&c[f]);return h;case"latin1":case"binary":var m=this,a=t,g=r,y="";g=Math.min(m.length,g);for(var v=a;v<g;++v)y+=String.fromCharCode(m[v]);return y;case"base64":return b=this,n=r,0===(_=t)&&n===b.length?I.fromByteArray(b):I.fromByteArray(b.slice(_,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var b=t,_=r,S=this.slice(b,_),w="",E=0;E<S.length;E+=2)w+=String.fromCharCode(S[E]+256*S[E+1]);return w;default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function f(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),(r=(r=A(r=+r)?o?0:e.length-1:r)<0?e.length+r:r)>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(o?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):g(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,o){var i=1,a=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a/=i=2,s/=2,r/=2}function d(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(o)for(var l=-1,u=r;u<a;u++)if(d(e,u)===d(t,-1===l?0:u-l)){if(u-(l=-1===l?u:l)+1===s)return l*i}else-1!==l&&(u-=u-l),l=-1;else for(u=r=a<r+s?a-s:r;0<=u;u--){for(var c=!0,p=0;p<s;p++)if(d(e,u+p)!==d(t,p)){c=!1;break}if(c)return u}return-1}function y(e,t,r,n){return x(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function v(e,t,r,n){return x(function(e,t){for(var r,n,o=[],i=0;i<e.length&&!((t-=2)<0);++i)r=e.charCodeAt(i),n=r>>8,o.push(r%256),o.push(n);return o}(t,e.length-r),e,r,n)}function T(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,a,s,d,l=e[o],u=null,c=239<l?4:223<l?3:191<l?2:1;if(o+c<=r)switch(c){case 1:l<128&&(u=l);break;case 2:128==(192&(i=e[o+1]))&&127<(d=(31&l)<<6|63&i)&&(u=d);break;case 3:i=e[o+1],a=e[o+2],128==(192&i)&&128==(192&a)&&2047<(d=(15&l)<<12|(63&i)<<6|63&a)&&(d<55296||57343<d)&&(u=d);break;case 4:i=e[o+1],a=e[o+2],s=e[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&65535<(d=(15&l)<<18|(63&i)<<12|(63&a)<<6|63&s)&&d<1114112&&(u=d)}null===u?(u=65533,c=1):65535<u&&(n.push((u-=65536)>>>10&1023|55296),u=56320|1023&u),n.push(u),o+=c}var p=n,h=p.length;if(h<=b)return String.fromCharCode.apply(String,p);for(var f="",m=0;m<h;)f+=String.fromCharCode.apply(String,p.slice(m,m+=b));return f}r.kMaxLength=n,(c.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=o,c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=function(e,t,r){return t=t,r=r,a(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?d(e).fill(t,r):d(e).fill(t):d(e)},c.allocUnsafe=s,c.allocUnsafeSlow=s,c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(M(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),M(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);if(void 0===t)for(o=t=0;o<e.length;++o)t+=e[o].length;for(var r=c.allocUnsafe(t),n=0,o=0;o<e.length;++o){var i=e[o];if(M(i,Uint8Array)&&(i=c.from(i)),!c.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,n),n+=i.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},c.prototype.toLocaleString=c.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):h.apply(this,arguments)},c.prototype.equals=function(e){if(c.isBuffer(e))return this===e||0===c.compare(this,e);throw new TypeError("Argument must be a Buffer")},c.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,o){if(M(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),(t=void 0===t?0:t)<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(o<=n&&r<=t)return 0;if(o<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(i,a),d=this.slice(n,o),l=e.slice(t,r),u=0;u<s;++u)if(d[u]!==l[u]){i=d[u],a=l[u];break}return i<a?-1:a<i?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||o<r)&&(r=o),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var i,a,s,d=!1;;)switch(n){case"hex":var l=this,u=e,c=t,p=r,h=(c=Number(c)||0,l.length-c);(!p||h<(p=Number(p)))&&(p=h),(h=u.length)/2<p&&(p=h/2);for(var f=0;f<p;++f){var m=parseInt(u.substr(2*f,2),16);if(A(m))return f;l[c+f]=m}return f;case"utf8":case"utf-8":return h=t,s=r,x(P(e,(a=this).length-h),a,h,s);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return a=this,s=t,i=r,x(k(e),a,s,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return v(this,e,t,r);default:if(d)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),d=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var b=4096;function _(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function S(e,t,r,n,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<t||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function w(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function E(e,t,r,n,o){return t=+t,r>>>=0,o||w(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function C(e,t,r,n,o){return t=+t,r>>>=0,o||w(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r=this.length,r=((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),this.subarray(e,t));return r.__proto__=c.prototype,r},c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||_(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||_(e,t,this.length);for(var n=this[e+--t],o=1;0<t&&(o*=256);)n+=this[e+--t]*o;return n},c.prototype.readUInt8=function(e,t){return e>>>=0,t||_(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||_(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||_(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return(o*=128)<=n&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||_(e,t,this.length);for(var n=t,o=1,i=this[e+--n];0<n&&(o*=256);)i+=this[e+--n]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return e>>>=0,t||_(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||_(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},c.prototype.readInt16BE=function(e,t){e>>>=0,t||_(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||_(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return e>>>=0,t||_(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||_(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||_(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||_(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||S(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||S(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;0<=--o&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeIntLE=function(e,t,r,n){e=+e,t>>>=0,n||S(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var o=0,i=1,a=0;for(this[t]=255&e;++o<r&&(i*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/i>>0)-a&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){e=+e,t>>>=0,n||S(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var o=r-1,i=1,a=0;for(this[t+o]=255&e;0<=--o&&(i*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/i>>0)-a&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||S(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeFloatLE=function(e,t,r){return E(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return E(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return C(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return C(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r=r||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),(n=0<n&&n<r?r:n)===r)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var o=(n=e.length-t<n-r?e.length-t+r:n)-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=o-1;0<=i;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return o},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);var o;1===e.length&&(o=e.charCodeAt(0),"utf8"===n&&o<128||"latin1"===n)&&(e=o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");var i;if(!(r<=t))if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(i=t;i<r;++i)this[i]=e;else{var a=c.isBuffer(e)?e:c.from(e,n),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%s]}return this};var R=/[^+/0-9A-Za-z-_]/g;function P(e,t){t=t||1/0;for(var r,n=e.length,o=null,i=[],a=0;a<n;++a){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!o){if(56319<r){-1<(t-=3)&&i.push(239,191,189);continue}if(a+1===n){-1<(t-=3)&&i.push(239,191,189);continue}o=r;continue}if(r<56320){-1<(t-=3)&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&-1<(t-=3)&&i.push(239,191,189);if(o=null,r<128){if(--t<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function k(e){return I.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(R,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function x(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function M(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function A(e){return e!=e}},{"base64-js":10,ieee754:79}],13:[function(e,t,r){var c=Object.create||function(e){function t(){}return t.prototype=e,new t},a=Object.keys||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return t},n=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function o(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=c(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=o).EventEmitter=o).prototype._events=void 0,o.prototype._maxListeners=void 0;var i,s=10;try{var d={};Object.defineProperty&&Object.defineProperty(d,"x",{value:0}),i=0===d.x}catch(e){i=!1}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var o,i;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(o=e._events)?(o.newListener&&(e.emit("newListener",t,r.listener||r),o=e._events),i=o[t]):(o=e._events=c(null),e._eventsCount=0),i?("function"==typeof i?i=o[t]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),i.warned||(n=l(e))&&0<n&&i.length>n&&(i.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+i.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=i.length,"object"==typeof console)&&console.warn&&console.warn("%s: %s",n.name,n.message)):(i=o[t]=r,++e._eventsCount),e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function h(e,t,r){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},t=n.call(p,e);return t.listener=r,e.wrapFn=t}function f(e,t,r){e=e._events;if(!e)return[];e=e[t];if(!e)return[];if("function"==typeof e)return r?[e.listener||e]:[e];if(r){for(var n=e,o=new Array(n.length),i=0;i<o.length;++i)o[i]=n[i].listener||n[i];return o}return F(e,e.length)}function m(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function F(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}i?Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):o.defaultMaxListeners=s,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){var t,r,n,o,i="error"===e,a=this._events;if(a)i=i&&null==a.error;else if(!i)return!1;if(i)throw(t=1<arguments.length?arguments[1]:t)instanceof Error?t:((i=new Error('Unhandled "error" event. ('+t+")")).context=t,i);if(!(r=a[e]))return!1;var s,d="function"==typeof r;switch(s=arguments.length){case 1:var l=r,u=d,c=this;if(u)l.call(c);else for(var p=l.length,D=F(l,p),h=0;h<p;++h)D[h].call(c);break;case 2:var u=r,l=d,f=this,m=arguments[1];if(l)u.call(f,m);else for(var g=u.length,H=F(u,g),y=0;y<g;++y)H[y].call(f,m);break;case 3:var v=r,b=d,_=this,S=arguments[1],w=arguments[2];if(b)v.call(_,S,w);else for(var E=v.length,L=F(v,E),I=0;I<E;++I)L[I].call(_,S,w);break;case 4:var b=r,v=d,T=this,C=arguments[1],R=arguments[2],P=arguments[3];if(v)b.call(T,C,R,P);else for(var k=b.length,N=F(b,k),x=0;x<k;++x)N[x].call(T,C,R,P);break;default:for(n=new Array(s-1),o=1;o<s;o++)n[o-1]=arguments[o];var M=r,B=d,A=this,O=n;if(B)M.apply(A,O);else for(var j=M.length,V=F(M,j),U=0;U<j;++U)V[U].apply(A,O)}return!0},o.prototype.on=o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,o,i,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((n=this._events)&&(r=n[e]))if(r===t||r.listener===t)0==--this._eventsCount?this._events=c(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;0<=i;i--)if(r[i]===t||r[i].listener===t){a=r[i].listener,o=i;break}if(o<0)return this;if(0===o)r.shift();else{for(var s=r,d=o,l=d+1,u=s.length;l<u;d+=1,l+=1)s[d]=s[l];s.pop()}1===r.length&&(n[e]=r[0]),n.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.removeAllListeners=function(e){var t,r=this._events;if(r)if(r.removeListener){if(0===arguments.length){for(var n,o=a(r),i=0;i<o.length;++i)"removeListener"!==(n=o[i])&&this.removeAllListeners(n);this.removeAllListeners("removeListener"),this._events=c(null),this._eventsCount=0}else if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(i=t.length-1;0<=i;i--)this.removeListener(e,t[i])}else 0===arguments.length?(this._events=c(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=c(null):delete r[e]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],14:[function(e,t,r){!function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}.call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":81}],15:[function(e,t,r){"use strict";var i=e("es5-ext/object/copy"),n=e("es5-ext/object/normalize-options"),o=e("es5-ext/object/valid-callable"),a=e("es5-ext/object/map"),s=e("es5-ext/object/valid-callable"),d=e("es5-ext/object/valid-value"),l=Function.prototype.bind,u=Object.defineProperty,c=Object.prototype.hasOwnProperty,p=function(e,t,r){var n=d(t)&&s(t.value),o=i(t);return delete o.writable,delete o.value,o.get=function(){return!r.overwriteDefinition&&c.call(this,e)?n:(t.value=l.call(n,r.resolveContext?r.resolveContext(this):this),u(this,e,t),this[e])},o};t.exports=function(e){var r=n(arguments[1]);return null!=r.resolveContext&&o(r.resolveContext),a(e,function(e,t){return p(t,e,r)})}},{"es5-ext/object/copy":39,"es5-ext/object/map":48,"es5-ext/object/normalize-options":49,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55}],16:[function(e,t,r){"use strict";var a=e("es5-ext/object/assign"),s=e("es5-ext/object/normalize-options"),i=e("es5-ext/object/is-callable"),d=e("es5-ext/string/#/contains");(t.exports=function(e,t){var r,n,o,i;return arguments.length<2||"string"!=typeof e?(i=t,t=e,e=null):i=arguments[2],null==e?n=!(r=o=!0):(r=d.call(e,"c"),n=d.call(e,"e"),o=d.call(e,"w")),e={value:t,configurable:r,enumerable:n,writable:o},i?a(s(i),e):e}).gs=function(e,t,r){var n,o;return"string"!=typeof e?(o=r,r=t,t=e,e=null):o=arguments[3],null==t?t=void 0:i(t)?null==r?r=void 0:i(r)||(o=r,r=void 0):(o=t,t=r=void 0),e=null==e?!(n=!0):(n=d.call(e,"c"),d.call(e,"e")),t={get:t,set:r,configurable:n,enumerable:e},o?a(s(o),t):t}},{"es5-ext/object/assign":36,"es5-ext/object/is-callable":42,"es5-ext/object/normalize-options":49,"es5-ext/string/#/contains":56}],17:[function(u,c,e){!function(o,e){function i(e,t){e._corked?e.once("uncork",t):t()}function a(r,n){return function(e){var t;e?(t=r,e="premature close"===e.message?null:e,t._autoDestroy&&t.destroy(e)):n&&!r._ended&&r.end()}}function n(e,t,r){if(!(this instanceof n))return new n(e,t,r);s.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)}var s=u("readable-stream"),d=u("end-of-stream"),t=u("inherits"),r=u("stream-shift"),l=e.from&&e.from!==Uint8Array.from?e.from([0]):new e([0]);t(n,s.Duplex),n.obj=function(e,t,r){return(r=r||{}).objectMode=!0,r.highWaterMark=16,new n(e,t,r)},n.prototype.cork=function(){1==++this._corked&&this.emit("cork")},n.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},n.prototype.setWritable=function(e){var t,r,n;this._unwrite&&this._unwrite(),this.destroyed?e&&e.destroy&&e.destroy():null===e||!1===e?this.end():(r=d(e,{writable:!0,readable:!1},a(t=this,this._forwardEnd)),n=function(){var e=t._ondrain;t._ondrain=null,e&&e()},this._unwrite&&o.nextTick(n),this._writable=e,this._writable.on("drain",n),this._unwrite=function(){t._writable.removeListener("drain",n),r()},this.uncork())},n.prototype.setReadable=function(e){var t,r,n,o;this._unread&&this._unread(),this.destroyed?e&&e.destroy&&e.destroy():null===e||!1===e?(this.push(null),this.resume()):(r=d(e,{writable:!1,readable:!0},a(t=this)),n=function(){t._forward()},o=function(){t.push(null)},this._drained=!0,this._readable=e,this._readable2=e._readableState?e:(e=e,new s.Readable({objectMode:!0,highWaterMark:16}).wrap(e)),this._readable2.on("readable",n),this._readable2.on("end",o),this._unread=function(){t._readable2.removeListener("readable",n),t._readable2.removeListener("end",o),r()},this._forward())},n.prototype._read=function(){this._drained=!0,this._forward()},n.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var e;for(this._forwarding=!0;this._drained&&null!==(e=r(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},n.prototype.destroy=function(e){var t;this.destroyed||(this.destroyed=!0,t=this,o.nextTick(function(){t._destroy(e)}))},n.prototype._destroy=function(e){var t;e&&(t=this._ondrain,this._ondrain=null,t?t(e):this.emit("error",e)),this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable)&&this._writable.destroy&&this._writable.destroy(),this.emit("close")},n.prototype._write=function(e,t,r){return this.destroyed?r():this._corked?i(this,this._write.bind(this,e,t,r)):e===l?this._finish(r):this._writable?void(!1===this._writable.write(e)?this._ondrain=r:r()):r()},n.prototype._finish=function(r){var n=this;this.emit("preend"),i(this,function(){var e,t;e=n._forwardEnd&&n._writable,t=function(){!1===n._writableState.prefinished&&(n._writableState.prefinished=!0),n.emit("prefinish"),i(n,r)},!e||e._writableState&&e._writableState.finished?t():e._writableState?e.end(t):(e.end(),t())})},n.prototype.end=function(e,t,r){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(l),s.Writable.prototype.end.call(this,r))},c.exports=n}.call(this,u("_process"),u("buffer").Buffer)},{_process:92,buffer:12,"end-of-stream":18,inherits:80,"readable-stream":108,"stream-shift":111}],18:[function(e,t,r){function m(){}function g(t,e,r){if("function"==typeof e)return g(t,null,e);function n(){t.writable||o()}function o(){f=!1,h||r.call(t)}function i(){h=!1,f||r.call(t)}function a(e){r.call(t,e?new Error("exited with error code: "+e):null)}function s(e){r.call(t,e)}function d(){return(!h||p&&p.ended)&&(!f||c&&c.ended)?void 0:r.call(t,new Error("premature close"))}function l(){t.req.on("finish",o)}e=e||{},r=y(r||m);var u,c=t._writableState,p=t._readableState,h=e.readable||!1!==e.readable&&t.readable,f=e.writable||!1!==e.writable&&t.writable;return(u=t).setHeader&&"function"==typeof u.abort?(t.on("complete",o),t.on("abort",d),t.req?l():t.on("request",l)):f&&!c&&(t.on("end",n),t.on("close",n)),(u=t).stdio&&Array.isArray(u.stdio)&&3===u.stdio.length&&t.on("exit",a),t.on("end",i),t.on("finish",o),!1!==e.error&&t.on("error",s),t.on("close",d),function(){t.removeListener("complete",o),t.removeListener("abort",d),t.removeListener("request",l),t.req&&t.req.removeListener("finish",o),t.removeListener("end",n),t.removeListener("close",n),t.removeListener("finish",o),t.removeListener("exit",a),t.removeListener("end",i),t.removeListener("error",s),t.removeListener("close",d)}}var y=e("once");t.exports=g},{once:90}],19:[function(e,t,r){"use strict";var n=e("../../object/valid-value");t.exports=function(){return n(this).length=0,this}},{"../../object/valid-value":55}],20:[function(e,t,r){"use strict";var o=e("../../number/is-nan"),i=e("../../number/to-pos-integer"),a=e("../../object/valid-value"),s=Array.prototype.indexOf,d=Object.prototype.hasOwnProperty,l=Math.abs,u=Math.floor;t.exports=function(e){var t,r,n;if(!o(e))return s.apply(this,arguments);for(r=i(a(this).length),e=arguments[1],t=e=isNaN(e)?0:0<=e?u(e):i(this.length)-u(l(e));t<r;++t)if(d.call(this,t)&&(n=this[t],o(n)))return t;return-1}},{"../../number/is-nan":30,"../../number/to-pos-integer":34,"../../object/valid-value":55}],21:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":22,"./shim":23}],22:[function(e,t,r){"use strict";t.exports=function(){var e,t=Array.from;return"function"==typeof t&&(e=t(t=["raz","dwa"]),Boolean(e&&e!==t&&"dwa"===e[1]))}},{}],23:[function(e,t,r){"use strict";var h=e("es6-symbol").iterator,f=e("../../function/is-arguments"),m=e("../../function/is-function"),g=e("../../number/to-pos-integer"),y=e("../../object/valid-callable"),v=e("../../object/valid-value"),b=e("../../object/is-value"),_=e("../../string/is-string"),S=Array.isArray,w=Function.prototype.call,E={configurable:!0,enumerable:!0,writable:!0,value:null},I=Object.defineProperty;t.exports=function(e){var t,r,n,o,i,a,s,d,l,u,c=arguments[1],p=arguments[2];if(e=Object(v(e)),b(c)&&y(c),this&&this!==Array&&m(this))t=this;else{if(!c){if(f(e))return 1!==(i=e.length)?Array.apply(null,e):((o=new Array(1))[0]=e[0],o);if(S(e)){for(o=new Array(i=e.length),r=0;r<i;++r)o[r]=e[r];return o}}o=[]}if(!S(e))if(void 0!==(l=e[h])){for(s=y(l).call(e),t&&(o=new t),d=s.next(),r=0;!d.done;)u=c?w.call(c,p,d.value,r):d.value,t?(E.value=u,I(o,r,E)):o[r]=u,d=s.next(),++r;i=r}else if(_(e)){for(i=e.length,t&&(o=new t),n=r=0;r<i;++r)u=e[r],r+1<i&&55296<=(a=u.charCodeAt(0))&&a<=56319&&(u+=e[++r]),u=c?w.call(c,p,u,n):u,t?(E.value=u,I(o,n,E)):o[n]=u,++n;i=n}if(void 0===i)for(i=g(e.length),t&&(o=new t(i)),r=0;r<i;++r)u=c?w.call(c,p,e[r],r):e[r],t?(E.value=u,I(o,r,E)):o[r]=u;return t&&(E.value=null,o.length=i),o}},{"../../function/is-arguments":24,"../../function/is-function":25,"../../number/to-pos-integer":34,"../../object/is-value":44,"../../object/valid-callable":54,"../../object/valid-value":55,"../../string/is-string":59,"es6-symbol":73}],24:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call(function(){return arguments}());t.exports=function(e){return n.call(e)===o}},{}],25:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call(e("./noop"));t.exports=function(e){return"function"==typeof e&&n.call(e)===o}},{"./noop":26}],26:[function(e,t,r){"use strict";t.exports=function(){}},{}],27:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(e,t,r){"use strict";t.exports=function(){var e=Math.sign;return"function"==typeof e&&1===e(10)&&-1===e(-20)}},{}],29:[function(e,t,r){"use strict";t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:0<e?1:-1}},{}],30:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Number.isNaN:e("./shim")},{"./is-implemented":31,"./shim":32}],31:[function(e,t,r){"use strict";t.exports=function(){var e=Number.isNaN;return"function"==typeof e&&!e({})&&e(NaN)&&!e(34)}},{}],32:[function(e,t,r){"use strict";t.exports=function(e){return e!=e}},{}],33:[function(e,t,r){"use strict";var n=e("../math/sign"),o=Math.abs,i=Math.floor;t.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?n(e)*i(o(e)):e}},{"../math/sign":27}],34:[function(e,t,r){"use strict";var n=e("./to-integer"),o=Math.max;t.exports=function(e){return o(0,n(e))}},{"./to-integer":33}],35:[function(e,t,r){"use strict";var s=e("./valid-callable"),d=e("./valid-value"),l=Function.prototype.bind,u=Function.prototype.call,c=Object.keys,p=Object.prototype.propertyIsEnumerable;t.exports=function(i,a){return function(r,n){var e,o=arguments[2],t=arguments[3];return r=Object(d(r)),s(n),e=c(r),t&&e.sort("function"==typeof t?l.call(t,r):void 0),"function"!=typeof i&&(i=e[i]),u.call(i,e,function(e,t){return p.call(r,e)?u.call(n,o,r[e],e,r,t):a})}}},{"./valid-callable":54,"./valid-value":55}],36:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":37,"./shim":38}],37:[function(e,t,r){"use strict";t.exports=function(){var e=Object.assign;return"function"==typeof e&&(e(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],38:[function(e,t,r){"use strict";var a=e("../keys"),s=e("../valid-value"),d=Math.max;t.exports=function(t,r){var n,e,o,i=d(arguments.length,2);for(t=Object(s(t)),o=function(e){try{t[e]=r[e]}catch(e){n=n||e}},e=1;e<i;++e)a(r=arguments[e]).forEach(o);if(void 0!==n)throw n;return t}},{"../keys":45,"../valid-value":55}],39:[function(e,t,r){"use strict";var i=e("../array/from"),a=e("./assign"),s=e("./valid-value");t.exports=function(t){var r,e=Object(s(t)),n=arguments[1],o=Object(arguments[2]);return e===t||n?(r={},n?i(n,function(e){(o.ensure||e in t)&&(r[e]=t[e])}):a(r,t),r):e}},{"../array/from":21,"./assign":36,"./valid-value":55}],40:[function(e,t,r){"use strict";var n,o,i,a,s=Object.create;e("./set-prototype-of/is-implemented")()||(n=e("./set-prototype-of/shim")),t.exports=!n||1!==n.level?s:(a={configurable:!(i={}),enumerable:!(o={}),writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){i[e]="__proto__"===e?{configurable:!0,enumerable:!1,writable:!0,value:void 0}:a}),Object.defineProperties(o,i),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:o}),function(e,t){return s(null===e?o:e,t)})},{"./set-prototype-of/is-implemented":52,"./set-prototype-of/shim":53}],41:[function(e,t,r){"use strict";t.exports=e("./_iterate")("forEach")},{"./_iterate":35}],42:[function(e,t,r){"use strict";t.exports=function(e){return"function"==typeof e}},{}],43:[function(e,t,r){"use strict";var n=e("./is-value"),o={function:!0,object:!0};t.exports=function(e){return n(e)&&o[typeof e]||!1}},{"./is-value":44}],44:[function(e,t,r){"use strict";var n=e("../function/noop")();t.exports=function(e){return e!==n&&null!==e}},{"../function/noop":26}],45:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":46,"./shim":47}],46:[function(e,t,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],47:[function(e,t,r){"use strict";var n=e("../is-value"),o=Object.keys;t.exports=function(e){return o(n(e)?Object(e):e)}},{"../is-value":44}],48:[function(e,t,r){"use strict";var n=e("./valid-callable"),s=e("./for-each"),d=Function.prototype.call;t.exports=function(e,o){var i={},a=arguments[2];return n(o),s(e,function(e,t,r,n){i[t]=d.call(o,a,e,t,r,n)}),i}},{"./for-each":41,"./valid-callable":54}],49:[function(e,t,r){"use strict";var i=e("./is-value"),n=Array.prototype.forEach,a=Object.create;t.exports=function(e){var o=a(null);return n.call(arguments,function(e){if(i(e)){var t,r=Object(e),n=o;for(t in r)n[t]=r[t]}}),o}},{"./is-value":44}],50:[function(e,t,r){"use strict";var n=Array.prototype.forEach,o=Object.create;t.exports=function(e){var t=o(null);return n.call(arguments,function(e){t[e]=!0}),t}},{}],51:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.setPrototypeOf:e("./shim")},{"./is-implemented":52,"./shim":53}],52:[function(e,t,r){"use strict";var n=Object.create,o=Object.getPrototypeOf,i={};t.exports=function(){var e=Object.setPrototypeOf;return"function"==typeof e&&o(e((arguments[0]||n)(null),i))===i}},{}],53:[function(e,t,r){"use strict";var n,o,i=e("../is-object"),a=e("../valid-value"),s=Object.prototype.isPrototypeOf,d=Object.defineProperty,l={configurable:!0,enumerable:!1,writable:!0,value:void 0},u=function(e,t){if(a(e),null===t||i(t))return e;throw new TypeError("Prototype must be null or an object")};t.exports=(t=function(){var e,t=Object.create(null),r={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{(e=n.set).call(t,r)}catch(e){}if(Object.getPrototypeOf(t)===r)return{set:e,level:2}}return t.__proto__=r,Object.getPrototypeOf(t)===r?{level:2}:((t={}).__proto__=r,Object.getPrototypeOf(t)===r&&{level:1})}())?(n=2===t.level?t.set?(o=t.set,function(e,t){return o.call(u(e,t),t),e}):function(e,t){return u(e,t).__proto__=t,e}:function e(t,r){var n;return u(t,r),(n=s.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,t.__proto__=r=null===r?e.nullPolyfill:r,n&&d(e.nullPolyfill,"__proto__",l),t},Object.defineProperty(n,"level",{configurable:!1,enumerable:!1,writable:!1,value:t.level})):null,e("../create")},{"../create":40,"../is-object":43,"../valid-value":55}],54:[function(e,t,r){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],55:[function(e,t,r){"use strict";var n=e("./is-value");t.exports=function(e){if(n(e))return e;throw new TypeError("Cannot use null or undefined")}},{"./is-value":44}],56:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":57,"./shim":58}],57:[function(e,t,r){"use strict";var n="razdwatrzy";t.exports=function(){return"function"==typeof n.contains&&!0===n.contains("dwa")&&!1===n.contains("foo")}},{}],58:[function(e,t,r){"use strict";var n=String.prototype.indexOf;t.exports=function(e){return-1<n.call(this,e,arguments[1])}},{}],59:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call("");t.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||n.call(e)===o)||!1}},{}],60:[function(e,t,r){"use strict";var n=e("es5-ext/object/set-prototype-of"),o=e("es5-ext/string/#/contains"),i=e("d"),a=e("es6-symbol"),s=e("./"),d=Object.defineProperty,l=t.exports=function(e,t){if(!(this instanceof l))throw new TypeError("Constructor requires 'new'");s.call(this,e),t=t?o.call(t,"key+value")?"key+value":o.call(t,"key")?"key":"value":"value",d(this,"__kind__",i("",t))};n&&n(l,s),delete l.prototype.constructor,l.prototype=Object.create(s.prototype,{_resolve:i(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),d(l.prototype,a.toStringTag,i("c","Array Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es5-ext/string/#/contains":56,"es6-symbol":73}],61:[function(e,t,r){"use strict";var c=e("es5-ext/function/is-arguments"),p=e("es5-ext/object/valid-callable"),h=e("es5-ext/string/is-string"),f=e("./get"),m=Array.isArray,g=Function.prototype.call,y=Array.prototype.some;t.exports=function(e,t){var r,n,o,i,a,s,d,l,u=arguments[2];if(m(e)||c(e)?r="array":h(e)?r="string":e=f(e),p(t),o=function(){i=!0},"array"===r)y.call(e,function(e){return g.call(t,u,e,o),i});else if("string"===r)for(s=e.length,a=0;a<s&&(d=e[a],a+1<s&&55296<=(l=d.charCodeAt(0))&&l<=56319&&(d+=e[++a]),g.call(t,u,d,o),!i);++a);else for(n=e.next();!n.done;){if(g.call(t,u,n.value,o),i)return;n=e.next()}}},{"./get":62,"es5-ext/function/is-arguments":24,"es5-ext/object/valid-callable":54,"es5-ext/string/is-string":59}],62:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),o=e("es5-ext/string/is-string"),i=e("./array"),a=e("./string"),s=e("./valid-iterable"),d=e("es6-symbol").iterator;t.exports=function(e){return"function"==typeof s(e)[d]?e[d]():new(!n(e)&&o(e)?a:i)(e)}},{"./array":60,"./string":65,"./valid-iterable":66,"es5-ext/function/is-arguments":24,"es5-ext/string/is-string":59,"es6-symbol":73}],63:[function(e,t,r){"use strict";var n,o=e("es5-ext/array/#/clear"),i=e("es5-ext/object/assign"),a=e("es5-ext/object/valid-callable"),s=e("es5-ext/object/valid-value"),d=e("d"),l=e("d/auto-bind"),u=e("es6-symbol"),c=Object.defineProperty,p=Object.defineProperties;t.exports=n=function(e,t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");p(this,{__list__:d("w",s(e)),__context__:d("w",t),__nextIndex__:d("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete n.prototype.constructor,p(n.prototype,i({_next:d(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:d(function(){return this._createResult(this._next())}),_createResult:d(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:d(function(e){return this.__list__[e]}),_unBind:d(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:d(function(){return"[object "+(this[u.toStringTag]||"Object")+"]"})},l({_onAdd:d(function(r){r>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(e,t){r<=e&&(this.__redo__[t]=++e)},this),this.__redo__.push(r)):c(this,"__redo__",d("c",[r])))}),_onDelete:d(function(r){var e;r>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(e=this.__redo__.indexOf(r))&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,t){r<e&&(this.__redo__[t]=--e)},this)))}),_onClear:d(function(){this.__redo__&&o.call(this.__redo__),this.__nextIndex__=0})}))),c(n.prototype,u.iterator,d(function(){return this}))},{d:16,"d/auto-bind":15,"es5-ext/array/#/clear":19,"es5-ext/object/assign":36,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-symbol":73}],64:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),o=e("es5-ext/object/is-value"),i=e("es5-ext/string/is-string"),a=e("es6-symbol").iterator,s=Array.isArray;t.exports=function(e){return!(!o(e)||!s(e)&&!i(e)&&!n(e)&&"function"!=typeof e[a])}},{"es5-ext/function/is-arguments":24,"es5-ext/object/is-value":44,"es5-ext/string/is-string":59,"es6-symbol":73}],65:[function(e,t,r){"use strict";var n=e("es5-ext/object/set-prototype-of"),o=e("d"),i=e("es6-symbol"),a=e("./"),s=Object.defineProperty,d=t.exports=function(e){if(!(this instanceof d))throw new TypeError("Constructor requires 'new'");e=String(e),a.call(this,e),s(this,"__length__",o("",e.length))};n&&n(d,a),delete d.prototype.constructor,d.prototype=Object.create(a.prototype,{_next:o(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:o(function(e){var t,e=this.__list__[e];return this.__nextIndex__!==this.__length__&&55296<=(t=e.charCodeAt(0))&&t<=56319?e+this.__list__[this.__nextIndex__++]:e})}),s(d.prototype,i.toStringTag,o("c","String Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es6-symbol":73}],66:[function(e,t,r){"use strict";var n=e("./is-iterable");t.exports=function(e){if(n(e))return e;throw new TypeError(e+" is not iterable")}},{"./is-iterable":64}],67:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Map:e("./polyfill")},{"./is-implemented":68,"./polyfill":72}],68:[function(e,t,r){"use strict";t.exports=function(){var e;if("function"!=typeof Map)return!1;try{e=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(e){return!1}return"[object Map]"===String(e)&&3===e.size&&"function"==typeof e.clear&&"function"==typeof e.delete&&"function"==typeof e.entries&&"function"==typeof e.forEach&&"function"==typeof e.get&&"function"==typeof e.has&&"function"==typeof e.keys&&"function"==typeof e.set&&"function"==typeof e.values&&!1===(e=e.entries().next()).done&&!!e.value&&"raz"===e.value[0]&&"one"===e.value[1]}},{}],69:[function(e,t,r){"use strict";t.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},{}],70:[function(e,t,r){"use strict";t.exports=e("es5-ext/object/primitive-set")("key","value","key+value")},{"es5-ext/object/primitive-set":50}],71:[function(e,t,r){"use strict";var n=e("es5-ext/object/set-prototype-of"),o=e("d"),i=e("es6-iterator"),a=e("es6-symbol").toStringTag,s=e("./iterator-kinds"),d=Object.defineProperties,l=i.prototype._unBind,u=t.exports=function(e,t){if(!(this instanceof u))return new u(e,t);i.call(this,e.__mapKeysData__,e),t&&s[t]||(t="key+value"),d(this,{__kind__:o("",t),__values__:o("w",e.__mapValuesData__)})};n&&n(u,i),u.prototype=Object.create(i.prototype,{constructor:o(u),_resolve:o(function(e){return"value"===this.__kind__?this.__values__[e]:"key"===this.__kind__?this.__list__[e]:[this.__list__[e],this.__values__[e]]}),_unBind:o(function(){this.__values__=null,l.call(this)}),toString:o(function(){return"[object Map Iterator]"})}),Object.defineProperty(u.prototype,a,o("c","Map Iterator"))},{"./iterator-kinds":70,d:16,"es5-ext/object/set-prototype-of":51,"es6-iterator":63,"es6-symbol":73}],72:[function(e,t,r){"use strict";var o,n=e("es5-ext/array/#/clear"),i=e("es5-ext/array/#/e-index-of"),a=e("es5-ext/object/set-prototype-of"),s=e("es5-ext/object/valid-callable"),d=e("es5-ext/object/valid-value"),l=e("d"),u=e("event-emitter"),c=e("es6-symbol"),p=e("es6-iterator/valid-iterable"),h=e("es6-iterator/for-of"),f=e("./lib/iterator"),m=e("./is-native-implemented"),g=Function.prototype.call,y=Object.defineProperties,v=Object.getPrototypeOf;t.exports=o=function(){var r,n,e,t=arguments[0];if(this instanceof o)return e=m&&a&&Map!==o?a(new Map,v(this)):this,null!=t&&p(t),y(e,{__mapKeysData__:l("c",r=[]),__mapValuesData__:l("c",n=[])}),t&&h(t,function(e){var t=d(e)[0];e=e[1],-1===i.call(r,t)&&(r.push(t),n.push(e))},e),e;throw new TypeError("Constructor requires 'new'")},m&&(a&&a(o,Map),o.prototype=Object.create(Map.prototype,{constructor:l(o)})),u(y(o.prototype,{clear:l(function(){this.__mapKeysData__.length&&(n.call(this.__mapKeysData__),n.call(this.__mapValuesData__),this.emit("_clear"))}),delete:l(function(e){var t=i.call(this.__mapKeysData__,e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),this.emit("_delete",t,e),!0)}),entries:l(function(){return new f(this,"key+value")}),forEach:l(function(e){var t,r,n=arguments[1];for(s(e),r=(t=this.entries())._next();void 0!==r;)g.call(e,n,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=t._next()}),get:l(function(e){e=i.call(this.__mapKeysData__,e);if(-1!==e)return this.__mapValuesData__[e]}),has:l(function(e){return-1!==i.call(this.__mapKeysData__,e)}),keys:l(function(){return new f(this,"key")}),set:l(function(e,t){var r,n=i.call(this.__mapKeysData__,e);return-1===n&&(n=this.__mapKeysData__.push(e)-1,r=!0),this.__mapValuesData__[n]=t,r&&this.emit("_add",n,e),this}),size:l.gs(function(){return this.__mapKeysData__.length}),values:l(function(){return new f(this,"value")}),toString:l(function(){return"[object Map]"})})),Object.defineProperty(o.prototype,c.iterator,l(function(){return this.entries()})),Object.defineProperty(o.prototype,c.toStringTag,l("c","Map"))},{"./is-native-implemented":69,"./lib/iterator":71,d:16,"es5-ext/array/#/clear":19,"es5-ext/array/#/e-index-of":20,"es5-ext/object/set-prototype-of":51,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-iterator/for-of":61,"es6-iterator/valid-iterable":66,"es6-symbol":73,"event-emitter":78}],73:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Symbol:e("./polyfill")},{"./is-implemented":74,"./polyfill":76}],74:[function(e,t,r){"use strict";var n={object:!0,symbol:!0};t.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!n[typeof Symbol.iterator]&&!!n[typeof Symbol.toPrimitive]&&!!n[typeof Symbol.toStringTag]}},{}],75:[function(e,t,r){"use strict";t.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&"Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag])}},{}],76:[function(e,t,r){"use strict";var n,o,i,a=e("d"),s=e("./validate-symbol"),d=Object.create,l=Object.defineProperties,u=Object.defineProperty,c=Object.prototype,p=d(null);if("function"==typeof Symbol){n=Symbol;try{String(n()),i=!0}catch(e){}}h=d(null);var h,f=function(e){for(var t,r,n=0;h[e+(n||"")];)++n;return h[e+=n||""]=!0,u(c,t="@@"+e,a.gs(null,function(e){r||(r=!0,u(this,t,a(e)),r=!1)})),t},m=function(e){if(this instanceof m)throw new TypeError("Symbol is not a constructor");return o(e)};t.exports=o=function e(t){var r;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return i?n(t):(r=d(m.prototype),t=void 0===t?"":String(t),l(r,{__description__:a("",t),__name__:a("",f(t))}))},l(o,{for:a(function(e){return p[e]||(p[e]=o(String(e)))}),keyFor:a(function(e){for(var t in s(e),p)if(p[t]===e)return t}),hasInstance:a("",n&&n.hasInstance||o("hasInstance")),isConcatSpreadable:a("",n&&n.isConcatSpreadable||o("isConcatSpreadable")),iterator:a("",n&&n.iterator||o("iterator")),match:a("",n&&n.match||o("match")),replace:a("",n&&n.replace||o("replace")),search:a("",n&&n.search||o("search")),species:a("",n&&n.species||o("species")),split:a("",n&&n.split||o("split")),toPrimitive:a("",n&&n.toPrimitive||o("toPrimitive")),toStringTag:a("",n&&n.toStringTag||o("toStringTag")),unscopables:a("",n&&n.unscopables||o("unscopables"))}),l(m.prototype,{constructor:a(o),toString:a("",function(){return this.__name__})}),l(o.prototype,{toString:a(function(){return"Symbol ("+s(this).__description__+")"}),valueOf:a(function(){return s(this)})}),u(o.prototype,o.toPrimitive,a("",function(){var e=s(this);return"symbol"==typeof e?e:e.toString()})),u(o.prototype,o.toStringTag,a("c","Symbol")),u(m.prototype,o.toStringTag,a("c",o.prototype[o.toStringTag])),u(m.prototype,o.toPrimitive,a("c",o.prototype[o.toPrimitive]))},{"./validate-symbol":77,d:16}],77:[function(e,t,r){"use strict";var n=e("./is-symbol");t.exports=function(e){if(n(e))return e;throw new TypeError(e+" is not a symbol")}},{"./is-symbol":75}],78:[function(e,t,r){"use strict";var n=e("d"),a=e("es5-ext/object/valid-callable"),s=Function.prototype.apply,d=Function.prototype.call,o=Object.create,i=Object.defineProperty,l=Object.defineProperties,u=Object.prototype.hasOwnProperty,c={configurable:!0,enumerable:!1,writable:!0},p=function(e,t){var r;return a(t),u.call(this,"__ee__")?r=this.__ee__:(r=c.value=o(null),i(this,"__ee__",c),c.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},e=function(e,t){var r,n;return a(t),n=this,p.call(this,e,r=function(){h.call(n,e,r),s.call(t,this,arguments)}),r.__eeOnceListener__=t,this},h=function(e,t){var r,n,o,i;if(a(t),u.call(this,"__ee__")&&(r=this.__ee__)[e])if("object"==typeof(n=r[e]))for(i=0;o=n[i];++i)o!==t&&o.__eeOnceListener__!==t||(2===n.length?r[e]=n[i?0:1]:n.splice(i,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},f=function(e){var t,r,n,o,i;if(u.call(this,"__ee__")&&(o=this.__ee__[e]))if("object"==typeof o){for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];for(o=o.slice(),t=0;n=o[t];++t)s.call(n,this,i)}else switch(arguments.length){case 1:d.call(o,this);break;case 2:d.call(o,this,arguments[1]);break;case 3:d.call(o,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];s.call(o,this,i)}},m={on:p,once:e,off:h,emit:f},g={on:n(p),once:n(e),off:n(h),emit:n(f)},y=l({},g);t.exports=r=function(e){return null==e?o(y):l(Object(e),g)},r.methods=m},{d:16,"es5-ext/object/valid-callable":54}],79:[function(e,t,r){r.read=function(e,t,r,n,o){var i,a,s=8*o-n-1,d=(1<<s)-1,l=d>>1,u=-7,c=r?o-1:0,p=r?-1:1,o=e[t+c];for(c+=p,i=o&(1<<-u)-1,o>>=-u,u+=s;0<u;i=256*i+e[t+c],c+=p,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=n;0<u;a=256*a+e[t+c],c+=p,u-=8);if(0===i)i=1-l;else{if(i===d)return a?NaN:1/0*(o?-1:1);a+=Math.pow(2,n),i-=l}return(o?-1:1)*a*Math.pow(2,i-n)},r.write=function(e,t,r,n,o,i){var a,s,d=8*i-o-1,l=(1<<d)-1,u=l>>1,c=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,h=n?1:-1,i=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+u?c/n:c*Math.pow(2,1-u))*n&&(a++,n/=2),l<=a+u?(s=0,a=l):1<=a+u?(s=(t*n-1)*Math.pow(2,o),a+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,o),a=0));8<=o;e[r+p]=255&s,p+=h,s/=256,o-=8);for(a=a<<o|s,d+=o;0<d;e[r+p]=255&a,p+=h,a/=256,d-=8);e[r+p-h]|=128*i}},{}],80:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],81:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))||!!e._isBuffer);var t}},{}],82:[function(e,t,r){"use strict";var n,o,i=e("safe-buffer").Buffer,a=t.exports;for(n in a.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},a.codes={},a.types){var s=a.types[n];a.codes[s]=n}for(o in a.CMD_SHIFT=4,a.CMD_MASK=240,a.DUP_MASK=8,a.QOS_MASK=3,a.QOS_SHIFT=1,a.RETAIN_MASK=1,a.LENGTH_MASK=127,a.LENGTH_FIN_MASK=128,a.SESSIONPRESENT_MASK=1,a.SESSIONPRESENT_HEADER=i.from([a.SESSIONPRESENT_MASK]),a.CONNACK_HEADER=i.from([a.codes.connack<<a.CMD_SHIFT]),a.USERNAME_MASK=128,a.PASSWORD_MASK=64,a.WILL_RETAIN_MASK=32,a.WILL_QOS_MASK=24,a.WILL_QOS_SHIFT=3,a.WILL_FLAG_MASK=4,a.CLEAN_SESSION_MASK=2,a.CONNECT_HEADER=i.from([a.codes.connect<<a.CMD_SHIFT]),a.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},a.propertiesCodes={},a.properties){var d=a.properties[o];a.propertiesCodes[d]=o}function l(o){return[0,1,2].map(function(n){return[0,1].map(function(r){return[0,1].map(function(e){var t=new i(1);return t.writeUInt8(a.codes[o]<<a.CMD_SHIFT|(r?a.DUP_MASK:0)|n<<a.QOS_SHIFT|e,0,!0),t})})})}a.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int32",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},a.PUBLISH_HEADER=l("publish"),a.SUBSCRIBE_HEADER=l("subscribe"),a.SUBSCRIBE_OPTIONS_QOS_MASK=3,a.SUBSCRIBE_OPTIONS_NL_MASK=1,a.SUBSCRIBE_OPTIONS_NL_SHIFT=2,a.SUBSCRIBE_OPTIONS_RAP_MASK=1,a.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,a.SUBSCRIBE_OPTIONS_RH_MASK=3,a.SUBSCRIBE_OPTIONS_RH_SHIFT=4,a.SUBSCRIBE_OPTIONS_RH=[0,16,32],a.SUBSCRIBE_OPTIONS_NL=4,a.SUBSCRIBE_OPTIONS_RAP=8,a.SUBSCRIBE_OPTIONS_QOS=[0,1,2],a.UNSUBSCRIBE_HEADER=l("unsubscribe"),a.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},a.SUBACK_HEADER=i.from([a.codes.suback<<a.CMD_SHIFT]),a.VERSION3=i.from([3]),a.VERSION4=i.from([4]),a.VERSION5=i.from([5]),a.QOS=[0,1,2].map(function(e){return i.from([e])}),a.EMPTY={pingreq:i.from([a.codes.pingreq<<4,0]),pingresp:i.from([a.codes.pingresp<<4,0]),disconnect:i.from([a.codes.disconnect<<4,0])}},{"safe-buffer":110}],83:[function(e,t,r){"use strict";var a=e("safe-buffer").Buffer,n=e("./writeToStream"),o=e("events").EventEmitter;function i(){this._array=new Array(20),this._i=0}e("inherits")(i,o),i.prototype.write=function(e){return this._array[this._i++]=e,!0},i.prototype.concat=function(){for(var e,t=0,r=new Array(this._array.length),n=this._array,o=0,i=0;i<n.length&&void 0!==n[i];i++)"string"!=typeof n[i]?r[i]=n[i].length:r[i]=a.byteLength(n[i]),t+=r[i];for(e=a.allocUnsafe(t),i=0;i<n.length&&void 0!==n[i];i++)"string"!=typeof n[i]?n[i].copy(e,o):e.write(n[i],o),o+=r[i];return e},t.exports=function(e,t){var r=new i;return n(e,r,t),r.concat()}},{"./writeToStream":89,events:13,inherits:80,"safe-buffer":110}],84:[function(e,t,r){"use strict";r.parser=e("./parser"),r.generate=e("./generate"),r.writeToStream=e("./writeToStream")},{"./generate":83,"./parser":88,"./writeToStream":89}],85:[function(e,t,r){var n=e("readable-stream/duplex"),o=e("util"),p=e("safe-buffer").Buffer;function i(e){if(!(this instanceof i))return new i(e);var t;this._bufs=[],this.length=0,"function"==typeof e?(this._callback=e,t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this),this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)})):this.append(e),n.call(this)}o.inherits(i,n),i.prototype._offset=function(e){var t,r=0,n=0;if(0===e)return[0,0];for(;n<this._bufs.length;n++){if(e<(t=r+this._bufs[n].length)||n==this._bufs.length-1)return[n,e-r];r=t}},i.prototype.append=function(e){var t=0;if(p.isBuffer(e))this._appendBuffer(e);else if(Array.isArray(e))for(;t<e.length;t++)this.append(e[t]);else if(e instanceof i)for(;t<e._bufs.length;t++)this.append(e._bufs[t]);else null!=e&&("number"==typeof e&&(e=e.toString()),this._appendBuffer(p.from(e)));return this},i.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},i.prototype._write=function(e,t,r){this._appendBuffer(e),"function"==typeof r&&r()},i.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},i.prototype.end=function(e){n.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},i.prototype.get=function(e){return this.slice(e,e+1)[0]},i.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},i.prototype.copy=function(e,t,r,n){if(("number"!=typeof n||n>this.length)&&(n=this.length),(r="number"!=typeof r||r<0?0:r)>=this.length)return e||p.alloc(0);if(n<=0)return e||p.alloc(0);var o,i,a=!!e,s=this._offset(r),d=n-r,l=d,u=a&&t||0,c=s[1];if(0===r&&n==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:p.concat(this._bufs,this.length);for(i=0;i<this._bufs.length;i++)this._bufs[i].copy(e,u),u+=this._bufs[i].length}else{if(l<=this._bufs[s[0]].length-c)return a?this._bufs[s[0]].copy(e,t,c,c+l):this._bufs[s[0]].slice(c,c+l);for(a||(e=p.allocUnsafe(d)),i=s[0];i<this._bufs.length;i++){if(!((o=this._bufs[i].length-c)<l)){this._bufs[i].copy(e,u,c,c+l);break}this._bufs[i].copy(e,u,c),u+=o,l-=o,c=c&&0}}return e},i.prototype.shallowSlice=function(e,t){t=t||this.length,(e=e||0)<0&&(e+=this.length),t<0&&(t+=this.length);var e=this._offset(e),t=this._offset(t),r=this._bufs.slice(e[0],t[0]+1);return 0==t[1]?r.pop():r[r.length-1]=r[r.length-1].slice(0,t[1]),0!=e[1]&&(r[0]=r[0].slice(e[1])),new i(r)},i.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},i.prototype.consume=function(e){for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},i.prototype.duplicate=function(){for(var e=0,t=new i;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},i.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)};var a,s={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(a in s)!function(t){i.prototype[t]=function(e){return this.slice(e,e+s[t])[t](0)}}(a);t.exports=i},{"readable-stream/duplex":97,"safe-buffer":110,util:117}],86:[function(e,t,r){"use strict";var i=e("safe-buffer").Buffer,n={};function o(e){var t=i.allocUnsafe(2);return t.writeUInt8(e>>8,0),t.writeUInt8(255&e,1),t}t.exports={cache:n,generateCache:function(){for(var e=0;e<65536;e++)n[e]=o(e)},generateNumber:o,genBufVariableByteInt:function(e){for(var t=0,r=0,n=0<=(n=e)&&n<128?1:128<=n&&n<16384?2:16384<=n&&n<2097152?3:2097152<=n&&n<268435456?4:0,o=i.allocUnsafe(n);t=e%128|0,0<(e=e/128|0)&&(t|=128),o.writeUInt8(t,r++),0<e;);return{data:o,length:n}},generate4ByteBuffer:function(e){var t=i.allocUnsafe(4);return t.writeUInt32BE(e,0),t}}},{"safe-buffer":110}],87:[function(e,t,r){t.exports=function(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}},{}],88:[function(e,t,r){"use strict";var n=e("bl"),o=e("inherits"),i=e("events").EventEmitter,a=e("./packet"),s=e("./constants");function d(e){if(!(this instanceof d))return new d(e);this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}o(d,i),d.prototype._resetState=function(){this.packet=new a,this.error=null,this._list=n(),this._stateCounter=0},d.prototype.parse=function(e){for(this.error&&this._resetState(),this._list.append(e);(-1!==this.packet.length||0<this._list.length)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},d.prototype._parseHeader=function(){var e=this._list.readUInt8(0);return this.packet.cmd=s.types[e>>s.CMD_SHIFT],this.packet.retain=0!=(e&s.RETAIN_MASK),this.packet.qos=e>>s.QOS_SHIFT&s.QOS_MASK,this.packet.dup=0!=(e&s.DUP_MASK),this._list.consume(1),!0},d.prototype._parseLength=function(){var e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),!!e},d.prototype._parsePayload=function(){var e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return e},d.prototype._parseConnect=function(){var e={},t=this.packet,r=this._parseString();if(null===r)return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==r&&"MQIsdp"!==r)return this._emitError(new Error("Invalid protocolId"));if(t.protocolId=r,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(t.protocolVersion=this._list.readUInt8(this._pos),3!==t.protocolVersion&&4!==t.protocolVersion&&5!==t.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(e.username=this._list.readUInt8(this._pos)&s.USERNAME_MASK,e.password=this._list.readUInt8(this._pos)&s.PASSWORD_MASK,e.will=this._list.readUInt8(this._pos)&s.WILL_FLAG_MASK,e.will&&(t.will={},t.will.retain=0!=(this._list.readUInt8(this._pos)&s.WILL_RETAIN_MASK),t.will.qos=(this._list.readUInt8(this._pos)&s.WILL_QOS_MASK)>>s.WILL_QOS_SHIFT),t.clean=0!=(this._list.readUInt8(this._pos)&s.CLEAN_SESSION_MASK),this._pos++,t.keepalive=this._parseNum(),-1===t.keepalive)return this._emitError(new Error("Packet too short"));if(5===t.protocolVersion&&(r=this._parseProperties(),Object.getOwnPropertyNames(r).length)&&(t.properties=r),null===(r=this._parseString()))return this._emitError(new Error("Packet too short"));if(t.clientId=r,e.will){if(5===t.protocolVersion&&(r=this._parseProperties(),Object.getOwnPropertyNames(r).length)&&(t.will.properties=r),null===(r=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(t.will.topic=r,null===(r=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));t.will.payload=r}if(e.username){if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse username"));t.username=r}if(e.password){if(null===(r=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));t.password=r}return this.settings=t},d.prototype._parseConnack=function(){var e,t=this.packet;return this._list.length<2?null:(t.sessionPresent=!!(this._list.readUInt8(this._pos++)&s.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?t.reasonCode=this._list.readUInt8(this._pos++):t.returnCode=this._list.readUInt8(this._pos++),-1===t.returnCode||-1===t.reasonCode?this._emitError(new Error("Cannot parse return code")):void(5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length)&&(t.properties=e)))},d.prototype._parsePublish=function(){var e,t=this.packet;if(t.topic=this._parseString(),null===t.topic)return this._emitError(new Error("Cannot parse topic"));0<t.qos&&!this._parseMessageId()||(5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length)&&(t.properties=e),t.payload=this._list.slice(this._pos,t.length))},d.prototype._parseSubscribe=function(){var e,t,r,n,o,i,a=this.packet;if(1!==a.qos)return this._emitError(new Error("Wrong subscribe header"));if(a.subscriptions=[],this._parseMessageId())for(5===this.settings.protocolVersion&&(i=this._parseProperties(),Object.getOwnPropertyNames(i).length)&&(a.properties=i);this._pos<a.length;){if(null===(o=this._parseString()))return this._emitError(new Error("Cannot parse topic"));e=(t=this._parseByte())&s.SUBSCRIBE_OPTIONS_QOS_MASK,n=0!=(t>>s.SUBSCRIBE_OPTIONS_NL_SHIFT&s.SUBSCRIBE_OPTIONS_NL_MASK),r=0!=(t>>s.SUBSCRIBE_OPTIONS_RAP_SHIFT&s.SUBSCRIBE_OPTIONS_RAP_MASK),t=t>>s.SUBSCRIBE_OPTIONS_RH_SHIFT&s.SUBSCRIBE_OPTIONS_RH_MASK,o={topic:o,qos:e},5===this.settings.protocolVersion&&(o.nl=n,o.rap=r,o.rh=t),a.subscriptions.push(o)}},d.prototype._parseSuback=function(){var e,t=this.packet;if(this.packet.granted=[],this._parseMessageId())for(5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length)&&(t.properties=e);this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))},d.prototype._parseUnsubscribe=function(){var e,t=this.packet;if(t.unsubscriptions=[],this._parseMessageId())for(5===this.settings.protocolVersion&&(e=this._parseProperties(),Object.getOwnPropertyNames(e).length)&&(t.properties=e);this._pos<t.length;){var r=this._parseString();if(null===r)return this._emitError(new Error("Cannot parse topic"));t.unsubscriptions.push(r)}},d.prototype._parseUnsuback=function(){var e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},d.prototype._parseConfirmation=function(){var e,t=this.packet;return this._parseMessageId(),5===this.settings.protocolVersion&&2<t.length&&(t.reasonCode=this._parseByte(),e=this._parseProperties(),Object.getOwnPropertyNames(e).length)&&(t.properties=e),!0},d.prototype._parseDisconnect=function(){var e,t=this.packet;return 5===this.settings.protocolVersion&&(t.reasonCode=this._parseByte(),e=this._parseProperties(),Object.getOwnPropertyNames(e).length)&&(t.properties=e),!0},d.prototype._parseAuth=function(){var e=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();var t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),!0},d.prototype._parseMessageId=function(){var e=this.packet;return e.messageId=this._parseNum(),null!==e.messageId||(this._emitError(new Error("Cannot parse messageId")),!1)},d.prototype._parseString=function(e){var t=this._parseNum(),r=t+this._pos;return-1===t||r>this._list.length||r>this.packet.length?null:(r=this._list.toString("utf8",this._pos,r),this._pos+=t,r)},d.prototype._parseStringPair=function(){return{name:this._parseString(),value:this._parseString()}},d.prototype._parseBuffer=function(){var e=this._parseNum(),t=e+this._pos;return-1===e||t>this._list.length||t>this.packet.length?null:(t=this._list.slice(this._pos,t),this._pos+=e,t)},d.prototype._parseNum=function(){var e;return this._list.length-this._pos<2?-1:(e=this._list.readUInt16BE(this._pos),this._pos+=2,e)},d.prototype._parse4ByteNum=function(){var e;return this._list.length-this._pos<4?-1:(e=this._list.readUInt32BE(this._pos),this._pos+=4,e)},d.prototype._parseVarByteNum=function(e){for(var t,r=0,n=1,o=0,i=!0,a=this._pos||0;r<5&&(o+=n*((t=this._list.readUInt8(a+r++))&s.LENGTH_MASK),n*=128,0!=(t&s.LENGTH_FIN_MASK));)if(this._list.length<=r){i=!1;break}return a&&(this._pos+=r),i=!!i&&(e?{bytes:r,value:o}:o)},d.prototype._parseByte=function(){var e=this._list.readUInt8(this._pos);return this._pos++,e},d.prototype._parseByType=function(e){switch(e){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},d.prototype._parseProperties=function(){for(var e=this._parseVarByteNum(),t=this._pos+e,r={};this._pos<t;){var n,o=this._parseByte(),o=s.propertiesCodes[o];if(!o)return this._emitError(new Error("Unknown property")),!1;"userProperties"===o?(r[o]||(r[o]={}),n=this._parseByType(s.propertiesTypes[o]),r[o][n.name]=n.value):r[o]=this._parseByType(s.propertiesTypes[o])}return r},d.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new a,!(this._pos=0)},d.prototype._emitError=function(e){this.error=e,this.emit("error",e)},t.exports=d},{"./constants":82,"./packet":87,bl:85,events:13,inherits:80}],89:[function(e,t,r){"use strict";var ye=e("./constants"),ve=e("safe-buffer").Buffer,be=ve.allocUnsafe(0),_e=ve.from([0]),n=e("./numbers"),Se=e("process-nextick-args").nextTick,o=n.cache,i=n.generateNumber,we=n.generateCache,a=n.genBufVariableByteInt,s=n.generate4ByteBuffer,Ee=u,Ie=!0;function d(e,t,r){switch(t.cork&&(t.cork(),Se(Te,t)),Ie&&(Ie=!1,we()),e.cmd){case"connect":var n=t,o=(p=(p=e)||{}).protocolId||"MQTT",i=p.protocolVersion||4,a=p.will,s=p.clean,d=p.keepalive||0,l=p.clientId||"",u=p.username,c=p.password,p=p.properties,h=(void 0===s&&(s=!0),0);if(!o||"string"!=typeof o&&!ve.isBuffer(o))return n.emit("error",new Error("Invalid protocolId")),!1;if(h+=o.length+2,3!==i&&4!==i&&5!==i)return n.emit("error",new Error("Invalid protocol version")),!1;if(h+=1,"string"!=typeof l&&!ve.isBuffer(l)||!l&&4!==i||!l&&!s){if(i<4)return n.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(0==+s)return n.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else h+=l.length+2;if("number"!=typeof d||d<0||65535<d||d%1!=0)return n.emit("error",new Error("Invalid keepalive")),!1;if(h=h+2+1,5===i&&(H=ke(n,p),h+=H.length),a){if("object"!=typeof a)return n.emit("error",new Error("Invalid will")),!1;if(!a.topic||"string"!=typeof a.topic)return n.emit("error",new Error("Invalid will topic")),!1;if(h+=ve.byteLength(a.topic)+2,a.payload){if(!(0<=a.payload.length))return n.emit("error",new Error("Invalid will payload")),!1;"string"==typeof a.payload?h+=ve.byteLength(a.payload)+2:h+=a.payload.length+2;var f={};5===i&&(f=ke(n,a.properties),h+=f.length)}}if(p=!1,null!=u){if(!Ae(u))return n.emit("error",new Error("Invalid username")),!1;p=!0,h+=ve.byteLength(u)+2}if(null!=c){if(!p)return n.emit("error",new Error("Username is required to use password")),!1;if(!Ae(c))return n.emit("error",new Error("Invalid password")),!1;h+=Me(c)+2}return n.write(ye.CONNECT_HEADER),Ce(n,h),Pe(n,o),n.write(4===i?ye.VERSION4:5===i?ye.VERSION5:ye.VERSION3),p=0,p=(p=(p=(p=(p=(p|=null!=u?ye.USERNAME_MASK:0)|(null!=c?ye.PASSWORD_MASK:0))|(a&&a.retain?ye.WILL_RETAIN_MASK:0))|(a&&a.qos?a.qos<<ye.WILL_QOS_SHIFT:0))|(a?ye.WILL_FLAG_MASK:0))|(s?ye.CLEAN_SESSION_MASK:0),n.write(ve.from([p])),Ee(n,d),5===i&&H.write(),Pe(n,l),a&&(5===i&&f.write(),Re(n,a.topic),Pe(n,a.payload)),null!=u&&Pe(n,u),null!=c&&Pe(n,c),!0;case"connack":var h=e,o=t,s=(s=r)?s.protocolVersion:4,h=h||{},p=5===s?h.reasonCode:h.returnCode,d=h.properties,H=2;return"number"!=typeof p?(o.emit("error",new Error("Invalid return code")),!1):(l=null,5===s&&(l=ke(o,d),H+=l.length),o.write(ye.CONNACK_HEADER),Ce(o,H),o.write(h.sessionPresent?ye.SESSIONPRESENT_HEADER:_e),o.write(ve.from([p])),null!=l&&l.write(),!0);case"publish":var i=e,f=t,a=(a=r)?a.protocolVersion:4,u=(i=i||{}).qos||0,n=i.retain?ye.RETAIN_MASK:0,c=i.topic,m=i.payload||be,L=i.messageId,g=i.properties,y=0;if("string"==typeof c)y+=ve.byteLength(c)+2;else{if(!ve.isBuffer(c))return f.emit("error",new Error("Invalid topic")),!1;y+=c.length+2}if(ve.isBuffer(m)?y+=m.length:y+=ve.byteLength(m),u&&"number"!=typeof L)return f.emit("error",new Error("Invalid messageId")),!1;u&&(y+=2);var v=null;return 5===a&&(v=ke(f,g),y+=v.length),f.write(ye.PUBLISH_HEADER[u][i.dup?1:0][n?1:0]),Ce(f,y),Ee(f,Me(c)),f.write(c),0<u&&Ee(f,L),null!=v&&v.write(),f.write(m);case"puback":case"pubrec":case"pubrel":case"pubcomp":var g=e,y=t,L=r,v=L?L.protocolVersion:4,m=(g=g||{}).cmd||"puback",b=g.messageId,_=g.dup&&"pubrel"===m?ye.DUP_MASK:0,N=0,B=g.reasonCode,g=g.properties,j=5===v?3:2;if("pubrel"===m&&(N=1),"number"!=typeof b)return y.emit("error",new Error("Invalid messageId")),!1;var S=null;if(5===v){if(!(S=xe(y,g,L,j)))return!1;j+=S.length}return y.write(ye.ACKS[m][N][_][0]),Ce(y,j),Ee(y,b),5===v&&y.write(ve.from([B])),null!==S&&S.write(),!0;case"subscribe":var N=e,w=t,V=(_=r)?_.protocolVersion:4,N=(_=N||{}).dup?ye.DUP_MASK:0,j=_.messageId,E=_.subscriptions,_=_.properties,F=0;if("number"!=typeof j)return w.emit("error",new Error("Invalid messageId")),!1;F+=2;b=null;if(5===V&&(b=ke(w,_),F+=b.length),"object"!=typeof E||!E.length)return w.emit("error",new Error("Invalid subscriptions")),!1;for(var I=0;I<E.length;I+=1){var q=E[I].topic,G=E[I].qos;if("string"!=typeof q)return w.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof G)return w.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===V){if("boolean"!=typeof(E[I].nl||!1))return w.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;if("boolean"!=typeof(E[I].rap||!1))return w.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;G=E[I].rh||0;if("number"!=typeof G||2<G)return w.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}F+=ve.byteLength(q)+2+1}w.write(ye.SUBSCRIBE_HEADER[1][N?1:0][0]),Ce(w,F),Ee(w,j),null!==b&&b.write();for(var W=!0,z=0;z<E.length;z++){var T=E[z],Y=T.topic,K=T.qos,X=+T.nl,J=+T.rap,T=T.rh;Re(w,Y),Y=ye.SUBSCRIBE_OPTIONS_QOS[K],5===V&&(Y=(Y=(Y|=X?ye.SUBSCRIBE_OPTIONS_NL:0)|(J?ye.SUBSCRIBE_OPTIONS_RAP:0))|(T?ye.SUBSCRIBE_OPTIONS_RH[T]:0)),W=w.write(ve.from([Y]))}return W;case"suback":var B=e,C=t,S=r,R=S?S.protocolVersion:4,Q=(B=B||{}).messageId,Z=B.granted,B=B.properties,$=0;if("number"!=typeof Q)return C.emit("error",new Error("Invalid messageId")),!1;if($+=2,"object"!=typeof Z||!Z.length)return C.emit("error",new Error("Invalid qos vector")),!1;for(var ee=0;ee<Z.length;ee+=1){if("number"!=typeof Z[ee])return C.emit("error",new Error("Invalid qos vector")),!1;$+=1}var te=null;if(5===R){if(!(te=xe(C,B,S,$)))return!1;$+=te.length}return C.write(ye.SUBACK_HEADER),Ce(C,$),Ee(C,Q),null!==te&&te.write(),C.write(ve.from(Z));case"unsubscribe":var R=e,P=t,Q=(Q=r)?Q.protocolVersion:4,te=(R=R||{}).messageId,k=R.dup?ye.DUP_MASK:0,x=R.unsubscriptions,R=R.properties,re=0;if("number"!=typeof te)return P.emit("error",new Error("Invalid messageId")),!1;if(re+=2,"object"!=typeof x||!x.length)return P.emit("error",new Error("Invalid unsubscriptions")),!1;for(var ne=0;ne<x.length;ne+=1){if("string"!=typeof x[ne])return P.emit("error",new Error("Invalid unsubscriptions")),!1;re+=ve.byteLength(x[ne])+2}var M=null;5===Q&&(M=ke(P,R),re+=M.length),P.write(ye.UNSUBSCRIBE_HEADER[1][k?1:0][0]),Ce(P,re),Ee(P,te),null!==M&&M.write();for(var oe=!0,ie=0;ie<x.length;ie++)oe=Re(P,x[ie]);return oe;case"unsuback":var k=e,A=t,M=r,ae=M?M.protocolVersion:4,se=(k=k||{}).messageId,de=k.dup?ye.DUP_MASK:0,le=k.granted,ue=k.properties,k=k.cmd,ce=2;if("number"!=typeof se)return A.emit("error",new Error("Invalid messageId")),!1;if(5===ae){if("object"!=typeof le||!le.length)return A.emit("error",new Error("Invalid qos vector")),!1;for(var pe=0;pe<le.length;pe+=1){if("number"!=typeof le[pe])return A.emit("error",new Error("Invalid qos vector")),!1;ce+=1}}var O=null;if(5===ae){if(!(O=xe(A,ue,M,ce)))return!1;ce+=O.length}return A.write(ye.ACKS[k][0][de][0]),Ce(A,ce),Ee(A,se),null!==O&&O.write(),5===ae&&A.write(ve.from(le)),!0;case"pingreq":case"pingresp":return t.write(ye.EMPTY[e.cmd]);case"disconnect":var ue=e,de=t,se=r,O=se?se.protocolVersion:4,ae=(ue=ue||{}).reasonCode,ue=ue.properties,U=5===O?1:0,D=null;if(5===O){if(!(D=xe(de,ue,se,U)))return!1;U+=D.length}return de.write(ve.from([ye.codes.disconnect<<4])),Ce(de,U),5===O&&de.write(ve.from([ae])),null!==D&&D.write(),!0;case"auth":var U=e,D=t,he=r,fe=he?he.protocolVersion:4,me=(U=U||{}).reasonCode,U=U.properties,ge=5===fe?1:0;return(5!==fe&&D.emit("error",new Error("Invalid mqtt version for auth packet")),fe=xe(D,U,he,ge))?(ge+=fe.length,D.write(ve.from([ye.codes.auth<<4])),Ce(D,ge),D.write(ve.from([me])),null!==fe&&fe.write(),!0):!1;default:return t.emit("error",new Error("Unknown command")),!1}}function Te(e){e.uncork()}Object.defineProperty(d,"cacheNumbers",{get:function(){return Ee===u},set:function(e){Ee=e?(o&&0!==Object.keys(o).length||(Ie=!0),u):(Ie=!1,c)}});var l={};function Ce(e,t){var r=l[t];r||(r=a(t).data,t<16384&&(l[t]=r)),e.write(r)}function Re(e,t){var r=ve.byteLength(t);Ee(e,r),e.write(t,"utf8")}function u(e,t){return e.write(o[t])}function c(e,t){return e.write(i(t))}function Pe(e,t){"string"==typeof t?Re(e,t):t?(Ee(e,t.length),e.write(t)):Ee(e,0)}function ke(o,i){if("object"!=typeof i||null!=i.length)return{length:1,write:function(){p(o,{},0)}};var e=0;if(i)for(var t in i){t=function(e){var t=ye.propertiesTypes[e],r=i[e],n=0;switch(t){case"byte":if("boolean"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=2;break;case"int8":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=2;break;case"binary":if(r&&null===r)return o.emit("error",new Error("Invalid "+e)),!1;n+=1+ve.byteLength(r)+2;break;case"int16":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=3;break;case"int32":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=5;break;case"var":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=1+a(r).length;break;case"string":if("string"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=3+ve.byteLength(r.toString());break;case"pair":if("object"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=Object.getOwnPropertyNames(r).reduce(function(e,t){return e+=3+ve.byteLength(t.toString())+2+ve.byteLength(r[t].toString())},0);break;default:return o.emit("error",new Error("Invalid property "+e)),!1}return n}(t);if(!t)return!1;e+=t}return{length:a(e).length+e,write:function(){p(o,i,e)}}}function xe(e,t,r,n){var o=["reasonString","userProperties"],i=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,a=ke(e,t);if(i)for(;n+a.length>i;){var s=o.shift();if(!s||!t[s])return!1;delete t[s],a=ke(e,t)}return a}function p(n,e,t){for(var o in Ce(n,t),e)if(e.hasOwnProperty(o)&&null!==e[o]){var i=e[o];switch(ye.propertiesTypes[o]){case"byte":n.write(ve.from([ye.properties[o]])),n.write(ve.from([+i]));break;case"int8":n.write(ve.from([ye.properties[o]])),n.write(ve.from([i]));break;case"binary":n.write(ve.from([ye.properties[o]])),Pe(n,i);break;case"int16":n.write(ve.from([ye.properties[o]])),Ee(n,i);break;case"int32":n.write(ve.from([ye.properties[o]])),n.write(s(i));break;case"var":n.write(ve.from([ye.properties[o]])),Ce(n,i);break;case"string":n.write(ve.from([ye.properties[o]])),Re(n,i);break;case"pair":Object.getOwnPropertyNames(i).forEach(function(e){var t,r;n.write(ve.from([ye.properties[o]])),t=n,r=e.toString(),e=i[e].toString(),Re(t,r),Re(t,e)});break;default:return void n.emit("error",new Error("Invalid property "+o))}}}function Me(e){return e?e instanceof ve?e.length:ve.byteLength(e):0}function Ae(e){return"string"==typeof e||e instanceof ve}t.exports=d},{"./constants":82,"./numbers":86,"process-nextick-args":91,"safe-buffer":110}],90:[function(e,t,r){e=e("wrappy");function n(e){function t(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))}return t.called=!1,t}function o(e){function t(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)}var r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}t.exports=e(n),t.exports.strict=e(o),n.proto=n(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})})},{wrappy:120}],91:[function(e,t,r){!function(s){"use strict";!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,i,a=arguments.length;switch(a){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick(function(){e.call(null,t)});case 3:return s.nextTick(function(){e.call(null,t,r)});case 4:return s.nextTick(function(){e.call(null,t,r,n)});default:for(o=new Array(a-1),i=0;i<o.length;)o[i++]=arguments[i];return s.nextTick(function(){e.apply(null,o)})}}}:t.exports=s}.call(this,e("_process"))},{_process:92}],92:[function(e,t,r){var n,o,t=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===i||!n)&&setTimeout)return(n=setTimeout)(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}var d,l=[],u=!1,c=-1;function p(){u&&d&&(u=!1,d.length?l=d.concat(l):c=-1,l.length)&&h()}function h(){if(!u){for(var e=s(p),t=(u=!0,l.length);t;){for(d=l,l=[];++c<t;)d&&d[c].run();c=-1,t=l.length}d=null,u=!1,!function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return(o=clearTimeout)(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||u||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=m,t.addListener=m,t.once=m,t.off=m,t.removeListener=m,t.removeAllListeners=m,t.emit=m,t.prependListener=m,t.prependOnceListener=m,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],93:[function(e,R,P){!function(e){var t=this,r="object"==typeof P&&P&&!P.nodeType&&P,n="object"==typeof R&&R&&!R.nodeType&&R,e="object"==typeof e&&e;e.global!==e&&e.window!==e&&e.self!==e||(t=e);var o,i,g=2147483647,y=36,v=26,a=38,s=700,d=/^xn--/,l=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,c={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=y-1,b=Math.floor,_=String.fromCharCode;function S(e){throw new RangeError(c[e])}function h(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function f(e,t){var r=e.split("@"),n="",r=(1<r.length&&(n=r[0]+"@",e=r[1]),(e=e.replace(u,".")).split("."));return n+h(r,t).join(".")}function w(e){for(var t,r,n=[],o=0,i=e.length;o<i;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function m(e){return h(e,function(e){var t="";return 65535<e&&(t+=_((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=_(e)}).join("")}function E(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function I(e,t,r){var n=0;for(e=r?b(e/s):e>>1,e+=b(e/t);p*v>>1<e;n+=y)e=b(e/p);return b(n+(p+1)*e/(e+a))}function T(e){var t,r,n,o,i,a,s,d=[],l=e.length,u=0,c=128,p=72,h=e.lastIndexOf("-");for(h<0&&(h=0),r=0;r<h;++r)128<=e.charCodeAt(r)&&S("not-basic"),d.push(e.charCodeAt(r));for(n=0<h?h+1:0;n<l;){for(o=u,i=1,a=y;l<=n&&S("invalid-input"),s=e.charCodeAt(n++),(y<=(s=s-48<10?s-22:s-65<26?s-65:s-97<26?s-97:y)||s>b((g-u)/i))&&S("overflow"),u+=s*i,!(s<(s=a<=p?1:p+v<=a?v:a-p));a+=y)i>b(g/(s=y-s))&&S("overflow"),i*=s;p=I(u-o,t=d.length+1,0==o),b(u/t)>g-c&&S("overflow"),c+=b(u/t),u%=t,d.splice(u++,0,c)}return m(d)}function C(e){for(var t,r,n,o,i,a,s,d,l,u,c=[],p=(e=w(e)).length,h=128,f=72,m=t=0;m<p;++m)(s=e[m])<128&&c.push(_(s));for(r=n=c.length,n&&c.push("-");r<p;){for(o=g,m=0;m<p;++m)h<=(s=e[m])&&s<o&&(o=s);for(o-h>b((g-t)/(d=r+1))&&S("overflow"),t+=(o-h)*d,h=o,m=0;m<p;++m)if((s=e[m])<h&&++t>g&&S("overflow"),s==h){for(i=t,a=y;!(i<(l=a<=f?1:f+v<=a?v:a-f));a+=y)c.push(_(E(l+(u=i-l)%(l=y-l),0))),i=b(u/l);c.push(_(E(i,0))),f=I(t,d,r==n),t=0,++r}++t,++h}return c.join("")}if(o={version:"1.4.1",ucs2:{decode:w,encode:m},decode:T,encode:C,toASCII:function(e){return f(e,function(e){return l.test(e)?"xn--"+C(e):e})},toUnicode:function(e){return f(e,function(e){return d.test(e)?T(e.slice(4).toLowerCase()):e})}},r&&n)if(R.exports==r)n.exports=o;else for(i in o)o.hasOwnProperty(i)&&(r[i]=o[i]);else t.punycode=o}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],94:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){t=t||"&",r=r||"=";var o={};if("string"==typeof e&&0!==e.length){var i=/\+/g,t=(e=e.split(t),1e3),a=(n&&"number"==typeof n.maxKeys&&(t=n.maxKeys),e.length);0<t&&t<a&&(a=t);for(var s=0;s<a;++s){var d,l=e[s].replace(i,"%20"),u=l.indexOf(r),u=0<=u?(d=l.substr(0,u),l.substr(u+1)):(d=l,""),l=decodeURIComponent(d),u=decodeURIComponent(u);Object.prototype.hasOwnProperty.call(o,l)?c(o[l])?o[l].push(u):o[l]=[o[l],u]:o[l]=u}}return o};var c=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],95:[function(e,t,r){"use strict";function i(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}t.exports=function(r,n,o,e){return n=n||"&",o=o||"=","object"==typeof(r=null===r?void 0:r)?s(d(r),function(e){var t=encodeURIComponent(i(e))+o;return a(r[e])?s(r[e],function(e){return t+encodeURIComponent(i(e))}).join(n):t+encodeURIComponent(i(r[e]))}).join(n):e?encodeURIComponent(i(e))+o+encodeURIComponent(i(r)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var d=Object.keys||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push(t);return r}},{}],96:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":94,"./encode":95}],97:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":98}],98:[function(e,t,r){"use strict";var n=e("process-nextick-args"),o=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r},t=(t.exports=u,e("core-util-is")),i=(t.inherits=e("inherits"),e("./_stream_readable")),a=e("./_stream_writable");t.inherits(u,i);for(var s=o(a.prototype),d=0;d<s.length;d++){var l=s[d];u.prototype[l]||(u.prototype[l]=a.prototype[l])}function u(e){if(!(this instanceof u))return new u(e);i.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",c)}function c(){this.allowHalfOpen||this._writableState.ended||n.nextTick(p,this)}function p(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),u.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":14,inherits:80,"process-nextick-args":91}],99:[function(e,t,r){"use strict";t.exports=o;var n=e("./_stream_transform"),t=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e)}t.inherits=e("inherits"),t.inherits(o,n),o.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":101,"core-util-is":14,inherits:80}],100:[function(M,A,e){!function(m,e){"use strict";function g(e,t){return e.listeners(t).length}var i,y=M("process-nextick-args"),v=(A.exports=o,M("isarray")),r=(o.ReadableState=n,M("events").EventEmitter,M("./internal/streams/stream")),u=M("safe-buffer").Buffer,c=e.Uint8Array||function(){};var a,e=M("core-util-is"),t=(e.inherits=M("inherits"),M("util")),b=void 0,b=t&&t.debuglog?t.debuglog("stream"):function(){},s=M("./internal/streams/BufferList"),t=M("./internal/streams/destroy"),d=(e.inherits(o,r),["error","close","destroy","pause","resume"]);function n(e,t){e=e||{};var t=t instanceof(i=i||M("./_stream_duplex")),r=(this.objectMode=!!e.objectMode,t&&(this.objectMode=this.objectMode||!!e.readableObjectMode),e.highWaterMark),n=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:t&&(n||0===n)?n:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new s,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(a=a||M("string_decoder/").StringDecoder,this.decoder=new a(e.encoding),this.encoding=e.encoding)}function o(e){if(i=i||M("./_stream_duplex"),!(this instanceof o))return new o(e);this._readableState=new n(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy)&&(this._destroy=e.destroy),r.call(this)}function l(e,t,r,n,o){var i,a,s,d,l=e._readableState;return null===t?(l.reading=!1,a=e,(d=l).ended||(d.decoder&&(s=d.decoder.end())&&s.length&&(d.buffer.push(s),d.length+=d.objectMode?1:s.length),d.ended=!0,_(a))):(i=o?i:function(e,t){var r;!function(e){return u.isBuffer(e)||e instanceof c}(t)&&"string"!=typeof t&&void 0!==t&&!e.objectMode&&(r=new TypeError("Invalid non-string/buffer chunk"));return r}(l,t))?e.emit("error",i):l.objectMode||t&&0<t.length?("string"==typeof t||l.objectMode||Object.getPrototypeOf(t)===u.prototype||(s=t,t=u.from(s)),n?l.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):p(e,l,t,!0):l.ended?e.emit("error",new Error("stream.push() after EOF")):(l.reading=!1,!l.decoder||r||(t=l.decoder.write(t),l.objectMode)||0!==t.length?p(e,l,t,!1):w(e,l))):n||(l.reading=!1),!(d=l).ended&&(d.needReadable||d.length<d.highWaterMark||0===d.length)}function p(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&_(e)),w(e,t)}Object.defineProperty(o.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),o.prototype.destroy=t.destroy,o.prototype._undestroy=t.undestroy,o.prototype._destroy=function(e,t){this.push(null),t(e)},o.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=u.from(e,t),t=""),r=!0),l(this,e,t,!1,r)},o.prototype.unshift=function(e){return l(this,e,null,!0,!1)},o.prototype.isPaused=function(){return!1===this._readableState.flowing},o.prototype.setEncoding=function(e){return a=a||M("string_decoder/").StringDecoder,this._readableState.decoder=new a(e),this._readableState.encoding=e,this};var h=8388608;function f(e,t){var r;return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?(t.flowing&&t.length?t.buffer.head.data:t).length:(e>t.highWaterMark&&(t.highWaterMark=(h<=(r=e)?r=h:(r--,r=(r=(r=(r=(r|=r>>>1)|r>>>2)|r>>>4)|r>>>8)|r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function _(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(b("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?y.nextTick(S,e):S(e))}function S(e){b("emit readable"),e.emit("readable"),C(e)}function w(e,t){t.readingMore||(t.readingMore=!0,y.nextTick(E,e,t))}function E(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(b("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function I(e){b("readable nexttick read 0"),e.read(0)}function T(e,t){t.reading||(b("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),C(e),t.flowing&&!t.reading&&e.read(0)}function C(e){var t=e._readableState;for(b("flow",t.flowing);t.flowing&&null!==e.read(););}function R(e,t){var r;return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():(r?function(e,t){var r=t.head,n=1,o=r.data;e-=o.length;for(;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(a===i.length?o+=i:o+=i.slice(0,e),0===(e-=a)){a===i.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=i.slice(a);break}++n}return t.length-=n,o}:function(e,t){var r=u.allocUnsafe(e),n=t.head,o=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var i=n.data,a=e>i.length?i.length:e;if(i.copy(r,r.length-e,0,a),0===(e-=a)){a===i.length?(++o,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=i.slice(a);break}++o}return t.length-=o,r})(e,t);return n}(e,t.buffer,t.decoder),r)}function P(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,y.nextTick(k,t,e))}function k(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function x(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}o.prototype.read=function(e){b("read",e),e=parseInt(e,10);var t,r=this._readableState,n=e;return 0!==e&&(r.emittedReadable=!1),0===e&&r.needReadable&&(r.length>=r.highWaterMark||r.ended)?(b("read: emitReadable",r.length,r.ended),(0===r.length&&r.ended?P:_)(this),null):0===(e=f(e,r))&&r.ended?(0===r.length&&P(this),null):(t=r.needReadable,b("need readable",t),(0===r.length||r.length-e<r.highWaterMark)&&b("length less than watermark",t=!0),r.ended||r.reading?b("reading or ended",t=!1):t&&(b("do read"),r.reading=!0,r.sync=!0,0===r.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(e=f(n,r))),null===(t=0<e?R(e,r):null)?(r.needReadable=!0,e=0):r.length-=e,0===r.length&&(r.ended||(r.needReadable=!0),n!==e)&&r.ended&&P(this),null!==t&&this.emit("data",t),t)},o.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},o.prototype.pipe=function(r,e){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=r;break;case 1:o.pipes=[o.pipes,r];break;default:o.pipes.push(r)}o.pipesCount+=1,b("pipe count=%d opts=%j",o.pipesCount,e);e=(!e||!1!==e.end)&&r!==m.stdout&&r!==m.stderr?a:f;function i(e,t){b("onunpipe"),e===n&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,b("cleanup"),r.removeListener("close",p),r.removeListener("finish",h),r.removeListener("drain",s),r.removeListener("error",c),r.removeListener("unpipe",i),n.removeListener("end",a),n.removeListener("end",f),n.removeListener("data",u),d=!0,!o.awaitDrain||r._writableState&&!r._writableState.needDrain||s())}function a(){b("onend"),r.end()}o.endEmitted?y.nextTick(e):n.once("end",e),r.on("unpipe",i);t=n;var t,s=function(){var e=t._readableState;b("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&g(t,"data")&&(e.flowing=!0,C(t))},d=(r.on("drain",s),!1);var l=!1;function u(e){b("ondata"),(l=!1)!==r.write(e)||l||((1===o.pipesCount&&o.pipes===r||1<o.pipesCount&&-1!==x(o.pipes,r))&&!d&&(b("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,l=!0),n.pause())}function c(e){b("onerror",e),f(),r.removeListener("error",c),0===g(r,"error")&&r.emit("error",e)}function p(){r.removeListener("finish",h),f()}function h(){b("onfinish"),r.removeListener("close",p),f()}function f(){b("unpipe"),n.unpipe(r)}return n.on("data",u),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?v(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(r,"error",c),r.once("close",p),r.once("finish",h),r.emit("pipe",n),o.flowing||(b("pipe resume"),n.resume()),r},o.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0!==t.pipesCount)if(1===t.pipesCount)e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r));else if(e){var n=x(t.pipes,e);-1!==n&&(t.pipes.splice(n,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r))}else{var o=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)o[a].emit("unpipe",this,r)}return this},o.prototype.addListener=o.prototype.on=function(e,t){t=r.prototype.on.call(this,e,t);return"data"===e?!1!==this._readableState.flowing&&this.resume():"readable"!==e||(e=this._readableState).endEmitted||e.readableListening||(e.readableListening=e.needReadable=!0,e.emittedReadable=!1,e.reading?e.length&&_(this):y.nextTick(I,this)),t},o.prototype.resume=function(){var e,t=this._readableState;return t.flowing||(b("resume"),t.flowing=!0,e=this,(t=t).resumeScheduled)||(t.resumeScheduled=!0,y.nextTick(T,e,t)),this},o.prototype.pause=function(){return b("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(b("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(t){var e,r=this,n=this._readableState,o=!1;for(e in t.on("end",function(){var e;b("wrapped end"),n.decoder&&!n.ended&&(e=n.decoder.end())&&e.length&&r.push(e),r.push(null)}),t.on("data",function(e){b("wrapped data"),n.decoder&&(e=n.decoder.write(e)),n.objectMode&&null==e||(n.objectMode||e&&e.length)&&!r.push(e)&&(o=!0,t.pause())}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var i=0;i<d.length;i++)t.on(d[i],this.emit.bind(this,d[i]));return this._read=function(e){b("wrapped _read",e),o&&(o=!1,t.resume())},this},Object.defineProperty(o.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),o._fromList=R}.call(this,M("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":98,"./internal/streams/BufferList":103,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,events:13,inherits:80,isarray:106,"process-nextick-args":91,"safe-buffer":110,"string_decoder/":107,util:11}],101:[function(e,t,r){"use strict";t.exports=o;var n=e("./_stream_duplex"),t=e("core-util-is");function o(e){if(!(this instanceof o))return new o(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState,n=(r.transforming=!1,r.writecb);if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=t&&this.push(t),n(e),(r=this._readableState).reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush)&&(this._flush=e.flush),this.on("prefinish",i)}function i(){var r=this;"function"==typeof this._flush?this._flush(function(e,t){a(r,e,t)}):a(this,null,null)}function a(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");e.push(null)}t.inherits=e("inherits"),t.inherits(o,n),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,r){var n=this._transformState;n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming&&(r=this._readableState,n.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":98,"core-util-is":14,inherits:80}],102:[function(l,u,e){!function(e,t,r){"use strict";var h=l("process-nextick-args");function c(i){var a=this;this.next=null,this.entry=null,this.finish=function(){var e=a,t=i,r=void 0,n=e.entry;for(e.entry=null;n;){var o=n.callback;t.pendingcb--,o(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}}u.exports=s;var i,p=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?r:h.nextTick,e=(s.WritableState=a,l("core-util-is")),r=(e.inherits=l("inherits"),{deprecate:l("util-deprecate")}),n=l("./internal/streams/stream"),f=l("safe-buffer").Buffer,m=t.Uint8Array||function(){};var o,t=l("./internal/streams/destroy");function g(){}function a(e,u){i=i||l("./_stream_duplex"),e=e||{};var t=u instanceof i,r=(this.objectMode=!!e.objectMode,t&&(this.objectMode=this.objectMode||!!e.writableObjectMode),e.highWaterMark),n=e.writableHighWaterMark,o=this.objectMode?16:16384,r=(this.highWaterMark=r||0===r?r:t&&(n||0===n)?n:o,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,(this.destroyed=!1)===e.decodeStrings);this.decodeStrings=!r,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){e=e,r=(t=u)._writableState,n=r.sync,o=r.writecb;var t,r,n,o,i=r;{var a,s,d,l;(i.writing=!1,i.writecb=null,i.length-=i.writelen,i.writelen=0,e)?(i=t,s=n,d=e,l=o,--(a=r).pendingcb,s?(h.nextTick(l,d),h.nextTick(S,i,a),i._writableState.errorEmitted=!0,i.emit("error",d)):(l(d),i._writableState.errorEmitted=!0,i.emit("error",d),S(i,a))):((e=_(r))||r.corked||r.bufferProcessing||!r.bufferedRequest||b(t,r),n?p(v,t,r,e,o):v(t,r,e,o))}},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new c(this)}e.inherits(s,n),a.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t};try{Object.defineProperty(a.prototype,"buffer",{get:r.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}function s(e){if(i=i||l("./_stream_duplex"),!(o.call(s,this)||this instanceof i))return new s(e);this._writableState=new a(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final)&&(this._final=e.final),n.call(this)}function y(e,t,r,n,o,i,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(o,t.onwrite):e._write(o,i,t.onwrite),t.sync=!1}function v(e,t,r,n){var o;r||(r=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,r.emit("drain"))),t.pendingcb--,n(),S(e,t)}function b(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){for(var n=t.bufferedRequestCount,o=new Array(n),n=t.corkedRequestsFree,i=(n.entry=r,0),a=!0;r;)(o[i]=r).isBuf||(a=!1),r=r.next,i+=1;o.allBuffers=a,y(e,t,!0,t.length,o,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new c(t),t.bufferedRequestCount=0}else{for(;r;){var s=r.chunk,d=r.encoding,l=r.callback;if(y(e,t,!1,t.objectMode?1:s.length,s,d,l),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function _(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function d(t,r){t._final(function(e){r.pendingcb--,e&&t.emit("error",e),r.prefinished=!0,t.emit("prefinish"),S(t,r)})}function S(e,t){var r,n,o=_(t);return o&&(r=e,(n=t).prefinished||n.finalCalled||("function"==typeof r._final?(n.pendingcb++,n.finalCalled=!0,h.nextTick(d,r,n)):(n.prefinished=!0,r.emit("prefinish"))),0===t.pendingcb)&&(t.finished=!0,e.emit("finish")),o}"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(o=Function.prototype[Symbol.hasInstance],Object.defineProperty(s,Symbol.hasInstance,{value:function(e){return!!o.call(this,e)||this===s&&e&&e._writableState instanceof a}})):o=function(e){return e instanceof this},s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},s.prototype.write=function(e,t,r){var n,o,i,a,s,d,l,u=this._writableState,c=!1,p=!u.objectMode&&(p=e,f.isBuffer(p)||p instanceof m);return p&&!f.isBuffer(e)&&(s=e,e=f.from(s)),"function"==typeof t&&(r=t,t=null),t=p?"buffer":t||u.defaultEncoding,"function"!=typeof r&&(r=g),u.ended?(s=this,d=r,l=new Error("write after end"),s.emit("error",l),h.nextTick(d,l)):(p||(d=this,l=u,o=r,a=!(i=!0),null===(n=e)?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||l.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(d.emit("error",a),h.nextTick(o,a),i=!1),i))&&(u.pendingcb++,c=function(e,t,r,n,o,i){r||(a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,r));return t}(t,n,o),n!==a&&(r=!0,o="buffer",n=a));var a=t.objectMode?1:n.length,s=(t.length+=a,t.length<t.highWaterMark);s||(t.needDrain=!0);{var d;t.writing||t.corked?(d=t.lastBufferedRequest,t.lastBufferedRequest={chunk:n,encoding:o,isBuf:r,callback:i,next:null},d?d.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1):y(e,t,!1,a,n,o,i)}return s}(this,u,p,e,t,r)),c},s.prototype.cork=function(){this._writableState.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||b(this,e))},s.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase()))return this._writableState.defaultEncoding=e,this;throw new TypeError("Unknown encoding: "+e)},Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),s.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||(e=this,t=r,(r=n).ending=!0,S(e,r),t&&(r.finished?h.nextTick(t):e.once("finish",t)),r.ended=!0,e.writable=!1)},Object.defineProperty(s.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),s.prototype.destroy=t.destroy,s.prototype._undestroy=t.undestroy,s.prototype._destroy=function(e,t){this.end(),t(e)}}.call(this,l("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},l("timers").setImmediate)},{"./_stream_duplex":98,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,inherits:80,"process-nextick-args":91,"safe-buffer":110,timers:112,"util-deprecate":115}],103:[function(e,t,r){"use strict";var a=e("safe-buffer").Buffer,n=e("util");function o(){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.head=null,this.tail=null,this.length=0}t.exports=(o.prototype.push=function(e){e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},o.prototype.unshift=function(e){e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},o.prototype.shift=function(){var e;if(0!==this.length)return e=this.head.data,1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e},o.prototype.clear=function(){this.head=this.tail=null,this.length=0},o.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},o.prototype.concat=function(e){if(0===this.length)return a.alloc(0);if(1===this.length)return this.head.data;for(var t,r,n=a.allocUnsafe(e>>>0),o=this.head,i=0;o;)t=o.data,r=i,t.copy(n,r),i+=o.data.length,o=o.next;return n},o),n&&n.inspect&&n.inspect.custom&&(t.exports.prototype[n.inspect.custom]=function(){var e=n.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":110,util:11}],104:[function(e,t,r){"use strict";var i=e("process-nextick-args");function a(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return n||o?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(a,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i.nextTick(a,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":91}],105:[function(e,t,r){t.exports=e("events").EventEmitter},{events:13}],106:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],107:[function(e,t,r){"use strict";var n=e("safe-buffer").Buffer,o=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"==typeof t||n.isEncoding!==o&&o(e))return t||e;throw new Error("Unknown encoding: "+e)}function a(e){var t;switch(this.encoding=i(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=d,t=4;break;case"base64":this.text=c,this.end=p,t=3;break;default:return this.write=h,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function d(e){var t,r=this.lastTotal-this.lastNeed,n=(t=this,128!=(192&(n=e)[0])?(t.lastNeed=0,"�"):1<t.lastNeed&&1<n.length?128!=(192&n[1])?(t.lastNeed=1,"�"):2<t.lastNeed&&2<n.length&&128!=(192&n[2])?(t.lastNeed=2,"�"):void 0:void 0);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,r,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,r,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);t=e.toString("utf16le",t);if(t){var r=t.charCodeAt(t.length-1);if(55296<=r&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],t.slice(0,-1)}return t}function u(e){var t,e=e&&e.length?this.write(e):"";return this.lastNeed?(t=this.lastTotal-this.lastNeed,e+this.lastChar.toString("utf16le",0,t)):e}function c(e,t){var r=(e.length-t)%3;return 0==r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function p(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function h(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}(r.StringDecoder=a).prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){e=e&&e.length?this.write(e):"";return this.lastNeed?e+"�":e},a.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(!(n<r)){var o=s(t[n]);if(0<=o)return 0<o&&(e.lastNeed=o-1),o;if(!(--n<r||-2===o)){if(0<=(o=s(t[n])))return 0<o&&(e.lastNeed=o-2),o;if(!(--n<r||-2===o)&&0<=(o=s(t[n])))return 0<o&&(2===o?o=0:e.lastNeed=o-3),o}}return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;r=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":110}],108:[function(e,t,r){(((r=t.exports=e("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":98,"./lib/_stream_passthrough.js":99,"./lib/_stream_readable.js":100,"./lib/_stream_transform.js":101,"./lib/_stream_writable.js":102}],109:[function(e,t,r){"use strict";function n(e,t,r){var n=this;this._callback=e,this._args=r,this._interval=setInterval(e,t,this._args),this.reschedule=function(e){e=e||n._interval,n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,e,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}t.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");if(0<arguments.length)for(var e=new Array(arguments.length-2),t=0;t<e.length;t++)e[t]=arguments[t+2];return new n(arguments[0],arguments[1],e)}},{}],110:[function(e,t,r){var n=e("buffer"),o=n.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return o(e,t,r)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?t.exports=n:(i(n,r),r.Buffer=a),i(o,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");e=o(e);return void 0!==t?"string"==typeof r?e.fill(t,r):e.fill(t):e.fill(0),e},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:12}],111:[function(e,t,r){t.exports=function(e){var t=e._readableState;return t?t.objectMode?e.read():e.read(function(e){if(e.buffer.length)return(e.buffer.head?e.buffer.head.data:e.buffer[0]).length;return e.length}(t)):null}},{}],112:[function(d,e,l){!function(e,t){var n=d("process/browser.js").nextTick,r=Function.prototype.apply,o=Array.prototype.slice,i={},a=0;function s(e,t){this._id=e,this._clearFn=t}l.setTimeout=function(){return new s(r.call(setTimeout,window,arguments),clearTimeout)},l.setInterval=function(){return new s(r.call(setInterval,window,arguments),clearInterval)},l.clearTimeout=l.clearInterval=function(e){e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},l.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},l.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},l._unrefActive=l.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},l.setImmediate="function"==typeof e?e:function(e){var t=a++,r=!(arguments.length<2)&&o.call(arguments,1);return i[t]=!0,n(function(){i[t]&&(r?e.apply(null,r):e.call(null),l.clearImmediate(t))}),t},l.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}.call(this,d("timers").setImmediate,d("timers").clearImmediate)},{"process/browser.js":92,timers:112}],113:[function(e,t,r){"use strict";var E=e("punycode"),I=e("./util");function S(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=o,r.resolve=function(e,t){return o(e,!1,!0).resolve(t)},r.resolveObject=function(e,t){return e?o(e,!1,!0).resolveObject(t):t},r.format=function(e){I.isString(e)&&(e=o(e));return e instanceof S?e.format():S.prototype.format.call(e)},r.Url=S;var T=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,C=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,r=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),R=["'"].concat(r),P=["%","/","?",";","#"].concat(R),k=["/","?","#"],x=/^[+a-z0-9A-Z_-]{0,63}$/,M=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,A={javascript:!0,"javascript:":!0},O={javascript:!0,"javascript:":!0},U={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},D=e("querystring");function o(e,t,r){var n;return e&&I.isObject(e)&&e instanceof S?e:((n=new S).parse(e,t,r),n)}S.prototype.parse=function(e,t,r){if(!I.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),n=-1!==n&&n<e.indexOf("#")?"?":"#",o=e.split(n);o[0]=o[0].replace(/\\/g,"/");var i=(i=e=o.join(n)).trim();if(!r&&1===e.split("#").length){o=C.exec(i);if(o)return this.path=i,this.href=i,this.pathname=o[1],o[2]?(this.search=o[2],this.query=t?D.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var a,n=T.exec(i);if(n&&(a=(n=n[0]).toLowerCase(),this.protocol=a,i=i.substr(n.length)),!(r||n||i.match(/^\/\/[^@\/]+@[^@\/]+/))||!(_="//"===i.substr(0,2))||n&&O[n]||(i=i.substr(2),this.slashes=!0),!O[n]&&(_||n&&!U[n])){for(var s=-1,d=0;d<k.length;d++)-1!==(l=i.indexOf(k[d]))&&(-1===s||l<s)&&(s=l);-1!==(e=-1===s?i.lastIndexOf("@"):i.lastIndexOf("@",s))&&(o=i.slice(0,e),i=i.slice(e+1),this.auth=decodeURIComponent(o));for(var l,s=-1,d=0;d<P.length;d++)-1!==(l=i.indexOf(P[d]))&&(-1===s||l<s)&&(s=l);-1===s&&(s=i.length),this.host=i.slice(0,s),i=i.slice(s),this.parseHost(),this.hostname=this.hostname||"";r="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!r)for(var u=this.hostname.split(/\./),d=0,c=u.length;d<c;d++){var p=u[d];if(p&&!p.match(x)){for(var h="",f=0,m=p.length;f<m;f++)127<p.charCodeAt(f)?h+="x":h+=p[f];if(!h.match(x)){var g=u.slice(0,d),y=u.slice(d+1),v=p.match(M);v&&(g.push(v[1]),y.unshift(v[2])),y.length&&(i="/"+y.join(".")+i),this.hostname=g.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),r||(this.hostname=E.toASCII(this.hostname));var b=this.port?":"+this.port:"",_=this.hostname||"";this.host=_+b,this.href+=this.host,r&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==i[0])&&(i="/"+i)}if(!A[a])for(d=0,c=R.length;d<c;d++){var S,w=R[d];-1!==i.indexOf(w)&&((S=encodeURIComponent(w))===w&&(S=escape(w)),i=i.split(w).join(S))}n=i.indexOf("#"),-1!==n&&(this.hash=i.substr(n),i=i.slice(0,n)),e=i.indexOf("?");return-1!==e?(this.search=i.substr(e),this.query=i.substr(e+1),t&&(this.query=D.parse(this.query)),i=i.slice(0,e)):t&&(this.search="",this.query={}),i&&(this.pathname=i),U[a]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(b=this.pathname||"",o=this.search||"",this.path=b+o),this.href=this.format(),this},S.prototype.format=function(){var e=this.auth||"",t=(e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@"),this.protocol||""),r=this.pathname||"",n=this.hash||"",o=!1,i="",e=(this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port)&&(o+=":"+this.port),this.query&&I.isObject(this.query)&&Object.keys(this.query).length&&(i=D.stringify(this.query)),this.search||i&&"?"+i||"");return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||U[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o=o||"",n&&"#"!==n.charAt(0)&&(n="#"+n),e&&"?"!==e.charAt(0)&&(e="?"+e),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(e=e.replace("#","%23"))+n},S.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},S.prototype.resolveObject=function(e){I.isString(e)&&((p=new S).parse(e,!1,!0),e=p);for(var t=new S,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];t[o]=this[o]}if(t.hash=e.hash,""!==e.href)if(e.slashes&&!e.protocol){for(var i=Object.keys(e),a=0;a<i.length;a++){var s=i[a];"protocol"!==s&&(t[s]=e[s])}U[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/")}else if(e.protocol&&e.protocol!==t.protocol)if(U[e.protocol]){if(t.protocol=e.protocol,e.host||O[e.protocol])t.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),t.pathname=d.join("/")}t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(p=t.pathname||"",h=t.search||"",t.path=p+h),t.slashes=t.slashes||e.slashes}else for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];t[c]=e[c]}else{var p=t.pathname&&"/"===t.pathname.charAt(0),h=e.host||e.pathname&&"/"===e.pathname.charAt(0),p=h||p||t.host&&e.pathname,f=p,m=t.pathname&&t.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],g=t.protocol&&!U[t.protocol];if(g&&(t.hostname="",t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),p=p&&(""===d[0]||""===m[0])),h)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,m=d;else if(d.length)(m=m||[]).pop(),m=m.concat(d),t.search=e.search,t.query=e.query;else if(!I.isNullOrUndefined(e.search))return g&&(t.hostname=t.host=m.shift(),_=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=_.shift(),t.host=t.hostname=_.shift()),t.search=e.search,t.query=e.query,I.isNull(t.pathname)&&I.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(m.length){for(var y=m.slice(-1)[0],h=(t.host||e.host||1<m.length)&&("."===y||".."===y)||""===y,v=0,b=m.length;0<=b;b--)"."===(y=m[b])?m.splice(b,1):".."===y?(m.splice(b,1),v++):v&&(m.splice(b,1),v--);if(!p&&!f)for(;v--;)m.unshift("..");!p||""===m[0]||m[0]&&"/"===m[0].charAt(0)||m.unshift(""),h&&"/"!==m.join("/").substr(-1)&&m.push("");var _,f=""===m[0]||m[0]&&"/"===m[0].charAt(0);g&&(t.hostname=t.host=!f&&m.length?m.shift():"",_=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=_.shift(),t.host=t.hostname=_.shift()),(p=p||t.host&&m.length)&&!f&&m.unshift(""),m.length?t.pathname=m.join("/"):(t.pathname=null,t.path=null),I.isNull(t.pathname)&&I.isNull(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes}else t.pathname=null,t.search?t.path="/"+t.search:t.path=null}return t.href=t.format(),t},S.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":114,punycode:93,querystring:96}],114:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],115:[function(e,r,t){!function(t){function n(e){try{if(!t.localStorage)return}catch(e){return}e=t.localStorage[e];return null!=e&&"true"===String(e).toLowerCase()}r.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],116:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],117:[function(C,e,R){!function(n,o){var e,s=/%[sdj%]/g,i=(R.format=function(e){if(!y(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(d(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,i=String(e).replace(s,function(e){if("%%"===e)return"%";if(o<=r)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<o;a=n[++r])m(a)||!_(a)?i+=" "+a:i+=" "+d(a);return i},R.deprecate=function(e,t){var r;return v(o.process)?function(){return R.deprecate(e,t).apply(this,arguments)}:!0===n.noDeprecation?e:(r=!1,function(){if(!r){if(n.throwDeprecation)throw new Error(t);n.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)})},{});function d(e,t){var r={seen:[],stylize:l};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),f(t)?r.showHidden=t:t&&R._extend(r,t),v(r.showHidden)&&(r.showHidden=!1),v(r.depth)&&(r.depth=2),v(r.colors)&&(r.colors=!1),v(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),u(r,e,r.depth)}function a(e,t){t=d.styles[t];return t?"["+d.colors[t][0]+"m"+e+"["+d.colors[t][1]+"m":e}function l(e,t){return e}function u(t,r,n){if(t.customInspect&&r&&E(r.inspect)&&r.inspect!==R.inspect&&(!r.constructor||r.constructor.prototype!==r))return y(e=r.inspect(n,t))?e:u(t,e,n);var e=function(e,t){if(v(t))return e.stylize("undefined","undefined");{var r;if(y(t))return r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",e.stylize(r,"string")}return g(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}(t,r);if(e)return e;var o,e=Object.keys(r),i=(o={},e.forEach(function(e,t){o[e]=!0}),o);if(t.showHidden&&(e=Object.getOwnPropertyNames(r)),w(r)&&(0<=e.indexOf("message")||0<=e.indexOf("description")))return c(r);if(0===e.length){if(E(r))return a=r.name?": "+r.name:"",t.stylize("[Function"+a+"]","special");if(b(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(S(r))return t.stylize(Date.prototype.toString.call(r),"date");if(w(r))return c(r)}var a="",s=!1,d=["{","}"];if(h(r)&&(s=!0,d=["[","]"]),E(r)&&(a=" [Function"+(r.name?": "+r.name:"")+"]"),b(r)&&(a=" "+RegExp.prototype.toString.call(r)),S(r)&&(a=" "+Date.prototype.toUTCString.call(r)),w(r)&&(a=" "+c(r)),0===e.length&&(!s||0==r.length))return d[0]+a+d[1];if(n<0)return b(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special");t.seen.push(r),l=s?function(t,r,n,o,e){for(var i=[],a=0,s=r.length;a<s;++a)T(r,String(a))?i.push(p(t,r,n,o,String(a),!0)):i.push("");return e.forEach(function(e){e.match(/^\d+$/)||i.push(p(t,r,n,o,e,!0))}),i}(t,r,n,i,e):e.map(function(e){return p(t,r,n,i,e,s)}),t.seen.pop();var l;return 60<l.reduce(function(e,t){return 0<=t.indexOf("\n")&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?d[0]+(""===a?"":a+"\n ")+" "+l.join(",\n  ")+" "+d[1]:d[0]+a+" "+l.join(", ")+" "+d[1]}function c(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,n,o,i){var a,s,t=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]};if(t.get?s=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(s=e.stylize("[Setter]","special")),T(n,o)||(a="["+o+"]"),s||(e.seen.indexOf(t.value)<0?-1<(s=m(r)?u(e,t.value,null):u(e,t.value,r-1)).indexOf("\n")&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),v(a)){if(i&&o.match(/^\d+$/))return s;a=(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(a,"string"))}return a+": "+s}function h(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function v(e){return void 0===e}function b(e){return _(e)&&"[object RegExp]"===t(e)}function _(e){return"object"==typeof e&&null!==e}function S(e){return _(e)&&"[object Date]"===t(e)}function w(e){return _(e)&&("[object Error]"===t(e)||e instanceof Error)}function E(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function r(e){return e<10?"0"+e.toString(10):e.toString(10)}R.debuglog=function(t){var r;return v(e)&&(e=n.env.NODE_DEBUG||""),t=t.toUpperCase(),i[t]||(new RegExp("\\b"+t+"\\b","i").test(e)?(r=n.pid,i[t]=function(){var e=R.format.apply(R,arguments);console.error("%s %d: %s",t,r,e)}):i[t]=function(){}),i[t]},(R.inspect=d).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},R.isArray=h,R.isBoolean=f,R.isNull=m,R.isNullOrUndefined=function(e){return null==e},R.isNumber=g,R.isString=y,R.isSymbol=function(e){return"symbol"==typeof e},R.isUndefined=v,R.isRegExp=b,R.isObject=_,R.isDate=S,R.isError=w,R.isFunction=E,R.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},R.isBuffer=C("./support/isBuffer");var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}R.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[r(e.getHours()),r(e.getMinutes()),r(e.getSeconds())].join(":"),[e.getDate(),I[e.getMonth()],t].join(" ")),R.format.apply(R,arguments))},R.inherits=C("inherits"),R._extend=function(e,t){if(t&&_(t))for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}.call(this,C("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":116,_process:92,inherits:80}],118:[function(e,t,r){!function(p,h){"use strict";var f=e("readable-stream").Transform,m=e("duplexify"),g=e("ws"),y=e("safe-buffer").Buffer;t.exports=function(e,t,r){var n,o,i="browser"===p.title,a=!!h.WebSocket,s=i?function e(t,r,n){if(o.bufferedAmount>l)return void setTimeout(e,u,t,r,n);c&&"string"==typeof t&&(t=y.from(t,"utf8"));try{o.send(t)}catch(e){return n(e)}n()}:function(e,t,r){o.readyState!==o.OPEN?r():(c&&"string"==typeof e&&(e=y.from(e,"utf8")),o.send(e,r))};t&&!Array.isArray(t)&&"object"==typeof t&&(r=t,t=null,"string"!=typeof r.protocol&&!Array.isArray(r.protocol)||(t=r.protocol));r=r||{};void 0===r.objectMode&&(r.objectMode=!(!0===r.binary||void 0===r.binary));var d=function(e,t,r){e=new f({objectMode:e.objectMode});return e._write=t,e._flush=r,e}(r,s,function(e){o.close(),e()});r.objectMode||(d._writev=function(e,t){for(var r=new Array(e.length),n=0;n<e.length;n++)"string"==typeof e[n].chunk?r[n]=y.from(e[n],"utf8"):r[n]=e[n].chunk;this._write(y.concat(r),"binary",t)});var l=r.browserBufferSize||524288,u=r.browserBufferTimeout||1e3;"object"==typeof e?o=e:(o=a&&i?new g(e,t):new g(e,t,r)).binaryType="arraybuffer";o.readyState===o.OPEN?n=d:(n=m.obj(),o.onopen=function(){n.setReadable(d),n.setWritable(d),n.emit("connect")});(n.socket=o).onclose=function(){n.end(),n.destroy()},o.onerror=function(e){n.destroy(e)},o.onmessage=function(e){e=e.data;e=e instanceof ArrayBuffer?y.from(e):y.from(e,"utf8");d.push(e)},d.on("close",function(){o.close()});var c=!r.objectMode;return n}}.call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:92,duplexify:17,"readable-stream":108,"safe-buffer":110,ws:119}],119:[function(e,t,r){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:"undefined"!=typeof window&&(n=window.WebSocket||window.MozWebSocket),t.exports=n},{}],120:[function(e,t,r){t.exports=function e(o,t){if(o&&t)return e(o)(t);if("function"!=typeof o)throw new TypeError("need wrapper function");Object.keys(o).forEach(function(e){r[e]=o[e]});return r;function r(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];var r=o.apply(this,e),n=e[e.length-1];return"function"==typeof r&&r!==n&&Object.keys(n).forEach(function(e){r[e]=n[e]}),r}}},{}],121:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)o.call(n,r)&&(e[r]=n[r])}return e};var o=Object.prototype.hasOwnProperty},{}]},{},[9])(9)}),!function(e,c){"use strict";function H(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t}function L(e,t){if(!(typeof e===p&&0<e.length))return!!x(e)&&-1!==M(t).indexOf(M(e));for(var r in e)if(M(e[r])==M(t))return 1}function s(e,t){if(x(e))return e=O(/^\s\s*/,e),typeof t===l?e:e.substring(0,500)}var d="",N="function",l="undefined",p="object",B="string",j="major",h="model",f="name",m="type",g="vendor",y="version",v="architecture",b="console",_="mobile",o="tablet",t="smarttv",V="wearable",F="embedded",q="user-agent",G="brands",S="formFactors",W="fullVersionList",w="platform",z="platformVersion",Y="bitness",n="sec-ch-ua",K=n+"-full-version-list",X=n+"-arch",J=n+"-"+Y,Q=n+"-form-factors",Z=n+"-"+_,$=n+"-"+h,ee=n+"-"+w,te=ee+"-version",re=[G,W,_,h,w,z,v,S,Y],E="browser",I="cpu",T="device",C="engine",R="os",P="result",ne="Amazon",oe="Apple",ie="BlackBerry",ae="Google",se="Microsoft",de="Samsung",le="Sony",ue="Xiaomi",r="Mobile ",i=" Browser",ce="Chrome",pe="Firefox",a="Opera",he="Windows",fe=typeof e!==l,u=fe&&e.navigator?e.navigator:c,k=u&&u.userAgentData?u.userAgentData:c,me=function(e,t){for(var r in e)return/^(browser|cpu|device|engine|os)$/.test(r)||!!t&&me(e[r])},x=function(e){return typeof e===B},ge=function(e){if(!e)return c;for(var t,r=[],n=O(/\\?\"/g,e).split(","),o=0;o<n.length;o++)-1<n[o].indexOf(";")?(t=s(n[o]).split(";v="),r[o]={brand:t[0],version:t[1]}):r[o]=s(n[o]);return r},M=function(e){return x(e)?e.toLowerCase():e},ye=function(e){return x(e)?O(/[^\d\.]/g,e).split(".")[0]:c},A=function(e){for(var t in e){t=e[t];typeof t==p&&2==t.length?this[t[0]]=t[1]:this[t]=c}return this},O=function(e,t){return x(t)?t.replace(e,d):t},ve=function(e){return O(/\\?\"/g,e)},be=function(e,t){if(e&&t)for(var r,n,o,i,a,s=0;s<t.length&&!i;){for(var d=t[s],l=t[s+1],u=r=0;u<d.length&&!i&&d[u];)if(i=d[u++].exec(e))for(n=0;n<l.length;n++)a=i[++r],typeof(o=l[n])===p&&0<o.length?2===o.length?typeof o[1]==N?this[o[0]]=o[1].call(this,a):this[o[0]]=o[1]:3===o.length?typeof o[1]!==N||o[1].exec&&o[1].test?this[o[0]]=a?a.replace(o[1],o[2]):c:this[o[0]]=a?o[1].call(this,a,o[2]):c:4===o.length&&(this[o[0]]=a?o[3].call(this,a.replace(o[1],o[2])):c):this[o]=a||c;s+=2}},_e=function(e,t){for(var r in t)if(typeof t[r]===p&&0<t[r].length){for(var n=0;n<t[r].length;n++)if(L(t[r][n],e))return"?"===r?c:r}else if(L(t[r],e))return"?"===r?c:r;return t.hasOwnProperty("*")?t["*"]:e},Se={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},we={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":c},Ee={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[f,r+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,y],[/opios[\/ ]+([\w\.]+)/i],[y,[f,a+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[y,[f,a+" GX"]],[/\bopr\/([\w\.]+)/i],[y,[f,a]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[y,[f,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,y],[/\bddg\/([\w\.]+)/i],[y,[f,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[f,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[y,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[y,[f,"Smart Lenovo"+i]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure"+i],y],[/\bfocus\/([\w\.]+)/i],[y,[f,pe+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[f,a+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[f,a+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[f,"MIUI"+i]],[/fxios\/([\w\.-]+)/i],[y,[f,r+pe]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360"+i]],[/\b(qq)\/([\w\.]+)/i],[[f,/(.+)/,"$1Browser"],y],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1"+i],y],[/samsungbrowser\/([\w\.]+)/i],[y,[f,de+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],y],[/metasr[\/ ]?([\d\.]+)/i],[y,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[f,y],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,"Facebook"],y],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[f,ce+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,ce+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[f,"Android"+i]],[/chrome\/([\w\.]+) mobile/i],[y,[f,r+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,y],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[y,[f,r+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[f,r+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[y,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[y,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[f,y],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[f,r+pe],y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],y],[/(wolvic)\/([\w\.]+)/i],[f,y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[f,pe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[f,[y,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[f,[y,/[^\d\.]+./,d]]],cpu:[[/\b(?:(amd|x|x86[-_]?|wow|win)64)\b/i],[[v,"amd64"]],[/(ia32(?=;))/i,/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,d,M]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,M]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[g,de],[m,o]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[g,de],[m,_]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[g,oe],[m,_]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[g,oe],[m,o]],[/(macintosh);/i],[h,[g,oe]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[g,"Sharp"],[m,_]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[g,"Huawei"],[m,o]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[g,"Huawei"],[m,_]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[g,ue],[m,_]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[g,ue],[m,o]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[g,"OPPO"],[m,_]],[/\b(opd2\d{3}a?) bui/i],[h,[g,"OPPO"],[m,o]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[g,"Vivo"],[m,_]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[g,"Realme"],[m,_]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[g,"Motorola"],[m,_]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[g,"Motorola"],[m,o]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[g,"LG"],[m,o]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[g,"LG"],[m,_]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[g,"Lenovo"],[m,o]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[g,"Nokia"],[m,_]],[/(pixel c)\b/i],[h,[g,ae],[m,o]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[g,ae],[m,_]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[g,le],[m,_]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[g,le],[m,o]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[g,"OnePlus"],[m,_]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[g,ne],[m,o]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[g,ne],[m,_]],[/(playbook);[-\w\),; ]+(rim)/i],[h,g,[m,o]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[g,ie],[m,_]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[g,"ASUS"],[m,o]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[g,"ASUS"],[m,_]],[/(nexus 9)/i],[h,[g,"HTC"],[m,o]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[h,/_/g," "],[m,_]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[g,"Acer"],[m,o]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[g,"Meizu"],[m,_]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[g,"Ulefone"],[m,_]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,h,[m,_]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[g,h,[m,o]],[/(surface duo)/i],[h,[g,se],[m,o]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[g,"Fairphone"],[m,_]],[/(shield[\w ]+) b/i],[h,[g,"Nvidia"],[m,o]],[/(sprint) (\w+)/i],[g,h,[m,_]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[g,se],[m,_]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[g,"Zebra"],[m,o]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[g,"Zebra"],[m,_]],[/smart-tv.+(samsung)/i],[g,[m,t]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[g,de],[m,t]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,"LG"],[m,t]],[/(apple) ?tv/i],[g,[h,oe+" TV"],[m,t]],[/crkey/i],[[h,ce+"cast"],[g,ae],[m,t]],[/droid.+aft(\w+)( bui|\))/i],[h,[g,ne],[m,t]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[g,"Sharp"],[m,t]],[/(bravia[\w ]+)( bui|\))/i],[h,[g,le],[m,t]],[/(mitv-\w{5}) bui/i],[h,[g,ue],[m,t]],[/Hbbtv.*(technisat) (.*);/i],[g,h,[m,t]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,s],[h,s],[m,t]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,t]],[/(ouya)/i,/(nintendo) (\w+)/i],[g,h,[m,b]],[/droid.+; (shield) bui/i],[h,[g,"Nvidia"],[m,b]],[/(playstation \w+)/i],[h,[g,le],[m,b]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[g,se],[m,b]],[/((pebble))app/i],[g,h,[m,V]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[g,oe],[m,V]],[/droid.+; (wt63?0{2,3})\)/i],[h,[g,"Zebra"],[m,V]],[/droid.+; (glass) \d/i],[h,[g,ae],[m,"xr"]],[/(quest( \d| pro)?)/i],[h,[g,"Facebook"],[m,"xr"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[m,F]],[/(aeobc)\b/i],[h,[g,ne],[m,F]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[m,_]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[m,o]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,o]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,_]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,y],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[y,_e,Se]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[y,_e,Se],[f,he]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,"macOS"],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,y],[/\(bb(10);/i],[y,[f,ie]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[f,pe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[f,ce+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,"Chrome OS"],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,y],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,y]]},Ie=(a={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}},A.call(a.init,[[E,[f,y,j,m]],[I,[v]],[T,[m,h,g]],[C,[f,y]],[R,[f,y]]]),A.call(a.isIgnore,[[E,[y,j]],[C,[y]],[R,[y]]]),A.call(a.isIgnoreRgx,[[E,/ ?browser$/i],[R,/ ?os$/i]]),A.call(a.toString,[[E,[f,y]],[I,[v]],[T,[g,h]],[C,[f,y]],[R,[f,y]]]),a),Te=function(t,e){var r=Ie.init[e],n=Ie.isIgnore[e]||0,o=Ie.isIgnoreRgx[e]||0,i=Ie.toString[e]||0;function a(){A.call(this,r)}return a.prototype.getItem=function(){return t},a.prototype.withClientHints=function(){return k?k.getHighEntropyValues(re).then(function(e){return t.setCH(new Ce(e,!1)).parseCH().get()}):t.parseCH().get()},a.prototype.withFeatureCheck=function(){return t.detectFeature().get()},e!=P&&(a.prototype.is=function(e){var t,r=!1;for(t in this)if(this.hasOwnProperty(t)&&!L(n,t)&&M(o?O(o,this[t]):this[t])==M(o?O(o,e):e)){if(r=!0,e!=l)break}else if(e==l&&r){r=!r;break}return r},a.prototype.toString=function(){var e,t=d;for(e in i)typeof this[i[e]]!==l&&(t+=(t?" ":d)+this[i[e]]);return t||l}),k||(a.prototype.then=function(e){function t(){for(var e in r)r.hasOwnProperty(e)&&(this[e]=r[e])}var r=this,n=(t.prototype={is:a.prototype.is,toString:a.prototype.toString},new t);return e(n),n}),new a};function Ce(e,t){if(e=e||{},A.call(this,re),t)A.call(this,[[G,ge(e[n])],[W,ge(e[K])],[_,/\?1/.test(e[Z])],[h,ve(e[$])],[w,ve(e[ee])],[z,ve(e[te])],[v,ve(e[X])],[S,ge(e[Q])],[Y,ve(e[J])]]);else for(var r in e)this.hasOwnProperty(r)&&typeof e[r]!==l&&(this[r]=e[r])}function Re(e,t,r,n){return this.get=function(e){return e?this.data.hasOwnProperty(e)?this.data[e]:c:this.data},this.set=function(e,t){return this.data[e]=t,this},this.setCH=function(e){return this.uaCH=e,this},this.detectFeature=function(){if(u&&u.userAgent==this.ua)switch(this.itemType){case E:u.brave&&typeof u.brave.isBrave==N&&this.set(f,"Brave");break;case T:!this.get(m)&&k&&k[_]&&this.set(m,_),"Macintosh"==this.get(h)&&u&&typeof u.standalone!==l&&u.maxTouchPoints&&2<u.maxTouchPoints&&this.set(h,"iPad").set(m,o);break;case R:!this.get(f)&&k&&k[w]&&this.set(f,k[w]);break;case P:var t=this.data,e=function(e){return t[e].getItem().detectFeature().get()};this.set(E,e(E)).set(I,e(I)).set(T,e(T)).set(C,e(C)).set(R,e(R))}return this},this.parseUA=function(){return this.itemType!=P&&be.call(this.data,this.ua,this.rgxMap),this.itemType==E&&this.set(j,ye(this.get(y))),this},this.parseCH=function(){var e,t=this.uaCH,r=this.rgxMap;switch(this.itemType){case E:var n,o=t[W]||t[G];if(o)for(var i in o){var a=O(/(Google|Microsoft) /,o[i].brand||o[i]),i=o[i].version;/not.a.brand/i.test(a)||n&&(!/chrom/i.test(n)||/chromi/i.test(a))||(this.set(f,a).set(y,i).set(j,ye(i)),n=a)}break;case I:var s=t[v];s&&("64"==t[Y]&&(s+="64"),be.call(this.data,s+";",r));break;case T:if(t[_]&&this.set(m,_),t[h]&&this.set(h,t[h]),"Xbox"==t[h]&&this.set(m,b).set(g,se),t[S]){if("string"!=typeof t[S])for(var d=0;!e&&d<t[S].length;)e=_e(t[S][d++],we);else e=_e(t[S],we);this.set(m,e)}break;case R:var l,s=t[w];s&&(l=t[z],s==he&&(l=13<=parseInt(ye(l),10)?"11":"10"),this.set(f,s).set(y,l)),this.get(f)==he&&"Xbox"==t[h]&&this.set(f,"Xbox").set(y,c);break;case P:var u=this.data,s=function(e){return u[e].getItem().setCH(t).parseCH().get()};this.set(E,s(E)).set(I,s(I)).set(T,s(T)).set(C,s(C)).set(R,s(R))}return this},A.call(this,[["itemType",e],["ua",t],["uaCH",n],["rgxMap",r],["data",Te(this,e)]]),this}function U(e,t,r){var n,o,i,a;return typeof e===p?(t=me(e,!0)?(typeof t===p&&(r=t),e):(r=e,c),e=c):typeof e!==B||me(t,!0)||(r=t,t=c),this instanceof U?(n=typeof e===B?e:u&&u.userAgent?u.userAgent:r&&r[q]?r[q]:d,o=new Ce(r,!0),i=t?function(e,t){var r,n={},o=t;if(!me(t))for(var i in o={},t)for(var a in t[i])o[a]=t[i][a].concat(o[a]||[]);for(r in e)n[r]=o[r]&&o[r].length%2==0?o[r].concat(e[r]):e[r];return n}(Ee,t):Ee,A.call(this,[["getBrowser",(a=function(e){return e==P?function(){return new Re(e,n,i,o).set("ua",n).set(E,this.getBrowser()).set(I,this.getCPU()).set(T,this.getDevice()).set(C,this.getEngine()).set(R,this.getOS()).get()}:function(){return new Re(e,n,i[e],o).parseUA().get()}})(E)],["getCPU",a(I)],["getDevice",a(T)],["getEngine",a(C)],["getOS",a(R)],["getResult",a(P)],["getUA",function(){return n}],["setUA",function(e){return x(e)&&(n=500<e.length?s(e,500):e),this}]]).setUA(n),this):new U(e,t,r).getResult()}U.VERSION="2.0.0-beta.3",U.BROWSER=H([f,y,j,m]),U.CPU=H([v]),U.DEVICE=H([h,g,m,b,_,t,o,V,F]),U.ENGINE=U.OS=H([f,y]),typeof exports!==l?(exports=typeof module!==l&&module.exports?module.exports=U:exports).UAParser=U:typeof define===N&&define.amd?define(function(){return U}):fe&&(e.UAParser=U);var Pe,D=fe&&(e.jQuery||e.Zepto);D&&!D.ua&&(Pe=new U,D.ua=Pe.getResult(),D.ua.get=function(){return Pe.getUA()},D.ua.set=function(e){Pe.setUA(e);var t,r=Pe.getResult();for(t in r)D.ua[t]=r[t]})}("object"==typeof window?window:this),!function(e,t){"object"==typeof exports?module.exports=exports=t():"function"==typeof define&&define.amd?define([],t):e.CryptoJS=t()}(this,function(){var D,H,L,N,B,j,V,u,F,q,e,G,W,t,z,Y,K,X,J,Q,Z,$,ee,re,ne,oe,ie,a,ae,se,de,le,ue,o,ce,r,pe,he,i,s,d,l,c,p,n=function(l){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),!(n=!(n=!(n="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:n)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:n)&&"undefined"!=typeof global&&global.crypto?global.crypto:n)&&"function"==typeof require)try{n=require("crypto")}catch(e){}var r=Object.create||function(e){return t.prototype=e,e=new t,t.prototype=null,e};function t(){}var e={},o=e.lib={},i=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var s=0;s<o;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=l.ceil(t/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new u.init(t,e)}}),a=e.enc={},s=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new u.init(r,t/2)}},d=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new u.init(r,t)}},c=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t,r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,a=o/(4*i),s=(e?l.ceil(a):l.max((0|a)-this._minBufferSize,0))*i,e=l.min(4*s,o);if(s){for(var d=0;d<s;d+=i)this._doProcessBlock(n,d);t=n.splice(0,s),r.sigBytes-=e}return new u.init(t,e)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(o.Hasher=p.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(e,t){return new r.init(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return new h.HMAC.init(r,t).finalize(e)}}}),e.algo={});return e}(Math);h=(b=n).lib,D=h.Base,H=h.WordArray,(h=b.x64={}).Word=D.extend({init:function(e,t){this.high=e,this.low=t}}),h.WordArray=D.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var o=e[n];r.push(o.high),r.push(o.low)}return H.create(r,this.sigBytes)},clone:function(){for(var e=D.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),"function"==typeof ArrayBuffer&&(b=n.lib.WordArray,L=b.init,(b.init=function(e){if((e=(e=e instanceof ArrayBuffer?new Uint8Array(e):e)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e)instanceof Uint8Array){for(var t=e.byteLength,r=[],n=0;n<t;n++)r[n>>>2]|=e[n]<<24-n%4*8;L.call(this,r,t)}else L.apply(this,arguments)}).prototype=b);var fe=(h=n).lib.WordArray;function me(e){return e<<8&4278255360|e>>>8&16711935}(h=h.enc).Utf16=h.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o+=2){var i=t[o>>>2]>>>16-o%4*8&65535;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>1]|=e.charCodeAt(n)<<16-n%2*16;return fe.create(r,2*t)}},h.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o+=2){var i=me(t[o>>>2]>>>16-o%4*8&65535);n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>1]|=me(e.charCodeAt(n)<<16-n%2*16);return fe.create(r,2*t)}},N=(b=n).lib.WordArray,b.enc.Base64={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=this._map,o=(e.clamp(),[]),i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)o.push(n.charAt(a>>>6*(3-s)&63));var d=n.charAt(64);if(d)for(;o.length%4;)o.push(d);return o.join("")},parse:function(e){var t=e.length,r=this._map;if(!(n=this._reverseMap))for(var n=this._reverseMap=[],o=0;o<r.length;o++)n[r.charCodeAt(o)]=o;for(var i,a,s=r.charAt(64),d=(s&&-1!==(s=e.indexOf(s))&&(t=s),e),l=t,u=n,c=[],p=0,h=0;h<l;h++)h%4&&(a=u[d.charCodeAt(h-1)]<<h%4*2,i=u[d.charCodeAt(h)]>>>6-h%4*2,c[p>>>2]|=(a|=i)<<24-p%4*8,p++);return N.create(c,p)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},B=(h=n).lib.WordArray,h.enc.Base64url={stringify:function(e,t){for(var r=e.words,n=e.sigBytes,o=(t=void 0===t||t)?this._safe_map:this._map,i=(e.clamp(),[]),a=0;a<n;a+=3)for(var s=(r[a>>>2]>>>24-a%4*8&255)<<16|(r[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|r[a+2>>>2]>>>24-(a+2)%4*8&255,d=0;d<4&&a+.75*d<n;d++)i.push(o.charAt(s>>>6*(3-d)&63));var l=o.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e,t){var r=e.length,n=(t=void 0===t||t)?this._safe_map:this._map;if(!(o=this._reverseMap))for(var o=this._reverseMap=[],i=0;i<n.length;i++)o[n.charCodeAt(i)]=i;(t=n.charAt(64))&&-1!==(t=e.indexOf(t))&&(r=t);for(var a,s,d=e,l=r,u=o,c=[],p=0,h=0;h<l;h++)h%4&&(s=u[d.charCodeAt(h-1)]<<h%4*2,a=u[d.charCodeAt(h)]>>>6-h%4*2,c[p>>>2]|=(s|=a)<<24-p%4*8,p++);return B.create(c,p)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};for(var ge=Math,ye=(h=(b=n).lib).WordArray,ve=h.Hasher,h=b.algo,C=[],be=0;be<64;be++)C[be]=4294967296*ge.abs(ge.sin(be+1))|0;function R(e,t,r,n,o,i,a){return((e=e+(t&r|~t&n)+o+a)<<i|e>>>32-i)+t}function P(e,t,r,n,o,i,a){return((e=e+(t&n|r&~n)+o+a)<<i|e>>>32-i)+t}function k(e,t,r,n,o,i,a){return((e=e+(t^r^n)+o+a)<<i|e>>>32-i)+t}function x(e,t,r,n,o,i,a){return((e=e+(r^(t|~n))+o+a)<<i|e>>>32-i)+t}h=h.MD5=ve.extend({_doReset:function(){this._hash=new ye.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[t+0],s=e[t+1],d=e[t+2],l=e[t+3],u=e[t+4],c=e[t+5],p=e[t+6],h=e[t+7],f=e[t+8],m=e[t+9],g=e[t+10],y=e[t+11],v=e[t+12],b=e[t+13],_=e[t+14],S=e[t+15],w=R(i[0],T=i[1],I=i[2],E=i[3],a,7,C[0]),E=R(E,w,T,I,s,12,C[1]),I=R(I,E,w,T,d,17,C[2]),T=R(T,I,E,w,l,22,C[3]),w=R(w,T,I,E,u,7,C[4]),E=R(E,w,T,I,c,12,C[5]),I=R(I,E,w,T,p,17,C[6]),T=R(T,I,E,w,h,22,C[7]);w=R(w,T,I,E,f,7,C[8]),E=R(E,w,T,I,m,12,C[9]),I=R(I,E,w,T,g,17,C[10]),T=R(T,I,E,w,y,22,C[11]),w=R(w,T,I,E,v,7,C[12]),E=R(E,w,T,I,b,12,C[13]),I=R(I,E,w,T,_,17,C[14]),w=P(w,T=R(T,I,E,w,S,22,C[15]),I,E,s,5,C[16]),E=P(E,w,T,I,p,9,C[17]),I=P(I,E,w,T,y,14,C[18]),T=P(T,I,E,w,a,20,C[19]),w=P(w,T,I,E,c,5,C[20]),E=P(E,w,T,I,g,9,C[21]),I=P(I,E,w,T,S,14,C[22]),T=P(T,I,E,w,u,20,C[23]),w=P(w,T,I,E,m,5,C[24]),E=P(E,w,T,I,_,9,C[25]),I=P(I,E,w,T,l,14,C[26]),T=P(T,I,E,w,f,20,C[27]),w=P(w,T,I,E,b,5,C[28]),E=P(E,w,T,I,d,9,C[29]),I=P(I,E,w,T,h,14,C[30]),w=k(w,T=P(T,I,E,w,v,20,C[31]),I,E,c,4,C[32]),E=k(E,w,T,I,f,11,C[33]),I=k(I,E,w,T,y,16,C[34]),T=k(T,I,E,w,_,23,C[35]),w=k(w,T,I,E,s,4,C[36]),E=k(E,w,T,I,u,11,C[37]),I=k(I,E,w,T,h,16,C[38]),T=k(T,I,E,w,g,23,C[39]),w=k(w,T,I,E,b,4,C[40]),E=k(E,w,T,I,a,11,C[41]),I=k(I,E,w,T,l,16,C[42]),T=k(T,I,E,w,p,23,C[43]),w=k(w,T,I,E,m,4,C[44]),E=k(E,w,T,I,v,11,C[45]),I=k(I,E,w,T,S,16,C[46]),w=x(w,T=k(T,I,E,w,d,23,C[47]),I,E,a,6,C[48]),E=x(E,w,T,I,h,10,C[49]),I=x(I,E,w,T,_,15,C[50]),T=x(T,I,E,w,c,21,C[51]),w=x(w,T,I,E,v,6,C[52]),E=x(E,w,T,I,l,10,C[53]),I=x(I,E,w,T,g,15,C[54]),T=x(T,I,E,w,s,21,C[55]),w=x(w,T,I,E,f,6,C[56]),E=x(E,w,T,I,S,10,C[57]),I=x(I,E,w,T,p,15,C[58]),T=x(T,I,E,w,b,21,C[59]),w=x(w,T,I,E,u,6,C[60]),E=x(E,w,T,I,y,10,C[61]),I=x(I,E,w,T,d,15,C[62]),T=x(T,I,E,w,m,21,C[63]),i[0]=i[0]+w|0,i[1]=i[1]+T|0,i[2]=i[2]+I|0,i[3]=i[3]+E|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes,o=(t[n>>>5]|=128<<24-n%32,ge.floor(r/4294967296));t[15+(64+n>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t[14+(64+n>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=(o=this._hash).words,a=0;a<4;a++){var s=i[a];i[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return o},clone:function(){var e=ve.clone.call(this);return e._hash=this._hash.clone(),e}}),b.MD5=ve._createHelper(h),b.HmacMD5=ve._createHmacHelper(h),h=(b=n).lib,j=h.WordArray,V=h.Hasher,h=b.algo,u=[],h=h.SHA1=V.extend({_doReset:function(){this._hash=new j.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],d=0;d<80;d++){d<16?u[d]=0|e[t+d]:(l=u[d-3]^u[d-8]^u[d-14]^u[d-16],u[d]=l<<1|l>>>31);var l=(n<<5|n>>>27)+s+u[d];l+=d<20?1518500249+(o&i|~o&a):d<40?1859775393+(o^i^a):d<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,s=a,a=i,i=o<<30|o>>>2,o=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=Math.floor(r/4294967296),t[15+(64+n>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=V.clone.call(this);return e._hash=this._hash.clone(),e}}),b.SHA1=V._createHelper(h),b.HmacSHA1=V._createHmacHelper(h);var _e=Math,Se=(h=(b=n).lib).WordArray,we=h.Hasher,h=b.algo,Ee=[],Ie=[];function Te(e){return 4294967296*(e-(0|e))|0}for(var Ce=2,Re=0;Re<64;)!function(e){for(var t=_e.sqrt(e),r=2;r<=t;r++)if(!(e%r))return;return 1}(Ce)||(Re<8&&(Ee[Re]=Te(_e.pow(Ce,.5))),Ie[Re]=Te(_e.pow(Ce,1/3)),Re++),Ce++;var f=[],h=h.SHA256=we.extend({_doReset:function(){this._hash=new Se.init(Ee.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],d=r[5],l=r[6],u=r[7],c=0;c<64;c++){c<16?f[c]=0|e[t+c]:f[c]=(((p=f[c-15])<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+f[c-7]+(((h=f[c-2])<<15|h>>>17)^(h<<13|h>>>19)^h>>>10)+f[c-16];var p=n&o^n&i^o&i,h=u+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&d^~s&l)+Ie[c]+f[c],u=l,l=d,d=s,s=a+h|0,a=i,i=o,o=n,n=h+(((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+p)|0}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0,r[5]=r[5]+d|0,r[6]=r[6]+l|0,r[7]=r[7]+u|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=_e.floor(r/4294967296),t[15+(64+n>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=we.clone.call(this);return e._hash=this._hash.clone(),e}});b.SHA256=we._createHelper(h),b.HmacSHA256=we._createHmacHelper(h),F=(b=n).lib.WordArray,h=b.algo,q=h.SHA256,h=h.SHA224=q.extend({_doReset:function(){this._hash=new F.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=q._doFinalize.call(this);return e.sigBytes-=4,e}}),b.SHA224=q._createHelper(h),b.HmacSHA224=q._createHmacHelper(h);var Pe=(b=n).lib.Hasher,m=(h=b.x64).Word,ke=h.WordArray,h=b.algo;function g(){return m.create.apply(m,arguments)}for(var xe=[g(1116352408,3609767458),g(1899447441,602891725),g(3049323471,3964484399),g(3921009573,2173295548),g(961987163,4081628472),g(1508970993,3053834265),g(2453635748,2937671579),g(2870763221,3664609560),g(3624381080,2734883394),g(310598401,1164996542),g(607225278,1323610764),g(1426881987,3590304994),g(1925078388,4068182383),g(2162078206,991336113),g(2614888103,633803317),g(3248222580,3479774868),g(3835390401,2666613458),g(4022224774,944711139),g(264347078,2341262773),g(604807628,2007800933),g(770255983,1495990901),g(1249150122,1856431235),g(1555081692,3175218132),g(1996064986,2198950837),g(2554220882,3999719339),g(2821834349,766784016),g(2952996808,2566594879),g(3210313671,3203337956),g(3336571891,1034457026),g(3584528711,2466948901),g(113926993,3758326383),g(338241895,168717936),g(666307205,1188179964),g(773529912,1546045734),g(1294757372,1522805485),g(1396182291,2643833823),g(1695183700,2343527390),g(1986661051,1014477480),g(2177026350,1206759142),g(2456956037,344077627),g(2730485921,1290863460),g(2820302411,3158454273),g(3259730800,3505952657),g(3345764771,106217008),g(3516065817,3606008344),g(3600352804,1432725776),g(4094571909,1467031594),g(275423344,851169720),g(430227734,3100823752),g(506948616,1363258195),g(659060556,3750685593),g(883997877,3785050280),g(958139571,3318307427),g(1322822218,3812723403),g(1537002063,2003034995),g(1747873779,3602036899),g(1955562222,1575990012),g(2024104815,1125592928),g(2227730452,2716904306),g(2361852424,442776044),g(2428436474,593698344),g(2756734187,3733110249),g(3204031479,2999351573),g(3329325298,3815920427),g(3391569614,3928383900),g(3515267271,566280711),g(3940187606,3454069534),g(4118630271,4000239992),g(116418474,1914138554),g(174292421,2731055270),g(289380356,3203993006),g(460393269,320620315),g(685471733,587496836),g(852142971,1086792851),g(1017036298,365543100),g(1126000580,2618297676),g(1288033470,3409855158),g(1501505948,4234509866),g(1607167915,987167468),g(1816402316,1246189591)],te=[],Me=0;Me<80;Me++)te[Me]=g();h=h.SHA512=Pe.extend({_doReset:function(){this._hash=new ke.init([new m.init(1779033703,4089235720),new m.init(3144134277,2227873595),new m.init(1013904242,4271175723),new m.init(2773480762,1595750129),new m.init(1359893119,2917565137),new m.init(2600822924,725511199),new m.init(528734635,4215389547),new m.init(1541459225,327033209)])},_doProcessBlock:function(H,L){for(var e=(s=this._hash.words)[0],t=s[1],r=s[2],n=s[3],o=s[4],i=s[5],a=s[6],s=s[7],N=e.high,d=e.low,B=t.high,l=t.low,j=r.high,u=r.low,V=n.high,c=n.low,F=o.high,p=o.low,q=i.high,h=i.low,G=a.high,f=a.low,W=s.high,m=s.low,g=N,y=d,v=B,b=l,_=j,S=u,z=V,w=c,E=F,I=p,Y=q,T=h,K=G,X=f,J=W,Q=m,C=0;C<80;C++)var R,P,k=te[C],x=(C<16?(P=k.high=0|H[L+2*C],R=k.low=0|H[L+2*C+1]):(D=(U=te[C-15]).high,U=U.low,O=(A=te[C-2]).high,A=A.low,M=(x=te[C-7]).high,x=x.low,$=(Z=te[C-16]).high,P=(P=((D>>>1|U<<31)^(D>>>8|U<<24)^D>>>7)+M+((R=(M=(U>>>1|D<<31)^(U>>>8|D<<24)^(U>>>7|D<<25))+x)>>>0<M>>>0?1:0))+((O>>>19|A<<13)^(O<<3|A>>>29)^O>>>6)+((R+=U=(A>>>19|O<<13)^(A<<3|O>>>29)^(A>>>6|O<<26))>>>0<U>>>0?1:0),R+=D=Z.low,k.high=P=P+$+(R>>>0<D>>>0?1:0),k.low=R),E&Y^~E&K),M=I&T^~I&X,A=g&v^g&_^v&_,O=(y>>>28|g<<4)^(y<<30|g>>>2)^(y<<25|g>>>7),U=xe[C],Z=U.high,$=U.low,D=Q+((I>>>14|E<<18)^(I>>>18|E<<14)^(I<<23|E>>>9)),k=J+((E>>>14|I<<18)^(E>>>18|I<<14)^(E<<23|I>>>9))+(D>>>0<Q>>>0?1:0),ee=O+(y&b^y&S^b&S),J=K,Q=X,K=Y,X=T,Y=E,T=I,E=z+(k=k+x+((D+=M)>>>0<M>>>0?1:0)+Z+((D+=$)>>>0<$>>>0?1:0)+P+((D+=R)>>>0<R>>>0?1:0))+((I=w+D|0)>>>0<w>>>0?1:0)|0,z=_,w=S,_=v,S=b,v=g,b=y,g=k+(((g>>>28|y<<4)^(g<<30|y>>>2)^(g<<25|y>>>7))+A+(ee>>>0<O>>>0?1:0))+((y=D+ee|0)>>>0<D>>>0?1:0)|0;d=e.low=d+y,e.high=N+g+(d>>>0<y>>>0?1:0),l=t.low=l+b,t.high=B+v+(l>>>0<b>>>0?1:0),u=r.low=u+S,r.high=j+_+(u>>>0<S>>>0?1:0),c=n.low=c+w,n.high=V+z+(c>>>0<w>>>0?1:0),p=o.low=p+I,o.high=F+E+(p>>>0<I>>>0?1:0),h=i.low=h+T,i.high=q+Y+(h>>>0<T>>>0?1:0),f=a.low=f+X,a.high=G+K+(f>>>0<X>>>0?1:0),m=s.low=m+Q,s.high=W+J+(m>>>0<Q>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(128+n>>>10<<5)]=Math.floor(r/4294967296),t[31+(128+n>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=Pe.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),b.SHA512=Pe._createHelper(h),b.HmacSHA512=Pe._createHmacHelper(h),h=(b=n).x64,e=h.Word,G=h.WordArray,h=b.algo,W=h.SHA512,h=h.SHA384=W.extend({_doReset:function(){this._hash=new G.init([new e.init(3418070365,3238371032),new e.init(1654270250,914150663),new e.init(2438529370,812702999),new e.init(355462360,4144912697),new e.init(1731405415,4290775857),new e.init(2394180231,1750603025),new e.init(3675008525,1694076839),new e.init(1203062813,3204075428)])},_doFinalize:function(){var e=W._doFinalize.call(this);return e.sigBytes-=16,e}}),b.SHA384=W._createHelper(h),b.HmacSHA384=W._createHmacHelper(h);for(var Ae=Math,Oe=(h=(b=n).lib).WordArray,Ue=h.Hasher,De=b.x64.Word,h=b.algo,He=[],Le=[],Ne=[],y=1,v=0,Be=0;Be<24;Be++){He[y+5*v]=(Be+1)*(Be+2)/2%64;var je=(2*y+3*v)%5,y=v%5,v=je}for(y=0;y<5;y++)for(v=0;v<5;v++)Le[y+5*v]=v+(2*y+3*v)%5*5;for(var Ve=1,Fe=0;Fe<24;Fe++){for(var qe,Ge=0,We=0,ze=0;ze<7;ze++)1&Ve&&((qe=(1<<ze)-1)<32?We^=1<<qe:Ge^=1<<qe-32),128&Ve?Ve=Ve<<1^113:Ve<<=1;Ne[Fe]=De.create(Ge,We)}for(var M=[],Ye=0;Ye<25;Ye++)M[Ye]=De.create();function Ke(e,t,r){return e&t|~e&r}function Xe(e,t,r){return e&r|t&~r}function Je(e,t){return e<<t|e>>>32-t}function Qe(e){return"string"==typeof e?ce:o}function Ze(e,t,r){var n,o=this._iv;o?(n=o,this._iv=void 0):n=this._prevBlock;for(var i=0;i<r;i++)e[t+i]^=n[i]}function $e(e,t,r,n){var o,i=this._iv;i?(o=i.slice(0),this._iv=void 0):o=this._prevBlock,n.encryptBlock(o,0);for(var a=0;a<r;a++)e[t+a]^=o[a]}function et(e){var t,r,n;return 255==(e>>24&255)?(r=e>>8&255,n=255&e,255==(t=e>>16&255)?(t=0,255===r?(r=0,255===n?n=0:++n):++r):++t,e=0,e=(e+=t<<16)+(r<<8)+n):e+=1<<24,e}h=h.SHA3=Ue.extend({cfg:Ue.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new De.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,n=this.blockSize/2,o=0;o<n;o++){var i=e[t+2*o],a=e[t+2*o+1],i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);(w=r[o]).high^=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),w.low^=i}for(var s=0;s<24;s++){for(var d=0;d<5;d++){for(var l=0,u=0,c=0;c<5;c++)l^=(w=r[d+5*c]).high,u^=w.low;var p=M[d];p.high=l,p.low=u}for(d=0;d<5;d++)for(var h=M[(d+4)%5],f=(m=M[(d+1)%5]).high,m=m.low,l=h.high^(f<<1|m>>>31),u=h.low^(m<<1|f>>>31),c=0;c<5;c++)(w=r[d+5*c]).high^=l,w.low^=u;for(var g=1;g<25;g++){var y=(w=r[g]).high,v=w.low,b=He[g];u=b<32?(l=y<<b|v>>>32-b,v<<b|y>>>32-b):(l=v<<b-32|y>>>64-b,y<<b-32|v>>>64-b),(y=M[Le[g]]).high=l,y.low=u}var _=M[0],S=r[0];for(_.high=S.high,_.low=S.low,d=0;d<5;d++)for(c=0;c<5;c++){var w=r[g=d+5*c],E=M[g],I=M[(d+1)%5+5*c],T=M[(d+2)%5+5*c];w.high=E.high^~I.high&T.high,w.low=E.low^~I.low&T.low}(w=r[0]).high^=(_=Ne[s]).high,w.low^=_.low}},_doFinalize:function(){for(var e=this._data,t=e.words,r=(this._nDataBytes,8*e.sigBytes),n=32*this.blockSize,o=(t[r>>>5]|=1<<24-r%32,t[(Ae.ceil((1+r)/n)*n>>>5)-1]|=128,e.sigBytes=4*t.length,this._process(),this._state),i=(r=this.cfg.outputLength/8)/8,a=[],s=0;s<i;s++){var d=(l=o[s]).high,l=l.low,d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8);a.push(16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)),a.push(d)}return new Oe.init(a,r)},clone:function(){for(var e=Ue.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}}),b.SHA3=Ue._createHelper(h),b.HmacSHA3=Ue._createHmacHelper(h),Math,h=(b=n).lib,t=h.WordArray,z=h.Hasher,h=b.algo,Y=t.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),K=t.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),X=t.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),J=t.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),Q=t.create([0,1518500249,1859775393,2400959708,2840853838]),Z=t.create([1352829926,1548603684,1836072691,2053994217,0]),h=h.RIPEMD160=z.extend({_doReset:function(){this._hash=t.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}for(var i,a,s,d,l,u,c=this._hash.words,p=Q.words,h=Z.words,f=Y.words,m=K.words,g=X.words,y=J.words,v=i=c[0],b=a=c[1],_=s=c[2],S=d=c[3],w=l=c[4],r=0;r<80;r+=1)u=(u=Je(u=(u=i+e[t+f[r]]|0)+(r<16?(a^s^d)+p[0]:r<32?Ke(a,s,d)+p[1]:r<48?((a|~s)^d)+p[2]:r<64?Xe(a,s,d)+p[3]:(a^(s|~d))+p[4])|0,g[r]))+l|0,i=l,l=d,d=Je(s,10),s=a,a=u,u=(u=Je(u=(u=v+e[t+m[r]]|0)+(r<16?(b^(_|~S))+h[0]:r<32?Xe(b,_,S)+h[1]:r<48?((b|~_)^S)+h[2]:r<64?Ke(b,_,S)+h[3]:(b^_^S)+h[4])|0,y[r]))+w|0,v=w,w=S,S=Je(_,10),_=b,b=u;u=c[1]+s+S|0,c[1]=c[2]+d+w|0,c[2]=c[3]+l+v|0,c[3]=c[4]+i+b|0,c[4]=c[0]+a+_|0,c[0]=u},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var o=(n=this._hash).words,i=0;i<5;i++){var a=o[i];o[i]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return n},clone:function(){var e=z.clone.call(this);return e._hash=this._hash.clone(),e}}),b.RIPEMD160=z._createHelper(h),b.HmacRIPEMD160=z._createHmacHelper(h),h=(b=n).lib.Base,$=b.enc.Utf8,b.algo.HMAC=h.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=$.parse(t));for(var r=e.blockSize,n=4*r,e=((t=t.sigBytes>n?e.finalize(t):t).clamp(),this._oKey=t.clone()),t=this._iKey=t.clone(),o=e.words,i=t.words,a=0;a<r;a++)o[a]^=1549556828,i[a]^=909522486;e.sigBytes=t.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}}),O=(h=(b=n).lib).Base,ee=h.WordArray,U=(h=b.algo).SHA256,re=h.HMAC,ne=h.PBKDF2=O.extend({cfg:O.extend({keySize:4,hasher:U,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=re.create(r.hasher,e),o=ee.create(),i=ee.create([1]),a=o.words,s=i.words,d=r.keySize,l=r.iterations;a.length<d;){for(var u=n.update(t).finalize(i),c=(n.reset(),u.words),p=c.length,h=u,f=1;f<l;f++){h=n.finalize(h),n.reset();for(var m=h.words,g=0;g<p;g++)c[g]^=m[g]}o.concat(u),s[0]++}return o.sigBytes=4*d,o}}),b.PBKDF2=function(e,t,r){return ne.create(r).compute(e,t)},U=(O=(h=n).lib).Base,oe=O.WordArray,b=(O=h.algo).MD5,ie=O.EvpKDF=U.extend({cfg:U.extend({keySize:4,hasher:b,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,o=n.hasher.create(),i=oe.create(),a=i.words,s=n.keySize,d=n.iterations;a.length<s;){r&&o.update(r),r=o.update(e).finalize(t),o.reset();for(var l=1;l<d;l++)r=o.finalize(r),o.reset();i.concat(r)}return i.sigBytes=4*s,i}}),h.EvpKDF=function(e,t,r){return ie.create(r).compute(e,t)},n.lib.Cipher||(b=(U=(O=n).lib).Base,a=U.WordArray,ae=U.BufferedBlockAlgorithm,(h=O.enc).Utf8,se=h.Base64,de=O.algo.EvpKDF,le=U.Cipher=ae.extend({cfg:b.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){ae.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(n){return{encrypt:function(e,t,r){return Qe(t).encrypt(n,e,t,r)},decrypt:function(e,t,r){return Qe(t).decrypt(n,e,t,r)}}}}),U.StreamCipher=le.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=O.mode={},r=U.BlockCipherMode=b.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),r=h.CBC=((h=r.extend()).Encryptor=h.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;Ze.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),h.Decryptor=h.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=e.slice(t,t+n);r.decryptBlock(e,t),Ze.call(this,e,t,n),this._prevBlock=o}}),h),h=(O.pad={}).Pkcs7={pad:function(e,t){for(var r=(t=4*t)-e.sigBytes%t,n=r<<24|r<<16|r<<8|r,o=[],i=0;i<r;i+=4)o.push(n);t=a.create(o,r),e.concat(t)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},U.BlockCipher=le.extend({cfg:le.cfg.extend({mode:r,padding:h}),reset:function(){le.reset.call(this);var e,t=(r=this.cfg).iv,r=r.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,t&&t.words):(this._mode=e.call(r,this,t&&t.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),ue=U.CipherParams=b.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),r=(O.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return(e=(e=e.salt)?a.create([1398893684,1701076831]).concat(e).concat(t):t).toString(se)},parse:function(e){var t,r=(e=se.parse(e)).words;return 1398893684==r[0]&&1701076831==r[1]&&(t=a.create(r.slice(2,4)),r.splice(0,4),e.sigBytes-=16),ue.create({ciphertext:e,salt:t})}},o=U.SerializableCipher=b.extend({cfg:b.extend({format:r}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var t=(o=e.createEncryptor(r,n)).finalize(t),o=o.cfg;return ue.create({ciphertext:t,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),h=(O.kdf={}).OpenSSL={execute:function(e,t,r,n,o){return n=n||a.random(8),o=(o?de.create({keySize:t+r,hasher:o}):de.create({keySize:t+r})).compute(e,n),e=a.create(o.words.slice(t),4*r),o.sigBytes=4*t,ue.create({key:o,iv:e,salt:n})}},ce=U.PasswordBasedCipher=o.extend({cfg:o.cfg.extend({kdf:h}),encrypt:function(e,t,r,n){return r=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize,n.salt,n.hasher),n.iv=r.iv,(e=o.encrypt.call(this,e,t,r.key,n)).mixIn(r),e},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt,n.hasher),n.iv=r.iv,o.decrypt.call(this,e,t,r.key,n)}})),n.mode.CFB=((b=n.lib.BlockCipherMode.extend()).Encryptor=b.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;$e.call(this,e,t,n,r),this._prevBlock=e.slice(t,t+n)}}),b.Decryptor=b.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=e.slice(t,t+n);$e.call(this,e,t,n,r),this._prevBlock=o}}),b),n.mode.CTR=(O=(r=n.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=this._iv,i=this._counter,a=(o&&(i=this._counter=o.slice(0),this._iv=void 0),i.slice(0));r.encryptBlock(a,0),i[n-1]=i[n-1]+1|0;for(var s=0;s<n;s++)e[t+s]^=a[s]}}),r.Decryptor=O,r),n.mode.CTRGladman=(h=(U=n.lib.BlockCipherMode.extend()).Encryptor=U.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=this._iv,i=this._counter,a=(o&&(i=this._counter=o.slice(0),this._iv=void 0),0===((o=i)[0]=et(o[0]))&&(o[1]=et(o[1])),i.slice(0));r.encryptBlock(a,0);for(var s=0;s<n;s++)e[t+s]^=a[s]}}),U.Decryptor=h,U),n.mode.OFB=(O=(b=n.lib.BlockCipherMode.extend()).Encryptor=b.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=this._iv,i=this._keystream;o&&(i=this._keystream=o.slice(0),this._iv=void 0),r.encryptBlock(i,0);for(var a=0;a<n;a++)e[t+a]^=i[a]}}),b.Decryptor=O,b),n.mode.ECB=((h=n.lib.BlockCipherMode.extend()).Encryptor=h.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),h.Decryptor=h.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),h),n.pad.AnsiX923={pad:function(e,t){var r=(r=e.sigBytes)+(t=(t=4*t)-r%t)-1;e.clamp(),e.words[r>>>2]|=t<<24-r%4*8,e.sigBytes+=t},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126={pad:function(e,t){t=(t*=4)-e.sigBytes%t,e.concat(n.lib.WordArray.random(t-1)).concat(n.lib.WordArray.create([t<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.ZeroPadding={pad:function(e,t){t*=4,e.clamp(),e.sigBytes+=t-(e.sigBytes%t||t)},unpad:function(e){for(var t=e.words,r=e.sigBytes-1,r=e.sigBytes-1;0<=r;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},n.pad.NoPadding={pad:function(){},unpad:function(){}},pe=(U=n).lib.CipherParams,he=U.enc.Hex,U.format.Hex={stringify:function(e){return e.ciphertext.toString(he)},parse:function(e){return e=he.parse(e),pe.create({ciphertext:e})}};for(var b=(O=n).lib.BlockCipher,h=O.algo,_=[],tt=[],rt=[],nt=[],ot=[],it=[],at=[],st=[],dt=[],lt=[],S=[],w=0;w<256;w++)S[w]=w<128?w<<1:w<<1^283;for(var E=0,I=0,w=0;w<256;w++){var T=I^I<<1^I<<2^I<<3^I<<4,ut=(_[E]=T=T>>>8^255&T^99,S[tt[T]=E]),ct=S[ut],pt=S[ct],A=257*S[T]^16843008*T;rt[E]=A<<24|A>>>8,nt[E]=A<<16|A>>>16,ot[E]=A<<8|A>>>24,it[E]=A,at[T]=(A=16843009*pt^65537*ct^257*ut^16843008*E)<<24|A>>>8,st[T]=A<<16|A>>>16,dt[T]=A<<8|A>>>24,lt[T]=A,E?(E=ut^S[S[S[pt^ut]]],I^=S[S[I]]):E=I=1}var ht=[0,1,2,4,8,16,32,64,128,27,54],h=h.AES=b.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*(1+(this._nRounds=6+r)),o=this._keySchedule=[],i=0;i<n;i++)i<r?o[i]=t[i]:(d=o[i-1],i%r?6<r&&i%r==4&&(d=_[d>>>24]<<24|_[d>>>16&255]<<16|_[d>>>8&255]<<8|_[255&d]):(d=_[(d=d<<8|d>>>24)>>>24]<<24|_[d>>>16&255]<<16|_[d>>>8&255]<<8|_[255&d],d^=ht[i/r|0]<<24),o[i]=o[i-r]^d);for(var a=this._invKeySchedule=[],s=0;s<n;s++){var i=n-s,d=s%4?o[i]:o[i-4];a[s]=s<4||i<=4?d:at[_[d>>>24]]^st[_[d>>>16&255]]^dt[_[d>>>8&255]]^lt[_[255&d]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,rt,nt,ot,it,_)},decryptBlock:function(e,t){var r=e[t+1],r=(e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,at,st,dt,lt,tt),e[t+1]);e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,o,i,a,s){for(var d=this._nRounds,l=e[t]^r[0],u=e[t+1]^r[1],c=e[t+2]^r[2],p=e[t+3]^r[3],h=4,f=1;f<d;f++)var m=n[l>>>24]^o[u>>>16&255]^i[c>>>8&255]^a[255&p]^r[h++],g=n[u>>>24]^o[c>>>16&255]^i[p>>>8&255]^a[255&l]^r[h++],y=n[c>>>24]^o[p>>>16&255]^i[l>>>8&255]^a[255&u]^r[h++],v=n[p>>>24]^o[l>>>16&255]^i[u>>>8&255]^a[255&c]^r[h++],l=m,u=g,c=y,p=v;m=(s[l>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&p])^r[h++],g=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[p>>>8&255]<<8|s[255&l])^r[h++],y=(s[c>>>24]<<24|s[p>>>16&255]<<16|s[l>>>8&255]<<8|s[255&u])^r[h++],v=(s[p>>>24]<<24|s[l>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^r[h++],e[t]=m,e[t+1]=g,e[t+2]=y,e[t+3]=v},keySize:8});O.AES=b._createHelper(h);var ft=(O=(U=n).lib).WordArray,O=O.BlockCipher,b=U.algo,mt=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],gt=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],yt=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],vt=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],bt=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],_t=b.DES=O.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var n=mt[r]-1;t[r]=e[n>>>5]>>>31-n%32&1}for(var o=this._subKeys=[],i=0;i<16;i++){for(var a=o[i]=[],s=yt[i],r=0;r<24;r++)a[r/6|0]|=t[(gt[r]-1+s)%28]<<31-r%6,a[4+(r/6|0)]|=t[28+(gt[r+24]-1+s)%28]<<31-r%6;for(a[0]=a[0]<<1|a[0]>>>31,r=1;r<7;r++)a[r]=a[r]>>>4*(r-1)+3;a[7]=a[7]<<5|a[7]>>>27}for(var d=this._invSubKeys=[],r=0;r<16;r++)d[r]=o[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],St.call(this,4,252645135),St.call(this,16,65535),wt.call(this,2,858993459),wt.call(this,8,16711935),St.call(this,1,1431655765);for(var n=0;n<16;n++){for(var o=r[n],i=this._lBlock,a=this._rBlock,s=0,d=0;d<8;d++)s|=vt[d][((a^o[d])&bt[d])>>>0];this._lBlock=a,this._rBlock=i^s}var l=this._lBlock;this._lBlock=this._rBlock,this._rBlock=l,St.call(this,1,1431655765),wt.call(this,8,16711935),wt.call(this,2,858993459),St.call(this,16,65535),St.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function St(e,t){t=(this._lBlock>>>e^this._rBlock)&t,this._rBlock^=t,this._lBlock^=t<<e}function wt(e,t){t=(this._rBlock>>>e^this._lBlock)&t,this._lBlock^=t,this._rBlock^=t<<e}U.DES=O._createHelper(_t),b=b.TripleDES=O.extend({_doReset:function(){if(2!==(r=this._key.words).length&&4!==r.length&&r.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var e=r.slice(0,2),t=r.length<4?r.slice(0,2):r.slice(2,4),r=r.length<6?r.slice(0,2):r.slice(4,6);this._des1=_t.createEncryptor(ft.create(e)),this._des2=_t.createEncryptor(ft.create(t)),this._des3=_t.createEncryptor(ft.create(r))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2}),U.TripleDES=O._createHelper(b);var U=(h=n).lib.StreamCipher,Et=(O=h.algo).RC4=U.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],o=0;o<256;o++)n[o]=o;for(var o=0,i=0;o<256;o++){var a=t[(a=o%r)>>>2]>>>24-a%4*8&255,i=(i+n[o]+a)%256,a=n[o];n[o]=n[i],n[i]=a}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=It.call(this)},keySize:8,ivSize:0});function It(){for(var e=this._S,t=this._i,r=this._j,n=0,o=0;o<4;o++){var r=(r+e[t=(t+1)%256])%256,i=e[t];e[t]=e[r],e[r]=i,n|=e[(e[t]+e[r])%256]<<24-8*o}return this._i=t,this._j=r,n}function Tt(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],o=65535&n,i=n>>>16;d[r]=((o*o>>>17)+o*i>>>15)+i*i^((4294901760&n)*n|0)+((65535&n)*n|0)}e[0]=d[0]+(d[7]<<16|d[7]>>>16)+(d[6]<<16|d[6]>>>16)|0,e[1]=d[1]+(d[0]<<8|d[0]>>>24)+d[7]|0,e[2]=d[2]+(d[1]<<16|d[1]>>>16)+(d[0]<<16|d[0]>>>16)|0,e[3]=d[3]+(d[2]<<8|d[2]>>>24)+d[1]|0,e[4]=d[4]+(d[3]<<16|d[3]>>>16)+(d[2]<<16|d[2]>>>16)|0,e[5]=d[5]+(d[4]<<8|d[4]>>>24)+d[3]|0,e[6]=d[6]+(d[5]<<16|d[5]>>>16)+(d[4]<<16|d[4]>>>16)|0,e[7]=d[7]+(d[6]<<8|d[6]>>>24)+d[5]|0}function Ct(){for(var e=this._X,t=this._C,r=0;r<8;r++)c[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<c[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<c[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<c[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<c[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<c[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<c[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<c[6]>>>0?1:0)|0,this._b=t[7]>>>0<c[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],o=65535&n,i=n>>>16;p[r]=((o*o>>>17)+o*i>>>15)+i*i^((4294901760&n)*n|0)+((65535&n)*n|0)}e[0]=p[0]+(p[7]<<16|p[7]>>>16)+(p[6]<<16|p[6]>>>16)|0,e[1]=p[1]+(p[0]<<8|p[0]>>>24)+p[7]|0,e[2]=p[2]+(p[1]<<16|p[1]>>>16)+(p[0]<<16|p[0]>>>16)|0,e[3]=p[3]+(p[2]<<8|p[2]>>>24)+p[1]|0,e[4]=p[4]+(p[3]<<16|p[3]>>>16)+(p[2]<<16|p[2]>>>16)|0,e[5]=p[5]+(p[4]<<8|p[4]>>>24)+p[3]|0,e[6]=p[6]+(p[5]<<16|p[5]>>>16)+(p[4]<<16|p[4]>>>16)|0,e[7]=p[7]+(p[6]<<8|p[6]>>>24)+p[5]|0}h.RC4=U._createHelper(Et),O=O.RC4Drop=Et.extend({cfg:Et.cfg.extend({drop:192}),_doReset:function(){Et._doReset.call(this);for(var e=this.cfg.drop;0<e;e--)It.call(this)}}),h.RC4Drop=U._createHelper(O),h=(b=n).lib.StreamCipher,U=b.algo,i=[],s=[],d=[],U=U.Rabbit=h.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);for(var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]],r=this._b=0;r<4;r++)Tt.call(this);for(r=0;r<8;r++)o[r]^=n[r+4&7];if(t){var i=(t=t.words)[0],a=(i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8))>>>16|4294901760&(t=16711935&((t=t[1])<<8|t>>>24)|4278255360&(t<<24|t>>>8)),s=t<<16|65535&i;for(o[0]^=i,o[1]^=a,o[2]^=t,o[3]^=s,o[4]^=i,o[5]^=a,o[6]^=t,o[7]^=s,r=0;r<4;r++)Tt.call(this)}},_doProcessBlock:function(e,t){var r=this._X;Tt.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)i[n]=16711935&(i[n]<<8|i[n]>>>24)|4278255360&(i[n]<<24|i[n]>>>8),e[t+n]^=i[n]},blockSize:4,ivSize:2}),b.Rabbit=h._createHelper(U),b=(O=n).lib.StreamCipher,h=O.algo,l=[],c=[],p=[],h=h.RabbitLegacy=b.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]],o=this._b=0;o<4;o++)Ct.call(this);for(o=0;o<8;o++)n[o]^=r[o+4&7];if(t){var i=(t=16711935&((t=(e=t.words)[0])<<8|t>>>24)|4278255360&(t<<24|t>>>8))>>>16|4294901760&(e=16711935&((e=e[1])<<8|e>>>24)|4278255360&(e<<24|e>>>8)),a=e<<16|65535&t;for(n[0]^=t,n[1]^=i,n[2]^=e,n[3]^=a,n[4]^=t,n[5]^=i,n[6]^=e,n[7]^=a,o=0;o<4;o++)Ct.call(this)}},_doProcessBlock:function(e,t){var r=this._X;Ct.call(this),l[0]=r[0]^r[5]>>>16^r[3]<<16,l[1]=r[2]^r[7]>>>16^r[5]<<16,l[2]=r[4]^r[1]>>>16^r[7]<<16,l[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)l[n]=16711935&(l[n]<<8|l[n]>>>24)|4278255360&(l[n]<<24|l[n]>>>8),e[t+n]^=l[n]},blockSize:4,ivSize:2}),O.RabbitLegacy=b._createHelper(h),O=(U=n).lib.BlockCipher,b=U.algo;var Rt=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],Pt=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]],kt={pbox:[],sbox:[]};function xt(e,t){var r=e.sbox[0][t>>24&255]+e.sbox[1][t>>16&255];return(r^=e.sbox[2][t>>8&255])+e.sbox[3][255&t]}function Mt(e,t,r){for(var n,o=t,i=r,t=0;t<16;++t)n=o^=e.pbox[t],o=i=xt(e,o)^i,i=n;return n=o,o=i,i=n,i^=e.pbox[16],{left:o^=e.pbox[17],right:i}}return b=b.Blowfish=O.extend({_doReset:function(){if(this._keyPriorReset!==this._key){for(var e=(t=this._keyPriorReset=this._key).words,t=t.sigBytes/4,r=kt,n=e,o=t,i=0;i<4;i++){r.sbox[i]=[];for(t=0;t<256;t++)r.sbox[i][t]=Pt[i][t]}for(i=0,t=0;t<18;t++)r.pbox[t]=Rt[t]^n[i],++i>=o&&(i=0);for(var a=0,s=0,d=0,t=0;t<18;t+=2)a=(d=Mt(r,a,s)).left,s=d.right,r.pbox[t]=a,r.pbox[t+1]=s;for(i=0;i<4;i++)for(t=0;t<256;t+=2)a=(d=Mt(r,a,s)).left,s=d.right,r.sbox[i][t]=a,r.sbox[i][t+1]=s}},encryptBlock:function(e,t){var r=Mt(kt,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},decryptBlock:function(i,a){var e=function(e,t){for(var r,n=t,o=i[a+1],t=17;1<t;--t)r=n^=e.pbox[t],n=o=xt(e,n)^o,o=r;return r=n,n=o,o=r,o^=e.pbox[1],{left:n^=e.pbox[0],right:o}}(kt,i[a]);i[a]=e.left,i[a+1]=e.right},blockSize:2,keySize:4,ivSize:2}),U.Blowfish=O._createHelper(b),n});var ErrorConstant={join_room_timeout:{code:1014,message:"addition will timeout"},oemname_notfound:{code:1017,message:"OEM name not found"},avdEngine_init_failed:{code:1018,message:"The sdk engine failed to initialize"},set_audioCoding_failed:{code:1019,message:"Description Failed to set the audio codec"},set_videCoding_failed:{code:1020,message:"Description Failed to set the video codec"},set_speakerDevice_notsupport_failed:{code:1021,message:"Browser does not support output device selection"},set_speakerDevice_https_failed:{code:1022,message:"You need to use HTTPS for selecting audio output device"},set_speakerDevice_else_failed:{code:1023,message:"else error for selecting audio output device"},userId_format:{code:1309,message:"UserId cannot contain _ characters"},userId_required:{code:1300,message:"UserId is mandatory and cannot be empty"},mulLanding_error:{code:1301,message:"The same userId cannot be logged in multiple times"},roomId_required:{code:1302,message:"roomId is required and cannot be empty"},params_require:{code:1303,message:"params are mandatory and cannot be empty"},userAddress_require:{code:1304,message:"userAddress are required, cannot be empty"},ft_no_authorization:{code:1305,message:"Module without authorization."},upload_filer_required:{code:1306,message:"The uploaded file cannot be empty"},upload_filer_fileType:{code:1307,message:"The type of the uploaded file is not supported"},upload_filer_fileSize:{code:1308,message:"The size of the uploaded file exceeds the threshold"},operate_timeout:{code:1311,message:"The operation has timed out"},exporter_parameter_type_error:{code:1401,message:"Parameter type error"},exporter_parameter_number_error:{code:1402,message:"Parameter range is incorrect, x,y,width,height Please enter a value between 0 and 1"},exporter_parameter_number1_error:{code:1403,message:"The parameter range is incorrect. zorder Please enter a value between 0 and 10"},exporter_parameter_lack_error:{code:1404,message:"Necessary parameters are missing"},video_not_exporter_error:{code:1405,message:"The video has not yet been recorded"},video_has_exporter_error:{code:1406,message:"This video has started recording. Do not repeat recording"},exporter_mix_start_error:{code:1407,message:"No video has been added and cannot be mixed screen recorded"},video_and_userId_error:{code:1408,message:"The user Id and device Id do not match"},exporter_has_stop_error:{code:1409,message:"Recording has stopped"},mqtt_topic_reservedword_error:{code:1500,message:"The current topic value is an internal reserved word, please verify"},room_state_invalid:{code:1503,message:"The current room state  dissatisfy"},data_oversize:{code:1504,message:"The data is oversize, limiting it to 60k."},check_webrtc_supported:{code:2e3,message:"This browser is not supported WebRTC"},not_support_mediaStreamTrack:{code:2001,message:"This browser is not supported MediaStreamTrack."},screen_sharing_plugin_not_accessible:{code:2003,message:"The screen sharing plugin cannot be found"},screen_sharing_response_is_null:{code:2004,message:"No screen sharing"},not_join_room:{code:2005,message:"Haven't join room"},navigatorUserMediaError_notSupportedError:{code:2010,message:"The permission to open the device is insufficient due to non-HTTPS access"},navigatorUserMediaError_overconstrainedError:{code:2011,message:"The device failed to open because the device constraint may not be met"},navigatorUserMediaError_trackStartError:{code:2012,message:"The device failed to open because the device was already occupied"},navigatorUserMediaError_notAllowedError:{code:2013,message:"The open device permission is insufficient because the user denied the media access request"},navigatorUserMediaError_typeError:{code:2014,message:"The device failed to open because at least one audio and video was requested"},navigatorUserMediaError_unknown:{code:2015,message:"Device opening failure Unknown error"},navigatorUserMediaError_notFoundError:{code:2016,message:"Device failed to open, please ensure that the audio/video device you want to open is connected properly"},cameraId_does_not_exist:{code:2017,message:"The camera ID does not exist"},closeVideo_before_operation_warnings:{code:2018,message:"Please turn off the camera before performing this operation"},open_device_no_response:{code:2019,message:"If the device does not respond, restart the browser and try again"},websock_create_error:{code:2020,message:"Websocket failed device create"},websock_catch_exception:{code:2021,message:"Websocket  file is corrupted"},navigatorDisplayMediaError_notSupportedError:{code:2030,message:"The desktop sharing permission is insufficient because the access is not https. Procedure"},navigatorDisplayMediaError_overconstrainedError:{code:2031,message:"Failed to open desktop sharing because desktop sharing constraints may not be met"},navigatorDisplayMediaError_notAllowedError:{code:2033,message:"The desktop sharing failed to be enabled because the user did not select the shared content"},navigatorDisplayMediaError_unknown:{code:2035,message:"Desktop sharing failed to open unknown error"},navigatorDisplayMediaError_screenAudioSelectError:{code:2034,message:"Failed to open desktop sharing! Please turn on the share audio switch and share again!"}},USER_AGENT_AVD_DEFAULT="web",USER_AGENT_AVD_WEB_RECORD="avd_web_record",USER_AGENT_AVD_VIDEO_TRANSCODING="avd_video_transcoding",USER_AGENT_AVD_IOS="web_ios",USER_AGENT_AVD_MEDIA_MIXER="avd_media_mixer",USER_AGENT_AVD_MEDIA_MIXER_ADMIN="avd_media_mixer_admin",USER_AGENT_AVD_THROWING_SCREEN_ANONYM="avd_throwing_screen_anonym",ModulesEnum={avdEngine:"AVDEngine",browserDetect:"BrowserDetect",video:"Video",audio:"Audio",error:"Error",annotation:"Annotation",client:"Client"},Appender={alert:1,inpage:2,popup:3,browserConsole:4},LogLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},SignalType={websocket:"websocket",dataChannel:"dataChannel"},RoomTypeEnum={join_host_first:"join.host.first",net_acc:"net.acc",host_control:"host.control",free_speech:"free.speech"},roomTypePrivilige={join_host_first:2,net_acc:4,host_control:8},EngineCallback={open_rep_return_0:"open.rep.return.0",room_join_success:"room.join.success",room_join_error:"room.join.error",room_join_websocket_reconnection_success:"room.join.websocket.reconnection.success",pub_roomresourcemsg_rep_success:"pub.roomresourcemsg.rep.success",pub_roomresourcemsg_rep_error:"pub.roomresourcemsg.rep.error",unpub_roomresourcemsg_rep_success:"unpub.roomresourcemsg.rep.success",unpub_roomresourcemsg_rep_error:"unpub.roomresourcemsg.rep.error",sub_roomresourcemsg_rep_success:"sub.roomresourcemsg.rep.success",sub_roomresourcemsg_rep_error:"sub.roomresourcemsg.rep.error",unsub_roomresourcemsg_rep_success:"unsub.roomresourcemsg.rep.success",unsub_roomresourcemsg_rep_error:"unsub.roomresourcemsg.rep.error",device_camera_change:"device.camera.change",device_microphone_change:"device.microphone.change",updateboardmsg_rep_success:"updateboardms.rep.success",updateboardmsg_rep_error:"updateboardms.rep.error"},DataCryptoType={AES128:1,AES256:2,SM4:3},VideoCodingType={VP8:0,VP9:1,H264:2},AudioCodingType={ISAC_16k:0,ISAC_32k:1,opus:2,G722:3,PCMA:4,PCMU:5},Resolution={"1920*1280":{width:1920,height:1280,order:16},"1920*1080":{width:1920,height:1080,order:15},"1280*1024":{width:1280,height:1024,order:14},"1280*720":{width:1280,height:720,order:13},"960*720":{width:960,height:720,order:12},"640*1024":{width:640,height:1024,order:11},"640*960":{width:640,height:960,order:10},"640*480":{width:640,height:480,order:9},"640*360":{width:640,height:360,order:8},"508*360":{width:508,height:360,order:7},"480*854":{width:480,height:854,order:6},"480*800":{width:480,height:800,order:5},"320*480":{width:320,height:480,order:4},"320*240":{width:320,height:240,order:3},"320*180":{width:320,height:180,order:2},"160*120":{width:160,height:120,order:1}},ResolutionSetType={exact:0,ideal:1},ConnectionStatus={init:0,connecting:1,connected:2,connectFailed:3,reJoinRoomTimeOut:4,reJoinConnected:5,reconnected:6},MCUPeerConnectionStatus={failed:0,completed:1},RoomStatus={scheduled:0,opening:1,locked:2,closed:3},RoomCallback=(StreamStatus={none:0,init:1,published:2,muted:3,forbided:4,subed:5,opened:6},CameraType={unknown:0,front:1,back:2},VideoQualityType={high:4,normal:3,low:2},{connection_status:"connection.status",connection_indicator:"connection.indicator",room_status_notify:"room.status.notify",app_data_notify:"app.data.notify",user_data_notify:"user.data.notify",user_name_notify:"user.name.notify",public_data:"public.data",private_data:"private.data",private_data_to_user:"private.data.to.user",public_message:"public.message ",private_message:"private.message",user_join_notify:"user.join.notify",user_leave_notify:"user.leave.notify",leave_indication:"leave.indication",close_room_result:"close.room.result",close_room_notify:"close.room.notify",screen_sharing_ended:"screen.sharing.ended",mcu_peerconnection_completed:"mcu.peerconnection.completed",outgoing_invite_status_notify:"outgoing.invite.status.notify",room_control_change_notify:"room.control.change.notify",mediaplay_started_notify:"mediaplay.started.notify",mediaplay_stoped_notify:"mediaplay.stoped.notify",mediaplay_progress_notify:"mediaplay.progress.notify",stream_keep_alive_timeout_notify:"stream.keep.alive.timeout.notify"}),UserCallback={microphone_status_notify:"microphone.status.notify",camera_status_notify:"camera.status.notify",screen_status_notify:"screen.status.notify",screen_audio_status_notify:"screen,audio.status.notify",camera_data_notify:"camera.data.notify",screen_data_notify:"screen.data.notify",publish_camera_notify:"publish.camera.notify",unpublish_camera_notify:"unpublish.camera.notify",subscrible_camera_result:"subscrible.camera.result",unsubscrible_camera_result:"unsubscrible.camera.result",publish_screen_notify:"publish.screen.notify",unpublish_screen_notify:"unpublish.screen.notify",subscrible_screen_result:"subscrible.screen.result",unsubscrible_screen_result:"unsubscrible.screen.result",publish_microphone_notify:"publish.microphone.notify",unpublish_microphone_notify:"unpublish.microphone.notify",subscrible_microphone_result:"subscrible.microphone.result",unsubscrible_microphone_result:"unsubscrible.microphone.result",board_add_result:"board.add.result",board_update_result:"board.update.result",board_remove_result:"board.remove.result",board_share_result:"board.share.result",board_close_result:"board.close.result",room_set_stream_name_rep_success:"room.set.stream.name.rep.success",room_set_stream_name_rep_error:"room.set.stream.name.rep.error",video_stream_control_rep_success:"video.stream.control.rep.success",video_stream_control_rep_error:"video.stream.control.rep.error",subscrible_screen_audio_result:"subscrible.screen.audio.result",unsubscrible_screen_audio_result:"unsubscrible.screen.audio.result"},ExporderCallBack={stop_stream_rep_success:"stop.stream.rep.success",stop_stream_rep_error:"stop.stream.rep.error",pause_stream_rep_error:"pause.stream.rep.error",pause_stream_rep_success:"pause.stream.rep.success",mix_media_rep_error:"mix.media.rep.error",mix_media_rep_success:"mix.media.rep.success",select_stream_rep_success:"select.stream.rep.success",select_stream_rep_error:"select.stream.rep.error",create_server_recorder_rep_success:"create.server.recorder.rep.success",create_server_recorder_rep_error:"create.server.recorder.rep.error",bind_audio2video_rep_success:"bind.audio2video.rep.success",bind_audio2video_rep_error:"bind.audio2video.rep.error",set_focus_video_rep_success:"set.focus.video.rep.success",set_focus_video_rep_error:"set.focus.video.rep.error",get_exporter_info_rep_success:"get.exporter.info.rep.success",get_exporter_info_rep_error:"get.exporter.info.rep.error"},RecordEnum=(OperType={add:1,remove:2,update:3,share:4,close:5},{VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2},FileType:{mp4:0,webM:1}}),LiveEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2}},shapeTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17,img:18,txt:20},AnnotationInitTypeEnum={proportional:"proportional",full:"full"},boardStatusEnum={close:0,open:1},annoSelectTypeEnum={mouse:1,draw:2,eraser:3},canvasTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},fillTypeEnum={none:1,full:2},arrowTypeEnum={none:1,begin:2,end:3,double:4},connectionEventTypeEnum={sendVideo:1,recvVideo:2,sendAudio:3,recvAudio:4,conndidate:5},exporterTypeEnum={record:0,record_real_time:1,liver:2,avc_media_mixer:7},viewLayoutModeEnum={fixation:0,auto:1,auto_orato:2},exporterStatusEnum={stop:0,live:1,pause:2},recorderAudioEnum={AVD_userId_allUser:"userId2allUser",AVD_userId_allUserWithoutMe:"userId2withoutMe",AVD_userId_noneUser:"userId2None"},appDataKeyEnum={lecturer:"meeting_lecturer",voiceActivated:"voice_activated"},changeTypeEnum={remove:0,add:1},RoomStateEnum={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED",RECONNECTING:"RECONNECTING",DISCONNECTING:"DISCONNECTING"},arrayUtil={intersection:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=e[n];for(n=0,o=t.length;n<o;n++)r[t[n]]=t[n];var i,a=new Array,n=0;for(i in r)a[n++]=r[i];return a},chaji:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(n=0,o=t.length;n<o;n++)r[t[n]]=r[t[n]]?2:1;var i,a=new Array,n=0;for(i in r)1==r[i]&&(a[n++]=i);return a},chajiObject:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n].nodeId]=1;for(n=0,o=t.length;n<o;n++)r[t[n].nodeId]=r[t[n].nodeId]?2:1;var i,a=new Array,n=0;for(i in r)1==r[i]&&(a[n++]=i);return a},inANotInB:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(n=0,o=t.length;n<o;n++)r.hasOwnProperty(t[n])&&(r[t[n]]=void 0);var i,a=new Array,n=0;for(i in r)r[i]&&(a[n++]=i);return a},baseSplice:function(e,t){for(var r,n=0;n<e.length;n++)if(e[n]==t){r=n;break}-1<r&&e.splice(r,1)},objectSplice:function(e,t){for(var r,n=0;n<e.length;n++)if(e[n].id==t){r=n;break}-1<r&&e.splice(r,1)},userIdSplice:function(e,t){for(var r,n=0;n<e.length;n++)if(e[n].userId==t){r=n;break}-1<r&&e.splice(r,1)},userIdAndNodeIdSplice:function(e,t,r){for(var n,o=0;o<e.length;o++){var i=e[o];if(i.id==t&&i.nodeId==r){n=o;break}}-1<n&&e.splice(n,1)},contains:function(e,t){for(var r=0;r<e.length;r++)if(0<=t.indexOf(e[r]))return!0;return!1}};function getRandomNum(e,t){var t=t-e,r=Math.random();return e+Math.round(r*t)}var typeConversionUtil={String2ArrayBuffer:function(e){for(var e=btoa(unescape(encodeURIComponent(e))),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,o=e.length;n<o;n++)r[n]=e.charCodeAt(n);return t},ArrayBuffer2String:function(e){e=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(atob(e)))},Uint8ArrayToString:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},stringToUint8Array:function(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push(e.charCodeAt(r));return new Uint8Array(t)}},dcodeIO,dcodeIO;function versionStringCompare(e,t){for(var r=e.split("."),n=t.split("."),o=Math.max(r.length,n.length),i=0,a=0;a<o;a++){var s=r.length>a?r[a]:0,s=isNaN(Number(s))?s.charCodeAt():Number(s),d=n.length>a?n[a]:0,d=isNaN(Number(d))?d.charCodeAt():Number(d);if(s<d){i=-1;break}if(d<s){i=1;break}}return i}function resizeVideo(e,t,r){doResizeVideo(e,t,r,!1)}function resizeRealVideo(e,t,r){doResizeVideo(e,t,r,!0)}function doResizeVideo(n,o,i,a){o=o||window.innerWidth,i=i||window.innerHeight,n.addEventListener("loadedmetadata",function(e){var t=this.videoWidth,r=this.videoHeight;positionLarge(n,t,r,o,i,a)})}function positionLarge(e,t,r,n,o,i){t=(i?getCameraRealVideoSize:getCameraVideoSize)(t,r,n,o),r=t[0],t=t[1],n=getCameraVideoPosition(r,t,n,o),o=n[0],n=n[1];(i?positionRealVideo:positionVideo)(e,r,t,o,n)}function getCameraVideoSize(e,t,r,n){var o=e/t;return[r=(r=Math.max(e,r))/o<(n=Math.max(t,n))?n*o:r,n=n*o<r?r/o:n]}function getCameraRealVideoSize(e,t,r,n){var o=e/t,i=Math.max(e,r),a=Math.max(t,n);return e<=i&&t<=a?r/n<o?n=r/o:r=n*o:(r=(n=a)<(r=i)/o?n*o:r)<n*o&&(n=r/o),[r,n]}function getCameraVideoPosition(e,t,r,n){return[(r-e)/2,(n-t)/2]}function positionVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r)}function positionRealVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r);t=e.parentNode;t.style.top=o+"px",t.style.bottom=o+"px",t.style.left=n+"px",t.style.right=n+"px"}function fullScreenInit(){document.cancelFullScreen=document.webkitCancelFullScreen||document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.requestFullScreen,(document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=displayFullScreenStatus)()}function doFullScreen(e,t){e.requestFullScreen=e.webkitRequestFullScreen||e.mozRequestFullScreen||e.requestFullScreen,isFullScreen()&&t.target!==e||fullScreenElement()===e?document.cancelFullScreen():(t.target,e.requestFullScreen())}function displayFullScreenStatus(){isFullScreen()}function isFullScreen(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.isFullScreen)}function fullScreenElement(){return document.webkitFullScreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullScreenElement}function doFullScreenInIE(e){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth);var t,r=window.createPopup(),n=r.document.body,o=(n.style.backgroundColor="lime",n.style.border="solid black 1px",n.innerHTML="在鼠标点击窗口以外区域时自动关闭",r.document.createElement("object"));Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window?((t=r.document.createElement("param")).setAttribute("name","windowless"),t.setAttribute("value",!0),o.appendChild(t),o.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")):o.setAttribute("type","application/avd-plugin"),o.setAttribute("id","fullScreen"),o.setAttribute("width",winWidth),o.setAttribute("height",winHeight),o.src=e,n.appendChild(o),r.show(0,0,winWidth,winHeight,document.body)}function getLocalClientIP(){var t,n,o=when.defer(),e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;function i(e){if(!(e in n)){n[e]=!0;for(var t=Object.keys(n).filter(function(e){return n[e]}),r=0;r<t.length;r++)16<t[r].length&&(t.splice(r,1),r--);o.resolve(t[0])}}function r(e){e.split("\r\n").forEach(function(e,t,r){var n,o;~e.indexOf("a=candidate")?(o=(n=e.split(" "))[4],"host"===n[7]&&i(o)):~e.indexOf("c=")&&i(o=(n=e.split(" "))[2])})}return e?((t=new e({iceServers:[]})).createDataChannel("",{reliable:!1}),t.onicecandidate=function(e){e.candidate&&r("a="+e.candidate.candidate)},t.createOffer(function(e){r(e.sdp),t.setLocalDescription(e)},function(e){console.warn("offer failed",e)}),(n=Object.create(null))["0.0.0.0"]=!1):o.reject(""),o.promise}function getEffectiveType(){return navigator.connection.effectiveType}function mathPI2degree(e){return 0==e||-0==e?0:90*Math.round(e/-1.570796326)}function degree2mathPI(e){return 0==e?-0:e/90*-1.570796326}function getGPUInfo(){try{var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl"),r=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(r.UNMASKED_RENDERER_WEBGL);return n.substring(n.indexOf("(")+1,n.lastIndexOf(")")-1)}catch(e){return""}}function debounce(r,n){var o=null;return function(){var e=this,t=arguments;clearTimeout(o),o=setTimeout(function(){r.apply(e,t)},n)}}!function(){function o(){}var i={},s={};window.ModuleBase={define:function(e,t,r){return i[e]||(i[e]={name:e,dependencies:t,factory:r}),i[e]},use:function(e){var t=i[e];if(!t)return null;if(!t.entity){for(var r=[],n=0;n<t.dependencies.length;n++)i[t.dependencies[n]].entity?r.push(i[t.dependencies[n]].entity):r.push(this.use(t.dependencies[n]));t.entity=t.factory.apply(o,r)}return t.entity},require:function(r,n){for(var e=0;e<r.length;e++){var o,i,a=r[e];s[a]||(o=document.getElementsByTagName("head")[0],(i=document.createElement("script")).type="text/javascript",i.async="true",i.src=a+".js",i.onload=function(){s[a]=!0,o.removeChild(i);for(var e=!0,t=0;t<r.length;t++)if(!s[r[t]]){e=!1;break}e&&n()},o.appendChild(i))}}}}(),ModuleBase.define("Error",[],function(){function e(e,t){"object"==typeof e&&void 0===t?(this.code=e.code,this.message=e.message):(this.code=e,this.message=t)}return e.prototype.errorShow=function(){return"error code:"+this.code+"; error message:"+this.message},e}),dcodeIO=dcodeIO?dcodeIO.ProtoBuf:module.exports;var cmdBuilder=dcodeIO.newBuilder({}).import({package:"room_pdu",messages:[{name:"Packet",fields:[{rule:"required",type:"RoomPduType",name:"type",id:1},{rule:"required",type:"int32",name:"priority",id:2,options:{default:0}},{rule:"required",type:"int32",name:"src",id:3},{rule:"required",type:"int32",name:"dst",id:4,options:{default:0}},{rule:"optional",type:"bytes",name:"body",id:5}]},{name:"MultiPacket",fields:[{rule:"repeated",type:"Packet",name:"packets",id:1}]},{name:"Webcam",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"CameraType",name:"ctype",id:7},{rule:"optional",type:"string",name:"stream_nick_name",id:8},{rule:"optional",type:"string",name:"stream_name",id:9}]},{name:"Speaker",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"Desktop",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"string",name:"stream_nick_name",id:7},{rule:"optional",type:"string",name:"stream_name",id:8}]},{name:"DocFile",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"required",type:"string",name:"uri",id:5}]},{name:"AddWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Webcam",name:"webcam",id:2}]},{name:"RemoveWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Speaker",name:"speaker",id:2}]},{name:"RemoveSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"DocFile",name:"docfile",id:2}]},{name:"RemoveDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"RoomResourceInfo",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"int32",name:"owner_id",id:2},{rule:"optional",type:"MediaStream",name:"stream",id:3},{rule:"optional",type:"MediaStream",name:"stream_assist1",id:4},{rule:"optional",type:"MediaStream",name:"stream_assist2",id:5},{rule:"optional",type:"int32",name:"publishQualities",id:6},{rule:"optional",type:"string",name:"rtmp_play_url",id:7},{rule:"optional",type:"int32",name:"keep_alive_time",id:8}]},{name:"RoomInfo",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"required",type:"RoomStatus",name:"room_status",id:2,options:{default:"init_room"}}]},{name:"UserPolicy",fields:[{rule:"optional",type:"bool",name:"join_chat",id:1},{rule:"optional",type:"bool",name:"join_audio",id:2},{rule:"optional",type:"bool",name:"join_video",id:3}]},{name:"JoinInfo",fields:[{rule:"repeated",type:"Webcam",name:"webcams",id:1},{rule:"repeated",type:"Speaker",name:"speakers",id:2},{rule:"optional",type:"string",name:"user_agent",id:3},{rule:"required",type:"UserPolicy",name:"user_policy",id:4},{rule:"optional",type:"string",name:"user_resources",id:5}]},{name:"UserInfo",fields:[{rule:"optional",type:"string",name:"user_id",id:1},{rule:"required",type:"string",name:"user_name",id:2},{rule:"required",type:"UserRole",name:"role",id:3},{rule:"required",type:"int32",name:"privileges",id:4},{rule:"required",type:"UserStatus",name:"status",id:5},{rule:"repeated",type:"Webcam",name:"webcams",id:6},{rule:"repeated",type:"Speaker",name:"speakers",id:7},{rule:"optional",type:"string",name:"user_agent",id:8},{rule:"required",type:"int32",name:"node_id",id:9},{rule:"optional",type:"UserPolicy",name:"user_policy",id:10},{rule:"repeated",type:"Desktop",name:"desktops",id:11},{rule:"optional",type:"string",name:"user_data",id:12}]},{name:"MediaStream",fields:[{rule:"required",type:"string",name:"stream_name",id:1},{rule:"required",type:"MediaType",name:"type",id:2},{rule:"optional",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"width",id:4},{rule:"optional",type:"int32",name:"height",id:5},{rule:"optional",type:"int32",name:"frame_rate",id:6},{rule:"optional",type:"int32",name:"payload",id:7},{rule:"optional",type:"uint32",name:"sdp_version",id:8}]},{name:"MediaStreamInfo",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"MediaStream",name:"stream",id:3}]},{name:"ResourceIndiction",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"ResourceOpt",name:"opt",id:2},{rule:"required",type:"int32",name:"owner_id",id:3},{rule:"required",type:"int32",name:"operator_id",id:4},{rule:"optional",type:"string",name:"host_tocken",id:5}]},{name:"AddDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Desktop",name:"desktop",id:2}]},{name:"UpdateSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Speaker",name:"speaker",id:3}]},{name:"UpdateWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Webcam",name:"webcam",id:3}]},{name:"UpdateDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Desktop",name:"desktop",id:3}]},{name:"JoinReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"version",id:2},{rule:"required",type:"string",name:"room_tocken",id:3},{rule:"optional",type:"string",name:"user_id",id:4},{rule:"required",type:"string",name:"user_name",id:5},{rule:"optional",type:"JoinInfo",name:"join_info",id:6},{rule:"optional",type:"string",name:"password",id:7}]},{name:"JoinRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomInfo",name:"room_info",id:4},{rule:"optional",type:"int32",name:"node_id",id:5},{rule:"optional",type:"UserInfo",name:"user_info",id:6}]},{name:"LeaveMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"reason",id:2}]},{name:"UpdateRoomStatusMsg",fields:[{rule:"required",type:"RoomStatus",name:"status",id:1}]},{name:"PubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"UnpubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"SubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3},{rule:"optional",type:"int32",name:"video_level",id:4}]},{name:"UnsubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3}]},{name:"PubResourceReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2}]},{name:"PubResourceRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RepResultType",name:"type",id:2},{rule:"optional",type:"int32",name:"reason",id:3}]},{name:"RoomKV",fields:[{rule:"required",type:"string",name:"key",id:1},{rule:"required",type:"string",name:"value",id:2}]},{name:"RoomDataInfo",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"repeated",type:"RoomKV",name:"kvs",id:2}]},{name:"PubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"SubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"RoomResourceInfos",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"optional",type:"string",name:"room_id",id:2}]},{name:"UpdateStreamSsrcMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"uint32",name:"old_ssrc",id:3},{rule:"required",type:"uint32",name:"new_ssrc",id:4}]},{name:"ClientTranceInfo",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"level",id:2},{rule:"required",type:"string",name:"msg",id:3}]},{name:"CloseRoomReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"node_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"CloseRoomRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"StartVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"StopVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"ModifyResourceReq",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"optional",type:"int32",name:"video_level",id:3}]},{name:"ModifyResourceRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"UnsubRoomResourceMsgRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"GetMiniProgramStreamUrlReq",fields:[{rule:"optional",type:"int32",name:"id",id:1}]},{name:"GetMiniProgramStreamUrlRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"url",id:3}]},{name:"BindAudioToVideoReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"audio_resource_id",id:2},{rule:"required",type:"string",name:"video_resouce_id",id:3}]},{name:"BindAudioToVideoRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"UnpubRoomResourceMsgRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"TextMsg",fields:[{rule:"required",type:"string",name:"content",id:1},{rule:"optional",type:"int32",name:"timestamp",id:2}]},{name:"DATA",fields:[{rule:"required",type:"bytes",name:"content",id:1}]},{name:"PrivateDataToUser",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"dst_user_id",id:2},{rule:"required",type:"bytes",name:"content",id:3},{rule:"optional",type:"string",name:"src_user_id",id:4}]},{name:"UserInfoMsg",fields:[{rule:"repeated",type:"UserInfo",name:"user",id:1}]},{name:"UserMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserMsgOpt",name:"opt",id:2},{rule:"optional",type:"int32",name:"reason",id:3},{rule:"optional",type:"int32",name:"opt_node_id",id:4}]},{name:"UpdateUserRolePriviledgeMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"old",id:2},{rule:"required",type:"int32",name:"new",id:3}]},{name:"UpdateUserStatusMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserStatus",name:"old",id:2},{rule:"required",type:"UserStatus",name:"new",id:3}]},{name:"UpdateUserRoleMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserRole",name:"old",id:2},{rule:"required",type:"UserRole",name:"new",id:3}]},{name:"UserIndiction",fields:[{rule:"required",type:"int32",name:"operator_id",id:1},{rule:"required",type:"RoomPduType",name:"type",id:2},{rule:"optional",type:"bytes",name:"body",id:3}]},{name:"UpdateUserDataMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"user_data",id:2}]},{name:"RejoinRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"CloseRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"UpdateUserName",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"optional",type:"string",name:"new_name",id:2}]},{name:"ChangeHost",fields:[{rule:"required",type:"int32",name:"host_node_id",id:1},{rule:"optional",type:"int32",name:"newhost_node_id",id:2}]},{name:"OfferReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"sdp",id:2},{rule:"required",type:"int32",name:"node_id",id:3}]},{name:"OfferRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"sdp",id:4},{rule:"optional",type:"int32",name:"node_id",id:5}]},{name:"CandidateMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"int32",name:"node_id",id:4}]},{name:"SubRoomResourceReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"required",type:"int32",name:"sub_node_id",id:3}]},{name:"SubRoomResourceRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomResourceInfo",name:"info",id:4}]},{name:"OpenReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"access_tocken",id:2},{rule:"optional",type:"string",name:"signal_tocken",id:3},{rule:"optional",type:"string",name:"version",id:4},{rule:"optional",type:"string",name:"thread_id",id:5},{rule:"optional",type:"int32",name:"is_cluster",id:6},{rule:"optional",type:"string",name:"audio_codec_payload_map",id:7}]},{name:"OpenRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"signal_tocken",id:4},{rule:"optional",type:"int32",name:"ping_timeout",id:5},{rule:"optional",type:"int32",name:"ping_interval",id:6},{rule:"optional",type:"string",name:"version",id:7}]},{name:"InviteRoomReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"node_id",id:4}]},{name:"InviteRoomReq1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"version",id:3},{rule:"required",type:"string",name:"access_tocken",id:4},{rule:"optional",type:"string",name:"user_id",id:5},{rule:"required",type:"string",name:"user_name",id:6},{rule:"optional",type:"JoinInfo",name:"join_info",id:7},{rule:"optional",type:"string",name:"password",id:8},{rule:"optional",type:"int32",name:"node_id",id:9},{rule:"optional",type:"bool",name:"is_dtls",id:10},{rule:"optional",type:"string",name:"user_data",id:11},{rule:"optional",type:"string",name:"ice_ufrag",id:12},{rule:"optional",type:"string",name:"ice_pwd",id:13},{rule:"optional",type:"bytes",name:"routes_json",id:20},{rule:"optional",type:"int32",name:"media_connect_type",id:21},{rule:"optional",type:"DataCryptoType",name:"crypto_type",id:22}]},{name:"RoomInfo1",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"topic",id:2},{rule:"optional",type:"string",name:"owner_id",id:3},{rule:"optional",type:"string",name:"host_id",id:4},{rule:"optional",type:"bool",name:"has_pwd",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"int32",name:"timezone",id:7},{rule:"optional",type:"int32",name:"start_time",id:8},{rule:"optional",type:"int32",name:"end_time",id:9},{rule:"optional",type:"RoomMode",name:"room_mode",id:10},{rule:"optional",type:"int32",name:"attendee_max",id:11},{rule:"optional",type:"int32",name:"bandwidth",id:12},{rule:"optional",type:"int32",name:"max_audio",id:13},{rule:"optional",type:"int32",name:"max_video",id:14},{rule:"optional",type:"string",name:"room_extend_id",id:15},{rule:"optional",type:"RoomStatus",name:"room_status",id:16,options:{default:"init_room"}},{rule:"optional",type:"int32",name:"attributes",id:17},{rule:"optional",type:"string",name:"is_host_room",id:18},{rule:"optional",type:"int32",name:"room_index_id",id:19}]},{name:"InviteRoomRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"string",name:"sdp",id:5},{rule:"optional",type:"RoomInfo1",name:"room_info",id:6}]},{name:"InviteRoomRep1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"RoomInfo1",name:"room_info",id:5},{rule:"optional",type:"string",name:"finger_print",id:6},{rule:"optional",type:"int32",name:"node_id",id:7},{rule:"optional",type:"int32",name:"ping_timeout",id:8},{rule:"optional",type:"int32",name:"ping_interval",id:9},{rule:"optional",type:"string",name:"ice_ufrag",id:10},{rule:"optional",type:"string",name:"ice_pwd",id:11},{rule:"optional",type:"UserRole",name:"role",id:12},{rule:"optional",type:"string",name:"setup",id:13,options:{default:"active"}},{rule:"optional",type:"string",name:"candidate_string",id:14},{rule:"optional",type:"bool",name:"fec_suported",id:15}]},{name:"CandidateMsg1",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"CloseMsg",fields:[{rule:"required",type:"string",name:"room_tocken",id:1}]},{name:"IceRestartMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"OutgoingInviteStatusNotify",fields:[{rule:"required",type:"OutgoingInviteType",name:"type",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sip_addr",id:3},{rule:"required",type:"int32",name:"status",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"RoomControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAttributeChangeNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAvcControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"int32",name:"handler",id:2}]},{name:"RoomAvcControlRep",fields:[{rule:"required",type:"int32",name:"ret",id:1},{rule:"required",type:"string",name:"msg",id:2}]},{name:"RoomSetStreamNameReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"string",name:"stream_name",id:5},{rule:"optional",type:"string",name:"stream_nick_name",id:6}]},{name:"RoomSetStreamNameRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"int32",name:"ret",id:6},{rule:"optional",type:"string",name:"msg",id:7}]},{name:"RoomStreamNameChangedNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"user_id",id:2},{rule:"required",type:"string",name:"video_resource_id",id:3},{rule:"optional",type:"string",name:"stream_name",id:4},{rule:"optional",type:"string",name:"stream_nick_name",id:5}]},{name:"UserActionEventsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"events",id:4}]},{name:"UserActionEventsRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"optional",type:"int32",name:"ret",id:4},{rule:"optional",type:"string",name:"msg",id:5},{rule:"optional",type:"string",name:"rsp_data",id:6}]},{name:"UserSetKeepAliveTimeReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"keepAliveTime",id:4}]},{name:"UserSetKeepAliveTimeRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"ret",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"UserStreamActive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"resource_id",id:4},{rule:"optional",type:"StreamActiveStatus",name:"active_base",id:5,options:{default:"StreamActiveStatusUnchanged"}},{rule:"optional",type:"StreamActiveStatus",name:"active_ass1",id:6,options:{default:"StreamActiveStatusUnchanged"}},{rule:"optional",type:"StreamActiveStatus",name:"active_ass2",id:7,options:{default:"StreamActiveStatusUnchanged"}}]},{name:"MediaPlayEventNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"play_id",id:3},{rule:"required",type:"MediaPlayEvents",name:"event",id:4},{rule:"required",type:"string",name:"user_id",id:5},{rule:"optional",type:"string",name:"file_path",id:6}]},{name:"StreamKeepAliveTimeoutNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"int32",name:"onwer_id",id:3},{rule:"required",type:"uint32",name:"ssrc",id:4},{rule:"required",type:"string",name:"resource_id",id:5},{rule:"required",type:"MediaType",name:"media_type",id:6}]},{name:"VideoStreamControlReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"int32",name:"onwer_id",id:3},{rule:"required",type:"string",name:"resource_id",id:4},{rule:"required",type:"int32",name:"bitrate_max",id:5},{rule:"required",type:"int32",name:"bitrate_min",id:6},{rule:"required",type:"int32",name:"width",id:7},{rule:"required",type:"int32",name:"heigth",id:8}]},{name:"VideoStreamControlRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"ret",id:2},{rule:"required",type:"string",name:"msg",id:3}]},{name:"Point",fields:[{rule:"required",type:"int32",name:"x",id:1},{rule:"required",type:"int32",name:"y",id:2}]},{name:"color",fields:[{rule:"required",type:"int32",name:"a",id:1},{rule:"required",type:"int32",name:"r",id:2},{rule:"required",type:"int32",name:"g",id:3},{rule:"required",type:"int32",name:"b",id:4}]},{name:"Rect",fields:[{rule:"required",type:"int32",name:"left",id:1},{rule:"required",type:"int32",name:"right",id:2},{rule:"required",type:"int32",name:"top",id:3},{rule:"required",type:"int32",name:"bottom",id:4}]},{name:"AnnotationObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"string",name:"annotationId",id:2},{rule:"required",type:"int32",name:"ownerNodeId",id:3},{rule:"required",type:"string",name:"ownerUserId",id:4},{rule:"required",type:"AnnotationType",name:"type",id:5},{rule:"required",type:"LineArrow",name:"arrow",id:6},{rule:"required",type:"int32",name:"lineWidth",id:7},{rule:"required",type:"color",name:"lineColor",id:8},{rule:"required",type:"color",name:"fillColor",id:9},{rule:"required",type:"Rect",name:"objectRect",id:10}]},{name:"Annotation2Point",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"Point",name:"start",id:2},{rule:"required",type:"Point",name:"end",id:3}]},{name:"AnnotationMultiPoint",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"Point",name:"points",id:2}]},{name:"AnnotationList",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"string",name:"eraserIds",id:2}]},{name:"ImgInfo",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"x",id:2},{rule:"required",type:"int32",name:"y",id:3},{rule:"required",type:"int32",name:"w",id:4},{rule:"required",type:"int32",name:"h",id:5},{rule:"required",type:"int32",name:"layer",id:6},{rule:"required",type:"int32",name:"boder",id:7},{rule:"required",type:"bool",name:"has_select",id:8},{rule:"required",type:"int32",name:"rotate",id:9},{rule:"required",type:"string",name:"file_url",id:10},{rule:"optional",type:"string",name:"extendData",id:11}]},{name:"AnnotationImg",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"ImgInfo",name:"im",id:2}]},{name:"Txt",fields:[{rule:"required",type:"int32",name:"line",id:1},{rule:"required",type:"string",name:"content",id:2}]},{name:"TextInfo",fields:[{rule:"required",type:"uint32",name:"fontSize",id:1},{rule:"repeated",type:"Txt",name:"txs",id:2},{rule:"required",type:"color",name:"fontColor",id:3},{rule:"optional",type:"uint32",name:"oneHeight",id:4},{rule:"optional",type:"uint32",name:"oneWidth",id:5},{rule:"optional",type:"uint32",name:"fontUnit",id:6},{rule:"optional",type:"string",name:"fontStyle",id:7},{rule:"optional",type:"string",name:"fontWeight",id:8},{rule:"optional",type:"string",name:"fontFamily",id:9},{rule:"optional",type:"string",name:"extendData",id:10}]},{name:"AnnotationTxt",fields:[{rule:"required",type:"Annotation2Point",name:"objectBase",id:1},{rule:"required",type:"TextInfo",name:"txi",id:2}]},{name:"AnnotationMsgInternal",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2},{rule:"optional",type:"string",name:"annotationId",id:3},{rule:"optional",type:"int32",name:"srcNodeId",id:4},{rule:"optional",type:"int32",name:"dstNodeId",id:5}]},{name:"AnnotationMsg",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2}]},{name:"UpdateAnnotationMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"string",name:"objectId",id:2},{rule:"required",type:"uint32",name:"annotationType",id:3},{rule:"optional",type:"string",name:"annotationId",id:4},{rule:"required",type:"int32",name:"operNodeId",id:5},{rule:"required",type:"string",name:"operUserId",id:6},{rule:"optional",type:"Annotation2Point",name:"ann2pt",id:7},{rule:"optional",type:"AnnotationMultiPoint",name:"annMutlipt",id:8},{rule:"optional",type:"AnnotationList",name:"annList",id:9},{rule:"optional",type:"AnnotationImg",name:"Img",id:10},{rule:"optional",type:"AnnotationTxt",name:"txt",id:11}]},{name:"BoardObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"int32",name:"ownerNodeId",id:2},{rule:"required",type:"string",name:"ownerUserId",id:3},{rule:"required",type:"int32",name:"width",id:4},{rule:"required",type:"int32",name:"height",id:5},{rule:"optional",type:"color",name:"bgColor",id:6},{rule:"optional",type:"string",name:"bgImage",id:7},{rule:"repeated",type:"AnnotationObject",name:"annotations",id:8},{rule:"optional",type:"string",name:"title",id:9},{rule:"optional",type:"string",name:"description",id:10},{rule:"optional",type:"string",name:"extendData",id:11}]},{name:"UpdateBoardMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"int32",name:"operNodeId",id:2},{rule:"required",type:"string",name:"operUserId",id:3},{rule:"optional",type:"string",name:"boardId",id:4},{rule:"optional",type:"BoardObject",name:"board",id:5}]},{name:"BoardsInfoMsg",fields:[{rule:"repeated",type:"BoardObject",name:"boards",id:2}]},{name:"UpdateBoardMsgRep",fields:[{rule:"required",type:"int32",name:"result",id:1},{rule:"optional",type:"string",name:"description",id:2},{rule:"required",type:"uint32",name:"operType",id:3},{rule:"optional",type:"string",name:"boardId",id:4}]},{name:"OutgoingCreateLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"liver_name",id:8},{rule:"optional",type:"string",name:"app_data",id:9}]},{name:"OutgoingCreateLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4},{rule:"optional",type:"string",name:"publish_url",id:5},{rule:"optional",type:"string",name:"rtmp_url",id:6},{rule:"optional",type:"string",name:"hls_url",id:7}]},{name:"OutgoingSelectMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingVideoInfo",fields:[{rule:"required",type:"string",name:"owner_user_id",id:1},{rule:"required",type:"int32",name:"zoder",id:2},{rule:"optional",type:"float",name:"x",id:5},{rule:"optional",type:"float",name:"y",id:6},{rule:"optional",type:"float",name:"w",id:7},{rule:"optional",type:"float",name:"h",id:8},{rule:"optional",type:"string",name:"video_resource_id",id:9},{rule:"optional",type:"string",name:"video_data",id:10}]},{name:"OutgoingMixMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingDestroyLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingPauseResumeLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"liver_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingGetLivers",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"liver_id",id:3}]},{name:"OutGoingLiverInfo",fields:[{rule:"required",type:"string",name:"liver_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"string",name:"createTime",id:4},{rule:"optional",type:"string",name:"duration",id:5},{rule:"optional",type:"string",name:"room_id",id:6},{rule:"optional",type:"LiveStatus",name:"status",id:7},{rule:"optional",type:"string",name:"publish_url",id:8},{rule:"optional",type:"string",name:"rtmp_url",id:9},{rule:"optional",type:"string",name:"hls_url",id:10}]},{name:"OutgoingGetLiversRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingLiverInfo",name:"liverInfos",id:3}]},{name:"OutgoingCreateRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"record_name",id:5},{rule:"optional",type:"string",name:"app_data",id:6},{rule:"optional",type:"int32",name:"file_type",id:7}]},{name:"OutgoingCreateRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4},{rule:"optional",type:"string",name:"play_url",id:5}]},{name:"OutgoingSelectMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingMixMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingDestroyRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingPauseResumeRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"record_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingGetRecords",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"record_id",id:3}]},{name:"OutGoingRecordInfo",fields:[{rule:"required",type:"string",name:"record_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"MediaFileType",name:"file_type",id:4},{rule:"optional",type:"string",name:"url",id:5},{rule:"optional",type:"int64",name:"file_size",id:6},{rule:"optional",type:"string",name:"create_time",id:7},{rule:"optional",type:"int64",name:"duration",id:8},{rule:"optional",type:"string",name:"room_id",id:9},{rule:"optional",type:"RecordStatus",name:"status",id:10}]},{name:"OutgoingGetRecordsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingRecordInfo",name:"recordInfos",id:3}]},{name:"OutgoingCreateStreamsExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"exporter_name",id:5},{rule:"optional",type:"ExporterType",name:"exporter_type",id:6},{rule:"optional",type:"int32",name:"viewWidth",id:7},{rule:"optional",type:"int32",name:"viewHeight",id:8},{rule:"optional",type:"int32",name:"outBitrate",id:9},{rule:"optional",type:"int32",name:"outFps",id:10},{rule:"optional",type:"string",name:"app_data",id:11},{rule:"optional",type:"bool",name:"auto_close",id:12},{rule:"optional",type:"int32",name:"view_bg_color",id:13},{rule:"optional",type:"int32",name:"view_bg_image",id:14},{rule:"optional",type:"string",name:"main_video_resource_id",id:15},{rule:"optional",type:"string",name:"exporter_nick_name",id:16},{rule:"optional",type:"int32",name:"max_video_number",id:17},{rule:"optional",type:"string",name:"pulish_urls",id:18}]},{name:"OutgoingCreateStreamsExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5},{rule:"optional",type:"string",name:"play_urls",id:6},{rule:"optional",type:"string",name:"exporter_name",id:7}]},{name:"OutgoingSelectStreamReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"string",name:"stream_name",id:7},{rule:"optional",type:"ExporterType",name:"exporter_type",id:8}]},{name:"OutgoingSelectStreamRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingMixStreamsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"ExporterType",name:"exporter_type",id:7}]},{name:"OutgoingMixStreamsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingDestroyExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingDestroyExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingPauseResumeExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"exporter_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingPauseResumeExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterErrorNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"error_no",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterSetFocusVideoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingExporterSetFocusVideoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"int32",name:"ret",id:4},{rule:"optional",type:"string",name:"msg",id:5}]},{name:"OutgoingGetExporterInfoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingGetExporterInfoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"view_stream_id",id:3},{rule:"optional",type:"string",name:"view_name",id:4},{rule:"optional",type:"int32",name:"view_bitrate",id:5},{rule:"optional",type:"int32",name:"view_fps",id:6},{rule:"optional",type:"int32",name:"view_width",id:7},{rule:"optional",type:"int32",name:"view_height",id:8},{rule:"optional",type:"int32",name:"view_bg_color",id:9},{rule:"optional",type:"int32",name:"view_bg_image",id:10},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:11},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:12},{rule:"optional",type:"string",name:"focus_video_resource_id",id:13},{rule:"optional",type:"string",name:"exporter_name",id:14},{rule:"optional",type:"string",name:"exporter_nick_name",id:15},{rule:"optional",type:"int32",name:"max_video_number",id:16},{rule:"optional",type:"int32",name:"ret",id:17},{rule:"optional",type:"string",name:"msg",id:18}]},{name:"MouseParams",fields:[{rule:"optional",type:"string",name:"paramStr",id:1},{rule:"optional",type:"int32",name:"paramInt",id:2}]},{name:"MouseMsg",fields:[{rule:"required",type:"uint32",name:"mouseT",id:1},{rule:"required",type:"int32",name:"x_pos",id:2},{rule:"required",type:"int32",name:"y_pos",id:3},{rule:"repeated",type:"MouseParams",name:"params",id:4}]},{name:"KeyCtrl",fields:[{rule:"required",type:"uint32",name:"keyC",id:1}]},{name:"KeyValue",fields:[{rule:"required",type:"uint32",name:"keyV",id:1}]},{name:"KeyBoardMsg",fields:[{rule:"repeated",type:"KeyCtrl",name:"cc",id:1},{rule:"repeated",type:"KeyValue",name:"vv",id:2}]},{name:"RequestCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"CmdType",name:"cmtype",id:2},{rule:"required",type:"ClientType",name:"client",id:3},{rule:"required",type:"string",name:"bectrluserId",id:4},{rule:"required",type:"string",name:"ctrluserid",id:5},{rule:"required",type:"int64",name:"timestamp",id:6}]},{name:"RespondCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"required",type:"string",name:"ctruserId",id:5},{rule:"required",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int32",name:"desk_width",id:7},{rule:"optional",type:"int32",name:"desk_height",id:8},{rule:"optional",type:"int64",name:"timestamp",id:9}]},{name:"RespondCtrlAsk",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"optional",type:"string",name:"ctruserId",id:5},{rule:"optional",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RequestInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"required",type:"int32",name:"desk_width",id:5},{rule:"required",type:"int32",name:"desk_height",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RespondInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"token",id:3},{rule:"required",type:"string",name:"ctruserId",id:4},{rule:"required",type:"string",name:"beCtrleduserId",id:5},{rule:"optional",type:"int64",name:"timestamp",id:6}]},{name:"RequestTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"ctruserId",id:2},{rule:"required",type:"string",name:"beCtrleduserId",id:3},{rule:"optional",type:"int64",name:"timestamp",id:4}]},{name:"RespondTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"optional",type:"int64",name:"timestamp",id:5}]},{name:"CmdCtrlMsg",fields:[{rule:"required",type:"int32",name:"otype",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"int32",name:"requestid",id:3},{rule:"required",type:"MouseMsg",name:"mouseV",id:4},{rule:"required",type:"KeyBoardMsg",name:"keyV",id:5}]},{name:"CmdCtrlMsgRespond",fields:[{rule:"required",type:"int32",name:"requestid",id:1},{rule:"required",type:"int32",name:"result",id:3}]}],enums:[{name:"RoomPduType",values:[{name:"RoomPduType_Unkonw",id:0},{name:"PING",id:1},{name:"PONG",id:2},{name:"MULTI_PACKET",id:10},{name:"ADD_WEBCAM_MSG",id:1001},{name:"REMOVE_WEBCAM_MSG",id:1002},{name:"ADD_SPEAKER_MSG",id:1003},{name:"REMOVE_SPEAKER_MSG",id:1004},{name:"ADD_DOC_MSG",id:1005},{name:"REMOVE_DOC_MSG",id:1006},{name:"VIDEO_INDICTION",id:1007},{name:"AUDIO_INDICTION",id:1008},{name:"ADD_DESKTOP_MSG",id:1009},{name:"UPDATE_SPEAKER_MSG",id:1010},{name:"UPDATE_WEBCAM_MSG",id:1011},{name:"UPDATE_DESKTOP_MSG",id:1012},{name:"JOIN_REQ",id:2001},{name:"JOIN_REP",id:2002},{name:"LEAVE_MSG",id:2003},{name:"UPDATE_ROOM_STATUS_MSG",id:2004},{name:"PUB_ROOM_RESOURCE_MSG",id:2005},{name:"UNPUB_ROOM_RESOURCE_MSG",id:2006},{name:"SUB_ROOM_RESOURCE_MSG",id:2007},{name:"UNSUB_ROOM_RESOURCE_MSG",id:2008},{name:"PUB_VIDEO_REQ",id:2009},{name:"PUB_AUDIO_REQ",id:2010},{name:"PUB_VIDEO_REP",id:2011},{name:"PUB_AUDIO_REP",id:2012},{name:"ROOM_DATA_INFO",id:2013},{name:"PUB_ROOM_RESOURCE_MSG_REP",id:2014},{name:"SUB_ROOM_RESOURCE_MSG_REP",id:2015},{name:"ROOM_RESOURCE_INFOS",id:2016},{name:"UPDATE_STREAM_SSRC_MSG",id:2017},{name:"CLIENT_TRACE_INFO",id:2018},{name:"CLOSE_ROOM_REQ",id:2019},{name:"CLOSE_ROOM_REP",id:2020},{name:"START_VIDEO_DATA_MSG",id:2021},{name:"STOP_VIDEO_DATA_MSG",id:2022},{name:"MODIFY_RESOURCE_REQ",id:2023},{name:"MODIFY_RESOURCE_REP",id:2024},{name:"UNSUB_ROOM_RESOURCE_MSG_REP",id:2025},{name:"GET_MINI_PROGRAM_STREAM_URL_REQ",id:2026},{name:"GET_MINI_PROGRAM_STREAM_URL_REP",id:2027},{name:"BIND_AUDIO_TO_VIDEO_REQ",id:2028},{name:"BIND_AUDIO_TO_VIDEO_REP",id:2029},{name:"UNPUB_ROOM_RESOURCE_MSG_REP",id:2030},{name:"PUBLIC_TEXT_MSG",id:3001},{name:"PRIVATE_TEXT_MSG",id:3002},{name:"PUBLIC_DATA",id:3003},{name:"PRIVATE_DATA",id:3004},{name:"PRIVATE_DATA_TO_USER",id:3005},{name:"USER_INFO_MSG",id:2051},{name:"USER_MSG",id:2052},{name:"UPDATA_USER_ROLE_PRIVILEDGE_MSG",id:2053},{name:"UPDATE_USER_STATUS_MSG",id:2054},{name:"UPDATE_USER_ROLE_MSG",id:2055},{name:"USER_INDICTION",id:2056},{name:"UPDATE_USER_DATA_MSG",id:2057},{name:"REJOIN_ROOM_MSG",id:2058},{name:"CLOSE_ROOM_MSG",id:2059},{name:"UPDATE_USER_NAME",id:2060},{name:"CHANGE_HOST",id:2061},{name:"OFFER_REQ",id:6001},{name:"OFFER_REP",id:6002},{name:"CANDIDATE_MSG",id:6003},{name:"SUB_ROOM_RESOURCE_REQ",id:6004},{name:"SUB_ROOM_RESOURCE_REP",id:6005},{name:"OPEN_REQ",id:7001},{name:"OPEN_REP",id:7002},{name:"INVITE_ROOM_REQ",id:7003},{name:"INVITE_ROOM_REQ1",id:7020},{name:"INVITE_ROOM_REP",id:7004},{name:"INVITE_ROOM_REP1",id:7021},{name:"CANDIDATE_MSG1",id:7005},{name:"CLOSE_MSG",id:7006},{name:"ICE_RESTART_MSG",id:7007},{name:"OUTGOING_INVITE_STATUS_NOTIFY",id:7008},{name:"ROOM_CONTROL",id:7009},{name:"ROOM_ATTRIBUTE_CHANGE_NOTIFY",id:7022},{name:"ROOM_START_AVC_MIXER_MEDIA",id:7023},{name:"ROOM_START_AVC_MIXER_MEDIA_REP",id:7024},{name:"ROOM_SET_STREAM_NAME_REQ",id:7025},{name:"ROOM_SET_STREAM_NAME_RSP",id:7026},{name:"ROOM_STREAM_NAME_CHANGED_NOTIFY",id:7027},{name:"USER_ACTION_EVENTS_REQ",id:7028},{name:"USER_ACTION_EVENTS_Rsp",id:7029},{name:"USER_SET_KEEP_ALIVE_TIME_REQ",id:7030},{name:"USER_SET_KEEP_ALIVE_TIME_RSP",id:7031},{name:"USER_STREAM_ACTIVE",id:7032},{name:"MEDIA_PLAY_EVENT_NOTIFY",id:7033},{name:"STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY",id:7034},{name:"VIDEO_STREAM_CONTROL_REQ",id:7035},{name:"VIDEO_STREAM_CONTROL_REP",id:7036},{name:"ANNOTATION_MSG",id:2100},{name:"UPDATE_ANNOTATION_MSG",id:2101},{name:"UPDATE_BOARD_MSG",id:2102},{name:"BOARDS_INFO_PDU",id:2103},{name:"UPDATE_BOARD_MSG_REP",id:2104},{name:"OUTGOING_CREATE_LIVER",id:9001},{name:"OUTGOING_CREATE_LIVER_REP",id:9002},{name:"OUTGOING_SELECT_MEDIA_LIVE",id:9003},{name:"OUTGOING_SELECT_MEDIA_LIVE_REP",id:9004},{name:"OUTGOING_MIX_MEDIA_LIVE",id:9005},{name:"OUTGOING_MIX_MEDIA_LIVE_REP",id:9006},{name:"OUTGOING_DESTROY_LIVER",id:9007},{name:"OUTGOING_DESTROY_LIVER_REP",id:9008},{name:"OUTGOING_PAUSE_RESUME_LIVE",id:9009},{name:"OUTGOING_PAUSE_RESUME_LIVE_REP",id:9010},{name:"OUTGOING_GET_LIVERS",id:9011},{name:"OUTGOING_GET_LIVERS_REP",id:9012},{name:"OUTGOING_CREATE_RECORD",id:9013},{name:"OUTGOING_CREATE_RECORD_REP",id:9014},{name:"OUTGOING_SELECT_MEDIA_RECORD",id:9015},{name:"OUTGOING_SELECT_MEDIA_RECORD_REP",id:9016},{name:"OUTGOING_MIX_MEDIA_RECORD",id:9017},{name:"OUTGOING_MIX_MEDIA_RECORD_REP",id:9018},{name:"OUTGOING_DESTROY_RECORD",id:9019},{name:"OUTGOING_DESTROY_RECORD_REP",id:9020},{name:"OUTGOING_PAUSE_RESUME_RECORD",id:9021},{name:"OUTGOING_PAUSE_RESUME_RECORD_REP",id:9022},{name:"OUTGOING_GET_RECORDS",id:9023},{name:"OUTGOING_GET_RECORDS_REP",id:9024},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REQ",id:9025},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REP",id:9026},{name:"OUTGOING_SELECT_STREAM_REQ",id:9027},{name:"OUTGOING_SELECT_STREAM_REP",id:9028},{name:"OUTGOING_MIX_STREAMS_REQ",id:9029},{name:"OUTGOING_MIX_STREAMS_REP",id:9030},{name:"OUTGOING_DESTROY_EXPORTER_REQ",id:9031},{name:"OUTGOING_DESTROY_EXPORTER_REP",id:9032},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REQ",id:9033},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REP",id:9034},{name:"OUTGOING_EXPORTER_ERROR_NOTIFY",id:9035},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ",id:9036},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP",id:9037},{name:"OUTGOING_GET_EXPORTER_INFO_REQ",id:9038},{name:"OUTGOING_GET_EXPORTER_INFO_RSP",id:9039},{name:"REQUEST_CTRL",id:20001},{name:"RESPOND_CTRL",id:20002},{name:"RESPOND_CTRL_ASK",id:20003},{name:"REQUEST_INVITE",id:20004},{name:"RESPOND_INVITE",id:20005},{name:"REQUEST_TERMIAL_CTRL",id:20006},{name:"RESPOND_TERMIAL_CTRL",id:20007},{name:"CMD_CTRL_MSG",id:20008},{name:"CMD_CTRL_MSG_RESPOND",id:20009}]},{name:"RoomStatus",values:[{name:"init_room",id:1},{name:"open_room",id:2},{name:"locked_room",id:3},{name:"closed_room",id:4}]},{name:"ResourceOpt",values:[{name:"pub",id:1},{name:"unpub",id:2},{name:"sub",id:3},{name:"unsub",id:4},{name:"mute",id:5},{name:"unmute",id:6},{name:"forbid",id:7},{name:"unforbid",id:8}]},{name:"ResourceStatus",values:[{name:"init",id:1},{name:"published",id:2},{name:"muted",id:3},{name:"forbided",id:4},{name:"subed",id:5}]},{name:"CameraType",values:[{name:"unknown",id:0},{name:"front",id:1},{name:"back",id:2}]},{name:"UserStatus",values:[{name:"online",id:0},{name:"offline",id:1}]},{name:"UserRole",values:[{name:"host",id:1},{name:"presenter",id:2},{name:"attendee",id:3}]},{name:"MediaType",values:[{name:"video",id:1},{name:"audio",id:2},{name:"desktop",id:3}]},{name:"SessionType",values:[{name:"Chat",id:1},{name:"Audio",id:2},{name:"Video",id:3},{name:"ShareScreen",id:4},{name:"ShareDoc",id:5},{name:"WhiteBoard",id:6}]},{name:"RepResultType",values:[{name:"allowed",id:1},{name:"rejected",id:2}]},{name:"UserMsgOpt",values:[{name:"leave",id:1},{name:"kickoff",id:2},{name:"server_kickoff",id:3},{name:"timeout",id:4}]},{name:"DataCryptoType",values:[{name:"DataCryptoTypeAES128",id:1},{name:"DataCryptoTypeAES256",id:2},{name:"DataCryptoTypeSM4",id:3}]},{name:"RoomMode",values:[{name:"free",id:1},{name:"host1",id:2},{name:"p2pfree",id:3},{name:"p2phost",id:4}]},{name:"OutgoingInviteType",values:[{name:"OutgoingInviteTypeSIP",id:1},{name:"OutgoingInviteTypeH323",id:2},{name:"OutgoingInviteTypeRTSP",id:3}]},{name:"StreamActiveStatus",values:[{name:"StreamActiveStatusUnchanged",id:0},{name:"StreamActiveStatusUnActive",id:1},{name:"StreamActiveStatusActive",id:2}]},{name:"MediaPlayEvents",values:[{name:"MediaPlayEventsStarted",id:0},{name:"MediaPlayEventsStoped",id:1}]},{name:"LineArrow",values:[{name:"none",id:1},{name:"begin",id:2},{name:"end",id:3},{name:"arrow2",id:4}]},{name:"AnnotationType",values:[{name:"annotation_tool_mouse",id:1},{name:"annotation_tool_line",id:2},{name:"annotation_tool_rectangle",id:3},{name:"annotation_tool_ellipse",id:4},{name:"annotation_tool_polyline",id:5},{name:"annotation_tool_polygon",id:6},{name:"annotation_tool_hlight_point",id:7},{name:"annotation_tool_hlight_texttag",id:8},{name:"annotation_tool_eraser_line",id:9},{name:"annotation_tool_eraser_rectangle",id:10},{name:"annotation_tool_rhomb",id:11},{name:"annotation_tool_arrow",id:12},{name:"annotation_tool_success",id:13},{name:"annotation_tool_failure",id:14},{name:"annotation_tool_undo",id:15},{name:"annotation_tool_redo",id:16},{name:"annotation_tool_clear",id:17},{name:"annotation_tool_img",id:18},{name:"annotation_tool_hlight_cricle",id:19},{name:"annotation_tool_txt",id:20}]},{name:"OutGoingViewLayoutMode",values:[{name:"Outgoing_View_Layout_Fixation",id:0},{name:"Outgoing_View_Layout_Auto",id:1},{name:"Outgoing_View_Layout_Auto_Orato",id:2}]},{name:"LiveStatus",values:[{name:"LIVE_STATUS_LIVEING",id:0},{name:"LIVE_STATUS_PAUSED",id:1}]},{name:"RecordStatus",values:[{name:"RECORD_STATUS_LIVEING",id:0},{name:"RECORD_STATUS_PAUSED",id:1}]},{name:"MediaFileType",values:[{name:"TbMediaFormat_AVI",id:0},{name:"TbMediaFormat_WEBM",id:1},{name:"TbMediaFormat_MP4",id:2},{name:"TbMediaFormat_WAV",id:3}]},{name:"ExporterType",values:[{name:"EXPORTER_TYPE_RECORD",id:0},{name:"EXPORTER_TYPE_RECORD_REAL_TIME",id:1},{name:"EXPORTER_TYPE_LIVER",id:2},{name:"EXPORTER_TYPE_RECORD_AUTO",id:3},{name:"EXPORTER_TYPE_LIVER_AUTO",id:4},{name:"EXPORTER_TYPE_LIVER_AUTO_VIEW",id:5},{name:"EXPORTER_TYPE_RECORD_AUTO_VIEW",id:6},{name:"EXPORTER_TYPE_AVC_MEDIA_MIXER",id:7},{name:"EXPORTER_TYPE_RECORD_ONLY_DESKTOP_AUTO",id:9},{name:"EXPORTER_TYPE_LIVE_ONLY_DESKTOP_AUTO",id:10},{name:"EXPORTER_TYPE_RECORD_ONLY_DESKTOP",id:11},{name:"EXPORTER_TYPE_LIVE_ONLY_DESKTOP",id:12}]},{name:"CmdType",values:[{name:"ctrl",id:1},{name:"cancle_ctr",id:2},{name:"extend_ctr1",id:3}]},{name:"ClientType",values:[{name:"Win_pc",id:1},{name:"android",id:2},{name:"ios",id:3}]},{name:"CmdResult",values:[{name:"allow",id:1},{name:"notallow",id:2},{name:"terminal",id:3}]}]}).build(),rtmBuilder=dcodeIO.newBuilder({}).import({package:"signal_pdu",messages:[{name:"signal_header",fields:[{rule:"required",type:"string",name:"version",id:1},{rule:"required",type:"signal_group_type",name:"group_type",id:2},{rule:"required",type:"signal_cmd_type",name:"cmd_type",id:3},{rule:"required",type:"uint32",name:"timestamp",id:4},{rule:"required",type:"string",name:"from",id:5},{rule:"required",type:"string",name:"to",id:6},{rule:"required",type:"bytes",name:"content",id:7}]},{name:"Invite",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteCancel",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteOk",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteReject",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteRinging",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteTimeOut",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteBye",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"MsgData",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3},{rule:"required",type:"uint32",name:"create_time",id:4},{rule:"required",type:"MsgType",name:"msg_type",id:5},{rule:"required",type:"bytes",name:"msg_content",id:6}]},{name:"MsgDataDelivered",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRead",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRecalled",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MouseEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"video_x",id:2},{rule:"optional",type:"int32",name:"video_y",id:3},{rule:"optional",type:"int32",name:"video_w",id:4},{rule:"optional",type:"int32",name:"video_h",id:5},{rule:"optional",type:"mouse_events_type",name:"eventsType",id:6}]},{name:"KeyBoardEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"repeated",type:"int32",name:"keyc",id:2},{rule:"repeated",type:"int32",name:"keyv",id:3},{rule:"optional",type:"keyboard_events_type",name:"eventsType",id:4}]},{name:"RpcCallRequest",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]},{name:"RpcCallResponse",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]},{name:"RpcNotification",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]}],enums:[{name:"signal_group_type",values:[{name:"SIGNALE_GROUP_TYPE_SYS",id:0},{name:"SIGNALE_GROUP_TYPE_MESSAGE",id:1},{name:"SIGNALE_GROUP_TYPE_INVITE",id:3},{name:"SIGNALE_GROUP_TYPE_RPC",id:4},{name:"SIGNALE_GROUP_TYPE_ADDRESS_BOOK",id:5},{name:"SIGNALE_GROUP_TYPE_REMOTE_CONTROL",id:6}]},{name:"signal_cmd_type",values:[{name:"SIGNALE_CMD_TYPE_INVITE",id:0},{name:"SIGNALE_CMD_TYPE_INVITE_CANCEL",id:1},{name:"SIGNALE_CMD_TYPE_INVITE_RINGING",id:2},{name:"SIGNALE_CMD_TYPE_INVITE_OK",id:3},{name:"SIGNALE_CMD_TYPE_INVITE_REJECT",id:4},{name:"SIGNALE_CMD_TYPE_INVITE_TIMEOUT",id:5},{name:"SIGNALE_CMD_TYPE_INVITE_BYE",id:6},{name:"SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS",id:32},{name:"SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS",id:33},{name:"SIGNALE_CMD_TYPE_MESSAGE_DATA",id:48},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECEIVED",id:49},{name:"SIGNALE_CMD_TYPE_MESSAGE_READ",id:50},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECALLED",id:51},{name:"SIGNALE_CMD_TYPE_RPC_CALL_REQUEST",id:64},{name:"SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE",id:65},{name:"SIGNALE_CMD_TYPE_RPC_NOTIFICATION",id:66}]},{name:"SessionType",values:[{name:"SESSION_TYPE_PEERS",id:1},{name:"SESSION_TYPE_GROUP",id:2},{name:"SESSION_TYPE_CHATROOM",id:3}]},{name:"MsgType",values:[{name:"MSG_TYPE_TEXT",id:1},{name:"MSG_TYPE_IMAGE",id:2},{name:"MSG_TYPE_FILE",id:3},{name:"MSG_TYPE_AUDIO",id:4},{name:"MSG_TYPE_VIDEO",id:5},{name:"MSG_TYPE_LOCATION",id:6}]},{name:"MsgStatus",values:[{name:"MSG_STAT_DELIVERING",id:1},{name:"MSG_STAT_DELIVERED",id:2},{name:"MSG_STAT_READ",id:3},{name:"MSG_STAT_FAILED",id:4},{name:"MSG_TYPE_RECALLED",id:5}]},{name:"mouse_events_type",values:[{name:"WM_MOUSEMOVE",id:512},{name:"WM_LBUTTONDOWN",id:513},{name:"WM_LBUTTONUP",id:514},{name:"WM_LBUTTONDBLCLK",id:515},{name:"WM_RBUTTONDOWN",id:516},{name:"WM_RBUTTONUP",id:517},{name:"WM_RBUTTONDBLCLK",id:518},{name:"WM_MBUTTONDOWN",id:519},{name:"WM_MBUTTONUP",id:520},{name:"WM_MBUTTONDBLCLK",id:521},{name:"WM_MOUSEWHEEL",id:522}]},{name:"keyboard_events_type",values:[{name:"WM_KEYDOWN",id:256},{name:"WM_KEYUP",id:257},{name:"WM_CHAR",id:258}]},{name:"keyboard_vk_type",values:[{name:"VK_BACK",id:8},{name:"VK_TAB",id:9},{name:"VK_SHIFT",id:16},{name:"VK_CONTROL",id:17},{name:"VK_MENU",id:18},{name:"VK_PAUSE",id:19},{name:"VK_CAPITAL",id:20},{name:"VK_KANA",id:21},{name:"VK_JUNJA",id:23},{name:"VK_FINAL",id:24},{name:"VK_HANJA",id:25},{name:"VK_KANJI",id:25},{name:"VK_ESCAPE",id:27},{name:"VK_CONVERT",id:28},{name:"VK_NONCONVERT",id:29},{name:"VK_ACCEPT",id:30},{name:"VK_MODECHANGE",id:31},{name:"VK_SPACE",id:32},{name:"VK_PRIOR",id:33},{name:"VK_NEXT",id:34},{name:"VK_END",id:35},{name:"VK_HOME",id:36},{name:"VK_LEFT",id:37},{name:"VK_UP",id:38},{name:"VK_RIGHT",id:39},{name:"VK_DOWN",id:40},{name:"VK_SELECT",id:41},{name:"VK_PRINT",id:42},{name:"VK_EXECUTE",id:43},{name:"VK_SNAPSHOT",id:44},{name:"VK_INSERT",id:45},{name:"VK_DELETE",id:46},{name:"VK_HELP",id:47}]}]}).build(),connectionQualityValues=(ModuleBase.define("CmdProtobufCoded",[],function(){function e(){v=cmdBuilder.room_pdu}var v;function o(e,t,r){for(var t=CryptoJS.enc.Utf8.parse(t),r=CryptoJS.enc.Utf8.parse(r),e=function(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,o=0;o<n;o++)t+=String.fromCharCode(r[o]);return window.btoa(t)}(e),e=CryptoJS.AES.decrypt(e,t,{iv:r,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Base64),n=atob(e),t=new ArrayBuffer(n.length),o=new Uint8Array(t),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);return t}return e.prototype.getRoomPduTypeEnum=function(){return v.RoomPduType},e.prototype.getRoomStatusEnum=function(){return v.RoomStatus},e.prototype.getResourceOptEnum=function(){return v.ResourceOpt},e.prototype.getResourceStatusEnum=function(){return v.ResourceStatus},e.prototype.getCameraTypeEnum=function(){return v.CameraType},e.prototype.getUserStatusEnum=function(){return v.UserStatus},e.prototype.getUserRoleEnum=function(){return v.UserRole},e.prototype.getMediaTypeEnum=function(){return v.MediaType},e.prototype.getSessionTypeEnum=function(){return v.SessionType},e.prototype.getRepResultTypeEnum=function(){return v.RepResultType},e.prototype.getUserMsgOptEnum=function(){return v.UserMsgOpt},e.prototype.getRoomModeEnum=function(){return v.RoomMode},e.prototype.getLineArrowEnum=function(){return v.LineArrow},e.prototype.getAnnotationTypeEnum=function(){return v.AnnotationType},e.prototype.getExporterTypeEnum=function(){return v.ExporterType},e.prototype.getOutgoingInviteTypeEnum=function(){return v.OutgoingInviteType},e.prototype.getMediaPlayEventsEnum=function(){return v.MediaPlayEvents},e.prototype.getDataCryptoTypeEnum=function(){return v.DataCryptoType},e.prototype.getOutGoingViewLayoutMode=function(){return v.OutGoingViewLayoutMode},e.prototype.newWebcam=function(){return new v.Webcam},e.prototype.newWebcam=function(e,t,r,n){return new v.Webcam(e,t,r,n)},e.prototype.newSpeaker=function(){return new v.Speaker},e.prototype.newSpeaker=function(e,t,r,n){return new v.Speaker(e,t,r,n)},e.prototype.newDesktop=function(){return new v.Desktop},e.prototype.newDesktop=function(e,t,r,n){return new v.Desktop(e,t,r,n)},e.prototype.newDocFile=function(){return new v.DocFile},e.prototype.newDocFile=function(e,t,r,n,o){return new v.DocFile(e,t,r,n,o)},e.prototype.newAddWebcamMsg=function(){return new v.AddWebcamMsg},e.prototype.newAddWebcamMsg=function(e,t){return new v.AddWebcamMsg(e,t)},e.prototype.newRemoveWebcamMsg=function(){return new v.RemoveWebcamMsg},e.prototype.newRemoveWebcamMsg=function(e,t){return new v.RemoveWebcamMsg(e,t)},e.prototype.newAddSpeakerMsg=function(){return new v.AddSpeakerMsg},e.prototype.newAddSpeakerMsg=function(e,t){return new v.AddSpeakerMsg(e,t)},e.prototype.newRemoveSpeakerMsg=function(){return new v.RemoveSpeakerMsg},e.prototype.newRemoveSpeakerMsg=function(e,t){return new v.RemoveSpeakerMsg(e,t)},e.prototype.newAddDocFileMsg=function(){return new v.AddDocFileMsg},e.prototype.newAddDocFileMsg=function(e,t){return new v.AddDocFileMsg(e,t)},e.prototype.newRemoveDocFileMsg=function(){return new v.RemoveDocFileMsg},e.prototype.newRemoveDocFileMsg=function(e,t){return new v.RemoveDocFileMsg(e,t)},e.prototype.newRoomResourceInfo=function(){return new v.RoomResourceInfo},e.prototype.newRoomResourceInfo=function(e,t,r){return new v.RoomResourceInfo(e,t,r)},e.prototype.newRoomInfo=function(){return new v.RoomInfo},e.prototype.newRoomInfo=function(e,t){return new v.RoomInfo(e,t)},e.prototype.newUserPolicy=function(){return new v.UserPolicy},e.prototype.newUserPolicy=function(e,t,r){return new v.UserPolicy(e,t,r)},e.prototype.newJoinInfo=function(){return new v.JoinInfo},e.prototype.newJoinInfo=function(e,t,r,n,o){return new v.JoinInfo(e,t,r,n,o)},e.prototype.newUserInfo=function(){return new v.UserInfo},e.prototype.newUserInfo=function(e,t,r,n,o,i,a,s,d,l,u,c){return new v.UserInfo(e,t,r,n,o,i,a,s,d,l,u,c)},e.prototype.newMediaStream=function(){return new v.MediaStream},e.prototype.newMediaStream=function(e,t,r,n,o,i,a){var s=new v.MediaStream;return s.stream_name=e,s.type=t,s.sdp=r,void 0!==n&&n&&0!=n&&(s.width=n),void 0!==o&&o&&0!=o&&(s.height=o),void 0!==i&&i&&0!=i&&(s.frame_rate=i),void 0!==a&&(s.payload=a),s},e.prototype.newMediaStreamInfo=function(){return new v.MediaStreamInfo},e.prototype.newMediaStreamInfo=function(e,t,r){return new v.MediaStreamInfo(e,t,r)},e.prototype.newResourceIndiction=function(){return new v.ResourceIndiction},e.prototype.newResourceIndiction=function(e,t,r,n,o){return new v.ResourceIndiction(e,t,r,n,o)},e.prototype.newAddDesktopMsg=function(){return new v.AddDesktopMsg},e.prototype.newAddDesktopMsg=function(e,t){return new v.AddDesktopMsg(e,t)},e.prototype.newRemoveDesktopMsg=function(){return new v.RemoveDesktopMsg},e.prototype.newRemoveDesktopMsg=function(e,t){return new v.RemoveDesktopMsg},e.prototype.newUpdateWebcamMsg=function(){return new v.UpdateWebcamMsg},e.prototype.newUpdateWebcamMsg=function(e,t,r){return new v.UpdateWebcamMsg(e,t,r)},e.prototype.newUpdateSpeakerMsg=function(){return new v.UpdateSpeakerMsg},e.prototype.newUpdateSpeakerMsg=function(e,t,r){return new v.UpdateSpeakerMsg(e,t,r)},e.prototype.newUpdateDesktopMsg=function(){return new v.UpdateDesktopMsg},e.prototype.newUpdateDesktopMsg=function(e,t,r){return new v.UpdateDesktopMsg(e,t,r)},e.prototype.newLeaveMsg=function(){return new v.LeaveMsg},e.prototype.newLeaveMsg=function(e,t){return new v.LeaveMsg(e,t)},e.prototype.newUpdateRoomStatusMsg=function(){return new v.UpdateRoomStatusMsg},e.prototype.newUpdateRoomStatusMsg=function(e){return new v.UpdateRoomStatusMsg(e)},e.prototype.newPubRoomResourceMsg=function(){return new v.PubRoomResourceMsg},e.prototype.newPubRoomResourceMsg=function(e,t){return new v.PubRoomResourceMsg(e,t)},e.prototype.newUnpubRoomResourceMsg=function(){return new v.UnpubRoomResourceMsg},e.prototype.newUnpubRoomResourceMsg=function(e,t){return new v.UnpubRoomResourceMsg(e,t)},e.prototype.newSubRoomResourceMsg=function(){return new v.SubRoomResourceMsg},e.prototype.newSubRoomResourceMsg=function(e,t,r){return new v.SubRoomResourceMsg(e,t,r)},e.prototype.newSubRoomResourceMsg=function(e,t,r,n){return new v.SubRoomResourceMsg(e,t,r,n)},e.prototype.newUnsubRoomResourceMsg=function(){return new v.UnsubRoomResourceMsg},e.prototype.newUnsubRoomResourceMsg=function(e,t,r){return new v.UnsubRoomResourceMsg(e,t,r)},e.prototype.newPubResourceReq=function(){return new v.PubResourceReq},e.prototype.newPubResourceReq=function(e,t){return new v.PubResourceReq(e,t)},e.prototype.newPubResourceRep=function(){return new v.PubResourceRep},e.prototype.newPubResourceRep=function(e,t,r){return new v.PubResourceRep(e,t,r)},e.prototype.newCloseRoomReq=function(){return new v.CloseRoomReq},e.prototype.newCloseRoomReq=function(e,t,r){return new v.CloseRoomReq(e,t,r)},e.prototype.newCloseRoomRep=function(){return new v.CloseRoomRep},e.prototype.newCloseRoomRep=function(e,t,r){return new v.CloseRoomRep(e,t,r)},e.prototype.newUpdateUserName=function(){return new v.UpdateUserName},e.prototype.newUpdateUserName=function(e,t){return new v.UpdateUserName(e,t)},e.prototype.newStartVideoDataMsg=function(){return new v.StartVideoDataMsg},e.prototype.newStartVideoDataMsg=function(e){return new v.StartVideoDataMsg(e)},e.prototype.newStopVideoDataMsg=function(){return new v.StopVideoDataMsg},e.prototype.newStopVideoDataMsg=function(e){return new v.StopVideoDataMsg(e)},e.prototype.newVideoStreamControlReq=function(){return new v.VideoStreamControlReq},e.prototype.newVideoStreamControlReq=function(e,t,r,n,o,i,a,s){return new v.VideoStreamControlReq(e,t,r,n,o,i,a,s)},e.prototype.newModifyResourceReq=function(){return new v.ModifyResourceReq},e.prototype.newModifyResourceReq=function(e,t,r){return new v.ModifyResourceReq(e,t,r)},e.prototype.newModifyResourceRep=function(){return new v.ModifyResourceRep},e.prototype.newModifyResourceRep=function(e,t,r){return new v.ModifyResourceRep(e,t,r)},e.prototype.newRoomKV=function(){return new v.RoomKV},e.prototype.newRoomKV=function(e,t){return new v.RoomKV(e,t)},e.prototype.newRoomDataInfo=function(){return new v.RoomDataInfo},e.prototype.newRoomDataInfo=function(e,t){return new v.RoomDataInfo(e,t)},e.prototype.newTextMsg=function(){return new v.TextMsg},e.prototype.newTextMsg=function(e,t){return new v.TextMsg(e,t)},e.prototype.newData=function(){return new v.DATA},e.prototype.newData=function(e){return new v.DATA(e)},e.prototype.newPrivateDataToUser=function(){return new v.PrivateDataToUser},e.prototype.newPrivateDataToUser=function(e,t,r,n){return new v.PrivateDataToUser(e,t,r,n)},e.prototype.newUserInfoMsg=function(){return new v.UserInfoMsg},e.prototype.newUserInfoMsg=function(e){return new v.UserInfoMsg(e)},e.prototype.newUserMsg=function(){return new v.UserMsg},e.prototype.newUserMsg=function(e,t,r){return new v.UserMsg(e,t,r)},e.prototype.newUpdateUserRolePriviledgeMsg=function(){return new v.UpdateUserRolePriviledgeMsg},e.prototype.newUpdateUserRolePriviledgeMsg=function(e,t,r){return new v.UpdateUserRolePriviledgeMsg(e,t,r)},e.prototype.newUpdateUserStatusMsg=function(){return new v.UpdateUserStatusMsg},e.prototype.newUpdateUserStatusMsg=function(e,t,r){return new v.UpdateUserStatusMsg(e,t,r)},e.prototype.newUpdateUserRoleMsg=function(){return new v.UpdateUserRoleMsg},e.prototype.newUpdateUserRoleMsg=function(e,t,r){return new v.UpdateUserRoleMsg(e,t,r)},e.prototype.newUserIndiction=function(){return new v.UserIndiction},e.prototype.newUserIndiction=function(e,t,r){return new v.UserIndiction(e,t,r)},e.prototype.newUpdateUserDataMsg=function(){return new v.UpdateUserDataMsg},e.prototype.newUpdateUserDataMsg=function(e,t){return new v.UpdateUserDataMsg(e,t)},e.prototype.newCloseRoomMsg=function(){return new v.CloseRoomMsg},e.prototype.newCloseRoomMsg=function(e,t){return new v.CloseRoomMsg(e,t)},e.prototype.newOfferReq=function(){return new v.OfferReq},e.prototype.newOfferReq=function(e,t,r){return new v.OfferReq(e,t,r)},e.prototype.newOfferRep=function(){return new v.OfferRep},e.prototype.newOfferRep=function(e,t,r,n,o){return new v.OfferRep(e,t,r,n,o)},e.prototype.newCandidateMsg=function(){return new v.CandidateMsg},e.prototype.newCandidateMsg=function(e,t,r,n){return new v.CandidateMsg(e,t,r,n)},e.prototype.newSubRoomResourceReq=function(){return new v.SubRoomResourceReq},e.prototype.newSubRoomResourceReq=function(e,t,r){return new v.SubRoomResourceReq(e,t,r)},e.prototype.newSubRoomResourceRep=function(){return new v.SubRoomResourceRep},e.prototype.newSubRoomResourceRep=function(e,t,r,n){return new v.SubRoomResourceRep(e,t,r,n)},e.prototype.newOpenReq=function(){return new v.OpenReq},e.prototype.newOpenReq=function(e,t,r,n,o,i,a){return new v.OpenReq(e,t,r,n,o,i,a)},e.prototype.newInviteRoomReq=function(){return new v.InviteRoomReq},e.prototype.newInviteRoomReq=function(e,t,r,n){return new v.InviteRoomReq(e,t,r,n)},e.prototype.newInviteRoomReq1=function(){return new v.InviteRoomReq1},e.prototype.newInviteRoomReq1=function(e,t,r,n,o,i,a,s,d,l,u,c){e=new v.InviteRoomReq1(e,t,r,n,o,i,a,s,d,!0,l);return e.media_connect_type=u,e.crypto_type=c,e},e.prototype.newCandidateMsg1=function(){return new v.CandidateMsg1},e.prototype.newCandidateMsg1=function(e,t,r,n){return new v.CandidateMsg1(e,t,r,n)},e.prototype.newCloseMsg=function(){return new v.CloseMsg},e.prototype.newCloseMsg=function(e){return new v.CloseMsg(e)},e.prototype.newPoint=function(){return new v.Point},e.prototype.newPoint=function(e,t){return new v.Point(e,t)},e.prototype.newcolor=function(){return new v.color},e.prototype.newcolor=function(e,t,r,n){return new v.color(e,t,r,n)},e.prototype.newRect=function(){return new v.Rect},e.prototype.newRect=function(e,t,r,n){return new v.Rect(e,t,r,n)},e.prototype.newAnnotationObject=function(){return new v.AnnotationObject},e.prototype.newAnnotationObject=function(e,t,r,n,o,i,a,s,d,l){return new v.AnnotationObject(e,t,r,n,o,i,a,s,d,l)},e.prototype.newAnnotation2Point=function(){return new v.Annotation2Point},e.prototype.newAnnotation2Point=function(e,t,r){return new v.Annotation2Point(e,t,r)},e.prototype.newAnnotationMultiPoint=function(){return new v.AnnotationMultiPoint},e.prototype.newAnnotationMultiPoint=function(e,t){return new v.AnnotationMultiPoint(e,t)},e.prototype.newAnnotationList=function(){return new v.AnnotationList},e.prototype.newAnnotationList=function(e,t){return new v.AnnotationList(e,t)},e.prototype.newImgInfo=function(){return new v.ImgInfo},e.prototype.newImgInfo=function(e,t,r,n,o,i,a,s,d,l,u){return new v.ImgInfo(e,t,r,n,o,i,a,s,d,l,u)},e.prototype.newAnnotationImg=function(){return new v.AnnotationImg},e.prototype.newAnnotationImg=function(e,t){return new v.AnnotationImg(e,t)},e.prototype.newTxt=function(){return new v.Txt},e.prototype.newTxt=function(e,t){return new v.Txt(e,t)},e.prototype.newTextInfo=function(){return new v.TextInfo},e.prototype.newTextInfo=function(e,t,r,n,o,i,a,s,d,l){return new v.TextInfo(e,t,r,n,o,i,a,s,d,l)},e.prototype.newAnnotationTxt=function(){return new v.AnnotationTxt},e.prototype.newAnnotationTxt=function(e,t){return new v.AnnotationTxt(e,t)},e.prototype.newUpdateAnnotationMsg=function(e,t,r,n,o,i,a,s,d,l,u){return new v.UpdateAnnotationMsg(e,t,r,n,o,i,a,s,d,l,u)},e.prototype.newAnnotationMsg=function(){return new v.AnnotationMsg},e.prototype.newAnnotationMsg=function(e,t){return new v.AnnotationMsg(e,t)},e.prototype.newBoardObject=function(){return new v.BoardObject},e.prototype.newBoardObject=function(e,t,r,n,o,i,a,s,d,l,u){return new v.BoardObject(e,t,r,n,o,i,a,s,d,l,u)},e.prototype.newUpdateBoardMsg=function(){return new v.UpdateBoardMsg},e.prototype.newUpdateBoardMsg=function(e,t,r,n,o){return new v.UpdateBoardMsg(e,t,r,n,o)},e.prototype.newBoardsInfoMsg=function(){return new v.BoardsInfoMsg},e.prototype.newBoardsInfoMsg=function(e){return new v.BoardsInfoMsg(e)},e.prototype.newBindAudioToVideoReq=function(e,t,r){return new v.BindAudioToVideoReq(e,t,r)},e.prototype.serverVersionCompatible=function(e){for(var t=2,r=(avdEngineHandle.restServerInfo.signalData&&(t=4),new ArrayBuffer(10)),n=new Int8Array(r),o=(n[0]=88,n[1]="3".charCodeAt(),n[2]="t".charCodeAt(),n[3]="e".charCodeAt(),n[4]="e".charCodeAt(),n[5]="a".charCodeAt(),n[6]="v".charCodeAt(),n[7]="d".charCodeAt(),n[8]=t,n[9]=1,new Int8Array(e)),r=10+o.length,t=new ArrayBuffer(r),i=new Int8Array(t),a=0;a<10;a++)i[a]=n[a];for(var s=0;s<o.length;s++)i[s+10]=o[s];return t},e.prototype.encodedPacket=function(e,t,r,n,o){var i=null,t=new v.Packet(e,t,r,n,i=o?o.toArrayBuffer():i).toArrayBuffer();return avdEngineHandle.restServerInfo.signalData&&(t=function(e,t,r){for(var t=CryptoJS.enc.Utf8.parse(t),r=CryptoJS.enc.Utf8.parse(r),e=CryptoJS.lib.WordArray.create(new Uint8Array(e)),e=CryptoJS.AES.encrypt(e,t,{iv:r,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),n=atob(e.toString()),t=new ArrayBuffer(n.length),o=new Uint8Array(t),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);return t}(t,avdEngineHandle.restServerInfo.signalData,avdEngineHandle.restServerInfo.iv)),t=e==this.getRoomPduTypeEnum().OPEN_REQ?this.serverVersionCompatible(t):t},e.prototype.decodePacket=function(e){return avdEngineHandle.restServerInfo.signalData&&(e=o(e,avdEngineHandle.restServerInfo.signalData,avdEngineHandle.restServerInfo.iv)),v.Packet.decode(e)},e.prototype.decodeUserMsg=function(e){return v.UserMsg.decode(e)},e.prototype.decodeAnnotationMultiPoint=function(e){return v.AnnotationMultiPoint.decode(e)},e.prototype.decodeAnnotation2Point=function(e){return v.Annotation2Point.decode(e)},e.prototype.decodeAnnotationList=function(e){return v.AnnotationList.decode(e)},e.prototype.decodeOutgoingVideoInfo=function(e){return v.OutgoingVideoInfo.decode(e)},e.prototype.newOutgoingCreateStreamsExporterReq=function(){return new v.OutgoingCreateStreamsExporterReq},e.prototype.newOutgoingCreateStreamsExporterReq=function(e,t,r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,y){return new v.OutgoingCreateStreamsExporterReq(e,t,r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,y)},e.prototype.newOutgoingSelectStreamReq=function(){return new v.OutgoingSelectStreamReq},e.prototype.newOutgoingSelectStreamReq=function(e,t,r,n,o,i,a,s){return new v.OutgoingSelectStreamReq(e,t,r,n,o,i,a,s)},e.prototype.newOutgoingMixStreamsReq=function(){return new v.OutgoingMixStreamsReq},e.prototype.newOutgoingMixStreamsReq=function(e,t,r,n,o,i,a){return new v.OutgoingMixStreamsReq(e,t,r,n,o,i,a)},e.prototype.newOutgoingVideoInfo=function(){return new v.OutgoingVideoInfo},e.prototype.newOutgoingVideoInfo=function(e,t,r,n,o,i,a,s){return new v.OutgoingVideoInfo(e,t,r,n,o,i,a,s)},e.prototype.newOutgoingDestroyExporterReq=function(){return new v.OutgoingDestroyExporterReq},e.prototype.newOutgoingDestroyExporterReq=function(e,t,r,n){return new v.OutgoingDestroyExporterReq(e,t,r,n)},e.prototype.newOutgoingPauseResumeExporterReq=function(){return new v.OutgoingPauseResumeExporterReq},e.prototype.newOutgoingPauseResumeExporterReq=function(e,t,r,n,o){return new v.OutgoingPauseResumeExporterReq(e,t,r,n,o)},e.prototype.newRoomControl=function(e,t){return new v.RoomControl(e,t)},e.prototype.newRoomAvcControl=function(e,t){return new v.RoomAvcControl(e,t)},e.prototype.newRoomSetStreamNameReq=function(e,t,r,n,o){return new v.RoomSetStreamNameReq(e,t,r,n,o)},e.prototype.newOutgoingExporterSetFocusVideoReq=function(e,t,r,n,o){return new v.OutgoingExporterSetFocusVideoReq(e,t,r,n,o)},e.prototype.newOutgoingGetExporterInfoReq=function(e,t,r,n){return new v.OutgoingGetExporterInfoReq(e,t,r,n)},e.prototype.decodeBody=function(e){var t,r=v.RoomPduType,n=v.Packet,n=(avdEngineHandle.restServerInfo.signalData&&(e=o(e,avdEngineHandle.restServerInfo.signalData,avdEngineHandle.restServerInfo.iv)),n.decode(e)),e=n.type;return e==r.OPEN_REP?v.OpenRep.decode(n.body):e==r.INVITE_ROOM_REP1?v.InviteRoomRep1.decode(n.body):e==r.ROOM_RESOURCE_INFOS?v.RoomResourceInfos.decode(n.body):e==r.CANDIDATE_MSG1?v.CandidateMsg1.decode(n.body):e==r.ICE_RESTART_MSG?v.IceRestartMsg.decode(n.body):e==r.PUB_RESOURCE_REP?v.PubResourceRep.decode(n.body):e==r.PRIVATE_TEXT_MSG||e==r.PUBLIC_TEXT_MSG?v.TextMsg.decode(n.body):e==r.PRIVATE_DATA||e==r.PUBLIC_DATA?v.DATA.decode(n.body):e==r.PRIVATE_DATA_TO_USER?v.PrivateDataToUser.decode(n.body):e==r.ROOM_DATA_INFO?v.RoomDataInfo.decode(n.body):e==r.UPDATE_USER_DATA_MSG?v.UpdateUserDataMsg.decode(n.body):e==r.USER_INFO_MSG?(t=v.UserInfoMsg,n.body?t.decode(n.body):null):e==r.USER_MSG?v.UserMsg.decode(n.body):e==r.USER_INDICTION?v.UserIndiction.decode(n.body):e==r.UPDATA_USER_ROLE_PRIVILEDGE_MSG?v.UpdateUserRolePriviledgeMsg.decode(n.body):e==r.ADD_WEBCAM_MSG?v.AddWebcamMsg.decode(n.body):e==r.ADD_SPEAKER_MSG?v.AddSpeakerMsg.decode(n.body):e==r.ADD_DESKTOP_MSG?v.AddDesktopMsg.decode(n.body):e==r.REMOVE_WEBCAM_MSG?v.RemoveWebcamMsg.decode(n.body):e==r.REMOVE_SPEAKER_MSG?v.RemoveSpeakerMsg.decode(n.body):e==r.UPDATE_SPEAKER_MSG?v.UpdateSpeakerMsg.decode(n.body):e==r.UPDATE_WEBCAM_MSG?v.UpdateWebcamMsg.decode(n.body):e==r.UPDATE_DESKTOP_MSG?v.UpdateDesktopMsg.decode(n.body):e==r.PUB_ROOM_RESOURCE_MSG?v.PubRoomResourceMsg.decode(n.body):e==r.PUB_ROOM_RESOURCE_MSG_REP?v.PubRoomResourceMsgRep.decode(n.body):e==r.UNPUB_ROOM_RESOURCE_MSG?v.UnpubRoomResourceMsg.decode(n.body):e==r.UNPUB_ROOM_RESOURCE_MSG_REP?v.UnpubRoomResourceMsgRep.decode(n.body):e==r.SUB_ROOM_RESOURCE_MSG_REP?v.SubRoomResourceMsgRep.decode(n.body):e==r.UNSUB_ROOM_RESOURCE_MSG_REP?v.UnsubRoomResourceMsgRep.decode(n.body):e==r.PUB_VIDEO_REQ||e==r.PUB_AUDIO_REQ?v.PubResourceReq.decode(n.body):e==r.PUB_VIDEO_REP||e==r.PUB_AUDIO_REP?v.PubResourceRep.decode(n.body):e==r.VIDEO_INDICTION||e==r.AUDIO_INDICTION?v.ResourceIndiction.decode(n.body):e==r.OFFER_REQ?v.OfferReq.decode(n.body):e==r.OFFER_REP?v.OfferRep.decode(n.body):e==r.CANDIDATE_MSG?v.CandidateMsg.decode(n.body):e==r.SUB_ROOM_RESOURCE_REQ?v.SubRoomResourceReq.decode(n.body):e==r.SUB_ROOM_RESOURCE_REP?v.SubRoomResourceRep.decode(n.body):e==r.SUB_ROOM_RESOURCE_MSG?v.SubRoomResourceMsg.decode(n.body):e==r.UNSUB_ROOM_RESOURCE_MSG?v.UnsubRoomResourceMsg.decode(n.body):e==r.CLOSE_ROOM_REP?v.CloseRoomRep.decode(n.body):e==r.CLOSE_ROOM_MSG?v.CloseRoomMsg.decode(n.body):e==r.UPDATE_USER_NAME?v.UpdateUserName.decode(n.body):e==r.START_VIDEO_DATA_MSG?v.StartVideoDataMsg.decode(n.body):e==r.STOP_VIDEO_DATA_MSG?v.StopVideoDataMsg.decode(n.body):e==r.MODIFY_RESOURCE_REQ?v.ModifyResourceReq.decode(n.body):e==r.MODIFY_RESOURCE_REP?v.ModifyResourceRep.decode(n.body):e==r.VIDEO_STREAM_CONTROL_REP?v.VideoStreamControlRep.decode(n.body):e==r.UPDATE_BOARD_MSG?v.UpdateBoardMsg.decode(n.body):e==r.UPDATE_BOARD_MSG_REP?v.UpdateBoardMsgRep.decode(n.body):e==r.BOARDS_INFO_PDU?v.BoardsInfoMsg.decode(n.body):e==r.UPDATE_ANNOTATION_MSG?v.UpdateAnnotationMsg.decode(n.body):e==r.BIND_AUDIO_TO_VIDEO_REP?v.BindAudioToVideoRep.decode(n.body):e==r.OUTGOING_CREATE_STREAMS_EXPORTER_REP?v.OutgoingCreateStreamsExporterRep.decode(n.body):e==r.OUTGOING_SELECT_STREAM_REP?v.OutgoingSelectStreamRep.decode(n.body):e==r.OUTGOING_MIX_STREAMS_REP?v.OutgoingMixStreamsRep.decode(n.body):e==r.OUTGOING_DESTROY_EXPORTER_REP?v.OutgoingDestroyExporterRep.decode(n.body):e==r.OUTGOING_PAUSE_RESUME_EXPORTER_REP?v.OutgoingPauseResumeExporterRep.decode(n.body):e==r.OUTGOING_EXPORTER_ERROR_NOTIFY?v.OutgoingExporterErrorNotify.decode(n.body):e==r.OUTGOING_INVITE_STATUS_NOTIFY?v.OutgoingInviteStatusNotify.decode(n.body):e==r.ROOM_ATTRIBUTE_CHANGE_NOTIFY?v.RoomAttributeChangeNotify.decode(n.body):e==r.ROOM_START_AVC_MIXER_MEDIA_REP?v.RoomAvcControlRep.decode(n.body):e==r.ROOM_SET_STREAM_NAME_RSP?v.RoomSetStreamNameRsp.decode(n.body):e==r.ROOM_STREAM_NAME_CHANGED_NOTIFY?v.RoomStreamNameChangedNotify.decode(n.body):e==r.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP?v.OutgoingExporterSetFocusVideoRsp.decode(n.body):e==r.OUTGOING_GET_EXPORTER_INFO_RSP?v.OutgoingGetExporterInfoRsp.decode(n.body):e==r.USER_STREAM_ACTIVE?v.UserStreamActive.decode(n.body):e==r.MEDIA_PLAY_EVENT_NOTIFY?v.MediaPlayEventNotify.decode(n.body):e==r.STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY?v.StreamKeepAliveTimeoutNotify.decode(n.body):void 0},e}),{98:"18px",81:"15px",64:"11px",47:"7px",30:"3px",0:"0px"}),trackId2audioConnection={},trackId2videoConnection={},roomConnectionStats={bytesSentPrev:0,bytesReceivedPrev:0,packetsSentPrev:0,packetsReceivedPrev:0,timestampPrev:null},roomPacketsLostConnectionStats={uploadPacket:0,downloadPacket:0,uploadPacketsLost:0,downloadPacketsLost:0,timestampPrev:null},ssrc2deviceStats={},ssrc2devicePacketsLostStats={},connectionIndicator={roomHandle:null,room:{localAddress:"",localPort:0,localProtocol:"",remoteAddress:"",remotePort:0,remoteProtocol:"",uploadBitrate:0,downloadBitrate:0,uploadPacket:0,downloadPacket:0,uploadPacketLost:0,downloadPacketLost:0,uploadPacketLostRate:0,downloadPacketLostRate:0,currentRoundTripTime:0,totalRoundTripTime:0},getRoomConnection:function(){return connectionIndicator.room},getVideoConnection:function(e,t){e=connectionIndicator.roomHandle.getUser(e);if(e){e=e.getVideo(t);if(e&&e.track)return t=e.track.id,trackId2videoConnection[t]}},getAudioConnection:function(e){var e=connectionIndicator.roomHandle.getUser(e);if(e&&e.audio&&e.audio.track)return e=e.audio.track.id,trackId2audioConnection[e]},getScreenConnection:function(e){var e=connectionIndicator.roomHandle.getUser(e);if(e&&e.screen&&e.screen.track)return e=e.screen.track.id,trackId2videoConnection[e]}};function ConnectionInfoCollector(e,t){this.peerconnection=e,this.statsInterval=t,this.roomHandle=e.roomHandle,this.statsIntervalId=null,this.isRun=!1}function ConnectionInfoCollectorChrome(){}function ConnectionInfoCollectorFirefox(){}function ConnectionStatistics(e){this.peerconnection=e,this.getPeerStatusTimer=null,this.trace_id=connectionStatisticsConfig.trace_id||"",this.samplingRate=connectionStatisticsConfig.sampling_rate||3,this.logHttpServerAddr=connectionStatisticsConfig.http_server_addr,this.logHttpsServerAddr=connectionStatisticsConfig.https_server_addr,this.sendRate=1,this.app_id=connectionStatisticsConfig.app_id||"jh",this.user_agent=navigator.userAgent,this.client_type=1,this.ssrc2number={},this.report_mode=connectionStatisticsConfig.report_mode||0,this.myDB={name:"rtcDB",version:1,db:null},this.url="";e=document.location.protocol;"http:"==e?this.url=this.logHttpServerAddr:"https:"!=e&&"httpsionic:"!=e||(this.url=this.logHttpsServerAddr),this.sendVideoMap={bytesSent:"bytesSent",codecImplementationName:"codecImplementationName",framesEncoded:"framesEncoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsSent:"packetsSent",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googAdaptationChanges:"googAdaptationChanges",googAvgEncodeMs:"googAvgEncodeMs",googBandwidthLimitedResolution:"googBandwidthLimitedResolution",googCodecName:"googCodecName",googContentType:"googContentType",googCpuLimitedResolution:"googCpuLimitedResolution",googEncodeUsagePercent:"googEncodeUsagePercent",googFirsReceived:"googFirsReceived",googFrameHeightSent:"googFrameHeightSent",googFrameRateInput:"googFrameRateInput",googFrameRateSent:"googFrameRateSent",googFrameWidthSent:"googFrameWidthSent",googHasEnteredLowResolution:"googHasEnteredLowResolution",hugeFramesSent:"hugeFramesSent",googNacksReceived:"googNacksReceived",googPlisReceived:"googPlisReceived",googRtt:"googRtt",googTrackId:"googTrackId"},this.recvVideoMap={bytesReceived:"bytesReceived",codecImplementationName:"codecImplementationName",framesDecoded:"framesDecoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googCaptureStartNtpTimeMs:"googCaptureStartNtpTimeMs",googCodecName:"googCodecName",googContentType:"googContentType",googCurrentDelayMs:"googCurrentDelayMs",googDecodeMs:"googDecodeMs",googFirsSent:"googFirsSent",googFrameHeightReceived:"googFrameHeightReceived",googFrameRateDecoded:"googFrameRateDecoded",googFrameRateOutput:"googFrameRateOutput",googFrameRateReceived:"googFrameRateReceived",googFrameWidthReceived:"googFrameWidthReceived",googInterframeDelayMax:"googInterframeDelayMax",googJitterBufferMs:"googJitterBufferMs",googMaxDecodeMs:"googMaxDecodeMs",googMinPlayoutDelayMs:"googMinPlayoutDelayMs",googNacksSent:"googNacksSent",googPlisSent:"googPlisSent",googRenderDelayMs:"googRenderDelayMs",googTargetDelayMs:"googTargetDelayMs",googTrackId:"googTrackId"},this.sendAudioMap={audioInputLevel:"audioInputLevel",bytesSent:"bytesSent",mediaType:"mediaType",packetsSent:"packetsSent",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googCodecName:"googCodecName",googTrackId:"googTrackId",googTypingNoiseState:"googTypingNoiseState"},this.recvAudioMap={audioOutputLevel:"audioOutputLevel",bytesReceived:"bytesReceived",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googAccelerateRate:"googAccelerateRate",googCodecName:"googCodecName",googCurrentDelayMs:"googCurrentDelayMs",googDecodingCNG:"googDecodingCNG",googDecodingCTN:"googDecodingCTN",googDecodingCTSG:"googDecodingCTSG",googDecodingMuted:"googDecodingMuted",googDecodingNormal:"googDecodingNormal",googDecodingPLC:"googDecodingPLC",googDecodingPLCCNG:"googDecodingPLCCNG",googExpandRate:"googExpandRate",googJitterBufferMs:"googJitterBufferMs",googJitterReceived:"googJitterReceived",googPreemptiveExpandRate:"googPreemptiveExpandRate",googPreferredJitterBufferMs:"googPreferredJitterBufferMs",googSecondaryDecodedRate:"googSecondaryDecodedRate",googSecondaryDiscardedRate:"googSecondaryDiscardedRate",googSpeechExpandRate:"googSpeechExpandRate",googTrackId:"googTrackId"},this.candidateMap={googActiveConnection:"googActiveConnection",bytesReceived:"bytesReceived",bytesSent:"bytesSent",packetsSent:"packetSent",googReadable:"googReadable",requestsSent:"requestSent",consentRequestsSent:"consentRequestsSent",responsesSent:"responsesSent",requestsReceived:"requestsReceived",responsesReceived:"responsesReceived",googLocalAddress:"googLocalAddress",localCandidateId:"localCandidateId",googLocalCandidateType:"googLocalCandidateType",googRemoteAddress:"googRemoteAddress",remoteCandidateId:"remoteCandidateId",googRemoteCandidateType:"googRemoteCandidateType",googRtt:"googRtt",packetsDiscardedOnSend:"packetsDiscardedOnSend",googTransportType:"googTransportType",googWritable:"googWritable"}}function AudioLevel(e){this.roomHandle=e,this.audioLevelsIntervalId=null}ConnectionInfoCollector.prototype.start=function(e){var r=this;r.isRun?log.info("===ConnectionInfoCollector(),ConnectionInfoCollector is running,  ignore to start()."):(log.info("===ConnectionInfoCollector(),ConnectionInfoCollector.start()."),r.isRun=!0,e&&(r.statsInterval=e),r.statsIntervalId&&clearInterval(r.statsIntervalId),r.statsIntervalId=setInterval(function(){"closed"!=r.peerconnection.iceConnectionState&&r.peerconnection.getStats(null).then(function(e){var t;avdEngineHandle.isFirefox||(t=new ConnectionInfoCollectorChrome),(t=avdEngineHandle.isFirefox?new ConnectionInfoCollectorFirefox:t).dumpStats(e,r.peerconnection.roomHandle)},r.errorCallback)},r.statsInterval))},ConnectionInfoCollector.prototype.errorCallback=function(e){log.error("===ConnectionInfoCollector(),getStats().errorCallback().error:",e),this.stop()},ConnectionInfoCollector.prototype.stop=function(){this.isRun=!1,this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},ConnectionInfoCollectorChrome.prototype.dumpStats=function(r,e){for(var n=this,o=(connectionIndicator.roomHandle=e,0),i=0,a=0,s=0,d=!1,t=0;t<r.length;t++)if("remote-outbound-rtp"===r[t].type){d=!0;break}r.forEach(function(e){var t;n.setRoomStats(r,e),n.setDeviceStat(r,e),"transport"===e.type&&(e.packetsSent&&(o=e.packetsSent),e.packetsReceived)&&(i=e.packetsReceived),avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<=85&&("outbound-rtp"===e.type&&(o+=e.packetsSent),"inbound-rtp"===e.type)&&(i+=e.packetsReceived),"remote-inbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(a+=t.packetsLostPrev),d?"remote-outbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev):"inbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev)});var l,u,c,p,h,f,m=new Date;roomPacketsLostConnectionStats.timestampPrev?(l=o-roomPacketsLostConnectionStats.uploadPacket,u=i-roomPacketsLostConnectionStats.downloadPacket,c=a-roomPacketsLostConnectionStats.uploadPacketsLost,p=s-roomPacketsLostConnectionStats.downloadPacketsLost,l<0&&(l=0),c<0&&(c=0),(h=Math.round(c/l*1e4)/100)<0&&(h=0),p<0&&(p=0),u<0&&(u=0),(f=Math.round(p/u*1e4)/100)<0&&(f=0),avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<=85&&(connectionIndicator.room.uploadPacket=void 0!==l?l:"0",connectionIndicator.room.downloadPacket=void 0!==u?u:"0"),connectionIndicator.room.uploadPacketLost=c,connectionIndicator.room.downloadPacketLost=p,connectionIndicator.room.uploadPacketLostRate=h?h+"%":"0%",connectionIndicator.room.downloadPacketLostRate=f?f+"%":"0%",connectionIndicator.room.uploadPacketLossRate=connectionIndicator.room.uploadPacketLostRate,connectionIndicator.room.downloadPacketLossRate=connectionIndicator.room.downloadPacketLostRate,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.timestampPrev=m):(roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.timestampPrev=m,connectionIndicator.room.uploadPacketLost=0,connectionIndicator.room.downloadPacketLost=0,connectionIndicator.room.uploadPacketLostRate="0%",connectionIndicator.room.downloadPacketLostRate="0%"),null!=e?e.eventEmitter.emit(RoomCallback.connection_indicator,connectionIndicator):this.stop()},ConnectionInfoCollectorChrome.prototype.setRoomStats=function(e,t){var r,n,o,i,a,s,d,l,u=t.timestamp;"candidate-pair"===t.type?(void 0!==t.currentRoundTripTime?connectionIndicator.room.currentRoundTripTime=t.currentRoundTripTime+"s":connectionIndicator.room.currentRoundTripTime="0s",void 0!==t.totalRoundTripTime?connectionIndicator.room.totalRoundTripTime=t.totalRoundTripTime+"s":connectionIndicator.room.totalRoundTripTime="0s"):"transport"===t.type&&(d=t.bytesSent,l=t.bytesReceived,a=t.packetsSent,s=t.packetsReceived,roomConnectionStats.timestampPrev&&(d&&(r=8*(d-roomConnectionStats.bytesSentPrev)/(u-roomConnectionStats.timestampPrev),r=Math.floor(r)),l&&(n=8*(l-roomConnectionStats.bytesReceivedPrev)/(u-roomConnectionStats.timestampPrev),n=Math.floor(n)),a&&(o=(a-roomConnectionStats.packetsSentPrev)/((u-roomConnectionStats.timestampPrev)/1e3),o=Math.floor(o)),s)&&(i=(s-roomConnectionStats.packetsReceivedPrev)/((u-roomConnectionStats.timestampPrev)/1e3),i=Math.floor(i)),roomConnectionStats.bytesSentPrev=d,roomConnectionStats.bytesReceivedPrev=l,roomConnectionStats.packetsSentPrev=a,roomConnectionStats.packetsReceivedPrev=s,roomConnectionStats.timestampPrev=u,(activeCandidatePair=e.get(t.selectedCandidatePairId))&&activeCandidatePair.localCandidateId&&(d=e.get(activeCandidatePair.localCandidateId))&&(d.address&&(connectionIndicator.room.localAddress=d.address),d.ip&&(connectionIndicator.room.localAddress=d.ip),d.ipAddress&&(connectionIndicator.room.localAddress=d.ipAddress),d.port&&(connectionIndicator.room.localPort=d.port),d.portNumber&&(connectionIndicator.room.localPort=d.portNumber),d.protocol)&&(connectionIndicator.room.localProtocol=d.protocol),activeCandidatePair&&activeCandidatePair.remoteCandidateId&&(l=e.get(activeCandidatePair.remoteCandidateId))&&(l.address&&(connectionIndicator.room.remoteAddress=l.address),l.ip&&(connectionIndicator.room.remoteAddress=l.ip),l.ipAddress&&(connectionIndicator.room.remoteAddress=l.ipAddress),l.port&&(connectionIndicator.room.remotePort=l.port),l.portNumber&&(connectionIndicator.room.remotePort=l.portNumber),l.port)&&(connectionIndicator.room.remoteProtocol=l.protocol),connectionIndicator.room.uploadBitrate=void 0!==r?r+="Kbps":r="--Kbps",connectionIndicator.room.downloadBitrate=void 0!==n?n+="Kbps":n="--Kbps",connectionIndicator.room.uploadPacket=void 0!==o?o:"0",connectionIndicator.room.downloadPacket=void 0!==i?i:"0")},ConnectionInfoCollectorChrome.prototype.setDeviceStat=function(e,t){var r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,y,v,b,_,S,w,E,I,T,C,R,P,k,x=t.timestamp;("outbound-rtp"===t.type||"inbound-rtp"===t.type)&&(l=t.ssrc,u=t.qpSum,c=t.framesEncoded,p=t.framesDecoded,k=t.bytesSent,f=t.bytesReceived,m=t.packetsSent,R=t.packetsReceived,_=g=h=null,"outbound-rtp"===t.type?(g=e.get(t.remoteId)?e.get(t.remoteId).packetsLost:0,e.get(t.remoteId)&&e.get(t.remoteId).fractionLost&&(_=e.get(t.remoteId).fractionLost)):"inbound-rtp"===t.type&&(_=(g=t.packetsLost)/(g+R)),(avdEngineHandle.isSafari||avdEngineHandle.isMicroMessenger)&&(m=m&&Math.abs(m),R=R&&Math.abs(R)),avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<86&&(T=e.get(t.trackId))&&("outbound-rtp"===t.type?y=T.framesSent:"inbound-rtp"===t.type&&(v=T.framesReceived)),(avdEngineHandle.isSafari||avdEngineHandle.isMicroMessenger)&&(T=e.get(t.trackId||t.id))&&("inbound-rtp"===t.type?v=T.framesReceived:"outbound-rtp"===t.type&&(v=T.framesSent)),(P=ssrc2deviceStats[l])&&P.timestampPrev&&(k&&(r=8*(k-P.bytesSentPrev)/(x-P.timestampPrev),r=Math.floor(r)),f&&(n=8*(f-P.bytesReceivedPrev)/(x-P.timestampPrev),n=Math.floor(n)),m&&(o=(m-P.packetsSentPrev)/((x-P.timestampPrev)/1e3),o=Math.floor(o)),R&&(i=(R-P.packetsReceivedPrev)/((x-P.timestampPrev)/1e3),i=Math.floor(i)),v&&v>P.framesReceivedPrev&&(d=(v-P.framesReceivedPrev)/((x-P.timestampPrev)/1e3),d=Math.floor(d)),y&&y>P.framesSentPrev&&(s=(y-P.framesSentPrev)/((x-P.timestampPrev)/1e3),s=Math.floor(s)),g&&(lostpPackets=g>P.packetsLostPrev?(lostpPackets=(g-P.packetsLostPrev)/((x-P.timestampPrev)/1e3),Math.round(lostpPackets)):0),"outbound-rtp"===t.type?a=_=e.get(t.remoteId)&&!e.get(t.remoteId).fractionLost?(lostpPackets="undefined"==typeof lostpPackets?0:lostpPackets)/o:_:"inbound-rtp"===t.type&&(a=(lostpPackets="undefined"==typeof lostpPackets?0:lostpPackets)/(lostpPackets+i)),_=0,u&&u>P.qpSumPrev&&(_=(u-P.qpSumPrev)/((x-P.timestampPrev)/1e3)),c&&c>P.framesEncodedPrev&&(b=(c-P.framesEncodedPrev)/((x-P.timestampPrev)/1e3)),p&&p>P.framesDecodedPrev&&(S=(p-P.framesDecodedPrev)/((x-P.timestampPrev)/1e3)),"outbound-rtp"===t.type?h=_/b:"inbound-rtp"===t.type&&(h=_/S)),b="","outbound-rtp"===t.type?""===(b=t.mediaSourceId&&(C=e.get(t.mediaSourceId))&&C.trackIdentifier?C.trackIdentifier:b)&&(b=t.trackId):"inbound-rtp"===t.type&&(b=(void 0!==t.trackIdentifier?t:C=e.get(t.trackId)).trackIdentifier),(_={}).trackId=b,_.ssrc=l,P?(P.bytesSentPrev=k,P.bytesReceivedPrev=f,P.packetsSentPrev=m,P.packetsReceivedPrev=R,P.trackIdPrev=b,P.framesReceivedPrev=v,P.framesSentPrev=y,P.packetsLostPrev=g,P.qpSumPrev=u,P.framesEncodedPrev=c,P.framesDecodedPrev=p,P.timestampPrev=x):((S={}).bytesSentPrev=k,S.bytesReceivedPrev=f,S.packetsSentPrev=m,S.trackIdPrev=b,S.framesReceivedPrev=v,S.framesSentPrev=y,S.packetsLostPrev=g,S.qpSumPrev=u,S.framesEncodedPrev=c,S.framesDecodedPrev=p,S.timestampPrev=x,ssrc2deviceStats[l]=S),"outbound-rtp"===t.type?avdEngineHandle.isChrome&&86<=avdEngineHandle.majorVersion?(w=t.frameWidth,E=t.frameHeight,I=t.framesPerSecond):avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<86&&((T=e.get(t.trackId))&&T.frameWidth&&(w=T.frameWidth),T&&T.frameHeight&&(E=T.frameHeight),s)&&(I=s):"inbound-rtp"===t.type&&(avdEngineHandle.isChrome&&86<=avdEngineHandle.majorVersion?(w=t.frameWidth,E=t.frameHeight,I=t.framesPerSecond):avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<86&&((T=e.get(t.trackId))&&T.frameWidth&&(w=T.frameWidth),T&&T.frameHeight&&(E=T.frameHeight),d)&&(I=d)),(avdEngineHandle.isSafari||avdEngineHandle.isMicroMessenger)&&((T=e.get(t.trackId||t.id))&&T.frameWidth&&(w=T.frameWidth),T&&T.frameHeight&&(E=T.frameHeight),d)&&(I=d),_.qpSum=u||"--",_.framesEncoded=c||"--",_.framesDecoded=p||"--",_.perFrameQP=h?Math.round(100*h)/100:"--",w&&(_.resolution=w+"X"+E,_.resolutionWidth=w),E&&(_.resolutionHeight=E),_.frameRate=void 0!==I?I+"fps":"--fps",_.uploadBitrate=void 0!==r?r+"Kbps":"--Kbps",_.downloadBitrate=void 0!==n?n+"Kbps":"--Kbps",_.uploadPacket=void 0!==o?o:"0",_.downloadPacket=void 0!==i?i:"0",(C=e.get(t.codecId))&&(R=C.payloadType,P=C.mimeType,k=C.clockRate,_.payloadType=R,_.mimeType=P,_.clockRate=k),"undefined"!=typeof lostpPackets?_.packetsLost=lostpPackets:_.packetsLost="0",_.packetLostRate=void 0===a||"0"==_.packetsLost?"0%":Math.round(1e4*a)/100+"%",0<r||0<n)&&("video"===t.mediaType||"video"===t.kind?trackId2videoConnection[b]=_:"audio"!==t.mediaType&&"audio"!==t.kind||(trackId2audioConnection[b]=_))},ConnectionInfoCollectorFirefox.prototype.dumpStats=function(r,e){for(var n=this,o=(connectionIndicator.roomHandle=e,0),i=0,a=0,s=0,d=!1,t=0;t<r.length;t++)if("remote-outbound-rtp"===r[t].type){d=!0;break}r.forEach(function(e){var t;n.setRoomStats(r,e),n.setDeviceStat(r,e),"outbound-rtp"===e.type&&(o+=e.packetsSent),"inbound-rtp"===e.type&&(i+=e.packetsReceived),"remote-inbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(a+=t.packetsLostPrev),d?"remote-outbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev):"inbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev)});var l,u,c,p,h,f,m=new Date;roomPacketsLostConnectionStats.timestampPrev?(l=o-roomPacketsLostConnectionStats.uploadPacket,u=i-roomPacketsLostConnectionStats.downloadPacket,c=a-roomPacketsLostConnectionStats.uploadPacketsLost,p=s-roomPacketsLostConnectionStats.downloadPacketsLost,l<0&&(l=0),c<0&&(c=0),(h=Math.round(c/l*1e4)/100)<0&&(h=0),p<0&&(p=0),u<0&&(u=0),(f=Math.round(p/u*1e4)/100)<0&&(f=0),connectionIndicator.room.uploadPacket=void 0!==l?l:"0",connectionIndicator.room.downloadPacket=void 0!==u?u:"0",connectionIndicator.room.uploadPacketLost=c,connectionIndicator.room.downloadPacketLost=p,connectionIndicator.room.uploadPacketLostRate=h?h+"%":"0%",connectionIndicator.room.downloadPacketLostRate=f?f+"%":"0%",connectionIndicator.room.uploadPacketLossRate=connectionIndicator.room.uploadPacketLostRate,connectionIndicator.room.downloadPacketLossRate=connectionIndicator.room.downloadPacketLostRate,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.timestampPrev=m):(roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.timestampPrev=m,connectionIndicator.room.uploadPacketLost=0,connectionIndicator.room.downloadPacketLost=0,connectionIndicator.room.uploadPacketLostRate="0%",connectionIndicator.room.downloadPacketLostRate="0%"),null!=e?e.eventEmitter.emit(RoomCallback.connection_indicator,connectionIndicator):this.stop()},ConnectionInfoCollectorFirefox.prototype.setRoomStats=function(e,t){var r,n,o,i,a=t.timestamp;connectionIndicator.room.currentRoundTripTime="--s",connectionIndicator.room.totalRoundTripTime="--s","candidate-pair"===t.type&&t.nominated&&t.selected&&(o=t.bytesSent,i=t.bytesReceived,roomConnectionStats.timestampPrev&&(o&&(r=8*(o-roomConnectionStats.bytesSentPrev)/(a-roomConnectionStats.timestampPrev),r=Math.floor(r)),i)&&(n=8*(i-roomConnectionStats.bytesReceivedPrev)/(a-roomConnectionStats.timestampPrev),n=Math.floor(n)),roomConnectionStats.bytesSentPrev=o,roomConnectionStats.bytesReceivedPrev=i,roomConnectionStats.timestampPrev=a,(o=e.get(t.localCandidateId))&&(o.address&&(connectionIndicator.room.localAddress=o.address),o.port&&(connectionIndicator.room.localPort=o.port),o.protocol)&&(connectionIndicator.room.localProtocol=o.protocol),(i=e.get(t.remoteCandidateId))&&(i.address&&(connectionIndicator.room.remoteAddress=i.address),i.port&&(connectionIndicator.room.remotePort=i.port),i.port)&&(connectionIndicator.room.remoteProtocol=i.protocol),connectionIndicator.room.uploadBitrate=void 0!==r?r+="Kbps":r="--Kbps",connectionIndicator.room.downloadBitrate=void 0!==n?n+="Kbps":n="--Kbps",connectionIndicator.room.uploadPacket="--",connectionIndicator.room.downloadPacket="--")},ConnectionInfoCollectorFirefox.prototype.setDeviceStat=function(e,t){var r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,y,v,b,_,S,w,E,I,T,C,R=t.timestamp;("outbound-rtp"===t.type||"inbound-rtp"===t.type)&&(s=t.ssrc,d=t.qpSum,l=t.framesEncoded,u=t.framesDecoded,C=t.bytesSent,p=t.bytesReceived,h=t.packetsSent,I=t.packetsReceived,y=f=c=null,"outbound-rtp"===t.type?(f=e.get(t.remoteId)?e.get(t.remoteId).packetsLost:0,e.get(t.remoteId)&&e.get(t.remoteId).fractionLost&&(y=e.get(t.remoteId).fractionLost),m=t.framesSent):"inbound-rtp"===t.type&&(y=(f=t.packetsLost)/(f+I),g=t.framesReceived),(T=ssrc2deviceStats[s])&&T.timestampPrev&&(C&&(r=8*(C-T.bytesSentPrev)/(R-T.timestampPrev),r=Math.floor(r)),p&&(n=8*(p-T.bytesReceivedPrev)/(R-T.timestampPrev),n=Math.floor(n)),h&&(o=(h-T.packetsSentPrev)/((R-T.timestampPrev)/1e3),o=Math.floor(o)),I&&(i=(I-T.packetsReceivedPrev)/((R-T.timestampPrev)/1e3),i=Math.floor(i)),g&&g>T.framesReceivedPrev&&(b=(g-T.framesReceivedPrev)/((R-T.timestampPrev)/1e3),Math.floor(b)),m&&m>T.framesSentPrev&&(b=(m-T.framesSentPrev)/((R-T.timestampPrev)/1e3),Math.floor(b)),f&&(lostpPackets=f>T.packetsLostPrev?(lostpPackets=(f-T.packetsLostPrev)/((R-T.timestampPrev)/1e3),Math.round(lostpPackets)):0),"outbound-rtp"===t.type?a=y=e.get(t.remoteId)&&!e.get(t.remoteId).fractionLost?(lostpPackets="undefined"==typeof lostpPackets?0:lostpPackets)/o:y:"inbound-rtp"===t.type&&(a=(lostpPackets="undefined"==typeof lostpPackets?0:lostpPackets)/(lostpPackets+i)),b=0,d&&d>T.qpSumPrev&&(b=(d-T.qpSumPrev)/((R-T.timestampPrev)/1e3)),l&&l>T.framesEncodedPrev&&(v=(l-T.framesEncodedPrev)/((R-T.timestampPrev)/1e3)),u&&u>T.framesDecodedPrev&&(E=(u-T.framesDecodedPrev)/((R-T.timestampPrev)/1e3)),"outbound-rtp"===t.type?c=b/v:"inbound-rtp"===t.type&&(c=b/E)),y="","outbound-rtp"!==t.type&&"inbound-rtp"===t.type&&(y=t.trackIdentifier),(v={}).trackId=y,v.ssrc=s,T?(T.bytesSentPrev=C,T.bytesReceivedPrev=p,T.packetsSentPrev=h,T.packetsReceivedPrev=I,T.trackIdPrev=y,T.framesReceivedPrev=g,T.framesSentPrev=m,T.packetsLostPrev=f,T.qpSumPrev=d,T.framesEncodedPrev=l,T.framesDecodedPrev=u,T.timestampPrev=R):((b={}).bytesSentPrev=C,b.bytesReceivedPrev=p,b.packetsSentPrev=h,b.trackIdPrev=y,b.framesReceivedPrev=g,b.framesSentPrev=m,b.packetsLostPrev=f,b.qpSumPrev=d,b.framesEncodedPrev=l,b.framesDecodedPrev=u,b.timestampPrev=R,ssrc2deviceStats[s]=b),v.qpSum=d||"--",v.framesEncoded=l||"--",v.framesDecoded=u||"--",v.perFrameQP=c?Math.round(100*c)/100:"--","outbound-rtp"!==t.type&&"inbound-rtp"!==t.type||(_=t.frameWidth,S=t.frameHeight,w=t.framesPerSecond),_&&(v.resolution=_+"X"+S,v.resolutionWidth=_),S&&(v.resolutionHeight=S),v.frameRate=void 0!==w?w+"fps":"--fps",v.uploadBitrate=void 0!==r?r+"Kbps":"--Kbps",v.downloadBitrate=void 0!==n?n+"Kbps":"--Kbps",v.uploadPacket=void 0!==o?o:"0",v.downloadPacket=void 0!==i?i:"0",(E=e.get(t.codecId))&&(I=E.payloadType,T=E.mimeType,C=E.clockRate,v.payloadType=I,v.mimeType=T,v.clockRate=C),"undefined"!=typeof lostpPackets?v.packetsLost=lostpPackets:v.packetsLost="0",v.packetLostRate=void 0===a||"0"==v.packetsLost?"0%":Math.round(1e4*a)/100+"%",0<r||0<n)&&("video"===t.kind?trackId2videoConnection[y]=v:"audio"===t.kind&&(trackId2audioConnection[y]=v))},ConnectionStatistics.prototype.start2Log=function(n){var e=this,o=(n=n||5,0),i=0;clearInterval(e.getPeerStatusTimer),e.getPeerStatusTimer=setInterval(function(){e.getPeerStatus().then(function(e){e.forEach(function(e){switch(e.event_type){case connectionEventTypeEnum.sendVideo:log.info("stream sendVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthSent+"x"+e.googFrameHeightSent+" "+e.googFrameRateInput+" ] ");break;case connectionEventTypeEnum.recvVideo:log.info("stream recvVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthReceived+"x"+e.googFrameHeightReceived+" "+e.googFrameRateOutput+" ] ");break;case connectionEventTypeEnum.sendAudio:log.info("stream sendAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioInputLevel+" ] ");break;case connectionEventTypeEnum.recvAudio:log.info("stream recvAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioOutputLevel+" ] ");break;case connectionEventTypeEnum.conndidate:var t=parseInt((e.bytesSent-o)/n),r=parseInt((e.bytesReceived-i)/n);log.info("room ["+e.googTransportType+" "+e.googLocalAddress+" -> "+e.googRemoteAddress+" ] [ "+t+","+r+" ] "),o=parseInt(e.bytesSent),i=parseInt(e.bytesReceived)}})})},1e3*n)},ConnectionStatistics.prototype.start=function(){var t,r,n=this;log.debug("===ConnectionStatistics.start(),url:"+n.url),n.url&&(t=1,r=[],n.openDB(),clearInterval(n.getPeerStatusTimer),n.getPeerStatusTimer=setInterval(function(){n.getPeerStatus().then(function(e){r=r.concat(e),t==n.sendRate&&(n.sendData(r),r=[],t=0),t++})},1e3*n.samplingRate))},ConnectionStatistics.prototype.stop=function(){clearInterval(this.getPeerStatusTimer)},ConnectionStatistics.prototype.sendData=function(e){e={data:{trace_id:this.trace_id,app_id:this.app_id,user_id:room.selfUser.id,user_name:room.selfUser.name,room_id:room.id,user_agent:this.user_agent,client_type:this.client_type,data_infos:e}};0==parseInt(this.report_mode)?this.fetchPost(this.url,e).then(function(e){}).catch(function(e){}):this.addData(e)},ConnectionStatistics.prototype.getPeerStatus=function(){var t=when.defer(),n=this,o=[];return n.peerconnection.getStats(function(e){e.result().forEach(function(e){var t={};if(t.timestamp=Date.parse(e.timestamp),"ssrc"==e.type){if(n.ssrc2number[e.stat("ssrc")]?n.ssrc2number[e.stat("ssrc")]++:n.ssrc2number[e.stat("ssrc")]=1,t.seq_num=n.ssrc2number[e.stat("ssrc")],room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],n.sendVideoMap)t[r]=e.stat(r);o.push(t)}else if(room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],n.recvVideoMap)t[r]=e.stat(r);o.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,n.sendAudioMap)t[r]=e.stat(r);o.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,n.recvAudioMap)t[r]=e.stat(r);o.push(t)}}else if("googCandidatePair"==e.type&&"true"==e.stat("googActiveConnection")){for(var r in t.event_type=connectionEventTypeEnum.conndidate,n.candidateMap)t[r]=e.stat(r);o.push(t)}}),t.resolve(o)}),t.promise},ConnectionStatistics.prototype.fetchPost=function(e,n){return new Promise(function(t,r){axios.post(e,n,{headers:{"Content-Type":"application/json"}}).then(function(e){0===e.data.ret?t(e.data):(e={code:e.data.ret,message:e.data.msg},r(e))}).catch(function(e){var t;t=e.response?new Error(e.response.status,e.response.data):new Error(1e4,e.message),r(t),r(e)})})},ConnectionStatistics.prototype.openDB=function(){var t=this,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){log.error("===ConnectionStatistics.openDB(), error:"+e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,log.debug("===ConnectionStatistics.openDB(),本地数据库打开成功")},e.onupgradeneeded=function(e){e=e.target.result;e.objectStoreNames.contains("body_content")||e.createObjectStore("body_content",{autoIncrement:!0}),log.debug("===ConnectionStatistics.openDB(),DB version changed to:1")}},ConnectionStatistics.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},ConnectionStatistics.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},ConnectionStatistics.prototype.fetchStoreByCursor=function(){var t=this;t.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){e=e.target.result;e&&(t.deleteDataByKey(e.key),e.continue(),t.fetchPost(t.url,e.value).then(function(e){}).catch(function(e){}))}},ConnectionStatistics.prototype.sendDBData=function(){this.fetchStoreByCursor()},AudioLevel.prototype.start=function(r){var e=when.defer(),t=this;return clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=setInterval(function(){t.roomHandle&&t.roomHandle.getParticipants().forEach(function(e){var t;e&&e.audio&&(e.audio.track&&!e.audio.isMonitorAudioLevel&&(e.audio.isMonitorAudioLevel=!0,(t=new MediaStream).addTrack(e.audio.track),monitorAudioLevelBySteam(t,e.audio,r)),e.audio.track&&!e.audio.track.enabled&&(e.audio.audioLevel=0),e.audio.track||(e.audio.setAudioLevel(0),e.audio.isMonitorAudioLevel=!1,e.audio.monitorAudioLevelIntervalId&&(clearInterval(e.audio.monitorAudioLevelIntervalId),e.audio.monitorAudioLevelIntervalId=null)))}),e.resolve()},300),e.promise},AudioLevel.prototype.stop=function(){var e=when.defer();return this.audioLevelsIntervalId?(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null,this.roomHandle&&this.roomHandle.getParticipants().forEach(function(e){e&&e.audio&&(e.audio.setAudioLevel(0),e.audio.isMonitorAudioLevel=!1,e.audio.monitorAudioLevelIntervalId)&&(clearInterval(e.audio.monitorAudioLevelIntervalId),e.audio.monitorAudioLevelIntervalId=null)}),e.resolve()):e.reject(),e.promise};var WEBAUDIO_ANALYZER_FFT_SIZE=2048,WEBAUDIO_ANALYZER_SMOOTING_TIME=.8,context=(window.AudioContext=window.AudioContext||window.webkitAudioContext,null);function timeDomainDataToAudioLevel(e){for(var t=0,r=e.length,n=0;n<r;n++)t<e[n]&&(t=e[n]);return parseFloat(((t-127)/128).toFixed(3))}function animateLevel(e,t){var r=0,n=t-e,r=.2<n?t-.2:n<-.4?t+.4:e;return parseFloat(r.toFixed(3))}function LocalStatsCollector(e,t,r){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=r}function monitorAudioLevelBySteam(e,t,r){var n,o,i=0;window.AudioContext&&!context&&(context=new AudioContext).suspend(),context&&(context.resume(),(o=context.createAnalyser()).smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,o.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(e).connect(o),t.monitorAudioLevelIntervalId=setInterval(function(){var e=new Uint8Array(o.frequencyBinCount),e=(o.getByteTimeDomainData(e),timeDomainDataToAudioLevel(e));e!=i&&(i=animateLevel(e,i),1===(n=audioLevelFullRange(8e4*i))&&(n=0),t.audioLevel=n)},r))}function LoggerReport(){this.httpServerAddr="",this.httpsServerAddr="",this.reportMode=0,this.traceId="",this.appId="jh",this.reportLogLevel=1,this.userAgent=navigator.userAgent,this.clientType=1,this.reportUrl="",this.openLogger=!1,this.myDB={name:"rtcDB_logger",version:1,db:null},this.myDBOnsuccess=!1,this.sendDataCache=[],LoggerReport.prototype.start=function(){console.log("===LoggerReport.start()"),this.httpServerAddr=loggerReportConfig.http_server_addr,this.httpsServerAddr=loggerReportConfig.https_server_addr,this.reportMode=loggerReportConfig.report_mode||0,this.traceId=loggerReportConfig.trace_id||"",this.appId=loggerReportConfig.app_id||"jh",this.reportLogLevel=loggerReportConfig.log_level||1,this.reportUrl=this.httpServerAddr,"https:"==protocolStr&&(this.reportUrl=this.httpsServerAddr),this.openDB(),this.openLogger=!0},LoggerReport.prototype.stop=function(){console.log("===LoggerReport.stop()"),this.openLogger=!1},LoggerReport.prototype.debug=function(e){this.baseLevel(e,1)},LoggerReport.prototype.info=function(e){this.baseLevel(e,2)},LoggerReport.prototype.error=function(e){this.baseLevel(e,3)},LoggerReport.prototype.baseLevel=function(e,t){if(this.openLogger&&t>=this.reportLogLevel){var r=[],n={},o=new Date;if(n.timestamp=o.getTime(),n.log_content=e,n.log_level=t,r.push(n),room&&room.selfUser&&room.selfUser.id&&this.myDBOnsuccess){for(;0<this.sendDataCache.length;){var i=this.sendDataCache.pop();this.sendData(i)}this.sendData(r)}else this.sendDataCache.unshift(r)}},LoggerReport.prototype.sendData=function(e){var t="",r=(room&&room.selfUser&&room.selfUser.id&&(t=room.selfUser.id),""),n=(room&&room.selfUser&&room.selfUser.name&&(r=room.selfUser.name),""),t=(room&&room.id&&(n=room.id),{data:{app_id:this.appId,user_id:t,user_name:r,room_id:n,user_agent:this.userAgent,client_type:this.clientType,trace_id:this.traceId,log_infos:e}});0==parseInt(this.reportMode)?this.fetchPost(this.reportUrl,t).then(function(e){}).catch(function(e){}):this.addData(t)},LoggerReport.prototype.fetchPost=function(e,n){return new Promise(function(t,r){axios.post(e,n,{headers:{"Content-Type":"application/json"}}).then(function(e){0===e.data.ret?t(e.data):(e={code:e.data.ret,message:e.data.msg},r(e))}).catch(function(e){var t;t=e.response?new Error(e.response.status,e.response.data):new Error(1e4,e.message),r(t),r(e)})})},LoggerReport.prototype.openDB=function(){console.log("===LoggerReport.openDB()");var t=this,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){console.log(e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,console.log("本地数据库打开成功"),t.myDBOnsuccess=!0},e.onupgradeneeded=function(e){e=e.target.result;arrayUtil.contains(e.objectStoreNames,"body_content")||e.createObjectStore("body_content",{autoIncrement:!0}),console.log("DB version changed to 1")}},LoggerReport.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},LoggerReport.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},LoggerReport.prototype.fetchStoreByCursor=function(){var t=this;t.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){e=e.target.result;e&&(t.deleteDataByKey(e.key),e.continue(),t.fetchPost(t.reportUrl,e.value).then(function(e){}).catch(function(e){}))}},LoggerReport.prototype.sendDBData=function(){this.fetchStoreByCursor()}}LocalStatsCollector.prototype.start=function(){var t,r;window.AudioContext&&!context&&(context=new AudioContext).suspend(),context&&(context.resume(),(t=context.createAnalyser()).smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,t.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(this.stream).connect(t),(r=this).intervalId=setInterval(function(){var e=new Uint8Array(t.frequencyBinCount),e=(t.getByteTimeDomainData(e),timeDomainDataToAudioLevel(e));e!=r.audioLevel&&(r.audioLevel=animateLevel(e,r.audioLevel),e=audioLevelFullRange(8e4*r.audioLevel),r.callback(e=1===e?0:e))},this.intervalMilis))},LocalStatsCollector.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},audioLevelFullRange=function(e){var t=parseInt(e/1e3);return[0,1,2,3,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,9,9,9,9,9,9,9,9][t=0==t&&250<e?1:t]||0},!function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,t){var r,n,o=a,i=[];if(t=t||o.length,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n]);return i.join("")},Math.uuidFast=function(){for(var e,t=a,r=new Array(36),n=0,o=0;o<36;o++)8==o||13==o||18==o||23==o?r[o]="-":14==o?r[o]="4":(e=15&(n=n<=2?33554432+16777216*Math.random()|0:n),n>>=4,r[o]=t[19==o?3&e|8:e]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}(),ModuleBase.define("BrowserInfo",[],function(e){return(e=function(){}).prototype.getBrowserInfo=function(){navigator.appVersion;var e,t=navigator.userAgent,r=navigator.appName,n=""+parseFloat(navigator.appVersion),o="",i="",a=(-1!=(e=t.indexOf("OPR/"))?(r="Opera",n=t.substring(e+4)):-1!==(e=t.indexOf("Opera"))?(r="Opera",n=t.substring(e+6),-1!==(e=t.indexOf("Version"))&&(n=t.substring(e+8))):-1!==(e=t.indexOf("MSIE"))?(r="IE",n=t.substring(e+5)):-1!==(e=t.indexOf("FingerBrowser"))?(r="FingerBrowser",n=t.substring(e+14)):-1!==(e=t.indexOf("MicroMessenger"))?(r="MicroMessenger",n=t.substring(e+15,e+20)):-1!==(e=t.indexOf("Chrome"))?(r="Chrome",n=t.substring(e+7)):-1!==(e=t.indexOf("Safari"))?(r="Safari",n=t.substring(e+7),-1!==(e=t.indexOf("Version"))&&(n=t.substring(e+8))):-1!==(e=t.indexOf("UCBrowser"))?(r="UCBrowser",n=t.substring(e+10)):-1!==(e=t.indexOf("baiduboxapp"))?(r="Baiduboxapp",n=t.substring(e+12)):-1!==(e=t.indexOf("Firefox"))?(r="Firefox",n=t.substring(e+8)):-1!==(e=t.indexOf("HeyTapBrowser"))?(r="HeyTapBrowser",n=t.substring(e+8)):(a=t.lastIndexOf(" ")+1)<(e=t.lastIndexOf("/"))&&(r=t.substring(a,e),n=t.substring(e+1),r.toLowerCase()===r.toUpperCase())&&(r=navigator.appName),!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob)),s=(/rv:([^\)]+)\) like Gecko/.test(navigator.userAgent)&&(r="IE",n=RegExp.$1),/QQBrowser/.test(navigator.userAgent)),d=function(e,t){var r,n=window.external||{};for(r in n)if(e.test(t?n[r]:r))return!0;return!1}(/^liebao/i,0),l=/3Tee/.test(navigator.userAgent),u=/web_record/.test(navigator.userAgent);return a&&(e=t.indexOf(r="Edge"),i=t.substring(e+5)),s&&(o="QQ",e=t.indexOf("QQBrowser"),i=t.substring(e+10)),d&&(o="Liebao",i=""),l&&(o="avdrtc",e=t.indexOf("3Tee"),i=t.substring(e+5)),{name:r,fullVersion:n=-1!==(a=(n=-1!==(a=n.indexOf(";"))?n.substring(0,a):n).indexOf(" "))?n.substring(0,a):n,shellName:o,shellFullVersion:i,isCustomized:l,isWebRecord:u}},e}),ModuleBase.define("OSInfo",[],function(e){return(e=function(){}).prototype.getOSInfo=function(){var e="Unknown OS",t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()},getOsName:function(){var e="Unknown OS";return t.Android()&&(e="Android"),t.BlackBerry()&&(e="BlackBerry"),t.iOS()&&(e="iOS"),t.Opera()&&(e="Opera Mini"),e=t.Windows()?"Windows":e}};return t.any()?e=t.getOsName():(-1!==navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!==navigator.appVersion.indexOf("Mac")&&(e="OSX"),-1!==navigator.appVersion.indexOf("X11")&&(e="UNIX"),-1!==navigator.appVersion.indexOf("Linux")&&(e="Linux")),e},e}),ModuleBase.define("CheckGetUserMedia",[],function(e){return(e=function(){}).prototype.getUserMediaSupport=function(){var e=!1;return e=void 0!==navigator.webkitGetUserMedia||void 0!==navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?!0:e},e}),ModuleBase.define("CheckRTCPeerConnection",[],function(e){return(e=function(){}).prototype.RTCPeerConnectionSupport=function(){var e=!1;try{e=["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].some(function(e){return e in window})}catch(e){}return e},e}),ModuleBase.define("CheckDataChannel",[],function(e){return(e=function(){}).prototype.dataChannelSupport=function(){var e=!1;try{var t,r=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;r&&(e="createDataChannel"in(t=new r(null)),t.close())}catch(e){}return e},e}),ModuleBase.define("BrowserDetect",["BrowserInfo","OSInfo","CheckGetUserMedia","CheckRTCPeerConnection","CheckDataChannel"],function(t,r,n,o,i){function e(){this.detect={},location.protocol;var e=new t,e=(this.detect.browser=e.getBrowserInfo(),this.detect.browser["is"+this.detect.browser.name]=!0,this.detect.browser.fullVersion.split(".")[0],new r),e=(this.detect.osName=e.getOSInfo(),navigator.userAgent&&(e=UAParser(navigator.userAgent))&&e.os&&(this.detect.osName=e.os.name,this.detect.osVersion=e.os.version),new n),e=(this.detect.getUserMediaSupport=e.getUserMediaSupport(),new o),e=(this.detect.RTCPeerConnectionSupport=e.RTCPeerConnectionSupport(),new i);this.detect.dataChannelSupport=e.dataChannelSupport(),this.detect.WebSocketSupport="WebSocket"in window&&2===window.WebSocket.CLOSING,this.detect.screenSharingSupport=!1,navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&(this.detect.screenSharingSupport=!0),this.detect.ORTCSupport="undefined"!=typeof RTCIceGatherer,this.detect.isChrome=this.detect.browser.isChrome,this.detect.isOpera=this.detect.browser.isOpera,this.detect.isIE=this.detect.browser.isIE,this.detect.isFirefox=this.detect.browser.isFirefox,this.detect.isSafari=this.detect.browser.isSafari,this.detect.isMicroMessenger=this.detect.browser.isMicroMessenger,this.detect.isUCBrowser=this.detect.browser.isUCBrowser,this.detect.isBaiduboxapp=this.detect.browser.isBaiduboxapp,this.detect.isFingerBrowser=this.detect.browser.isFingerBrowser,this.detect.isWebRecord=this.detect.browser.isWebRecord,this.detect.gpuInfo=getGPUInfo(),this.detect.getEnumerateDevicesSupport=function(){return new Promise(function(e,t){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(){e(!0)}).catch(function(){e(!1)}):e(!1)})}}return e.prototype.checkBrowserSupport=function(){var e=this.detect.browser.isChrome,t=this.detect.browser.isOpera,r=(this.detect.browser.isIE,this.detect.browser.isFirefox),n=this.detect.browser.isSafari,o=this.detect.browser.isMicroMessenger,i=this.detect.browser.isUCBrowser,a=this.detect.browser.isBaiduboxapp,s=this.detect.browser.isFingerBrowser,d=this.detect.browser.fullVersion,l=d.split(".")[0],t=e&&73<=Number(l)||t&&30<=Number(l);return"Android"==this.detect.osName&&(t=e&&73<=Number(l)),r&&86<=Number(l)&&(t=!0),n&&0<=versionStringCompare(d,"12.1.1")&&(t=!0),o&&7<=Number(l)&&(t=!0),i&&(t=!1),a&&5<=Number(l)&&(t=!0),s&&3<=Number(l)&&(t=!0),"iOS"==this.detect.osName&&"Mobile"==this.detect.browser.name&&(t=!0),"iOS"==this.detect.osName&&e&&(console.log("===iphone手机端Chrome浏览器不支持"),t=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("Alitephone")&&(console.log("===android手机端的360极速浏览器Alitephone Browser不支持"),t=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("LieBaoFast")&&(console.log("===android手机端的猎豹浏览器LieBaoFast不支持"),t=!1),"Android"!=this.detect.osName&&"iOS"!=this.detect.osName||-1===navigator.userAgent.indexOf("Mb2345Browser")||(console.log("===手机端2345浏览器不支持"),t=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("HeyTapBrowser")&&(console.log("===oppo手机自带浏览器HeyTapBrowser,虽然内核是Chrome,但本地vidoe控件显示黑屏，固给出SDK不支持的提示"),t=!1),!!(t&&this.detect.getUserMediaSupport&&this.detect.RTCPeerConnectionSupport&&this.detect.WebSocketSupport)},e.prototype.checkBrowserPluginSupport=function(){var e=!1,t=(this.detect.browser.isChrome,this.detect.browser.isOpera,this.detect.browser.isIE),r=(this.detect.browser.isFirefox,this.detect.browser.isSafari,this.detect.browser.isMicroMessenger,this.detect.browser.isUCBrowser,this.detect.browser.isBaiduboxapp,this.detect.browser.isFingerBrowser,this.detect.browser.fullVersion.split(".")[0]);return e=1==t&&10<=Number(r)?!0:e},e.prototype.checkChromeSupportH264=function(){var e=!1,t=this.detect.browser.isChrome,r=(this.detect.browser.name,this.detect.browser.fullVersion.split(".")[0]);return e=1==(1==t&&52<=Number(r))?!0:e},e.prototype.isChrome=function(){},e}),ModuleBase.define("Base",[],function(){function e(e,t){this.id=e,this.name=t,this.status=StreamStatus.init,this.element=null,this.resourceInfo=null,this.ownerId=null,this.track=null,this.mid=null,this.RTCRtpSender=null,this.ssrcStr=null,this.publishKeepAliveTime=null}return e.prototype.setPublishKeepAliveTime=function(e){e&&(this.publishKeepAliveTime=e,log.debug("===Base.setPublishKeepAliveTime(),id:"+this.id+",keepAliveTime:"+e))},e.prototype.getNewStreamByTrack=function(){var e=null;return this.track&&(e=new MediaStream).addTrack(this.track),e},e}),ModuleBase.define("Video",["Base","Error"],function(n,l){function e(e,t,r){n.call(this,e,t),this.roomHandle=r,this.level,this.description,this.resolutionSelect,this.resolution={width:avdEngineHandle.defaultVideoParamsWidth,height:avdEngineHandle.defaultVideoParamsHeight},this.setType=avdEngineHandle.defaultVideoParamsResolutionSetType,this.frameRate=avdEngineHandle.defaultVideoParamsFrameRate,this.aspectRatio=0,this.cameraType,this.maxBandwidth=null,this.clientSetMaxBandwidth=null,this.streamName,this.streamNickName,this.isPubState=!1,this.rtcRtpSenderIntervalId=null,this.spatialLayerActiveList=[],this.spatialLayerActiveDoing=!1,this.currentVideoQuality=null,this.changePublishVideoQualityInterval=null}var u,d,i,a,o;(e.prototype=new n).setLevel=function(e){log.debug("===video.setLevel(),videoId:"+this.id+",level:"+e),this.level=e},e.prototype.setDescription=function(e){log.debug("===video.setDescription(),videoId:"+this.id+",description:"+e),this.description=e,this.saveVideoCustomConfig("description",e)},e.prototype.setStreamName=function(e){log.debug("===video.setStreamName(),videoId:"+this.id+",streamName:"+e),this.streamName=e},e.prototype.setStreamNickName=function(e){log.debug("===video.setStreamNickName(),videoId:"+this.id+",streamNickName:"+e),this.streamNickName=e},e.prototype.setResolution=function(e,t){log.debug("===video.setResolution(),videoId:"+this.id+",resolution:"+e+",resolutionSetType:"+t),this.resolutionSelect=e,this.resolution=Resolution[e],t&&(this.setType=t)},e.prototype.setResolutionWH=function(e,t,r,n){log.debug("===video.setResolutionWH(),videoId:"+this.id+",width:"+e+",height:"+t+",resolutionSetType:"+r),this.resolutionSelect=e;var o={order:1};o.width=e,o.height=t,n||(this.resolution=o,this.saveVideoCustomConfig("width",e),this.saveVideoCustomConfig("height",t),null!=r&&(this.setType=r,this.saveVideoCustomConfig("setType",r)))},e.prototype.setFrameRate=function(e){log.debug("===video.setFrameRate(),videoId:"+this.id+",frameRate:"+e),"string"==typeof e&&(e=Number(e)),this.frameRate=e,this.saveVideoCustomConfig("frameRate",e)},e.prototype.setAspectRatio=function(e){log.debug("===video.setAspectRatio(),videoId:"+this.id+",aspectRatio:"+e),"string"==typeof e&&(e=Number(e)),this.aspectRatio=e,this.saveVideoCustomConfig("aspectRatio",e)},e.prototype.applyConstraints=function(){var e;this.track&&(e=getApplyConstraints(this),this.track.applyConstraints(e))},e.prototype.applyConstraintsWH=function(e,t,r){this.track&&(r=r==ResolutionSetType.ideal?ResolutionSetType.ideal:ResolutionSetType.exact,this.setResolutionWH(e,t,r),e=getApplyConstraints(this),this.track.applyConstraints(e),t=this.maxBandwidth,this.clientSetMaxBandwidth&&(t=this.clientSetMaxBandwidth),this.sendVideoStreamControl(t,this.resolution.width,this.resolution.height))},e.prototype.setBandwidth=function(t){log.debug("===video.setBandwidth(),maxBandwidth:"+t+"Kpbs, videoId:"+this.id+", userId:"+this.ownerId);var r=this;if("RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var e=r.RTCRtpSender;if(e){var n,o=e.getParameters();if(o.encodings?o.encodings==[]&&(o.encodings[0]={}):o.encodings=[{}],t&&0!=t)avdEngineHandle.isFirefox||(1==(n=o.encodings.length)?o.encodings[0].maxBitrate=1e3*t:2==n?(o.encodings[0].maxBitrate=500*t,o.encodings[1].maxBitrate=1e3*t):3==n&&(o.encodings[0].maxBitrate=250*t,o.encodings[1].maxBitrate=500*t,o.encodings[2].maxBitrate=1e3*t)),avdEngineHandle.isFirefox&&(1==(n=o.encodings.length)?o.encodings[0].maxBitrate=1e3*t:2==n?(o.encodings[0].maxBitrate=1e3*t,o.encodings[1].maxBitrate=500*t):3==n&&(o.encodings[0].maxBitrate=1e3*t,o.encodings[1].maxBitrate=500*t,o.encodings[2].maxBitrate=250*t));else for(var i=0;i<o.encodings.length;i++)delete o.encodings[i].maxBitrate;e.setParameters(o).then(function(){r.clientSetMaxBandwidth=t,log.info("===video.setBandwidth(),带宽设置成功,clientSetMaxBandwidth:"+t+"Kpbs, videoId:"+r.id+", userId:"+r.ownerId),r.sendVideoStreamControl(t,r.resolution.width,r.resolution.height)}).catch(function(e){log.error("===video.setBandwidth(),带宽设置失败,clientSetMaxBandwidth:"+t+"Kpbs, videoId:"+r.id+", userId:"+r.ownerId+",error:",e)})}else r.clientSetMaxBandwidth=t,log.debug("===video.setBandwidth(),RTCRtpSender is null,clientSetMaxBandwidth:"+t+"Kpbs, videoId:"+r.id+", userId:"+r.ownerId)}},e.prototype.sendVideoStreamControl=function(r,n,o){log.info("===video.sendVideoStreamControl(),maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", videoId:"+this.id+", nodeId:"+this.roomHandle.selfUser.nodeId);var i=when.defer(),a=this,s=getRandomNum(5e4,51e3),d=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.sendVideoStreamControl(d,r,n,o,s),clearTimeout(u),u=setTimeout(function(){log.error("===video.sendVideoStreamControl(),带宽设置发送服务器端超时. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(new l(ErrorConstant.operate_timeout.code,"VIDEO_STREAM_CONTROL_REQ"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_success,function(e){e==s&&(clearTimeout(u),log.info("===video.sendVideoStreamControl(), 带宽设置发送服务器端成功. maxBandwidth:"+r+"Kpbs,width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.resolve())}),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_error,function(e,t){t==s&&(clearTimeout(u),log.error("===video.sendVideoStreamControl(),带宽设置发送服务器端失败. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(e))})},e.prototype.preview=function(t){log.info("===video.preview()");var r=when.defer(),n=this;return n.track?(n.status!=StreamStatus.published&&(n.status=StreamStatus.opened),(n.element=t).srcObject=n.getNewStreamByTrack(),r.resolve()):obtainUserMedia(null,n).then(function(e){n.track=e.videoStream.getVideoTracks()[0],null==n.roomHandle.selfUser.stream?n.roomHandle.selfUser.stream=e.videoStream:n.roomHandle.selfUser.stream.addTrack(n.track),n.status=StreamStatus.opened,(n.element=t).srcObject=n.getNewStreamByTrack(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.unpreview=function(){log.info("===video.unpreview()");this.element&&(this.element.srcObject=null,this.element=null),this.status=StreamStatus.init},e.prototype.publish=function(e){log.info("===video.publish()");var t,r=when.defer(),n=this;return n.roomHandle.roomJoinState!=RoomStateEnum.CONNECTED&&(t=new l(ErrorConstant.room_state_invalid),log.debug("===video publish() 发布视频流异常, room state: ",n.roomHandle.roomJoinState),r.reject(t)),n.isPubState?(log.debug("===video publish(),isPubState =true to return"),r.resolve()):(n.isPubState=!0,this.publishHandle(null,e).then(function(){log.info("===video publish(),发布视频流成功,Id:"+n.id+",name："+n.name+",ownerId:"+n.ownerId),avdEngineHandle.loggerReport.info("video publish(),发布视频流成功,Id:"+n.id+"，设备名称："+n.name+",ownerId:"+n.ownerId),r.resolve()}).otherwise(function(e){n.isPubState=!1,log.error("===video publish(),发布视频流异常,Id:"+n.id+",name："+n.name+",ownerId:"+n.ownerId+",Error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("video publish(),The published video stream is abnormal , Id:"+n.id+",name："+n.name+",ownerId:"+n.ownerId+",Error:"+JSON.stringify(e)),r.reject(e)})),r.promise},e.prototype.previewAndPublish=function(e,t){log.info("===video.previewAndPublish()");var r=when.defer(),n=this;if(n.roomHandle.roomJoinState==RoomStateEnum.CONNECTED)return avdEngineHandle.loggerReport.debug("previewAndPublish()触发..."),n.isPubState?(log.debug("===video previewAndPublish(),isPubState =true to return"),r.resolve()):(n.isPubState=!0,this.publishHandle(e,t).then(function(){log.info("===video previewAndPublish(),预览摄像头及发布流成功,videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId),avdEngineHandle.loggerReport.info("video previewAndPublish(),预览摄像头及发布流成功,videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId),r.resolve()}).otherwise(function(e){n.isPubState=!1,log.error("===video previewAndPublish(),预览摄像头及发布视频流异常,videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("video previewAndPublish(), Previewing cameras and publishing video streams are abnormal, videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId+",error:"+JSON.stringify(e)),r.reject(e)})),r.promise;(e=ErrorConstant.room_state_invalid).message+="（State: "+n.roomHandle.roomJoinState+"）",t=new l(e),log.debug("===video publish() 发布视频流异常, room state: "+n.roomHandle.roomJoinState),r.reject(t)},e.prototype.publishHandle=function(r,e){var t,n,o=when.defer(),i=getRandomNum(1e4,11e3),a=this,s=a.roomHandle.calInitVideoBitrate(a.resolution.width,a.resolution.height);return a.maxBandwidth=s.maxBit,a.status==StreamStatus.init?a.track?(n=a.roomHandle.setDeviceIdByUUID(0,a.id),t=a.getNewStreamByTrack(),a.roomHandle.masterServer.videoPublishHandle(n,t,i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.init,track!=null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),null!=r&&(a.status=StreamStatus.opened,(a.element=r).srcObject=t),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),log.info("===video previewAndPublish(),callback camera_status_notify,self.track != null, status:"+a.status+",videoId:"+a.id+",videoName："+a.name+",userId:"+a.ownerId),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})):obtainUserMedia(null,a).then(function(e){a.track=e.videoStream.getVideoTracks()[0],null==a.roomHandle.selfUser.stream?a.roomHandle.selfUser.stream=e.videoStream:a.roomHandle.selfUser.stream.addTrack(a.track),a.status=StreamStatus.opened;var t=a.getNewStreamByTrack(),e=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.videoPublishHandle(e,t,i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.init,track==null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),null!=r&&(a.status=StreamStatus.opened,(a.element=r).srcObject=t),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),log.info("===video previewAndPublish(),callback camera_status_notify,self.track= null, status:"+a.status+",videoId:"+a.id+",videoName："+a.name+",userId:"+a.ownerId),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})}).otherwise(function(e){o.reject(e)}):a.status==StreamStatus.opened?a.track?(n=a.roomHandle.setDeviceIdByUUID(0,a.id),a.roomHandle.masterServer.videoPublishHandle(n,a.getNewStreamByTrack(),i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,track!=null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})):obtainUserMedia(null,a).then(function(e){a.track=e.videoStream.getVideoTracks()[0],null==a.roomHandle.selfUser.stream?a.roomHandle.selfUser.stream=e.videoStream:a.roomHandle.selfUser.stream.addTrack(a.track);e=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.videoPublishHandle(e,a.getNewStreamByTrack(),i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,track==null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})}).otherwise(function(e){o.reject(e)}):a.status==StreamStatus.published&&e?(log.debug("===TTTTTTTTT00000000000000"),n=a.roomHandle.setDeviceIdByUUID(0,a.id),a.roomHandle.masterServer.videoPublishHandle(n,a.getNewStreamByTrack(),i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,&& room rejoin or reconnecting),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(log.debug("===video publishHandle(status == StreamStatus.opened,&& && room rejoin or reconnecting),pub_roomresourcemsg_rep_error"),clearTimeout(d),o.reject(e))})):log.debug("===video publishHandle() status: "+a.status),o.promise},e.prototype.unpublish=function(){log.info("===video.unpublish()");var e,r=when.defer(),n=getRandomNum(11001,12e3),o=this;return o.maxBandwidth=null,this.status!=StreamStatus.published&&(this.status!=StreamStatus.init||!this.track&&null==this.track)||(o.isPubState=!1,arrayUtil.objectSplice(o.roomHandle.pubVideos,this.id),this.status=StreamStatus.init,e=o.roomHandle.setDeviceIdByUUID(0,this.id),o.roomHandle.masterServer.videoUnpublishHandle(e,this.getNewStreamByTrack(),n),clearTimeout(i),i=setTimeout(function(){o.isPubState=!1,log.debug("===video unpublish, unpub_roomresourcemsg_rep timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Unpublish video"+ErrorConstant.operate_timeout.message))},3e3),o.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(i),(e=o.roomHandle.selfUser.stream)&&e.getTracks().forEach(function(e){e.id==o.track.id&&e.stop()}),o.element&&((e=o.element.srcObject)&&e.getTracks().forEach(function(e){e.stop()}),o.element.srcObject=null,o.element=null),o.track.stop(),o.track=null,o.roomHandle.currBandwidth=null,log.info("===video unpublish(),取消发布视频流成功,videoId:"+o.id+",videoName："+o.name+",userId:"+o.ownerId),avdEngineHandle.loggerReport.info("video unpublish(),取消发布视频流成功,videoId:"+o.id+",videoName："+o.name+",userId:"+o.ownerId),o.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,o.status,o.id,o.name,o.roomHandle.selfUser.id),setTimeout(function(){r.resolve()},50))}),o.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(i),log.error("===video unpublish, unpub_roomresourcemsg_rep_error,videoId:"+o.id+",videoName："+o.name+",userId:"+o.ownerId),r.reject(e))})),r.promise};return e.prototype.subscrible=function(t){log.info("===video subscrible(),订阅视频流,videoId:"+this.id+",userId:"+this.ownerId+",videoQuality:"+t),avdEngineHandle.loggerReport.info("video subscrible(),订阅视频流,videoId:"+this.id+",userId:"+this.ownerId+",videoQuality:"+t);var r=when.defer(),n=getRandomNum(12001,13e3),o=this;return t?o.roomHandle.masterServer.videoSubscribleHandle(o.resourceInfo,t,n):o.roomHandle.masterServer.videoSubscribleHandle(o.resourceInfo,VideoQualityType.high,n),clearTimeout(a),a=setTimeout(function(){log.debug("===video subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Subscribe video"+ErrorConstant.operate_timeout.message))},3e3),o.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(a),setTimeout(function(){log.info("===video subscrible(),订阅视频流成功,videoId:"+o.id+",userId:"+o.ownerId+",videoQuality:"+t),r.resolve()},50))}),o.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(a),r.reject(e))}),r.promise},e.prototype.unsubscrible=function(){log.info("===video unsubscrible(),取消订阅视频流,videoId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("video unsubscrible(),取消订阅视频流,videoId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(13001,14e3),t=this;return t.roomHandle.masterServer.videoUnsubscribleHandle(t.resourceInfo,n),clearTimeout(o),o=setTimeout(function(){log.debug("===video unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Unsubscribe video"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),setTimeout(function(){log.info("===video unsubscrible(),取消订阅视频流成功,videoId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))}),r.promise},e.prototype.muteCamera=function(){log.info("===video.muteCamera()");var e,t=this;this.status==StreamStatus.published&&(this.status=StreamStatus.muted,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.element&&(e=t.element.srcObject)&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.track&&(t.track.enabled=!1),e=t.roomHandle.setDeviceIdByUUID(0,this.id),t.roomHandle.masterServer.updateWebcamMsg(t.roomHandle.selfUser.nodeId,e,this),log.info("===video muteCamera(),禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("video muteCamera(),禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status))},e.prototype.unmuteCamera=function(){log.info("===video.unmuteCamera()");var e,t=this;this.status==StreamStatus.muted&&(this.status=StreamStatus.published,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.element&&(e=t.element.srcObject)&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.track&&(t.track.enabled=!0),e=t.roomHandle.setDeviceIdByUUID(0,this.id),t.roomHandle.masterServer.updateWebcamMsg(t.roomHandle.selfUser.nodeId,e,this),log.info("===videe unmuteCamera(),取消禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("video unmuteCamera(),取消禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status))},Audio.prototype.ismuteCamera=function(){var e=!1;return e=this.status==StreamStatus.muted?!0:e},e.prototype.changeSubscribedVideoQuality=function(e){this.roomHandle.selfUser.id==this.ownerId?log.debug("===video changeSubscribedVideoQuality(),自己发布的视频不能更改。id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e):(log.debug("===video changeSubscribedVideoQuality(),更改订阅视频的视频质量,id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e),avdEngineHandle.loggerReport.debug("video changeSubscribedVideoQuality(),更改订阅视频的视频质量,id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e),this.roomHandle.masterServer.changeSubscribedVideoQuality(this.resourceInfo,this.quality2Level(e)))},e.prototype.changePublishVideoQuality=function(e){log.info("===video.changePublishVideoQuality(),videoId:"+this.id+",userId:"+this.ownerId+",level:"+e);var t=this;t.currentVideoQuality=e,t.changePublishVideoQualityInterval&&(clearInterval(t.changePublishVideoQualityInterval),t.changePublishVideoQualityInterval=null),t.changePublishVideoQualityInterval=setInterval(function(){t.currentVideoQuality&&t.roomHandle&&(t.changePublishVideoQualityHandle(t.currentVideoQuality),t.currentVideoQuality=null,clearInterval(t.changePublishVideoQualityInterval),t.changePublishVideoQualityInterval=null)},1e3)},e.prototype.changePublishVideoQualityHandle=function(t){var r,e,n,o=this,i=this.level2Quality(t),a=(log.debug("===video.changePublishVideoQualityHandle(),userName:"+o.roomHandle.selfUser.name+",videoId:"+this.id+",level:"+t+",resolution.width:"+this.resolution.width+",resolution.height:"+this.resolution.height),null),a=((a=this.clientSetMaxBandwidth||this.maxBandwidth)&&(r=0,i==VideoQualityType.high?r=a:i==VideoQualityType.normal?r=parseInt(a/2):i==VideoQualityType.low&&(r=parseInt(a/4)),"RTCRtpSender"in window)&&"setParameters"in window.RTCRtpSender.prototype&&(n=this.RTCRtpSender)&&((e=n.getParameters()).encodings?e.encodings==[]&&(e.encodings[0]={}):e.encodings=[{}],a&&0!=a?e.encodings[0]&&(e.encodings[0].maxBitrate=1e3*r):e.encodings[0]&&delete e.encodings[0].maxBitrate,n.setParameters(e).then(function(){log.info("===video.changePublishVideoQualityHandle(),userName:"+o.roomHandle.selfUser.name+",videoId:"+o.id+",level:"+t+",带宽修改成功,maxBandwidth:"+r)}).catch(function(e){log.error("===video.changePublishVideoQualityHandle(),userName:"+o.roomHandle.selfUser.name+",videoId:"+o.id+",level:"+t+",带宽修改失败,maxBandwidth:"+r+",error:",e)})),avdEngineHandle.browserDetect.detect||avdEngineHandle.getBrowserDetect());"iOS"==a.osName&&versionStringCompare(a.browser.fullVersion,"17")<0?log.debug("===video.changePublishVideoQualityHandle(), current os: "+a.osName+" "+a.osVersion+" to ignore"):(n={width:o.resolution.width,height:o.resolution.height},i==VideoQualityType.high?(n.width=o.resolution.width,n.height=o.resolution.height):i==VideoQualityType.normal?320<=o.resolution.width/2||180<=o.resolution.height/2?(n.width=o.resolution.width/2,n.height=o.resolution.height/2):(n.width=320,n.height=180):i==VideoQualityType.low&&(320<=o.resolution.width/4||180<=o.resolution.height/4?(n.width=o.resolution.width/4,n.height=o.resolution.height/4):(n.width=320,n.height=180)),o.adjustVideoResoutionRealTime(n.width,n.height),log.debug("===video.changePublishVideoQualityHandle(),userName:"+o.roomHandle.selfUser.name+",videoId:"+o.id+",level:"+t+",修改视频分辨率, 分辨率宽:"+n.width+"，分辨率高："+n.height))},e.prototype.quality2Level=function(e){var t=3;return e==VideoQualityType.high?t=4:e==VideoQualityType.normal?t=3:e==VideoQualityType.low&&(t=2),t},e.prototype.level2Quality=function(e){VideoQualityType.normal;return 4<=e?VideoQualityType.high:3==e?VideoQualityType.normal:VideoQualityType.low},e.prototype.updateCameraData=function(e,t){log.debug("===video.updateCameraData(),level:"+e+",description:"+t),this.level=e,this.description=t;e=this.roomHandle.setDeviceIdByUUID(0,this.id);this.roomHandle&&this.roomHandle.selfUser&&(this.saveVideoCustomConfig("description",t),this.roomHandle.masterServer.updateWebcamMsg(this.roomHandle.selfUser.nodeId,e,this))},e.prototype.updateExporterStreamName=function(e,t){var r=when.defer();return this.streamName=e,this.streamNickName=t,this.roomHandle.masterServer.updateExporterStreamName(this).then(function(){r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.setMaxSpatialLayer=function(r){var e;avdEngineHandle.simulcastEnabled?this.RTCRtpSender&&((e=this.RTCRtpSender.getParameters()).encodings.forEach(function(e,t){log.debug("===video.setMaxSpatialLayer(),spatialLayer:"+r+",idx:"+t),e.active=t<r}),this.RTCRtpSender.setParameters(e)):log.debug("===video.setMaxSpatialLayer()，设置无效因为simulcastEnabled=false")},e.prototype.setSpatialLayerActive=function(e,t,r){var i,n;avdEngineHandle.isChrome&&73<=avdEngineHandle.majorVersion&&avdEngineHandle.majorVersion<=76?log.debug("===video.setSpatialLayerActive(),chrome版本为73-76，支持多流但不支持服务器下发的各路流active/unactive设置"):(i=this,log.debug("===video.setSpatialLayerActive(),baseActive:"+e+",ass1Active:"+t+",ass2Active:"+r),avdEngineHandle.simulcastEnabled?((n={}).baseActive=e,n.ass1Active=t,n.ass2Active=r,i.spatialLayerActiveList.push(n),setTimeout(function(){var r,n,o;i.spatialLayerActiveDoing||(i.spatialLayerActiveDoing=!0,o=n=r=0,i.spatialLayerActiveList.forEach(function(e){0!=e.baseActive&&(r=e.baseActive),0!=e.ass1Active&&(n=e.ass1Active),0!=e.ass2Active&&(o=e.ass2Active)}),log.debug("===video.setSpatialLayerActive(),baseActiveNew:"+r+",ass1ActiveNew:"+n+",ass2ActiveNew:"+o),i.RTCRtpSender&&(log.debug("===video.setSpatialLayerActive(),RTCRtpSender != null"),i.rtcRtpSenderIntervalId=setInterval(function(){var e=i.RTCRtpSender.getParameters();0<e.encodings.length&&(log.debug("===video.setSpatialLayerActive(),parameters.encodings:",JSON.stringify(e.encodings)),clearInterval(i.rtcRtpSenderIntervalId),i.rtcRtpSenderIntervalId=null,e.encodings.forEach(function(e,t){0==t&&(2==r?(log.debug("===video.setSpatialLayerActive(),baseActive active to true"),e.active=!0):1==r&&(log.debug("===video.setSpatialLayerActive(),baseActive  active to false"),e.active=!1)),1==t&&(2==n?(log.debug("===video.setSpatialLayerActive(),ass1Active active to true"),e.active=!0):1==n&&(log.debug("===video.setSpatialLayerActive(),ass1Active active to false"),e.active=!1)),2==t&&(2==o?(log.debug("===video.setSpatialLayerActive(),ass2Active active to true"),e.active=!0):1==o&&(log.debug("===video.setSpatialLayerActive(),ass2Active active to false"),e.active=!1))}),i.RTCRtpSender.setParameters(e),i.spatialLayerActiveDoing=!1)},200)))},1e3)):log.debug("===video.setSpatialLayerActive()，设置无效因为simulcastEnabled=false"))},e.prototype.attachVideoElementMediaStream=function(e,t){null!=t&&(this.element=e),e&&(e.srcObject=t)},e.prototype.saveVideoCustomConfig=function(e,t){this.roomHandle&&this.roomHandle.selfUser&&(this.roomHandle.selfUser.reJoinVideoId2CustomSet[this.id]||(this.roomHandle.selfUser.reJoinVideoId2CustomSet[this.id]={}),this.roomHandle.selfUser.reJoinVideoId2CustomSet[this.id][e]=t)},e.prototype.adjustVideoResoutionRealTime=function(e,t){isNaN(e)||isNaN(t)||(log.debug("===video.adjustVideoResoutionRealTime, width: "+e," ,height: "+t),this.track&&(e={width:{ideal:parseInt(e)},height:{ideal:parseInt(t)},frameRate:{ideal:this.frameRate},aspectRatio:{ideal:this.aspectRatio}},this.track.applyConstraints(e)))},e}),ModuleBase.define("Audio",["Base","Error"],function(n,a){function e(e,t,r){n.call(this,e,t),this.roomHandle=r,this.audioLevel=0,this.isPubState=!1,this.isMonitorAudioLevel=!1,this.monitorAudioLevelIntervalId=null}var s,i,o,d;return(e.prototype=new n).openMicrophone=function(r){log.info("===audio.openMicrophone()");var n=when.defer(),o=this;if(o.roomHandle.roomJoinState==RoomStateEnum.CONNECTED){var i=getRandomNum(2e4,21e3);if(o.track){var e=o.roomHandle.setDeviceIdByUUID(2,o.id),t=o.getNewStreamByTrack();if(o.isPubState){if(o.status==StreamStatus.published)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true && self.status == StreamStatus.published to return"),n.resolve(),n.promise;if(o.status==StreamStatus.muted)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true && self.status == StreamStatus.muted to audio.unmuteMicrophone()"),o.unmuteMicrophone(),n.resolve(),n.promise}if(o.isPubState)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true  to return"),n.resolve(),n.promise;o.isPubState=!0,o.roomHandle.masterServer.audioPublishHandle(e,t,i),clearTimeout(s),s=setTimeout(function(){o.isPubState=!1,log.debug("===audio openMicrophone(self.track!=null),pub_roomresourcemsg_rep timeout"),n.reject(new a(ErrorConstant.operate_timeout.code,"Release audio"+ErrorConstant.operate_timeout.message))},3e3),o.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(s),o.state=StreamStatus.opened,void 0!==r&&r&&""!=r&&((o.element=r).srcObject=t),o.status=StreamStatus.published,o.roomHandle.hasObject(o.roomHandle.pubAudios,o)||o.roomHandle.pubAudios.push(o),log.info("===audio openMicrophone(),打开音频及发布流成功,callback microphone_status_notify  (self.track!=null),status:"+o.status+",audioId:"+o.id+",userId:"+o.ownerId),avdEngineHandle.loggerReport.info("audio openMicrophone(),打开音频及发布流成功,(self.track!=null),audioId:"+o.id+",userId:"+o.ownerId),o.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,o.status,o.id,o.name,o.roomHandle.selfUser.id),n.resolve())}),o.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(s),o.isPubState=!1,log.error("===audio openMicrophone(),打开音频及发布流失败,(self.track!=null),audioId:"+o.id+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("audio openMicrophone(),Failed to open audio and publish stream,(self.track!=null),audioId:"+o.id+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),n.reject(e))})}else obtainUserMedia(o,null).then(function(e){o.track=e.audioStream.getAudioTracks()[0],null==o.roomHandle.selfUser.stream?o.roomHandle.selfUser.stream=e.audioStream:o.roomHandle.selfUser.stream.addTrack(o.track),o.state=StreamStatus.opened;var e=o.roomHandle.setDeviceIdByUUID(2,o.id),t=o.getNewStreamByTrack();if(o.isPubState)return log.debug("===audio openMicrophone(self.track=null),isPubState =true  to return"),n.resolve(),n.promise;o.isPubState=!0,o.roomHandle.masterServer.audioPublishHandle(e,t,i),clearTimeout(s),s=setTimeout(function(){o.isPubState=!1,log.debug("===audio openMicrophone(self.track==null),pub_roomresourcemsg_rep timeout"),n.reject(new a(ErrorConstant.operate_timeout.code,"Release audio "+ErrorConstant.operate_timeout.message))},3e3),o.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(s),void 0!==r&&r&&""!=r&&((o.element=r).srcObject=t),o.status=StreamStatus.published,o.roomHandle.hasObject(o.roomHandle.pubAudios,o)||o.roomHandle.pubAudios.push(o),log.info("===audio openMicrophone(),打开音频及发布流成功,callback microphone_status_notify (self.track==null),status:"+o.status+",audioId:"+o.id+",userId:"+o.ownerId),avdEngineHandle.loggerReport.info("audio openMicrophone(),打开音频及发布流成功,(self.track==null),audioId:"+o.id+",userId:"+o.ownerId),o.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,o.status,o.id,o.name,o.roomHandle.selfUser.id),n.resolve())}),o.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(s),o.isPubState=!1,log.error("===audio openMicrophone(),打开音频及发布流失败,(self.track==null),audioId:"+o.id+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("audio openMicrophone(),Failed to open audio and publish stream,(self.track==null),audioId:"+o.id+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),n.reject(e))})}).otherwise(function(e){n.reject(e)});return n.promise}(e=ErrorConstant.room_state_invalid).message+="（State: "+o.roomHandle.roomJoinState+"）",e=new a(e),log.debug("===audio.openMicrophone() 发布视频流异常, room state: "+o.roomHandle.roomJoinState),n.reject(e)},e.prototype.closeMicrophone=function(){log.info("===audio.closeMicrophone()");var e,t,r=when.defer(),n=this,o=getRandomNum(21001,22e3);return n.status!=StreamStatus.published&&n.status!=StreamStatus.muted||(n.isPubState=!1,arrayUtil.objectSplice(n.roomHandle.pubAudios,this.id),n.status=StreamStatus.init,n.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,n.status,n.id,n.name,n.roomHandle.selfUser.id),e=n.roomHandle.setDeviceIdByUUID(2,n.id),t=n.getNewStreamByTrack(),n.roomHandle.masterServer.audioUnpublishHandle(e,t,o),clearTimeout(i),i=setTimeout(function(){n.isPubState=!1,log.debug("===audio closeMicrophone,unpub_roomresourcemsg_rep timeout"),r.reject(new a(ErrorConstant.operate_timeout.code,"Unpublish audio"+ErrorConstant.operate_timeout.message))},3e3),n.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==o&&(clearTimeout(i),n.setAudioLevel(0),(e=n.roomHandle.selfUser.stream)&&e.getTracks().forEach(function(e){n.track&&n.track.id==e.id&&e.stop()}),n.element&&((e=n.element.srcObject)&&e.getTracks().forEach(function(e){e.stop()}),n.element.srcObject=null,n.element=null),n.track.stop(),n.track=null,avdEngineHandle.safariInitAudioStream=null,log.info("===audio closeMicrophone(),关闭音频及取消发布流. audioId:"+n.id+",userId:"+n.ownerId),avdEngineHandle.loggerReport.info("audio closeMicrophone(),关闭音频及取消发布流操作. audioId:"+n.id+",userId:"+n.ownerId),setTimeout(function(){r.resolve()},50))}),n.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==o&&(clearTimeout(i),n.isPubState=!1,log.error("===audio closeMicrophone(),关闭音频及发布流失败. audioId:"+n.id+",userId:"+n.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("audio closeMicrophone(),Failed to close the audio and publish stream. audioId:"+n.id+",userId:"+n.ownerId+",error:"+JSON.stringify(e)),r.reject(e))})),r.promise},e.prototype.subscrible=function(){log.info("===audio subscrible(),订阅音频流操作, audioId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("audio subscrible(),订阅音频流操作, audioId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(22001,23e3),t=this;return t.roomHandle.masterServer.audioSubscribleHandle(t.resourceInfo,n),clearTimeout(o),o=setTimeout(function(){log.debug("===audio subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new a(ErrorConstant.operate_timeout.code,"Subscribe to audio"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),setTimeout(function(){log.info("===audio subscrible(),订阅音频流成功,audioId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))}),r.promise},e.prototype.unsubscrible=function(){log.info("===audio unsubscrible(),取消订阅音频流操作，audioId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("audio unsubscrible(),取消订阅音频流操作，audioId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(23001,24e3),t=this;return t.roomHandle.masterServer.audioUnsubscribleHandle(this.resourceInfo,n),clearTimeout(d),d=setTimeout(function(){log.debug("===audio unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new a(ErrorConstant.operate_timeout.code,"Unsubscribe Audio"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(d),setTimeout(function(){log.info("===audio unsubscrible(),取消订阅音频流成功,audioId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(d),r.reject(e))}),r.promise},e.prototype.muteMicrophone=function(){log.info("===audio.muteMicrophone()");var t=this;if(this.status==StreamStatus.published){this.status=StreamStatus.muted,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id);t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.element&&(o=t.element.srcObject)&&o.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.track&&(t.track.enabled=!1);var e=t.roomHandle.traceablePeerConnection.getToMCUPeerConnection().getSenders();if(e)for(var r=0;r<e.length;r++){var n=e[r];n&&n.track&&"audio"==n.track.kind&&n.track.id==t.track.id&&(n.track.enabled=!1)}var o=t.roomHandle.setDeviceIdByUUID(2,this.id);t.roomHandle.masterServer.updateSpeakerMsg(t.roomHandle.selfUser.nodeId,o,this),log.info("===audio muteMicrophone(),禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("audio muteMicrophone(),禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.unmuteMicrophone=function(){log.info("===audio.unmuteMicrophone()");var t=this;if(this.status==StreamStatus.muted){this.status=StreamStatus.published,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id);t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.element&&(o=t.element.srcObject)&&o.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.track&&(t.track.enabled=!0);var e=t.roomHandle.traceablePeerConnection.getToMCUPeerConnection().getSenders();if(e)for(var r=0;r<e.length;r++){var n=e[r];n&&n.track&&"audio"==n.track.kind&&n.track.id==t.track.id&&(n.track.enabled=!0)}var o=t.roomHandle.setDeviceIdByUUID(2,this.id);t.roomHandle.masterServer.updateSpeakerMsg(t.roomHandle.selfUser.nodeId,o,this),log.info("===audio unmuteMicrophone(),取消禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("audio unmuteMicrophone(),取消禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.ismuteMicrophone=function(){var e=!1;return e=this.status==StreamStatus.muted?!0:e},e.prototype.setAudioLevel=function(e){this.audioLevel=e},e.prototype.getAudioLevel=function(){return this.audioLevel},e}),ModuleBase.define("Screen",["Base","Error","ScreenAudio"],function(n,l,e){function t(e,t,r){n.call(this,e,t),this.roomHandle=r,this.level,this.description,this.resolution={width:avdEngineHandle.defaultScreenParamsWidth,height:avdEngineHandle.defaultScreenParamsHeight},this.frameRate=avdEngineHandle.defaultScreenParamsFrameRate,this.maxBandwidth=null,this.clientSetMaxBandwidth=null,this.extensionFlag,this.ipc=null,this.screenAudio=null,this.screenAudioEnabled=!1}var o,i,a,u,s;return(t.prototype=new n).setLevel=function(e){this.level=e},t.prototype.setDescription=function(e){this.description=e},t.prototype.setResolution=function(e,t){var r={};r.width=e,r.height=t,this.resolution=r},t.prototype.setFrameRate=function(e){this.frameRate=e},t.prototype.preview=function(e){log.info("===screen.preview()");e&&(this.element=e,this.element.srcObject=this.getNewStreamByTrack())},t.prototype.getDisplayMedia=function(){log.info("===screen.getDisplayMedia()");var e,n=when.defer(),o=this;return o.status==StreamStatus.published?n.resolve():navigator.mediaDevices.getDisplayMedia?(e={},avdEngineHandle.isChrome&&(e.video={displaySurface:"",frameRate:o.frameRate,width:{ideal:o.resolution.width},height:{ideal:o.resolution.height}},e.audio=!0,96<=avdEngineHandle.majorVersion)&&(e.video.displaySurface="monitor"),log.debug("===screen.getDisplayMedia(),displayMediaConstrains:"+JSON.stringify(e)),navigator.mediaDevices.getDisplayMedia(e).then(function(e){var t,r;e&&(o.track=e.getVideoTracks()[0],t=!1,e&&null!=e.getAudioTracks&&(r=e.getAudioTracks()[0])&&o.screenAudio&&(o.screenAudio.track=r,t=!0),n.resolve({stream:e,audioEnable:t}))}).catch(function(e){log.error("===screen.publish(),Unable to acquire screen capture",e.name+",ownerId:"+o.ownerId);var t=ModuleBase.use(ModulesEnum.error),e="NotSupportedError"==e.name?new t(ErrorConstant.navigatorDisplayMediaError_notSupportedError):"OverconstrainedError"==e.name?new t(ErrorConstant.navigatorDisplayMediaError_overconstrainedError):"NotAllowedError"==e.name?new t(ErrorConstant.navigatorDisplayMediaError_notAllowedError):new t(ErrorConstant.navigatorDisplayMediaError_unknown);n.reject(e)})):(log.debug("===screen.getDisplayMedia(),不支持 navigator.mediaDevices.getDisplayMedia."),avdEngineHandle.loggerReport.error("===screen.getDisplayMedia(),nonsupport navigator.mediaDevices.getDisplayMedia.")),n.promise},t.prototype.publish=function(e){log.info("===screen.publish()...");var t=when.defer(),r=this;if(r.roomHandle.roomJoinState==RoomStateEnum.CONNECTED)return r.status==StreamStatus.published?t.resolve():e?r.publishInner(e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}):r.getDisplayMedia().then(function(e){r.publishInner(e.stream).then(function(){e.audioEnable?r.screenAudio.publish().then(function(){t.resolve()}):t.resolve()}).otherwise(function(e){t.reject(e)})}).otherwise(function(e){t.reject(e)}),t.promise;(e=ErrorConstant.room_state_invalid).message+="（State: "+r.roomHandle.roomJoinState+"）",e=new l(e),log.debug("===video publish() 发布视频流异常, room state: "+r.roomHandle.roomJoinState),t.reject(e)},t.prototype.publishInner=function(e){log.info("===screen.publishInner()");var t,r=when.defer(),n=this;return this.status==StreamStatus.published?r.resolve():(void 0!==(t=e.getTracks()[0]).onended?t.addEventListener("ended",function(){log.debug("===screen track.ended,ownerId:"+n.ownerId),n.unpublish().then(function(){log.info("===screen.unpublish() success."),n.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,n.roomHandle.selfUser.id),n.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1):void 0!==t.oninactive?t.addEventListener("inactive",function(){log.debug("===screen track.inactive,ownerId:"+n.ownerId),n.unpublish().then(function(){log.info("===screen.unpublish() success."),n.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,n.roomHandle.selfUser.id),n.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1):void 0!==e.onended?e.addEventListener("ended",function(e){log.debug("===screen stream.ended,ownerId:"+n.ownerId),n.unpublish().then(function(){log.info("===screen.unpublish() success."),n.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,n.roomHandle.selfUser.id),n.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1):void 0!==e.oninactive&&e.addEventListener("inactive",function(e){log.debug("===screen stream.inactive,ownerId:"+n.ownerId),n.unpublish().then(function(){log.info("===screen.unpublish() success."),n.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,n.roomHandle.selfUser.id),n.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1),n.publishHandleInner(n,e,"").then(function(){r.resolve()}).otherwise(function(e){r.reject(e)})),r.promise},t.prototype.electronPublish=function(e,t,r,n){log.info("===screen.electronPublish()");var o=when.defer();return this.ipc=e,this.ipc.setMaxListeners(50),e&&this.registerElectronIPCInner(n),avdEngineHandle.electronManager.getDesktopSources(t,r).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},t.prototype.electronPrimaryDisplayPublish=function(e){var t=when.defer(),r=this,n=avdEngineHandle.electronManager.getPrimaryDisplay(),n=(log.debug("===electronPrimaryDisplayPublish(),primaryDisplay:",n),"screen:"+n.id);return"win32"==require("os").platform()&&(n="screen:0:0"),log.debug("===electronPrimaryDisplayPublish(),primaryDisplaySourceId:",n),this.publishHandle(n,e).then(function(){log.info("===screen electronPrimaryDisplayPublish(),桌面共享发布流成功,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId),t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.registerElectronIPCInner=function(r){var n=this;this.ipc.once("selectScreenSourceId",function(e,t){log.info("===screen registerElectronIPCInner selectScreenSourceId, sourceId: "+t),n.roomHandle.selfUser.getScreen().publishHandle(t,r).then(function(){log.info("===screen registerElectronIPCInner(),桌面共享发布流成功,Id:"+n.id+",name："+n.name+",ownerId:"+n.ownerId)}).otherwise(function(e){})}),this.ipc.once("stopScreenSharing",function(e){n.roomHandle.selfUser.getScreen().unpublish()})},t.prototype.unpublish=function(){log.info("===screen.unpublish()");var r=when.defer(),t=this,n=getRandomNum(31001,32e3);return t.maxBandwidth=null,t.status==StreamStatus.published&&(t.status=StreamStatus.init,t.roomHandle.masterServer.screenUnpublishHandle(t.id,t.getNewStreamByTrack(),n),clearTimeout(o),o=setTimeout(function(){log.debug("===screen unpublish, unpub_roomresourcemsg_rep  timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Cancel publishing screen sharing"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),arrayUtil.objectSplice(t.roomHandle.pubScreens,t.id),log.info("===screen unpublish(),取消发布桌面共享成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),avdEngineHandle.loggerReport.info("screen unpublish(),取消发布桌面共享成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),setTimeout(function(){t.screenAudio&&t.screenAudio.status==StreamStatus.published?t.screenAudio.unpublish().then(function(){r.resolve()}):r.resolve(),t.track.stop(),t.track=null,t.roomHandle.isMcu()||(t.stream=null)},50))}),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))})),r.promise},t.prototype.subscrible=function(){log.info("===screen subscrible(),订阅桌面共享流,screenId:"+this.id+",userId:",this.ownerId),avdEngineHandle.loggerReport.info("srceen subscrible(),订阅桌面共享流,screenId:"+this.id+",userId:",this.ownerId);var r=when.defer(),n=getRandomNum(32001,33e3),t=this;return t.roomHandle.masterServer.screenSubscribleHandle(t.resourceInfo,n),clearTimeout(i),i=setTimeout(function(){log.debug("===screen subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Subscribe to screen sharing"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(i),setTimeout(function(){log.info("===screen subscrible(),订阅桌面共享流成功,screenId:"+t.id+",userId:",t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(i),r.reject(e))}),r.promise},t.prototype.unsubscrible=function(){log.info("===screen unsubscrible(),取消订阅桌面共享流,screenId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("screen unsubscrible(),取消订阅桌面共享流,screenId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(33001,34e3),t=this;return t.roomHandle.masterServer.screenUnsubscribleHandle(this.resourceInfo,n),clearTimeout(a),a=setTimeout(function(){log.debug("===screen unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Unsubscribe from screen sharing"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(a),setTimeout(function(){log.info("===screen unsubscrible(),取消订阅桌面共享流成功,screenId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(a),r.reject(e))}),r.promise},t.prototype.setBandwidth=function(t){var e,r,n=this;"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&((e=n.RTCRtpSender)?((r=e.getParameters()).encodings?r.encodings==[]&&(r.encodings[0]={}):r.encodings=[{}],t&&0!=t?r.encodings[0].maxBitrate=1e3*t:delete r.encodings[0].maxBitrate,e.setParameters(r).then(function(){n.clientSetMaxBandwidth=t,n.sendVideoStreamControl(t,n.resolution.width,n.resolution.height),log.info("===screen.setBandwidth(),带宽设置成功,clientSetMaxBandwidth:"+t)}).catch(function(e){log.error("===screen.setBandwidth(),带宽设置失败,clientSetMaxBandwidth:"+t+",error:",e)})):(n.clientSetMaxBandwidth=t,n.maxBandwidth=t,log.debug("===screen.setBandwidth(),RTCRtpSender is null,clientSetMaxBandwidth:"+t)))},t.prototype.sendVideoStreamControl=function(r,n,o){log.info("===Screen.sendVideoStreamControl(),maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", videoId:"+this.id+", nodeId:"+this.roomHandle.selfUser.nodeId);var i=when.defer(),a=this,s=getRandomNum(14001,15e3),d=a.roomHandle.setDeviceIdByUUID(0,a.id);return a.roomHandle.masterServer.sendVideoStreamControl(d,r,n,o,s),clearTimeout(u),u=setTimeout(function(){log.error("===Screen.sendVideoStreamControl(),带宽设置发送服务器端超时. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(new l(ErrorConstant.operate_timeout.code,"VIDEO_STREAM_CONTROL_REQ"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_success,function(e){e==s&&(clearTimeout(u),log.info("===Screen.sendVideoStreamControl(), 带宽设置发送服务器端成功. maxBandwidth:"+r+"Kpbs,width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.resolve())}),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_error,function(e,t){t==s&&(clearTimeout(u),log.error("===Screen.sendVideoStreamControl(),带宽设置发送服务器端失败. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(e))}),i.promise},t.prototype.updateScreenData=function(e,t){log.debug("===screen.updateScreenData(),level:"+e+",description:"+t),this.level=e,this.description=t,this.roomHandle&&this.roomHandle.selfUser&&(this.roomHandle.selfUser.reJoinScreenDescription=t,this.roomHandle.masterServer.updateScreenIdMsg(this.roomHandle.selfUser.nodeId,this.id,this))},t.prototype.publishHandle=function(n,o){log.debug("===Screen publishHandle(),sourceId :",n);var i=when.defer(),a=this,e={audio:{mandatory:{chromeMediaSource:"desktop",googEchoCancellation:avdEngineHandle.enableEchoCancellation,googNoiseSuppression:avdEngineHandle.enableNoiseSuppression,googAutoGainControl:avdEngineHandle.enableAutoGainControl,echoCancellation:avdEngineHandle.enableEchoCancellation}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxWidth:a.resolution.width,maxHeight:a.resolution.height,minFrameRate:a.frameRate,maxFrameRate:a.frameRate}}};return o||delete e.audio,log.debug("===Screen publishHandle constraints: ",JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(e){var t,r;log.debug("===Screen publishHandle() webkitGetUserMedia success, gotShareStream.stream: ",e),e&&e.getTracks()&&(t=e.getVideoTracks()[0],o&&(r=e.getAudioTracks()[0])&&a.screenAudio&&(a.screenAudio.track=r,a.screenAudio.publish()),void 0!==t.onended?t.onended=function(){log.debug("screen.publish(),track.onended"),a.track&&(a.unpublish(),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id)),a.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:void 0!==e.onended?e.onended=function(){log.debug("===screen.publish(),stream.onended"),a.track&&(a.unpublish(),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id)),a.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:e.oninactive=function(){log.debug("===screen.publish(),stream.oninactive"),a.track&&(a.unpublish(),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id)),a.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}),a.publishHandleInner(a,e,n,i).then(function(e){i.resolve(e)}).otherwise(function(e){i.reject(e)})}).catch(function(e){log.debug("An error occurred: "+JSON.stringify(e)),i.reject(e),a.ipc&&a.ipc.emit("screen-published-error",e)}),i.promise},t.prototype.publishHandleInner=function(r,e,t){var r=this,n=when.defer(),o=getRandomNum(3e4,31e3),i=r.roomHandle.calInitVideoBitrate(r.resolution.width,r.resolution.height),i=(r.maxBandwidth=i.maxBit,r.track=e.getVideoTracks()[0],null==r.roomHandle.selfUser.screenStream?r.roomHandle.selfUser.screenStream=e:r.roomHandle.selfUser.screenStream.addTrack(r.track),r.getNewStreamByTrack());return r.roomHandle.masterServer.screenPublishHandle(r.id,i,o),clearTimeout(s),s=setTimeout(function(){log.debug("===screen publish,pub_roomresourcemsg_rep_success  timeout"),n.reject(new l(ErrorConstant.operate_timeout.code,"Publishing screen sharing"+ErrorConstant.operate_timeout.message)),r.track&&(r.track.stop(),r.track=null)},3e3),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==o&&(clearTimeout(s),r.status=StreamStatus.published,r.roomHandle.pubScreens.push(r),log.info("===screen publishHandleInner(),桌面共享视频发布流成功,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId),r.ipc&&r.ipc.emit("screen-published"),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),n.resolve(t))}),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&(clearTimeout(s),r.track&&(r.track.stop(),r.track=null),log.info("===screen publishHandleInner(),桌面共享视频发布流失败,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId+", error:",JSON.stringify(e)),r.ipc&&r.ipc.emit("screen-published-error",e),n.reject(e))}),n.promise},t.prototype.attachScreenElementMediaStream=function(e,t){null!=t&&(this.element=e),e&&(e.srcObject=t)},t.prototype.setScreenAudioEnabled=function(e){this.screenAudioEnabled=e},t.prototype.muteScreenAudio=function(){this.screenAudio&&this.screenAudio.muteScreenAudio()},t.prototype.unmuteScreenAudio=function(){this.screenAudio&&this.screenAudio.unmuteScreenAudio()},t}),ModuleBase.define("ScreenAudio",["Base","Error"],function(n,i){function e(e,t,r){n.call(this,e,t),this.roomHandle=r}var o,a,s,d;return(e.prototype=new n).publish=function(){log.info("===screenAudio.publish()");var e,t=when.defer();return this.status==StreamStatus.published?t.resolve():(e=this.getNewStreamByTrack(),this.publishInner(e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)})),t.promise},e.prototype.publishInner=function(e){log.info("===screenAudio.publishInner()");var t,r=when.defer(),n=this;return this.status==StreamStatus.published?r.resolve():(void 0!==(t=e.getAudioTracks()[0]).onended?t.onended=function(){log.debug("===screenAudio.publish(),track.onended"),n.track&&n.unpublish()}:void 0!==e.onended?e.onended=function(){log.debug("===screenAudio.publish(),stream.onended"),n.track&&n.unpublish()}:e.oninactive=function(){log.debug("===screenAudio.publish(),stream.oninactive"),n.track&&n.unpublish()},n.publishHandleInner(n,e,"").then(function(){r.resolve()}).otherwise(function(e){r.reject(e)})),r.promise},e.prototype.unpublish=function(){log.info("===screenAudio.unpublish()");var r=when.defer(),t=this,n=getRandomNum(31001,32e3);return t.maxBandwidth=null,t.status==StreamStatus.published&&(t.status=StreamStatus.init,t.roomHandle.masterServer.screenAudioUnpublishHandle(t.id,t.getNewStreamByTrack(),n),clearTimeout(o),o=setTimeout(function(){log.debug("===screenAudio unpublish, unpub_roomresourcemsg_rep  timeout"),r.reject(new i(ErrorConstant.operate_timeout.code,"取消发布屏幕共享音频流"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),arrayUtil.objectSplice(t.roomHandle.pubScreens,t.id),log.info("===screenAudio unpublish(),取消发布桌面共享音频流成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),avdEngineHandle.loggerReport.info("screenAudio unpublish(),取消发布桌面共享音频流成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),t.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,t.status,t.id,t.name,t.roomHandle.selfUser.id),setTimeout(function(){t.track.stop(),t.track=null,t.roomHandle.isMcu()||(t.stream=null),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))})),r.promise},e.prototype.subscrible=function(){log.info("===screenAudio subscrible(),订阅桌面共享音频流,screenId:"+this.id+",userId:",this.ownerId),avdEngineHandle.loggerReport.info("ScreenAudio subscrible(),订阅桌面共享音频流,screenId:"+this.id+",userId:",this.ownerId);var r=when.defer(),n=getRandomNum(32001,33e3),t=this;return t.roomHandle.masterServer.screenAudioSubscribleHandle(t.resourceInfo,n),clearTimeout(a),a=setTimeout(function(){log.debug("===screenAudio subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new i(ErrorConstant.operate_timeout.code,"订阅屏幕共享音频"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(a),setTimeout(function(){log.info("===screenAudio subscrible(),订阅桌面共享音频流成功,screenId:"+t.id+",userId:",t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(a),r.reject(e))}),r.promise},e.prototype.unsubscrible=function(){log.info("===screenAudio unsubscrible(),取消订阅桌面共享音频流,screenId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("screen unsubscrible(),取消订阅桌面共享音频流,screenId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(33001,34e3),t=this;return t.roomHandle.masterServer.screenAudioUnsubscribleHandle(this.resourceInfo,n),clearTimeout(s),s=setTimeout(function(){log.debug("===screenAudio unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new i(ErrorConstant.operate_timeout.code,"取消订阅屏幕共享音频"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(s),setTimeout(function(){log.info("===screenAudio unsubscrible(),取消订阅桌面共享音频流成功,screenId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(s),r.reject(e))}),r.promise},e.prototype.publishHandleInner=function(r,e,t){var r=this,n=when.defer(),o=getRandomNum(3e4,31e3),e=(r.track=e.getAudioTracks()[0],null==r.roomHandle.selfUser.screenStream?r.roomHandle.selfUser.screenStream=e:r.roomHandle.selfUser.screenStream.addTrack(r.track),r.status=StreamStatus.published,r.getNewStreamByTrack());return r.roomHandle.masterServer.screenAudioPublishHandle(r.id,e,o),clearTimeout(d),d=setTimeout(function(){log.debug("===screen publish,pub_roomresourcemsg_rep_success  timeout"),n.reject(new i(ErrorConstant.operate_timeout.code,"发布屏幕共享音频"+ErrorConstant.operate_timeout.message))},3e3),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==o&&(clearTimeout(d),log.info("===screen publishHandleInner(),桌面共享音频流发布成功,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),n.resolve(t))}),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&(clearTimeout(d),log.info("===screen publishHandleInner(),桌面共享音频流发布失败,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId+"error:",e),n.reject(e))}),n.promise},e.prototype.muteScreenAudio=function(){var e,t=this;this.status==StreamStatus.published&&(this.status=StreamStatus.muted,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.track&&(t.track.enabled=!1),null!=(e=this.getCurrentSender())&&(e.track.enabled=!1,log.info("===screenAudio muteScreenAudio success")),t.roomHandle.masterServer.updateSpeakerMsg(t.roomHandle.selfUser.nodeId,t.id,this),log.info("===screenAudio muteScreenAudio(),禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("===screenAudio muteScreenAudio(),禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status))},e.prototype.unmuteScreenAudio=function(){var e,t=this;this.status==StreamStatus.muted&&(this.status=StreamStatus.published,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.track&&(t.track.enabled=!0),null!=(e=this.getCurrentSender())&&(e.track.enabled=!0,log.info("===screenAudio muteScreenAudio success")),t.roomHandle.masterServer.updateSpeakerMsg(t.roomHandle.selfUser.nodeId,t.id,this),log.info("===screenAudio unmuteScreenAudio(),取消禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("===screenAudio muteScreenAudio(),取消禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status))},e.prototype.getCurrentSender=function(){for(var e=null,t=this.roomHandle.traceablePeerConnection.getToMCUPeerConnection().getSenders(),r=0;r<t.length;r++)t[r].track&&t[r].track.id==this.track.id&&(e=t[r]);return e},e});var currentVideoParameter={videoWidth:!1,videoHeight:!1,frameRate:!1,aspectRatio:!1};function isAndroid(){return-1!=navigator.userAgent.indexOf("Android")}function getPreviousResolution(e){if(!Resolutions[e])return null;var t,r=Resolutions[e].order,n=null,o=null;for(t in Resolutions){var i=Resolutions[t];(null==n||n.order<i.order&&i.order<r)&&(o=t,n=i)}return o}function getConstraints(e,t){var r={audio:!1,video:!1};return e&&(r.audio={}),t&&(r.video={width:{},height:{},frameRate:{}}),r.audio&&(r.audio.echoCancellation=avdEngineHandle.enableEchoCancellation,r.audio.noiseSuppression=avdEngineHandle.enableNoiseSuppression,r.audio.autoGainControl=avdEngineHandle.enableAutoGainControl,e.id)&&"undefined"!=e.id&&(r.audio.deviceId={exact:e.id}),r.video&&t.id&&"undefined"!=t.id&&(r.video.deviceId={exact:t.id}),t&&(t.resolution&&setResolutionConstraints(r,t.resolution,t.setType),t.frameRate&&setFrameRateConstraints(r,t.frameRate),0<t.aspectRatio)&&setAspectRatioConstraints(r,t.aspectRatio),r}function getApplyConstraints(e){var t={};return e&&(t.video={width:{},height:{},frameRate:{}}),t&&e.id&&"undefined"!=e.id&&(t.video.deviceId={exact:e.id}),e&&(e.resolution&&setApplyResolutionConstraints(t,e.resolution,e.setType),e.frameRate&&setApplyFrameRateConstraints(t,e.frameRate),0<e.aspectRatio)&&setApplyAspectRatioConstraints(t,e.aspectRatio),t}function setResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.video.width={ideal:t.width},e.video.height={ideal:t.height}):(e.video.width={exact:t.width},e.video.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setApplyResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.width={ideal:t.width},e.height={ideal:t.height}):(e.width={exact:t.width},e.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setFrameRateConstraints(e,t){e.video.frameRate={ideal:t},currentVideoParameter.frameRate=t}function setApplyFrameRateConstraints(e,t){e.frameRate={ideal:t},currentVideoParameter.frameRate=t}function setAspectRatioConstraints(e,t){e.video.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t}function setApplyAspectRatioConstraints(e,t){e.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t}function obtainUserMedia(e,t){var r=when.defer();return getUserMediaWithConstraints(e,t).then(function(e){r.resolve(handleLocalStream(e))}).otherwise(function(e){r.reject(e)}),r.promise}function getUserMediaWithConstraints(t,r){var n=when.defer(),e=getConstraints(t,r);return log.info("===streamUtil.getUserMediaWithConstraints(),constraints:"+JSON.stringify(e)),r&&log.debug("===streamUtil.getUserMediaWithConstraints(),video getUserMedia Start"),t&&log.debug("===streamUtil.getUserMediaWithConstraints(),audio getUserMedia Start"),navigator.mediaDevices.getUserMedia(e).then(function(e){r&&log.debug("===streamUtil.getUserMediaWithConstraints(),video getUserMedia opened"),t&&log.debug("===streamUtil.getUserMediaWithConstraints(),audio getUserMedia opened"),n.resolve(e)}).catch(function(e){var t=ModuleBase.use(ModulesEnum.error),e="NotSupportedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new t(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new t(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notFoundError):new t(ErrorConstant.navigatorUserMediaError_unknown);n.reject(e)}),n.promise}function handleLocalStream(e){var t=new MediaStream,r=new MediaStream;if(e){for(var n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);for(var i=e.getVideoTracks(),o=0;o<i.length;o++)r.addTrack(i[o])}return{audioStream:t,videoStream:r}}var fakeVideoConstraints={video:!0,fake:!0},fakeAudioConstraints={audio:!0,fake:!0};function getFakeVideoStream(t){navigator.mediaDevices.getUserMedia(fakeVideoConstraints).then(function(e){t(e)}).catch(function(e){})}function getFakeAudioStream(t){navigator.mediaDevices.getUserMedia(fakeAudioConstraints).then(function(e){t(e)}).catch(function(e){})}function getAllAudioVideoDevices(t,e){var o,i,a,s,d,l;!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(o=[],i=[],a=[],s=[],d=[],l=[],navigator.enumerateDevices(function(e){e.forEach(function(e){var t,r,n={};for(t in e)n[t]=e[t];o.forEach(function(e){e.id===n.id&&(r=!0)}),r||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label||(n.label="Please invoke getUserMedia once."),"audioinput"!==n.kind&&"audio"!==n.kind||s.push(n),"audiooutput"===n.kind&&d.push(n),"videoinput"!==n.kind&&"video"!==n.kind||l.push(n),-1!==n.kind.indexOf("audio")&&i.push(n),-1!==n.kind.indexOf("video")&&a.push(n),o.push(n))}),t&&t({allMdiaDevices:o,allVideoDevices:a,allAudioDevices:i,videoInputDevices:l,audioInputDevices:s,audioOutputDevices:d})})):e(null,"Neither navigator.mediaDevices.enumerateDevices NOR MediaStreamTrack.getSources are available.")}function captureUserMedia(e,t,r){navigator.mediaDevices.getUserMedia(e).then(t)}function saveLog(e,t,r){var n=document.location.protocol,n=(n="httpsionic:"==n?"https:":n)+"//"+logAjax.server+"/write?db="+logAjax.db+"&u="+logAjax.userName+"&p="+logAjax.password,o=("undefined"!=typeof returnCitySN&&(cip=returnCitySN.cip),(new Date).getTime(),""),i="",a="",s="",d=0,o=(room&&(room.id&&(o=room.id),room.selfUser)&&(room.selfUser.name&&(i=room.selfUser.name),room.selfUser.id)&&(a=room.selfUser.id),avdEngineHandle.browserDetect&&avdEngineHandle.browserDetect.detect&&avdEngineHandle.browserDetect.detect.browser&&(avdEngineHandle.browserDetect.detect.browser.name&&(s=avdEngineHandle.browserDetect.detect.browser.name),avdEngineHandle.browserDetect.detect.browser.fullVersion)&&(d=avdEngineHandle.browserDetect.detect.browser.fullVersion),'js_log host_ip="'+cip+'",roomId="'+o+'",userName="'+i+'",userId="'+a+'",browserName="'+s+'",browserVersion="'+d+'",level="'+e+'",msg="'+t+'" ');$.ajax({type:"post",url:n,timeout:5e3,data:o,success:function(e){},error:function(e,t,r){}})}navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)}),ModuleBase.define("RestServer",["Error"],function(s){function e(e){e&&(avdEngineHandle.restServerInfo.protocolStr=e)}var d=axios.create({baseURL:"",timeout:1e4,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}});return e.prototype.getServerinfo=function(e,t,r,n){var o,i=when.defer(),e=("httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:"),avdEngineHandle.restServerInfo.protocolStr+"//"+e+"/sdk/config/serverinfo"),a={params:{uri_encode:"yes",client_info:{access_tocken:t},is_use_cascade:r,room_id:n}};return avdEngineHandle.customerTokenEnabled?((o=d.defaults.headers).Authorization="Bearer "+t,a={params:{uri_encode:"yes",client_info:{},is_use_cascade:r,room_id:n}}):(o=d.defaults.headers).hasOwnProperty("Authorization")&&(o.Authorization=""),this.fetchGet(e,a).then(function(e){log.debug("===restServer.getServerinfo(),serverinfo:"+JSON.stringify(e)),avdEngineHandle.connectionStatisticsConfig=e.statistic_config||{},avdEngineHandle.connectionStatisticsConfig.open_statistic=e.open_statistic||0,avdEngineHandle.connectionStatisticsConfig.trace_id=e.trace_id||"",avdEngineHandle.loggerReportConfig=e.logger_config||{},avdEngineHandle.loggerReportConfig.open_logger=e.open_logger||0,avdEngineHandle.loggerReportConfig.trace_id=e.trace_id||"",avdEngineHandle.restServerInfo.roomServerUrl=e.room_server.uri,avdEngineHandle.restServerInfo.iceServers=e.ice_servers,avdEngineHandle.restServerInfo.iceServers&&0<avdEngineHandle.restServerInfo.iceServers.length&&(avdEngineHandle.restServerInfo.stunUrl=avdEngineHandle.restServerInfo.iceServers[0].url,avdEngineHandle.restServerInfo.trunUrl=avdEngineHandle.restServerInfo.iceServers[1].url,avdEngineHandle.restServerInfo.iceusername=avdEngineHandle.restServerInfo.iceServers[1].username,avdEngineHandle.restServerInfo.iceCredential=avdEngineHandle.restServerInfo.iceServers[1].credential),!e.is_cluster||"true"!=e.is_cluster&&1!=e.is_cluster||(avdEngineHandle.restServerInfo.isCluster=!0),!e.not_query_get_mcu||"true"!=e.not_query_get_mcu&&1!=e.not_query_get_mcu||(avdEngineHandle.restServerInfo.notQueryGetMcu=!0),e.master_version&&(avdEngineHandle.restServerInfo.masterVersion=e.master_version),e.master_package_version&&(avdEngineHandle.restServerInfo.masterPackageVersion=e.master_package_version),e.box_version&&(avdEngineHandle.restServerInfo.boxVersion=e.box_version),e.box_package_version&&(avdEngineHandle.restServerInfo.boxPackageVersion=e.box_package_version),avdEngineHandle.supperStrongWeakNetWork=function(e){var t=!1;e&&0<=versionStringCompare(e,"3.1.6")&&(t=!0);t||log.info("当前服务器版本不支持强弱网抗丢包功能，客户端也将不启用支持强网抗丢包能力。");return t}(e.box_version),e.signal_data&&(avdEngineHandle.restServerInfo.signalData=e.signal_data),i.resolve()}).catch(function(e){e=new s(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.getMcu=function(e,t,r){var n,o=when.defer(),i=(avdEngineHandle.loggerReport.info("===restServer.getMcu(),调度服务器地址:"+avdEngineHandle.restServerInfo.mcuServerUrl),"httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:"),avdEngineHandle.restServerInfo.protocolStr+"//"+avdEngineHandle.restServerInfo.mcuServerUrl+"/sdk/get_mcu"),a={params:{room_id:e,token:t,is_use_cascade:r}};return avdEngineHandle.customerTokenEnabled?((n=d.defaults.headers).Authorization="Bearer "+t,a={params:{room_id:e,is_use_cascade:r}}):(n=d.defaults.headers).hasOwnProperty("Authorization")&&(n.Authorization=""),log.info("===restServer.getMcu(),avdEngineHandle.mcuClusterRouteParams:"+avdEngineHandle.mcuClusterRouteParams),avdEngineHandle.mcuClusterRouteParams&&(a.params.options=avdEngineHandle.mcuClusterRouteParams,log.info("===restServer.getMcu(), getMcuUrl(带mcuClusterRouteParams):"+a.params.options)),this.fetchGet(i,a).then(function(e){log.debug("===restServer.getMcu(),mcuAddr:"+JSON.stringify(e));var t=e.ret;0==t?(avdEngineHandle.restServerInfo.roomServerUrl=e.addr,avdEngineHandle.restServerInfo.clusterRestAddr=e.cluster_rest_addr,log.info("===restServer.getMcu(),mcuAddr.addr:"+e.addr),avdEngineHandle.loggerReport.info("===restServer.getMcu(),mcuAddr.cluster_rest_addr:"+e.cluster_rest_addr),o.resolve()):(t=new s(t,e.msg),o.reject(t))}).catch(function(e){console.log(e);e=new s(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.getMcuWithOEM=function(e,t){var r=when.defer(),n=("httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:"),avdEngineHandle.restServerInfo.protocolStr+"//"+avdEngineHandle.restServerInfo.mcuServerUrl+"/sdk/get_mcu");return this.fetchGet(n,{params:{room_id:e,access_token:t}}).then(function(e){var t=e.ret;0==t?(avdEngineHandle.restServerInfo.roomServerUrl=e.addr,avdEngineHandle.restServerInfo.clusterRestAddr=e.cluster_rest_addr,avdEngineHandle.accessToken=e.access_token,log.info("===restServer.getMcuWithOEM(), roomServerUrl:"+e.addr+",accessToken："+e.access_token),r.resolve()):(t=new s(t,e.msg),r.reject(t))}).catch(function(e){e=new s(e.code,e.message);return r.reject(e),!1}),r.promise},e.prototype.getMqttWSAddr=function(e,t){var r,n=when.defer(),e=("httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:"),avdEngineHandle.restServerInfo.protocolStr+"//"+e+"/sdk/mqtt/serverinfo"),o={params:{token:t}};return avdEngineHandle.customerTokenEnabled?((r=d.defaults.headers).Authorization="Bearer "+t,o={params:{}}):(r=d.defaults.headers).hasOwnProperty("Authorization")&&(r.Authorization=""),this.fetchGet(e,o).then(function(e){var t,r=e.ret;0==r?(t=e.data.mqtt_ws_addr,log.info("===restServer.getMqttWSAddr(), mqttWSAddr:"+t),n.resolve(t)):(t=new s(r,e.msg),n.reject(t))}).catch(function(e){e=new s(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.uploadFile=function(e,t){var r,n=when.defer(),o=("httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:"),avdEngineHandle.restServerInfo.protocolStr+"//"+avdEngineHandle.restServerInfo.mcuServerUrl+"/uploadfile?token="+e),e=(avdEngineHandle.customerTokenEnabled?((r=d.defaults.headers).Authorization="Bearer "+e,o=avdEngineHandle.restServerInfo.protocolStr+"//"+avdEngineHandle.restServerInfo.mcuServerUrl+"/uploadfile"):(r=d.defaults.headers).hasOwnProperty("Authorization")&&(r.Authorization=""),new FormData);return e.append("file",t),this.fetchPost(o,e).then(function(e){log.debug("===restServer.uploadFile(),fileObj:"+JSON.stringify(e));var t=e.ret;0==t?(downloadUrl=e.download_url,n.resolve(downloadUrl)):(t=new s(t,e.msg),n.reject(t))}).catch(function(e){e=new s(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.fetchGet=function(e,n){return new Promise(function(t,r){d.get(e,n).then(function(e){0===e.data.ret?t(e.data):(e={code:e.data.ret,message:e.data.msg},r(e))}).catch(function(e){var t;t=e.response?new s(e.response.status,e.response.data):new s(1e4,e.message),r(t),r(e)})})},e.prototype.fetchPost=function(e,n){return new Promise(function(t,r){d.post(e,n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){0===e.data.ret?t(e.data):(e={code:e.data.ret,message:e.data.msg},r(e))}).catch(function(e){var t;t=e.response?new s(e.response.status,e.response.data):new s(1e4,e.message),r(t),r(e)})})},e}),ModuleBase.define("MasterServer",["CmdProtobufCoded","TraceablePeerConnection","Error"],function(r,n,_){function e(e,t){this.signalingChannel=e,this.roomHandle=t,this.cmdProtobufCoded=new r,this.roomPduType=this.cmdProtobufCoded.getRoomPduTypeEnum(),this.mediaType=this.cmdProtobufCoded.getMediaTypeEnum(),this.sessionType=this.cmdProtobufCoded.getSessionTypeEnum(),this.resourceStatus=this.cmdProtobufCoded.getResourceStatusEnum(),this.resourceOpt=this.cmdProtobufCoded.getResourceOptEnum(),this.userMsgOpt=this.cmdProtobufCoded.getUserMsgOptEnum(),this.cameraType=this.cmdProtobufCoded.getCameraTypeEnum(),this.lineArrow=this.cmdProtobufCoded.getLineArrowEnum(),this.annotationType=this.cmdProtobufCoded.getAnnotationTypeEnum(),this.exporterType=this.cmdProtobufCoded.getExporterTypeEnum(),this.dataCryptoType=this.cmdProtobufCoded.getDataCryptoTypeEnum(),this.outGoingViewLayoutMode=this.cmdProtobufCoded.getOutGoingViewLayoutMode(),this.traceablePeerConnection=new n(t),this.roomHandle.traceablePeerConnection=this.traceablePeerConnection,this.traceablePeerConnection.getToMCUPeerConnection()}function m(t,i){var e,a=i.payloads.split(" "),r=[];t.includes("rtx")||"video"==i.type&&(i.rtp.forEach(function(e){t.includes(e.codec)||r.push(e)}),r.length%2==1)&&(arrayUtil.baseSplice(a,(e=r[r.length-1]).payload),arrayUtil.baseSplice(i.rtp,e)),t.forEach(function(o){i.rtp.forEach(function(e){if(e.codec==o){var t=e.payload;if(delete i.rtp[r],a.forEach(function(e){e==t&&arrayUtil.baseSplice(a,t)}),i.fmtp.forEach(function(e){e.config!="apt="+t&&e.payload!=t||arrayUtil.baseSplice(i.fmtp,e)}),i.rtcpFb)for(var r=0;r<i.rtcpFb.length;r++){var n=i.rtcpFb[r];n.payload==t&&(arrayUtil.baseSplice(i.rtcpFb,n),r--)}}})}),i.payloads=a.join(" ")}function o(){var e=0;return e=avdEngineHandle.restServerInfo.isCluster?1:e}return e.prototype.openReqSend=function(){var e,n=this;n.roomHandle.versionToServer&&n.roomHandle.audioCodecPayloadMap?(n.roomHandle.answerRemoteSdp=n.roomHandle.remoteSdpTemplate,e=o(),log.debug("===masterServer.openReqSend(),000000,isClusterOfPDU:"+e),avdEngineHandle.loggerReportConfig&&avdEngineHandle.loggerReportConfig.trace_id&&avdEngineHandle.loggerReportConfig.trace_id,e=n.cmdProtobufCoded.newOpenReq(10,avdEngineHandle.accessToken,"",n.roomHandle.versionToServer,"",e,n.roomHandle.audioCodecPayloadMap),e=n.cmdProtobufCoded.encodedPacket(n.roomPduType.OPEN_REQ,0,0,0,e),log.info("===masterServer.openReqSend(),000000,Send PDU OPEN_REQ"),avdEngineHandle.loggerReport.info("masterServer.openReqSend(),000000,Send PDU OPEN_REQ"),n.signalingChannel.send(e)):function(u){var c=when.defer(),p=["red","ulpfec","rtx","flexfec-03"];avdEngineHandle.supperStrongWeakNetWork&&(p=["red","ulpfec","flexfec-03"]);var h=["red","telephone-event"],f=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e={offerToReceiveAudio:1,offerToReceiveVideo:1};avdEngineHandle.isFirefox||(f.addTransceiver("audio",{direction:"inactive"}),f.addTransceiver("video",{direction:"inactive"}),e={});return f.createOffer(e).then(function(e){log.debug("===masterServer.sdpPretreatment(),createOffer sessionDescription.sdp:"+e.sdp);var t=getIceInfoBySDP(e.sdp),t=(log.debug("===masterServer.sdpPretreatment(), ice-ufrag:"+t.ufrag+", ice-pwd:"+t.pwd),u.iceUfrag=t.ufrag,u.icePwd=t.pwd,e.sdp=e.sdp.replace(/packetization-mode=0/g,"packetization-mode=1"),new SDPTransform),r=t.parse(e.sdp),g=new Map,y=[],s=(r.media.forEach(function(e){if("video"==e.type){for(var t=0;t<e.fmtp.length;t++){var r=e.fmtp[t];g.get(r.config)?y.push(r):g.set(r.config,r.payload)}for(var n=0;n<y.length;n++)for(var o=y[n],i=0;i<e.fmtp.length;i++)if((r=e.fmtp[i])&&r.payload==o.payload){delete e.fmtp[i],m=f=h=p=c=u=a=l=d=s=void 0;for(var a,s=e,d=o.payload,l=d,u=0;u<s.fmtp.length;u++){var c=s.fmtp[u];c&&c.payload==l&&(arrayUtil.baseSplice(s.fmtp,c),u--),c&&c.config=="apt="+l&&(a=c.payload,arrayUtil.baseSplice(s.fmtp,c),u--)}for(u=0;u<s.rtp.length;u++){var p=s.rtp[u];!p||p.payload!=l&&p.payload!=a||(arrayUtil.baseSplice(s.rtp,p),u--)}if(s.rtcpFb)for(u=0;u<s.rtcpFb.length;u++){var h=s.rtcpFb[u];h.payload==l&&(arrayUtil.baseSplice(s.rtcpFb,h),u--)}for(var f=s.payloads.split(" "),u=0;u<f.length;u++){var m=f[u];m!=l&&m!=a||arrayUtil.baseSplice(f,l)}s.payloads=f.join(" ")}}}),r.media.forEach(function(e){"video"==e.type?(u.codecPayloadVP8=[],u.codecPayloadVP9=[],u.codecPayloadH264=[],u.codecPayloadAV1=[],e.rtp.forEach(function(e){"VP8"==e.codec?u.codecPayloadVP8.push(e.payload):"VP9"==e.codec?u.codecPayloadVP9.push(e.payload):"H264"==e.codec?u.codecPayloadH264.push(e.payload):"AV1"==e.codec&&u.codecPayloadAV1.push(e.payload)})):"audio"==e.type&&(u.codecPayloadOpus=[],u.codecPayloadISAC_16K=[],u.codecPayloadISAC_32K=[],u.codecPayloadG722=[],u.codecPayloadPCMU=[],u.codecPayloadPCMA=[],u.codecPayloadCN_8k=[],u.codecPayloadCN_16k=[],u.codecPayloadCN_32k=[],e.rtp.forEach(function(e){"opus"==e.codec?u.codecPayloadOpus.push(e.payload):"ISAC"==e.codec&&16e3==e.rate?u.codecPayloadISAC_16K.push(e.payload):"ISAC"==e.codec&&32e3==e.rate?u.codecPayloadISAC_32K.push(e.payload):"G722"==e.codec?u.codecPayloadG722.push(e.payload):"PCMU"==e.codec?u.codecPayloadPCMU.push(e.payload):"PCMA"==e.codec?u.codecPayloadPCMA.push(e.payload):"CN"==e.codec&&8e3==e.rate?u.codecPayloadCN_8k.push(e.payload):"CN"==e.codec&&16e3==e.rate?u.codecPayloadCN_16k.push(e.payload):"CN"==e.codec&&32e3==e.rate&&u.codecPayloadCN_32k.push(e.payload)}))}),"102"),n=getPayloadByProfileLevel(e.sdp,avdEngineHandle.enableHardwareEncoding),o=(n&&(s=n),log.debug("===masterServer.sdpPretreatment(), currpayloadH264:"+s),0);if(u.codecPayloadH264&&0<u.codecPayloadH264.length){for(var i=0;i<u.codecPayloadH264.length;i++)if(u.codecPayloadH264[i]==s){o=i;break}0<o&&(n=u.codecPayloadH264[0],u.codecPayloadH264[0]=s,u.codecPayloadH264[o]=n)}var a="js_v"+avdEngineHandle.avdVersion+" ";if(u.codecPayloadVP8&&0<u.codecPayloadVP8.length)for(i=0;i<u.codecPayloadVP8.length;i++)a=a+"vp8:"+u.codecPayloadVP8[i]+",";if(u.codecPayloadVP9&&0<u.codecPayloadVP9.length)for(i=0;i<u.codecPayloadVP9.length;i++)a=a+"vp9:"+u.codecPayloadVP9[i]+",";if(u.codecPayloadH264&&0<u.codecPayloadH264.length)for(i=0;i<u.codecPayloadH264.length;i++){var d=",";i==u.codecPayloadH264.length-1&&(d=""),a=a+"h264:"+u.codecPayloadH264[i]+d}var l="";if(u.codecPayloadISAC_16K&&0<u.codecPayloadISAC_16K.length)for(i=0;i<u.codecPayloadISAC_16K.length;i++)l=l+"isac_16k:"+u.codecPayloadISAC_16K[i]+",";if(u.codecPayloadISAC_32K&&0<u.codecPayloadISAC_32K.length)for(i=0;i<u.codecPayloadISAC_32K.length;i++)l=l+"isac_32k:"+u.codecPayloadISAC_32K[i]+",";if(u.codecPayloadOpus&&0<u.codecPayloadOpus.length)for(i=0;i<u.codecPayloadOpus.length;i++)l=l+"opus:"+u.codecPayloadOpus[i]+",";if(u.codecPayloadG722&&0<u.codecPayloadG722.length)for(i=0;i<u.codecPayloadG722.length;i++)l=l+"g722:"+u.codecPayloadG722[i]+",";if(u.codecPayloadPCMU&&0<u.codecPayloadPCMU.length)for(i=0;i<u.codecPayloadPCMU.length;i++)l=l+"pcmu:"+u.codecPayloadPCMU[i]+",";if(u.codecPayloadPCMA&&0<u.codecPayloadPCMA.length)for(i=0;i<u.codecPayloadPCMA.length;i++)l=l+"pcma:"+u.codecPayloadPCMA[i]+",";if(u.codecPayloadCN_8k&&0<u.codecPayloadCN_8k.length)for(i=0;i<u.codecPayloadCN_8k.length;i++)l=l+"cn_8k:"+u.codecPayloadCN_8k[i]+",";if(u.codecPayloadCN_16k&&0<u.codecPayloadCN_16k.length)for(i=0;i<u.codecPayloadCN_16k.length;i++)l=l+"cn_16k:"+u.codecPayloadCN_16k[i]+",";if(u.codecPayloadCN_32k&&0<u.codecPayloadCN_32k.length)for(i=0;i<u.codecPayloadCN_32k.length;i++){d=",";i==u.codecPayloadCN_32k.length-1&&(d=""),l=l+"cn_32k:"+u.codecPayloadCN_32k[i]+d}e.sdp=t.writer(r);n=new SDPTransform,t=n.parse(e.sdp),t.media.forEach(function(e){if("video"==e.type){e.ext=[],e.ext.push({value:2,uri:"urn:ietf:params:rtp-hdrext:toffset"}),e.ext.push({value:3,uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),avdEngineHandle.supperStrongWeakNetWork||e.ext.push({value:5,uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),m(p,e);for(var t=e.payloads.split(" "),r=0;r<t.length;r++){var n=t[r];avdEngineHandle.videoCoding==VideoCodingType.VP8?a=u.codecPayloadVP8[0]:avdEngineHandle.videoCoding==VideoCodingType.VP9?a=u.codecPayloadVP9[0]:avdEngineHandle.videoCoding==VideoCodingType.H264&&(a=s),n==a&&(i=r)}var o=t[0];t[0]=a,t[i]=o,e.payloads=t.join(" "),e.ssrcs=[],u.videoMediaTemplate=e}else if("audio"==e.type){e.ext=[],e.ext.push({value:1,uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"}),m(h,e);for(var i,t=e.payloads.split(" "),r=0;r<t.length;r++){var a,n=t[r];avdEngineHandle.audioCoding==AudioCodingType.opus?a=u.codecPayloadOpus[0]:avdEngineHandle.audioCoding==AudioCodingType.ISAC_16k?a=u.codecPayloadISAC_16K[0]:avdEngineHandle.audioCoding==AudioCodingType.ISAC_32k?a=u.codecPayloadISAC_32K[0]:avdEngineHandle.audioCoding==AudioCodingType.G722?a=u.codecPayloadG722[0]:avdEngineHandle.audioCoding==AudioCodingType.PCMA?a=u.codecPayloadPCMA[0]:avdEngineHandle.audioCoding==AudioCodingType.PCMU&&(a=u.codecPayloadPCMU[0]),n==a&&(i=r)}o=t[0];t[0]=a,t[i]=o,e.payloads=t.join(" "),e.ssrcs=[],u.audioMediaTemplate=e}}),e.sdp=n.writer(t),u.remoteSdpTemplate=e.sdp,f.close(),r={version:u.versionToServer=a,audioCodecPayloadMap:u.audioCodecPayloadMap=l};c.resolve(r)}).catch(function(e){log.error("===masterServer.sdpPretreatment(),temp PC createOffer error:"+e.toString()),c.reject(e)}),c.promise}(n.roomHandle).then(function(e){var t=e.version,e=e.audioCodecPayloadMap,r=(log.info("===masterServer.openReqSend(),version:"+t),log.info("===masterServer.openReqSend(),audioCodecPayloadMap:"+e),n.roomHandle.answerRemoteSdp=n.roomHandle.remoteSdpTemplate,o()),t=(log.debug("===masterServer.openReqSend(),isClusterOfPDU:"+r),avdEngineHandle.loggerReportConfig&&avdEngineHandle.loggerReportConfig.trace_id&&avdEngineHandle.loggerReportConfig.trace_id,n.cmdProtobufCoded.newOpenReq(10,avdEngineHandle.accessToken,"",t,"",r,e)),r=n.cmdProtobufCoded.encodedPacket(n.roomPduType.OPEN_REQ,0,0,0,t);log.info("===masterServer.openReqSend(), Send PDU OPEN_REQ"),avdEngineHandle.loggerReport.info("masterServer.openReqSend(), Send PDU OPEN_REQ"),n.signalingChannel.send(r)}).otherwise(function(e){log.error("===masterServer.openReqSend(),sdpPretreatment() error:",JSON.stringify(e))})},e.prototype.openReqReconnectionSend=function(){var e=o(),e=(log.debug("===masterServer.openReqReconnectionSend(),isClusterOfPDU:"+e),this.cmdProtobufCoded.newOpenReq(10,avdEngineHandle.accessToken,this.roomHandle.signalTocken,this.roomHandle.versionToServer,"",e,this.roomHandle.audioCodecPayloadMap)),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OPEN_REQ,0,0,0,e);log.info("===masterServer.openReqReconnectionSend(),Send PDU OPEN_REQ"),avdEngineHandle.loggerReport.info("masterServer.openReqReconnectionSend(),Send PDU OPEN_REQ"),this.signalingChannel.send(e)},e.prototype.pingIntervalHandle=function(){var e=this;e.roomHandle.pingIntervalId=setInterval(function(){e.roomHandle&&(e.roomHandle.pingCountTime+=e.roomHandle.pingInterval,packetArray=e.cmdProtobufCoded.encodedPacket(e.roomPduType.PING,e.roomHandle.lastPDUSeq,0,0,null),e.signalingChannel.send(packetArray))},e.roomHandle.pingInterval)},e.prototype.pingTimeoutHandle=function(){var e=this,t=3*e.roomHandle.pingInterval;e.roomHandle.pingTimeoutId=setInterval(function(){e.roomHandle&&e.roomHandle.pingCountTime>=t&&0==e.roomHandle.connectionState&&(log.info("===webSocket,masterServer.pingTimeoutHandle(),Ping包饱和测试无响应时间超过指定时长"+t+"毫秒时,进行websocket重连操作。"),avdEngineHandle.loggerReport.info("webSocket，masterServer.pingTimeoutHandle(),Ping包饱和测试无响应时间超过指定时长"+t+"毫秒时，进行websocket重连操作"),log.debug("===MasterServer.pingTimeoutHandle(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connecting),e.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),e.pingInit(),e.roomHandle.reconnectionHandle())},1e3)},e.prototype.pingInit=function(){this.roomHandle.pingCountTime=0,clearInterval(this.roomHandle.pingIntervalId),clearInterval(this.roomHandle.pingTimeoutId),this.roomHandle.pingIntervalId=null,this.roomHandle.pingTimeoutId=null},e.prototype.inviteRoomReqSend=function(){var t=this,e=null,r=(0<t.roomHandle.currentReconnectTimes&&(e=t.roomHandle.selfUser.nodeId),this.cmdProtobufCoded.newUserPolicy(!0,!0,!0)),n=t.roomHandle.userAgent,o=(avdEngineHandle.clientResource.cameras&&avdEngineHandle.clientResource.cameras.forEach(function(e){e.id=t.roomHandle.setDeviceIdByUUID(0,e.id)}),avdEngineHandle.clientResource.microphones&&avdEngineHandle.clientResource.microphones.forEach(function(e){e.id=t.roomHandle.setDeviceIdByUUID(2,e.id)}),avdEngineHandle.clientResource.speakers&&avdEngineHandle.clientResource.speakers.forEach(function(e){e.id=t.roomHandle.setDeviceIdByUUID(1,e.id)}),JSON.stringify(avdEngineHandle.clientResource)),n=(log.debug("===masterServer.inviteRoomReqSend(),userResources:"+o),this.cmdProtobufCoded.newJoinInfo([],[],n,r,o)),r=this.dataCryptoType.DataCryptoTypeAES128,o=(avdEngineHandle.dataCrypto==DataCryptoType.AES128?r=this.dataCryptoType.DataCryptoTypeAES128:avdEngineHandle.dataCrypto==DataCryptoType.AES256?r=this.dataCryptoType.DataCryptoTypeAES256:avdEngineHandle.dataCrypto==DataCryptoType.SM4&&(r=this.dataCryptoType.DataCryptoTypeSM4),log.debug("===masterServer.inviteRoomReqSend(),dataCryptoType:"+r),this.cmdProtobufCoded.newInviteRoomReq1(20,t.roomHandle.id,"",avdEngineHandle.accessToken,t.roomHandle.selfUser.id,t.roomHandle.selfUser.name,n,t.roomHandle.roomPassword,e,t.roomHandle.selfUser.data,avdEngineHandle.mediaConnectType,r)),n=(o.user_data=t.roomHandle.selfUser.data,o.ice_ufrag=t.roomHandle.iceUfrag,o.ice_pwd=t.roomHandle.icePwd,log.info("===masterServer.inviteRoomReqSend(),Send PDU INVITE_ROOM_REQ1"),avdEngineHandle.loggerReport.info("masterServer.inviteRoomReqSend(),Send PDU INVITE_ROOM_REQ1"),this.cmdProtobufCoded.encodedPacket(this.roomPduType.INVITE_ROOM_REQ1,0,0,0,o));this.signalingChannel.send(n)},e.prototype.sendAnswer=function(){var e=this,t=when.defer();return e.traceablePeerConnection.doSetRemoteDescription().then(function(){e.traceablePeerConnection.doSetLocalDescription().then(function(){t.resolve()}).otherwise(function(e){t.reject(e)})}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.setAddIcecandidate=function(e){var t,r;avdEngineHandle.restServerInfo.roomServerUrl&&((t=avdEngineHandle.restServerInfo.roomServerUrl.split("/")[0])&&0<(r=t.split(":")).size&&(t=r[0]),e.candidate=e.candidate.replace("127.0.0.1",t)),log.debug("===masterServer.setAddIcecandidate(),mcu server send candidate:"+e.candidate),this.traceablePeerConnection.doAddIceCandidate(e)},e.prototype.addWebcamMsg=function(e,t){var r=this.cmdProtobufCoded.newWebcam(e,t.name,t.status,this.sessionType.Video),t=(r.ctype=this.cameraType.unknown,r.level=t.level,r.description=t.description,this.cmdProtobufCoded.newAddWebcamMsg(this.roomHandle.selfUser.nodeId,r)),r=(log.info("===masterServer.addWebcamMsg(),Send PDU ADD_WEBCAM_MSG, PDUDeviceId:"+e),this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_WEBCAM_MSG,0,this.roomHandle.selfUser.nodeId,0,t));this.signalingChannel.send(r)},e.prototype.removeWebcamMsg=function(e){var t=this.cmdProtobufCoded.newRemoveWebcamMsg(this.roomHandle.selfUser.nodeId,e),e=(log.info("===masterServer.removeWebcamMsg(),Send PDU REMOVE_WEBCAM_MSG, PDUDeviceId:"+e),this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_WEBCAM_MSG,0,this.roomHandle.selfUser.nodeId,0,t));this.signalingChannel.send(e)},e.prototype.addScreenMsg=function(e,t){e=this.cmdProtobufCoded.newDesktop(e,t.name,t.status,this.sessionType.ShareScreen),e.level=t.level,e.description=t.description,t=this.cmdProtobufCoded.newAddDesktopMsg(this.roomHandle.selfUser.nodeId,e),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_DESKTOP_MSG,0,this.roomHandle.selfUser.nodeId,0,t);this.signalingChannel.send(e)},e.prototype.addSpeakerMsg=function(e,t){t=this.cmdProtobufCoded.newSpeaker(e,t.name,t.status,this.sessionType.Audio),t=this.cmdProtobufCoded.newAddSpeakerMsg(this.roomHandle.selfUser.nodeId,t),log.info("===masterServer.addSpeakerMsg(),Send PDU ADD_SPEAKER_MSG, PDUDeviceId:"+e),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_SPEAKER_MSG,0,this.roomHandle.selfUser.nodeId,0,t);this.signalingChannel.send(e)},e.prototype.removeSpeakerMsg=function(e){var t=this.cmdProtobufCoded.newRemoveSpeakerMsg(this.roomHandle.selfUser.nodeId,e),e=(log.info("===masterServer.removeSpeakerMsg(),Send PDU REMOVE_SPEAKER_MSG,PDUDeviceId:"+e),this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_SPEAKER_MSG,0,this.roomHandle.selfUser.nodeId,0,t));this.signalingChannel.send(e)},e.prototype.updateUserName=function(e,t){e=this.cmdProtobufCoded.newUpdateUserName(e,t),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_NAME,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(t)},e.prototype.updateUserDataMsg=function(e){e=this.cmdProtobufCoded.newUpdateUserDataMsg(this.roomHandle.selfUser.nodeId,e),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_DATA_MSG,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(e)},e.prototype.roomDataInfo=function(e,t){e=this.cmdProtobufCoded.newRoomKV(e,t),t=[],t.push(e),e=this.cmdProtobufCoded.newRoomDataInfo(this.roomHandle.id,t),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_DATA_INFO,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(t)},e.prototype.pubRoomResourceMsg=function(e,t,r,n,o,i){var a,s,d=100;avdEngineHandle.videoCoding==VideoCodingType.VP8?d=100:avdEngineHandle.videoCoding==VideoCodingType.VP9?d=101:avdEngineHandle.videoCoding==VideoCodingType.H264&&(d=107),"video"==e?s=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,r,currentVideoParameter.videoWidth,currentVideoParameter.videoHeight,currentVideoParameter.frameRate,d):"audio"==e?(a=parseInt(avdEngineHandle.audioCoding),s=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,r,0,0,0,a)):"screen"==e&&(s=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,r,1920,1080,5,d)),null!=s&&(s.sdp_version=3,(a=this.cmdProtobufCoded.newRoomResourceInfo(n,this.roomHandle.selfUser.nodeId,s)).keep_alive_time=i,"video"==e&&(t=this.roomHandle.getDeviceIdByUUID(0,n),r=this.roomHandle.selfUser.getVideo(t))&&(r.resourceInfo=a),log.info("==="+e+" send PUB_ROOM_RESOURCE_MSG,orderId:"+o+",resource_id:"+a.resource_id+",owner_id:"+a.owner_id+",keep_alive_time:"+a.keep_alive_time),d=this.cmdProtobufCoded.newPubRoomResourceMsg(a,o),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,d),this.signalingChannel.send(s),this.signalingChannel.send(""))},e.prototype.subRoomResourceMsg=function(e,t,r,n,o){var i;1==t?(log.info("==="+e+" send SUB_ROOM_RESOURCE_MSG,updateType:"+t+",orderId:"+o+",resource_id:"+r.resource_id+",owner_id:"+r.owner_id),n=this.cmdProtobufCoded.newSubRoomResourceMsg(r,this.roomHandle.selfUser.nodeId,o,n),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,n)):0==t&&(log.info("==="+e+" send UNSUB_ROOM_RESOURCE_MSG,updateType:"+t+",orderId:"+o+",resource_id:",r.resource_id+",owner_id:"+r.owner_id),n=this.cmdProtobufCoded.newUnsubRoomResourceMsg(r,this.roomHandle.selfUser.nodeId,o),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNSUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,n)),this.signalingChannel.send(i),this.signalingChannel.send("")},e.prototype.unpubRoomResourceMsg=function(e,t,r,n){var o,i,a,s=-1<r.indexOf("screen_audio"),s=("video"==e?(i=this.roomHandle.getDeviceIdByUUID(0,r),log.debug("===masterServer.unpubRoomResourceMsg(),video deviceId:",i),d=(a=this.roomHandle.selfUser.getVideo(i)).ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),video sdp:",d),o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,d)):"audio"!=e||s?"audio"==e&&s?(d=this.roomHandle.selfUser.screen.screenAudio.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),screen audio sdp:",d),o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,d)):"screen"==e&&(d=this.roomHandle.selfUser.screen.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),screen sdp:",d),o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,d)):(d=this.roomHandle.selfUser.audio.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),audio sdp:",d),o=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,d)),o&&(o.sdp_version=3),this.cmdProtobufCoded.newRoomResourceInfo(r,this.roomHandle.selfUser.nodeId,o)),t=("video"==e&&(i=this.roomHandle.getDeviceIdByUUID(0,r),a=this.roomHandle.selfUser.getVideo(i))&&(a.resourceInfo=s),this.cmdProtobufCoded.newUnpubRoomResourceMsg(s,n)),d=(log.info("==="+e+" send UNPUB_ROOM_RESOURCE_MSG,orderId:"+n+",resource_id:"+s.resource_id+",owner_id:"+s.owner_id),this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,t));this.signalingChannel.send(d),this.signalingChannel.send("")},e.prototype.sendVideoStreamControl=function(e,t,r,n,o){t*=1e3;var i=Math.round(t/4),o=this.cmdProtobufCoded.newVideoStreamControlReq(o,this.roomHandle.id,this.roomHandle.selfUser.nodeId,e,t,i,r,n),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_STREAM_CONTROL_REQ,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(e),this.signalingChannel.send("")},e.prototype.updateSpeakerMsg=function(e,t,r){var n=this.roomHandle.setDeviceIdByUUID(2,r.id),n=this.cmdProtobufCoded.newSpeaker(n,r.name,r.status,this.sessionType.Audio),r=this.cmdProtobufCoded.newUpdateSpeakerMsg(e,t,n),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_SPEAKER_MSG,0,this.roomHandle.selfUser.nodeId,0,r);this.signalingChannel.send(e),this.signalingChannel.send("")},e.prototype.updateWebcamMsg=function(e,t,r){var n=this.roomHandle.setDeviceIdByUUID(0,r.id),o=r.status,n=(r.status!=StreamStatus.none&&r.status!=StreamStatus.opened||(o=1),this.cmdProtobufCoded.newWebcam(n,r.name,o,this.sessionType.Video)),o=(n.level=r.level,n.description=r.description,this.cmdProtobufCoded.newUpdateWebcamMsg(e,t,n)),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_WEBCAM_MSG,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(r),this.signalingChannel.send("")},e.prototype.updateScreenIdMsg=function(e,t,r){var n=this.cmdProtobufCoded.newDesktop(r.id,r.name,r.status,this.sessionType.ShareScreen),r=(n.level=r.level,n.description=r.description,this.cmdProtobufCoded.newUpdateDesktopMsg(e,t,n)),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_DESKTOP_MSG,0,this.roomHandle.selfUser.nodeId,0,r);this.signalingChannel.send(e),this.signalingChannel.send("")},e.prototype.videoIndiction=function(e,t,r){var n=this.resourceOpt.pub,e=(e||(n=this.resourceOpt.unpub),this.cmdProtobufCoded.newResourceIndiction(t,n,r,this.roomHandle.selfUser.nodeId,"host_tocken")),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_INDICTION,0,this.roomHandle.selfUser.nodeId,r,e);this.signalingChannel.send(t)},e.prototype.audioIndiction=function(e,t,r){var n=this.resourceOpt.pub,e=("pub"==e?n=this.resourceOpt.pub:"unpub"==e?n=this.resourceOpt.unpub:"mute"==e?n=this.resourceOpt.mute:"unmute"==e&&(n=this.resourceOpt.unmute),this.cmdProtobufCoded.newResourceIndiction(t,n,r,this.roomHandle.selfUser.nodeId,"host_tocken")),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.AUDIO_INDICTION,0,this.roomHandle.selfUser.nodeId,r,e);this.signalingChannel.send(t)},e.prototype.sendMessage=function(e,t){var r=new Date,r=(r.setMinutes(r.getMinutes()+r.getTimezoneOffset()),r.getTime()),r=Math.round(r/1e3),e=this.cmdProtobufCoded.newTextMsg(e,r),r=this.roomPduType.PUBLIC_TEXT_MSG,n=0;if(void 0!==t&&null!=t&&""!=t){t=this.roomHandle.getNodeId(t);if(null==t)return!1;n=t,r=this.roomPduType.PRIVATE_TEXT_MSG}t=this.cmdProtobufCoded.encodedPacket(r,0,this.roomHandle.selfUser.nodeId,n,e);this.signalingChannel.send(t)},e.prototype.sendData=function(e,t){var r,n,o=when.defer();return 6e4<e.byteLength?(r=new _(ErrorConstant.data_oversize),o.reject(r)):(r=this.cmdProtobufCoded.newData(e),e=this.roomPduType.PUBLIC_DATA,void(n=0)!==t&&null!=t&&""!=t&&null!=(t=this.roomHandle.getNodeId(t))&&(n=t,e=this.roomPduType.PRIVATE_DATA),t=this.cmdProtobufCoded.encodedPacket(e,0,this.roomHandle.selfUser.nodeId,n,r),this.signalingChannel.send(t),o.resolve()),o.promise},e.prototype.sendPrivateDataToUser=function(e,t){var r,n=when.defer();return 6e4<e.byteLength?(r=new _(ErrorConstant.data_oversize),n.reject(r)):(r=this.cmdProtobufCoded.newPrivateDataToUser(this.roomHandle.id,t,e,this.roomHandle.selfUser.id),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PRIVATE_DATA_TO_USER,0,this.roomHandle.selfUser.nodeId,0,r),this.signalingChannel.send(t),n.resolve()),n.promise},e.prototype.userIndiction=function(e,t){t=this.roomHandle.getNodeId(t),e=this.cmdProtobufCoded.newUserMsg(t,this.userMsgOpt.kickoff,e),e=this.cmdProtobufCoded.newUserIndiction(this.roomHandle.selfUser.nodeId,this.roomPduType.USER_MSG,e.toArrayBuffer()),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_INDICTION,0,this.roomHandle.selfUser.nodeId,t,e);this.signalingChannel.send(t)},e.prototype.userMsg=function(e,t){var r=this.userMsgOpt.leave;t&&(r=this.userMsgOpt.kickoff),this.roomHandle&&this.roomHandle.selfUser&&this.roomHandle.selfUser.nodeId&&(t=this.cmdProtobufCoded.newUserMsg(this.roomHandle.selfUser.nodeId,r,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_MSG,0,this.roomHandle.selfUser.nodeId,0,t),this.signalingChannel.send(r))},e.prototype.closeRoom=function(e){e=this.cmdProtobufCoded.newCloseRoomReq(50,this.roomHandle.getNodeId(e),this.roomHandle.getRoomId()),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CLOSE_ROOM_REQ,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(e)},e.prototype.videoPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("video",e,t,r):this.pubRoomResourceMsg("video",t.id,null,e,r)},e.prototype.videoUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("video",e,t,r):this.unpublishHandleP2P("video",this.roomHandle.selfUser.subMyVideosP2P,t,e,r)},e.prototype.videoSubscribleHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("video",1,e,t,r):this.subscribleHandleP2P(e)},e.prototype.videoUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("video",0,e,null,t):this.unsubscribleHandleP2P("video",e)},e.prototype.changeSubscribedVideoQuality=function(e,t){this.roomHandle.isMcu()&&(e=this.cmdProtobufCoded.newModifyResourceReq("60",e,t),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.MODIFY_RESOURCE_REQ,0,this.roomHandle.selfUser.nodeId,0,e),this.signalingChannel.send(t))},e.prototype.screenPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("screen",e,t,r):this.pubRoomResourceMsg("screen",t.id,null,e,r)},e.prototype.screenAudioPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("audio",e,t,r):this.pubRoomResourceMsg("audio",t.id,null,e,r)},e.prototype.screenUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("screen",e,t,r):this.unpublishHandleP2P("screen",this.roomHandle.selfUser.subMyScreensP2P,t,e,r)},e.prototype.screenAudioUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("audio",e,t,r):this.unpublishHandleP2P("audio",this.roomHandle.selfUser.subMyScreensP2P,t,e,r)},e.prototype.screenSubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("screen",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.screenUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("screen",0,e,null,t):this.unsubscribleHandleP2P("screen",e)},e.prototype.screenAudioSubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.screenAudioUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",0,e,null,t):this.unsubscribleHandleP2P("audio",e)},e.prototype.audioPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("audio",e,t,r):this.pubRoomResourceMsg("audio",t.id,null,e,r)},e.prototype.audioUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("audio",e,t,r):this.unpublishHandleP2P("audio",this.roomHandle.selfUser.subMyAudiosP2P,t,e,r)},e.prototype.audioBatchSubscribleHandle=function(e){this.roomHandle.traceablePeerConnection.audioBatchSdp(e)},e.prototype.audioSubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.audioUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",0,e,null,t):this.unsubscribleHandleP2P("audio",e)},e.prototype.bindAudioToVideo=function(e,t,r){e=this.cmdProtobufCoded.newBindAudioToVideoReq(e,t,r),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.BIND_AUDIO_TO_VIDEO_REQ,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(t)},e.prototype.sendOfferP2P=function(e,t){log.debug("===sendOfferP2P(),OFFER_REQ");e=this.cmdProtobufCoded.newOfferReq(0,e,this.roomHandle.selfUser.nodeId),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REQ,0,this.roomHandle.selfUser.nodeId,t,e);this.signalingChannel.send(t)},e.prototype.setRemoteP2P=function(e,t){log.debug("===masterServer.setRemoteP2P(),OFFER_REP");e=this.cmdProtobufCoded.newOfferRep(0,1,"",e,this.roomHandle.selfUser.nodeId),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REP,0,this.roomHandle.selfUser.nodeId,t,e);this.signalingChannel.send(t)},e.prototype.sendCandidateMsgP2P=function(e,t){e=this.cmdProtobufCoded.newCandidateMsg(e.candidate,e.sdpMLineIndex,e.sdpMid,this.roomHandle.selfUser.nodeId),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CANDIDATE_MSG,0,this.roomHandle.selfUser.nodeId,t,e);this.signalingChannel.send(t)},e.prototype.sendSubSdpOfferP2P=function(e,t,r){var n,o=e.info;o.stream.sdp=t,"offerSub"==r?(log.debug("===masterServer.sendSubSdpOfferP2P(),send P2P SUB_ROOM_RESOURCE_REQ: "+this.roomHandle.selfUser.nodeId+"------\x3e"+o.owner_id),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,this.roomHandle.selfUser.nodeId,o.owner_id,e)):"answerSub"==r&&(log.debug("===masterServer.sendSubSdpOfferP2P(),send P2P SUB_ROOM_RESOURCE_REP: "+this.roomHandle.selfUser.nodeId+"------\x3e"+e.sub_node_id),t=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",o),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,this.roomHandle.selfUser.nodeId,e.sub_node_id,t)),this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.sendSubSdpAnswerP2P=function(e,t,r,n){var o;t.stream.sdp=r,"offerSub"==e?(r=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",t),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,this.roomHandle.selfUser.nodeId,n,r)):"answerSub"==e&&(r=this.cmdProtobufCoded.newSubRoomResourceMsg(t,this.roomHandle.selfUser.nodeId,1),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,n,r)),this.signalingChannel.send(o),this.signalingChannel.send("")},e.prototype.subscribleHandleP2P=function(e){var t,r;this.roomHandle.selfUser.nodeId>e.owner_id?(e.stream.sdp="",r=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,this.roomHandle.selfUser.nodeId),log.info("===masterServer.subscribleHandleP2P(),SUB_ROOM_RESOURCE_REQ"),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,this.roomHandle.selfUser.nodeId,e.owner_id,r),this.signalingChannel.send(t),this.signalingChannel.send("")):(r=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,this.roomHandle.selfUser.nodeId),this.roomHandle.traceableP2PPeerConnection.sendSubSdpOfferP2P("offerSub",r))},e.prototype.unpublishHandleP2P=function(e,t,r,n){if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){var i=t[o];this.roomHandle.traceableP2PPeerConnection.removeStreamP2P(e,i,r),this.roomHandle.selfUser.nodeId>i?this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unpubAnswer",e,i,null):this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unpubOffer",e,i,null)}"video"==e?(a=this.mediaType.video,log.debug("===masterServer.unpublishHandleP2P(),send  video  UNPUB_ROOM_RESOURCE_MSG: "+this.roomHandle.selfUser.nodeId+"------\x3eservice")):"audio"==e?(a=this.mediaType.audio,log.debug("===masterServer.unpublishHandleP2P(),send  audio  UNPUB_ROOM_RESOURCE_MSG: "+this.roomHandle.selfUser.nodeId+"------\x3eservice")):"screen"==e&&(a=this.mediaType.desktop,log.debug("===masterServer.unpublishHandleP2P(),send  screen  UNPUB_ROOM_RESOURCE_MSG: "+this.roomHandle.selfUser.nodeId+"------\x3eservice"));var a=this.cmdProtobufCoded.newMediaStream(r.id,a,null),n=this.cmdProtobufCoded.newRoomResourceInfo(n,this.roomHandle.selfUser.nodeId,a),a=this.cmdProtobufCoded.newUnpubRoomResourceMsg(n),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,a);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.unsubscribleHandleP2P=function(e,t){this.roomHandle.selfUser.nodeId>t.owner_id?this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unsubAnswer",e,t.owner_id,t):this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unsubOffer",e,t.owner_id,t)},e.prototype.setRoomControl=function(e,t){e=this.cmdProtobufCoded.newRoomControl(e,t),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_CONTROL,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(t),this.signalingChannel.send("")},e.prototype.addBoardMsg=function(e,t){var r=t.backgroundColor.split(","),r=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(r[3])),parseInt(r[0]),parseInt(r[1]),parseInt(r[2])),n=t.width,o=t.height,n=(t.width!=t.outputWidth&&(n=t.outputWidth),t.height!=t.outputHeight&&(o=t.outputHeight),log.debug("===masterServer.addBoardMsg(),boardWidth:",n+",boardHeight:",o),this.cmdProtobufCoded.newBoardObject(t.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,n,o,r,t.backgroundImage,null,t.title,t.description,t.extendData)),o=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t.id,n),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(r),this.signalingChannel.send("")},e.prototype.removeBoardMsg=function(e,t){e=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t,null),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(t),this.signalingChannel.send("")},e.prototype.closeBoardMsg=function(e,t){e=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t,null),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,e);this.signalingChannel.send(t),this.signalingChannel.send("")},e.prototype.shareBoardMsg=function(e,t,r){log.debug("===masterServer.shareBoardMsg operType: ",e," boardId: ",t);var n=r.backgroundColor.split(","),n=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(n[3])),parseInt(n[0]),parseInt(n[1]),parseInt(n[2])),o=r.width,i=r.height,o=(r.width!=r.outputWidth&&(o=r.outputWidth),r.height!=r.outputHeight&&(i=r.outputHeight),this.cmdProtobufCoded.newBoardObject(r.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,o,i,n,r.backgroundImage,null,r.title,r.description,r.extendData)),i=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t,o),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,i);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.sendAddAnnotationMessage=function(e,t,r,n,o,i,a){var s=null,d=null,l=null,u=null,c=OperType.add,p=t._rectWithStroke||{},h=t.shape||{},f=t.id,m=parseInt(p.x)?parseInt(p.x):0,g=parseInt(p.y)?parseInt(p.y):0,y=parseInt(p.x+p.width)?parseInt(p.x+p.width):0,p=parseInt(p.y+p.height)?parseInt(p.y+p.height):0,v={type:"",start:null,end:null,pointArray:[]},b=this.annotationType.annotation_tool_mouse,h=(r==shapeTypeEnum.line?(b=this.annotationType.annotation_tool_line,v.type="Annotation2Point",v.start=[parseInt(h.x1),parseInt(h.y1)],v.end=[parseInt(h.x2),parseInt(h.y2)]):r==shapeTypeEnum.rhomb?(b=this.annotationType.annotation_tool_rhomb,v.type="Annotation2Point",_=parseInt(h.points[0][0]),S=parseInt(h.points[3][1]),w=parseInt(h.points[2][0]),E=parseInt(h.points[1][1]),v.start=[_,S],v.end=[w,E]):r==shapeTypeEnum.polyline?(b=this.annotationType.annotation_tool_polyline,v.type="AnnotationMultiPoint",v.pointArray=h.points):r==shapeTypeEnum.ellipse?(b=this.annotationType.annotation_tool_ellipse,v.type="Annotation2Point",_=parseInt(h.cx-h.rx),S=parseInt(h.cy-h.ry),w=parseInt(h.cx+h.rx),E=parseInt(h.cy+h.ry),v.start=[_,S],v.end=[w,E]):r==shapeTypeEnum.rect?(b=this.annotationType.annotation_tool_rectangle,v.type="Annotation2Point",v.start=[parseInt(h.x),parseInt(h.y)],v.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.arrow?(b=this.annotationType.annotation_tool_arrow,v.type="Annotation2Point",v.start=[parseInt(h.x),parseInt(h.y)],v.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.hlight_texttag?(b=this.annotationType.annotation_tool_hlight_texttag,v.type="Annotation2Point",v.start=[parseInt(h.x),parseInt(h.y)],v.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.success?(b=this.annotationType.annotation_tool_success,v.type="Annotation2Point",v.start=[parseInt(h.x),parseInt(h.y)],v.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.failure?(b=this.annotationType.annotation_tool_failure,v.type="Annotation2Point",v.start=[parseInt(h.x),parseInt(h.y)],v.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.hlight_point?(b=this.annotationType.annotation_tool_hlight_point,v.type="Annotation2Point",v.start=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)],v.end=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)]):r==shapeTypeEnum.img?(b=this.annotationType.annotation_tool_img,v.type="AnnotationImg",v.im=t):r==shapeTypeEnum.txt&&(b=this.annotationType.annotation_tool_txt,v.type="AnnotationTxt",v.txi=t),function(e){e=e.split("(")[1].split(")")[0].split(",");4<=e.length||(e[3]=1);return e}(n)),n=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(h[3])),parseInt(h[0]),parseInt(h[1]),parseInt(h[2])),h=null,h=a==fillTypeEnum.full?n:this.cmdProtobufCoded.newcolor(0,255,255,255),a=(log.debug("===masterServer.sendAddAnnotationMessage(),room.boardOutputXRati:"+this.roomHandle.boardOutputXRatio+",room.boardOutputYRatio:"+this.roomHandle.boardOutputYRatio),log.debug("===masterServer.sendAddAnnotationMessage(),minY:",g+",maxY:",p+",minX:"+m+",maxX:"+y),Math.round(g*this.roomHandle.boardOutputYRatio)),g=Math.round(p*this.roomHandle.boardOutputYRatio),p=Math.round(m*this.roomHandle.boardOutputXRatio),m=Math.round(y*this.roomHandle.boardOutputXRatio),y=(log.debug("===masterServer.sendAddAnnotationMessage(),outputMinY:",a+",outputMaxY:",g+",outputMinX:"+p+",outputMaxX:"+m),this.cmdProtobufCoded.newRect(a,g,p,m)),a=this.cmdProtobufCoded.newAnnotationObject(e,f,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,b,i,o,n,h,y);if("Annotation2Point"==v.type)var _=v.start[0],S=v.start[1],w=v.end[0],E=v.end[1],g=(log.debug("===masterServer.sendAddAnnotationMessage(),Annotation2Point startX:"+_+",startY:"+S+",endX:"+w+",endY:"+E),Math.round(_*this.roomHandle.boardOutputXRatio)),p=Math.round(S*this.roomHandle.boardOutputYRatio),m=Math.round(w*this.roomHandle.boardOutputXRatio),b=Math.round(E*this.roomHandle.boardOutputYRatio),I=(log.debug("===masterServer.sendAddAnnotationMessage(),Annotation2Point outputStartX:"+g+",outputStartY:"+p+",outputEndX:"+m+",outputEndY:"+b),this.cmdProtobufCoded.newPoint(g,p)),T=this.cmdProtobufCoded.newPoint(m,b),s=this.cmdProtobufCoded.newAnnotation2Point(a,I,T);else if("AnnotationMultiPoint"==v.type){var C=[];log.debug("===masterServer.sendAddAnnotationMessage(),pointObj.pointArray ",v.pointArray);for(var R=0;R<v.pointArray.length;R++){var P=v.pointArray[R],k=(log.debug("===masterServer.sendAddAnnotationMessage(),pointValue:",P),parseInt(P[0])),P=parseInt(P[1]);log.debug("===masterServer.sendAddAnnotationMessage(),AnnotationMultiPoint x:"+k+",y:"+P),k&&P&&(k=Math.round(k*this.roomHandle.boardOutputXRatio),P=Math.round(P*this.roomHandle.boardOutputYRatio),log.debug("===masterServer.sendAddAnnotationMessage(),AnnotationMultiPoint outputX:"+k+",outputY:"+P),k=this.cmdProtobufCoded.newPoint(k,P),C.push(k))}d=this.cmdProtobufCoded.newAnnotationMultiPoint(a,C)}else"AnnotationImg"==v.type?(i=this.newAnnotationImg(v.im),a.arrow||(a.arrow=this.lineArrow.none),a.lineWidth||(a.lineWidth=2),l=this.cmdProtobufCoded.newAnnotationImg(a,i)):"AnnotationTxt"==v.type&&(I=(n=(o=v.txi.style).fill).indexOf("("),T=n.indexOf(")"),h=null,h=(y=n.slice(I+1,T).split(",")).length<4?this.cmdProtobufCoded.newcolor(255,parseInt(y[0]),parseInt(y[1]),parseInt(y[2])):this.cmdProtobufCoded.newcolor(parseInt(255*y[3]),parseInt(y[0]),parseInt(y[1]),parseInt(y[2])),_=Math.round(v.txi.getBoundingRect().width*this.roomHandle.boardOutputXRatio),S=Math.round(v.txi.getBoundingRect().height*this.roomHandle.boardOutputYRatio),w=Math.round(v.txi.position[0]*this.roomHandle.boardOutputXRatio),E=Math.round(v.txi.position[1]*this.roomHandle.boardOutputYRatio),I=this.cmdProtobufCoded.newPoint(w,E),T=this.cmdProtobufCoded.newPoint(w+_,E+S),g=this.cmdProtobufCoded.newTxt(1,o.text),p=this.cmdProtobufCoded.newTextInfo(o.fontSize,g,h,null,null,null,o.fontStyle,o.fontWeight,o.font),s=this.cmdProtobufCoded.newAnnotation2Point(a,I,T),u=this.cmdProtobufCoded.newAnnotationTxt(s,p));m=this.cmdProtobufCoded.newUpdateAnnotationMsg(c,e,r,f,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,s,d,null,l,u),this.roomHandle.addAnnotationMsg(m,!0,void 0,t,f),b=this.roomPduType.UPDATE_ANNOTATION_MSG,i=this.cmdProtobufCoded.encodedPacket(b,0,this.roomHandle.selfUser.nodeId,0,m);this.signalingChannel.send(i)},e.prototype.sendUpdateAnnotationMessage=function(e,t,r){var n,o,i,a,s,d,l=OperType.update;r==shapeTypeEnum.img&&(n=this.newAnnotationImg(t),o=this.annotationType.annotation_tool_img,i=this.lineArrow.none,a=this.cmdProtobufCoded.newcolor(0,255,255,255),s=this.cmdProtobufCoded.newcolor(0,255,255,255),d=this.cmdProtobufCoded.newRect(0,0,10,10),o=this.cmdProtobufCoded.newAnnotationObject(e,t.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,o,i,2,a,s,d),i=this.cmdProtobufCoded.newAnnotationImg(o,n),a=this.cmdProtobufCoded.newUpdateAnnotationMsg(l,e,r,t.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,null,null,null,i,null),this.roomHandle.addAnnotationMsg(a,!0,void 0,t,t.id),s=this.roomPduType.UPDATE_ANNOTATION_MSG,d=this.cmdProtobufCoded.encodedPacket(s,0,this.roomHandle.selfUser.nodeId,0,a),this.signalingChannel.send(d))},e.prototype.sendRemoveAnnotationMessage=function(e,t,r){var n=r,o=OperType.remove,o=(t==shapeTypeEnum.clear&&(n=null),this.cmdProtobufCoded.newUpdateAnnotationMsg(o,e,t,n,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id)),e=(t==shapeTypeEnum.clear?this.roomHandle.addAnnotationMsg(o,!0,!0,void 0,r):this.roomHandle.addAnnotationMsg(o,!0,void 0,void 0,r),this.roomPduType.UPDATE_ANNOTATION_MSG),n=this.cmdProtobufCoded.encodedPacket(e,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(n)},e.prototype.newAnnotationImg=function(e){var t=e.id,r=e.position[0],n=e.position[1],r=(e.customPositionX&&(r=e.customPositionX,n=e.customPositionY),Math.round(r*this.roomHandle.boardOutputXRatio)),n=Math.round(n*this.roomHandle.boardOutputYRatio),o=Math.round(e.style.width*e.scale[0]*this.roomHandle.boardOutputXRatio),i=Math.round(e.style.height*e.scale[1]*this.roomHandle.boardOutputYRatio),a=e.zlevel,s=mathPI2degree(e.rotation),e=e.style.image;return this.cmdProtobufCoded.newImgInfo(t,r,n,o,i,a,10,!1,s,e,null)},e.prototype.createServerRecorder=function(e,t,r,n,o,i,a,s,d,l,u,c){var p,h=when.defer(),f=getRandomNum(2e3,8e3);switch(o){case exporterTypeEnum.record:p=this.exporterType.EXPORTER_TYPE_RECORD;break;case exporterTypeEnum.record_real_time:p=this.exporterType.EXPORTER_TYPE_RECORD_REAL_TIME;break;case exporterTypeEnum.liver:p=this.exporterType.EXPORTER_TYPE_LIVER;break;case exporterTypeEnum.avc_media_mixer:p=this.exporterType.EXPORTER_TYPE_AVC_MEDIA_MIXER}var o=this.cmdProtobufCoded.newOutgoingCreateStreamsExporterReq(f,e,t,r,n,p,i,a,s,d,u,!0,0,0,"","",l,c),e=this.roomPduType.OUTGOING_CREATE_STREAMS_EXPORTER_REQ,t=(log.debug("===masterServer.createServerRecorder(),outgoingCreateStreamsExporterReq:",o),this.cmdProtobufCoded.encodedPacket(e,0,this.roomHandle.selfUser.nodeId,0,o)),m=(this.signalingChannel.send(t),setTimeout(function(){var e=new _(1e4,"createServerRecorder time out");h.reject(e)},5e3));return this.roomHandle.addCallback(ExporderCallBack.create_server_recorder_rep_success,function(e,t,r,n){e==f&&(h.resolve({exporter_id:t,exporter_name:r,play_urls:n}),clearTimeout(m))}),this.roomHandle.addCallback(ExporderCallBack.create_server_recorder_rep_error,function(e,t){t==f&&(h.reject(e),clearTimeout(m))}),h.promise},e.prototype.selectStream4Exporter=function(e,t,r,n,o,i,a){var s=when.defer(),d=getRandomNum(2e3,8e3),e=this.cmdProtobufCoded.newOutgoingSelectStreamReq(d,e,t,r,n,o,i,a),t=this.roomPduType.OUTGOING_SELECT_STREAM_REQ,r=this.cmdProtobufCoded.encodedPacket(t,0,this.roomHandle.selfUser.nodeId,0,e),l=(this.signalingChannel.send(r),setTimeout(function(){var e=new _(1e4,"selectStream4Exporter time out");s.reject(e)},5e3));return this.roomHandle.addCallback(ExporderCallBack.select_stream_rep_success,function(e,t){e==d&&(s.resolve({exporter_id:t}),clearTimeout(l))}),this.roomHandle.addCallback(ExporderCallBack.select_stream_rep_error,function(e,t){t==d&&(s.reject(e),clearTimeout(l))}),s.promise},e.prototype.mixMedia4Exporter=function(e,t,r,n,o,i){log.debug("===masterServer.mixMedia4Exporter(),videoItems:",n);var a,s=when.defer(),d=getRandomNum(2e3,8e3),l=[];if(log.debug("===masterServer.mixMedia4Exporter(),videoItems:",n),n&&0<n.length)for(var u=0;u<n.length;u++){var c=n[u],p=(log.debug("===masterServer.mixMedia4Exporter(),videoItem:",c),c.userId),h=c.zorder,f=c.x,m=c.y,g=c.width,y=c.height,v=c.deviceId,c=c.videoData,p=this.cmdProtobufCoded.newOutgoingVideoInfo(p,h,f,m,g,y,v,c);log.debug("===masterServer.mixMedia4Exporter(),videoInfo:",p),l.push(p)}r==viewLayoutModeEnum.fixation?a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Fixation:r==viewLayoutModeEnum.auto?a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto:r==viewLayoutModeEnum.auto_orato&&(a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto_Orato);var r=this.cmdProtobufCoded.newOutgoingMixStreamsReq(d,e,t,a,l,o,i),e=(log.debug("===masterServer.mixMedia4Exporter(),mixStreamsReq:",r),this.roomPduType.OUTGOING_MIX_STREAMS_REQ),t=this.cmdProtobufCoded.encodedPacket(e,0,this.roomHandle.selfUser.nodeId,0,r),b=(this.signalingChannel.send(t),setTimeout(function(){var e=new _(1e4,"mixMedia4Exporter time out");s.reject(e)},5e3));return this.roomHandle.addCallback(ExporderCallBack.mix_media_rep_success,function(e,t){e==d&&(s.resolve({exporter_id:t}),clearTimeout(b))}),this.roomHandle.addCallback(ExporderCallBack.mix_media_rep_error,function(e,t){t==d&&(s.reject(e),clearTimeout(b))}),s.promise},e.prototype.pauseResumeExporter=function(e,t,r,n){var o=when.defer(),i=getRandomNum(2e3,8e3),e=this.cmdProtobufCoded.newOutgoingPauseResumeExporterReq(i,e,t,r,n),t=this.roomPduType.OUTGOING_PAUSE_RESUME_EXPORTER_REQ,r=this.cmdProtobufCoded.encodedPacket(t,0,this.roomHandle.selfUser.nodeId,0,e),a=(this.signalingChannel.send(r),setTimeout(function(){var e=new _(1e4,"pauseResumeExporter time out");o.reject(e)},5e3));return this.roomHandle.addCallback(ExporderCallBack.pause_stream_rep_success,function(e,t){e==i&&(o.resolve({exporter_id:t}),clearTimeout(a))}),this.roomHandle.addCallback(ExporderCallBack.pause_stream_rep_error,function(e,t){t==i&&(o.reject(e),clearTimeout(a))}),o.promise},e.prototype.destroyExporter=function(e,t,r){var n=when.defer(),o=getRandomNum(2e3,8e3),e=this.cmdProtobufCoded.newOutgoingDestroyExporterReq(o,e,t,r),t=this.roomPduType.OUTGOING_DESTROY_EXPORTER_REQ,r=this.cmdProtobufCoded.encodedPacket(t,0,this.roomHandle.selfUser.nodeId,0,e),i=(this.signalingChannel.send(r),setTimeout(function(){var e=new _(1e4,"destroyExporter time out");n.reject(e)},5e3));return this.roomHandle.addCallback(ExporderCallBack.stop_stream_rep_success,function(e,t){e==o&&(n.resolve({exporter_id:t}),clearTimeout(i))}),this.roomHandle.addCallback(ExporderCallBack.stop_stream_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(i))}),n.promise},e.prototype.updateExporterStreamName=function(e){var r=when.defer(),n=getRandomNum(8e3,9e3),t=this.roomHandle.setDeviceIdByUUID(0,e.id),t=this.cmdProtobufCoded.newRoomSetStreamNameReq(n,this.roomHandle.id,e.ownerId,t,e.streamName,e.streamNickName),e=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_SET_STREAM_NAME_REQ,0,this.roomHandle.selfUser.nodeId,0,t),o=(this.signalingChannel.send(e),this.signalingChannel.send(""),setTimeout(function(){var e=new _(1e4,"updateExporterStreamName time out");r.reject(e)},5e3));return this.roomHandle.addCallback(UserCallback.room_set_stream_name_rep_success,function(e){e==n&&(r.resolve(),clearTimeout(o))}),this.roomHandle.addCallback(UserCallback.room_set_stream_name_rep_error,function(e,t){t==n&&(r.reject(e),clearTimeout(o))}),r.promise},e.prototype.outgoingExporterSetFocusVideo=function(e,t,r){var n=when.defer(),o=getRandomNum(8e3,9e3),e=this.cmdProtobufCoded.newOutgoingExporterSetFocusVideoReq(o,this.roomHandle.id,e,t,r),t=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ,0,this.roomHandle.selfUser.nodeId,0,e),i=(this.signalingChannel.send(t),this.signalingChannel.send(""),setTimeout(function(){var e=new _(1e4,"outgoingExporterSetFocusVideo time out");n.reject(e)},5e3));return this.roomHandle.addCallback(ExporderCallBack.set_focus_video_rep_success,function(e){e==o&&(n.resolve(),clearTimeout(i))}),this.roomHandle.addCallback(ExporderCallBack.set_focus_video_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(i))}),n.promise},e.prototype.outgoingGetExporterInfo=function(e,t,r){var n=when.defer(),o=getRandomNum(8e3,9e3),e=this.cmdProtobufCoded.newOutgoingGetExporterInfoReq(o,e,t,r),t=(log.debug("===masterServer.outgoingGetExporterInfo(),outgoingGetExporterInfoReq:",e),this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_GET_EXPORTER_INFO_REQ,0,this.roomHandle.selfUser.nodeId,0,e)),i=(this.signalingChannel.send(t),this.signalingChannel.send(""),setTimeout(function(){var e=new _(1e4,"outgoingGetExporterInfo time out");n.reject(e)},5e3));return this.roomHandle.addCallback(ExporderCallBack.get_exporter_info_rep_success,function(e,t,r){e==o&&(n.resolve(t,r),clearTimeout(i))}),this.roomHandle.addCallback(ExporderCallBack.get_exporter_info_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(i))}),n.promise},e}),ModuleBase.define("P2PServer",["TraceableP2PPeerConnection"],function(e){function t(){this.selfNodeIntervalId=null,this.traceableP2PPeerConnection=new e,room.traceableP2PPeerConnection=this.traceableP2PPeerConnection}function r(e){room.selfUser.nodeId<e&&(null!=this.selfNodeIntervalId&&(clearInterval(this.selfNodeIntervalId),this.selfNodeIntervalId=null),room.traceableP2PPeerConnection.getToP2PPeerConnection(e))}return t.prototype.createP2PPeerConnection=function(e){null!=room.selfUser&&null!=room.selfUser.nodeId?r(e):this.selfNodeIntervalId=setInterval(function(){null!=room.selfUser&&null!=room.selfUser.nodeId&&r(e)},200)},t});var log=log4javascript.getLogger(),avdEngineHandle,remoteSDPInit;function getFingerPrint(e){for(var t=null,r=(console.log(e),e.split("\r\n")),n=0;n<r.length;n++)if(-1<r[n].indexOf("a=fingerprint")){t=r[n].split(" ")[1];break}return console.log(t),t}function updateSDPFingerPrint(e,t){var r=preferLineSdp(e,"a=","fingerprint");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=fingerprint:sha-1 "+t)}return e}function updateSDPIceUfrag(e,t){var r=preferLineSdp(e,"a=","ice-ufrag");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-ufrag:"+t)}return e}function updateSDPIcePwd(e,t){var r=preferLineSdp(e,"a=","ice-pwd");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-pwd:"+t)}return e}function updateSDPSetup(e,t){var r=preferLineSdp(e,"a=","setup");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=setup:"+t)}return e}function preferLineSdp(e,t,r){var n=[],o=e.split("\r\n"),i=findLine(o,t,r);if(null!=i&&0<i.length)for(var a=0;a<i.length;a++)n.push(o[i[a]]);return n}function findLine(e,t,r){return findLineInRange(e,0,-1,t,r)}function findLineInRange(e,t,r,n,o){for(var i=[],a=-1!==r?r:e.length,s=t;s<a;++s)0!==e[s].indexOf(n)||o&&-1===e[s].toLowerCase().indexOf(o.toLowerCase())||i.push(s);return i}function findLine1(e,t,r){return findLineInRange1(e,0,-1,t,r)}function findLineInRange1(e,t,r,n,o){for(var i=-1!==r?r:e.length,a=t;a<i;++a)if(0===e[a].indexOf(n)&&(!o||-1!==e[a].toLowerCase().indexOf(o.toLowerCase())))return a;return null}function preferBitRate(e,t,r){var n,o;return null==t||t<=0?-1!==e.indexOf("b=AS:")?e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,""):e:(null===(r=findLine1(n=e.split("\r\n"),"m=",r))?trace("Failed to add bandwidth line to sdp, as no m-line found"):(o=findLineInRange1(n,r+1,-1,"m="),null===(r=findLineInRange1(n,r+1,o=null===o?n.length:o,"c="))?trace("Failed to add bandwidth line to sdp, as no c-line found"):((o=findLineInRange1(n,r+1,o,"b=AS"))&&n.splice(o,1),n.splice(r+1,0,"b=AS:"+t),e=n.join("\r\n"))),e)}function addAudioNack(e,t){var r=e.split("\r\n"),n=findLine(r,"m=","audio");if(null===n)console.log("addAudioNack(),Failed to add audio nack line to sdp, as no m-line found");else{for(var o,i=findLineInRange1(r,n+1,-1,"m="),a=(null===i&&(i=r.length),!1),s=null,d=n;d<i;++d)if(0<=r[d].indexOf(t)){s=r[d].split(" ")[0].split(":")[1],o=d;break}if(s){for(var l="a=rtcp-fb:"+s+" nack",d=n;d<i;++d)if(0<=r[d].indexOf(l)){a=!0;break}a||(r.splice(o+1,0,l),e=r.join("\r\n"))}}return e}ModuleBase.define("AVDEngine",["Room","RestServer","Error","BrowserDetect","StreamExporterManager","ElectronManager","RtmManager","InviteManager"],function(n,e,i,t,r,o,a,s){function d(){this.avdVersion="4.0.8.0",this.accessToken,this.clientIsUseCascade=!1,this.restServerInfo={mcuServerUrl:null,clusterRestAddr:null,roomServerUrl:null,iceServers:null,stunUrl:null,trunUrl:null,iceusername:null,iceCredential:null,isCluster:!1,protocolStr:document.location.protocol,notQueryGetMcu:!1,masterVersion:null,masterPackageVersion:null,boxVersion:null,boxPackageVersion:null,signalData:null,iv:"0000000000000000"},"httpsionic:"==this.restServerInfo.protocolStr&&(this.restServerInfo.protocolStr="https:"),"http:"!=this.restServerInfo.protocolStr&&"https:"!=this.restServerInfo.protocolStr&&"httpsionic:"!=this.restServerInfo.protocolStr&&(this.restServerInfo.protocolStr="http:"),this.loggerReportConfig=null,this.loggerReport=null,this.logReportWait=[],this.connectionStatisticsConfig=null,this.browserDetect,this.levelValue=log4javascript.Level.INFO.level,this.appSign=null,this.appFunName=null,this.bugout=null,this.supperStrongWeakNetWork=!1,this.videoCoding=VideoCodingType.H264,this.audioCoding=AudioCodingType.opus,this.audioAutoSub=!0,this.audioBatchEnabled=!1,this.enableEchoCancellation=!0,this.enableNoiseSuppression=!0,this.enableAutoGainControl=!0,this.simulcastEnabled=!1,this.dataCrypto=DataCryptoType.AES128,this.mediaConnectType=0,this.customerTokenEnabled=!1,this.cameraMap={},this.microphoneMap={},this.speakerMap={},this.hasCamera=!1,this.hasMicrophone=!1,this.hasSpeaker=!1,this.checkVideoStream=null,this.checkAudioStream=null,this.checkAudioLocalStatsCollector=null,this.checkMicrophoneId=null,this.checkMicrophoneName=null,this.mcuClusterRouteParams=null,this.defaultVideoParamsWidth=640,this.defaultVideoParamsHeight=480,this.defaultVideoParamsResolutionSetType=ResolutionSetType.ideal,this.defaultVideoParamsFrameRate=20,this.defaultScreenParamsWidth=1920,this.defaultScreenParamsHeight=1080,this.defaultScreenParamsFrameRate=10,this.defaultMediaPublishKeepAliveTime=15e3,this.detect=this.getBrowserDetect(),this.browserName=this.detect.browser.name,this.fullVersion=this.detect.browser.fullVersion,this.majorVersion=this.fullVersion.split(".")[0],this.browserOsName=this.detect.osName,this.isChrome=this.detect.isChrome,this.isOpera=this.detect.isOpera,this.isIE=this.detect.isIE,this.isFirefox=this.detect.isFirefox,this.isSafari=this.detect.isSafari,this.isMicroMessenger=this.detect.isMicroMessenger,this.isUCBrowser=this.detect.isUCBrowser,this.clientResource=new Object,this.restFullProtocol=null,this.applyToElectron=!1,this.electronProtocol="http:",this.electronManager=null,this.appender=new log4javascript.BrowserConsoleAppender,this.appender.setThreshold(log4javascript.Level.INFO),u(this.appender),this.loggerReport=new LoggerReport,this.eventEmitter=new EventEmitter,this.deviceChangeListener(),this.rooms=[],this.eraserCustomIconPath="",this.ignoreModifyResourceReq=!1,this.enableHardwareEncoding=!1,this.isSafari&&this.fullVersion&&"15"==this.fullVersion.split(".")[0]&&"1"==this.fullVersion.split(".")[1]&&(this.videoCoding=VideoCodingType.VP8),(this.isChrome&&"Android"==this.detect.osName||this.isMicroMessenger&&"Android"==this.detect.osName)&&(log.debug("===avdEngine, Android Chrome or Android MM detected, set default video codec to VP8"),this.videoCoding=VideoCodingType.VP8),log.info("===avdEngine, browserName:"+this.browserName+", fullVersion:"+this.fullVersion+", checkBrowserSupport:"+this.checkBrowserSupport()+", GetUserMedia:"+this.detect.getUserMediaSupport+", RTCPeerConnection:"+this.detect.RTCPeerConnectionSupport+", WebSocket:"+this.detect.WebSocketSupport),avdEngineHandle=this}function l(e,t){for(var r=null,n=0;n<t.length;n++){var o=t[n];if(o.id==e){r=o;break}}return r}function u(e){var t=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n");e.setLayout(t),log.addAppender(e)}return d.prototype.getVersion=function(){return"rtc-"+this.avdVersion},d.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},d.prototype.setApplyToElectron=function(e,t){log.info("===avdEngine.setApplyToElectron(),islectron:"+e+",protocolStr:"+t),this.logReportWait.push("avdEngine.setApplyToElectron(),islectron:"+e+",protocolStr:"+t),e&&(this.applyToElectron=e),t&&(this.electronProtocol=t,this.restServerInfo.protocolStr=t)},d.prototype.setRestFullProtocol=function(e){log.info("===avdEngine.setRestFullProtocol(),protocolStr:"+e),e&&(this.restFullProtocol=e)},d.prototype.getElectronManager=function(){return this.electronManager=new o,this.electronManager},d.prototype.setSimulcastEnabled=function(e){this.isChrome&&this.majorVersion<73?(this.simulcastEnabled=!1,log.info("===avdEngine.setSimulcastEnabled(),当前Chromer版本小于73，不支持视频多流功能"),this.logReportWait.push("avdEngine.setSimulcastEnabled(),当前Chromer版本小于73，不支持视频多流功能")):this.isFirefox?(this.simulcastEnabled=!1,log.info("===avdEngine.setSimulcastEnabled(),当前为firefox浏览器，不支持视频多流功能")):(this.simulcastEnabled=e,log.info("===avdEngine.setSimulcastEnabled(),设置视频是否开启多流:"+e),this.logReportWait.push("avdEngine.setSimulcastEnabled(),设置视频是否开启多流:"+e))},d.prototype.getSimulcastEnabled=function(){return this.simulcastEnabled},d.prototype.setAudioBatchEnabled=function(e){this.audioBatchEnabled=e,log.info("===avdEngine.setAudioBatchEnabled(),音频自动订阅时,多路音频是否开启批量订阅处理:"+e),this.logReportWait.push("avdEngine.setAudioBatchEnabled(),音频自动订阅时,多路音频是否开启批量订阅处理:"+e)},d.prototype.getAudioBatchEnabled=function(){return this.audioBatchEnabled},d.prototype.setCustomerTokenEnabled=function(e){this.customerTokenEnabled=e,log.info("===avdEngine.setCustomerTokenEnabled(), customerTokenEnabled:"+e)},d.prototype.getCustomerTokenEnabled=function(){return this.customerTokenEnabled},d.prototype.getBrowserDetect=function(){return this.browserDetect||(this.browserDetect=new t),this.browserDetect.detect},d.prototype.checkBrowserSupport=function(){return this.browserDetect||(this.browserDetect=new t),this.browserDetect.checkBrowserSupport()},d.prototype.checkBrowserPluginSupport=function(){return this.browserDetect||(this.browserDetect=new t),this.browserDetect.checkBrowserPluginSupport()},d.prototype.setLog=function(e,t){e==Appender.alert?this.appender=new log4javascript.AlertAppender:e==Appender.inpage?this.appender=new log4javascript.InPageAppender:e==Appender.popup?this.appender=new log4javascript.PopUpAppender:Appender.browserConsole,t==LogLevel.all?(this.levelValue=log4javascript.Level.ALL.level,this.appender.setThreshold(log4javascript.Level.ALL)):t==LogLevel.trace?(this.levelValue=log4javascript.Level.TRACE.level,this.appender.setThreshold(log4javascript.Level.TRACE)):t==LogLevel.debug?(this.levelValue=log4javascript.Level.DEBUG.level,this.appender.setThreshold(log4javascript.Level.DEBUG)):t==LogLevel.info?(this.levelValue=log4javascript.Level.INFO.level,this.appender.setThreshold(log4javascript.Level.INFO)):t==LogLevel.warn?(this.levelValue=log4javascript.Level.WARN.level,this.appender.setThreshold(log4javascript.Level.WARN)):t==LogLevel.error?(this.levelValue=log4javascript.Level.ERROR.level,this.appender.setThreshold(log4javascript.Level.ERROR)):t==LogLevel.fatal?(this.levelValue=log4javascript.Level.FATAL.level,this.appender.setThreshold(log4javascript.Level.FATAL)):t==LogLevel.off&&(this.levelValue=log4javascript.Level.OFF.level,this.appender.setThreshold(log4javascript.Level.OFF)),u(this.appender)},d.prototype.setBugout=function(e){this.bugout=new debugout,this.bugout.realTimeLoggingOn=!1,this.bugout.useTimestamps=!0,e&&(this.bugout.logFilename=e,log.info("===avdEngine.setBugout(),logFilename:"+e),this.logReportWait.push("avdEngine.setBugout(),logFilename:"+e))},d.prototype.setReportLogger=function(e,t){"string"!=typeof e?log.error("===avdEngine.setReportLogger(),appSign setting invalid"):"function"!=typeof t?log.error("===avdEngine.setReportLogger(),appFunName setting invalid"):(this.appSign=e,this.appFunName=t)},d.prototype.setVideoCoding=function(e){var t,r,n,o=when.defer();return void 0===e?(log.error("===avdEngine.setVideoCoding(),设置视频编解码失败。videoCodingType："+e),n=new i(ErrorConstant.set_videCoding_failed),o.reject(n)):(t=!1,r="",this.isSafari&&this.fullVersion&&"15"==this.fullVersion.split(".")[0]&&"1"==this.fullVersion.split(".")[1]&&e==VideoCodingType.H264&&(t=!0,r="In Safari 15.1.X, H264 encoding may cause page crash. Therefore, you are advised to set it to VP8"),t?(log.error("===avdEngine.setVideoCoding(),设置视频编解码失败."+r),(n=new i(ErrorConstant.set_videCoding_failed)).message=n.message+","+r,o.reject(n)):(this.videoCoding=e,log.info("===avdEngine.setVideoCoding(),设置视频编解码:"+this.videoCoding),this.logReportWait.push("avdEngine.setVideoCoding(),设置视频编解码:"+this.videoCoding),o.resolve())),o.promise},d.prototype.getVideoCoding=function(){return this.videoCoding},d.prototype.setAudioCoding=function(e){var t,r,n,o=when.defer();return void 0===e?(log.error("===avdEngine.setAudioCoding(),设置音频编解码失败。audioCodingType："+e),n=new i(ErrorConstant.set_audioCoding_failed),o.reject(n)):(t=!1,r="",this.isChrome&&110<=this.majorVersion&&(e!=AudioCodingType.ISAC_16k&&e!=AudioCodingType.ISAC_32k||(t=!0,r="Chrome version 110 no longer supports ISAC")),!this.isFirefox||e!=AudioCodingType.ISAC_16k&&e!=AudioCodingType.ISAC_32k||(t=!0,r="Firefox no longer supports ISAC"),this.isSafari&&e==AudioCodingType.ISAC_32k&&(t=!0,r="Safari no longer supports ISAC_32K"),t?(log.error("===avdEngine.setAudioCoding(),设置音频编解码失败."+r),(n=new i(ErrorConstant.set_audioCoding_failed)).message=n.message+","+r,o.reject(n)):(this.audioCoding=e,log.info("===avdEngine.setAudioCoding(),设置音频编解码:"+this.audioCoding),this.logReportWait.push("avdEngine.setAudioCoding(),设置音频编解码:"+this.audioCoding),o.resolve())),o.promise},d.prototype.getAudioCoding=function(){return this.audioCoding},d.prototype.setAudioAutoSub=function(e){this.audioAutoSub=e,log.info("===avdEngine.setAudioAutoSub(),设置音频自动订阅:"+e),this.logReportWait.push("avdEngine.setAudioAutoSub(),设置音频自动订阅:"+e)},d.prototype.getAudioAutoSub=function(){return this.audioAutoSub},d.prototype.setMediaConnectType=function(e){this.mediaConnectType=e,log.info("===avdEngine.setMediaConnectType(),设置媒体通道协议:"+this.mediaConnectType),this.logReportWait.push("avdEngine.setMediaConnectType(),设置媒体通道协议:"+this.mediaConnectType)},d.prototype.getMediaConnectType=function(){return this.mediaConnectType},d.prototype.setDataCryptoType=function(e){void 0===e?log.error("===avdEngine.setDataCryptoType(),设置数据加密类型失败。dataCryptoType："+e):(this.dataCrypto=e,log.info("===avdEngine.setDataCryptoType(),设置数据加密类型:"+this.dataCrypto),this.logReportWait.push("avdEngine.setDataCryptoType(),设置数据加密类型:"+this.dataCrypto))},d.prototype.getDataCryptoType=function(){return this.dataCrypto},d.prototype.getResolutionEnum=function(){var e=when.defer();return e.resolve(Resolution),e.promise},d.prototype.setMcuClusterRouteParams=function(e){this.mcuClusterRouteParams=e},d.prototype.setDefaultVideoParams=function(e,t,r,n){e&&(this.defaultVideoParamsWidth=e),t&&(this.defaultVideoParamsHeight=t),r&&(this.defaultVideoParamsResolutionSetType=r),n&&(this.defaultVideoParamsFrameRate=n),log.info("===avdEngine.setDefaultVideoParams(),设置视频相关的默认参数值,分辨率宽:"+e+",分辨率高:"+t+",分辨率设置类型:"+r+",视频帧率:"+n),this.logReportWait.push("avdEngine.setDefaultVideoParams(),设置视频相关的默认参数值,分辨率宽:"+e+",分辨率高:"+t+",分辨率设置类型:"+r+",视频帧率:"+n)},d.prototype.setDefaultScreenParams=function(e,t,r,n){e&&(this.defaultScreenParamsWidth=e),t&&(this.defaultScreenParamsHeight=t),n&&(this.defaultScreenParamsFrameRate=n),log.info("===avdEngine.setDefaultScreenParams(),设置桌面共享相关的默认参数值, 分辨率最大宽度:"+e+", 分辨率最大高度:"+t+", 最小帧率:"+r+", 最大帧率:"+n),this.logReportWait.push("avdEngine.setDefaultScreenParams(),设置桌面共享相关的默认参数值,分辨率最大宽度:"+e+",分辨率最大高度:"+t+",最小帧率:"+r+",最大帧率:"+n)},d.prototype.setDefaultMediaPublishKeepAliveTime=function(e){e&&(this.defaultMediaPublishKeepAliveTime=e),log.info("===avdEngine.setDefaultMediaPublishKeepAliveTime(),设置媒体流发布的保活时长(单位为毫秒), keepAliveTime:"+e)},d.prototype.init=function(e,t,r){var n=this,o=when.defer();return log.info("===avdEngine.init(),引擎初始化开始, serverURI:"+e+", accessToken:"+t+", isUseCascade:"+(r=void 0===r?!1:r)),this.logReportWait.push("avdEngine.init(),引擎初始化开始, serverURI:"+e+", accessToken:"+t+", isUseCascade:"+r),t&&e?(this.restServerInfo.mcuServerUrl=e,this.clientIsUseCascade=r,this.accessToken=t.replace(/%3D%3D/g,"=="),this.accessToken=this.accessToken.replace(/%3d%3d/g,"=="),(e={}).userAgent=navigator.userAgent,(r=new UAParser(navigator.userAgent))&&((t=r.getOS())&&(n.clientResource.os=t.name+"_"+t.version),t=r.getBrowser())&&(e.browser=t.name+"_"+t.version),n.detect.browser.isCustomized&&(e.browserShell=n.detect.browser.shellName+"_"+n.detect.browser.shellFullVersion),n.clientResource.endpoint=e,void 0!==navigator.Promise&&getLocalClientIP().then(function(e){log.debug("===avdEngine.init(),localClientIP:",e),n.clientResource.ips=e}),void 0!==navigator.connection&&(r=getEffectiveType(),log.debug("===avdEngine.init(),effectiveType:"+r),n.clientResource.net=r),log.debug("===avdEngine.init(),clientResource:"+JSON.stringify(n.clientResource)),log.info("===avdEngine.init(),引擎初始化成功"),this.logReportWait.push("引擎初始化成功！"),o.resolve()):(t=new i(ErrorConstant.avdEngine_init_failed),log.error("===avdEngine.init(), error, code:"+t.code+", message:"+t.message),o.reject(t)),o.promise},d.prototype.initWithOEM=function(e,t){var r=when.defer();return log.info("===avdEngine.initWithOEM(), OEM  init begin"),"qiniu.com"!=t?(t=new i(ErrorConstant.oemname_notfound),r.reject(t)):(this.restServerInfo.mcuServerUrl=e,this.restServerInfo.roomServerUrl=e,this.restServerInfo.isCluster=!0,r.resolve()),r.promise},d.prototype.obtainRoom=function(e){var t,r;if(null==e||""==e)t=new i(ErrorConstant.roomId_required),log.error("===avdEngine.obtainRoom() error, code:"+t.code+", message:"+t.message);else{if("string"==typeof e)return null==(r=l(e,this.rooms))&&(r=new n(e),this.rooms.push(r)),r;t=new i(ErrorConstant.exporter_parameter_type_error),log.error("===avdEngine.obtainRoom() error, code:"+t.code+", message:"+t.message+"[roomId需字符串类型]")}},d.prototype.getRoom=function(e){var t;if(null==e||""==e)t=new i(ErrorConstant.roomId_required),log.error("===avdEngine.getRoom() error, code:"+t.code+", message:"+t.message);else{if("string"==typeof e)return l(e,this.rooms);t=new i(ErrorConstant.exporter_parameter_type_error),log.error("===avdEngine.getRoom() error, code:"+t.code+", message:"+t.message+"[roomId需字符串类型]")}},d.prototype.getAllDevices=function(){var e,t=when.defer();return void 0!==navigator.mediaDevices?(log.debug("===avdEngine.getAllDevices(), by navigator.mediaDevices.enumerateDevices()"),navigator.mediaDevices.enumerateDevices().then(function(e){t.resolve(e)})):"undefined"!=typeof MediaStreamTrack?void 0!==MediaStreamTrack.getSources?(log.debug("===avdEngine.getAllDevices(),by MediaStreamTrack.getSources"),MediaStreamTrack.getSources(function(e){t.resolve(e)})):(e=new i(ErrorConstant.navigatorUserMediaError_notSupportedError),t.reject(e)):(e=new i(ErrorConstant.not_support_mediaStreamTrack),t.reject(e)),t.promise},d.prototype.initDevice=function(){var e,r=when.defer(),n=this;return log.info("===avdEngine.initDevice():Camera and Microphone begin..."),n.isChrome&&n.majorVersion<81?n.initDeviceHandler().then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}):n.isFirefox?(e={audio:{deviceId:"undefined"},video:{deviceId:"undefined"}},log.debug("===avdEngine.initDevice(),firefox constraints:"+JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(t){n.initDeviceHandler().then(function(e){t&&(t.getTracks().forEach(function(e){e.stop()}),t=null),r.resolve(e)}).otherwise(function(e){r.reject(e)})}).catch(function(e){log.error("===avdEngine.initDevice(),navigator.MediaDevices.getUserMedia of firfox error: ",e.message,e.name);var t=ModuleBase.use(ModulesEnum.error),e="NotSupportedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new t(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new t(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notFoundError):new t(ErrorConstant.navigatorUserMediaError_unknown);r.reject(e)})):n.checkDevice().then(function(e){if(e.deviceIdIsUndefined){log.debug("===AVDEngine.initDevice(),chrome Version >= 81 or Other browsers ,deviceId is Undefined");var t={};if(e.video&&(t.video={deviceId:"undefined"}),e.audio&&(t.audio={deviceId:"undefined"}),log.debug("===avdEngine.initDevice(),chrome version>=81 or Other browsers,constraints:"+JSON.stringify(t)),!e.video&&!e.audio)return r.resolve(1),r.promise;navigator.mediaDevices.getUserMedia(t).then(function(e){e&&(e.getTracks().forEach(function(e){e.stop()}),e=null),n.initDeviceHandler().then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)})}).catch(function(e){log.error("===avdEngine.initDevice(),navigator.MediaDevices.getUserMedia error: ",e.message,e.name);var t=ModuleBase.use(ModulesEnum.error),e="NotSupportedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new t(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new t(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notFoundError):new t(ErrorConstant.navigatorUserMediaError_unknown);r.reject(e)})}else log.debug("===AVDEngine.initDevice(),chrome Version >= 81 or Other browsers,deviceId is not Undefined"),n.initDeviceHandler().then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)})}).otherwise(function(e){r.reject(e)}),r.promise},d.prototype.initDeviceHandler=function(){var b=when.defer(),_=this;return this.getAllDevices().then(function(e){for(var t,r={},n=0,o={},i=0,a=null,s=null,d={},l=0,u=null,c=null,p=0;p!=e.length;++p){var h=e[p],f=h.deviceId||h.id;"videoinput"===h.kind||"video"===h.kind?(_.hasCamera=!0,n+=1,r[f]=h.label||"camera"+n):"audioinput"===h.kind||"audio"===h.kind?(_.hasMicrophone=!0,"default"==h.deviceId?(a=h.label.split(" - ")[1],s=h.groupId):(h.groupId==s&&h.label==a&&(i+=1,o[f]=h.label||"microphone"+i),h.groupId!=s&&(i+=1,o[f]=h.label||"microphone"+i))):"audiooutput"===h.kind&&(_.hasSpeaker=!0,"default"==h.deviceId?(u=h.label.split(" - ")[1],c=h.groupId):(h.groupId==c&&h.label==u&&(l+=1,d[f]=h.label||"speaker"+l),h.groupId!=c&&(l+=1,d[f]=h.label||"speaker"+l)))}for(t in _.cameraMap=r,log.info("===avdEngine.initDevice(),Camera finish,cameraMap:",JSON.stringify(r)),_.clientResource.cameras=[],r){var m=r[t],g=new Object;g.id=t,g.name=m,_.clientResource.cameras.push(g)}for(t in _.microphoneMap=o){m=o[t];_.checkMicrophoneId||(_.checkMicrophoneId=t,_.checkMicrophoneName=m);break}for(t in log.info("===avdEngine.initDevice(),Microphone finish,microphoneMap:",JSON.stringify(o)),_.clientResource.microphones=[],o){var m=o[t],y=new Object;y.id=t,y.name=m,_.clientResource.microphones.push(y)}for(t in _.speakerMap=d,log.info("===avdEngine.initDevice(),Speaker finish,speakerMap:",JSON.stringify(d)),_.clientResource.speakers=[],d){var m=d[t],v=new Object;v.id=t,v.name=m,_.clientResource.speakers.push(v)}b.resolve(1)}).otherwise(function(e){log.error("===avdEngine.initDevice() error, code:"+e.code+"; message:"+e.message),b.reject(e)}),b.promise},d.prototype.refreshDevice=function(){var e=when.defer(),g=this,y=[];for(key in g.microphoneMap)y.push(key);var v=[];for(key in g.cameraMap)v.push(key);return this.getAllDevices().then(function(e){for(var t,r={},n=0,o={},i=0,a=null,s=null,d={},l=0,u=null,c=null,p=0;p!=e.length;++p){var h=e[p],f=h.deviceId||h.id;"videoinput"===h.kind||"video"===h.kind?(n+=1,r[f]=h.label||"camera"+n):"audioinput"===h.kind||"audio"===h.kind?"default"==h.deviceId?(a=h.label.split(" - ")[1],s=h.groupId):(h.groupId==s&&h.label==a&&(i+=1,o[f]=h.label||"microphone"+i),h.groupId!=s&&(i+=1,o[f]=h.label||"microphone"+i)):"audiooutput"===h.kind&&("default"==h.deviceId?(u=h.label.split(" - ")[1],c=h.groupId):(h.groupId==c&&h.label==u&&(l+=1,d[f]=h.label||"speaker"+l),h.groupId!=c&&(l+=1,d[f]=h.label||"speaker"+l)))}for(t in!function(e,t,r,n){var o,i=[];for(o in t)i.push(o);var a=arrayUtil.inANotInB(i,e),s=arrayUtil.inANotInB(e,i);if(0==s.length&&0==a.length)return;{if(this.isSafari)return;for(var d=0;d<r.length;d++){var l=r[d];if(l.selfUser){if(0<a.length)for(var u=0;u<a.length;u++){var c=t[a[u]];n[a[u]]=c,l.selfUser.initVideo(a[u],c)}if(0<s.length)for(u=0;u<s.length;u++)delete n[s[u]],l.selfUser.deleteVideo(s[u])}}}}(v,r,g.rooms,g.cameraMap),o){var m=o[t];g.checkMicrophoneId=t,g.checkMicrophoneName=m;break}!function(e,t,r,n){var o,i=[];for(o in t)i.push(o);var a=arrayUtil.inANotInB(i,e),s=arrayUtil.inANotInB(e,i);if(0==s.length&&0==a.length)return;for(var d=0;d<this.rooms.length;d++){var l=r[d];if(l.selfUser){if(0<a.length)for(var u=0;u<a.length;u++){var c=t[a[u]];n[a[u]]=c}if(0<s.length)for(u=0;u<s.length;u++){c=n[s[u]];s[u]==self.checkMicrophoneId&&l.selfUser.deleteAudio(s[u]),delete n[s[u]]}}}}(y,o,g.rooms,g.microphoneMap),g.speakerMap=d}).otherwise(function(e){log.error("===avdEngine.refreshDevice(),get device error!error code:"+e.code+"; error message:"+e.message)}),setTimeout(function(){e.resolve()},2e3),e.promise},d.prototype.setRecordingMicrophone=function(t){log.info("===avdEngine.setRecordingMicrophone(),microphoneId:"+t);for(var r=this,e=0;e!=r.rooms.length;++e){var n,o,i,a=r.rooms[e];a&&a.selfUser&&((n=a.selfUser.audio)?t!=n.id&&(n.status==StreamStatus.init?(a.selfUser.deleteAudio(n.id),i=r.microphoneMap[t],a.selfUser.initAudio(t,i),r.checkMicrophoneId=t,r.checkMicrophoneName=i,log.info("===avdEngine.setRecordingMicrophone(),microphoneId:"+t+",microphoneName:"+i+" success!")):n.status!=StreamStatus.published&&n.status!=StreamStatus.muted||(o=n.element,n.closeMicrophone().then(function(){setTimeout(function(){a.selfUser.deleteAudio(n.id);var e=r.microphoneMap[t];a.selfUser.initAudio(t,e),a.selfUser.audio.openMicrophone(o),r.checkMicrophoneId=t,r.checkMicrophoneName=e,log.info("===avdEngine.setRecordingMicrophone(),microphoneId:"+t+",microphoneName:"+e+" success!")},600)}))):(i=r.microphoneMap[t],a.selfUser.initAudio(t,i)))}},d.prototype.checkDevice=function(){var o=when.defer();return log.debug("===checkDevice(),start..."),this.getAllDevices().then(function(e){for(var t={video:!1,audio:!1,speaker:!1,deviceIdIsUndefined:!1},r=0;r!=e.length;++r){var n=e[r];n.deviceId||n.id||(t.deviceIdIsUndefined=!0),"videoinput"===n.kind||"video"===n.kind?t.video=!0:"audioinput"===n.kind||"audio"===n.kind?t.audio=!0:"audiooutput"===n.kind&&(t.speaker=!0)}log.debug("===checkDevice(),sucess end..."),o.resolve(t)}).otherwise(function(e){log.debug("===checkDevice(),error end..."),o.reject(e)}),o.promise},d.prototype.checkOpenVideo=function(e,t,r){var n=when.defer(),o=this,i=(o.checkCloseVideo(),{video:{},audio:!1});e&&"undefined"!=e&&(i.video.deviceId={exact:e}),t&&(e=Resolution[t],i.video.width={min:e.width,max:e.width},i.video.height={min:e.height,max:e.height}),r&&(o.isChrome||o.isOpera)&&("string"==typeof r&&(r=Number(r)),i.video.frameRate={min:r,max:r});try{log.info("===avdEngine.checkOpenVideo(),constraints:"+JSON.stringify(i)),navigator.mediaDevices.getUserMedia(i).then(function(e){o.checkVideoStream=e,n.resolve(e)}).catch(function(e){var t=ModuleBase.use(ModulesEnum.error),t="NotSupportedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new t(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new t(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notFoundError):new t(ErrorConstant.navigatorUserMediaError_unknown);log.error("===avdEngine.checkOpenVideo(),errorName:"+e.name),n.reject(t)})}catch(e){t=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n.reject(t)}return n.promise},d.prototype.checkOpenAudio=function(t){var r=when.defer(),n=this,e=(n.checkCloseAudio(),{video:!1,audio:{}});t&&"undefined"!=t&&(e.audio.deviceId={exact:t});try{log.info("===avdEngine.checkOpenAudio(),constraints:"+JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(e){n.checkAudioStream=e,r.resolve(e)}).catch(function(e){var t=ModuleBase.use(ModulesEnum.error),e="NotSupportedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new t(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new t(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notFoundError):new t(ErrorConstant.navigatorUserMediaError_unknown);r.reject(e)})}catch(e){t=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);r.reject(t)}return r.promise},d.prototype.checkOpenVideoAndAudio=function(e,t,r,n){var a=when.defer(),s=this,o=(s.checkCloseVideo(),s.checkCloseAudio(),{video:{},audio:{}});e&&"undefined"!=e&&(o.video.deviceId={exact:e}),t&&"undefined"!=t&&(o.audio.deviceId={exact:t}),r&&(e=Resolution[r],o.video.width={min:e.width,max:e.width},o.video.height={min:e.height,max:e.height}),n&&(s.isChrome||s.isOpera)&&("string"==typeof n&&(n=Number(n)),o.video.frameRate={min:n,max:n});try{log.info("===avdEngine.checkOpenVideoAndAudio(),constraints:"+JSON.stringify(o)),navigator.mediaDevices.getUserMedia(o).then(function(e){var t=new MediaStream,r=new MediaStream;if(e){for(var n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);for(var i=e.getVideoTracks(),o=0;o<i.length;o++)r.addTrack(i[o])}e={audioStream:t,videoStream:r};s.checkVideoStream=e.videoStream,s.checkAudioStream=e.audioStream,a.resolve(e)}).catch(function(e){var t=ModuleBase.use(ModulesEnum.error),e="NotSupportedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new t(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new t(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new t(ErrorConstant.navigatorUserMediaError_notFoundError):new t(ErrorConstant.navigatorUserMediaError_unknown);a.reject(e)})}catch(e){t=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);a.reject(t)}return a.promise},d.prototype.checkAudioLevel=function(e,t){this.checkAudioStream&&(checkAudioLocalStatsCollector=new LocalStatsCollector(this.checkAudioStream,e,t)).start()},d.prototype.checkCloseVideo=function(){this.checkVideoStream&&(this.checkVideoStream.getTracks().forEach(function(e){e.stop()}),log.debug("===avdEngine.checkCloseVideo finished")),this.checkVideoStream=null},d.prototype.checkCloseAudio=function(){this.checkAudioLocalStatsCollector&&this.checkAudioLocalStatsCollector.stop(),this.checkAudioLocalStatsCollector=null,this.checkAudioStream&&(this.checkAudioStream.getTracks().forEach(function(e){e.stop()}),log.debug("===avdEngine.checkCloseAudio() finished")),this.checkAudioStream=null},d.prototype.getStreamExporterManager=function(){return new r},d.prototype.deviceChangeListenerHandler=function(){var l=this,u=(log.debug("===avdEngine.deviceChangeListenerHandler(), device change detected."),Object.keys(l.microphoneMap)),c=Object.keys(l.cameraMap),p=null;l.initDeviceHandler().then(function(e){if(1==e){if(p=Object.keys(l.microphoneMap),o=Object.keys(l.cameraMap),p.length>u.length){e=p.filter(function(t){return u.findIndex(function(e){return t===e})<0});log.debug("===avdEngine.deviceChangeListenerHandler(), Microphone device change detected. type:add, deviceIds: "+e),l.eventEmitter.emit(EngineCallback.device_microphone_change,changeTypeEnum.add,e)}else if(p.length<u.length){var t=u.filter(function(t){return p.findIndex(function(e){return e===t})<0});if(log.debug("===avdEngine.deviceChangeListenerHandler(), Microphone device change detected. type:remove, deviceIds: "+t),l.eventEmitter.emit(EngineCallback.device_microphone_change,changeTypeEnum.remove,t),0<t.length)for(var r=0;r<t.length;r++)if(t[r]==l.checkMicrophoneId)for(var n=0;n<l.rooms.length;n++)(d=l.rooms[n]).selfUser&&d.selfUser.deleteAudio(t[r])}if(o.length>c.length){var o=o.filter(function(t){return c.findIndex(function(e){return t===e})<0});log.debug("===avdEngine.deviceChangeListenerHandler(), Camera device change detected. type:add, deviceIds: "+o),l.eventEmitter.emit(EngineCallback.device_camera_change,changeTypeEnum.add,o);for(r=0;r<o.length;r++)for(var i=o[r],a=l.cameraMap[i],n=0;n<l.rooms.length;n++)(d=l.rooms[n]).selfUser&&d.selfUser.initVideo(i,a)}else if(o.length<c.length){var s=c.filter(function(t){return o.findIndex(function(e){return e===t})<0});log.debug("===avdEngine.deviceChangeListenerHandler(), Camera device change detected. type: remove, deviceIds: "+s),l.eventEmitter.emit(EngineCallback.device_camera_change,changeTypeEnum.remove,s);for(r=0;r<s.length;r++)for(var d,i=s[r],n=0;n<l.rooms.length;n++)(d=l.rooms[n]).selfUser&&d.selfUser.deleteVideo(i)}}})},d.prototype.deviceChangeListener=function(){var e=this;navigator&&navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=debounce(function(){e.deviceChangeListenerHandler()},2e3))},d.prototype.setEchoCancellation=function(e){"boolean"!=typeof e?log.error("===avdEngine.setEchoCancellation() faild, true or false is needed"):(log.info("===avdEngine.setEchoCancellation(), enable: "+e),this.enableEchoCancellation=e)},d.prototype.setNoiseSuppression=function(e){"boolean"!=typeof e?log.error("===avdEngine.setNoiseSuppression() faild, true or false is needed"):(log.info("===avdEngine.setNoiseSuppression(), enable: "+e),this.enableNoiseSuppression=e)},d.prototype.setAutoGainControl=function(e){"boolean"!=typeof e?log.error("===avdEngine.setAutoGainControl() faild, true or false is needed"):(log.info("===avdEngine.setAutoGainControl(), enable: "+e),this.enableAutoGainControl=e)},d.prototype.setIgnoreModifyResourceReq=function(e){"boolean"!=typeof e?log.error("===avdEngine.setIgnoreModifyResourceReq() faild, true or false is needed"):(log.info("===avdEngine.setIgnoreModifyResourceReq(), isIgnore: "+e),this.ignoreModifyResourceReq=e)},d.prototype.setEnableHardwareEncoding=function(e){var t=getGPUInfo();log.info("===avdEngine.setEnableHardwareEncoding(), isEnable: ",e,", current gpu info is: ",t),"boolean"!=typeof e?log.error("===avdEngine.setEnableHardwareEncoding() faild, true or false is needed"):!0===e&&-1<t.indexOf("Intel(R) HD Graphics")?log.error("===avdEngine.setEnableHardwareEncoding() faild, Detected Intel graphics card, ignored"):this.enableHardwareEncoding=e},d}),ModuleBase.define("Room",["SignalFactory","RestServer","MasterServer","P2PServer","User","Error"],function(e,s,n,t,d,l){function r(e){this.id=e,this.roomTocken=null,this.signalTocken=null,this.outgoingAddr=null,this.userAgent=USER_AGENT_AVD_DEFAULT,this.roomPassword=null,this.pingTimeout,this.pingInterval,this.pingCountTime=0,this.pingIntervalId=null,this.pingTimeoutId=null,this.lastPDUSeq=0,this.roomInfo=null,this.status=RoomStatus.opening,this.appData={},this.selfUser=null,this.participants=[],this.muteSpeakerFlag=!1,this.masterServer=null,this.p2pServer=null,this.cmdProtobufCoded=null,this.setRemoteDescriptionSuccess=!1,this.addIcecandidateList=[],this.traceablePeerConnection=null,this.traceableP2PPeerConnection=null,this.eventEmitter=new EventEmitter,this.fingerPrint,this.setup,this.iceUfrag,this.icePwd,this.codecPayloadVP8=null,this.codecPayloadVP9=null,this.codecPayloadH264=null,this.codecPayloadAV1=null,this.codecPayloadISAC_16K=null,this.codecPayloadISAC_32K=null,this.codecPayloadOpus=null,this.codecPayloadG722=null,this.codecPayloadPCMU=null,this.codecPayloadPCMA=null,this.codecPayloadCN_8k=null,this.codecPayloadCN_16k=null,this.codecPayloadCN_32k=null,this.versionToServer,this.audioCodecPayloadMap,this.remoteSdpTemplate,this.videoMediaTemplate,this.audioMediaTemplate,this.remoteDescriptionSDP,this.midNum=1,this.midObjSet=[{mid:0,type:"audio",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}},{mid:1,type:"video",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}}],this.audioMediaSDPInit,this.videoMediaSDPInit,this.mediaMid=0,this.connectionInfoCollector=null,this.audioLevel=null,this.connectionStatistics=null,this.toMCUReconnectionPC=null,this.isExistReJoinState=!1,this.reconnectMaxTimes=3,this.reconnectTimeout=15e3,this.currentReconnectTimes=0,this.currentConnectTimeout=0,this.connectionState=0,this.rejoinTimeout=6e4,this.currentRejoinTimeout=0,this.rejoinAlways=!1,this.rejoinInterval=3e3,this.rejoinLastTimeStamp=null,this.rejoinTemp,this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],this.pubVideos=[],this.pubAudios=[],this.pubScreens=[],this.currMinBandwidth=null,this.currMaxBandwidth=null,this.currScreenMinBandwidth=1200,this.currScreenMaxBandwidth=3200,this.currScreenHandle=!1,this.updateMinBandwidth=null,this.videoSsrc2user={},this.audioSsrc2user={},this.screenSsrc2user={},this.videoSsrc2deviceId={},this.addSdpLocalStates=0,log.debug("===DDDDDDDDDDDDD init this.addSdpLocalStates:"+this.addSdpLocalStates),this.boardId2userId={},this.annotation2boardId={},this.style2annotation={},this.isDoPDUSeq=0,this.videoSsrc=null,this.audioSsrc=null,this.updateTimer=null,this.boardOutputXRatio=1,this.boardOutputYRatio=1,this.boardInputXRatio=1,this.boardInputYRatio=1,this.baseMediaPalyEventStopTime=null,this.mediaPalyEventStopIntervalId=null,this.cameraId2uuid={},this.microphoneId2uuid={},this.speakerId2uuid={},this.mp4ImporterUserAudioStateIntervalId=null,this.mp4ImporterUserAudioRtpPacketTemp=0,this.mp4ImporterUserAudioRtpPacketReal=0,this.mp4ImporterUserAudioRate=20,this.websocketConnectTime=0,this.roomJoinState=RoomStateEnum.DISCONNECTED,this.isReceivedAddBoardId="",this.isReceivedRemoveBoardId="",this.clientSetSpeakerDeviceId=null,this.clientSetSpeakerVolume=null,this.boardAddOrShareMsgMap=new Map,this.boardCloseOrRemoveMsgMap=new Map}return r.prototype.setUserAgent=function(e){this.userAgent=e},r.prototype.setReconnectMaxTimes=function(e){log.info("===room.setReconnectMaxTimes(),count:"+e),this.reconnectMaxTimes=e},r.prototype.setReconnectTimeout=function(e){log.info("===room.setReconnectTimeout(),timeout:"+e),this.reconnectTimeout=e},r.prototype.MaxReconnectTimeout=function(e){log.info("===room.MaxReconnectTimeout(),pingInterval:"+e),this.reconnectTimeout<3*e&&(this.reconnectTimeout=3*e,log.info("===room.MaxReconnectTimeout(),reconnectTimeout:"+this.reconnectTimeout))},r.prototype.joinEfficient=function(e,t,r,n,o,i){var a=when.defer(),s=this;return avdEngineHandle.init(e,t,!1).then(function(){s.join(r,n,o,i).then(function(){a.resolve()}).otherwise(function(e){s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e)})}).otherwise(function(e){s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e)}),a.promise},r.prototype.serverinfoHandle=function(){log.info("===room.serverinfoHandle()...");var t=this,r=when.defer(),e=null;return(e=avdEngineHandle.applyToElectron?new s(avdEngineHandle.electronProtocol):avdEngineHandle.restFullProtocol?new s(avdEngineHandle.restFullProtocol):new s).getServerinfo(avdEngineHandle.restServerInfo.mcuServerUrl,avdEngineHandle.accessToken,avdEngineHandle.isUseCascade,t.id).then(function(){!avdEngineHandle.restServerInfo.notQueryGetMcu&&avdEngineHandle.restServerInfo.isCluster?(log.info("===room.serverinfoHandle(),restServer.getMcu()"),e.getMcu(t.id,avdEngineHandle.accessToken,avdEngineHandle.clientIsUseCascade).then(function(){r.resolve()}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,r.reject(e)})):r.resolve()}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,log.error("===room.serverinfoHandle(),restServer.getServerinfo()失败！error:"+e.message),r.reject(e)}),r.promise},r.prototype.websocketConnect=function(r){var n=this;r=r||when.defer(),n.masterServer&&n.masterServer.signalingChannel&&n.masterServer.signalingChannel.close();var o=(new e).getDataChannel(SignalType.websocket,n);return o.connect().then(function(e){n.currentReconnectTimes=0,n.currentConnectTimeout=0,r.resolve(e)}).otherwise(function(e){o.close(),0===n.currentConnectTimeout&&(n.currentConnectTimeout=new Date);var t=new Date-n.currentConnectTimeout;0<n.currentReconnectTimes&&log.error("===room.websocketConnect(),Websocket第"+n.currentReconnectTimes+"次重连,累计耗时"+t+"毫秒"),n.currentReconnectTimes<n.reconnectMaxTimes||t<n.reconnectTimeout?(n.currentReconnectTimes++,n.websocketConnect(r)):(n.roomJoinState=RoomStateEnum.DISCONNECTED,r.reject())}),r.promise},r.prototype.join=function(r,n,o,i){var e,a=when.defer(),s=this;if(s.roomJoinState!=RoomStateEnum.CONNECTING&&s.roomJoinState!=RoomStateEnum.CONNECTED)return s.roomJoinState=RoomStateEnum.CONNECTING,null==r||""==r?(e=new l(ErrorConstant.userId_required),log.error("===room.join() error, code:"+e.code+", message:"+e.message),s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e)):"string"!=typeof r?((e=new l(ErrorConstant.exporter_parameter_type_error)).message=e.message+"[ UserId required string type]",log.error("===room.join() error, code:"+e.code+", message:"+e.message),s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e)):(void 0===o&&(o=""),void 0===i&&(i=""),s.serverinfoHandle().then(function(){if(avdEngineHandle.loggerReportConfig.open_logger&&1==parseInt(avdEngineHandle.loggerReportConfig.open_logger)){avdEngineHandle.loggerReport.start();for(var e=0;e<avdEngineHandle.logReportWait.length;e++){var t=avdEngineHandle.logReportWait[e];avdEngineHandle.loggerReport.info(t)}}log.info("===room.join(), JS SDK 版本号："+avdEngineHandle.getVersion()),avdEngineHandle.loggerReport.info("JS SDK 版本号："+avdEngineHandle.getVersion()),log.info("===room.join(), 浏览器内核名称："+avdEngineHandle.browserName+", 内核版本:"+avdEngineHandle.fullVersion+", 操作系统名称:"+avdEngineHandle.browserOsName+" "+avdEngineHandle.detect.osVersion+", checkBrowserSupport:"+avdEngineHandle.checkBrowserSupport()+", GetUserMedia:"+avdEngineHandle.detect.getUserMediaSupport+", RTCPeerConnection:"+avdEngineHandle.detect.RTCPeerConnectionSupport+", WebSocket:"+avdEngineHandle.detect.WebSocketSupport),avdEngineHandle.loggerReport.info("浏览器内核名称："+avdEngineHandle.browserName+", 内核版本:"+avdEngineHandle.fullVersion+", 操作系统名称:"+avdEngineHandle.browserOsName),avdEngineHandle.isFirefox&&"Android"==avdEngineHandle.browserOsName&&avdEngineHandle.videoCoding==VideoCodingType.VP8&&(log.info("===room.join(), Android Firefox不支持VP8, 自动调整成H264"),avdEngineHandle.videoCoding=VideoCodingType.H264),log.info("===room.join(), 视频编解码:"+avdEngineHandle.videoCoding),avdEngineHandle.loggerReport.info("视频编解码:"+avdEngineHandle.videoCoding),log.info("===room.join(), 音频编解码:"+avdEngineHandle.audioCoding),avdEngineHandle.loggerReport.info("音频编解码:"+avdEngineHandle.audioCoding),avdEngineHandle.restServerInfo.isCluster?(log.info("===room.join(), 服务器是集群版本"),avdEngineHandle.loggerReport.info("room.join(),服务器是集群版本")):(log.info("===room.join(), 服务器是单机版本"),avdEngineHandle.loggerReport.info("room.join(),服务器是单机版本")),avdEngineHandle.restServerInfo.masterVersion&&(log.info("===room.join(), 服务器端 masterVersion:"+avdEngineHandle.restServerInfo.masterVersion),avdEngineHandle.loggerReport.info(" 服务器端masterVersion:"+avdEngineHandle.restServerInfo.masterVersion)),avdEngineHandle.restServerInfo.masterPackageVersion&&(log.info("===room.join(), 服务器端 masterPackageVersion:"+avdEngineHandle.restServerInfo.masterPackageVersion),avdEngineHandle.loggerReport.info(" 服务器端masterPackageVersion:"+avdEngineHandle.restServerInfo.masterPackageVersion)),avdEngineHandle.restServerInfo.boxVersion&&(log.info("===room.join(), 服务器端 boxVersion:"+avdEngineHandle.restServerInfo.boxVersion),avdEngineHandle.loggerReport.info(" 服务器端boxVersion:"+avdEngineHandle.restServerInfo.boxVersion)),avdEngineHandle.restServerInfo.boxPackageVersion&&(log.info("===room.join(), 服务器端 boxPackageVersion:"+avdEngineHandle.restServerInfo.boxPackageVersion),avdEngineHandle.loggerReport.info(" 服务器端boxPackageVersion:"+avdEngineHandle.restServerInfo.boxPackageVersion)),s.doJoin(r,n,o,i,a)}).otherwise(function(e){var t;e?(log.error("===room.join(), error, code:"+e.code+", message:"+e.message),a.reject(e)):(t=new l(ErrorConstant.avdEngine_init_failed),log.error("===room.join(), error, code:"+e.code+", message:"+e.message),a.reject(t))})),a.promise;log.debug("===room.join(), return by curr room state:",s.roomJoinState)},r.prototype.joinWithOEM=function(e,t,r,n,o){var i=when.defer(),a=this;return(new s).getMcuWithOEM(a.id,o).then(function(){a.doJoin(e,t,r,n,i)}).otherwise(function(e){i.reject(e)}),i.promise},r.prototype.doJoin=function(e,t,r,n,o){var i=this,a=avdEngineHandle.getBrowserDetect();i.roomPassword=n,i.selfUser=new d(e,t,r,i),i.selfUser.userAgent=i.userAgent,a.isWebRecord&&(i.selfUser.userAgent=USER_AGENT_AVD_WEB_RECORD,i.userAgent=USER_AGENT_AVD_WEB_RECORD),i.websocketConnect().then(function(e){i.openReqSend(webSocket).then(function(e){i.roomJoinState=RoomStateEnum.CONNECTED,o.resolve(e)}).otherwise(function(e){log.error("===room.doJoin(),openReqSend faild, reason: "+JSON.stringify(e)),i.roomJoinState=RoomStateEnum.DISCONNECTED,o.reject(e)})}).otherwise(function(){log.error("===room.doJoin(),登录加会超时："+ErrorConstant.join_room_timeout.code),avdEngineHandle.loggerReport.debug("room.doJoin(),登录加会超时."),i.roomJoinState=RoomStateEnum.DISCONNECTED;var e=new l(ErrorConstant.join_room_timeout);o.reject(e)})},r.prototype.reconnectionHandle=function(){var t=this;t.connectionState=1,t.websocketConnect().then(function(e){log.info("===WebSocket,room.reconnectionHandle(),websocket重连成功"),t.masterServer.pingInit(),t.masterServer.signalingChannel=e,log.info("===WebSocket,room.reconnectionHandle(),to masterServer.openReqReconnectionSend()"),t.openReqReconnectionSend().then(function(){log.debug("===WebSocket,room.reconnectionHandle(),OPEN_RQP Send, acception OPEN_REP result=0")}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,log.info("===WebSocket,room.reconnectionHandle(),OPEN_RQP 发送失败,进行重新加会处理。 reason: "+JSON.stringify(e)),log.debug("===Room.reconnectionHandle(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),t.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),t.roomJoinState!=RoomStateEnum.RECONNECTING&&(log.info("===to room.reJoin() by room.reconnectionHandle(),openReqReconnectionSend() failed"),t.reJoin())})}).otherwise(function(){log.info("===WebSocket,room.reconnectionHandle(),websocket重连超出预设次数及超时,进行重新加会处理。"),log.debug("===Room.reconnectionHandle(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),t.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),t.roomJoinState!=RoomStateEnum.RECONNECTING&&(log.info("===to room.reJoin() by room.reconnectionHandle(), websocketConnect() failed"),t.reJoin())})},r.prototype.reJoin=function(){var e,t=this;log.info("===room.reJoin(), current roomJoinState: "+t.roomJoinState),t.roomJoinState==RoomStateEnum.RECONNECTING?log.debug("===room.rejoin(), roomJoinState is reconnecting to return"):(0==t.currentRejoinTimeout&&(t.currentRejoinTimeout=new Date),e=new Date-t.currentRejoinTimeout,log.info("===room.reJoin(), duration since first rejoin: "+e+",rejoinTimeout: "+t.rejoinTimeout),0==t.rejoinAlways?e>t.rejoinTimeout?(log.info("===room.reJoin(), rejoinAlways false, rejoinTimeout, rejoinDurationFromFirst: "+e),log.debug("===Room.reJoin(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.reJoinRoomTimeOut),t.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinRoomTimeOut)):(log.info("===room.reJoin(), rejoinAlways false, to room.reJoinHandle()"),t.rejoinLastTimeStamp=new Date,t.reJoinHandle()):t.rejoinLastTimeStamp?(e=new Date-t.rejoinLastTimeStamp)<t.rejoinInterval?(e=t.rejoinInterval-e,clearTimeout(t.rejoinTemp),t.rejoinTemp=setTimeout(function(){t.rejoinLastTimeStamp=new Date,log.info("===room.reJoin(), rejoinAlways true, rejoinInterval Not established, by setTimeout  to room.reJoinHandle()"),t.reJoinHandle()},e)):(log.info("===room.reJoin(), rejoinAlways true, rejoinInterval established, to room.reJoinHandle()"),t.rejoinLastTimeStamp=new Date,t.reJoinHandle()):(log.info("===room.reJoin(), rejoinAlways true, self.rejoinLastTimeStamp is null, to room.reJoinHandle()"),t.rejoinLastTimeStamp=new Date,t.reJoinHandle()))},r.prototype.reJoinHandle=function(){var r=this;if(log.info("===room.reJoinHandle()..."),r.connectionInfoCollector&&r.connectionInfoCollector.stop(),r.connectionStatistics&&r.connectionStatistics.stop(),r.connectionState=2,r.roomJoinState=RoomStateEnum.RECONNECTING,r.isDoPDUSeq=0,r&&r.participants&&0<r.participants.length&&r.participants.forEach(function(e){e.id!=r.selfUser.id&&arrayUtil.objectSplice(r.participants,e.id)}),!(r.selfUser.reJoinPubVideoIds&&0<r.selfUser.reJoinPubVideoIds.length)){r.selfUser.reJoinPubVideoIds=[],r.selfUser.reJoinPubVideoElements=[];var e=r.pubVideos;if(e&&0<e.length){log.debug("===room.reJoinHandle(),重新加会初始化videos之前先把自己pub的视频unpub掉，room.pubVideos.length:"+e.length);for(var t,n=0;n<e.length;n++)e[n].ownerId==r.selfUser.id&&(t=r.selfUser.getVideo(e[n].id),r.selfUser.reJoinPubVideoIds.push(e[n].id),r.selfUser.reJoinPubVideoElements.push(t.element),t)&&(log.debug("===room.reJoinHandle(),重新加会初始化videos之前先把自己pub的视频unpub掉,selfUser.video.id:"+e[n].id),0<(t=r.selfUser.stream.getVideoTracks()).length&&t.forEach(function(e){e.stop()}),log.info("===video.unpublish()不会被执行，因为当前是在重新加会的流程中，这里不需要执行。"))}}if(!r.selfUser.reJoinPubAudioId||""==r.selfUser.reJoinPubAudioId){r.selfUser.reJoinPubAudioId="";var o=r.pubAudios;if(o&&0<o.length){log.debug("===room.reJoinHandle(),重新加会初始化audio之前先把自己pub的音频unpub掉,room.pubAudios.length:"+o.length);for(var i,n=0;n<o.length;n++)o[n].ownerId==r.selfUser.id&&(i=r.selfUser.getAudio(o[n].id),r.selfUser.reJoinPubAudioId=o[n].id,i)&&(i.status===StreamStatus.muted&&(log.debug("===room.reJoinHandle(),后重新加会初始化audio之前先把自己pub的音频unpub掉,当前audio的状态为Mute"),r.selfUser.reJoinPubAudioButMute=!0),log.debug("===room.reJoinHandle(),后重新加会初始化audio之前先把自己pub的音频unpub掉,selfUser.audio.id:"+o[n].id),0<(i=r.selfUser.stream.getAudioTracks()).length&&i.forEach(function(e){e.stop()}),log.info("===audio.closeMicrophone()不会被执行，因为当前是在重新加会的流程中，这里不需要执行。"))}}var a=r.pubScreens;if(a&&0<a.length){log.debug("===room.reJoinHandle(),重新加会初始化screen之前先把自己pub的桌面共享unpub掉,room.pubScreens.length:"+a.length);for(n=0;n<a.length;n++)a[n].ownerId==r.selfUser.id&&r.selfUser.getScreen(a[n].id)&&(log.debug("===room.reJoinHandle(),重新加会初始化screen之前先把自己pub的桌面共享unpub掉,selfUser.screen.id:"+a[n].id),r.selfUser.reJoinPubScreenStram=r.selfUser.screenStream,log.info("===screen.unpublish()不会被执行，因为当前是在重新加会的流程中，这里不需要执行。"))}clearTimeout(r.reJoinAfterTimer),r.reJoinAfterUsers=[],r.selfUser&&r.selfUser.toMCUPC&&(r.selfUser.toMCUPC.msgQueue=[],r.selfUser.toMCUPC.close(),r.selfUser.toMCUPC=null),log.debug("===room.reJoinHandle(),重新加会之前sub的视频subVideoIds:"+JSON.stringify(r.selfUser.subVideoIds)),r.selfUser.reJoinSubVideoIds=r.selfUser.subVideoIds,log.debug("===room.reJoinHandle(),重新加会之前sub的音频subAudioIds:"+JSON.stringify(r.selfUser.subAudioIds)),r.selfUser.reJoinSubAudioIds=r.selfUser.subAudioIds,log.debug("===room.reJoinHandle(),重新加会之前sub的桌面共享subScreenIds:"+JSON.stringify(r.selfUser.subScreenIds)),r.selfUser.reJoinSubScreenIds=r.selfUser.subScreenIds,r.selfUser.init();var s=avdEngineHandle.getBrowserDetect(),d=(r.selfUser.userAgent=r.userAgent,s.isWebRecord&&(r.selfUser.userAgent=USER_AGENT_AVD_WEB_RECORD,r.userAgent=USER_AGENT_AVD_WEB_RECORD),when.defer());return r.toMCUReconnectionPC&&(r.traceablePeerConnection.close(r.toMCUReconnectionPC),r.toMCUReconnectionPC.msgQueue=[],r.toMCUReconnectionPC=null),r.serverinfoHandle().then(function(){r.websocketConnect().then(function(e){r.openReqSend(e).then(function(e){r.pingTimeout=e.pingTimeout,r.pingInterval=e.pingInterval,r.signalTocken=e.signalTocken,r.masterServer=e.masterServer,r.pubVideos=[],r.pubAudios=[],r.pubScreens=[],r.midNum=1,r.midObjSet=[{mid:0,type:"audio",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}},{mid:1,type:"video",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}}],r.roomJoinState=RoomStateEnum.CONNECTED,d.resolve(r)}).otherwise(function(e){r.roomJoinState=RoomStateEnum.DISCONNECTED,log.debug("===room.reJoinHandle(),openReqSend faild, reason: "+JSON.stringify(e)),r.reJoin(),d.reject(e)})}).otherwise(function(e){r.roomJoinState=RoomStateEnum.DISCONNECTED,log.debug("===room.reJoinHandle(),websocketConnect faild, reason: "+JSON.stringify(e)),r.reJoin(),d.reject(e)})}).otherwise(function(e){var t;log.debug("===room.reJoinHandle(),serverinfoHandle faild, reason: "+JSON.stringify(e)),r.roomJoinState=RoomStateEnum.DISCONNECTED,e?log.error("===room.reJoinHandle(), error code:"+e.code+", error message:"+e.message):(t=new l(ErrorConstant.avdEngine_init_failed),log.error("===room.reJoinHandle(), error code:"+(e=t).code+", error message:"+e.message)),r.reJoin(),d.reject(e)}),d.promise},r.prototype.continuousReJoin=function(){this.rejoinAlways||(log.info("===room.continuousReJoin(),重新加会超时后,开启持续永久重新加会"),this.rejoinAlways=!0,avdEngineHandle.setRemoteDescriptionSuccess=!1,this.addSdpLocalStates=0,log.debug("===DDDDDDD0000000000,room.continuousReJoin(),this.addSdpLocalStates:",this.addSdpLocalStates),addIcecandidateList=[],this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],this.reJoin())},r.prototype.getMcuByReJoin=function(){var t=this,e=when.defer();return(new s).getMcu(t.id,avdEngineHandle.accessToken).then(function(){log.debug("===room.getMcuByReJoin(),  getMcu success"),t.reJoin()}).otherwise(function(e){log.error("===room.getMcuByReJoin(), getMcu error,code:"+e.code+",message:"+e.message),t.reJoin()}),e.promise},r.prototype.getRoomId=function(){return this.roomInfo.room_id},r.prototype.getRoomTopic=function(){return this.roomInfo.topic},r.prototype.getOwnerId=function(){return this.roomInfo.owner_id},r.prototype.isMcu=function(){var e,t=!0;return(null==this.roomInfo||3!=(e=this.roomInfo.room_mode)&&4!=e)&&t},r.prototype.getRoomType=function(e){var t,r=!1;return this.roomInfo&&this.roomInfo.room_type&&(t=this.roomInfo.room_type.toString(2),e==RoomTypeEnum.join_host_first?r=this.isHasPrivilige(roomTypePrivilige.join_host_first,t):e==RoomTypeEnum.net_acc?r=this.isHasPrivilige(roomTypePrivilige.net_acc,t):e==RoomTypeEnum.host_control?r=this.isHasPrivilige(roomTypePrivilige.host_control,t):e==RoomTypeEnum.free_speech&&(r=!this.isHasPrivilige(roomTypePrivilige.host_control,t))),r},r.prototype.isHasPrivilige=function(e,t){return 0<(e&t)?!0:!1},r.prototype.getMaxAudio=function(){return this.roomInfo.max_audio},r.prototype.getMaxVideo=function(){return this.roomInfo.max_video},r.prototype.getMaxAttendee=function(){return this.roomInfo.attendee_max},r.prototype.getUsableVideo=function(){var e=this.getMaxVideo()-this.pubVideos.length;return e=e<0?0:e},r.prototype.getUsableAudio=function(){var e=this.getMaxAudio()-this.pubAudios.length;return e=e<0?0:e},r.prototype.updateRoomStatus=function(e){this.status=e},r.prototype.getRoomStatus=function(){return this.status},r.prototype.getSelfUser=function(){return this.selfUser},r.prototype.getSelfUserId=function(){return this.selfUser.id},r.prototype.getParticipants=function(){return this.participants},r.prototype.getUser=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.id==e){t=n;break}}return t},r.prototype.getUserByUserIdAndNodeId=function(e,t){for(var r,n=0;n<this.participants.length;n++){var o=this.participants[n];if(o.id==e&&o.nodeId==t){r=o;break}}return r},r.prototype.hasUser=function(e){for(var t=!1,r=0;r<this.participants.length;r++)if(this.participants[r].id==e){t=!0;break}return t},r.prototype.hasUserByUserIdAndNodeId=function(e,t){for(var r=!1,n=0;n<this.participants.length;n++){var o=this.participants[n];if(o.id==e&&o.nodeId==t){r=!0;break}}return r},r.prototype.iCERestart=function(){var n=this,e={type:"offer",sdp:n.remoteDescriptionSDP};log.debug("===room.iCERestart(), calling pc.setRemoteDescription(), remoteDescriptionSDP:",e.sdp),n.selfUser.toMCUPC.setRemoteDescription(e).then(function(){log.info("===room.iCERestart(), doSetRemoteDescription(), set remote sessionDescription success");n.selfUser.toMCUPC.createAnswer({iceRestart:!0}).then(function(e){var e=e.sdp,t=Math.uuid(4),r=Math.uuid(24),t=(e=updateSDPIcePwd(updateSDPIceUfrag(e,t),r),log.debug("===room.iCERestart(), calling pc.setLocalDescription(), LocalDescriptionSDP:",e),{}),r=(t.sdp=e,t.type="answer",new RTCSessionDescription(t));n.selfUser.toMCUPC.setLocalDescription(r).then(function(){log.info("===room.iCERestart(), doSetLocalDescription(), set local sessionDescription success")})})})},r.prototype.getPublishedCameraCount=function(){return this.pubVideos.length},r.prototype.getPublishedCamera=function(){return this.pubVideos},r.prototype.getPublishedScreenCount=function(){return this.pubScreens.length},r.prototype.getPublishedScreen=function(){return this.pubScreens},r.prototype.addUser=function(e){this.hasUser(e.id)||this.participants.push(e)},r.prototype.addUserByUserIdAndUserId=function(e){this.hasUserByUserIdAndNodeId(e.id,e.nodeId)||this.participants.push(e)},r.prototype.removeUser=function(e){this.participants&&0<this.participants.length&&arrayUtil.objectSplice(this.participants,e)},r.prototype.removeUserByUserIdAndNodeId=function(e,t){this.participants&&0<this.participants.length&&arrayUtil.userIdAndNodeIdSplice(this.participants,e,t)},r.prototype.getUserByNodeId=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.nodeId==e){t=n;break}}return t},r.prototype.getNodeId=function(e){var t=null,e=this.getUser(e);return t=e?e.nodeId:t},r.prototype.getUserId=function(e){var t=null,e=this.getUserByNodeId(e);return t=e?e.id:t},r.prototype.sendPublicMessage=function(e){var t=when.defer();return this.masterServer.sendMessage(e),t.resolve(),t.promise},r.prototype.sendPrivateMessage=function(e,t){var r=when.defer();return this.masterServer.sendMessage(e,t),r.resolve(),r.promise},r.prototype.sendPublicData=function(e){var t=when.defer();return this.masterServer.sendData(e).then(function(){t.resolve()}).otherwise(function(e){log.error("===room.sendPublicData() faild, error:"+JSON.stringify(ErrorConstant.data_oversize)),t.reject(e)}),t.promise},r.prototype.sendPrivateData=function(e,t){var r=when.defer();return this.masterServer.sendData(e,t).then(function(){r.resolve()}).otherwise(function(e){log.error("===room.sendPrivateData() faild, error:"+JSON.stringify(ErrorConstant.data_oversize)),r.reject(e)}),r.promise},r.prototype.sendPrivateDataToUser=function(e,t){var r=when.defer();return this.masterServer.sendPrivateDataToUser(e,t).then(function(){r.resolve()}).otherwise(function(e){log.error("===room.sendPrivateDataToUser() faild, error:"+JSON.stringify(ErrorConstant.data_oversize)),r.reject(e)}),r.promise},r.prototype.updateAppData=function(e,t){this.appData[e]=t,this.masterServer.roomDataInfo(e,t)},r.prototype.getAppData=function(e){return void 0===e||null==e||""==e?this.appData:this.appData[e]},r.prototype.setCameraResolutionOrFrameRate=function(e,t,r,n,o){log.info("===room.setCameraResolutionOrFrameRate(),cameraId:"+e+",resolution:"+t+",frameRate:"+r+",resolutionSetType:"+n+",aspectRatio:"+o);var i=when.defer(),e=this.selfUser.getVideo(e);return e?("string"==typeof r&&(r=Number(r)),"string"==typeof o&&(o=Number(o)),e.resolution==Resolution[t]&&e.setType==n&&e.frameRate==r&&e.aspectRatio==o||(e.setResolution(t,n),e.setFrameRate(r),e.setAspectRatio(o),e.track&&e.applyConstraints(),i.resolve())):(t=new l(ErrorConstant.cameraId_does_not_exist),i.reject(t)),i.promise},r.prototype.setCameraResolutionWHOrFrameRate=function(e,t,r,n,o,i){log.info("===room.setCameraResolutionWHOrFrameRate(),cameraId:"+e+",resolutionWidth:"+t+",resolutionHeight:"+r+",frameRate:"+n+",resolutionSetType:"+o+",aspectRatio:"+i);var a=when.defer(),e=this.selfUser.getVideo(e);return e?("string"==typeof n&&(n=Number(n)),"string"==typeof i&&(i=Number(i)),void 0===e.resolution?(e.setResolutionWH(t,r,o),e.setFrameRate(n),a.resolve()):e.resolution.width==t&&e.resolution.height==r&&e.setType==o&&e.frameRate==n&&e.aspectRatio==i||(e.setResolutionWH(t,r,o),e.setFrameRate(n),e.setAspectRatio(i),e.track&&e.applyConstraints(),a.resolve())):(t=new l(ErrorConstant.cameraId_does_not_exist),a.reject(t)),a.promise},r.prototype.muteSpeaker=function(){log.info("===room.muteSpeaker()");var t=this;t.muteSpeakerFlag=!0,t.participants.forEach(function(e){e.id!=t.selfUser.id&&(e=e.audio.track)&&(e.enabled=!1)})},r.prototype.unmuteSpeaker=function(){log.info("===room.unmuteSpeaker()");var t=this;t.muteSpeakerFlag=!1,t.participants.forEach(function(e){e.id!=t.selfUser.id&&(e=e.audio.track)&&(e.enabled=!0)})},r.prototype.ismuteSpeaker=function(){return this.muteSpeakerFlag},r.prototype.hasObject=function(e,t){for(var r=!1,n=0;n<e.length;n++){var o=e[n];if(o.id==t.id&&o.ownerId==t.ownerId){r=!0;break}}return r},r.prototype.kickoffUser=function(e,t){log.info("===room.kickoffUser(),reason:"+e+",userId:"+t),this.masterServer.userIndiction(e,t)},r.prototype.leave=function(e,t){log.info("===room.leave(),reason:"+e+",kickoffOpt:"+t);var r=this,n=when.defer();return r.mp4ImporterUserAudioRtpPacketTemp=0,r.mp4ImporterUserAudioRtpPacketReal=0,r.mp4ImporterUserAudioStateIntervalId&&(clearInterval(r.mp4ImporterUserAudioStateIntervalId),r.mp4ImporterUserAudioStateIntervalId=null),r.userClearInfo(),setTimeout(function(){r.masterServer.userMsg(e,t),r.roomClearInfo(!0),n.resolve()},1e3),n.promise},r.prototype.closeRoom=function(e){log.info("===room.closeRoom(),userId:",e);var t=this;t.mp4ImporterUserAudioRtpPacketTemp=0,t.mp4ImporterUserAudioRtpPacketReal=0,t.mp4ImporterUserAudioStateIntervalId&&(clearInterval(t.mp4ImporterUserAudioStateIntervalId),t.mp4ImporterUserAudioStateIntervalId=null),t.userClearInfo(),setTimeout(function(){t.masterServer.closeRoom(e),t.roomClearInfo()},1e3)},r.prototype.userClearInfo=function(){var e=this.selfUser.videos,e=(e&&0<e.length&&e.forEach(function(e){e.status==StreamStatus.published&&(e.track&&e.track.stop(),e.unpreview(),e.unpublish())}),this.selfUser.audio),e=(e&&e.status==StreamStatus.published&&(e.track&&e.track.stop(),e.closeMicrophone()),this.selfUser.screen);e&&e.status==StreamStatus.published&&(e.track&&e.track.stop(),e.unpublish())},r.prototype.roomClearInfo=function(e){var t=this;t&&(t.pingIntervalId&&(clearInterval(t.pingIntervalId),t.pingIntervalId=null),t.pingTimeoutId&&(clearInterval(t.pingTimeoutId),t.pingTimeoutId=null),t.selfUser.changePublishVideoQualityInterval&&(clearInterval(t.selfUser.changePublishVideoQualityInterval),t.selfUser.changePublishVideoQualityInterval=null),t.selfUser&&t.selfUser.toMCUPC&&(t.selfUser.toMCUPC.msgQueue=[],t.selfUser.toMCUPC.close(),t.selfUser.toMCUPC=null),avdEngineHandle.setRemoteDescriptionSuccess=!1,addIcecandidateList=[],t.connectionInfoCollector&&t.connectionInfoCollector.stop(),t.connectionStatistics&&t.connectionStatistics.stop(),e&&(t.roomJoinState=RoomStateEnum.DISCONNECTED,t.masterServer.signalingChannel.close()),avdEngineHandle.rooms=[])},r.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},r.prototype.getRoomControl=function(){return this.roomControl},r.prototype.setRoomControl=function(e){this.masterServer.setRoomControl(this.id,e)},r.prototype.setDeviceIdByUUID=function(e,t){var r;return 0==e?((r=this.cameraId2uuid[t])||(this.selfUser&&this.selfUser.screen&&this.selfUser.screen.id==t?r=t:(r=Math.uuid(),this.cameraId2uuid[t]=r)),r):1==e?((r=this.speakerId2uuid[t])||(r=Math.uuid(),this.speakerId2uuid[t]=r),r):2==e?((r=this.microphoneId2uuid[t])||(r=Math.uuid(),this.microphoneId2uuid[t]=r),r):void 0},r.prototype.getDeviceIdByUUID=function(e,t){var r=t;if(0==e){for(key in this.cameraId2uuid)if(this.cameraId2uuid[key]==t){r=key;break}return r}if(1==e){for(key in this.speakerId2uuid)if(this.speakerId2uuid[key]==t){r=key;break}return r}if(2==e){for(key in this.microphoneId2uuid)if(this.microphoneId2uuid[key]==t){r=key;break}return r}},r.prototype.calInitVideoBitrate=function(e,t){var t=e*t,r=Math.sqrt(t),t=Math.log10(t),n=Math.log10(r),t=t*r/Math.pow(n,2)/10;1280<e&&(t*=Math.sqrt(e/1280));r=2*parseInt(8*t);return{startBit:r,minBit:r/2,maxBit:2*r}},r.prototype.sendAddAnnotation=function(e,t,r,n,o,i,a){log.debug("===Room.sendAddAnnotation(),objectId:"+e+",shapeType:"+r+"，arrowtype:"+i+",fillType:"+a),this.masterServer.sendAddAnnotationMessage(e,t,r,n,o,i,a)},r.prototype.sendUpdateAnnotation=function(e,t,r){log.debug("===Room.sendUpdateAnnotation(),objectId:"+e+",shapeType:"+r),this.masterServer.sendUpdateAnnotationMessage(e,t,r)},r.prototype.sendRemoveAnnotation=function(e,t,r){log.debug("===Room.sendRemoveAnnotation(),objectId:"+e+",annotationType:"+t+",eraserIds:"+r),this.masterServer.sendRemoveAnnotationMessage(e,t,r)},r.prototype.initFakeVideoStream=function(e){for(var t=0;t<e;t++)getFakeVideoStream(function(e){this.fakeVideoStreams.push(e)})},r.prototype.initFakeAudioStream=function(e){for(var t=0;t<e;t++)getFakeAudioStream(function(e){this.fakeAudioStreams.push(e)})},r.prototype.addAnnotationMsg=function(e,t,r,n,o){log.debug("===room.addAnnotationMsg, updateAnnotationMsg:"+e.objectId+",isSelf:"+t+",isClear: "+r);if(this.annotation2boardId[e.objectId]){var i=this.annotation2boardId[e.objectId].storageArr,a=this.annotation2boardId[e.objectId].queueArr;if(e.annotationType!=shapeTypeEnum.hlight_point)if(0<i.length){for(var s=!1,d=0;d<i.length;d++)i[d].annotationId==e.annotationId&&(i[d].operType!=e.operType&&e.operType==OperType.remove&&(log.debug("===room.addAnnotationMsg, updateAnnotationMsg.remove, remove annotation from annotation2BoardId"),i.splice(d,1)),s=!0);s||e.operType==OperType.remove||i.push(e)}else i.push(e);t||a.push(e)}else this.annotation2boardId[e.objectId]={storageArr:[],queueArr:[]},e.annotationType!=shapeTypeEnum.hlight_point&&this.annotation2boardId[e.objectId].storageArr.push(e),t||this.annotation2boardId[e.objectId].queueArr.push(e);if(r&&this.annotation2boardId[e.objectId]&&0<this.annotation2boardId[e.objectId].storageArr.length)for(d=0;d<this.annotation2boardId[e.objectId].storageArr.length;d++)(l=this.annotation2boardId[e.objectId].storageArr[d]).operUserId==this.selfUser.id&&l.operType==OperType.add&&(this.annotation2boardId[e.objectId].storageArr.splice(d,1),d--);if(e.operType==OperType.remove){for(d=0;d<this.annotation2boardId[e.objectId].storageArr.length;d++)if((l=this.annotation2boardId[e.objectId].storageArr[d]).annotationId==o&&l.operUserId==this.selfUser.id&&l.operType==OperType.add){delete l.imgZrender;break}}else for(var l,d=0;d<this.annotation2boardId[e.objectId].storageArr.length;d++)if((l=this.annotation2boardId[e.objectId].storageArr[d]).annotationId==o&&l.operUserId==this.selfUser.id&&l.operType==OperType.add){l.imgZrender=n,this.style2annotation[n.id]={style:JSON.stringify(n.style),position:JSON.stringify(n.position),scale:JSON.stringify(n.scale),origin:JSON.stringify(n.origin),rotation:JSON.stringify(n.rotation)};break}},r.prototype.updateAnnotationDrow=function(e){log.debug("===room.updateAnnotationDrow, annotations: ",e);for(var t=this;0<e.length;){var r=e[0],n=this.getUser(this.boardId2userId[r.objectId]);if(!n)break;var o=n.getBoard(r.objectId);if(!o.annotation){clearTimeout(t.updateTimer),t.updateTimer=setTimeout(function(){t.updateAnnotationDrow(e)},100);break}switch(e.shift(),r.operType){case OperType.add:r.annotationType==shapeTypeEnum.line||r.annotationType==shapeTypeEnum.ellipse||r.annotationType==shapeTypeEnum.rect||r.annotationType==shapeTypeEnum.arrow||r.annotationType==shapeTypeEnum.success||r.annotationType==shapeTypeEnum.failure||r.annotationType==shapeTypeEnum.rhomb||r.annotationType==shapeTypeEnum.hlight_texttag||r.annotationType==shapeTypeEnum.hlight_point?o.annotation.drawToBoard(r.ann2pt):r.annotationType==shapeTypeEnum.polyline?o.annotation.drawToBoard(r.annMutlipt):r.annotationType==shapeTypeEnum.img?o.annotation.drawToBoard(r.Img):r.annotationType==shapeTypeEnum.txt&&o.annotation.drawTextToBoard(r);break;case OperType.remove:o.annotation.removeToBoard(r);break;case OperType.update:r.annotationType==shapeTypeEnum.img&&o.annotation.updateDrawToBoard(r.Img)}}},r.prototype.voiceActivatedHandler=function(){var d;this.audioLevel&&this.audioLevel.start(500).then(void((d=this)&&(clearInterval(d.statsIntervalId),d.statsIntervalId=setInterval(function(){var e,t={},r=0,n="",o=d.getParticipants(),i=d.getAppData(appDataKeyEnum.lecturer)?d.getAppData(appDataKeyEnum.lecturer):"",a=0;for(e in o.forEach(function(e){e.audio&&(t[e.id]=e.audio.getAudioLevel())}),t)try{var s=t[e];e==i&&(a=s),r<s&&(r=s,n=e)}catch(e){log.error(e)}i!=n&&a<4&&3<=r-a&&(log.debug("===audioLevelHandler()发送更改语音激励通知，语音激励id:"+n+",值为"+r),d.updateAppData(appDataKeyEnum.lecturer,n))},3e3))))},r.prototype.mp4ImporterUserAudioStateStart=function(e){log.debug("===room.mp4ImporterUserAudioStateStart()");var i=this;this&&(clearInterval(i.mp4ImporterUserAudioStateIntervalId),i.mp4ImporterUserAudioStateIntervalId=setInterval(function(){var e=function(e){var t=null;if(e){var r=e.participants.length;if(0<r)for(var n=0;n<r;n++){var o=e.participants[n];if("avd_mp4_importer"==o.userAgent){o.audio&&o.audio.track&&(t=o.audio.track.id);break}}}return t}(i);if(e&&i){for(var t,r=i.traceablePeerConnection.getToMCUPeerConnection().getReceivers(),n=0;n<r.length;n++){var o=r[n];if(o&&o.track&&o.track.id&&o.track.id==e){t=o;break}}t&&t.getStats().then(function(e){e.forEach(function(e){var t;"inbound-rtp"===e.type&&(t=e.packetsLost,e=e.packetsReceived,i.mp4ImporterUserAudioRtpPacketTemp=t+e,t=(i.mp4ImporterUserAudioRtpPacketTemp-i.mp4ImporterUserAudioRtpPacketReal)*i.mp4ImporterUserAudioRate,i.eventEmitter.emit(RoomCallback.mediaplay_progress_notify,t))})})}else i.mp4ImporterUserAudioRtpPacketTemp=0,i.mp4ImporterUserAudioRtpPacketReal=0},e))},r.prototype.mp4ImporterUserAudioStateStop=function(){this.mp4ImporterUserAudioRtpPacketReal=this.mp4ImporterUserAudioRtpPacketTemp,this.mp4ImporterUserAudioStateIntervalId&&(clearInterval(this.mp4ImporterUserAudioStateIntervalId),this.mp4ImporterUserAudioStateIntervalId=null)},r.prototype.openReqSend=function(e){log.debug("===room.openReqSend()...");var t=when.defer(),r=(this.masterServer=new n(e,this),this.masterServer.openReqSend(),setTimeout(function(){var e=new l(1e4,"openReq send time out");t.reject(e)},5e3));return this.addCallback(EngineCallback.open_rep_return_0,function(){clearTimeout(r)}),this.addCallback(EngineCallback.room_join_success,function(e){clearTimeout(r),t.resolve(e)}),this.addCallback(EngineCallback.room_join_error,function(e){clearTimeout(r),t.reject(e)}),t.promise},r.prototype.openReqReconnectionSend=function(){log.debug("===room.openReqReconnectionSend()...");var t=when.defer(),r=(this.masterServer.openReqReconnectionSend(),setTimeout(function(){var e=new l(1e4,"openReq Reconnection send time out");t.reject(e)},5e3));return this.addCallback(EngineCallback.open_rep_return_0,function(){clearTimeout(r),t.resolve()}),this.addCallback(EngineCallback.room_join_error,function(e){clearTimeout(r),t.reject(e)}),t.promise},r.prototype.setRejoinTimeout=function(e){null!=e&&("number"!=typeof e||e<=6e4)?log.info("===room.setRejoinTimeout(), timeout: "+e+" is invalid to return"):this.rejoinTimeout=e},r.prototype.setRejoinInterval=function(e){null!=e&&"number"!=typeof e?log.info("===room.setRejoinInterval(), rejoinInterval: "+e+" is invalid to return"):this.rejoinInterval=e},r.prototype.setSpeakerDevice=function(e,t){log.info("===room.setSpeakerDevice(),deviceId:"+e);var r,n=when.defer();if(void 0===(t=t||document.getElementsByTagName("audio"))[0].sinkId)return log.error("===room.setSpeakerDevice(),Browser does not support output device selection."),r=new l(ErrorConstant.set_speakerDevice_notsupport_failed),n.reject(r),n.promise;for(var o=0;o<t.length;o++){var i=t[o];i.setSinkId(e).then(function(){log.info("===room.setSpeakerDevice() Success, audio output device attached:"+e+"to element with "+i.title+"as source.")}).catch(function(e){"SecurityError"===e.name?log.error("===room.setSpeakerDevice(),You need to use HTTPS for selecting audio output device"):log.error("===room.setSpeakerDevice(),Error setting audio output device, error:"+JSON.stringify(e));e=new l(ErrorConstant.set_speakerDevice_notsupport_failed);return n.reject(e),n.promise})}this.clientSetSpeakerDeviceId=e,n.resolve()},r.prototype.setSpeakerVolume=function(e,t){log.info("===room.setSpeakerVolume(),volume:"+e);var r=when.defer();t=t||document.getElementsByTagName("audio");for(var n=0;n<t.length;n++)t[n].volume=e;this.clientSetSpeakerVolume=e,r.resolve()},r}),sdpLines=function(e){return e.split("\r\n").filter(function(e){return 0<e.length})},sdpMline=function(e){for(var t=e.substr(2).split(" "),r={media:t[0],port:t[1],proto:t[2],formats:[]},n=3;n<t.length;n++)t[n]&&r.formats.push(t[n]);return r},findLineInFirefox=function(e,t,r){for(var n=e.length,o=0;o<t.length;o++)if(t[o].substr(0,n)===e)return t[o];if(r)for(var i=0;i<r.length;i++)if(r[i].substr(0,n)===e)return r[i];return!1},findLinesInFirefox=function(e,t,r){for(var n=[],o=e.length,i=0;i<t.length;i++)t[i].substr(0,o)===e&&n.push(t[i]);if(!n.length&&r)for(var a=0;a<r.length;a++)r[a].substr(0,o)===e&&n.push(r[a]);return n},rtpmap=function(e){var t={id:(e=e.substr(9).split(" ")).shift()},e=e[0].split("/");return t.name=e[0],t.clockrate=e[1],t.channels=3==e.length?e[2]:"1",t},sctpmap=function(e){e=e.substr(10).split(" ");return{number:e.shift(),protocol:e.shift(),streams:e.shift()}},fmtp=function(e){for(var t,r,n=e.substr(e.indexOf(" ")+1).split(";"),o=[],i=0;i<n.length;i++)t=(r=n[i].split("="))[0].trim(),r=r[1],t&&r?o.push({key:t,value:r}):t&&o.push({key:"",value:t});return o},crypto=function(e){e=e.substr(9).split(" ");return{tag:e[0],cipherSuite:e[1],keyParams:e[2],sessionParams:e.slice(3).join(" ")}},fingerprint=function(e){e=e.substr(14).split(" ");return{hash:e[0],value:e[1]}},extmap=function(e){var e=e.substr(9).split(" "),t={},r=e.shift(),n=r.indexOf("/");return 0<=n?(t.id=r.substr(0,n),t.senders=r.substr(n+1)):(t.id=r,t.senders="sendrecv"),t.uri=e.shift()||"",t},rtcpfb=function(e){var e=e.substr(10).split(" "),t={};return t.id=e.shift(),t.type=e.shift(),"trr-int"===t.type?t.value=e.shift():t.subtype=e.shift()||"",t.parameters=e,t},sdpCandidate=function(e){for(var t=(0===e.indexOf("a=candidate:")?e.substring(12):e.substring(10)).split(" "),r={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},n=8;n<t.length;n+=2)"raddr"===t[n]?r.relAddr=t[n+1]:"rport"===t[n]?r.relPort=t[n+1]:"generation"===t[n]?r.generation=t[n+1]:"tcptype"===t[n]&&(r.tcpType=t[n+1]);return r.network="1",r},sourceGroups=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].substr(13).split(" ");t.push({semantics:n.shift(),sources:n})}return t},sources=function(e){for(var t=[],r={},n=0;n<e.length;n++){var o=e[n].substr(7).split(" "),i=o.shift(),a=(r[i]||(t.push(a={ssrc:i,parameters:[]}),r[i]=a),(o=o.join(" ").split(":")).shift()),o=o.join(":")||null;r[i].parameters.push({key:a,value:o})}return t},groups=function(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n].substr(8).split(" "),r.push({semantics:t.shift(),contents:t});return r},msidSemantics=function(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n].substr(17).split(" "),r.push({semantics:t.shift(),contents:t});return r},bandwidth=function(e){var e=e.substr(2).split(":"),t={};return t.type=e.shift(),t.bandwidth=e.shift(),t},getSsrcBySdp=function(e){for(var t,r=e.split("\r\n"),n=0,o=0;o<r.length;o++)0<=r[o].indexOf("a=ssrc-group:SIM")&&(n=o);return 0<n?r[n].split(" ")[1]:r[0]?r[0].split(" ")[0].split(":")[1]:t},getCodecPayloadType=function(e,t){for(var r=[],n=e.split("\r\n"),o=findLine(n,"a=rtpmap",t),i=0;i<o.length;i++)r[i]=o?getCodecPayloadTypeFromLine(n[o[i]]):null;return r},getIceInfoBySDP=function(e){var t,e=e.split("\r\n"),r={},n=findLine(e,"a=","ice-ufrag"),n=(n&&0<n.length&&(t=e[n[0]],r.ufrag=t.split(":")[1]),findLine(e,"a=","ice-pwd"));return n&&0<n.length&&(t=e[n[0]],r.pwd=t.split(":")[1]),r},getPayloadByProfileLevel=function(e,t){var r="",e=e.split("\r\n"),n=findLine(e,"a=fmtp","profile-level-id=42e01f");return r=(n=null!=typeof t&&!0===t?findLine(e,"a=fmtp","profile-level-id=42001f"):n)&&0<n.length?e[n[0]].split(" ")[0].split(":")[1]:r},getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),e=e.match(t);return e&&2===e.length?e[1]:null},setReplaceCoding=function(e,t,r){var e=e.join(" "),n=t.split("\r\n"),r=findLine(n,"m=",r),o=n[r].split(" ").slice(0,3),e=(o.push(e),o.join(" "));return t=t.replace(n[r],e)},setReplaceMediaPayloads=function(e,t,r){var n=e.join(" "),o=t.split("\r\n"),r=findLine(o,"m=",r);if(0!=r.length)for(var i=o[r].split(" "),a=i.slice(0,3),n=(a.push(n),a.join(" ")),a=(t=t.replace(o[r],n),i.slice(3,i.length)),o=diff(a,e),s=(t=(t=(t=setDeletedMediaPayloads(o,t)).replace(/a=setup:actpass/g,"a=setup:active")).replace(/a=recvonly/g,"a=sendrecv"),0);s<e.length;s++)t=t+"a=fmtp:"+e[s]+" x-google-max-bitrate=10000; x-google-min-bitrate=300; x-google-start-bitrate=645\r\n";return t},setDeletedMediaPayloads=function(e,t){for(var r=0;r<e.length;r++)for(var n=t.split("\r\n"),o=findLine(n,"a=",":"+e[r]+" "),i=0;i<o.length;i++)t=t.replace(n[o[i]]+"\r\n","");return t},diff=function(e,t){for(var r=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&r.push(e[n]);for(var o=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&o.push(t[i]);return r.concat(o)};var idCounter=Math.random(),log;_setIdCounter=function(e){idCounter=e},toSessionJSON=function(e,t){for(var r=t.creators||[],n=t.role||"initiator",o=t.direction||"outgoing",i=e.split("\r\nm="),a=1;a<i.length;a++)i[a]="m="+i[a],a!==i.length-1&&(i[a]+="\r\n");var s=i.shift()+"\r\n",t=sdpLines(s),e={},d=[];for(a=0;a<i.length;a++)d.push(toMediaJSON(i[a],s,{role:n,direction:o,creator:r[a]||"initiator"}));e.contents=d;var l=findLinesInFirefox("a=group:",t),l=(l.length&&(e.groups=groups(l)),findLinesInFirefox("a=msid-semantic:",t));return l.length&&(e.msidSemantics=msidSemantics(l)),e},toMediaJSON=function(e,t,r){var n=r.creator||"initiator",o=r.role||"initiator",i=r.direction||"outgoing",a=sdpLines(e),r=sdpLines(t),e=sdpMline(a[0]),t={creator:n,role:o,direction:i,name:e.media,description:{descType:"rtp",media:e.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}},s=("application"==e.media&&(t.description={descType:"datachannel"},t.transport.sctp=[]),t.description),d=t.transport,n=findLineInFirefox("a=mid:",a),n=(n&&(t.name=n.substr(6)),findLineInFirefox("a=sendrecv",a,r)?t.senders="both":findLineInFirefox("a=sendonly",a,r)?t.senders=SENDERS[o][i].sendonly:findLineInFirefox("a=recvonly",a,r)?t.senders=SENDERS[o][i].recvonly:findLineInFirefox("a=inactive",a,r)&&(t.senders="none"),"rtp"==s.descType&&((e=findLineInFirefox("b=",a))&&(s.bandwidth=e(e)),(n=findLineInFirefox("a=msid:",a)).length&&(e=n.substr(7).split(" "),(u={}).msid=n,u.streamId=e[0],u.trackId=e[1],s.msid=u),(n=findLineInFirefox("a=ssrc:",a))&&(s.ssrc=n.substr(7).split(" ")[0]),findLinesInFirefox("a=rtpmap:",a).forEach(function(e){var t=rtpmap(e);t.parameters=[],t.feedback=[],findLinesInFirefox("a=fmtp:"+t.id,a).forEach(function(e){t.parameters=fmtp(e)}),findLinesInFirefox("a=rtcp-fb:"+t.id,a).forEach(function(e){t.feedback.push(rtcpfb(e))}),s.payloads.push(t)}),findLinesInFirefox("a=crypto:",a,r).forEach(function(e){s.encryption.push(crypto(e))}),findLineInFirefox("a=rtcp-mux",a)&&(s.mux=!0),findLinesInFirefox("a=rtcp-fb:*",a).forEach(function(e){s.feedback.push(rtcpfb(e))}),findLinesInFirefox("a=extmap:",a).forEach(function(e){e=extmap(e);e.senders=SENDERS[o][i][e.senders],s.headerExtensions.push(e)}),e=findLinesInFirefox("a=ssrc-group:",a),s.sourceGroups=sourceGroups(e||[]),u=findLinesInFirefox("a=ssrc:",a),s.sources=sources(u||[]),findLineInFirefox("a=x-google-flag:conference",a,r))&&(s.googConferenceFlag=!0),findLinesInFirefox("a=fingerprint:",a,r)),l=findLineInFirefox("a=setup:",a,r),e=(n.forEach(function(e){e=fingerprint(e);l&&(e.setup=l.substr(8)),d.fingerprints.push(e)}),findLineInFirefox("a=ice-ufrag:",a,r)),u=findLineInFirefox("a=ice-pwd:",a,r);return e&&u&&(d.ufrag=e.substr(12),d.pwd=u.substr(10),d.candidates=[],findLinesInFirefox("a=candidate:",a,r).forEach(function(e){d.candidates.push(toCandidateJSON(e))})),"datachannel"==s.descType&&findLinesInFirefox("a=sctpmap:",a).forEach(function(e){e=sctpmap(e);d.sctp.push(e)}),t},toCandidateJSON=function(e){e=sdpCandidate(e.split("\r\n")[0]);return e.id=(idCounter++).toString(36).substr(0,12),e},toSessionSDP=function(e,t){t.role,t.direction;var r=["v=0","o=- "+(t.sid||e.sid||Date.now())+" "+(t.time||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"];return(e.groups||[]).forEach(function(e){r.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),(e.msidSemantics||[]).forEach(function(e){navigator.mozGetUserMedia?r.push("a=msid-semantic:"+e.semantics+" "+e.contents.join(" ")):r.push("a=msid-semantic: "+e.semantics+" "+e.contents.join(" "))}),(e.contents||[]).forEach(function(e){r.push(toMediaSDP(e,t))}),r.join("\r\n")+"\r\n"},toMediaSDP=function(e,t){var n=[],r=t.role||"initiator",o=t.direction||"outgoing",i=e.description,t=e.transport,a=i.payloads||[],s=t&&t.fingerprints||[],d=[];return"datachannel"==i.descType?(d.push("application"),d.push("1"),d.push("DTLS/SCTP"),t.sctp&&t.sctp.forEach(function(e){d.push(e.number)})):(d.push(i.media),d.push("1"),i.encryption&&0<i.encryption.length||0<s.length?d.push("RTP/SAVPF"):d.push("RTP/AVPF"),a.forEach(function(e){d.push(e.id)})),n.push("m="+d.join(" ")),n.push("c=IN IP4 0.0.0.0"),i.bandwidth&&i.bandwidth.type&&i.bandwidth.bandwidth&&n.push("b="+i.bandwidth.type+":"+i.bandwidth.bandwidth),"rtp"==i.descType&&n.push("a=rtcp:1 IN IP4 0.0.0.0"),t&&(t.ufrag&&n.push("a=ice-ufrag:"+t.ufrag),t.pwd&&n.push("a=ice-pwd:"+t.pwd),s.forEach(function(e){n.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&n.push("a=setup:"+e.setup)}),t.sctp)&&t.sctp.forEach(function(e){n.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)}),"rtp"==i.descType&&n.push("a="+(SENDERS[r][o][e.senders]||"sendrecv")),n.push("a=mid:"+e.name),i.msid&&n.push(i.msid.msid),i.mux&&n.push("a=rtcp-mux"),(i.encryption||[]).forEach(function(e){n.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),i.googConferenceFlag&&n.push("a=x-google-flag:conference"),a.forEach(function(t){var r,e="a=rtpmap:"+t.id+" "+t.name+"/"+t.clockrate;t.channels&&"1"!=t.channels&&(e+="/"+t.channels),n.push(e),t.parameters&&t.parameters.length&&(e=["a=fmtp:"+t.id],r=[],t.parameters.forEach(function(e){r.push((e.key?e.key+"=":"")+e.value)}),e.push(r.join(";")),n.push(e.join(" "))),t.feedback&&t.feedback.forEach(function(e){"trr-int"===e.type?n.push("a=rtcp-fb:"+t.id+" trr-int "+e.value?e.value:"0"):n.push("a=rtcp-fb:"+t.id+" "+e.type+(e.subtype?" "+e.subtype:""))})}),i.feedback&&i.feedback.forEach(function(e){"trr-int"===e.type?n.push((e.value,e.value)):n.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))}),(i.headerExtensions||[]).forEach(function(e){n.push("a=extmap:"+e.id+(e.senders?"/"+SENDERS[r][o][e.senders]:"")+" "+e.uri)}),(i.sourceGroups||[]).forEach(function(e){n.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))}),(i.sources||[]).forEach(function(e){for(var t=0;t<e.parameters.length;t++){var r=e.parameters[t];n.push("a=ssrc:"+(e.ssrc||i.ssrc)+" "+r.key+(r.value?":"+r.value:""))}}),(t.candidates||[]).forEach(function(e){n.push(toCandidateSDP(e))}),n.join("\r\n")},toCandidateSDP=function(e){var t=[],r=(t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port),e.type);return t.push("typ"),t.push(r),"srflx"!==r&&"prflx"!==r&&"relay"!==r||e.relAddr&&e.relPort&&(t.push("raddr"),t.push(e.relAddr),t.push("rport"),t.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(t.push("tcptype"),t.push(e.tcpType)),t.push("generation"),t.push(e.generation||"0"),"a=candidate:"+t.join(" ")},ModuleBase.define("TraceableWebsocket",["MessageManager","Error"],function(i,a){function e(e){this.roomHandle=e,this.webSocket}return e.prototype.connect=function(){var t=this,r=when.defer();try{var n=document.location.protocol,e=("http:"!=(n="httpsionic:"==n?"https:":n)&&"https:"!=n&&"httpsionic:"!=n&&(n="http:"),avdEngineHandle.applyToElectron&&(n=avdEngineHandle.electronProtocol),avdEngineHandle.restFullProtocol&&(n=avdEngineHandle.restFullProtocol),"ws://"),o=(e="https:"==n?"wss://":e)+avdEngineHandle.restServerInfo.roomServerUrl+"/ws";log.info("===webSocket,connect(), websocket URL:"+o),avdEngineHandle.loggerReport.info("websocket,connect(), websocket url:"+o),(webSocket=new WebSocket(o)).binaryType="arraybuffer",webSocket.readyState==WebSocket.CONNECTING&&(log.info("===webSocket,connect(), 连接正在建立..."),avdEngineHandle.loggerReport.info("webSocket,connect(),连接正在建立...")),webSocket.onopen=function(){webSocket.readyState==WebSocket.OPEN&&(log.info("===webSocket,onopen(), 连接已打开!"),avdEngineHandle.loggerReport.info("webSocket,onopen(),连接已打开!")),r.resolve(webSocket)},webSocket.onmessage=function(e){new i(t.roomHandle).OnWebSocketMessage(e.data)},webSocket.onclose=function(e){log.info("===webSocket,onclose(), 连接已关闭！关闭原因："+e.code),avdEngineHandle.loggerReport.info("webSocket,onclose(),连接已关闭！关闭原因："+e.code+"，需要处理")},webSocket.onerror=function(e){log.info("===webSocket,onerror(), 连接发生错误。"),avdEngineHandle.loggerReport.info("webSocket,onerror(), 连接发生错误。");var t=new a(ErrorConstant.websock_catch_exception);r.reject(t)}}catch(e){log.info("===websocket Operation  failed. with exception:"+e);n=new a(ErrorConstant.websock_catch_exception);r.reject(n)}return r.promise},e.prototype.close=function(){webSocket&&webSocket.readyState==WebSocket.OPEN&&webSocket.close()},e}),ModuleBase.define("TraceablePeerConnection",["Error"],function(e){function t(e){this.roomHandle=e,avdEngineHandle.restServerInfo.iceServers&&0<avdEngineHandle.restServerInfo.iceServers.length?this.iceConfig={iceServers:[{url:avdEngineHandle.restServerInfo.stunUrl},{url:avdEngineHandle.restServerInfo.trunUrl,credential:avdEngineHandle.restServerInfo.iceCredential,username:avdEngineHandle.restServerInfo.iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googCpuOveruseDetection:!1}]},this.constraints={}}var pe,he,fe,me;t.prototype.getToMCUPeerConnection=function(){return 0<this.roomHandle.currentReconnectTimes?(null==this.roomHandle.toMCUReconnectionPC&&(this.roomHandle.toMCUReconnectionPC=this.createMCUPeerConnection()),this.roomHandle.toMCUReconnectionPC):(null==this.roomHandle.selfUser.toMCUPC&&(this.roomHandle.selfUser.toMCUPC=this.createMCUPeerConnection()),this.roomHandle.selfUser.toMCUPC)},t.prototype.createMCUPeerConnection=function(){var e=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnection(e,this.roomHandle),"getConfiguration"in window.RTCPeerConnection.prototype&&log.debug("===createPeerConnectionInner(),PeerConnection Configuration:"+JSON.stringify(e.getConfiguration())),e},t.prototype.handleMCUPeerConnection=function(t,e){var r=when.defer();return t.msgQueue=[],t.forLog=!1,t.roomHandle=e,t.onicecandidate=function(e){},t.onopen=function(){},t.ontrack=function(e){log.debug("===pc.ontrack()")},t.oniceconnectionstatechange=function(e){e=e.target.iceConnectionState;switch(log.info("===oniceconnectionstatechange(),MCU iceConnectionState:"+e),avdEngineHandle.loggerReport.info("===Peerconnection iceConnectionState:"+e),e){case"disconnected":log.debug("===TraceablePeerConnection.handleMCUPeerConnection() oniceconnectionstatechange iceConnectionState= disconnected,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connecting),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),log.info("===oniceconnectionstatechange(),iceConnectionState is disconnected, to room.iCERestart()"),this.roomHandle.iCERestart();break;case"failed":log.info("===oniceconnectionstatechange(),iceConnectionState is failed, to room.iCERestart()"),this.roomHandle.iCERestart();break;case"completed":break;case"connected":this.roomHandle.connectionInfoCollector||(this.roomHandle.connectionInfoCollector=new ConnectionInfoCollector(t,1e3)),log.debug("===TraceablePeerConnection.handleMCUPeerConnection() oniceconnectionstatechange iceConnectionState= connected,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connected),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected),this.roomHandle.eventEmitter.emit(RoomCallback.mcu_peerconnection_completed,MCUPeerConnectionStatus.completed)}},t.onsignalingstatechange=function(e){log.debug("===onsignalingstatechange(),MCU signalingState:"+e.target.signalingState),"stable"==e.target.signalingState?0==t.forLog&&(t.forLog=!0,t.intervalSet(t)):"closed"==e.target.signalingState&&this.roomHandle.connectionInfoCollector&&(log.debug("===PC.onsignalingstatechange(),signalingState=closed,Peerconnection已关闭，停止网络连接情况指示器收集"),this.roomHandle.connectionInfoCollector.stop())},t.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},100)},t.processSignalingMessage=function(e){var t=this;if(t.roomHandle&&0!=t.roomHandle.addSdpLocalStates&&log.debug("===DDDDDDD_9999999999999,pc.processSignalingMessage(),room.addSdpLocalStates:"+t.roomHandle.addSdpLocalStates),t.roomHandle&&0==t.roomHandle.addSdpLocalStates&&0==t.roomHandle.currentReconnectTimes&&"stable"==e.signalingState&&0==t.roomHandle.pingCountTime&&0<e.msgQueue.length){e=e.msgQueue.pop();if("add"==e.operationType){log.debug("===操作对列:operationType:add,resourceType:"+e.para1+",resourceId:"+e.para2);var I=e.para1,H=e.para2,r=e.para3,L=e.para4,T=t.roomHandle;T.addSdpLocalStates=1,log.debug("===DDDDDDD_1111111111_0000000000,addSdpHandle(),room.addSdpLocalStates:"+T.addSdpLocalStates),clearTimeout(pe),pe=setTimeout(function(){T&&(T.addSdpLocalStates=0,log.debug("===DDDDDDD_11111111111_111111111,addSdpHandle(),setTimeout room.addSdpLocalStates:"+T.addSdpLocalStates))},3e3);for(var C,n=null,N=0;N<T.midObjSet.length;N++){var B=T.midObjSet[N];if(B.type==I&&!B.isSender){n=B;break}}var j=!1,V=null,F=(-1<H.indexOf("screen_audio")&&(j=!0),"audio"!=I||j?"video"==I?(o=T.getDeviceIdByUUID(0,H),C=T.selfUser.getVideo(o),i=T.videoMediaTemplate,V=T.selfUser.stream):"screen"==I?(C=T.selfUser.getScreen(H),i=T.videoMediaTemplate,V=T.selfUser.screenStream):"audio"==I&&j&&(C=T.selfUser.screen.screenAudio,i=T.audioMediaTemplate,V=T.selfUser.screenStream):(o=T.getDeviceIdByUUID(2,H),C=T.selfUser.getAudio(o),i=T.audioMediaTemplate,V=T.selfUser.stream),i.fingerprint&&(i.fingerprint.type="sha-1",i.fingerprint.hash=T.fingerPrint),r.getTracks()[0]),q=null,o=null,R=new SDPTransform;if(n){if(log.debug("===addSdpHandle(), resourceType:"+I+", currMidObj:"+JSON.stringify(n)),o=ye(n.mid,T),log.debug("===addSdpHandle(), resourceType:"+I+", currMidObj.mid:"+n.mid+",currTransceiver:",o),!o)return void(log.debug("===addSdpHandle(), resourceType:"+I+", currMidObj.mid:"+n.mid+", currTransceiver is null, to return"),T.addSdpLocalStates=0);o.sender.replaceTrack(F),void 0!==o.sender.setStreams&&o.sender.setStreams(V),n.isReceiver?o.direction="sendrecv":o.direction="sendonly",n.isSender=!0,C.RTCRtpSender=o.sender,C.mid=o.mid,(x=R.parse(T.remoteDescriptionSDP)).media.forEach(function(e){e.mid==n.mid&&(n.isReceiver?e.direction="sendrecv":e.direction="recvonly")})}else{T.midNum=T.midNum+1;var r={mid:T.midNum,type:I,isReceiver:!1,isSender:!0,receiverInfo:{trackId:"",nodeId:"",deviceId:""}},o=(T.midObjSet.push(r),i.mid=T.midNum,i.direction="recvonly",R.mediaWriter(i));T.remoteDescriptionSDP=T.remoteDescriptionSDP+o,(x=R.parse(T.remoteDescriptionSDP)).groups[0].mids=x.groups[0].mids+" "+T.midNum}T.remoteDescriptionSDP=R.writer(x);(r={}).sdp=T.remoteDescriptionSDP,r.type="offer",log.debug("===addSdpHandle(),resourceType:"+I+",remote offer description:"+r.sdp);var i=new RTCSessionDescription(r);T.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(i).then(function(){if(log.info("===addSdpHandle(),resourceType:"+I+",success to add remote description"),!n){var e=ye(T.midNum,T);if(log.debug("===addSdpHandle(),room.midNum:"+T.midNum+",transceiver:",e),!e)return log.debug("===addSdpHandle(), resourceType:"+I+", room.midNum:"+T.midNum+", transceiver is null, to return"),void(T.addSdpLocalStates=0);e.sender.replaceTrack(F),void 0!==e.sender.setStreams&&e.sender.setStreams(V),e.direction="sendonly",C.RTCRtpSender=e.sender,C.mid=e.mid}var t,r;avdEngineHandle.simulcastEnabled&&avdEngineHandle.isFirefox&&"video"==I&&(e=C.RTCRtpSender,t={},1==(r=ve(C)+1)?t.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1}]:2==r?t.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1},{rid:"medium",active:!0,priority:"medium",scaleResolutionDownBy:2}]:3==r&&(t.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1},{rid:"medium",active:!0,priority:"medium",scaleResolutionDownBy:2},{rid:"low",active:!0,priority:"low",scaleResolutionDownBy:4}]),e.setParameters(t)),T.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,T.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,T.icePwd);var E="",t=R.parse(e.sdp);t.media.forEach(function(t){if(avdEngineHandle.simulcastEnabled&&!avdEngineHandle.isFirefox&&"video"==I&&"video"==t.type&&t.ssrcs&&0<t.ssrcs.length){for(var e=null,r=0;r<T.selfUser.videos.length;r++){var n=T.selfUser.videos[r];if(t.mid==n.mid){e=ve(n);break}}if(e){for(var o=t,i=e,a=(d=o.ssrcs)[0].id,s=d.length-1;0<=s;s--)d[s].id!=a&&d.splice(s,1);var d=[a],l=a+2e3,u=a+4e3,c=be(o.ssrcs),p=be(o.ssrcs);if(1<=i){for(var h=!1,f=0;f<o.ssrcs.length;f++)if(o.ssrcs[f].id==l){h=!0;break}h||(c.forEach(function(e){e.id=l,o.ssrcs.push(e)}),d.push(l))}if(2<=i){for(var m=!1,f=0;f<o.ssrcs.length;f++)if(o.ssrcs[f].id==u){m=!0;break}m||(p.forEach(function(e){e.id=u,o.ssrcs.push(e)}),d.push(u))}o.ssrcGroups=[],o.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")})}}c=j?"audio":I;if(log.debug("===addSdpHandle(),mediaObj.type:"+t.type+",mediaType:"+(c="screen"==c?"video":c)+",mediaObj.mid:"+t.mid+",media.mid:"+C.mid),t.type==c&&t.mid==C.mid){for(var g,y,v,b=t.msid,_=(b?(log.debug("===addSdpHandle(),msid:"+b),q=b.split(" ")[1]):t.ssrcs.forEach(function(e){"msid"==e.attribute&&(e=e.value)&&(q=e.split(" ")[1])}),!1),r=0;r<t.ssrcs.length;r++)if("msid"==t.ssrcs[r].attribute){_=!0;break}if(!_){log.debug("===addSdpHandle(),ssrc片段中不含有msid信息，做手动补上处理。");for(var S=[],r=0;r<t.ssrcs.length;r++){var w={id:t.ssrcs[r].id,attribute:"msid",value:b};S.push(w)}t.ssrcs=t.ssrcs.concat(S)}E=R.ssrcGroupsAndSsrcsWriter(t.ssrcGroups,t.ssrcs),avdEngineHandle.isFirefox&&(i=b.split(" "),g=i[0],y=i[1],avdEngineHandle.simulcastEnabled?(v="a=ssrc-group:SIM",t.ssrcs.forEach(function(e){e=e.id;v=v+" "+e,E=(E=(E=E+"a=ssrc:"+e+" msid:"+b)+"\r\na=ssrc:"+e+" mslabel:"+g)+"\r\na=ssrc:"+e+" label:"+y,key<t.ssrcs.length&&(E+="\r\n")}),E=v+"\r\n"+E):1==t.ssrcs.length&&(p=t.ssrcs[0].id,E=(E=(E=E+"a=ssrc:"+p+" msid:"+b)+"\r\na=ssrc:"+p+" mslabel:"+g)+"\r\na=ssrc:"+p+" label:"+y)),C.ssrcStr=E}}),log.debug("===addSdpHandle(),resourceType:"+I+",trackId:"+q+",ssrc:"+E),e.sdp=R.writer(t),log.debug("===addSdpHandle(),resourceType:"+I+",local answer description:"+e.sdp),T.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){log.info("===addSdpHandle(),resourceType:"+I+",success to add local description");var e=(e=C.publishKeepAliveTime)||avdEngineHandle.defaultMediaPublishKeepAliveTime;T.masterServer.pubRoomResourceMsg(I,q,E,H,L,e),T.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){if(e==L&&(clearTimeout(pe),T.addSdpLocalStates=0,log.debug("===DDDDDDD_1111111111_222222222,addSdpHandle() pub_roomresourcemsg_rep_success,room.addSdpLocalStates:"+T.addSdpLocalStates),"audio"!=I)&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){e=C.RTCRtpSender;if(e){var t,r=e.getParameters(),n=(r.encodings?r.encodings==[]&&(r.encodings[0]={}):r.encodings=[{}],null),o=!1;if(C.clientSetMaxBandwidth?(n=C.clientSetMaxBandwidth,o=!0):n=C.maxBandwidth,n&&0!=n)avdEngineHandle.isFirefox||(1==(t=r.encodings.length)?r.encodings[0].maxBitrate=1e3*n:2==t?(r.encodings[0].maxBitrate=500*n,r.encodings[1].maxBitrate=1e3*n):3==t&&(r.encodings[0].maxBitrate=250*n,r.encodings[1].maxBitrate=500*n,r.encodings[2].maxBitrate=1e3*n)),avdEngineHandle.isFirefox&&(1==(t=r.encodings.length)?r.encodings[0].maxBitrate=1e3*n:2==t?(r.encodings[0].maxBitrate=1e3*n,r.encodings[1].maxBitrate=500*n):3==t&&(r.encodings[0].maxBitrate=1e3*n,r.encodings[1].maxBitrate=500*n,r.encodings[2].maxBitrate=250*n));else for(var i=0;i<r.encodings.length;i++)delete r.encodings[i].maxBitrate;e.setParameters(r).then(function(){log.info("===addSdpHandle(),resourceType:"+I+",带宽值由应用层调接口设置:"+o+",带宽设置成功,maxBitrate:"+n+",id:"+C.id),"video"==I&&C.sendVideoStreamControl(n,C.resolution.width,C.resolution.height)}).catch(function(e){log.error("===addSdpHandle(),resourceType:"+I+",带宽值由应用层调接口设置:"+o+",带宽设置失败,maxBitrate:"+n+",error:",e)})}}}),T.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==L&&(clearTimeout(pe),T.addSdpLocalStates=0,log.debug("===DDDDDDD_11111111111_4444444444,addSdpHandle() pub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+T.addSdpLocalStates),log.error("===addSdpHandle(),resourceType:"+I+",Failed to pub, by acception PUB_ROOM_RESOURCE_MSG_REP result !=0."))})}).catch(function(e){T.addSdpLocalStates=0,log.debug("===DDDDDDD_11111111111_3333333333,addSdpHandle() pub_roomresourcemsg_rep_success  error,room.addSdpLocalStates:"+T.addSdpLocalStates),log.error("===addSdpHandle(), resourceType:"+I+",Failed to add local description: "+e.toString())})}).catch(function(e){ge(e,T)})}).catch(function(e){log.error("===addSdpHandle(),resourceType:"+I+", Failed to add remote description: "+e.toString())})}else if("update"==e.operationType){log.debug("===操作对列:operationType:update,resourceType:"+e.para1+",updateType:"+e.para2+",resourceId:"+e.resourceId);var o=e.resourceId,c=e.para1,p=e.para2,h=e.para3,G=e.para4,W=e.para5,f=t.roomHandle;if(h){if("video"==c){var a=new SDPTransform,s=a.parse(h.stream.sdp),z=-1,Y=!1,K=!1;if(null!=s.ssrcGroups&&0<s.ssrcGroups.length){for(var d=0;d<s.ssrcGroups.length;d++)"FEC-FR"==(X=s.ssrcGroups[d]).semantics&&(Y=!0),"SIM"==X.semantics&&(K=!0);if(Y&&K){for(var X,d=0;d<s.ssrcGroups.length;d++)"FEC-FR"==(X=s.ssrcGroups[d]).semantics&&(z=d);s.ssrcGroups.splice(z,1),h.stream.sdp=a.writer(s)}}}f.addSdpLocalStates=1,log.debug("===DDDDDDD_2222222222_0000000000,updateSdpHandle(),room.addSdpLocalStates:"+f.addSdpLocalStates+",resourceType:"+c+",updateType:"+p+",resourceId:"+o),clearTimeout(he),he=setTimeout(function(){f.addSdpLocalStates=0,log.debug("===DDDDDDD_2222222222_1111111111,updateSdpHandle(),setTimeout room.addSdpLocalStates:"+f.addSdpLocalStates)},3e3);var J,m=h.stream.stream_name,l=null;if(0==p){for(var u=0;u<f.midObjSet.length;u++)if((b=f.midObjSet[u]).type==c&&b.receiverInfo&&b.receiverInfo.trackId==m){l=b;break}var Q="null";if(l&&(Q=JSON.stringify(l)),log.debug("===updateSdpHandle(),updateType:0,resourceType:"+c+",ownerId:"+h.owner_id+",trackId:"+m+",currMidObj:"+Q),l){if(J=l.mid,!(_=ye(l.mid,f)))return void(log.debug("===updateSdpHandle(),updateType:0,resourceType:"+c+",ownerId:"+h.owner_id+",currMidObj.mid:"+l.mid+", currTransceiver is null, to return"),f.addSdpLocalStates=0);l.isSender?_.direction="sendonly":_.direction="recvonly",l.isReceiver=!1}for(var g=(S=new SDPTransform).parse(f.remoteDescriptionSDP),y=S.parse(h.stream.sdp),u=0;u<g.media.length;u++){var v=g.media[u];if(l&&v.mid==l.mid){v.ssrcGroups=[],v.ssrcs=[],"audio"==c?l.isSender?v.direction="recvonly":v.direction="sendonly":v.direction="sendrecv";break}}f.remoteDescriptionSDP=S.writer(g)}else if(1==p){for(var b,l=null,u=0;u<f.midObjSet.length;u++)if((b=f.midObjSet[u]).type==c&&!b.isReceiver&&b.receiverInfo&&""==b.receiverInfo.trackId){l=b;break}var Q="null",_=(l&&(Q=JSON.stringify(l)),log.debug("===updateSdpHandle(),updateType:1,resourceType:"+c+",ownerId:"+h.owner_id+",trackId:"+m+",currMidObj:"+Q),null);if(l){if(J=l.mid,!(_=ye(l.mid,f)))return void(log.debug("===updateSdpHandle(),updateType:1,resourceType:"+c+",ownerId:"+h.owner_id+",currMidObj.mid:"+l.mid+", currTransceiver is null, to return"),f.addSdpLocalStates=0);l.isSender?_.direction="sendrecv":_.direction="recvonly",l.isReceiver=!0,l.receiverInfo={trackId:m,nodeId:h.owner_id,deviceId:h.resource_id},log.debug("===updateSdpHandle(),updateType:1,resourceType:"+c+",ownerId:"+h.owner_id+",trackId:"+m+",currMidObj != null,trackId:"+m+",currMidObj:"+JSON.stringify(l))}else{f.midNum=f.midNum+1,J=f.midNum;a={mid:f.midNum,type:c,isReceiver:!0,isSender:!1,receiverInfo:{trackId:m,nodeId:h.owner_id,deviceId:h.resource_id}};log.debug("===updateSdpHandle(),updateType:1,resourceType:"+c+",ownerId:"+h.owner_id+",trackId:"+m+",currMidObj = null,trackId:"+m+",newMidObj:"+JSON.stringify(a)),f.midObjSet.push(a)}var S=new SDPTransform;if(l){for(g=S.parse(f.remoteDescriptionSDP),y=S.parse(h.stream.sdp),u=0;u<g.media.length;u++)if((v=g.media[u]).mid==l.mid){v.ssrcGroups=y.ssrcGroups,v.ssrcs=y.ssrcs,y.msid&&(v.msid=y.msid),l.isSender?v.direction="sendrecv":v.direction="sendonly";break}y.msid&&(o=y.msid.split(" ")[0],g.msidSemantic.token=g.msidSemantic.token+" "+o),f.remoteDescriptionSDP=S.writer(g)}else{"audio"==c?w=f.audioMediaTemplate:"video"!=c&&"screen"!=c||(w=f.videoMediaTemplate),w.fingerprint&&(w.fingerprint.type="sha-1",w.fingerprint.hash=f.fingerPrint),w.mid=f.midNum,w.direction="sendonly";var w,Q=S.mediaWriter(w),_=(f.remoteDescriptionSDP=f.remoteDescriptionSDP+Q+h.stream.sdp,S.parse(f.remoteDescriptionSDP));_.groups[0].mids=_.groups[0].mids+" "+f.midNum,f.remoteDescriptionSDP=S.writer(_)}}a={},o=(a.sdp=f.remoteDescriptionSDP,a.type="offer",new RTCSessionDescription(a));log.debug("===updateSdpHandle(),updateType:"+p+",resourceType:"+c+",remote offer description:"+a.sdp),f.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(o).then(function(){log.info("===updateSdpHandle(),updateType:"+p+",resourceType:"+c+",success to add remote description"),f.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,f.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,f.icePwd),log.debug("===updateSdpHandle(),updateType:"+p+",resourceType:"+c+",local answer description:"+e.sdp),f.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){f.addSdpLocalStates=0,log.debug("===DDDDDDD_2222222222_2222222222,updateSdpHandle(),room.addSdpLocalStates:"+f.addSdpLocalStates),log.info("===updateSdpHandle(),updateType:"+p+",resourceType:"+c+",success to add local description"),f.masterServer.subRoomResourceMsg(c,p,h,G,W);var e=EngineCallback.sub_roomresourcemsg_rep_success,t=EngineCallback.sub_roomresourcemsg_rep_error;0==p&&(e=EngineCallback.unsub_roomresourcemsg_rep_success,t=EngineCallback.unsub_roomresourcemsg_rep_error),f.addCallback(e,function(e){if(clearTimeout(he),e==W){for(var e=f.getUserByNodeId(h.owner_id),t=!1,r=(-1<h.resource_id.indexOf("screen_audio")&&(t=!0),null),n=0;n<f.midObjSet.length;n++)if(b.type==c&&b.mid==J){r=b;break}var o,i,a,s,d,l,u=ye(J,f);u&&(o=u.receiver.track),e&&("audio"==c||t)?(i=null,"audio"!=c||t?"audio"==c&&t&&(i=e.getScreenAudio()):i=e.getAudio(h.resource_id),i&&(1==p?(s=!1,f.selfUser.subAudioIds.forEach(function(e){e==i.id&&(s=!0)}),s||f.selfUser.subAudioIds.push(i.id),i.track=o,(u=new MediaStream).addTrack(o),log.info("===audio updateSdpHandle() add, callback subscrible_microphone_result userId:"+e.id+",userName:"+e.name+",resourceId:"+h.resource_id),"audio"!=c||t?"audio"==c&&t&&e.eventEmitter.emit(UserCallback.subscrible_screen_audio_result,u,e.id,e.name):e.eventEmitter.emit(UserCallback.subscrible_microphone_result,u,e.id,e.name)):0==p&&(arrayUtil.baseSplice(f.selfUser.subAudioIds,i.id),i.track=null,log.info("===audio updateSdpHandle() remove,callback unsubscrible_microphone_result userId:"+e.id+",userName:"+e.name),"audio"!=c||t?"audio"==c&&t&&e.eventEmitter.emit(UserCallback.unsubscrible_screen_audio_result,e.id,e.name):e.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,e.id,e.name),r)&&(r.receiverInfo={trackId:"",nodeId:"",deviceId:""}))):e&&"video"==c?(a=e.getVideo(h.resource_id))&&(1==p?(s=!1,f.selfUser.subVideoIds.forEach(function(e){e==a.id&&(s=!0)}),s||f.selfUser.subVideoIds.push(a.id),a.track=o,(u=new MediaStream).addTrack(o),log.info("===video updateSdpHandle add,callback subscrible_camera_result userId:"+e.id+",userName:"+e.name+",resourceId:"+h.resource_id),e.eventEmitter.emit(UserCallback.subscrible_camera_result,u,e.id,e.name,h.resource_id)):0==p&&(arrayUtil.baseSplice(f.selfUser.subVideoIds,a.id),a.track=null,t="null",r&&(t=r.mid),log.info("===video updateSdpHandle remove,callback unsubscrible_camera_result userId:"+e.id+",userName:"+e.name+",videoId:"+h.resource_id+",trackId:"+m+",tempMidObjMid:"+t),e.eventEmitter.emit(UserCallback.unsubscrible_camera_result,e.id,e.name,h.resource_id),r)&&(r.receiverInfo={trackId:"",nodeId:"",deviceId:""})):e&&"screen"==c&&(d=e.getScreen(h.resource_id))&&(1==p?(l=!1,f.selfUser.subScreenIds.forEach(function(e){e==d.id&&(l=!0)}),l||f.selfUser.subScreenIds.push(d.id),d.track=o,(u=new MediaStream).addTrack(o),t=h.stream,log.info("===screen updateSdpHandle add,callback subscrible_screen_result userId:"+e.id+",userName:"+e.name+",resourceId:"+h.resource_id),e.eventEmitter.emit(UserCallback.subscrible_screen_result,u,e.id,e.name,h.resource_id,t.width,t.height,t.frame_rate)):0==p&&(arrayUtil.baseSplice(f.selfUser.subScreenIds,d.id),d.track=null,log.info("===screen updateSdpHandle remove,callback unsubscrible_screen_result  userId:"+e.id+",userName:"+e.name),e.eventEmitter.emit(UserCallback.unsubscrible_screen_result,e.id,e.name,h.resource_id),r)&&(r.receiverInfo={trackId:"",nodeId:"",deviceId:""}))}}),f.addCallback(t,function(e,t){clearTimeout(he),f.addSdpLocalStates=0,1==p?(log.debug("===DDDDDDD_2222222222_3333333333,upateSdpHandle() sub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+f.addSdpLocalStates),log.error("===updateSdpHandle(), resourceType:"+c+",updateType:"+p+",Failed to sub, by acception SUB_ROOM_RESOURCE_MSG_REP result !=0.")):(log.debug("===DDDDDDD_2222222222_4444444444,upateSdpHandle() unsub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+f.addSdpLocalStates),log.error("===updateSdpHandle(), resourceType:"+c+",updateType:"+p+",Failed to sub, by acception UNSUB_ROOM_RESOURCE_MSG_REP result !=0."))})}).catch(function(e){f.addSdpLocalStates=0,log.debug("===DDDDDDD_2222222222_5555555555,updateSdpHandle() error,room.addSdpLocalStates:"+f.addSdpLocalStates),log.error("===updateSdpHandle(),resourceType:"+c+",Failed to add local description,error:"+e.toString())})}).catch(function(e){ge(e,f)})}).catch(function(e){log.error("===updateSdpHandle(),resourceType:"+c+",Failed to add remote description,error:"+e.toString())})}}else if("reduce"==e.operationType){log.debug("===操作对列:operationType:reduce,resourceType:"+e.para1+",resourceId:"+e.para2);var E=e.para1,Z=e.para2,$=e.para3,ee=e.para4,P=t.roomHandle;P.addSdpLocalStates=1,log.debug("===DDDDDDD_4444444444_0000000000,reduceSdpHandle(),room.addSdpLocalStates:"+P.addSdpLocalStates),clearTimeout(me),me=setTimeout(function(){P&&(P.addSdpLocalStates=0,log.debug("===DDDDDDD_4444444444_1111111111,reduceSdpHandle(),setTimeout room.addSdpLocalStates:"+P.addSdpLocalStates))},3e3);var k,x=!1;-1<Z.indexOf("screen_audio")&&(x=!0),"audio"!=E||x?"video"==E?(M=P.getDeviceIdByUUID(0,Z),k=P.selfUser.getVideo(M)):"screen"==E?k=P.selfUser.screen:"audio"==E&&x&&(k=P.selfUser.screen.screenAudio):k=P.selfUser.audio;for(var M,te=null,re=0;re<P.midObjSet.length;re++){var ne=P.midObjSet[re];if(ne.type==E&&ne.mid==k.mid){te=ne;break}}te?(k&&k.RTCRtpSender&&P.traceablePeerConnection.getToMCUPeerConnection().removeTrack(k.RTCRtpSender),te.isSender=!1,ye(k.mid,P).direction="recvonly",M=new SDPTransform,(x=M.parse(P.remoteDescriptionSDP)).media.forEach(function(e){e.mid==k.mid&&(e.direction="sendonly")}),P.remoteDescriptionSDP=M.writer(x),(M={}).sdp=P.remoteDescriptionSDP,M.type="offer",log.debug("===reduceSdpHandle(),resourceType:"+E+",remote offer description:"+M.sdp),x=new RTCSessionDescription(M),P.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(x).then(function(){log.info("===reduceSdpHandle(),resourceType:"+E+",success to add remote description"),P.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,P.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,P.icePwd),log.debug("===reduceSdpHandle(),resourceType:"+E+",local answer description:"+e.sdp),P.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){log.info("===reduceSdpHandle(),resourceType:"+E+",success to add local description");var e=$.getTracks()[0];P.masterServer.unpubRoomResourceMsg(E,e.id,Z,ee),P.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==ee&&(clearTimeout(me),P.addSdpLocalStates=0,log.debug("===DDDDDDD_4444444444_2222222222,reduceSdpHandle(),room.addSdpLocalStates:"+P.addSdpLocalStates))}),P.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==ee&&(clearTimeout(me),log.debug("===DDDDDDD_4444444444_4444444444,reduceSdpHandle() unpub_roomresourcemsg_rep_error ,room.addSdpLocalStates:"+P.addSdpLocalStates),log.error("===reduceSdpHandle(),resourceType:"+E+",Failed to unpub, by acception UNPUB_ROOM_RESOURCE_MSG_REP result !=0."))})}).catch(function(e){P.addSdpLocalStates=0,log.debug("===DDDDDDD_4444444444_3333333333,reduceSdpHandle() error,room.addSdpLocalStates:"+P.addSdpLocalStates),log.error("===reduceSdpHandle(),resourceType:"+E+",Failed to add local description,error:"+e.toString())})}).catch(function(e){P.addSdpLocalStates=0,ge(e,P)})}).catch(function(e){P.addSdpLocalStates=0,log.error("===reduceSdpHandle(),resourceType:"+E+",Failed to add remote description,error:"+e.toString())})):(log.debug("===reduceSdpHandle(),resourceType:"+E+", currMidObj is null, to return"),P.addSdpLocalStates=0)}else if("audioBatch"==e.operationType){log.debug("===操作对列:operationType:audioBatch");var oe=e.para1,A=t.roomHandle;if(oe){for(key in A.addSdpLocalStates=1,log.debug("===DDDDDDD_3333333333_0000000000,audioBatchSdpHandle(),room.addSdpLocalStates:"+A.addSdpLocalStates),clearTimeout(fe),fe=setTimeout(function(){A&&(A.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_1111111111,audioBatchSdpHandle(),setTimeout room.addSdpLocalStates:"+A.addSdpLocalStates))},3e3),oe){for(var ie=oe[key],O=ie.stream.stream_name,ae=ie.owner_id,U=null,se=0;se<A.midObjSet.length;se++){var de=A.midObjSet[se];if("audio"==de.type&&!de.isReceiver){U=de;break}}log.debug("===audioBatchSdpHandle(),ownerId:"+ae+",currMidObj:",U);var D=null,O=(U?(U.mid,D=ye(U.mid,A),U.isSender?D.direction="sendrecv":D.direction="recvonly",U.isReceiver=!0,U.receiverInfo={trackId:O,nodeId:ae,deviceId:ie.resource_id}):(A.midNum=A.midNum+1,A.midNum,D={mid:A.midNum,type:"audio",isReceiver:!0,isSender:!1,receiverInfo:{trackId:O,nodeId:ae,deviceId:ie.resource_id}},A.midObjSet.push(D)),new SDPTransform);if(U){for(var le=O.parse(A.remoteDescriptionSDP),ue=O.parse(ie.stream.sdp),se=0;se<le.media.length;se++){var ce=le.media[se];if(ce.mid==U.mid){ce.ssrcGroups=ue.ssrcGroups,ce.ssrcs=ue.ssrcs,ue.msid&&(ce.msid=ue.msid),U.isSender?ce.direction="sendrecv":ce.direction="sendonly";break}}ue.msid&&(ae=ue.msid.split(" ")[0],le.msidSemantic.token=le.msidSemantic.token+" "+ae),A.remoteDescriptionSDP=O.writer(le)}else{D=A.audioMediaTemplate,ae=(D.fingerprint&&(D.fingerprint.type="sha-1",D.fingerprint.hash=A.fingerPrint),D.mid=A.midNum,D.direction="sendonly",O.mediaWriter(D)),D=(A.remoteDescriptionSDP=A.remoteDescriptionSDP+ae+ie.stream.sdp,O.parse(A.remoteDescriptionSDP));D.groups[0].mids=D.groups[0].mids+" "+A.midNum,A.remoteDescriptionSDP=O.writer(D)}}r={},i=(r.sdp=A.remoteDescriptionSDP,r.type="offer",new RTCSessionDescription(r));log.debug("===audioBatchSdpHandle(),remote offer description:"+r.sdp),A.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(i).then(function(){log.info("===audioBatchSdpHandle(),success to add remote description"),A.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,A.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,A.icePwd),log.debug("===audioBatchSdpHandle(),local answer description:"+e.sdp),A.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){A.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_2222222222,audioBatchSdpHandle(),room.addSdpLocalStates:"+A.addSdpLocalStates),log.info("===audioBatchSdpHandle(),success to add local description");var d=[];for(key in oe)!function(){var a=oe[key],s=getRandomNum(1e4,13e3),e=(A.masterServer.subRoomResourceMsg("audio",1,a,null,s),EngineCallback.sub_roomresourcemsg_rep_success),t=EngineCallback.sub_roomresourcemsg_rep_error;A.addCallback(e,function(e){if(clearTimeout(fe),!d.includes(e)&&e==s){d.push(e);for(var t=null,r=0;r<A.midObjSet.length;r++){var n=A.midObjSet[r];if("audio"==n.type&&n.receiverInfo.nodeId==a.owner_id){t=n.mid;break}}var o,e=ye(t,A),e=(e&&(o=e.receiver.track),A.getUserByNodeId(a.owner_id)),i=e.getAudio(a.resource_id);i&&(i.track=o,(i=new MediaStream).addTrack(o),log.info("===audio audioBatchSdpHandle() add, callback subscrible_microphone_result userId:"+e.id+",userName:"+e.name+",resourceId:"+a.resource_id),e.eventEmitter.emit(UserCallback.subscrible_microphone_result,i,e.id,e.name))}}),A.addCallback(t,function(e,t){clearTimeout(fe),self.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_3333333333,upateSdpHandle() sub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+self.roomHandle.addSdpLocalStates),log.error("===audioBatchSdpHandle(),Failed to sub, by acception SUB_ROOM_RESOURCE_MSG_REP result !=0.")})}(key)}).catch(function(e){A.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_4444444444,audioBatchSdpHandle() error,room.addSdpLocalStates:"+A.addSdpLocalStates),log.error("===audioBatchSdpHandle(),Failed to add local description,error:"+e.toString())})}).catch(function(e){A.addSdpLocalStates=0,ge(e,A)})}).catch(function(e){A.addSdpLocalStates=0,log.error("===audioBatchSdpHandle(),Failed to add remote description,error:"+e.toString())})}}}},r.promise},t.prototype.close=function(e){e&&"closed"!=e.signalingState&&e.close()},t.prototype.doSetLocalDescription=function(){var r=this,n=when.defer();return r.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){var t="active",t=(e=updateSDPSetup(updateSDPIcePwd(updateSDPIceUfrag(e.sdp,r.roomHandle.iceUfrag),r.roomHandle.icePwd),t="active"==r.roomHandle.setup?"passive":t),log.debug("===doSetLocalDescription(),local answer description:"+e),{}),e=(t.sdp=e,t.type="answer",new RTCSessionDescription(t));r.getToMCUPeerConnection().setLocalDescription(e).then(function(){log.info("===doSetLocalDescription(), set local sessionDescription success"),n.resolve()}).catch(function(e){log.error("===doSetLocalDescription(), set local sessionDescription error: "+e.toString()),n.reject(e)})}).catch(function(e){ge(e,roomHandle)}),n.promise},t.prototype.doSetRemoteDescription=function(){var r=this,n=when.defer(),e=(t=updateSDPSetup(updateSDPIcePwd(updateSDPIceUfrag(updateSDPFingerPrint(r.roomHandle.remoteSdpTemplate,r.roomHandle.fingerPrint),r.roomHandle.iceUfrag),r.roomHandle.icePwd),"actpass"),r.roomHandle.remoteDescriptionSDP=t,{}),t=(e.sdp=t,e.type="offer",log.debug("===doSetRemoteDescription, remote sessionDescription:"+t),new RTCSessionDescription(e));return this.getToMCUPeerConnection().setRemoteDescription(t).then(function(){if(log.info("===doSetRemoteDescription(), set remote sessionDescription success"),r.roomHandle.setRemoteDescriptionSuccess=!0,null!=r.roomHandle.addIcecandidateList&&0<r.roomHandle.addIcecandidateList.length){for(var e=0;e<r.roomHandle.addIcecandidateList.length;e++){var t=r.roomHandle.addIcecandidateList[e];r.roomHandle.masterServer.setAddIcecandidate(t)}r.roomHandle.addIcecandidateList=[]}n.resolve()}).catch(function(e){log.error("===doSetRemoteDescription(), setRemoteDescription error:"+e),n.reject(e)}),n.promise},t.prototype.doAddIceCandidate=function(e){var t="",r=(-1<e.candidate.indexOf("=")&&(t=e.candidate.split("=")[1]),new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:"0",candidate:t})),n=(log.info("===pc.addIceCandidate,audio:"+r.candidate),avdEngineHandle.loggerReport.info("PeerConnection add audio IceCandidate:"+r.candidate),this.getToMCUPeerConnection().addIceCandidate(r).then(function(){log.info("===PeerConnection.addIceCandidate,audio Success to add remote candidate["+r.candidate+"]")}).catch(function(e){log.error("===PeerConnection.addIceCandidate,audio Failed to add remote candidate["+r.candidate+"],"+e.toString())}),new RTCIceCandidate({sdpMLineIndex:1,sdpMid:"1",candidate:t}));log.info("===pc.addIceCandidate,video:"+n.candidate),avdEngineHandle.loggerReport.info("PeerConnection add video IceCandidate："+r.candidate),this.getToMCUPeerConnection().addIceCandidate(n).then(function(){log.info("===PeerConnection.addIceCandidate,video Success to add remote candidate["+n.candidate+"]")}).catch(function(e){log.error("===PeerConnection.addIceCandidate,video Failed to add remote candidate["+n.candidate+"],"+e.toString())})},t.prototype.addSdp=function(e,t,r,n){log.debug("===traceablePeerConnection.addSdp(),resourceType:"+e+", resourceId:"+t+", orderId:"+n),a(i("add",t,e,t,r,n),this.roomHandle)},t.prototype.updateSdp=function(e,t,r,n,o){log.debug("===traceablePeerConnection.updateSdp(),resourceType:"+e+",updateType:"+t+",ownerId:"+r.owner_id+",resourceId:"+r.resource_id+",sdp:"+r.stream.sdp),a(i("update",r.resource_id,e,t,r,n,o),this.roomHandle)},t.prototype.reduceSdp=function(e,t,r,n){log.debug("===traceablePeerConnection.reduceSdp(),resourceType:"+e+",resourceId:"+t+", orderId:"+n),a(i("reduce",t,e,t,r,n),this.roomHandle)},t.prototype.audioBatchSdp=function(e){log.debug("===traceablePeerConnection.audioBatchSdp(),resourceInfosLength:"+e.length),a(i("audioBatch",null,e),this.roomHandle)},t.prototype.isContainsReconnectionSub=function(e,t){var r=!1;if(null!=t&&0<t.length)for(var n=0;n<t.length;n++)if(e==t[n]){r=!0;break}return r};function i(e,t,r,n,o,i,a){var s={};return s.operationType=e,s.resourceId=t,s.para1=r,s.para2=n,s.para3=o,s.para4=i,s.para5=a,s}function ge(e,t){t.addSdpLocalStates=0,log.debug("===DDDDDDDDDD252525252525,onCreateSessionDescriptionError(),room.addSdpLocalStates:"+t.addSdpLocalStates),log.error("===onCreateSessionDescriptionError(),Failed to add local description,error:"+e.toString())}function a(e,t){if(e){var r=t.traceablePeerConnection.getToMCUPeerConnection().msgQueue,n=e.operationType;if("audioBatch"==n)log.debug("===msgQueue insertQueueHandle(),operationType=audioBatch"),r.unshift(e);else if("update"==n){var o=e.resourceId,i=e.para1,a=e.para2;if(I(o,t)){var s=o,d=a,l=e,u=t;log.debug("===msgQueue updateHandle(),resourceId:"+s+",updateType:"+d);for(var c,p,h=u.traceablePeerConnection.getToMCUPeerConnection().msgQueue,f=0;f<h.length;f++){var m=h[f];"update"==m.operationType&&m.resourceId==s&&(c=m.para2,p=f)}log.debug("===msgQueue updateHandle(),existUpdateType="+c+",resourceId:"+s),0==c||1==c?(log.debug("===msgQueue updateHandle(),existUpdateType11111111111111"),1==d?0==c?(log.debug("===msgQueue updateHandle(),operationType==update,updateType==1，existUpdateType == 0,resourceId:"+s),h.splice(p,1)):log.debug("===msgQueue updateHandle(),operationType==update,updateType==1，existUpdateType == 1,resourceId:"+s):1==c?(log.debug("===msgQueue updateHandle(),operationType==update,updateType==0，existUpdateType == 1,resourceId:"+s),h.splice(p,1)):log.debug("===msgQueue updateHandle(),operationType==update,updateType==0，existUpdateType == 0,resourceId:"+s)):(log.debug("===msgQueue updateHandle(),existUpdateType000000000000000"),h.unshift(l))}else log.debug("===msgQueue insertQueueHandle(),operationType=update,isExist=false,resourceType:"+i+",updateType:"+a+",resourceId:"+o),r.unshift(e)}else if("add"==n||"reduce"==n){o=e.resourceId,i=e.para1;if(I(o,t)){var u=n,g=o,d=e,l=t;log.debug("===msgQueue addOrReduceHandle(),operationType:"+u+",resourceId:"+g);for(var y,v,b,_,S=l.traceablePeerConnection.getToMCUPeerConnection().msgQueue,w=0;w<S.length;w++){var E=S[w];E.resourceId==g&&("add"==E.operationType?(y=!0,b=w):"reduce"==E.operationType&&(v=!0,_=w))}if(y||v){if("add"==u){if(v)return void(log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==add，existReduceOperationType == true,resourceId:"+g),S.splice(_,1));if(y)return void log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==add，existAddOperationType == true,resourceId:"+g)}"reduce"==u&&(y?(log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==reduce，existAddOperationType == true,resourceId:"+g),S.splice(b,1)):v&&log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==reduce，existReduceOperationType == true,resourceId:"+g))}else S.unshift(d)}else log.debug("===msgQueue insertQueueHandle(),operationType=="+n+",isExist == false,resourceType:"+i+",resourceId:"+o),r.unshift(e)}}}function I(e,t){for(var r=!1,n=t.traceablePeerConnection.getToMCUPeerConnection().msgQueue,o=0;o<n.length;o++)if(n[o].resourceId==e){r=!0;break}return r}function ye(e,t){for(var r=null,n=t.traceablePeerConnection.getToMCUPeerConnection().getTransceivers(),o=0;o<n.length;o++){var i=n[o];if(i.mid==e){r=i;break}}return r||log.debug("===getTransceiver() get transceiver is null,mid:"+e+", transceivers:"+JSON.stringify(n)),r}function ve(e){var t=0,r=e.resolution.width,n=e.resolution.height;return log.debug("===getMockssrcNume(),resolution Width:",r+",Height:"+n),e.track?(n=(r=e.track.getSettings()).width,e=r.height,log.debug("===getMockssrcNume(), trackSetting Width:",n+",Height:"+e),(r=(r=n)<e?e:r)<480?t=0:640<=r&&r<960?t=1:960<=r&&(t=2)):log.debug("===getMockssrcNume(), media.track is null"),log.debug("===getMockssrcNume(), mockNume:",t),t}function be(e){if(e instanceof Array){for(var t=[],r=e.length;r--;)t[r]=be(e[r]);return t}if(e instanceof Object){for(var n in t={},e)t[n]=be(e[n]);return t}return e}return t}),ModuleBase.define("TraceableP2PPeerConnection",["Error"],function(e){function t(){iceServers&&0<iceServers.length?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}}t.prototype.getToP2PPeerConnection=function(e){var t=room.selfUser.toP2PPCs[e];return null==t&&(t=this.createP2PPeerConnection(e),room.selfUser.toP2PPCs[e]=t,room.selfUser.nodeId<e)&&this.sendOfferP2P(t,e),t},t.prototype.createP2PPeerConnection=function(e){var t=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleP2PPeerConnection(e,t),t},t.prototype.sendOfferP2P=function(t,r,e){var n=this.constraints,o=(n.iceRestart=1==e,this);t.createOffer(function(e){log.debug("sendOfferP2P(): P2P  local sessionDescription:"+e.sdp),t.setLocalDescription(e,l,h),room.masterServer.sendOfferP2P(e.sdp,r),o.constraints.iceRestart=!1},function(e){},n)},t.prototype.setRemoteP2P=function(t){var e={},r=(e.sdp=t.sdp,e.type="offer",new RTCSessionDescription(e)),n=(room.sdp=e.sdp,log.debug("setRemoteP2P(): P2P  session Description:"+e.sdp),this.getToP2PPeerConnection(t.node_id));n.setRemoteDescription(r,function(){log.info("setRemoteP2P(): P2P  Set remote session description success."),n.createAnswer(function(e){log.debug("setRemoteP2P(): createAnswer  P2P  local sessionDescription:"+e.sdp),n.setLocalDescription(e,l,h),room.masterServer.setRemoteP2P(e.sdp,t.node_id)},function(e){log.error("setRemoteP2P(): createAnswer  P2P  local sessionDescription false.event:"+e)},this.constraints)},function(e){log.error("setRemoteP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.setAnswerP2P=function(e){var t={},r=(t.sdp=e.sdp,t.type="answer",new RTCSessionDescription(t));log.debug("setAnswerP2P():  P2P  session Description:"+t.sdp),this.getToP2PPeerConnection(e.node_id).setRemoteDescription(r,function(){log.debug("setAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("setAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.addIceCandidateP2P=function(e){var t=this.getToP2PPeerConnection(e.node_id),e=(log.debug("addIceCandidateP2P(), P2P candidate:"+e.candidate),new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid,candidate:e.candidate}));t.addIceCandidate(e,r,n)},t.prototype.addStreamP2P=function(e){var t,r=this.getToP2PPeerConnection(e.sub_node_id),n=e.info.resource_id;1==e.info.stream.type?null!=(t=room.selfUser.getVideo(n).stream)&&(r.addStream(t),room.selfUser.subMyVideosP2P.push(e.sub_node_id)):2==e.info.stream.type?null!=(t=room.selfUser.getAudio(n).stream)&&(r.addStream(t),room.selfUser.subMyAudiosP2P.push(e.sub_node_id)):3==e.info.stream.type&&null!=(t=room.selfUser.getScreen(n).stream)&&(r.addStream(t),room.selfUser.subMyScreensP2P.push(e.sub_node_id))},t.prototype.sendSubSdpOfferP2P=function(e,t){var r;"offerSub"==e?r=this.getToP2PPeerConnection(t.info.owner_id):"answerSub"==e&&(r=this.getToP2PPeerConnection(t.sub_node_id)),r.msgQueue.unshift(o("sub",r,e,t,null))},t.prototype.sendSubSdpAnswerP2P=function(r,n,o,e,i,a){var s=i.stream.sdp,t={},d=(t.sdp=s,t.type="offer",new RTCSessionDescription(t));log.debug("sendSubSdpAnswerP2P(), P2P remote sessionDescription:"+t.sdp),log.debug("sendSubSdpAnswerP2P(): P2P  signalingState: "+n.signalingState),n.setRemoteDescription(d,function(){log.debug("sendSubSdpAnswerP2P(): P2P  Set remote session description success.");var e,t=new SdpSerializer(room.selfUser.sdpP2PMap[i.owner_id]=s);"video"==o?(e=u(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add video sdp:"+e),room.selfUser.videoSdpSsrcMapP2PMap[i.owner_id]=e):"audio"==o?(e=t._inner.audio.ssrcStr,log.debug("sendSubSdpAnswerP2P(), new add audio sdp:"+e),room.selfUser.audioSdpSsrcP2PMap[i.owner_id]=e):"desktop"==o&&(e=u(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add screen sdp:"+e),room.selfUser.screenSdpSsrcP2PMap[i.owner_id]=e),n.createAnswer(function(e){log.debug("sendSubSdpAnswerP2P(), P2P local sessionDescription:"+e.sdp),n.setLocalDescription(e,l,h),room.masterServer.sendSubSdpAnswerP2P(r,i,e.sdp,a)},p,this.constraints)},function(e){log.error(e)})},t.prototype.getSubSdpAnswerP2P=function(e){var t={},r=(t.sdp=e.info.stream.sdp,t.type="answer",new RTCSessionDescription(t));log.debug("getSubSdpAnswerP2P(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.sub_node_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.getSubSdpAnswerP2PByRep=function(e){var t={},r=(t.sdp=e.info.stream.sdp,t.type="answer",new RTCSessionDescription(t));log.debug("getSubSdpAnswerP2PByRep(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.info.owner_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2PByRep(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2PByRep(): P2P  Set remote session description false.event:"+e)})},t.prototype.removeStreamP2P=function(e,t,r){t=this.getToP2PPeerConnection(t);"video"==e?null!=t&&"closed"!=t.signalingState&&null!=r&&(t.removeStream(r),log.debug("removeStreamP2P(): P2P  remove video  stream")):"audio"==e?null!=t&&"closed"!=t.signalingState&&null!=r&&(t.removeStream(r),log.debug("removeStreamP2P(): P2P  remove audio  stream")):"screen"==e&&null!=t&&"closed"!=t.signalingState&&null!=r&&(t.removeStream(r),log.debug("removeStreamP2P(): P2P  remove screen  stream"))},t.prototype.sendUnSubSdpOfferP2P=function(e,t,r,n){r=this.getToP2PPeerConnection(r);null!=r&&"closed"!=r.signalingState&&r.msgQueue.unshift(o("unsub",r,e,t,n))},t.prototype.sendUnSubSdpAnswerP2P=function(e,t,r,n){var o=this.getToP2PPeerConnection(r),r={};if("unsubAnswer"==e){for(var i,a=n.stream.stream_name,s=("video"==t?i=room.selfUser.videoSdpSsrcMapP2PMap[n.owner_id]:"audio"==t?i=room.selfUser.audioSdpSsrcP2PMap[n.owner_id]:"screen"==t&&(i=room.selfUser.screenSdpSsrcP2PMap[n.owner_id]),room.selfUser.sdpP2PMap[n.owner_id]),d=i.split("\r\n"),l=0;l<d.length;l++)var u=d[l]+"\r\n",s=s.replace(u,"");0<s.indexOf(a)&&(s=s.replace(a,"")),room.selfUser.sdpP2PMap[n.owner_id]=s,r.sdp=s,r.type="offer",i=new RTCSessionDescription(r)}else"unpubAnswer"==e&&(r.sdp=o.remoteDescription.sdp,r.type="offer",i=new RTCSessionDescription(r));log.debug("sendUnSubSdpAnswerP2P(): P2P  Remote sessionDescription:"+i.sdp),o.setRemoteDescription(i,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error(e)}),o.createAnswer(function(e){room.sdp=e.sdp,log.debug("sendUnSubSdpAnswerP2P(): P2P  local sessionDescription:"+room.sdp),o.setLocalDescription(e,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set local session description success.")},h)},p,this.constraints)},t.prototype.handleP2PPeerConnection=function(t,r){var e=when.defer();return r.msgQueue=[],r.forLog=!1,r.nodeId=t,r.onicecandidate=function(e){e.candidate?(log.debug("onicecandidate(),P2P event.candidate.candidate :"+e.candidate.candidate),room.masterServer.sendCandidateMsgP2P(e.candidate,t)):log.debug("P2P  End of candidates.")},r.onopen=function(){},r.onaddstream=function(e){var t,r,n;log.debug("onaddstream(), P2P  stream id:"+e.stream.id),"default"!=e.stream.id&&(0<e.stream.getVideoTracks().length?(r=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],t=room.selfUser.subScreenStream2ResourceInfo[e.stream.id],null!=r&&(log.debug("onaddstream(), P2P  stream type: video"),(n=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(r.resource_id),n.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,n.id,n.name,r.resource_id)),null!=t&&(log.debug("onaddstream(), P2P  stream type: screen"),(n=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(t.resource_id),n.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,n.id,n.name,t.resource_id))):0<e.stream.getAudioTracks().length&&(log.debug("onaddstream(), P2P  stream type: audio"),r=room.selfUser.subAudioStream2ResourceInfo[e.stream.id],(n=room.selfUser.getUserByAudioStreamLabel(e.stream.id)).getAudio(r.resource_id).stream=e.stream,n.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,n.id,n.name)))},r.onremovestream=function(e){var t,r,e=e.stream;"default"!=e.id&&(t=room.selfUser.subVideoStream2ResourceInfo[e.id],null!=(r=room.selfUser.getUserByVideoStreamLabel(e.id))&&(delete room.selfUser.subVideoStream2ResourceInfo[e.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id)),r=room.selfUser.subScreenStream2ResourceInfo[e.id],null!=(t=room.selfUser.getUserByScreenStreamLabel(e.id))&&(delete room.selfUser.subScreenStream2ResourceInfo[e.id],t.eventEmitter.emit(UserCallback.unsubscrible_screen_result,t.id,t.name,r.resource_id)),t=room.selfUser.subAudioStream2ResourceInfo[e.id],null!=(r=room.selfUser.getUserByAudioStreamLabel(e.id)))&&(r.getAudio(t.resource_id).stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.id],r.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,r.id,r.name))},r.ondatachannel=function(e){},r.oniceconnectionstatechange=function(e){e=e.target.iceConnectionState;log.info("oniceconnectionstatechange(),P2P iceConnectionState :"+e),"disconnected"!==e||room.isMcu()||room.selfUser.nodeId<r.nodeId&&(log.debug("=======PeerConnection reconnection，send off.  self user nodeId:"+room.selfUser.nodeId+" ----\x3e download user nodeId:"+r.nodeId),room.traceableP2PPeerConnection.sendOfferP2P(r,r.nodeId,!0))},r.onsignalingstatechange=function(e){log.debug("onsignalingstatechange(), P2P signalingState :"+e.target.signalingState),"stable"==e.target.signalingState&&0==r.forLog&&(r.forLog=!0,r.intervalSet(r))},r.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},400)},r.processSignalingMessage=function(e){"stable"==e.signalingState&&0<e.msgQueue.length&&(e=e.msgQueue.pop(),log.debug("P2P 操作对列:"+e.operationType),"sub"==e.operationType?room.traceableP2PPeerConnection.sendSubSdpOfferP2PHandle(e.para1,e.para2,e.para3,e.para4):"unsub"==e.operationType&&room.traceableP2PPeerConnection.sendUnSubSdpOfferP2PHandle(e.para1,e.para2,e.para3,e.para4))},e.promise},t.prototype.sendSubSdpOfferP2PHandle=function(t,r,n){t.createOffer(function(e){log.debug("sendSubSdpOfferP2P():  P2P  local sessionDescription:"+e.sdp),room.sdp=e.sdp,t.setLocalDescription(e,l,h),room.masterServer.sendSubSdpOfferP2P(n,e.sdp,r)},p,this.constraints)},t.prototype.sendUnSubSdpOfferP2PHandle=function(d,l,u,c){d.createOffer(function(e){log.debug("sendUnSubSdpOfferP2PHandle(): P2P  local sessionDescription:"+e.sdp),d.setLocalDescription(e,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set local session description success.");var e={};if("unpubOffer"==l){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unpubOffer"),e.sdp=d.remoteDescription.sdp,e.type="answer";var t=new RTCSessionDescription(e)}else if("unsubOffer"==l){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unsubOffer");for(var r,n=new SdpSerializer(s=d.remoteDescription.sdp),o=("video"==u?r=n._inner.video.ssrcStr:"audio"==u?r=n._inner.audio.ssrcStr:"screen"==u&&(r=n._inner.video.ssrcStr),r.split("\r\n")),i=0;i<o.length;i++)var a=o[i]+"\r\n",s=s.replace(a,"");n=c.stream.stream_name;0<s.indexOf(n)&&(s=s.replace(n,"")),e.sdp=s,e.type="answer",t=new RTCSessionDescription(e)}log.debug("sendUnSubSdpOfferP2PHandle(): P2P  remote  sessionDescription:"+e.sdp),d.setRemoteDescription(t,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description success.")},function(e){log.error("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description false.event:"+e)})},h)},p,this.constraints)};var p=function(){};function l(){}function h(){}var r=function(){},n=function(e){log.error("onAddIceCandidateError(),Failed to add remote  P2P  candidate: "+e.toString())};function u(e,t){var r=e.split("\r\n");if(9<r.length){var n="";if(0<r[4].indexOf(t))for(var o=0;o<9;o++)""==n?n=r[o]:n+="\r\n"+r[o];else for(o=9;o<18;o++)""==n?n=r[o]:n+="\r\n"+r[o];return n}return e}function o(e,t,r,n,o){var i={};return i.operationType=e,i.para1=t,i.para2=r,i.para3=n,i.para4=o,i}return t}),ModuleBase.define("SignalFactory",["TraceableWebsocket"],function(n){function e(){}return e.prototype.getDataChannel=function(e,t){var r;return r=e===SignalType.websocket?new n(t):r},e}),ModuleBase.define("MessageManager",["CmdProtobufCoded","User","Board","Error"],function(ee,te,re,ne){function e(e){this.roomHandle=e}function oe(e,t,r){var r=r.getUserByNodeId(e),e=new Object,n=new Date(1e3*t.timestamp),n=(n.setMinutes(n.getMinutes()-n.getTimezoneOffset()),n.getTime());return e.timestamp=n,e.fromId=r.id,e.fromName=r.name,e.message=t.content,e}return e.prototype.OnWebSocketMessage=function(e){this.roomHandle&&null==this.roomHandle.cmdProtobufCoded?(t=new ee,this.roomHandle.cmdProtobufCoded=t):t=this.roomHandle.cmdProtobufCoded;var t,r=t.getRoomPduTypeEnum(),n=t.getMediaTypeEnum(),H=t.getResourceStatusEnum(),o=t.getResourceOptEnum(),L=t.getMediaPlayEventsEnum(),i=t.decodePacket(e),N=i.type,B=i.priority;if(N==r.INVITE_ROOM_REP1&&0<B&&(this.roomHandle.isDoPDUSeq=1),1==this.roomHandle.isDoPDUSeq&&N!=r.PONG&&N!=r.OPEN_REP&&N!=r.INVITE_ROOM_REP1){if(B<=this.roomHandle.lastPDUSeq)return;if(0<this.roomHandle.connectionState)return void log.debug("===&&&&&&&&&&&&&MessageManager.OnWebSocketMessage(), connectionState>0, no todo,packetType:"+N+",pduSeq:"+B);this.roomHandle.lastPDUSeq=B}switch(N){case r.OPEN_REP:log.debug("===acception OPEN_REP init"),avdEngineHandle.loggerReport.info("acception OPEN_REP init");var a=t.decodeBody(e);this.roomHandle.selfUser.toMCUPC&&!this.roomHandle.selfUser.toMCUPC.iceConnectionState&&(log.info("===acception OPEN_REP, openRep.result："+a.result+" PeerConnection的iceConnectionState不存在，当作402重新加会处理"),a.result=402),0==a.result?(log.info("===acception OPEN_REP result=0"),this.roomHandle.eventEmitter.emit(EngineCallback.open_rep_return_0),1==this.roomHandle.connectionState?(this.roomHandle.masterServer.pingIntervalHandle(),this.roomHandle.masterServer.pingTimeoutHandle(),this.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_66666666666666,room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),log.debug("===acception OPEN_REP 重连成功,room.addSdpLocalStates:",this.roomHandle.addSdpLocalStates),this.roomHandle.selfUser.audio&&log.debug("===acception OPEN_REP 重连成功,room.selfUser.audio.status:",this.roomHandle.selfUser.audio.status),this.roomHandle&&this.roomHandle.selfUser.toMCUPC&&("disconnected"==this.roomHandle.selfUser.toMCUPC.iceConnectionState||"failed"==this.roomHandle.selfUser.toMCUPC.iceConnectionState)&&(log.info("===acception OPEN_REP 重连成功,oniceconnectionstatechange(),iceConnectionState is disconnected or failed, to room.iCERestart()"),this.roomHandle.iCERestart()),log.debug("===acception OPEN_REP openRep.result == 0,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.reconnected),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reconnected)):(this.roomHandle.pingInterval=a.ping_interval,this.roomHandle.pingTimeout=a.ping_timeout,this.roomHandle.signalTocken=a.signal_tocken,this.roomHandle.MaxReconnectTimeout(a.ping_interval),log.info("===acception OPEN_REP, room.pingInterval:"+this.roomHandle.pingInterval+", room.pingTimeout:"+this.roomHandle.pingTimeout+", room.signalTocken:"+this.roomHandle.signalTocken),this.roomHandle.masterServer.pingInit(),2==this.roomHandle.connectionState?(this.roomHandle.lastPDUSeq=0,this.roomHandle.isExistReJoinState=!0,log.debug("===acception OPEN_REP 重新加会连接成功,room.addSdpLocalStates:",this.roomHandle.addSdpLocalStates),this.roomHandle.selfUser.audio&&log.debug("===acception OPEN_REP 重新加会连接成功,room.selfUser.audio.status:",this.roomHandle.selfUser.audio.status),(d=this).roomHandle.selfUser.boards=[],log.debug("===acception OPEN_REP openRep.result == 0,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.reJoinConnected),d.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinConnected)):0==this.roomHandle.connectionState&&(this.roomHandle.isExistReJoinState=!1,log.debug("===acception OPEN_REP 连接成功,room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),this.roomHandle.selfUser.audio&&log.debug("===acception OPEN_REP 连接成功,room.selfUser.audio.status:"+this.roomHandle.selfUser.audio.status),log.debug("===acception OPEN_REP openRep.result == 0,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connected),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected)),this.roomHandle.joinTimeoutState=!1,this.roomHandle.masterServer.pingIntervalHandle(),this.roomHandle.masterServer.pingTimeoutHandle(),this.roomHandle.masterServer.inviteRoomReqSend()),this.roomHandle.connectionState=0):402==a.result?(log.info("===acception OPEN_REP result=402"),avdEngineHandle.loggerReport.error("acception OPEN_REP result=402"),this.roomHandle.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&this.roomHandle.masterServer.signalingChannel.close(),this.roomHandle.currentReconnectTimes=0,this.roomHandle.setRemoteDescriptionSuccess=!1,this.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_7777777777777,openRep.result=402 room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),this.roomHandle.addIcecandidateList=[],log.debug("===acception OPEN_REP openRep.result == 402,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),this.roomHandle&&this.roomHandle.connectionInfoCollector&&this.roomHandle.connectionInfoCollector.stop(),this.roomHandle&&this.roomHandle.connectionStatistics&&this.roomHandle.connectionStatistics.stop(),log.info("===to room.reJoin() by OPEN_REP result == 402."),this.roomHandle.reJoin()):(p=436==a.result?(log.info("===acception OPEN_REP result:"+a.result+",description:"+a.description),avdEngineHandle.loggerReport.info("acception OPEN_REP result:"+a.result+",description:"+a.description),new ne(a.result,"客户端版本过高")):(log.error("===acception OPEN_REP result:"+a.result+",description:"+a.description),avdEngineHandle.loggerReport.error("acception OPEN_REP result:"+a.result+",description:"+a.description),new ne(a.result,a.description)),this.roomHandle.eventEmitter.emit(EngineCallback.room_join_error,p));break;case r.PONG:this.roomHandle.pingCountTime=0;break;case r.INVITE_ROOM_REP1:var d=this,s=(log.debug("===acception INVITE_ROOM_REP1 init"),avdEngineHandle.loggerReport.info("acception INVITE_ROOM_REP1 init"),t.decodeBody(e));0==s.result?(this.roomHandle.fingerPrint=s.finger_print,this.roomHandle.setup=s.setup,this.roomHandle.roomTocken=s.room_tocken,this.roomHandle.roomInfo=s.room_info,this.roomHandle.iceUfrag=s.ice_ufrag,this.roomHandle.icePwd=s.ice_pwd,log.debug("===acception INVITE_ROOM_REP1,iceUfrag:"+s.ice_ufrag+", icePwd:"+s.ice_pwd+", fingerPrint:"+s.finger_print),this.roomHandle.roomInfo.room_id!=this.roomHandle.id&&(this.roomHandle.outgoingAddr=this.roomHandle.id,this.roomHandle.id=this.roomHandle.roomInfo.room_id),this.roomHandle.roomJoinState=RoomStateEnum.CONNECTED,this.roomHandle.setRemoteDescriptionSuccess=!1,this.roomHandle.masterServer.sendAnswer().then(function(){if(0==d.roomHandle.currentReconnectTimes){d.roomHandle.selfUser.nodeId=s.node_id,d.roomHandle.selfUser.role=1,null!=s.role&&(d.roomHandle.selfUser.role=s.role);var e,t,r=avdEngineHandle.cameraMap;for(e in r){var n=r[e];n&&d.roomHandle.selfUser.initVideo(e,n)}if(null!=avdEngineHandle.checkMicrophoneId&&d.roomHandle.selfUser.initAudio(avdEngineHandle.checkMicrophoneId,avdEngineHandle.checkMicrophoneName),d.roomHandle.selfUser.initScreen(),d.roomHandle.addUser(d.roomHandle.selfUser),d.roomHandle.reJoinRoomCount=0,d.roomHandle.audioLevel=new AudioLevel(d.roomHandle),log.info("===acception INVITE_ROOM_REP1 join room  Success, roomId:"+d.roomHandle.id+",nodeId:"+d.roomHandle.selfUser.nodeId+",userId:"+d.roomHandle.selfUser.id+", userName:"+d.roomHandle.selfUser.name),avdEngineHandle.loggerReport.info("acception INVITE_ROOM_REP1 加会成功！房间号:"+d.roomHandle.id+",nodeId:"+d.roomHandle.selfUser.nodeId+",userId:"+d.roomHandle.selfUser.id+",userName:"+d.roomHandle.selfUser.name),null!=d.roomHandle.selfUser.reJoinPubVideoIds&&0<d.roomHandle.selfUser.reJoinPubVideoIds.length){for(var o=0;o<d.roomHandle.selfUser.reJoinPubVideoIds.length;o++){var i=d.roomHandle.selfUser.getVideo(d.roomHandle.selfUser.reJoinPubVideoIds[o]);d.roomHandle.selfUser.reJoinPubVideoElements[o]?i.previewAndPublish(d.roomHandle.selfUser.reJoinPubVideoElements[o],!0).then(function(){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,有视频控件，videoId:"+i.id)}).otherwise(function(e){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,有视频控件，videoId:"+i.id+",pub error:"+JSON.stringify(e))}):i.publish(!0).then(function(){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,没有视频控件，videoId:"+i.id)}).otherwise(function(e){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频，没有视频控件，videoId:"+i.id+",pub error:"+JSON.stringify(e))})}d.roomHandle.selfUser.reJoinPubVideoIds=[],d.roomHandle.selfUser.reJoinPubVideoElements=[]}d.roomHandle.selfUser.reJoinPubAudioId&&(t=d.roomHandle.selfUser.getAudio(d.roomHandle.selfUser.reJoinPubAudioId),log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开音频，重新加会后需要再次打开音频，audioId:"+t.id),t.openMicrophone().then(function(){d.roomHandle.selfUser.reJoinPubAudioId="",d.roomHandle.selfUser.reJoinPubAudioButMute&&(log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前已经打开音频但已静音，重新加会打开麦克风后还原为静音状态"),t.muteMicrophone(),delete d.roomHandle.selfUser.reJoinPubAudioButMute)}).otherwise(function(e){log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开音频，重新加会后需要再次打开音频，audioId:"+t.id+",pub error:"+JSON.stringify(e))})),d.roomHandle.selfUser.reJoinPubScreenStram&&(d.roomHandle.selfUser.screenStream=d.roomHandle.selfUser.reJoinPubScreenStram,log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开桌面共享，重新加会后需要再次打开桌面共享"),d.roomHandle.selfUser.getScreen().publish(d.roomHandle.selfUser.reJoinPubScreenStram).then(function(){d.roomHandle.selfUser.reJoinPubScreenStram=null,log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开桌面共享，重新加会后需要再次打开桌面共享 成功")}).otherwise(function(e){log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开桌面共享，重新加会后需要再次打开桌面共享, pub error:"+JSON.stringify(e))})),d.roomHandle.isExistReJoinState&&(clearTimeout(d.roomHandle.reJoinAfterTimer),d.roomHandle.reJoinAfterTimer=setTimeout(function(){if(d.roomHandle&&d.roomHandle.participants){var e=arrayUtil.chajiObject(d.roomHandle.participants,d.roomHandle.reJoinAfterUsers);if(null!=e&&0<e.length)for(var t=0;t<e.length;t++){var r,n=e[t];n!=d.roomHandle.selfUser.nodeId&&null!=(r=d.roomHandle.getUserByNodeId(n))&&(log.debug("===acception INVITE_ROOM_REP1 重新加会后，已离开的用户退出操作，nodeId:"+n+"，name:"+r.name),d.roomHandle.removeUser(r.id),d.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,1,null,r))}d.roomHandle.reJoinAfterUsers=[]}},3e4))}d.roomHandle.eventEmitter.emit(EngineCallback.room_join_success,d.roomHandle),d.roomHandle.connectionState=0}).otherwise(function(e){log.error("===INVITE_ROOM_REP1, inviteRoomRep1.result：0, masterServer.sendAnswer()，error:"+JSON.stringify(e)),d.roomHandle.eventEmitter.emit(EngineCallback.room_join_error,e)})):402==s.result?(log.info("===INVITE_ROOM_REP1,inviteRoomRep1.result：402"),avdEngineHandle.loggerReport.error("INVITE_ROOM_REP1 Result：402"),this.roomHandle.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&this.roomHandle.masterServer.signalingChannel.close(),this.roomHandle.currentReconnectTimes=0,this.roomHandle.setRemoteDescriptionSuccess=!1,this.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_88888888888,inviteRoomRep1.result=402 room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),this.roomHandle.addIcecandidateList=[],log.debug("===acception INVITE_ROOM_REP1 inviteRoomRep1.result == 402,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),log.info("===to room.reJoin() by INVITE_ROOM_REP1 result == 402."),this.roomHandle.reJoin()):(avdEngineHandle.loggerReport.error("INVITE_ROOM_REP1 Result Error,result:"+s.result+",description:"+s.description),log.info("===INVITE_ROOM_REP1,Result Error,inviteRoomRep1.result: "+s.result+",inviteRoomRep1.description:"+s.description),p=new ne(s.result,s.description),this.roomHandle.eventEmitter.emit(EngineCallback.room_join_error,p));break;case r.CANDIDATE_MSG1:log.debug("===acception CANDIDATE_MSG1 init");var l=t.decodeBody(e);log.info("===acception CANDIDATE_MSG1,candidateMsg:"+l.candidate),this.roomHandle.setRemoteDescriptionSuccess?this.roomHandle.masterServer.setAddIcecandidate(l):this.roomHandle.addIcecandidateList.push(l);break;case r.ICE_RESTART_MSG:log.debug("===acception ICE_RESTART_MSG init");a=t.decodeBody(e);this.roomHandle.remoteICERestart(a);break;case r.ROOM_RESOURCE_INFOS:log.debug("===acception ROOM_RESOURCE_INFOS init");for(var j=t.decodeBody(e).resource_infos,V=(log.debug("===acception ROOM_RESOURCE_INFOS, resourceInfos:"+JSON.stringify(j)),[]),u=0;u<j.length;u++)if(log.debug("===acception ROOM_RESOURCE_INFOS, i: "+u),f=j[u])if(f.stream){var F=f.stream.type;switch(F){case n.video:log.info("===acception ROOM_RESOURCE_INFOS, video resourceInfo.owner_id: "+f.owner_id+",this.roomHandle.selfUser.nodeI:"+this.roomHandle.selfUser.nodeId+",resourceInfo.resource_id:"+f.resource_id),(q=this.roomHandle.traceablePeerConnection.isContainsReconnectionSub(f.resource_id,this.roomHandle.selfUser.reJoinSubVideoIds))?(log.debug("===ROOM_RESOURCE_INFOS, video contains true, resourceInfo.resource_id: "+f.resource_id),(h=this.roomHandle.getUserByNodeId(f.owner_id))&&h.id!=this.roomHandle.selfUser.id&&(null==(S=h.getVideo(f.resource_id))&&(log.debug("===ROOM_RESOURCE_INFOS, video contains is true but video is null, create video"),S=h.createVideo(f.resource_id,"")),S.resourceInfo=f,S.subscrible())):(log.debug("===ROOM_RESOURCE_INFOS, video contains false,resourceInfo.resource_id:"+f.resource_id),(h=this.roomHandle.getUserByNodeId(f.owner_id))&&h.id!=this.roomHandle.selfUser.id&&((S=null==(S=h.getVideo(f.resource_id))?h.createVideo(f.resource_id,""):S).resourceInfo=f,S.ownerId=h.id,this.roomHandle.hasObject(this.roomHandle.pubVideos,S)?log.debug("===ROOM_RESOURCE_INFOS, video contains false,room.pubVideos not to push ,videoId:"+S.id):(log.debug("===ROOM_RESOURCE_INFOS, video contains false,room.pubVideos to push, videoId:"+S.id),this.roomHandle.pubVideos.push(S)),(D=[]).push(S),log.info("===ROOM_RESOURCE_INFOS, video contains false，callback camera_status_notify,userId:"+h.id+",videoId:"+S.id),h.eventEmitter.emit(UserCallback.camera_status_notify,S.status,S.id,S.name,h.id),log.info("===ROOM_RESOURCE_INFOS, video contains false，callback publish_camera_notify,userId:"+h.id+",videoId:"+S.id),h.eventEmitter.emit(UserCallback.publish_camera_notify,D)));break;case n.audio:log.info("===acception ROOM_RESOURCE_INFOS, audio resourceInfo.owner_id: "+f.owner_id+",room.selfUser.nodeId:"+this.roomHandle.selfUser.nodeId);var q=this.roomHandle.traceablePeerConnection.isContainsReconnectionSub(f.resource_id,this.roomHandle.selfUser.reJoinSubAudioIds),c=!1;-1<f.resource_id.indexOf("screen_audio")&&(c=!0),q?(log.debug("===ROOM_RESOURCE_INFOS, audio contains true,nodeId:"+f.owner_id),log.info("===audio subscrible(),订阅音频流,resourceId:"+f.resource_id+",ownerId:"+f.owner_id),avdEngineHandle.loggerReport.info("===audio subscrible(),订阅音频流,resourceId:"+f.resource_id+",ownerId:"+f.owner_id),avdEngineHandle.audioBatchEnabled?V.push(f):(h=this.roomHandle.getUserByNodeId(f.owner_id))&&h.id!=this.roomHandle.selfUser.id&&(c?h.screen&&h.screen.screenAudio&&h.screen.screenAudio.id==f.resource_id&&(h.screen.screenAudio.resourceInfo=f,log.debug("===screen audio subscrible(),订阅屏幕共享音频流,to  user.screen.screenAudio.subscrible()"),h.screen.screenAudio.subscrible()):h.audio&&h.audio.id==f.resource_id&&(h.audio.resourceInfo=f,log.debug("===audio subscrible(),订阅音频流,to  user.audio.subscrible()"),h.audio.subscrible()))):(log.debug("===ROOM_RESOURCE_INFOS, audio contains false,nodeId:"+f.owner_id),(h=this.roomHandle.getUserByNodeId(f.owner_id))&&h.id!=this.roomHandle.selfUser.id&&(w=null,(w=c?(b=h.getScreenAudio())||h.createScreenAudio(f.resource_id,""):h.getAudio(f.resource_id)||h.createAudio(f.resource_id,"")).resourceInfo=f,this.roomHandle.hasObject(this.roomHandle.pubAudios,w)||this.roomHandle.pubAudios.push(w),(z=[]).push(w),c?(log.info("===audio subscrible(),订阅屏幕共享音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+f.resource_id+",ownerId:",f.owner_id),avdEngineHandle.loggerReport.info("===audio subscrible(),订阅屏幕共享音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+f.resource_id+",ownerId:",f.owner_id),w.subscrible()):(avdEngineHandle.audioAutoSub?(this.roomHandle.selfUser.subAudioIds.push(w.id),avdEngineHandle.audioBatchEnabled?V.push(f):(log.info("===audio subscrible(),订阅音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+f.resource_id+",ownerId:",f.owner_id),avdEngineHandle.loggerReport.info("===audio subscrible(),订阅音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+f.resource_id+",ownerId:",f.owner_id),w.subscrible())):h.eventEmitter.emit(UserCallback.publish_microphone_notify,z),log.info("===ROOM_RESOURCE_INFOS, audio contains false,callback microphone_status_notify,userId:"+h.id+",audioId:"+w.id),h.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,h.id))));break;case n.desktop:log.info("===acception ROOM_RESOURCE_INFOS, desktop resourceInfo.owner_id: "+f.owner_id+",room.selfUser.nodeId:"+this.roomHandle.selfUser.nodeId),(q=this.roomHandle.traceablePeerConnection.isContainsReconnectionSub(f.resource_id,this.roomHandle.selfUser.reJoinSubScreenIds))?(log.debug("===ROOM_RESOURCE_INFOS, screen contains true,nodeId:"+f.owner_id),(h=this.roomHandle.getUserByNodeId(f.owner_id))&&h.id!=this.roomHandle.selfUser.id&&((v=h.getScreen(f.resource_id)).resourceInfo=f,v.subscrible())):(log.debug("===ROOM_RESOURCE_INFOS, screen contains false,nodeId:"+f.owner_id),(h=this.roomHandle.getUserByNodeId(f.owner_id))&&h.id!=this.roomHandle.selfUser.id&&((v=null==(v=h.getScreen(f.resource_id))?h.createScreen(f.resource_id,""):v).resourceInfo=f,v.ownerId=h.id,this.roomHandle.pubScreens.push(v),(Y=[]).push(v),log.info("===ROOM_RESOURCE_INFOS, screen contains false,callback screen_status_notify,userId:"+h.id+",screenId:"+v.id),h.eventEmitter.emit(UserCallback.screen_status_notify,v.status,v.id,v.name,h.id),h.eventEmitter.emit(UserCallback.publish_screen_notify,Y)));break;default:log.info("===acception ROOM_RESOURCE_INFOS, switch default, streamType:"+F)}}else log.info("===acception ROOM_RESOURCE_INFOS, resourceInfo stream is null by i: "+u+", resourceInfo:"+JSON.stringify(f));else log.info("===acception ROOM_RESOURCE_INFOS, resourceInfo is null by i: "+u);0<V.length&&(log.debug("===audio batchSubscrible(),acception ROOM_RESOURCE_INFOS 音频自动订阅时,对多路音频进行批量订阅处理,只进行一次SDP交互提高性能. audioResourceInfoBatch.length:"+V.length),this.roomHandle.masterServer.audioBatchSubscribleHandle(V));break;case r.USER_INFO_MSG:log.debug("===acception USER_INFO_MSG init");var G,d=this,p=t.decodeBody(e);null!=p&&(G=[],p.user.forEach(function(e){var t,r=new te(e.user_id,e.user_name,null,d.roomHandle);for(t in r.nodeId=e.node_id,r.role=e.role,r.userAgent=e.user_agent,r.data=e.user_data,log.info("===acception USER_INFO_MSG userId:"+e.user_id+",userName:"+e.user_name+",nodeId:"+r.nodeId),d.roomHandle.reJoinAfterUsers.push(r),d.roomHandle.boardId2userId)d.roomHandle.boardId2userId[t]==e.user_id&&delete d.roomHandle.boardId2userId[t];e.webcams.forEach(function(e){var t=r.createVideo(e.id,e.name);t.status=e.status,t.cameraType=e.ctype,t.level=e.level,t.description=e.description,t.streamName=e.stream_name,t.streamNickName=e.stream_nick_name});var n=null,o=(e.speakers.forEach(function(e){-1<e.id.indexOf("screen_audio")?n=e:r.createAudio(e.id,e.name).status=e.status}),e.desktops.forEach(function(e){var t=r.createScreen(e.id,e.name);t.status=e.status,t.level=e.level,t.description=e.description,n&&(r.createScreenAudio(n.id,n.name).status=n.status)}),d.roomHandle.getUser(e.user_id));o?o.waitingDelete?(log.debug("===acception USER_INFO_MSG,tempUser !=null,tempUser.waitingDelete= true,to add user. userId:"+r.id+", nodeId:"+r.nodeId+", userName:"+r.name),d.roomHandle.addUserByUserIdAndUserId(r),G.push(r)):(log.debug("===acception USER_INFO_MSG,tempUser!=null,tempUser.waitingDelete=false. 402重新加会后nodeId会变，更新处理. userId:"+r.id+", nodeId:"+e.node_id+", userName:"+r.name),d.roomHandle.getUser(r.id).nodeId=e.node_id):(log.debug("===acception USER_INFO_MSG,tempUser =null,to add user. userId:"+r.id+",nodeId:"+r.nodeId+",userName:"+r.name),d.roomHandle.addUser(r),G.push(r)),d.roomHandle.isMcu()||d.roomHandle.p2pServer.createP2PPeerConnection(r.nodeId)}),log.info("===acception USER_INFO_MSG, callback user_join_notify,usersLength:"+G.length),d.roomHandle.eventEmitter.emit(RoomCallback.user_join_notify,G));break;case r.ADD_WEBCAM_MSG:log.debug("===acception ADD_WEBCAM_MSG init");a=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(a.node_id))&&(p=a.webcam,(S=h.createVideo(p.id,p.name)).status=p.status,S.cameraType=p.ctype,S.level=p.level,S.description=p.description,S.streamName=p.stream_name,S.streamNickName=p.stream_nick_name,log.info("===acception ADD_WEBCAM_MSGk,callback camera_status_notify, webcamStatus:"+p.status+",webcamId:"+p.id+",webcamName:"+p.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.camera_status_notify,p.status,p.id,p.name,h.id));break;case r.ADD_SPEAKER_MSG:log.debug("===acception ADD_SPEAKER_MSG init");var a=t.decodeBody(e),h=this.roomHandle.getUserByNodeId(a.node_id),c=a.speaker&&-1<a.speaker.id.indexOf("screen_audio");h&&(p=a.speaker,c?((b=h.createScreenAudio(p.id,p.name)).status=p.status,log.info("===acception ADD_SPEAKER_MSG,callback, speakerStatus:"+p.status+",speakerId:"+p.id+",speakerName:"+p.name+",userId:"+h.id)):((w=h.createAudio(p.id,p.name)).status=p.status,log.info("===acception ADD_SPEAKER_MSG,callback microphone_status_notify, speakerStatus:"+p.status+",speakerId:"+p.id+",speakerName:"+p.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.microphone_status_notify,p.status,p.id,p.name,h.id)));break;case r.ADD_DESKTOP_MSG:log.debug("===acception ADD_DESKTOP_MSG init");a=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(a.node_id))&&(p=a.desktop,(v=h.createScreen(p.id,p.name)).status=p.status,v.level=p.level,v.description=p.description,log.info("===acception ADD_DESKTOP_MSG, callback screen_status_notify,desktopStatus:"+p.status+",desktopId:"+p.id+",desktopName:"+p.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_status_notify,p.status,p.id,p.name,h.id));break;case r.REMOVE_WEBCAM_MSG:log.debug("===acception REMOVE_WEBCAM_MSG init");var W=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(W.node_id))&&(S=h.getVideo(W.resource_id),log.info("===acception REMOVE_WEBCAM_MSG, callback camera_status_notify videoStatus:"+S.status+",videoId:"+S.id+",videoName:"+S.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,S.id,S.name,h.id),setTimeout(function(){arrayUtil.objectSplice(h.videos,W.resource_id)},1500));break;case r.REMOVE_SPEAKER_MSG:log.debug("===acception REMOVE_SPEAKER_MSG init");a=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(a.node_id))&&(log.info("===acception REMOVE_SPEAKER_MSG,callback microphone_status_notify, audioStatus:"+h.audio.status+",audioId:"+h.audio.id+",audioName:"+h.audio.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,h.audio.id,h.audio.name,h.id),h.audio.id==a.resource_id)&&(h.audio=null);break;case r.REMOVE_DESKTOP_MSG:log.debug("===acception REMOVE_DESKTOP_MSG init");p=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(p.node_id))&&(log.info("===acception REMOVE_DESKTOP_MSG, callback screen_status_notify, screenStatus:"+h.screen.status+",screenId:"+h.screen.id+",screenName:"+h.screen.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_status_notify,StreamStatus.none,h.screen.id,h.screen.name,h.id),h.screen.id==p.resource_id)&&(h.screen=null);break;case r.UPDATE_SPEAKER_MSG:log.debug("===acception UPDATE_SPEAKER_MSG init");var a=t.decodeBody(e),h=this.roomHandle.getUserByNodeId(a.node_id),c=!1;-1<a.resource_id.indexOf("screen_audio")&&(c=!0),h&&(c?((b=h.getScreenAudio(a.resource_id)).status=a.speaker.status,log.info("===acception UPDATE_SPEAKER_MSG, callback screen_audio_status_notify, audioId:"+b.id+",audioName:"+b.name+",audioStatus:"+b.status+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_audio_status_notify,b.status,b.id,b.name,h.id)):((w=h.getAudio(a.resource_id)).status=a.speaker.status,log.info("===acception UPDATE_SPEAKER_MSG, callback microphone_status_notify, audioId:"+w.id+",audioName:"+w.name+",audioStatus:"+w.status+",userId:"+h.id),h.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,h.id)));break;case r.UPDATE_WEBCAM_MSG:log.debug("===acception UPDATE_WEBCAM_MSG init");p=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(p.node_id))&&(null==(S=h.getVideo(p.resource_id))&&(log.debug("===acception UPDATE_WEBCAM_MSG init, video is null, create video"),S=h.createVideo(f.resource_id,"")),S.level=p.webcam.level,S.description=p.webcam.description,S.streamName=p.webcam.stream_name,S.streamNickName=p.webcam.stream_nick_name,S.status!=p.webcam.status&&(S.status=p.webcam.status,h.eventEmitter.emit(UserCallback.camera_status_notify,S.status,S.id,S.name,h.id),log.info("===acception UPDATE_WEBCAM_MSG, callback camera_status_notify  videoId:"+S.id+",status:"+S.status+",videoId:"+S.id+",videoName:"+S.name+",userId:"+h.id)),log.info("===acception UPDATE_WEBCAM_MSG, callback camera_data_notify, videoId:"+S.id+",videoName:"+S.name+",videoStatus:"+S.status+",userId:"+h.id),h.eventEmitter.emit(UserCallback.camera_data_notify,S.level,S.description,S.id,S.name,h.id));break;case r.UPDATE_DESKTOP_MSG:log.debug("===acception UPDATE_DESKTOP_MSG init");a=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(a.node_id))&&((v=h.getScreen(a.resource_id)).level=a.desktop.level,v.description=a.desktop.description,v.status=a.desktop.status,log.info("===acception UPDATE_DESKTOP_MSG, callback screen_data_notify, screenId:"+v.id+",screenName:"+v.name+",screenStatus:"+v.status+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_data_notify,v.level,v.description,v.id,v.name,h.id));break;case r.PUB_ROOM_RESOURCE_MSG:log.debug("===acception PUB_ROOM_RESOURCE_MSG init");var z,Y,f=t.decodeBody(e).info;log.debug("===acception PUB_ROOM_RESOURCE_MSG,mediaType:"+f.stream.type+",ownerId:"+f.owner_id),f.stream.type==n.video?(D=[],(h=this.roomHandle.getUserByNodeId(f.owner_id))&&(log.debug("===acception PUB_ROOM_RESOURCE_MSG,owner_id:"+f.owner_id+",userId:"+h.id),null==(S=h.getVideo(f.resource_id))&&(S=h.createVideo(f.resource_id,"")),log.debug("===acception PUB_ROOM_RESOURCE_MSG,video,userId:"+h.id+",userName:"+h.name+",resourceInfo.stream.sdp:"+f.stream.sdp),S.resourceInfo=f,S.status=StreamStatus.published,S.ownerId=h.id,D.push(S),this.roomHandle.hasObject(this.roomHandle.pubVideos,S)?log.debug("===video accept PUB_ROOM_RESOURCE_MSG, this.roomHandle.pubVideos not to push(), videoId:"+S.id):(log.debug("===video accept PUB_ROOM_RESOURCE_MSG, room.pubVideos to push(), videoId:"+S.id),this.roomHandle.pubVideos.push(S)),setTimeout(function(){log.info("===video accept PUB_ROOM_RESOURCE_MSG, callback camera_status_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",status:"+S.status+",videoId:"+S.id+",videoName:"+S.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.camera_status_notify,S.status,S.id,S.name,h.id),log.info("===video accept PUB_ROOM_RESOURCE_MSG, callback publish_camera_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",videosLength:",D.length),h.eventEmitter.emit(UserCallback.publish_camera_notify,D)},400))):f.stream.type==n.audio?(z=[],(h=this.roomHandle.getUserByNodeId(f.owner_id))&&(c=!1,(w=(w=null)==(w=(c=-1!=f.resource_id.indexOf("screen_audio")?!0:c)?(log.debug("===acception PUB_ROOM_RESOURCE_MSG,screen audio,userId:"+h.id+",userName:"+h.name+",resourceInfo.stream.sdp:"+f.stream.sdp),h.getScreenAudio()):(log.debug("===acception PUB_ROOM_RESOURCE_MSG,audio,userId:"+h.id+",userName:"+h.name+",resourceInfo.stream.sdp:"+f.stream.sdp),h.getAudio(f.resource_id)))?c?h.createScreenAudio(f.resource_id,""):h.createAudio(f.resource_id,""):w).resourceInfo=f,w.status=StreamStatus.published,w.ownerId=h.id,z.push(w),c?(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback screen_audio_status_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",status:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_audio_status_notify,w.status,w.id,w.name,h.id),w.subscrible()):(this.roomHandle.hasObject(this.roomHandle.pubAudios,w)?log.info("===audio accept PUB_ROOM_RESOURCE_MSG, room.pubAudios not to push(), audioId:"+w.id):(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, room.pubAudios to push(), audioId:"+w.id),this.roomHandle.pubAudios.push(w)),log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback microphone_status_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",status:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,h.id),avdEngineHandle.audioAutoSub?(this.roomHandle.selfUser.subAudioIds.push(w.id),log.info("===audio accept PUB_ROOM_RESOURCE_MSG,自动订阅音频流,to audio.subscrible(),ownerId:"+f.owner_id+",resourceId:"+f.resource_id+",audioId:"+w.id),avdEngineHandle.loggerReport.info("audio accept PUB_ROOM_RESOURCE_MSG,自动订阅音频流,to audio.subscrible(),ownerId:"+f.owner_id+",resourceId:"+f.resource_id+",audioId:"+w.id),w.subscrible()):(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback  publish_microphone_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",audiosLength:",z.length),h.eventEmitter.emit(UserCallback.publish_microphone_notify,z))))):f.stream.type==n.desktop&&(Y=[],h=this.roomHandle.getUserByNodeId(f.owner_id))&&(null==(v=h.getScreen(f.resource_id))&&(v=h.createScreen(f.resource_id,"")),log.debug("===acception PUB_ROOM_RESOURCE_MSG,screen,userId:"+h.id+",userName:"+h.name+",resourceInfo.stream.sdp:"+f.stream.sdp),v.resourceInfo=f,v.status=StreamStatus.published,v.ownerId=h.id,Y.push(v),this.roomHandle.hasObject(this.roomHandle.pubScreens,v)?log.info("===screen accept PUB_ROOM_RESOURCE_MSG, room.pubScreens not to push(), screenId:"+v.id):(log.info("===screen accept PUB_ROOM_RESOURCE_MSG, room.pubScreens to push(), screenId:"+v.id),this.roomHandle.pubScreens.push(v)),log.info("===screen accept PUB_ROOM_RESOURCE_MSG, callback screen_status_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",status:"+v.status+",screenId:"+v.id+",screenName:"+v.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_status_notify,v.status,v.id,v.name,h.id),log.info("===screen accept PUB_ROOM_RESOURCE_MSG,callback publish_screen_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",screensLength:",Y.length),h.eventEmitter.emit(UserCallback.publish_screen_notify,Y));break;case r.PUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception PUB_ROOM_RESOURCE_MSG_REP init");var p=t.decodeBody(e),m=p.id,g=p.result,y=p.description;log.info("===acception PUB_ROOM_RESOURCE_MSG_REP,orderId:"+m+",result:"+g+",description:",y),0==g?this.roomHandle.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_success,m):(a=new ne(g,y),this.roomHandle.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_error,a,m));break;case r.SUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception SUB_ROOM_RESOURCE_MSG_REP init");p=t.decodeBody(e),m=p.id,g=p.result,y=p.description;log.info("===acception SUB_ROOM_RESOURCE_MSG_REP,orderId:"+m+",result:"+g+",description:",y),0==g?this.roomHandle.eventEmitter.emit(EngineCallback.sub_roomresourcemsg_rep_success,m):(a=new ne(g,y),this.roomHandle.eventEmitter.emit(EngineCallback.sub_roomresourcemsg_rep_error,a,m));break;case r.UNPUB_ROOM_RESOURCE_MSG:log.debug("===acception UNPUB_ROOM_RESOURCE_MSG init");var v,b,f=t.decodeBody(e).info,h=this.roomHandle.getUserByNodeId(f.owner_id),c=f.resource_id&&-1<f.resource_id.indexOf("screen_audio");h&&(f.stream.type==n.video?(S=h.getVideo(f.resource_id))?(S.status=H.init,arrayUtil.objectSplice(this.roomHandle.pubVideos,f.resource_id),log.info("===video accept UNPUB_ROOM_RESOURCE_MSG,取消订阅视频流, callback camera_status_notify videoStatus:"+S.status+",videoId:"+S.id+",videoName:"+S.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.camera_status_notify,S.status,S.id,S.name,h.id),log.info("===video accept UNPUB_ROOM_RESOURCE_MSG,取消订阅视频流, callback unpublish_camera_notify  ownerId:"+f.owner_id+",resourceId:"+f.resource_id+",videoId:"+S.id),h.eventEmitter.emit(UserCallback.unpublish_camera_notify,S)):log.info("===video accept UNPUB_ROOM_RESOURCE_MSG, video is null, resourceInfo.resource_id:"+f.resource_id):f.stream.type==n.audio?(w=null,(w=c?h.getScreenAudio():h.getAudio(f.resource_id))?(w.status=H.init,c?(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback screen_audio_status_notify  resourceId:"+f.resource_id+",ownerId:",f.owner_id+",status:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_audio_status_notify,w.status,w.id,w.name,h.id),w.unsubscrible()):(arrayUtil.objectSplice(this.roomHandle.pubAudios,f.resource_id),log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,取消订阅音频流, callback microphone_status_notify audioStatus:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,h.id),avdEngineHandle.audioAutoSub?(log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,自动取消订阅音频流,to audio.unsubscrible(),ownerId:"+f.owner_id+",resourceId:"+f.resource_id+",audioId:"+w.id),w.unsubscrible()):(log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,取消订阅音频流, callback unpublish_microphone_notify,ownerId:"+f.owner_id+",resourceId:"+f.resource_id+",audioId:"+w.id),h.eventEmitter.emit(UserCallback.unpublish_microphone_notify,w)))):log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG, audio is null, resourceInfo.resource_id:"+f.resource_id)):f.stream.type==n.desktop&&(v=h.getScreen(f.resource_id),b=h.getScreenAudio(),v?(v.status=H.init,arrayUtil.objectSplice(this.roomHandle.pubScreens,f.resource_id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG,取消订阅桌面共享流,, callback screen_status_notify screenStatus:"+v.status+",screenId:"+v.id+",videoName:"+v.name+",userId:"+h.id),h.eventEmitter.emit(UserCallback.screen_status_notify,v.status,v.id,v.name,h.id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG,取消订阅桌面共享流, callback unpublish_screen_notify  ownerId:"+f.owner_id+",resourceId:"+f.resource_id+",screenId:"+v.id),h.eventEmitter.emit(UserCallback.unpublish_screen_notify,v)):log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG, screen is null, resourceInfo.resource_id:"+f.resource_id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG, screen is null, resourceInfo.resource_id:"+f.resource_id)));break;case r.UNPUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception UNPUB_ROOM_RESOURCE_MSG_REP init");p=t.decodeBody(e),m=p.id,g=p.result,y=p.description;log.info("===acception UNPUB_ROOM_RESOURCE_MSG_REP,orderId:"+m+",result:"+g+",description:",y),0==g?this.roomHandle.eventEmitter.emit(EngineCallback.unpub_roomresourcemsg_rep_success,m):(a=new ne(g,y),this.roomHandle.eventEmitter.emit(EngineCallback.unpub_roomresourcemsg_rep_error,a,m));break;case r.UNSUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception UNSUB_ROOM_RESOURCE_MSG_REP init");p=t.decodeBody(e),m=p.id,g=p.result;log.info("===acception UNSUB_ROOM_RESOURCE_MSG_REP,orderId:"+m+",result:"+g),0==g?this.roomHandle.eventEmitter.emit(EngineCallback.unsub_roomresourcemsg_rep_success,m):(y=new ne(g,""),this.roomHandle.eventEmitter.emit(EngineCallback.unsub_roomresourcemsg_rep_error,y,m));break;case r.VIDEO_INDICTION:log.debug("===acception VIDEO_INDICTION init");var _=t.decodeBody(e),a=this.roomHandle.getDeviceIdByUUID(0,_.resource_id),S=this.roomHandle.selfUser.getVideo(a);log.debug("===acception VIDEO_INDICTION resource_id:"+_.resource_id+",opt:"+_.opt),_.opt==o.pub?S.publish():_.opt==o.unpub&&S.unpublish();break;case r.AUDIO_INDICTION:log.debug("===acception AUDIO_INDICTION init");var _=t.decodeBody(e),p=this.roomHandle.getDeviceIdByUUID(2,_.resource_id),w=this.roomHandle.selfUser.getAudio(p);log.debug("===acception AUDIO_INDICTION resource_id:"+_.resource_id+",opt:"+_.opt),_.opt==o.pub?w.openMicrophone():_.opt==o.unpub?w.closeMicrophone():_.opt==o.mute?w.muteMicrophone():_.opt==o.unmute&&w.unmuteMicrophone();break;case r.PUBLIC_TEXT_MSG:log.debug("===acception PUBLIC_TEXT_MSG init");var E=t.decodeBody(e),I=oe(i.src,E,this.roomHandle);this.roomHandle.eventEmitter.emit(RoomCallback.public_message,I);break;case r.PRIVATE_TEXT_MSG:log.debug("===acception PRIVATE_TEXT_MSG init");E=t.decodeBody(e),I=oe(i.src,E,this.roomHandle);this.roomHandle.eventEmitter.emit(RoomCallback.private_message,I);break;case r.PUBLIC_DATA:log.debug("===acception PUBLIC_DATA init");var T=t.decodeBody(e),h=this.roomHandle.getUserByNodeId(i.src);this.roomHandle.eventEmitter.emit(RoomCallback.public_data,T.content.toArrayBuffer(),h.id);break;case r.PRIVATE_DATA:log.debug("===acception PRIVATE_DATA init");T=t.decodeBody(e),h=this.roomHandle.getUserByNodeId(i.src);this.roomHandle.eventEmitter.emit(RoomCallback.private_data,T.content.toArrayBuffer(),h.id);break;case r.PRIVATE_DATA_TO_USER:y=t.decodeBody(e);this.roomHandle.eventEmitter.emit(RoomCallback.private_data_to_user,y.content.toArrayBuffer(),y.src_user_id);break;case r.UPDATE_USER_DATA_MSG:log.debug("===acception UPDATE_USER_DATA_MSG init");a=t.decodeBody(e);(h=this.roomHandle.getUserByNodeId(a.node_id)).data=a.user_data,this.roomHandle.eventEmitter.emit(RoomCallback.user_data_notify,a.user_data,h.id);break;case r.ROOM_DATA_INFO:log.debug("===acception ROOM_DATA_INFO init");var K=t.decodeBody(e).kvs;if(null!=K)for(u=0;u<K.length;++u){var C=K[u];this.roomHandle.appData[C.key]=C.value,this.roomHandle.eventEmitter.emit(RoomCallback.app_data_notify,C.key,C.value),C.key==appDataKeyEnum.voiceActivated&&C.value==this.roomHandle.selfUser.id&&(log.debug("===acception ROOM_DATA_INFO voice_activated key:"+C.key+",value:"+C.value),this.roomHandle.voiceActivatedHandler())}break;case r.USER_INDICTION:log.debug("===acception USER_INDICTION init");p=t.decodeBody(e);p.type==r.USER_MSG&&(R=t.decodeUserMsg(p.body),_=this.roomHandle.getUserId(p.operator_id),log.info("===acception USER_INDICTION,callback leave_indication,reason:"+R.reason+",userId:"+_),this.roomHandle.eventEmitter.emit(RoomCallback.leave_indication,R.reason,_),this.roomHandle.leave(R.reason,!0));break;case r.USER_MSG:var d=this,R=(log.debug("===acception USER_MSG init"),t.decodeBody(e));if(h=this.roomHandle.getUserByNodeId(R.node_id)){log.info("===acception USER_MSG reason:"+R.reason+",userId:"+h.id+",userName:"+h.name+",nodeId:"+R.node_id),"avd_mp4_importer"==h.userAgent&&(this.roomHandle.mp4ImporterUserAudioRtpPacketTemp=0,this.roomHandle.mp4ImporterUserAudioRtpPacketReal=0),h.videos&&0<h.videos.length&&h.videos.forEach(function(e){d.roomHandle&&d.roomHandle.pubVideos&&0<d.roomHandle.pubVideos.length&&arrayUtil.objectSplice(d.roomHandle.pubVideos,e.id),d.roomHandle&&d.roomHandle.selfUser.subVideoIds&&0<d.roomHandle.selfUser.subVideoIds.length&&-1<d.roomHandle.selfUser.subVideoIds.indexOf(e.id)&&(log.debug("===acception USER_MSG,to video.unsubscrible(),userId:"+h.id+",userName:"+h.name+",videoId:"+e.id),e.unsubscrible())}),h.audio&&(this.roomHandle&&this.roomHandle.pubAudios&&0<this.roomHandle.pubAudios.length&&arrayUtil.objectSplice(this.roomHandle.pubAudios,h.audio.id),this.roomHandle)&&this.roomHandle.selfUser.subAudioIds&&0<this.roomHandle.selfUser.subAudioIds.length&&h.audio.resourceInfo&&(log.debug("===acception USER_MSG,to audio.unsubscrible(),userId:"+h.id+",userName:"+h.name+",audioId:"+h.audio.id),-1<this.roomHandle.selfUser.subAudioIds.indexOf(h.audio.id))&&h.audio.unsubscrible(),h.screen&&(this.roomHandle&&this.roomHandle.pubScreens&&0<this.roomHandle.pubScreens.length&&arrayUtil.objectSplice(this.roomHandle.pubScreens,h.screen.id),this.roomHandle)&&this.roomHandle.selfUser.subScreenIds&&0<this.roomHandle.selfUser.subScreenIds.length&&h.screen.resourceInfo&&(log.debug("===acception USER_MSG,to screen.unsubscrible(),userId:"+h.id+",userName:"+h.name+",screenId:"+h.screen.id),-1<this.roomHandle.selfUser.subScreenIds.indexOf(h.screen.id))&&h.screen.unsubscrible();d=this;if(setTimeout(function(){!d.roomHandle||d.roomHandle.selfUser.nodeId==h.nodeId&&!d.roomHandle.selfUser.waitingDelete||(log.debug("===acception USER_MSG,to remove user,userId:"+h.id+",nodeId:"+h.nodeId+",userName:"+h.name),d.roomHandle.removeUserByUserIdAndNodeId(h.id,h.nodeId))},3500),804==R.reason)return void(h.id==this.roomHandle.selfUser.id?(this.roomHandle.selfUser.mulLanding=!0,this.roomHandle.masterServer.pingInit(),log.info("===acception USER_MSG,callback leave_indication,reason:"+R.reason+",userId:"+this.roomHandle.selfUser.id+",userName:"+this.roomHandle.selfUser.name),this.roomHandle.eventEmitter.emit(RoomCallback.leave_indication,R.reason,this.roomHandle.selfUser.id),this.roomHandle.leave(R.reason,!0)):(h.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+R.reason+",userId:"+h.id+",userName:"+h.name),this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,R.opt,R.reason,h)));if(807!=R.reason){if(808==R.reason)return void(h.id==this.roomHandle.selfUser.id?(this.roomHandle.masterServer.pingInit(),log.info("===acception USER_MSG,callback leave_indication,reason:"+R.reason+",userId:"+this.roomHandle.selfUser.id+",userName:"+this.roomHandle.selfUser.name),this.roomHandle.eventEmitter.emit(RoomCallback.leave_indication,R.reason,this.roomHandle.selfUser.id),this.roomHandle.leave(R.reason,!0)):(h.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+R.reason+",userId:"+h.id+",userName:"+h.name),this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,R.opt,R.reason,h)));if(812==R.reason)return void(h.id!=this.roomHandle.selfUser.id&&(h.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+R.reason+",userId:"+h.id+",userName:"+h.name),this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,R.opt,R.reason,h)));var X=[];if(null!=this.roomHandle.boardId2userId&&0<Object.keys(this.roomHandle.boardId2userId).length)for(var J in this.roomHandle.boardId2userId)this.roomHandle.boardId2userId[J]==h.id&&(X.push(J),delete this.roomHandle.boardId2userId[J]);if(null!=this.roomHandle.annotation2boardId&&0<Object.keys(this.roomHandle.annotation2boardId).length)for(var J in this.roomHandle.annotation2boardId)-1<X.indexOf(J)&&delete this.roomHandle.annotation2boardId[J]}h.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+R.reason+",userId:"+h.id+",userName:"+h.name),this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,R.opt,R.reason,h)}break;case r.CLOSE_ROOM_REP:log.debug("===acception CLOSE_ROOM_REP init");E=t.decodeBody(e);log.info("===acception CLOSE_ROOM_REP,callback close_room_result,result:"+E.result+",description:"+E.description),this.roomHandle.eventEmitter.emit(RoomCallback.close_room_result,E.result,E.description),this.roomHandle.masterServer.signalingChannel.close(),this.roomHandle=null;break;case r.CLOSE_ROOM_MSG:log.debug("===acception CLOSE_ROOM_MSG init");I=t.decodeBody(e);this.roomHandle.userClearInfo(),log.info("===acception CLOSE_ROOM_MSG,callback close_room_notify,reason:"+I.reason+",roomId:"+I.room_id),this.roomHandle.eventEmitter.emit(RoomCallback.close_room_notify,I.room_id,I.reason);break;case r.UPDATE_USER_NAME:log.debug("===acception UPDATE_USER_NAME init");var Q=t.decodeBody(e),h=this.roomHandle.getUserByNodeId(Q.node_id);this.roomHandle.participants.forEach(function(e){e.id==e.id&&(e.name=Q.new_name)}),log.info("===acception UPDATE_USER_NAME,callback user_name_notify,newName:"+Q.new_name+",userId:"+h.id),this.roomHandle.eventEmitter.emit(RoomCallback.user_name_notify,Q.new_name,h.id);break;case r.MODIFY_RESOURCE_REQ:log.debug("===acception MODIFY_RESOURCE_REQ init");var T=t.decodeBody(e),P=(log.debug("===acception MODIFY_RESOURCE_REQ,on modify resource req,resource_id:"+T.info.resource_id),this.roomHandle.getDeviceIdByUUID(0,T.info.resource_id));avdEngineHandle.ignoreModifyResourceReq?log.info("===acception MODIFY_RESOURCE_REQ, avdEngineHandle.ignoreModifyResourceReq is true to return, resource_id:"+T.info.resource_id+",video_level:"+T.video_level):(S=this.roomHandle.selfUser.getVideo(P))&&(log.info("===acception MODIFY_RESOURCE_REQ,to video.changePublishVideoQuality(),videoId:"+S.id+",video_level:"+T.video_level),S.changePublishVideoQuality(T.video_level));break;case r.VIDEO_STREAM_CONTROL_REP:log.debug("===acception VIDEO_STREAM_CONTROL_REP init");y=t.decodeBody(e),m=y.id,g=y.ret,a=y.msg;log.info("===acception VIDEO_STREAM_CONTROL_REP,orderId:"+m+",result:"+g+",msg:",a),0==g?this.roomHandle.eventEmitter.emit(UserCallback.video_stream_control_rep_success,m):(p=new ne(g,a),this.roomHandle.eventEmitter.emit(UserCallback.video_stream_control_rep_error,p,m));break;case r.BIND_AUDIO_TO_VIDEO_REP:log.debug("===acception BIND_AUDIO_TO_VIDEO_REP init");_=t.decodeBody(e);_&&0==_.result?this.roomHandle.eventEmitter.emit(RoomCallback.bind_audio2video_rep_success,_.id):this.roomHandle.eventEmitter.emit(RoomCallback.bind_audio2video_rep_error,_.id);break;case r.USER_STREAM_ACTIVE:log.debug("===acception USER_STREAM_ACTIVE init");R=t.decodeBody(e);R&&R.resource_id&&(E=R.resource_id,I=R.active_base,T=R.active_ass1,y=R.active_ass2,log.debug("===acception USER_STREAM_ACTIVE resource_id:"+E+",active_base:"+I+",active_ass1:"+T+",active_ass2:"+y),P=this.roomHandle.getDeviceIdByUUID(0,E),S=this.roomHandle.selfUser.getVideo(P))&&S.setSpatialLayerActive(I,T,y);break;case r.ROOM_ATTRIBUTE_CHANGE_NOTIFY:log.debug("===acception ROOM_ATTRIBUTE_CHANGE_NOTIFY init");g=t.decodeBody(e);g&&(a=g.attributes)&&((p=JSON.parse(a)).record&&(this.roomHandle.roomControl.record=p.record),p.mix_record&&(this.roomHandle.roomControl.mix_record=p.mix_record),p.avc_model&&(this.roomHandle.roomControl.avc_model=p.avc_model),p.resolution&&(this.roomHandle.roomControl.resolution=p.resolution),p.liver&&(this.roomHandle.roomControl.liver=p.liver),p.mixer_liver&&(this.roomHandle.roomControl.mixer_liver=p.mixer_liver),this.roomHandle.eventEmitter.emit(RoomCallback.room_control_change_notify,this.roomHandle.roomControl));break;case r.MEDIA_PLAY_EVENT_NOTIFY:var d=this,k=(log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY init"),t.decodeBody(e));k?k.event==L.MediaPlayEventsStarted?(this.roomHandle.mp4ImporterUserAudioStateStart(200),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY callback mediaplay_started_notify, id:"+k.id+",roomId:"+k.room_id+",userId:"+k.user_id+",playId:"+k.play_id+",filePath:"+k.file_path),this.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_started_notify,k.id,k.room_id,k.user_id,k.play_id,k.file_path)):k.event==L.MediaPlayEventsStoped&&((h=this.roomHandle.getUser(k.user_id))?h.audio?0==h.audio.audioLevel?(this.roomHandle.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY callback mediaplay_stoped_notify, id:"+k.id+",roomId:"+k.room_id+",userId:"+k.user_id+",playId:"+k.play_id+",filePath:"+k.file_path),this.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,k.id,k.room_id,k.user_id,k.play_id,k.file_path)):(null==this.roomHandle.baseMediaPalyEventStopTime&&(this.roomHandle.baseMediaPalyEventStopTime=new Date),this.roomHandle.mediaPalyEventStopIntervalId=setInterval(function(){1e3<=new Date-d.roomHandle.baseMediaPalyEventStopTime&&(clearInterval(d.roomHandle.mediaPalyEventStopIntervalId),d.roomHandle.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY timeout callback mediaplay_stoped_notify, id:"+k.id+",roomId:"+k.room_id+",userId:"+k.user_id+",playId:"+k.play_id+",filePath:"+k.file_path),d.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,k.id,k.room_id,k.user_id,k.play_id,k.file_path)),0==h.audio.audioLevel&&(clearInterval(d.roomHandle.mediaPalyEventStopIntervalId),d.roomHandle.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY IntervalId callback mediaplay_stoped_notify, id:"+k.id+",roomId:"+k.room_id+",userId:"+k.user_id+",playId:"+k.play_id+",filePath:"+k.file_path),d.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,k.id,k.room_id,k.user_id,k.play_id,k.file_path))},100)):log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY user.audio is null"):log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY user is null")):log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY mediaPlayEventNotify is null");break;case r.STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY:log.debug("===acception STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY init");m=t.decodeBody(e);m&&m.onwer_id&&(h=this.roomHandle.getUserByNodeId(m.onwer_id))&&(log.info("===acception STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY callback stream_keep_alive_timeout_notify, userId:"+h.id+", userName:"+h.name+", mediaType:"+m.media_type+", resourceId:"+m.resource_id+", ssrc:"+m.ssrc),this.roomHandle.eventEmitter.emit(RoomCallback.stream_keep_alive_timeout_notify,h.id,h.name,m.media_type,m.resource_id,m.ssrc));break;case r.OFFER_REQ:log.debug("===P2P acception OFFER_REQ");_=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.setRemoteP2P(_);break;case r.OFFER_REP:log.debug("===P2P acception OFFER_REP");R=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.setAnswerP2P(R);break;case r.CANDIDATE_MSG:log.debug("===P2P acception CANDIDATE_MSG");l=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.addIceCandidateP2P(l);break;case r.SUB_ROOM_RESOURCE_REQ:log.debug("===P2P acception SUB_ROOM_RESOURCE_REQ");E=t.decodeBody(e);this.roomHandle.selfUser.nodeId>E.sub_node_id?(this.roomHandle.traceableP2PPeerConnection.addStreamP2P(E),U=E.info,O=this.roomHandle.traceableP2PPeerConnection.getToP2PPeerConnection(E.sub_node_id),U.stream.type==n.video?(log.info("===accept video P2P SUB_ROOM_RESOURCE_REQ: "+E.sub_node_id+"------\x3e"+this.roomHandle.selfUser.nodeId),this.roomHandle.selfUser.subVideoStream2ResourceInfo[U.stream.stream_name]=U,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",O,"video",1,U,E.sub_node_id)):U.stream.type==n.audio?(log.info("===accept audio P2P SUB_ROOM_RESOURCE_REQ: "+E.sub_node_id+"------\x3e"+this.roomHandle.selfUser.nodeId),this.roomHandle.selfUser.subAudioStream2ResourceInfo[U.stream.stream_name]=U,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",O,"audio",1,U,E.sub_node_id)):U.stream.type==n.desktop&&(log.info("===accept desktop P2P  SUB_ROOM_RESOURCE_REQ: "+E.sub_node_id+"------\x3e"+this.roomHandle.selfUser.nodeId),this.roomHandle.selfUser.subScreenStream2ResourceInfo[U.stream.stream_name]=U,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",O,"desktop",1,U,E.sub_node_id))):(this.roomHandle.traceableP2PPeerConnection.addStreamP2P(E),this.roomHandle.traceableP2PPeerConnection.sendSubSdpOfferP2P("answerSub",E));break;case r.SUB_ROOM_RESOURCE_REP:log.debug("===P2P acception SUB_ROOM_RESOURCE_REP, TO sub");P=t.decodeBody(e);this.roomHandle.selfUser.nodeId>P.info.owner_id?(U=P.info,O=this.roomHandle.traceableP2PPeerConnection.getToP2PPeerConnection(U.owner_id),U.stream.type==n.video?(this.roomHandle.selfUser.subVideoStream2ResourceInfo[U.stream.stream_name]=U,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",O,"video",1,U,U.owner_id)):U.stream.type==n.audio?(this.roomHandle.selfUser.subAudioStream2ResourceInfo[U.stream.stream_name]=U,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",O,"audio",1,U,U.owner_id)):U.stream.type==n.desktop&&(this.roomHandle.selfUser.subScreenStream2ResourceInfo[U.stream.stream_name]=U,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",O,"desktop",1,U,U.owner_id))):this.roomHandle.traceableP2PPeerConnection.getSubSdpAnswerP2PByRep(P);break;case r.SUB_ROOM_RESOURCE_MSG:log.debug("===P2P acception SUB_ROOM_RESOURCE_MSG");I=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.getSubSdpAnswerP2P(I);break;case r.UPDATE_BOARD_MSG:log.debug("===acception UPDATE_BOARD_MSG init");var x=t.decodeBody(e),d=(log.debug("===acception UPDATE_BOARD_MSG,operType:"+x.operType+",operNodeId:"+x.operNodeId+",operUserId:"+x.operUserId+",boardId:"+x.boardId),this);setTimeout(function(){function e(e){var t=e.board.bgColor,t=t.r+","+t.g+","+t.b+","+t.a/255,t=new re(d.roomHandle,e.board.ownerUserId,e.board.width,e.board.height,t,e.board.bgImage,e.board.title,"","",e.board.description,e.board.extendData);t.setBoardId(e.board.objectId),s.boards&&s.boards.push(t),d.roomHandle.boardId2userId[t.id]=s.id,s.eventEmitter.emit(UserCallback.board_add_result,t)}function t(e){var t,r=d.roomHandle.getUser(d.roomHandle.boardId2userId[e.boardId]),n=r.getBoard(e.boardId),o=[];if(n.status=boardStatusEnum.open,d.roomHandle.annotation2boardId[e.boardId]){if(t=d.roomHandle.annotation2boardId[e.boardId].storageArr,(o=d.roomHandle.annotation2boardId[e.boardId].queueArr).length<0)for(var i in t)o.push(t[i]);else for(var a in o)for(var i in t)t[i].annotationType!=shapeTypeEnum.img&&t[i].annotationId!=o[a].annotationId&&t[i].operType!=o[a].operType&&o.push(t[i]);d.roomHandle.updateAnnotationDrow(o)}r.eventEmitter.emit(UserCallback.board_share_result,n)}function r(e){arrayUtil.objectSplice(s.boards,e.boardId),delete d.roomHandle.boardId2userId[s.id],delete d.roomHandle.annotation2boardId[e.boardId],s.eventEmitter.emit(UserCallback.board_remove_result,e.boardId)}function n(e){var t=d.roomHandle.getUser(d.roomHandle.boardId2userId[e.boardId]),r=t.getBoard(e.boardId);if(r.status=boardStatusEnum.close,r.annotation=null,d.roomHandle.annotation2boardId[e.boardId])for(var n in d.roomHandle.annotation2boardId[e.boardId].storageArr)d.roomHandle.annotation2boardId[e.boardId].queueArr.push(d.roomHandle.annotation2boardId[e.boardId].storageArr[n]);t.eventEmitter.emit(UserCallback.board_close_result,e.boardId)}var o,i,a,s=d.roomHandle.getUser(x.operUserId);s&&(a=x.boardId,x.operType==OperType.add?(log.debug("===acception UPDATE_BOARD_MSG,operType=add"),d.roomHandle.boardAddOrShareMsgMap.get(a)&&d.roomHandle.boardAddOrShareMsgMap.get(a).share?(e(x),t(x),d.roomHandle.boardAddOrShareMsgMap.delete(a)):(d.roomHandle.boardAddOrShareMsgMap.set(a,{add:!0,share:!1}),setTimeout(function(){d.roomHandle.boardAddOrShareMsgMap.delete(a)},1e3))):x.operType==OperType.update?(log.debug("===acception UPDATE_BOARD_MSG,operType=update"),o=(o=x.board.bgColor).r+","+o.g+","+o.b+","+o.a/255,i=x.board.bgImage,a=x.board.objectId,log.debug("===acception UPDATE_BOARD_MSG,operType=update,boardId:"+a+",backgroundColor:"+o+",backgroundImage:"+i),s.eventEmitter.emit(UserCallback.board_update_result,a,o,i)):x.operType==OperType.remove?(log.debug("===acception UPDATE_BOARD_MSG,operType=remove"),d.roomHandle.boardCloseOrRemoveMsgMap.get(a)&&d.roomHandle.boardCloseOrRemoveMsgMap.get(a).close?(n(x),r(x),d.roomHandle.boardCloseOrRemoveMsgMap.delete(a)):(s=d.roomHandle.getUser(d.roomHandle.boardId2userId[x.boardId])).getBoard(x.boardId)?(r(x),d.roomHandle.boardCloseOrRemoveMsgMap.delete(a)):(d.roomHandle.boardCloseOrRemoveMsgMap.set(a,{close:!1,remove:!0}),setTimeout(function(){d.roomHandle.boardCloseOrRemoveMsgMap.delete(a)},1e3))):x.operType==OperType.share?(log.debug("===acception UPDATE_BOARD_MSG,operType=share"),d.roomHandle.boardAddOrShareMsgMap.get(a)&&d.roomHandle.boardAddOrShareMsgMap.get(a).add?(e(x),t(x),d.roomHandle.boardAddOrShareMsgMap.delete(a)):(s=d.roomHandle.getUser(x.operUserId)).getBoard(x.boardId)?(t(x),d.roomHandle.boardAddOrShareMsgMap.delete(a)):(e(x),t(x),d.roomHandle.boardAddOrShareMsgMap.set(a,{add:!1,share:!0}),setTimeout(function(){d.roomHandle.boardAddOrShareMsgMap.delete(a)},1e3))):x.operType==OperType.close&&(log.debug("===acception UPDATE_BOARD_MSG,operType=close"),d.roomHandle.boardCloseOrRemoveMsgMap.get(a)&&d.roomHandle.boardCloseOrRemoveMsgMap.get(a).remove?(n(x),r(x),d.roomHandle.boardCloseOrRemoveMsgMap.delete(a)):(s=d.roomHandle.getUser(d.roomHandle.boardId2userId[x.boardId])).getBoard(x.boardId)?(n(x),d.roomHandle.boardCloseOrRemoveMsgMap.delete(a)):(d.roomHandle.boardCloseOrRemoveMsgMap.set(a,{close:!0,remove:!1}),setTimeout(function(){d.roomHandle.boardCloseOrRemoveMsgMap.delete(a)},1e3))))},1500);break;case r.UPDATE_BOARD_MSG_REP:log.debug("===acception UPDATE_BOARD_MSG_REP init");T=t.decodeBody(e),h=(log.info("===acception UPDATE_BOARD_MSG_REP, boardId:"+T.boardId+", result:"+T.result+", description:"+T.description),this.roomHandle.getUser(this.roomHandle.boardId2userId[T.boardId]));0==T.result?h.eventEmitter.emit(EngineCallback.updateboardmsg_rep_success,T.boardId):(y=new ne(T.result,T.description),h.eventEmitter.emit(EngineCallback.updateboardmsg_rep_error,y,T.boardId));break;case r.BOARDS_INFO_PDU:log.debug("===acception BOARDS_INFO_PDU init");var Z=t.decodeBody(e);break;case r.UPDATE_ANNOTATION_MSG:log.debug("===acception UPDATE_ANNOTATION_MSG init");var M=t.decodeBody(e),h=(console.log("===acception UPDATE_ANNOTATION_MSG updateAnnotationMsg:",M),log.debug("===acception UPDATE_ANNOTATION_MSG, operType:"+M.operType+",objectId:"+M.objectId+",annotationType:"+M.annotationType+",annotationId:"+M.annotationId+",operNodeId:"+M.operNodeId+",operUserId:"+M.operUserId),this.roomHandle.addAnnotationMsg(M),this.roomHandle.getUser(this.roomHandle.boardId2userId[M.objectId]));if(M.annotationType==shapeTypeEnum.clear&&this.roomHandle.annotation2boardId[M.objectId]&&0<this.roomHandle.annotation2boardId[M.objectId].storageArr.length)for(u=0;u<this.roomHandle.annotation2boardId[M.objectId].storageArr.length;u++){var $=this.roomHandle.annotation2boardId[M.objectId].storageArr[u];$.operUserId==M.operUserId&&$.operType==OperType.add&&(this.roomHandle.annotation2boardId[M.objectId].storageArr.splice(u,1),u--)}h&&(g=h.getBoard(M.objectId),a=this.roomHandle.annotation2boardId[M.objectId],log.debug("===acception UPDATE_ANNOTATION_MSG"),g)&&g.status==boardStatusEnum.open&&a&&(log.debug("===acception UPDATE_ANNOTATION_MSG, board.status == boardStatusEnum.open"),this.roomHandle.updateAnnotationDrow(a.queueArr));break;case r.OUTGOING_CREATE_STREAMS_EXPORTER_REP:log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP init");p=t.decodeBody(e);0==p.result?(log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP,callback create_server_recorder_rep_success,result:0,outgoingCreateStreamsExporterRep.exporter_id:",p.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_success,p.id,p.exporter_id,p.exporter_name,p.play_urls)):(log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP,callbakc create_server_recorder_rep_error, result:"+p.result+",msg:"+p.msg+",exporter_id:",p.exporter_id),m=new ne(p.result,p.msg),this.roomHandle.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_error,m,p.id));break;case r.OUTGOING_SELECT_STREAM_REP:log.debug("===acception OUTGOING_SELECT_STREAM_REP init");_=t.decodeBody(e);0==_.result?(log.debug("===acception OUTGOING_SELECT_STREAM_REP,callback select_stream_rep_success,result:0,selectStreamRep.exporter_id:",_.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.select_stream_rep_success,_.id,_.exporter_id)):(log.debug("===acception OUTGOING_SELECT_STREAM_REP,callbakc select_stream_rep_error, result:"+_.result+",msg:"+_.msg+",exporter_id:",_.exporter_id),A=new ne(_.result,_.msg),this.roomHandle.eventEmitter.emit(ExporderCallBack.select_stream_rep_error,A,_.id));break;case r.OUTGOING_MIX_STREAMS_REP:log.debug("===acception OUTGOING_MIX_STREAMS_REP init");R=t.decodeBody(e);0==R.result?(log.debug("===acception OUTGOING_MIX_STREAMS_REP,callback mix_media_rep_success,result:0,mixStreamsRep.exporter_id:",R.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.mix_media_rep_success,R.id,R.exporter_id)):(log.debug("===acception OUTGOING_MIX_STREAMS_REP,callbakc mix_media_rep_error, result:"+R.result+",msg:"+R.msg+",exporter_id:",R.exporter_id),A=new ne(R.result,R.msg),this.roomHandle.eventEmitter.emit(ExporderCallBack.mix_media_rep_error,A,R.id));break;case r.OUTGOING_PAUSE_RESUME_EXPORTER_REP:log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP init");l=t.decodeBody(e);0==l.result?(log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP,callback pause_stream_rep_success,result:0,pauseResumeRep.exporter_id:",l.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.pause_stream_rep_success,l.id,l.exporter_id)):(log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP,callbakc pause_stream_rep_error, result:"+l.result+",msg:"+l.msg+",exporter_id:",l.exporter_id),A=new ne(l.result,l.msg),this.roomHandle.eventEmitter.emit(ExporderCallBack.pause_stream_rep_error,A,l.id)),log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP pauseResumeRep:",l);break;case r.OUTGOING_DESTROY_EXPORTER_REP:log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP init ");var A,E=t.decodeBody(e);0==E.result?(log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP,callback stop_stream_rep_success, result:0, stopStreamRep.exporter_id:",E.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.stop_stream_rep_success,E.id,E.exporter_id)):(log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP,callback stop_stream_rep_error, result:"+E.result+",msg"+E.msg+", stopStreamRep.exporter_id:",E.exporter_id),A=new ne(E.result,E.msg),this.roomHandle.eventEmitter.emit(ExporderCallBack.stop_stream_rep_error,A,E.id));break;case r.OUTGOING_EXPORTER_ERROR_NOTIFY:log.debug("===acception OUTGOING_EXPORTER_ERROR_NOTIFY init");Z=t.decodeBody(e);log.debug("===acception OUTGOING_EXPORTER_ERROR_NOTIFY boardsInfoMsg:",Z);break;case r.OUTGOING_INVITE_STATUS_NOTIFY:log.debug("===acception SIP_INVITE_STATUS_NOTIFY init");var O=t.decodeBody(e);log.debug("===acception SIP_INVITE_STATUS_NOTIFY,callbakc outgoing_invite_status_notify,statusNotify:",O.outgoing_invite_status_notify),this.roomHandle.eventEmitter.emit(RoomCallback.outgoing_invite_status_notify,O.type,O.room_id,O.sip_addr,O.status,O.msg);break;case r.ROOM_SET_STREAM_NAME_RSP:log.debug("===acception ROOM_SET_STREAM_NAME_RSP init");var U=t.decodeBody(e);0==U.ret?(log.debug("===acception ROOM_SET_STREAM_NAME_RSP,callback room_set_stream_name_rep_success, result:0, roomSetStreamNameRsp.id:",U.id),this.roomHandle.eventEmitter.emit(UserCallback.room_set_stream_name_rep_success,U.id)):(log.debug("===acception ROOM_SET_STREAM_NAME_RSP,callback room_set_stream_name_rep_error, result:"+U.result+",msg:"+U.msg+", roomSetStreamNameRsp.id:",U.id),P=new ne(U.ret,U.msg),this.roomHandle.eventEmitter.emit(UserCallback.room_set_stream_name_rep_error,P,U.id));break;case r.ROOM_STREAM_NAME_CHANGED_NOTIFY:log.debug("===acception ROOM_STREAM_NAME_CHANGED_NOTIFY init");I=t.decodeBody(e);log.debug("===acception ROOM_STREAM_NAME_CHANGED_NOTIFY roomStreamNameChangedNotify",I),(h=this.roomHandle.getUser(I.user_id))&&h.id!=this.roomHandle.selfUser.id&&(S=h.getVideo(I.video_resource_id))&&(S.streamName=I.stream_name,S.streamNickName=I.stream_nick_name);break;case r.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP:log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP init");y=t.decodeBody(e);0==y.ret?(log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP,callback set_focus_video_rep_success, result:0, outgoingExporterSetFocusVideoRsp.id:",y.id),this.roomHandle.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_success,y.id)):(log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP,callback set_focus_video_rep_error, result:"+y.result+",msg:"+y.msg+", outgoingExporterSetFocusVideoRsp.id:",y.id),T=new ne(y.ret,y.msg),this.roomHandle.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_error,T,y.id));break;case r.OUTGOING_GET_EXPORTER_INFO_RSP:log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP init");var g=t.decodeBody(e),D=(log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP outgoingGetExporterInfoRsp:",g),null);log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP outgoingGetExporterInfoRsp.videos:",g.videos),g.videos&&0<g.videos.length&&(D=t.decodeOutgoingVideoInfo(g.videos)),this.roomHandle.eventEmitter.emit(ExporderCallBack.get_exporter_info_rep_success,g.id,g,D)}},e}),ModuleBase.define("User",["Video","Audio","Screen","ScreenAudio","Board","Error"],function(r,n,o,i,h,f){function e(e,t,r,n){this.roomHandle=n,this.id=e,this.name=t,this.data=r,this.eventEmitter=new EventEmitter,this.subVideoTrack2ResourceInfo={},this.subAudioTrack2ResourceInfo={},this.subScreenTrack2ResourceInfo={},this.reJoinSubVideoIds=[],this.reJoinSubAudioIds=[],this.reJoinSubScreenIds=[],this.reJoinVideoId2CustomSet={},this.reJoinScreenDescription=null,this.boards=[],this.screenStream=null,this.init()}return e.prototype.init=function(){this.nodeId=null,this.role=null,this.userAgent=null,this.stream=null,this.waitingDelete=!1,this.videos=[],this.audio,this.screen,this.toMCUPC,this.mulLanding=!1,this.deviceId2VideoSdpSsrc={},this.audioSdpSsrc,this.screenSdpSsrc,this.subVideoIds=[],this.subAudioIds=[],this.subScreenIds=[],this.toP2PPCs={},this.sdpP2PMap={},this.videoSdpSsrcMapP2PMap={},this.audioSdpSsrcP2PMap={},this.screenSdpSsrcP2PMap={},this.subMyVideosP2P=[],this.subMyAudiosP2P=[],this.subMyScreensP2P=[]},e.prototype.createVideo=function(e,t){e=new r(e,t,this.roomHandle);return e.ownerId=this.id,this.videos.push(e),e},e.prototype.createAudio=function(e,t){e=new n(e,t,this.roomHandle);return e.ownerId=this.id,this.audio=e},e.prototype.createScreen=function(e,t){e=new o(e,t,this.roomHandle);return e.ownerId=this.id,this.screen=e},e.prototype.createScreenAudio=function(e,t){e=new i(e,t,this.roomHandle);return e.ownerId=this.id,this.screen.screenAudio=e},e.prototype.initScreen=function(){var e=Math.uuid(),t=this.name+"-screen",r=e+"_screen_audio",n=this.name+"-screen-audio",t=this.createScreen(e,t),n=this.createScreenAudio(r,n);t.level=0,t.description="",t.screenAudio=n,this.reJoinScreenDescription&&(t.description=this.reJoinScreenDescription),this.eventEmitter.emit(UserCallback.screen_status_notify,t.status,t.id,t.name,this.id),this.roomHandle.masterServer.addScreenMsg(e,t),this.roomHandle.masterServer.addSpeakerMsg(r,n)},e.prototype.initVideo=function(e,t){var t=this.createVideo(e,t),r=(t.cameraType=CameraType.unknown,t.level=0,t.description="",this.reJoinVideoId2CustomSet[e]),r=(r&&(r.aspectRatio&&(t.aspectRatio=r.aspectRatio),r.description&&(t.description=r.description),r.width&&(t.resolution.width=r.width),r.height&&(t.resolution.height=r.height),r.setType&&(t.setType=r.setType),r.frameRate)&&(t.frameRate=r.frameRate),this.eventEmitter.emit(UserCallback.camera_status_notify,t.status,t.id,t.name,this.id),this.roomHandle.setDeviceIdByUUID(0,e));this.roomHandle.masterServer.addWebcamMsg(r,t)},e.prototype.deleteVideo=function(t){var e,r=this,n=r.getVideo(t);n&&(n.status==StreamStatus.published?n.unpublish().then(function(){arrayUtil.objectSplice(r.videos,t),r.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,n.id,n.name,r.id);var e=r.roomHandle.setDeviceIdByUUID(0,t);r.roomHandle.masterServer.removeWebcamMsg(e)}):(n.status==StreamStatus.opened&&n.unpreview(),arrayUtil.objectSplice(r.videos,t),r.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,n.id,n.name,r.id),e=r.roomHandle.setDeviceIdByUUID(0,t),r.roomHandle.masterServer.removeWebcamMsg(e)))},e.prototype.initAudio=function(e,t){var r=this.createAudio(e,t),t=(avdEngineHandle.checkAudioId=e,avdEngineHandle.checkAudioName=t,this.eventEmitter.emit(UserCallback.microphone_status_notify,r.status,r.id,r.name,this.id),this.roomHandle.setDeviceIdByUUID(2,e));this.roomHandle.masterServer.addSpeakerMsg(t,r)},e.prototype.deleteAudio=function(t){var e,r=this,n=r.getAudio(t);n&&(n.status==StreamStatus.published?n.closeMicrophone().then(function(){var e=r.roomHandle.setDeviceIdByUUID(2,t);r.roomHandle.masterServer.removeSpeakerMsg(e),r.audio=null,r.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,n.id,n.name,r.id)}):(e=r.roomHandle.setDeviceIdByUUID(2,t),r.roomHandle.masterServer.removeSpeakerMsg(e),r.audio=null,r.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,n.id,n.name,r.id)))},e.prototype.getVideo=function(e){for(var t=null,r=0;r<this.videos.length;r++){var n=this.videos[r];if(n.id==e){t=n;break}}return t},e.prototype.getScreen=function(){return this.screen},e.prototype.getScreenAudio=function(){return this.screen.screenAudio},e.prototype.getAudio=function(e){var t=null;return t=this.audio&&this.audio.id==e?this.audio:t},e.prototype.openCameraAndMicrophone=function(a,s,d,l){log.info("===user.openCameraAndMicrophone(),预览摄像头及发布流和打开麦克风"),avdEngineHandle.loggerReport.info("预览摄像头及发布流和打开麦克风");var u=when.defer(),c=this;return a&&null==s?a.publish():null==a&&s?s.openMicrophone():a&&s&&obtainUserMedia(s,a,function(e){var r=getRandomNum(1,3e3),t=(a.status=StreamStatus.opened,a.track=e.videoStream.getVideoTracks()[0],null==c.roomHandle.selfUser.stream?c.roomHandle.selfUser.stream=e.videoStream:c.roomHandle.selfUser.stream.addTrack(a.track),c.roomHandle.setDeviceIdByUUID(0,a.id)),n=c.getNewStreamByTrack(a.track),o=(c.roomHandle.masterServer.videoPublishHandle(t,n,r),c.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==r&&((a.element=d).srcObject=n,a.status=StreamStatus.published,c.roomHandle.hasObject(c.roomHandle.pubVideos,a)||c.roomHandle.pubVideos.push(a),c.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,c.id))}),c.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==r&&u.reject(e)}),getRandomNum(30001,6e3)),t=(s.state=StreamStatus.opened,s.track=e.audioStream.getAudioTracks()[0],null==c.roomHandle.selfUser.stream?c.roomHandle.selfUser.stream=e.audioStream:c.roomHandle.selfUser.stream.addTrack(s.track),c.roomHandle.setDeviceIdByUUID(2,s.id)),i=c.getNewStreamByTrack(s.track);c.roomHandle.masterServer.audioPublishHandle(t,i,o),c.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==o&&(l&&((s.element=l).srcObject=i),s.status=StreamStatus.published,c.roomHandle.hasObject(c.roomHandle.pubAudios,s)||c.roomHandle.pubAudios.push(s),c.eventEmitter.emit(UserCallback.microphone_status_notify,s.status,s.id,s.name,c.id))}),c.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&u.reject(e)})},function(e){var t=new f(ErrorConstant.failed_access_localMedia);u.reject(t)}),u.promise},e.prototype.remotecmdPublishCamera=function(e){log.info("===user.remotecmdPublishCamera(),userId:"+e.ownerId+",设备Id:"+e.id),avdEngineHandle.loggerReport.info("命令远端用户发布某一摄像头视频,userId:"+e.ownerId+",设备Id:"+e.id);var t=this.roomHandle.getNodeId(e.ownerId);this.roomHandle.masterServer.videoIndiction(!0,e.id,t)},e.prototype.remotecmdUnpublishCamera=function(e,t){log.info("===user.remotecmdUnpublishCamera(),userId:"+e+",cameraId:"+t),avdEngineHandle.loggerReport.info("命令远端用户取消发布摄像头视频, userId:"+e+",cameraId:"+t);e=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.videoIndiction(!1,t,e)},e.prototype.remotecmdOpenMicrophone=function(e){log.info("===user.remotecmdOpenMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户打开麦克风, userId:"+e);var t=this.roomHandle.getUser(e),e=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("pub",t.audio.id,e)},e.prototype.remotecmdCloseMicrophone=function(e){log.info("===user.remotecmdCloseMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户关闭麦克风, userId:"+e);var t=this.roomHandle.getUser(e),e=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("unpub",t.audio.id,e)},e.prototype.remotecmdMuteMicrophone=function(e){log.info("===user.remotecmdMuteMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户麦克风静音, userId:"+e);var t=this.roomHandle.getUser(e),e=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("mute",t.audio.id,e)},e.prototype.remotecmdUnmuteMicrophone=function(e){log.info("===user.remotecmdUnmuteMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户麦克风取消静音, userId:"+e);var t=this.roomHandle.getUser(e),e=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("unmute",t.audio.id,e)},e.prototype.updateUserName=function(t){log.info("===user.updateUserName(),userName:"+t),avdEngineHandle.loggerReport.info("===user.updateUserName(), userName:"+t),this.roomHandle.participants.forEach(function(e){e.id==this.id&&(e.name=t)}),this.roomHandle.masterServer.updateUserName(this.nodeId,t)},e.prototype.updateUserData=function(e){this.data=e,this.roomHandle.masterServer.updateUserDataMsg(e)},e.prototype.getUserData=function(e){return void 0===e||null==e||""==e?this.data:(e=this.roomHandle.getUser(e))?e.data:void 0},e.prototype.attachVideoElementMediaStream=function(e,t){var r,n;t&&(n=t.getTracks()[0],r=this.subVideoTrack2ResourceInfo[n.id],n=this.getUserByVideoTrackId(n.id))&&(n=n.getVideo(r.resource_id))&&(n.element=e),e&&(log.debug("===attachVideoElementMediaStream(),userId:"+this.id+",userName:"+this.name+",elementId:"+e.id),e.srcObject=t)},e.prototype.attachScreenElementMediaStream=function(e,t){var r,n;t&&(n=t.getTracks()[0],r=this.subScreenTrack2ResourceInfo[n.id],n=this.getUserByScreenTrackId(n.id))&&(n=n.getScreen(r.resource_id))&&(n.element=e),e&&(e.srcObject=t)},e.prototype.attachScreenAudioElementMediaStream=function(e,t){e&&(e.srcObject=t)},e.prototype.attachAudioElementMediaStream=function(e,t){var r,n;t&&(n=t.getTracks()[0],r=this.subAudioTrack2ResourceInfo[n.id],n=this.getUserByAudioTrackId(n.id))&&(n=n.getAudio(r.resource_id))&&(n.element=e),e&&(e.srcObject=t)},e.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},e.prototype.getUserByVideoTrackId=function(e){var e=this.subVideoTrack2ResourceInfo[e];return e?(e=e.owner_id,this.roomHandle.getUserByNodeId(e)):null},e.prototype.getUserByAudioTrackId=function(e){var e=this.subAudioTrack2ResourceInfo[e];return e?(e=e.owner_id,this.roomHandle.getUserByNodeId(e)):null},e.prototype.getUserByScreenTrackId=function(e){var e=this.subScreenTrack2ResourceInfo[e];return e?(e=e.owner_id,this.roomHandle.getUserByNodeId(e)):null},e.prototype.getNewStreamByTrack=function(e){var t=null;return e&&this.stream&&0<this.stream.getTracks().length&&((t=this.stream.clone()).getTracks().forEach(function(e){t.removeTrack(e)}),t.addTrack(e)),t},e.prototype.bindAudioToVideo=function(e,t){var r=when.defer();return this.roomHandle.masterServer.bindAudioToVideo(109,e,t),this.roomHandle.addCallback(EngineCallback.bind_audio2video_rep_success,function(e){109==e&&r.resolve()}),this.roomHandle.addCallback(EngineCallback.bind_audio2video_rep_error,function(e){109==e&&r.reject()}),r.promise},e.prototype.createBoard=function(e,t,r,n,o,i,a,s,d){var l,u=when.defer(),c=this,p=new h(this.roomHandle,this.id,e,t,r,n,o,i,a,s,d);return function(e){var t=!1;e&&0<=versionStringCompare(e,"3.1.7")&&(t=!0);t||log.info("===user 当前服务器版本不支持白板功能授权校验，客户端也将不启用校验。");return t}(avdEngineHandle.restServerInfo.boxVersion)?(this.roomHandle.boardId2userId[p.id]=this.id,this.roomHandle.masterServer.addBoardMsg(OperType.add,p),l=setTimeout(function(){var e=new f(1e4,"user.createBoard(), addBoardMsg send time out");delete c.roomHandle.boardId2userId[p.id],u.reject(e)},5e3),this.addCallback(EngineCallback.updateboardmsg_rep_success,function(e){p.id==e&&(clearTimeout(l),c.boards.push(p),c.shareBoardById(p.id),u.resolve(p))}),this.addCallback(EngineCallback.updateboardmsg_rep_error,function(e,t){p.id==t&&(clearTimeout(l),delete c.roomHandle.boardId2userId[p.id],u.reject(e))})):(this.boards.push(p),this.roomHandle.boardId2userId[p.id]=this.id,this.roomHandle.masterServer.addBoardMsg(OperType.add,p),this.shareBoardById(p.id),u.resolve(p)),u.promise},e.prototype.updateBoard=function(e){this.roomHandle.masterServer.addBoardMsg(OperType.update,e)},e.prototype.getBoard=function(e){for(var t,r=0;r<this.boards.length;r++){var n=this.boards[r];if(n.id==e){t=n;break}}return t},e.prototype.getAllBoards=function(){return this.roomHandle.boards},e.prototype.removeBoardById=function(e){arrayUtil.objectSplice(this.boards,e),delete this.roomHandle.boardId2userId[e],delete this.roomHandle.annotation2boardId[e],this.roomHandle.masterServer.removeBoardMsg(OperType.remove,e)},e.prototype.closeBoardById=function(e){var t=this.getBoard(e);if(t.status!=boardStatusEnum.close){if(t.status=boardStatusEnum.close,t.annotation=null,this.roomHandle.annotation2boardId[e])for(var r in this.roomHandle.annotation2boardId[e].queueArr=[],this.roomHandle.annotation2boardId[e].storageArr)this.roomHandle.annotation2boardId[e].queueArr.push(this.roomHandle.annotation2boardId[e].storageArr[r]);this.roomHandle.masterServer.closeBoardMsg(OperType.close,e)}},e.prototype.shareBoardById=function(l,u){var c,p=this,h=this.getBoard(l);!u&&h.status==boardStatusEnum.open||(h.status=boardStatusEnum.open,u&&this.roomHandle.masterServer.addBoardMsg(OperType.add,h),(c=this.roomHandle.annotation2boardId[l])&&setTimeout(function(){if(u&&0<h.annotation.shapeArray.length){for(var e in h.annotation.shapeArray){var t=h.annotation.shapeArray[e];t.color||(t.color="rgba(0,0,0,0)"),p.roomHandle.sendAddAnnotation(l,t.shape,t.shapeType,t.color,t.lineWidth,t.arrowtype,t.fillType)}var r,n=h.annotation.otherShapeMap;for(r in n){var o=n[r];for(e in o){var i,a,s,d=p.roomHandle.annotation2boardId[h.id].storageArr;for(i in d)d[i].annotationId==o[e].id&&(a={boardId:h.id,shapeObj:o[e].shape,shapeType:d[i].ann2pt.objectBase.type,lineColor:"",lineWidth:d[i].ann2pt.objectBase.lineWidth,arrowType:d[i].ann2pt.objectBase.arrow,fillType:1},s=d[i].ann2pt.objectBase.lineColor,a.lineColor="rgba("+s.r+","+s.g+","+s.b+","+s.a,0==p.roomHandle.annotation2boardId[h.id].storageArr[i].ann2pt.objectBase.fillColor.a?a.fillType=1:a.fillType=2,a.lineColor||(a.lineColor="rgba(0,0,0,0)"),p.roomHandle.sendAddAnnotation(h.id,a.shapeObj,a.shapeType,a.lineColor,a.lineWidth,a.arrowType,a.fillType))}}}else p.roomHandle.updateAnnotationDrow(c.queueArr)},50),this.roomHandle.masterServer.shareBoardMsg(OperType.share,l,h))},e.prototype.removeBoard=function(){this.boards.forEach(function(e){delete this.roomHandle.boardId2userId[e.id],delete this.roomHandle.annotation2boardId[e.id]}),arrayUtil.objectSplice(this.boards,this.id)},e.prototype.openMobileFrontVideo=function(t){log.info("===video openMobileFrontVideo...");var r=when.defer(),n=this,o=n.videos[0],e={audio:!1,video:{facingMode:{exact:"user"}}};return o.setType==ResolutionSetType.ideal?(e.video.width={ideal:o.resolution.width},e.video.height={ideal:o.resolution.height}):(e.video.width={exact:o.resolution.width},e.video.height={exact:o.resolution.height}),e.video.frameRate={ideal:o.frameRate},log.info("===video openMobileFrontVideo(),constraints:"+JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(e){log.debug("===video openMobileFrontVideo(),stream:",e),currentVideoParameter.videoWidth=o.resolution.width,currentVideoParameter.videoHeight=o.resolution.height,currentVideoParameter.frameRate=o.frameRate,o.track=e.getVideoTracks()[0],null==n.roomHandle.selfUser.stream?n.roomHandle.selfUser.stream=e:n.roomHandle.selfUser.stream.addTrack(o.track),o.isPubState=!0,o.publishHandle(t).then(function(){log.info("===video openMobileFrontVideo(),预览前置摄像头及发布流成功,videoId:"+o.id+",videoName："+o.name+",userId:"+o.ownerId),r.resolve()}).otherwise(function(e){o.isPubState=!1,log.error("===video openMobileFrontVideo(),预览前置摄像头及发布视频流失败,videoId:"+o.id+",videoName："+o.name+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),r.reject(e)})}).catch(function(e){log.error("===video openMobileFrontVideo() failed,error: ",e),o.isPubState=!1,r.reject(e)}),r.promise},e.prototype.closeMobileFrontVideo=function(){log.info("===video closeMobileFrontVideo...");var t=when.defer(),e=this.videos[0];return e.unpreview(),e.unpublish().then(function(){log.info("===video closeMobileFrontVideo success"),t.resolve()}).otherwise(function(e){log.info("===video closeMobileFrontVideo error"),t.reject(e)}),t.promise},e.prototype.closeMobileBackVideo=function(){log.info("===video closeMobileBackVideo...");var t=when.defer(),e=this.videos[1];return e.unpreview(),e.unpublish().then(function(){log.info("===video closeMobileBackVideo success"),t.resolve()}).otherwise(function(e){log.info("===video closeMobileBackVideo error"),t.reject(e)}),t.promise},e.prototype.openMobileBackVideo=function(t){log.info("===video openMobileBackVideo...");var e,r,n=when.defer(),o=this,i=!1,a=0;if("Android"==avdEngineHandle.detect.osName){for(var s in avdEngineHandle.cameraMap)a++,e=s,r=avdEngineHandle.cameraMap[s];2<a&&(i=!0,log.debug("===video openMobileBackVideo(), detect.osName:Android, cameraLen:"+a+", customiseCameraId:"+e+", customiseCameraName:"+r))}var d=o.videos[1],i=i?{audio:!1,video:{deviceId:{exact:e}}}:{audio:!1,video:{facingMode:{exact:"environment"}}};return d.setType==ResolutionSetType.ideal?(i.video.width={ideal:d.resolution.width},i.video.height={ideal:d.resolution.height}):(i.video.width={exact:d.resolution.width},i.video.height={exact:d.resolution.height}),i.video.frameRate={ideal:d.frameRate},log.info("===video openMobileBackVideo(),constraints:"+JSON.stringify(i)),navigator.mediaDevices.getUserMedia(i).then(function(e){log.debug("===video openMobileBackVideo(),stream:",e),currentVideoParameter.videoWidth=d.resolution.width,currentVideoParameter.videoHeight=d.resolution.height,currentVideoParameter.frameRate=d.frameRate,d.track=e.getVideoTracks()[0],null==o.roomHandle.selfUser.stream?o.roomHandle.selfUser.stream=e:o.roomHandle.selfUser.stream.addTrack(d.track),d.isPubState=!0,d.publishHandle(t).then(function(){log.info("===video openMobileBackVideo(),预览后置摄像头及发布流成功,videoId:"+d.id+",videoName："+d.name+",userId:"+d.ownerId),n.resolve()}).otherwise(function(e){d.isPubState=!1,log.error("===video openMobileBackVideo(),预览后置摄像头及发布视频流失败,videoId:"+d.id+",videoName："+d.name+",userId:"+d.ownerId+",error:"+JSON.stringify(e)),n.reject(e)})}).catch(function(e){log.error("===video openMobileBackVideo() failed,error: ",e),d.isPubState=!1,n.reject(e)}),n.promise},e}),ModuleBase.define("Board",["Annotation","RestServer","Error"],function(r,s,d){function e(e,t,r,n,o,i,a,s,d,l,u){this.roomHandle=e,this.id=Math.uuid(),this.status=boardStatusEnum.close,this.title=a||"",this.description=l||"",this.extendData=u||"",this.userId=t,this.width=r,this.height=n,this.backgroundColor=o,this.backgroundImage=i,this.annotation,this.outputWidth=r,s&&(this.outputWidth=s),this.outputHeight=n,d&&(this.outputHeight=d),this.inputWidth=r,this.inputHeight=n,this.roomHandle.boardOutputXRatio=this.outputWidth/this.width,this.roomHandle.boardOutputYRatio=this.outputHeight/this.height,this.roomHandle.boardInputXRatio=this.width/this.outputWidth,this.roomHandle.boardInputYRatio=this.height/this.outputHeight}return e.prototype.setRenderWidthAndHeight=function(e,t){log.debug("===Board.setRenderWidthAndHeight, width: ",e,",height: ",t),this.width=e,this.height=t,this.roomHandle.boardInputXRatio=this.width/this.inputWidth,this.roomHandle.boardInputYRatio=this.height/this.inputHeight,this.roomHandle.boardOutputXRatio=this.inputWidth/this.width,this.roomHandle.boardOutputYRatio=this.inputHeight/this.height},e.prototype.setBoardId=function(e){this.id=e},e.prototype.uploadImg2Server=function(e,t){var r,n=when.defer(),o=t.files[0],i=(o||(r=new d(ErrorConstant.upload_filer_required),n.reject(r)),o.size),a=o.type;return log.info("===Board.uploadImg2Server(),fileSize:"+i+", fileType"+a),["image/jpeg","image/png"].includes(a)?15728640<i?(t.value="",(r=new d(ErrorConstant.upload_filer_fileSize)).message=r.message+",Within 15M only",n.reject(r)):(new s).uploadFile(e,o).then(function(e){t.value="",log.info("===Board.uploadImg2Server(),fileUrl:"+e),n.resolve(e)}).otherwise(function(e){console.info("===Board.uploadImg2Server(),error:",e),n.reject(e)}):(t.value="",(r=new d(ErrorConstant.upload_filer_fileType)).message=r.message+",Support jpeg/jpg/png only ",n.reject(r)),n.promise},e.prototype.updateBackgroundImage=function(e){var t=this;t.backgroundImage=e,t.annotation.updateBackgroundImage(e).then(function(){log.debug("===Board.updateBackgroundImage, backgroundImage: ",e),t.userId==t.roomHandle.selfUser.id&&t.roomHandle.selfUser.updateBoard(t)}).otherwise(function(e){log.debug("===Board.updateBackgroundImage, backgroundImage error:",e)})},e.prototype.updateBackgroundColor=function(e){this.backgroundImage="",this.backgroundColor=e,this.annotation.updateBackgroundColor(e),this.userId==this.roomHandle.selfUser.id&&this.roomHandle.selfUser.updateBoard(this)},e.prototype.updateWidthAndHeight=function(e,t){this.width=e,this.height=t},e.prototype.createAnnotation=function(){var e,t=when.defer();return this.annotation?t.reject():(e=new r(this.id,this.roomHandle,this),this.annotation=e,t.resolve(this.annotation)),t.promise},e.prototype.updateAnnotation=function(){},e.prototype.removeAnnotation=function(){this.annotation=null},e.prototype.getAnnotation=function(){return this.annotation},e}),ModuleBase.define("Annotation",["RestServer","Error","TextInfo"],function(d,l,t){function e(e,t,r){this.roomHandle=t,this.boardId=e,this.shapeType=shapeTypeEnum.mouse,this.color="rgba(0,0,0,1)",this.backgroundColor="",this.lineWidth=2,this.arrowLength=10,this.arrowtype=arrowTypeEnum.end,this.fillType=fillTypeEnum.none,this.fillColor="none",this.initType=AnnotationInitTypeEnum.full,this.shapeArray=[],this.redoArray=[],this.undoArray=[],this.zr=null,this.annoDiv=null,this.renderDiv=null,this.renderBackground=null,this.currentIndex=-1,this.drawOrEraser=annoSelectTypeEnum.draw,this.isEraser=!1,this.eraserShape=null,this.eraserImageWidth=32,this.eraserImageHeight=32,this.otherShapeMap={},this.screenSize={width:0,height:0},this.hlightPointInfo={imgUrl:"",width:"",height:"",intervalTime:200,isSend:!0},this.hlightPointShape=null,this.textTagShape=null,this.arrowLineStartPoint={x:0,y:0},this.currentX=0,this.currentY=0,this.x=0,this.y=0,this.shapeData=[],this.rhombData=[],this.shapeObj={},this.shape=null,this.imgZlevel=-99999,this.normalZlevel=1e4,this.tempHighZlevel=99999,this.currActiveImg=null,this.isAllowEditImg=!1,this.dragData={drag:!1,pos:[0,0]},this.shapeGroup=new zrender.Group({slient:!1}),this.textInfo=null,this.positionInfo={scaleWidth:0,scaleHeight:0,zrWidth:0,zrHeight:0,scaleRatioX:1,scaleRatioY:1,scaleRatioXR:1,scaleRatioYR:1,originalWidth:0,originalHeight:0},this.imgScaleoffset={x:0,y:0},this.board=r,this.backgroundColor=r.backgroundColor}var P=zrender.Path.extend({type:"Successright",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/3*2,o=t.x+t.width/2,i=t.y+t.height,a=t.x+t.width,t=t.y;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(a,t)}}),M=zrender.Path.extend({type:"Failure",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y,o=t.width,t=t.height,i=r-o/2,r=r+o/2,o=n-t/2,n=n+t/2;e.moveTo(i,o),e.lineTo(r,n),e.closePath(),e.moveTo(r,o),e.lineTo(i,n),e.closePath()}}),A=zrender.Path.extend({type:"Arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/3,o=t.x,i=t.y+t.height/3*2,a=t.x+t.width/3*2,s=t.y+t.height/3*2,d=t.x+t.width/3*2,l=t.y+t.height,u=t.x+t.width,c=t.y+t.height/2,p=t.x+t.width/3*2,h=t.y,f=t.x+t.width/3*2,t=t.y+t.height/3;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(a,s),e.lineTo(d,l),e.lineTo(u,c),e.lineTo(p,h),e.lineTo(f,t),e.closePath()}}),O=zrender.Path.extend({type:"Texttag",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/4,o=t.x,i=t.y+t.height/4*3,a=t.x+t.width/5*4,s=t.y+t.height/4*3,d=t.x+t.width/5*4,l=t.y+t.height,u=t.x+t.width,c=t.y+t.height/2,p=t.x+t.width/5*4,h=t.y,f=t.x+t.width/5*4,t=t.y+t.height/4;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(a,s),e.lineTo(d,l),e.lineTo(u,c),e.lineTo(p,h),e.lineTo(f,t),e.closePath()}});function s(e,t,r,n){var o=0,i=0,a=r/n,s=e/t;return 1<a&&1<s?s<a?i=(o=e)<r?n/(r/e):n*(e/r):a<s?o=(i=t)<n?r/(n/t):r*(t/n):(o=e,i=t):1<a&&s<=1?i=(o=e)<r?n/(r/e):n*(e/r):a<1&&1<s?o=(i=t)<n?r/(n/t):r*(t/n):a<1&&s<=1?a<s?o=(i=t)<n?r/(n/t):r*(t/n):i=(o=e)<r?n/(r/e):n*(e/r):1==a&&(1<s?o=(i=t)<n?r/(n/t):r*(t/n):i=(o=e)<r?n/(r/e):n*(e/r)),log.debug("===annotation getCompatibleSize, outWidht: "+e+",outHeight: "+t+",contentWidth: "+r+",contentHeight: "+n+",renderWidth: "+o+",renderHeight: "+i),[o,i]}function U(e){return"rgba("+e.r+","+e.g+","+e.b+","+parseFloat(e.a/255)+")"}return e.prototype.initAndGetRenderCanvasByBoardAndWrapBox=function(){var e=document.createElement("canvas"),t=s(this.annoDiv.clientWidth,this.annoDiv.clientHeight,this.board.width,this.board.height),r=t[0],t=t[1];return e.width=r,e.height=t,e.style.width=r+"px",e.style.height=t+"px",e.style.background="rgba(0,0,0,0)",this.board.setRenderWidthAndHeight(r,t),log.debug("===annotation initAndGetRenderCanvasByBoardAndWrapBox, result: bw: "+this.board.width+",bh: "+this.board.height+",ww: "+this.annoDiv.clientWidth+",wh: "+this.annoDiv.clientHeight+",rw: "+r+",rh: "+t),e},e.prototype.updateBackgroundColor=function(e){var t;!this.renderBackground||!this.renderBackground instanceof HTMLCanvasElement||(t=this.renderBackground.getContext("2d"),e?(t.fillStyle="rgba("+e+")",t.fillRect(0,0,this.renderBackground.width,this.renderBackground.height),this.backgroundColor=e):t.clearRect(0,0,this.renderBackground.width,this.renderBackground.height))},e.prototype.updateBackgroundImage=function(e){var n=when.defer(),o=(log.debug("===annotation updateBackgroundImage, imageUrl:"+e),this);e||n.reject("===annotation updateBackgroundImage error, reason: imageUrl is invalid!"),this.renderBackground||n.reject("===annotation updateBackgroundImage error, reason: board background is not exist!"),!this.renderBackground instanceof HTMLCanvasElement&&n.reject("===annotation updateBackgroundImage error, reason: board background element is not canvas");try{this.updateBackgroundColor(this.backgroundColor);var i=this.renderBackground.getContext("2d"),a=document.createElement("img");a.src=e,a.onload=function(){var e=s(o.renderBackground.width,o.renderBackground.height,a.width,a.height),t=o.renderBackground.width/2-e[0]/2,r=o.renderBackground.height/2-e[1]/2;log.debug("===annotation updateBackgroundImage, startX:"+t+",startY:"+r+",compatibleSize:"+e),i.drawImage(a,t,r,e[0],e[1]),n.resolve()}}catch(e){log.debug("===annotation updateBackgroundImage, err:"+e),n.reject(e)}return n.promise},e.prototype.init=function(e,t){var r=when.defer(),m=this;if(e instanceof HTMLDivElement||e instanceof HTMLCanvasElement){if(m.annoDiv=e,t&&t==AnnotationInitTypeEnum.proportional){if(m.initType=t,!(e instanceof HTMLDivElement))return log.error("===annotation init faild, proportional type must be given a div element!"),r.reject("Proportional type must be given a div element!"),r.promise;e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",this.renderDiv=m.initAndGetRenderCanvasByBoardAndWrapBox(),this.renderBackground=m.initAndGetRenderCanvasByBoardAndWrapBox(),this.renderDiv.style.position="relative",this.renderDiv.style.zIndex=1001,e.appendChild(this.renderDiv),this.renderBackground.style.position="absolute",this.renderBackground.style.zIndex=1e3,this.renderBackground.className="annotation-canvas-background",e.appendChild(this.renderBackground)}else this.renderDiv=e;m.zr=zrender.init(this.renderDiv),m.zr.add(m.shapeGroup),m.positionInfo.originalWidth=m.zr.getWidth(),m.positionInfo.originalHeight=m.zr.getHeight(),"100%"==m.annoDiv.style.width?(t=m.annoDiv.firstChild,m.screenSize.width=parseInt(t.style.width),m.screenSize.height=parseInt(t.style.height),log.debug("===Annotation.init(),childDiv.style.width:"+t.style.width+",childDiv.style.height:"+t.style.height)):(m.screenSize.width=parseInt(m.annoDiv.style.width),m.screenSize.height=parseInt(m.annoDiv.style.height),log.debug("===Annotation.init(),annoDiv.style.width:"+e.style.width+",annoDiv.style.height:"+e.style.height)),this.updateBackgroundColor(this.backgroundColor),m.zr.on("mousedown",function(e){var t;m.isAllowEditImg&&(m.dragData.pos=[e.event.zrX,e.event.zrY],e.target&&e.target.type&&"image"==e.target.type&&null!=e.target.draggable&&(m.currActiveImg=e.target,m.currActiveImg.attr("zlevel",m.tempHighZlevel),m.currActiveImg.parent.eachChild(function(e){"image"===e.type&&(e.id==m.currActiveImg.id?e.attr("style",{shadowColor:"red",shadowBlur:5}):e.attr("style",{shadowColor:void 0,shadowBlur:void 0}))}),1==m.currActiveImg.scale[0]?(m.imgScaleoffset.x=0,m.imgScaleoffset.y=0):(t=m.currActiveImg.scale[0]-1,m.imgScaleoffset.x=m.currActiveImg.getWidth()*t/2,m.imgScaleoffset.y=m.currActiveImg.getHeight()*t/2)),void 0===e.target?m.dragData.drag=!1:m.dragData.drag=!0)}),m.zr.on("mouseup",function(e){m.isAllowEditImg&&m.currActiveImg&&(m.dragData.drag=!1,m.currActiveImg.customPositionX=m.currActiveImg.position[0]-m.imgScaleoffset.x,m.currActiveImg.customPositionY=m.currActiveImg.position[1]-m.imgScaleoffset.y,log.debug("===Annotation.drawImg, currActiveImg customPosition: ",[m.currActiveImg.customPositionX,m.currActiveImg.customPositionY].toString()),m.currActiveImg.attr("zlevel",++m.imgZlevel),m.roomHandle.sendUpdateAnnotation(m.boardId,m.currActiveImg,shapeTypeEnum.img))}),m.zr.on("mouseout",function(e){m.isAllowEditImg&&(m.dragData.drag=!1)}),m.zr.on("mousemove",function(e){var t,e=[e.event.zrX,e.event.zrY];!1===m.dragData.drag?m.currActiveImg&&(m.currActiveImg.draggable=!1):(null!=m.currActiveImg&&!0===m.isAllowEditImg&&(t=[e[0]-m.dragData.pos[0],e[1]-m.dragData.pos[1]],m.currActiveImg.position[0]+=t[0]*m.positionInfo.scaleRatioXR,m.currActiveImg.position[1]+=t[1]*m.positionInfo.scaleRatioYR,m.currActiveImg.dirty()),m.dragData.pos=e)}),m.renderDiv.onmousedown=function(e){if(!m.isAllowEditImg&&m.shapeType!=shapeTypeEnum.mouse&&m.shapeType!=shapeTypeEnum.hlight_point){m.shapeType==shapeTypeEnum.eraser&&(m.isEraser=!0);var r,n,e=m.handleScaledXY(e.clientX-this.getBoundingClientRect().left,e.clientY-this.getBoundingClientRect().top),o=(m.currentX=e.x,m.currentY=e.y,(shapeData=[]).push([m.currentX,m.currentY]),null);switch(m.shapeType){case shapeTypeEnum.failure:o=new M({shape:{x:m.currentX,y:m.currentY,width:20,height:20},style:{stroke:m.color,lineWidth:m.lineWidth},zlevel:m.normalZlevel,onmouseover:a});break;case shapeTypeEnum.success:o=new P({shape:{x:m.currentX-10,y:m.currentY-10,width:20,height:20},style:{stroke:m.color,fill:"none",lineWidth:m.lineWidth},onmouseover:a});break;case shapeTypeEnum.arrow:o=new A({shape:{x:m.currentX-15,y:m.currentY-10,width:30,height:20},style:{stroke:m.color,fill:m.fillColor,lineWidth:m.lineWidth},zlevel:m.normalZlevel,onmouseover:a});break;case shapeTypeEnum.hlight_texttag:var t=m.roomHandle.selfUser.name,i=t;7<t.split("").length&&(i=t.substr(0,7)+"..."),m.textTagShape?m.textTagShape.attr({shape:{x:m.currentX-40,y:m.currentY-20},style:{text:i},zlevel:m.normalZlevel,textContent:new zrender.Text({x:m.currentX-40+5,y:m.currentY-20+13,style:{text:i,fill:"#ffffff",textRect:{x:m.currentX-40+5,y:m.currentY-20+13,width:50},truncate:{outerWidth:50}},zlevel:m.normalZlevel})}):(m.textTagShape=new O({shape:{x:m.currentX-40,y:m.currentY-20,width:80,height:40},style:{stroke:"red",fill:"red",text:i,truncate:{outerWidth:50},lineWidth:m.lineWidth},zlevel:m.normalZlevel,textContent:new zrender.Text({x:m.currentX-40+5,y:m.currentY-20+13,style:{text:i,fill:"#ffffff",textRect:{x:m.currentX-40+5,y:m.currentY-20+13,width:50},truncate:{outerWidth:50}},zlevel:m.normalZlevel}),onmouseover:a}),m.textTagShape.id=Math.uuid(),m.shapeGroup.add(m.textTagShape)),m.roomHandle.sendAddAnnotation(m.boardId,m.textTagShape,m.shapeType,m.color,m.lineWidth,m.arrowtype,m.fillType);break;case shapeTypeEnum.rhomb:o=new zrender.Polygon({shape:{points:[],smooth:0},style:{stroke:m.color,fill:"none",lineWidth:m.lineWidth},zlevel:m.normalZlevel,onmouseover:a});break;case shapeTypeEnum.line:o=new zrender.Arrowline({shape:{x1:m.currentX,y1:m.currentY,x2:m.currentX,y2:m.currentY,arrowlength:10,arrowtype:m.arrowtype},style:{stroke:m.color,lineWidth:m.lineWidth},zlevel:m.normalZlevel,onmouseover:a});break;case shapeTypeEnum.polyline:o=new zrender.Polyline({shape:{points:[],smooth:0},style:{stroke:m.color,lineWidth:m.lineWidth},zlevel:m.normalZlevel,onmouseover:a});break;case shapeTypeEnum.rect:o=new zrender.Rect({shape:{x:m.currentX,y:m.currentY},style:{stroke:m.color,fill:m.fillColor,lineWidth:m.lineWidth},zlevel:m.normalZlevel,onmouseover:a});break;case shapeTypeEnum.ellipse:o=new zrender.Ellipse({shape:{cx:m.currentX,cy:m.currentY,rx:0,ry:0},style:{stroke:m.color,fill:m.fillColor,lineWidth:m.lineWidth},zlevel:m.normalZlevel,onmouseover:a})}o&&(o.id=Math.uuid(),m.shapeGroup.add(o),m.renderDiv.onmousemove=function(e){if(!m.isAllowEditImg&&m.shapeType!=shapeTypeEnum.eraser){var e=m.handleScaledXY(e.clientX-this.getBoundingClientRect().left,e.clientY-this.getBoundingClientRect().top),t=(r=e.x,n=e.y,shapeData.push([r,n]),[[m.currentX,m.currentY+(n-m.currentY)/2],[m.currentX+(r-m.currentX)/2,n],[r,m.currentY+(n-m.currentY)/2],[m.currentX+(r-m.currentX)/2,m.currentY]]);switch(m.shapeType){case shapeTypeEnum.rhomb:o.attr("shape",{points:t});break;case shapeTypeEnum.line:o.attr("shape",{x2:r,y2:n});break;case shapeTypeEnum.polyline:o.attr("shape",{points:shapeData});break;case shapeTypeEnum.rect:o.attr("shape",{width:r-m.currentX,height:n-m.currentY});break;case shapeTypeEnum.ellipse:o.attr("shape",{cx:r+(m.currentX-r)/2,cy:n+(m.currentY-n)/2,rx:Math.abs(r-m.currentX)/2,ry:Math.abs(n-m.currentY)/2})}}},m.renderDiv.onmouseup=function(){var e;m.renderDiv.onmousemove=null,m.renderDiv.onmouseup=null,m.renderDiv.onmouseleave=null,m.isAllowEditImg||(m.shapeType==shapeTypeEnum.eraser?m.isEraser=!1:(e={shape:o,shapeType:m.shapeType,color:m.color,lineWidth:m.lineWidth,arrowtype:m.arrowtype,fillType:m.fillType},m.shapeArray.push(e),m.undoArray.push({type:"add",shapeObj:e}),m.redoArray=[],m.roomHandle.sendAddAnnotation(m.boardId,o,m.shapeType,m.color,m.lineWidth,m.arrowtype,m.fillType)))},m.renderDiv.onmouseleave=function(){m.renderDiv.onmousemove=null,m.renderDiv.onmouseup=null,m.renderDiv.onmouseleave=null,m.isAllowEditImg||(m.shapeType==shapeTypeEnum.eraser?m.isEraser=!1:(parseInt(m.renderDiv.style.width),parseInt(m.renderDiv.style.height),m.shapeArray.push({shape:o,shapeType:m.shapeType,color:m.color,lineWidth:m.lineWidth,arrowtype:m.arrowtype,fillType:m.fillType}),m.redoArray=[],m.roomHandle.sendAddAnnotation(m.boardId,o,m.shapeType,m.color,m.lineWidth,m.arrowtype,m.fillType)))})}},m.renderDiv.ontouchstart=function(e){if(!m.isAllowEditImg&&(e.preventDefault(),m.shapeType!=shapeTypeEnum.mouse)&&m.shapeType!=shapeTypeEnum.hlight_point&&(m.currentX=e.touches[0].clientX-this.getBoundingClientRect().left,m.currentY=e.touches[0].clientY-this.getBoundingClientRect().top,m.shapeType!=shapeTypeEnum.eraser)){switch(m.arrowLineStartPoint.x=e.touches[0].clientX-this.getBoundingClientRect().left,m.arrowLineStartPoint.y=e.touches[0].clientY-this.getBoundingClientRect().top,m.shapeData=[],m.shapeData.push([m.currentX,m.currentY]),m.shapeType){case shapeTypeEnum.failure:m.shape=new M({shape:{x:m.currentX,y:m.currentY,width:20,height:20},style:{stroke:m.color,lineWidth:m.lineWidth}});break;case shapeTypeEnum.success:m.shape=new P({shape:{x:m.currentX-10,y:m.currentY-10,width:20,height:20},style:{stroke:m.color,fill:"none",lineWidth:m.lineWidth}});break;case shapeTypeEnum.arrow:m.shape=new A({shape:{x:m.currentX-15,y:m.currentY-10,width:30,height:20},style:{stroke:m.color,fill:m.fillColor,lineWidth:m.lineWidth}});break;case shapeTypeEnum.hlight_texttag:m.textTagShape?m.textTagShape.attr({shape:{x:m.currentX-40,y:m.currentY-20},style:{text:m.roomHandle.selfUser.name}}):(m.textTagShape=new O({shape:{x:m.currentX-40,y:m.currentY-20,width:80,height:40},style:{stroke:"red",fill:"red",text:m.roomHandle.selfUser.name,truncate:{outerWidth:50},lineWidth:m.lineWidth}}),m.textTagShape.id=Math.uuid(),m.shapeGroup.add(m.textTagShape)),m.roomHandle.sendAddAnnotation(m.boardId,m.textTagShape,m.shapeType,m.color,m.lineWidth,m.arrowtype,m.fillType),m.shape&&(m.shape=null);break;case shapeTypeEnum.rhomb:m.shape=new zrender.Polygon({shape:{points:[],smooth:0},style:{stroke:m.color,fill:"none",lineWidth:m.lineWidth}});break;case shapeTypeEnum.line:m.shape=new zrender.Arrowline({shape:{arrowlength:10,arrowtype:m.arrowtype},style:{stroke:m.color,lineWidth:m.lineWidth}});break;case shapeTypeEnum.polyline:m.shape=new zrender.Polyline({shape:{points:[],smooth:0},style:{stroke:m.color,lineWidth:m.lineWidth}});break;case shapeTypeEnum.rect:m.shape=new zrender.Rect({shape:{x:m.currentX,y:m.currentY},style:{stroke:m.color,fill:m.fillColor,lineWidth:m.lineWidth}});break;case shapeTypeEnum.ellipse:m.shape=new zrender.Ellipse({shape:{cx:m.currentX,cy:m.currentY,rx:0,ry:0},style:{stroke:m.color,fill:m.fillColor,lineWidth:m.lineWidth}})}m.shape&&(m.shape.id=Math.uuid(),m.shapeType!=shapeTypeEnum.success&&m.shapeType!=shapeTypeEnum.failure&&m.shapeType!=shapeTypeEnum.arrow||(e={shape:m.shape,shapeType:m.shapeType,color:m.color,lineWidth:m.lineWidth,arrowtype:m.arrowtype,fillType:m.fillType},m.shapeArray.push(e),m.undoArray.push({type:"add",shapeObj:e}),m.roomHandle.sendAddAnnotation(m.boardId,m.shape,m.shapeType,m.color,m.lineWidth,m.arrowtype,m.fillType)),m.shapeGroup.add(m.shape))}},m.renderDiv.ontouchmove=function(e){if(!m.isAllowEditImg)if(m.x=e.touches[0].clientX-this.getBoundingClientRect().left,m.y=e.touches[0].clientY-this.getBoundingClientRect().top,m.shapeType==shapeTypeEnum.eraser)m.isEraser=!0,o=m.x-m.eraserImageWidth/2,i=m.y-m.eraserImageHeight/2,m.eraserShape&&m.eraserShape.attr("position",[o,i]),m.shapeArray.forEach(function(r){switch(r.shapeType){case shapeTypeEnum.line:var e=r.shape.shape,t=e.x1,n=e.x2,o=e.y1,e=e.y2;t<n&&o<e?m.x>=t&&m.x<=n&&m.y>=o&&m.y<=e&&m.excuteRemoveAnnotation(r):n<t&&o<e?m.x>=n&&m.x<=t&&m.y>=o&&m.y<=e&&m.excuteRemoveAnnotation(r):t<n&&e<o?m.x>=t&&m.x<=n&&m.y>=e&&m.y<=o&&m.excuteRemoveAnnotation(r):n<t&&e<o&&m.x>=n&&m.x<=t&&m.y>=e&&m.y<=o&&m.excuteRemoveAnnotation(r);break;case shapeTypeEnum.polyline:var i=m.shapeArray[k].shape.shape.points,a=m.x-m.eraserImageWidth/2,s=m.x+m.eraserImageWidth/2,d=m.y-m.eraserImageWidth/2,l=m.y+m.eraserImageWidth/2;0<i.length&&i.forEach(function(e){var t=e[0],e=e[1];a<=t&&t<=s&&d<=e&&e<=l&&m.excuteRemoveAnnotation(r)});break;case shapeTypeEnum.success:var u=r.shape.shape.width,c=r.shape.shape.height,i=r.shape.shape.x,p=r.shape.shape.y;m.x>=i&&m.x<=i+u&&m.y>=p&&m.y<=p+c&&m.excuteRemoveAnnotation(r);break;case shapeTypeEnum.failure:u=r.shape.shape.width,c=r.shape.shape.height,i=r.shape.shape.x,p=r.shape.shape.y;m.x>=i&&m.x<=i+u&&m.y>=p&&m.y<=p+c&&m.excuteRemoveAnnotation(r);break;case shapeTypeEnum.rhomb:var i=r.shape.shape.points[0],p=r.shape.shape.points[1],h=r.shape.shape.points[2],f=r.shape.shape.points[3],t=i[0],n=h[0],o=p[1],e=f[1];m.x>=t&&m.x<=n&&m.y>=o&&m.y<=e?m.excuteRemoveAnnotation(r):(m.x<=t&&m.x>=n&&m.y>=o&&m.y<=e||m.x>=t&&m.x<=n&&m.y<=o&&m.y>=e||m.x<=t&&m.x>=n&&m.y<=o&&m.y>=e)&&m.excuteRemoveAnnotation(r);break;case shapeTypeEnum.arrow:u=r.shape.shape.width,c=r.shape.shape.height,i=r.shape.shape.x,h=r.shape.shape.y;m.x>=i&&m.x<=i+u&&m.y>=h&&m.y<=h+c&&m.excuteRemoveAnnotation(r);break;case shapeTypeEnum.ellipse:p=r.shape.shape.cx,f=r.shape.shape.cy,t=r.shape.shape.rx,n=r.shape.shape.ry;m.x>=p-t&&m.x<=p+t&&m.y>=f-n&&m.y<=f+n&&m.excuteRemoveAnnotation(r);break;case shapeTypeEnum.rect:o=r.shape.shape.width,e=r.shape.shape.height,i=r.shape.shape.x,u=r.shape.shape.y;0<=o&&0<=e?m.x>=i&&m.x<=i+o&&m.y>=u&&m.y<=u+e&&m.excuteRemoveAnnotation(r):o<=0&&0<=e?m.x>=i+o&&m.x<=i&&m.y>=u&&m.y<=u+e&&m.excuteRemoveAnnotation(r):0<=o&&e<=0?m.x>=i&&m.x<=i+o&&m.y>=u+e&&m.y<=u&&m.excuteRemoveAnnotation(r):o<=0&&e<=0&&m.x>=i+o&&m.x<=i&&m.y>=u+e&&m.y<=u&&m.excuteRemoveAnnotation(r)}});else{m.shapeData.push([m.x,m.y]);var t=[[m.currentX,m.currentY+(m.y-m.currentY)/2],[m.currentX+(m.x-m.currentX)/2,m.y],[m.x,m.currentY+(m.y-m.currentY)/2],[m.currentX+(m.x-m.currentX)/2,m.currentY]];switch(m.shapeType){case shapeTypeEnum.rhomb:m.shape.attr("shape",{points:t});break;case shapeTypeEnum.line:m.arrowLineStartPoint.x,m.arrowLineStartPoint.y,m.x,m.y;m.shape.attr("shape",{x1:m.arrowLineStartPoint.x,y1:m.arrowLineStartPoint.y,x2:m.x,y2:m.y});break;case shapeTypeEnum.polyline:m.shape.attr("shape",{points:m.shapeData});break;case shapeTypeEnum.rect:m.shape.attr("shape",{width:m.x-m.currentX,height:m.y-m.currentY});break;case shapeTypeEnum.ellipse:m.shape.attr("shape",{cx:m.x+(m.currentX-m.x)/2,cy:m.y+(m.currentY-m.y)/2,rx:Math.abs(m.x-m.currentX)/2,ry:Math.abs(m.y-m.currentY)/2});break;case shapeTypeEnum.hlight_point:var r=m.hlightPointInfo.width,n=m.hlightPointInfo.height,o=m.x-r/2,i=m.y-n/2;m.hlightPointShape.attr("position",[o,i]),m.hlightPointInfo.isSend&&(m.hlightPointInfo.isSend=!1,m.roomHandle.sendAddAnnotation(m.boardId,m.hlightPointShape,shapeTypeEnum.hlight_point,m.color,m.lineWidth,m.arrowtype,m.fillType),setTimeout(function(){m.hlightPointInfo.isSend=!0},m.hlightPointInfo.intervalTime))}}},m.renderDiv.ontouchend=function(){var e;m.isAllowEditImg||m.shapeType!=shapeTypeEnum.hlight_texttag&&m.shapeType!=shapeTypeEnum.mouse&&m.shapeType!=shapeTypeEnum.success&&m.shapeType!=shapeTypeEnum.failure&&m.shapeType!=shapeTypeEnum.arrow&&(m.shapeType==shapeTypeEnum.eraser?m.isEraser=!1:(e={shape:m.shape,shapeType:m.shapeType,color:m.color,lineWidth:m.lineWidth,arrowtype:m.arrowtype,fillType:m.fillType},m.shapeArray.push(e),m.redoArray=[],m.shapeType!=shapeTypeEnum.hlight_point&&(m.undoArray.push({type:"add",shapeObj:e}),m.roomHandle.sendAddAnnotation(m.boardId,m.shape,m.shapeType,m.color,m.lineWidth,m.arrowtype,m.fillType))))},m.initType==AnnotationInitTypeEnum.proportional&&""!=m.board.backgroundColor&&m.updateBackgroundColor(m.board.backgroundColor),m.initType==AnnotationInitTypeEnum.proportional&&""!=m.board.backgroundImage&&m.updateBackgroundImage(m.board.backgroundImage)}else log.error("===annotation init faild, must be given a div or canvas element!"),r.reject("Must be given a div or canvas element!");return r.promise;function a(t){m.shapeType==shapeTypeEnum.eraser&&m.isEraser&&m.shapeArray.forEach(function(e){e.shape.id==t.target.id&&(m.zr.remove(e.shape),m.shapeGroup.remove(e.shape),m.roomHandle.sendRemoveAnnotation(m.boardId,m.shapeType,e.shape.id),m.undoArray.push({type:"delete",shapeObj:e}),m.shapeArray.splice(k,1))})}},e.prototype.excuteRemoveAnnotation=function(r){var e,n=this,t=(n.zr.remove(r.shape),n.shapeGroup.remove(r.shape),n.roomHandle.sendRemoveAnnotation(n.boardId,n.shapeType,r.shape.id),n.shapeArray.forEach(function(e,t){e.shape.id==r.shape.id&&(n.undoArray.push({type:"delete",shapeObj:e}),n.shapeArray.splice(t,1))}),n.zr.storage._displayList);for(e in t)t[e].id==r.shape.id&&(n.zr.remove(t[e]),n.shapeGroup.remove(t[e]))},e.prototype.initEraserShape=function(e){this.eraserShape=new zrender.Image({position:[0,0],scale:[1,1],style:{image:e,width:this.eraserImageWidth,height:this.eraserImageHeight},draggable:!0}),this.shapeGroup.add(this.eraserShape),this.eraserShape.id=Math.uuid()},e.prototype.removeToBoard=function(e){log.debug("===annotation removeToBoard");var t=this,r="userId"+e.operUserId,n=(t.shapeArray,t.zr.storage.getDisplayList()),o=t.shapeGroup.children();if(e.annotationType==shapeTypeEnum.clear){if(e.operUserId==t.roomHandle.selfUser.id){for(var i in t.shapeArray)t.zr.remove(t.shapeArray[i].shape),t.shapeGroup.remove(t.shapeArray[i].shape);t.shapeArray=[]}else for(var i in t.otherShapeMap)if(i==r)for(var a in t.otherShapeMap[i]){t.zr.remove(t.otherShapeMap[i][a].shape),t.shapeGroup.remove(t.otherShapeMap[i][a].shape);for(var s=n.length-1;0<=s;s--)n[s].id==t.otherShapeMap[i][a].shape.id&&t.zr.remove(n[s]);for(var d=o.length-1;0<=d;d--)o[d].id==t.otherShapeMap[i][a].shape.id&&t.shapeGroup.remove(o[d])}delete t.otherShapeMap[r]}else if(e.annotationType==shapeTypeEnum.eraser)if(t.hlightPointShape&&t.hlightPointShape.id==e.annotationId)t.clearCurrHlightPoint();else if(t.textTagShape&&t.textTagShape.id==e.annotationId)t.clearCurrHlightPoint();else if(e.operUserId==t.roomHandle.selfUser.id)for(var i in t.shapeArray)t.shapeArray[i].shape.id==e.annotationId&&(t.zr.remove(t.shapeArray[i].shape),t.shapeGroup.remove(t.shapeArray[i].shape),t.shapeArray.splice(i,1));else{for(var i in t.otherShapeMap)if(i==r)for(var a in t.otherShapeMap[i])t.otherShapeMap[i][a].id==e.annotationId&&(t.zr.remove(t.otherShapeMap[i][a].shape),t.shapeGroup.remove(t.otherShapeMap[i][a].shape));var l=t.zr.storage._displayList;for(s in l)l[s].id==e.annotationId&&(t.zr.remove(l[s]),t.shapeGroup.remove(l[s]))}else if(e.annotationType==shapeTypeEnum.img)for(var i in t.otherShapeMap)if(i==r)for(a=t.otherShapeMap[i].length-1;0<=a;a--)(t.otherShapeMap[i][a].shape.id==e.annotationId||e.Img&&t.otherShapeMap[i][a].shape.id==e.Img.im.id)&&(t.zr.remove(t.otherShapeMap[i][a].shape),t.shapeGroup.remove(t.otherShapeMap[i][a].shape),t.otherShapeMap[i].splice(a,1))},e.prototype.drawTextToBoard=function(e){var r=this,t=e.txt,n=t.txi,o=n.txs,i=t.objectBase.objectBase,a=parseInt(t.objectBase.type),s=parseInt(i.lineWidth),d=parseInt(i.arrow),l=U(i.lineColor),u=U(i.fillColor),n=new zrender.Text({style:{text:o[0].content,fontSize:n.fontSize,fontStyle:n.fontStyle,fontWeight:n.fontWeight,fill:"rgb("+(o=n.fontColor).r+","+o.g+","+o.b+")"},position:[t.objectBase.start.x*r.roomHandle.boardInputXRatio,t.objectBase.start.y*r.roomHandle.boardInputYRatio],origin:[t.objectBase.start.x*r.roomHandle.boardInputXRatio,t.objectBase.start.y*r.roomHandle.boardInputYRatio],onmouseover:function(e){if(r.shapeType==shapeTypeEnum.eraser&&r.isEraser)for(var t in r.shapeArray)r.shapeArray[t].shape.id==e.target.parent.id&&(r.zr.remove(e.target.parent),r.shapeGroup.remove(e.target.parent),r.roomHandle.sendRemoveAnnotation(r.boardId,r.shapeType,r.shapeArray[t].shape.id),r.undoArray.push({type:"delete",shapeObj:r.shapeArray[t]}),r.shapeArray.splice(t,1))}}),o=(r.shapeGroup.add(n),{id:e.annotationId,shape:n,shapeType:a,lineWidth:s,arrowtype:d,color:l,fillColor:u});(e.operUserId===r.roomHandle.selfUser.id?r.shapeArray:(t="userId"+i.ownerUserId,r.otherShapeMap[t]||(r.otherShapeMap[t]=[]),r.otherShapeMap[t])).push(o)},e.prototype.drawToBoard=function(e){var o=this,t=parseInt(e.objectBase.type),r=parseInt(e.objectBase.lineWidth),n=parseInt(e.objectBase.arrow),i=U(e.objectBase.lineColor),a=U(e.objectBase.fillColor),s=null;function d(e){if(o.shapeType==shapeTypeEnum.eraser&&o.isEraser)for(var t in o.shapeArray)if(e.target.id&&o.shapeArray[t].shape.id==e.target.id){o.zr.remove(o.shapeArray[t].shape),o.shapeGroup.remove(o.shapeArray[t].shape);var r,n=o.zr.storage._displayList;for(r in n)n[r].id==e.target.id&&(o.zr.remove(n[r]),o.shapeGroup.remove(n[r]));o.roomHandle.sendRemoveAnnotation(o.boardId,o.shapeType,o.shapeArray[t].shape.id),o.shapeArray.splice(t,1)}}switch(t){case shapeTypeEnum.rhomb:var l=e.start.x,u=e.start.y,c=e.end.x,p=e.end.y,l=(log.debug("===annotation.drawToBoard(),room.boardInputXRatio:"+o.roomHandle.boardInputXRatio+",room.boardInputYRatio:"+o.roomHandle.boardInputYRatio),log.debug("===annotation.drawToBoard(),shapeTypeEnum.rhomb,currentX:",l+",currentY:",u+",x:"+c+",y:"+p),Math.round(l*o.roomHandle.boardInputXRatio)),u=Math.round(u*o.roomHandle.boardInputYRatio),h=Math.round(c*o.roomHandle.boardInputXRatio),f=Math.round(p*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),ishapeTypeEnum.rhomb,nputCurrentX:",l+",inputCurrentY:",u+",inputX:"+h+",inputY:"+f);s=new zrender.Polygon({shape:{points:[[l,u+(f-u)/2],[l+(h-l)/2,f],[h,u+(f-u)/2],[l+(h-l)/2,u]],smooth:0},style:{stroke:i,fill:"none",lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.line:var l=e.start.x,u=e.start.y,m=e.end.x,g=e.end.y,l=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.line,x1:",l+",y1:",u+",x2:"+m+",y2:"+g),Math.round(l*o.roomHandle.boardInputXRatio)),u=Math.round(u*o.roomHandle.boardInputYRatio),m=Math.round(m*o.roomHandle.boardInputXRatio),g=Math.round(g*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.line,inputx1:",l+",inputy1:",u+",inputx2:"+m+",inputy2:"+g),s=new zrender.Arrowline({shape:{x1:l,y1:u,x2:m,y2:g,arrowlength:10,arrowtype:n},style:{stroke:i,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.failure:var c=e.start.x,p=e.start.y,y=e.end.x-e.start.x,v=e.end.y-e.start.y,h=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.failure,x:",c+",y:",p+",width:"+y+",height:"+v),Math.round(c*o.roomHandle.boardInputXRatio)),f=Math.round(p*o.roomHandle.boardInputYRatio),b=Math.round(y*o.roomHandle.boardInputXRatio),_=Math.round(v*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.failure,inputX:",h+",inputY:",f+",inputWidth:"+b+",inputHeight:"+_),s=new M({shape:{x:h,y:f,width:b,height:_},style:{stroke:i,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.success:c=e.start.x,p=e.start.y,y=e.end.x-e.start.x,v=e.end.y-e.start.y,h=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.success,x:",c+",y:",p+",width:"+y+",height:"+v),Math.round(c*o.roomHandle.boardInputXRatio)),f=Math.round(p*o.roomHandle.boardInputYRatio),b=Math.round(y*o.roomHandle.boardInputXRatio),_=Math.round(v*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.success,inputX:",h+",inputY:",f+",inputWidth:"+b+",inputHeight:"+_),s=new P({shape:{x:h,y:f,width:b,height:_},style:{stroke:i,fill:"none",lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.arrow:c=e.start.x,p=e.start.y,y=e.end.x-e.start.x,v=e.end.y-e.start.y,h=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.arrow,x:",c+",y:",p+",width:"+y+",height:"+v),Math.round(c*o.roomHandle.boardInputXRatio)),f=Math.round(p*o.roomHandle.boardInputYRatio),b=Math.round(y*o.roomHandle.boardInputXRatio),_=Math.round(v*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.arrow,inputX:",h+",inputY:",f+",inputWidth:"+b+",inputHeight:"+_),s=new A({shape:{x:h,y:f,width:b,height:_},style:{stroke:i,fill:a,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.hlight_texttag:var l=o.roomHandle.getUser(e.objectBase.ownerUserId),c=e.start.x,p=e.start.y,y=e.end.x-e.start.x,v=e.end.y-e.start.y,h=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_texttag,x:",c+",y:",p+",width:"+y+",height:"+v),Math.round(c*o.roomHandle.boardInputXRatio)),f=Math.round(p*o.roomHandle.boardInputYRatio),b=Math.round(y*o.roomHandle.boardInputXRatio),_=Math.round(v*o.roomHandle.boardInputYRatio);if(log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_texttag,inputX:",h+",inputY:",f+",inputWidth:"+b+",inputHeight:"+_),!l)return;o.textTagShape?o.textTagShape.attr({shape:{x:h,y:f},style:{text:l.name},zlevel:o.normalZlevel}):(o.textTagShape=new O({shape:{x:h,y:f,width:b,height:_},style:{stroke:"red",fill:"red",text:l.name,truncate:{outerWidth:50},lineWidth:r},zlevel:o.normalZlevel,onmouseover:d}),o.shapeGroup.add(o.textTagShape),o.textTagShape.id=e.objectBase.annotationId);break;case shapeTypeEnum.polyline:var S,w=[];for(S in console.log("===annotation.drawToBoard(),shapeTypeEnum.polyline,points：",w),e.points){c=e.points[S].x,p=e.points[S].y,h=Math.round(c*o.roomHandle.boardInputXRatio),f=Math.round(p*o.roomHandle.boardInputYRatio);w.push([h,f])}s=new zrender.Polyline({shape:{points:w,smooth:0},style:{stroke:i,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.rect:c=e.start.x,p=e.start.y,y=e.end.x-e.start.x,v=e.end.y-e.start.y,h=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.rect,x:",c+",y:",p+",width:"+y+",height:"+v),Math.round(c*o.roomHandle.boardInputXRatio)),f=Math.round(p*o.roomHandle.boardInputYRatio),b=Math.round(y*o.roomHandle.boardInputXRatio),_=Math.round(v*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.rect,inputX:",h+",inputY:",f+",inputWidth:"+b+",inputHeight:"+_),s=new zrender.Rect({shape:{x:h,y:f,width:b,height:_},style:{stroke:i,fill:a,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.ellipse:u=e.start.x,m=e.end.x,g=e.start.y,l=e.end.y,u=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.ellipse,startX :",u+",endX:",m+",startY:"+g+",endY:"+l),Math.round(u*o.roomHandle.boardInputXRatio)),m=Math.round(m*o.roomHandle.boardInputXRatio),g=Math.round(g*o.roomHandle.boardInputYRatio),l=Math.round(l*o.roomHandle.boardInputYRatio),m=(log.debug("===annotation.drawToBoard(),shapeTypeEnum.ellipse,inputStartX :",u+",inputEndX:",m+",inputStartY:"+g+",inputEndY:"+l),(m-u)/2),l=(l-g)/2;s=new zrender.Ellipse({shape:{cx:u+m,cy:g+l,rx:m,ry:l},style:{stroke:i,fill:a,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.hlight_point:c=e.start.x,p=e.start.y,y=o.hlightPointInfo.width,v=o.hlightPointInfo.height,h=(console.log("===annotation.drawToBoard(),shapeTypeEnum.hlight_point,x:",c+",y:",p+",width:"+y+",height:"+v),Math.round(c*o.roomHandle.boardInputXRatio)),f=Math.round(p*o.roomHandle.boardInputYRatio),b=Math.round(y*o.roomHandle.boardInputXRatio),_=Math.round(v*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_point,inputX:",h+",inputY:",f+",inputWidth:"+b+",inputHeight:"+_),o.hlightPointShape?o.hlightPointShape.attr("position",[h-b/2,f-_/2]):(o.hlightPointShape=new zrender.Image({position:[h,f],scale:[1,1],style:{image:o.hlightPointInfo.imgUrl,width:b,height:_},draggable:!0,zlevel:o.normalZlevel}),o.shapeGroup.add(o.hlightPointShape),o.hlightPointShape.id=e.objectBase.annotationId);break;case shapeTypeEnum.img:console.log("===annotation.drawToBoard(),shapeTypeEnum.img, annotationInfo:",e);var u=degree2mathPI(e.im.rotate),E=null,I={id:e.im.id,shape:null,shapeType:t,lineWidth:r,arrowtype:n,color:i,fillColor:a};if(e.objectBase.ownerUserId===o.roomHandle.selfUser.id)for(var T=0;T<o.roomHandle.annotation2boardId[e.objectBase.objectId].storageArr.length;T++){var C=o.roomHandle.annotation2boardId[e.objectBase.objectId].storageArr[T];if(C.annotationType==shapeTypeEnum.img&&C.annotationId==e.im.id&&C.operUserId==o.roomHandle.selfUser.id){E=C.imgZrender,I.shape=E,o.shapeArray.push(I);break}}else{E=new zrender.Image({style:{image:e.im.file_url,x:e.im.x*o.roomHandle.boardInputXRatio,y:e.im.y*o.roomHandle.boardInputYRatio,width:e.im.w*o.roomHandle.boardInputXRatio,height:e.im.h*o.roomHandle.boardInputYRatio},zlevel:e.im.layer,id:e.im.id,rotation:u,originX:e.im.x*o.roomHandle.boardInputXRatio+e.im.w/2*o.roomHandle.boardInputXRatio,originY:e.im.y*o.roomHandle.boardInputYRatio+e.im.h/2*o.roomHandle.boardInputYRatio}),I.shape=E;var R="userId"+e.objectBase.ownerUserId;if(o.otherShapeMap[R])for(T=o.otherShapeMap[R].length-1;0<=T;T--)o.otherShapeMap[R][T].shape.id===e.im.id&&o.otherShapeMap[R].splice(T,1);else o.otherShapeMap[R]=[];o.otherShapeMap[R].push(I)}o.shapeGroup.add(E),o.setAllowEditImg(!1)}s&&(I={id:e.objectBase.annotationId,shape:s},o.shapeGroup.add(s),s.id=e.objectBase.annotationId,e.objectBase.ownerUserId==o.roomHandle.selfUser.id?o.shapeArray.push({shape:s,shapeType:t,color:i,lineWidth:r,arrowtype:n,fillType:fillTypeEnum.none}):(R="userId"+e.objectBase.ownerUserId,o.otherShapeMap[R]||(o.otherShapeMap[R]=[]),o.otherShapeMap[R].push(I)))},e.prototype.updateDrawToBoard=function(t){var r=this,e=parseInt(t.objectBase.type);if(e===shapeTypeEnum.img){for(var n in r.shapeGroup.eachChild(function(e){e.id===t.im.id&&r.shapeGroup.remove(e)}),r.shapeArray)r.shapeArray[n].shape.id==t.im.id&&(r.zr.remove(r.shapeArray[n].shape),r.shapeArray.splice(n,1));e=degree2mathPI(t.im.rotate),e=(t.im.x,r.roomHandle.boardInputXRatio,t.im.w,r.roomHandle.boardInputXRatio,t.im.y,r.roomHandle.boardInputYRatio,t.im.h,r.roomHandle.boardInputYRatio,new zrender.Image({style:{image:t.im.file_url,x:t.im.x*r.roomHandle.boardInputXRatio,y:t.im.y*r.roomHandle.boardInputYRatio,width:t.im.w*r.roomHandle.boardInputXRatio,height:t.im.h*r.roomHandle.boardInputYRatio},zlevel:t.im.layer,id:t.im.id,rotation:e,origin:[t.im.x*r.roomHandle.boardInputXRatio+t.im.w*r.roomHandle.boardInputXRatio/2,t.im.y*r.roomHandle.boardInputYRatio+t.im.h*r.roomHandle.boardInputYRatio/2]})),e=(r.roomHandle.style2annotation[t.im.id]&&(e.attr("style",JSON.parse(r.roomHandle.style2annotation[t.im.id].style)),e.attr("position",JSON.parse(r.roomHandle.style2annotation[t.im.id].position)),e.attr("scale",JSON.parse(r.roomHandle.style2annotation[t.im.id].scale)),e.attr("rotation",JSON.parse(r.roomHandle.style2annotation[t.im.id].rotation)),e.attr("origin",JSON.parse(r.roomHandle.style2annotation[t.im.id].origin))),r.shapeGroup.add(e),{shape:e,shapeType:r.shapeType});if(t.objectBase.ownerUserId===r.roomHandle.selfUser.id)r.shapeArray.push(e);else{var o="userId"+t.objectBase.ownerUserId;if(r.otherShapeMap[o])for(var i=r.otherShapeMap[o].length-1;0<=i;i--)r.otherShapeMap[o][i].shape.id===t.im.id&&r.otherShapeMap[o].splice(i,1);else r.otherShapeMap[o]=[];r.otherShapeMap[o].push(e)}if(r.roomHandle.annotation2boardId[t.objectBase.objectId])for(i=0;i<r.roomHandle.annotation2boardId[t.objectBase.objectId].storageArr.length;i++){var a=r.roomHandle.annotation2boardId[t.objectBase.objectId].storageArr[i];if(a.Img&&a.annotationType==shapeTypeEnum.img&&(a.Img.im.id==t.im.id||a.annotationId==t.im.id)&&a.operUserId==t.objectBase.ownerUserId){a.Img.im.x=t.im.x,a.Img.im.y=t.im.y,a.Img.im.w=t.im.w,a.Img.im.h=t.im.h,a.Img.im.rotate=t.im.rotate;break}}}},e.prototype.setShapeType=function(e,t){var r=avdEngineHandle.getBrowserDetect().osName,r=(this.shapeType==shapeTypeEnum.hlight_point&&this.hlightPointShape&&this.clearCurrHlightPoint(),this.eraserShape&&this.clearCurrEraser(),(e==shapeTypeEnum.eraser&&t&&"Android"==r||"iOS"==r)&&this.initEraserShape(t),this.shapeType==shapeTypeEnum.hlight_texttag&&this.textTagShape&&this.clearCurrHlightPoint(),"");t&&(r="url("+t+"),auto"),null!=this.textInfo?e==shapeTypeEnum.txt?(this.textInfo.setTextEditEnable(!0),this.zr.handler.proxy.cursor="text"):this.textInfo.setTextEditEnable(!1):avdEngineHandle.eraserCustomIconPath=r,this.shapeType=parseInt(e)},e.prototype.clearCurrEraser=function(){this.eraserShape&&(this.zr.remove(this.eraserShape),this.shapeGroup.remove(this.eraserShape),this.eraserShape=null)},e.prototype.setColor=function(e){this.color=e,"none"!=this.fillColor&&(this.fillColor=e)},e.prototype.setColorOpacity=function(e){var t=this.color.split(","),e=(t[t.length-1]=e+")",t.join(","));console.log(e),this.color=e,"none"!=this.fillColor&&(this.fillColor=e)},e.prototype.setLineWidth=function(e){this.lineWidth=parseInt(e)},e.prototype.setArrowLength=function(e){this.arrowLength=parseInt(e)},e.prototype.setArrowType=function(e){this.arrowtype=parseInt(e)},e.prototype.download=function(){var e,t,r;null==this.renderBackground&&null==this.annoDiv||((r=document.createElement("canvas")).width=this.renderDiv.width,r.height=this.renderDiv.height,e=r.getContext("2d"),this.renderBackground&&e.drawImage(this.renderBackground,0,0),e.drawImage(this.renderDiv,0,0),e=(e=r).toDataURL("image/png"),imgData=e.replace(function(e){return"image/"+(e=e.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}("png"),"image/octet-stream"),e="个人画板_"+(new Date).getTime()+".png",r=imgData,e=e,(t=document.createElementNS("http://www.w3.org/1999/xhtml","a")).href=r,t.download=e,(r=document.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(r))},e.prototype.setFillColor=function(e){(this.fillType=e)==fillTypeEnum.none?this.fillColor="none":this.fillColor=this.color},e.prototype.clear=function(){for(var e=this,t=e.shapeArray,r=e.zr.storage.getDisplayList(),n=e.shapeGroup.children(),o=t.length-1;0<=o;o--){e.zr.remove(t[o].shape);for(var i=r.length-1;0<=i;i--)r[i].id==t[o].shape.id&&e.zr.remove(r[i]);for(var a=n.length-1;0<=a;a--)n[a].id==t[o].shape.id&&e.shapeGroup.remove(n[a])}e.shapeArray=[],e.undoArray=[],e.redoArray=[],e.roomHandle.sendRemoveAnnotation(e.boardId,shapeTypeEnum.clear,"")},e.prototype.undo=function(){var e;this.undoArray.length<1||(e=this.undoArray.pop(),this.undoShape(e))},e.prototype.undoShape=function(e){var t=this;switch(e.type){case"delete":t.shapeGroup.add(e.shapeObj.shape),t.shapeArray.push(e.shapeObj),t.roomHandle.sendAddAnnotation(t.boardId,e.shapeObj.shape,e.shapeObj.shapeType,e.shapeObj.color,e.shapeObj.lineWidth,e.shapeObj.arrowtype,e.shapeObj.fillType),t.redoArray.push(e);break;case"add":t.zr.remove(e.shapeObj.shape),t.shapeGroup.remove(e.shapeObj.shape);var r=e.shapeObj.shape.id;if(!(t.shapeArray.length<1))for(var n=0;n<t.shapeArray.length;n++)t.shapeArray[n].shape.id===r&&t.shapeArray.splice(n,1);t.roomHandle.sendRemoveAnnotation(t.boardId,shapeTypeEnum.eraser,e.shapeObj.shape.id),t.redoArray.push(e)}},e.prototype.redo=function(){var e;this.redoArray.length<1||(e=this.redoArray.pop(),this.redoShape(e))},e.prototype.redoShape=function(e){var t=this;switch(e.type){case"delete":t.zr.remove(e.shapeObj.shape),t.shapeGroup.remove(e.shapeObj.shape);var r=e.shapeObj.shape.id;if(!(t.shapeArray.length<1))for(var n=0;n<t.shapeArray.length;n++)t.shapeArray[n].shape.id===r&&t.shapeArray.splice(n,1);t.roomHandle.sendRemoveAnnotation(t.boardId,shapeTypeEnum.eraser,e.shapeObj.shape.id),t.undoArray.push(e);break;case"add":t.shapeGroup.add(e.shapeObj.shape),t.shapeArray.push(e.shapeObj),t.roomHandle.sendAddAnnotation(t.boardId,e.shapeObj.shape,e.shapeObj.shapeType,e.shapeObj.color,e.shapeObj.lineWidth,e.shapeObj.arrowtype,e.shapeObj.fillType),t.undoArray.push(e)}},e.prototype.hlightPointInit=function(e,t,r,n){this.hlightPointInfo.imgUrl=e,this.hlightPointInfo.width=parseInt(t)?parseInt(t):this.hlightPointInfo.width,this.hlightPointInfo.height=parseInt(r)?parseInt(r):this.hlightPointInfo.height,this.hlightPointInfo.intervalTime=parseInt(n)?parseInt(n):this.hlightPointInfo.intervalTime},e.prototype.clearCurrHlightPoint=function(){var e=this;e.hlightPointShape&&(e.roomHandle.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.hlightPointShape.id),e.zr.remove(e.hlightPointShape),e.shapeGroup.remove(e.hlightPointShape),e.hlightPointShape=null),e.textTagShape&&(e.roomHandle.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.textTagShape.id),e.zr.remove(e.textTagShape),e.shapeGroup.remove(e.textTagShape),e.textTagShape=null)},e.prototype.startHlightPoint=function(){var r=this,n=(r.setShapeType(shapeTypeEnum.hlight_point),r.hlightPointInfo.width),o=r.hlightPointInfo.height;r.hlightPointShape=new zrender.Image({position:[-100,-100],scale:[1,1],style:{image:r.hlightPointInfo.imgUrl,width:r.hlightPointInfo.width,height:r.hlightPointInfo.height},draggable:!0}),r.shapeGroup.add(r.hlightPointShape),r.hlightPointShape.id=Math.uuid(),r.renderDiv.onmousemove=function(e){var t;r.isAllowEditImg||r.shapeType==shapeTypeEnum.hlight_point&&(e=r.handleScaledXY(e.clientX-this.getBoundingClientRect().left,e.clientY-this.getBoundingClientRect().top),x=e.x,y=e.y,e=x-n/2,t=y-o/2,r.hlightPointShape.attr("position",[e,t]),r.hlightPointInfo.isSend)&&(r.hlightPointInfo.isSend=!1,r.roomHandle.sendAddAnnotation(r.boardId,r.hlightPointShape,shapeTypeEnum.hlight_point,r.color,r.lineWidth,r.arrowtype,r.fillType),setTimeout(function(){r.hlightPointInfo.isSend=!0},r.hlightPointInfo.intervalTime))}},e.prototype.changeScreen=function(e,t){if(this.zr&&0<this.shapeArray.length)for(var r in this.boardReRenderWH(e,t),this.shapeArray){var n=e/this.screenSize.width,o=t/this.screenSize.height;console.log("===Annotation.changeScreen(),x:"+n+",y:"+o),this.shapeArray[r].shape.animateTo({scale:[n,o]},function(){console.log("changeScreen")})}this.screenSize.width=e,this.screenSize.width=t},e.prototype.uploadImg=function(e,t){var r,o=when.defer(),i=this,n=t.files[0],a=(n||(r=new l(ErrorConstant.upload_filer_required),o.reject(r)),n.size),s=n.type;return log.info("===annotation.uploadImg(),fileSize:"+a+", fileType"+s),["image/jpeg","image/png"].includes(s)?15728640<a?(t.value="",(r=new l(ErrorConstant.upload_filer_fileSize)).message=r.message+",Within 15M only",o.reject(r)):(new d).uploadFile(e,n).then(function(r){t.value="",log.info("===annotation.uploadImg(),fileUrl:"+r);var n=new Image;n.src=r,n.onload=function(){var e=n.width,t=n.height;log.info("===annotation.uploadImg(),img width:"+e+", height:"+t),i.drawImg(r,e,t),n=null,o.resolve()}}).otherwise(function(e){console.info("===annotation.uploadImg(),error:",e),o.reject(e)}):(t.value="",(r=new l(ErrorConstant.upload_filer_fileType)).message=r.message+",Support jpeg/jpg/png only ",o.reject(r)),o.promise},e.prototype.drawImg=function(e,t,r){log.info("===annotation.drawImg(),imgUrl:"+e+", imgWidth:"+t+", imgHeight:"+r);var n=t/r,o=t,i=r,a=((150<t||150<r)&&(1<n?(o=150,i=Math.round(o/n)):(i=150,o=Math.round(i*n))),log.info("===annotation.drawImg(),targetWidth:"+o+", targetHeight:"+i),this),t=(a.shapeType=shapeTypeEnum.img,new zrender.Image({style:{image:e,x:0,y:0,width:o,height:i,shadowColor:"red",shadowBlur:5},zlevel:a.imgZlevel,id:Math.uuid(),rotation:0,originX:0,originY:0})),r={shape:t,shapeType:a.shapeType,color:a.color,lineWidth:a.lineWidth,arrowtype:a.arrowtype,fillType:a.fillType};a.shapeArray.push(r),a.shapeGroup.add(t),a.undoArray.push({type:"add",shapeObj:r}),a.setAllowEditImg(!0),t.attr("zlevel",++a.imgZlevel),a.currActiveImg=t,a.shapeGroup.eachChild(function(e){"image"===e.type&&(e.id==a.currActiveImg.id?e.attr("style",{shadowColor:"red",shadowBlur:5}):e.attr("style",{shadowColor:void 0,shadowBlur:void 0}))}),a.roomHandle.sendAddAnnotation(a.boardId,t,shapeTypeEnum.img,a.color,a.lineWidth,a.arrowtype,a.fillType)},e.prototype.setAllowEditImg=function(e){var t=this;this.isAllowEditImg=null==e?!this.isAllowEditImg:e,this.shapeGroup.eachChild(function(e){e.type&&"image"!==e.type&&e.attr("silent",t.isAllowEditImg)}),this.isAllowEditImg?this.setShapeType(shapeTypeEnum.img):this.currActiveImg=null,this.shapeGroup.eachChild(function(e){"image"!==e.type||t.isAllowEditImg||e.attr("style",{shadowColor:void 0,shadowBlur:void 0})}),this.textInfo&&this.shapeType===shapeTypeEnum.txt&&this.textInfo.setTextEditEnable(!this.isAllowEditImg)},e.prototype.getAllowEditImg=function(){return this.isAllowEditImg},e.prototype.scaleImg=function(e,t){if(this.isAllowEditImg&&this.currActiveImg){var r=this.currActiveImg.scale[0],n=this.currActiveImg.scale[1];if(e)r+=t,n+=t;else{if(r-t<=.1||n-t<=.1)return;r-=t,n-=t}this.currActiveImg.attr("scale",[r,n]),this.currActiveImg.attr("origin",[this.currActiveImg.style.width/2,this.currActiveImg.style.height/2]),e?(this.currActiveImg.customPositionX=this.currActiveImg.customPositionX-this.currActiveImg.style.width/2*t,this.currActiveImg.customPositionY=this.currActiveImg.customPositionY-this.currActiveImg.style.height/2*t):(this.currActiveImg.customPositionX=this.currActiveImg.customPositionX+this.currActiveImg.style.width/2*t,this.currActiveImg.customPositionY=this.currActiveImg.customPositionY+this.currActiveImg.style.height/2*t),this.roomHandle.sendUpdateAnnotation(this.boardId,this.currActiveImg,shapeTypeEnum.img)}},e.prototype.rotateImg=function(){var e;this.isAllowEditImg&&this.currActiveImg&&(e=this.currActiveImg.rotation-Math.PI/2,this.currActiveImg.attr("rotation",[e]),this.currActiveImg.attr("origin",[this.currActiveImg.style.width/2,this.currActiveImg.style.height/2]),this.roomHandle.sendUpdateAnnotation(this.boardId,this.currActiveImg,shapeTypeEnum.img))},e.prototype.delImg=function(){if(this.isAllowEditImg&&this.currActiveImg){this.roomHandle.sendRemoveAnnotation(this.boardId,shapeTypeEnum.img,this.currActiveImg.id),this.shapeGroup.remove(this.currActiveImg);for(var e=0;e<this.shapeArray.length;e++){var t=this.shapeArray[e];this.undoArray.push({type:"delete",shapeObj:t}),t.shape&&t.shape.id==this.currActiveImg.id&&this.shapeArray.splice(e,1)}this.currActiveImg=null}},e.prototype.handleScaledXY=function(e,t){e={x:e,y:t};return 1==this.positionInfo.scaleRatioX&&1==this.positionInfo.scaleRatioX||(1<this.positionInfo.scaleRatioX?e.x/=this.positionInfo.scaleRatioX:this.positionInfo.scaleRatioX<1&&(e.x*=this.positionInfo.scaleRatioXR),1<this.positionInfo.scaleRatioY?e.y/=this.positionInfo.scaleRatioY:this.positionInfo.scaleRatioY<1&&(e.y*=this.positionInfo.scaleRatioYR)),e},e.prototype.boardReRenderWH=function(e,t){e===this.positionInfo.originalWidth&&t===this.positionInfo.originalHeight||(console.log("===scale on based position before scale"),this.boardReRenderWH(this.positionInfo.originalWidth,this.positionInfo.originalHeight));var r=this.zr.getWidth(),n=this.zr.getHeight(),r=(log.debug("===boardReRenderWH, width: "+e+"height: "+t+" currWidth: "+r+" currHeight: "+n),{scaleWidth:e,scaleHeight:t,zrWidth:r,zrHeight:n,scaleRatioX:e/r,scaleRatioY:t/n,scaleRatioXR:r/e,scaleRatioYR:n/t});e===this.positionInfo.originalWidth&&t===this.positionInfo.originalHeight&&(r.scaleRatioXR=1,r.scaleRatioYR=1),Object.assign(this.positionInfo,r),1==this.positionInfo.scaleRatioX&&1==this.positionInfo.scaleRatioY||(this.positionInfo.scaleRatioX*=this.shapeGroup.scaleX,this.positionInfo.scaleRatioY*=this.shapeGroup.scaleY,this.zr.resize({width:e,height:t}),this.zr.dom.style.width=e+"px",this.zr.dom.style.height=t+"px",this.renderBackground&&(this.renderBackground.width=e,this.renderBackground.height=t,this.renderBackground.style.width=e+"px",this.renderBackground.style.height=t+"px",this.board.backgroundColor&&this.updateBackgroundColor(this.board.backgroundColor),this.board.backgroundImage)&&this.updateBackgroundImage(this.board.backgroundImage),this.shapeGroup.attr({scaleX:this.positionInfo.scaleRatioX,scaleY:this.positionInfo.scaleRatioY,originX:0,originY:0}),log.debug("===Annotation boardReRenderWH positionInfo: ",this.positionInfo))},e.prototype.startTextInput=function(e){var r=this;function n(e){if(r.shapeType==shapeTypeEnum.eraser&&r.isEraser)for(var t in r.shapeArray)r.shapeArray[t].shape.id==e.target.parent.id&&(r.zr.remove(e.target.parent),r.shapeGroup.remove(e.target.parent),r.roomHandle.sendRemoveAnnotation(r.boardId,r.shapeType,r.shapeArray[t].shape.id),r.undoArray.push({type:"delete",shapeObj:r.shapeArray[t]}),r.shapeArray.splice(t,1))}r.setShapeType(shapeTypeEnum.txt),this.isAllowEditImg||(this.isAllowEditImg||null==this.textInfo||null==this.textInfo.currTextElParentNode?(this.textInfo=new t(e,this),this.setShapeType(shapeTypeEnum.txt),this.textInfo.setParentElement(this.annoDiv),this.textInfo.setCanvasParentElement("CANVAS"===this.annoDiv.tagName?this.annoDiv.parentElement:this.annoDiv),this.textInfo.initToolBar(),this.textInfo.setColorChoosePanelDisplay(!1),this.textInfo.setTextEditEnable(!0),this.textInfo.setZrender(r.zr),this.textInfo.textEventEmitter.on("confirm",function(e){var t;e=e,t=r.handleScaledXY(e.position[0],e.position[1]),(e=new zrender.Text({style:{text:e.content,fontSize:e.fontSize,fontStyle:e.fontStyle,fontWeight:e.fontWeight,fill:e.fontColor},zlevel:r.normalZlevel,position:[t.x,t.y],origin:[t.x,t.y-50],onmouseover:n})).id=Math.uuid(),r.shapeGroup.add(e),t={shape:e,shapeType:r.shapeType,color:r.color,lineWidth:r.lineWidth,arrowtype:r.arrowtype,fillType:r.fillType},r.shapeArray.push(t),r.roomHandle.sendAddAnnotation(r.boardId,e,shapeTypeEnum.txt,r.color,r.lineWidth,r.arrowtype,r.fillType)}),log.debug("===Annotation.startTextInput success")):this.textInfo.setTextEditEnable(!0))},e}),ModuleBase.define("TextInfo",[],function(){function e(e,t){this.currTextElStyleList=null,this.currTextElParentNode=null,this.currTextInputMap=new Map,this.currTextInputElBind=null,this.currTextIsEdit=!1,this.currTextDefaultFontSize=14,this.currTextColorChoosePanel=null,this.currTextFontSizeEl=null,this.currTextColorBtn=null,this.currTextColorChoosePanelIsShow=!1,this.currTextToolBarEl=null,this.currClickPos=null,this.textEditEnable=!1,this.canvasParentElement=null,this.confirmBtnConfig={confirm:{color:e&&e.confirm?e.confirm.color:"#5090c6",text:e&&e.confirm?e.confirm.text:"确认"},cancel:{color:e&&e.cancel?e.cancel.color:"#94ddb0",text:e&&e.cancel?e.cancel.text:"取消"}},this.textEventEmitter=new EventEmitter,this.clickPosOffset={x:0,y:0},this.zr=null,this.annotation=t}function d(e){e.style.display="inline-block",e.style.width="30px",e.style.height="30px",e.style.cursor="pointer",e.style.textAlign="center",e.style.lineHeight="30px",e.style.transition="all ease .2s",e.style.userSelect="none",e.onmouseover=function(){e.style.background="rgba(0,0,0,.1)"},e.onmouseleave=function(){e.style.background="#ffffff"}}function l(e){return document.createElement(e)}return e.prototype.setParentElement=function(e){this.currTextElParentNode=e,this.currTextElParentNode.style.position="relative",this.annotation.initType==AnnotationInitTypeEnum.proportional?this.annotation.renderDiv.onclick=this.initCanvasClick.bind(this):this.currTextElParentNode.onclick=this.initCanvasClick.bind(this)},e.prototype.initToolBar=function(){var e=this,t=l("div"),t=(t.id="avdrtc-tool-bar",t.style.display="none",t.style.width="280px",t.style.boxShadow="0 0 10px rgba(0,0,0,.3)",t.style.padding="5px 10px",t.style.borderRadius="5px",t.style.height="30px",t.style.zIndex="1001",t.style.background="#ffffff",t.style.position="absolute",t.style.left=this.annotation.renderDiv.offsetLeft+"px",t.style.top=this.annotation.renderDiv.offsetTop+"px",this.currTextToolBarEl=t,l("span")),r=(t.style.fontWeight="bold",d(t),t.innerText="B",t.onclick=this._bold.bind(e),l("span")),n=(r.style.fontStyle="italic",d(r),r.innerText="I",r.onclick=this._italic.bind(e),l("span")),o=(d(n),n.innerText="T",n.onclick=this._changeColor.bind(e),this.currTextColorBtn=n,l("div")),i=(o.style.background="#FFFFFF",o.style.borderRadius="5px",o.style.width="132px",o.style.height="110px",o.style.boxSizing="border-box",o.style.padding="10px",o.style.display="flex",o.style.flexWrap="wrap",o.style.flexDirection="row",o.style.justifyContent="flex-start",o.style.alignItems="center",o.style.boxShadow="0 3px 6px #0000001f",o.style.position="absolute",o.style.top="60px",o.style.left="8px",this.currTextColorChoosePanel=o,l("span")),i=(this._setColorBtnStyle(i,"#e02020"),l("span")),i=(this._setColorBtnStyle(i,"#fa6400"),l("span")),i=(this._setColorBtnStyle(i,"#f7b500"),l("span")),i=(this._setColorBtnStyle(i,"#6dd400"),l("span")),i=(this._setColorBtnStyle(i,"#44d7b6"),l("span")),i=(this._setColorBtnStyle(i,"#32c5ff"),l("span")),i=(this._setColorBtnStyle(i,"#0091ff"),l("span")),i=(this._setColorBtnStyle(i,"#6236ff"),l("span")),i=(this._setColorBtnStyle(i,"#b620e0"),l("span")),i=(this._setColorBtnStyle(i,"#6d7278"),l("span")),i=(this._setColorBtnStyle(i,"#000000"),l("span")),i=(this._setColorBtnStyle(i,"#ffffff"),l("input")),a=(d(i),i.type="number",i.value="14",i.style.border="none",i.style.width="50px",i.style.height="30px",i.style.display="inline-block",i.style.boxSizing="border-box",i.style.fontSize="14px",i.style.outline="none",i.onchange=this._changeFontSize.bind(e),this.currTextFontSizeEl=i,l("span")),s=(d(a),this._setBtnStyle(e,a,"confirm"),a.innerText=this.confirmBtnConfig.confirm.text,a.style.background=this.confirmBtnConfig.confirm.color,a.onclick=e._inputConfirm.bind(e),l("span"));d(s),this._setBtnStyle(e,s,"cancel"),s.innerText=this.confirmBtnConfig.cancel.text,s.style.background=this.confirmBtnConfig.cancel.color,s.onclick=e._inputCancel.bind(e),this.currTextToolBarEl.appendChild(t),this.currTextToolBarEl.appendChild(r),this.currTextToolBarEl.appendChild(n),this.currTextToolBarEl.appendChild(o),this.currTextToolBarEl.appendChild(i),this.currTextToolBarEl.appendChild(a),this.currTextToolBarEl.appendChild(s),this.canvasParentElement.appendChild(this.currTextToolBarEl)},e.prototype.setTextEditEnable=function(e){this.textEditEnable=e},e.prototype.initCanvasClick=function(e){var t,r,n,o,i;!this.textEditEnable||(t=e.offsetX,r=e.offsetY,o=(e=e.target).clientWidth-(n=t),i=e.clientHeight-(e=r),this.currTextIsEdit)||(n<10||e<10||o<20||i<10)||(this._setClickPos({x:t,y:r-7}),this._setToolBarPos(n,e-7,o,i),this.renderToBoard({x:n,y:e,offsetRight:o,offsetBottom:i}),this._setToolBarDisplay(!0),this.currTextIsEdit=!0)},e.prototype._changeFontSize=function(e){var t=e.target.value;30<parseInt(t)||parseInt(t)<10?(30<t&&(e.target.value=30),t<10&&(e.target.value=10)):this.currTextElStyleList.fontSize=parseInt(t)+"px"},e.prototype.setColorChoosePanelDisplay=function(e){this.currTextColorChoosePanelIsShow=e,this.currTextColorChoosePanel.style.display=1==e?"flex":"none"},e.prototype._setToolBarPos=function(e,t,r,n){var e=e+this.currTextToolBarEl.offsetWidth,o=t-this.currTextToolBarEl.offsetHeight-60;40<t&&280<r||(t<40&&280<r?o+=90:t<40||r<280?(e-=310,o+=40):t<40&&(e+=280,o+=30)),this.currTextToolBarEl.style.position="absolute",this.currTextToolBarEl.style.left=e+this.clickPosOffset.x+"px",this.currTextToolBarEl.style.top=o+this.clickPosOffset.y+"px"},e.prototype.setTextInputPos=function(e,t,r){e.style.left=t+this.clickPosOffset.x+"px",e.style.top=r+this.clickPosOffset.y-7+"px",this.canvasParentElement.appendChild(e)},e.prototype.renderToBoard=function(e){var t=Math.round(1e7*Math.random()),r=l("span");this.currTextInputElBind=t,r.contentEditable=!0,r.style.fontSize=this.currTextDefaultFontSize+"px",r.style.display="flex",r.style.paddingRight="20px",r.style.background="rgba(0,0,0,0",r.style.outline="orange dotted 1px",r.style.position="absolute",r.style.zIndex="1001",this.setTextInputPos(r,e.x,e.y),this.currTextInputMap.set(t,r),this.setCurrBindTextEl(t),r.focus()},e.prototype.setCurrBindTextEl=function(e){e=this.currTextInputMap.get(e);e&&(this.currTextElStyleList=e.style)},e.prototype._setToolBarDisplay=function(e){this.currTextToolBarEl.style.display=!0===e?"flex":"none"},e.prototype._setTextFinished=function(){var e=this.currTextInputMap.get(this.currTextInputElBind);e.style.outline="none",e.contentEditable=!1,this.currTextColorBtn.style.color="#000000"},e.prototype.handleColorClick=function(e){this.currTextElStyleList.color=e.target.getAttribute("color"),this.currTextColorBtn.style.color=e.target.getAttribute("color"),this.setColorChoosePanelDisplay(!1)},e.prototype._setClickPos=function(e){var t;e?(t=e.x,e=e.y,this.currClickPos={x:t,y:e}):this.currClickPos=null},e.prototype._getClickPos=function(){return this.currClickPos},e.prototype._setColorBtnStyle=function(e,t){e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.cursor="pointer",e.style.margin="4px",e.style.width="20px",e.style.height="20px",e.style.boxSizing="border-box",e.style.borderRadius="50%",e.style.border="1px solid rgba(0,0,0,.2)",e.style.background=t,e.setAttribute("color",t),this.currTextColorChoosePanel.appendChild(e),e.onclick=this.handleColorClick.bind(this)},e.prototype._bold=function(){"bold"===this.currTextElStyleList.fontWeight?this.currTextElStyleList.fontWeight="":this.currTextElStyleList.fontWeight="bold"},e.prototype._italic=function(e){"italic"===this.currTextElStyleList.fontStyle?this.currTextElStyleList.fontStyle="":this.currTextElStyleList.fontStyle="italic"},e.prototype._changeColor=function(){this.currTextColorChoosePanelIsShow?this.setColorChoosePanelDisplay(!1):this.setColorChoosePanelDisplay(!0)},e.prototype._inputConfirm=function(e){e&&null!=e.cancelBubble&&(e.cancelBubble=!0),this._checkTextIsEmpty()?this._inputCancel():(this._setTextFinished(),this.textEventEmitter.emit("confirm",this._getCurrTextInfo()),this._setToolBarDisplay(!1),this.currTextIsEdit=!1,this.currTextFontSizeEl.value=this.currTextDefaultFontSize,this.canvasParentElement.removeChild(this.currTextInputMap.get(this.currTextInputElBind)),this._setClickPos(null),this.currTextInputElBind=null)},e.prototype._inputCancel=function(e){e&&null!=e.cancelBubble&&(e.cancelBubble=!0),this.canvasParentElement.removeChild(this.currTextInputMap.get(this.currTextInputElBind)),this.currTextInputMap.delete(this.currTextInputElBind),this._setToolBarDisplay(!1),this.currTextInputElBind=null,this.currTextIsEdit=!1,this.currTextColorBtn.style.color="#000000"},e.prototype._checkTextIsEmpty=function(){var e=!1;return e=""===this.currTextInputMap.get(this.currTextInputElBind).innerText?!0:e},e.prototype._getCurrTextInfo=function(){var e=this._getClickPos(),t=e.x,e=e.y,r=this.currTextInputMap.get(this.currTextInputElBind),n=this.currTextElStyleList.color,o=this.currTextElStyleList.fontSize,i=this.currTextElStyleList.fontStyle,a=this.currTextElStyleList.fontWeight,s=r.innerText,r=(parseInt(e-r.offsetHeight/2),[t,e]);return{fontColor:n||"rgb(0,0,0)",fontSize:parseInt(o.split("px")[0]),fontStyle:i,fontWeight:a,content:s,position:r}},e.prototype._setBtnStyle=function(e,t,r){t.style.marginLeft="10px",t.style.fontSize="13px",t.style.borderRadius="3px",t.style.color="#ffffff",t.style.width="60px","confirm"==r?(t.onmouseover=function(){t.style.opacity="0.9"},t.onmouseleave=function(){t.style.background=e.confirmBtnConfig.confirm.color,t.style.opacity="1"}):(t.onmouseover=function(){t.style.opacity="0.9"},t.onmouseleave=function(){t.style.background=e.confirmBtnConfig.cancel.color,t.style.opacity="1"})},e.prototype.setZrender=function(e){log.debug("===Textinfo setZrender zr: ",null!=e),this.zr=e;e=this.zr.dom;this.clickPosOffset.x=e.offsetLeft,this.clickPosOffset.y=e.offsetTop},e.prototype.setCanvasParentElement=function(e){this.canvasParentElement=e},e}),ModuleBase.define("StreamExporterManager",["StreamExporterServer","Error"],function(u,e){function t(){this.streamExporterServers=[]}return t.prototype.createServerRecorder=function(e,t,r,n,o,i,a){var s=when.defer();return this.createExportServer(exporterTypeEnum.record,e,t,r,n,o,i=i||10,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createServerRealtimeRecorder=function(e,t,r,n,o,i,a){var s=when.defer();return this.createExportServer(exporterTypeEnum.record_real_time,e,t,r,n,o,i=i||10,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createServerLivecast=function(e,t,r,n,o,i,a){var s=when.defer();return this.createExportServer(exporterTypeEnum.liver,e,t,r,n,o,i=i||10,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createExportServer=function(r,e,n,o,i,a,t,s){var d=this,l=when.defer();return t=t||10,room.masterServer.createServerRecorder(Math.uuid(),room.id,room.selfUser.id,e,r,n,o,i,a,t,"",s).then(function(e){var t=new u;t.exporterId=e.exporter_id,t.name=e.exporter_name,t.viewWidth=n,t.viewHeight=o,t.outBitrate=i,t.outFps=a,t.playurls=e.play_urls,t.exporterType=r,d.streamExporterServers.push(t),l.resolve(t)}).otherwise(function(e){l.reject(e)}),l.promise},t.prototype.getExporter=function(e){var t,r=null;for(t in streamExporterServers){var n=streamExporterServers[t];(n.exporterId=e)&&(r=n,brea)}return r},t.prototype.getStreamExporterServer=function(e,t,i){var a=when.defer();return room.masterServer.outgoingGetExporterInfo(e,t,i).then(function(e,t){var r=new u,n=(r.exporterId=e.view_stream_id,r.name=e.exporter_name,r.viewWidth=e.view_width,r.viewHeight=e.view_height,r.outBitrate=e.view_bitrate,r.outFps=e.view_fps,r.maxVideoNumber=e.max_video_number,r.viewLayoutMode=e.layoutMode,r.exporterType=i,[]);if(t)for(var o in t){o=t[o],o={userId:o.owner_user_id,deviceId:o.video_resource_id,x:o.x,y:o.y,width:o.w,height:o.h,zorder:o.zoder,data:o.video_data};n.push(o)}r.videoItems=n,a.resolve(r)}).otherwise(function(e){a.reject(e)}),a.promise},t.prototype.setFocusVideo=function(e,t,r){var n=when.defer();return room.masterServer.outgoingExporterSetFocusVideo(e,t,r).then(function(){n.resolve()}).otherwise(function(e){n.reject(e)}),n.promise},t}),ModuleBase.define("StreamExporterServer",["Error"],function(m){function e(){this.exporterId="",this.name="",this.appdata=null,this.exporterType=null,this.playurls="",this.viewWidth=0,this.viewHeight=0,this.outBitrate=0,this.outFps=0,this.maxVideoNumber=4,this.createTime="",this.status=exporterStatusEnum.live,this.size=0,this.desturl="",this.videoItems=[],this.audioUserId="",this.viewLayoutMode=viewLayoutModeEnum.fixation,this.pause_resume=!1}return e.prototype.updateStreamsExporter=function(t,e,r,n,o,i,a,s){var d=this,l=when.defer();return room.masterServer.createServerRecorder(e,room.id,room.selfUser.id,r,t,n,o,i,a,s,"").then(function(e){d.exporterId=e.exporter_id,d.name=e.exporter_name,d.viewWidth=n,d.viewHeight=o,d.outBitrate=i,d.outFps=a,d.playurls=e.play_urls,d.exporterType=t,l.resolve()}).otherwise(function(e){l.reject(e)}),l.promise},e.prototype.selectSingleVideo4Exporter=function(e,t,r,n){var o,i=when.defer(),a=t;return e==room.selfUser.id&&(a=room.setDeviceIdByUUID(0,t)),arguments.length<3?(o=new m(ErrorConstant.exporter_parameter_lack_error),i.reject(o)):(this.audioUserId=r,n=n||"",room.masterServer.selectStream4Exporter(this.exporterId,room.id,e,a,this.audioUserId,n,this.exporterType).then(function(e){i.resolve(e)}).otherwise(function(e){i.reject(e)})),i.promise},e.prototype.selectMixedVideos4Exporter=function(){var t=when.defer();return room.masterServer.mixMedia4Exporter(this.exporterId,room.id,this.viewLayoutMode,this.videoItems,this.audioUserId,this.exporterType).then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.selectMixedVideos4ExporterStart=function(){var e=this,t=when.defer();return setTimeout(function(){e.selectMixedVideos4Exporter().then(function(e){t.resolve(e)},function(e){t.reject(e)})},0),t.promise},e.prototype.setAudioUserId=function(e){this.audioUserId=e},e.prototype.setAutoLayout=function(e){var t,r,n=when.defer(),o=!1;for(t in viewLayoutModeEnum)if(e==viewLayoutModeEnum[t]){o=!0;break}return o?(this.viewLayoutMode=e,self.selectMixedVideos4Exporter().then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)})):(r=new m(ErrorConstant.exporter_parameter_type_error),n.reject(r)),n.promise},e.prototype.addVideoItem=function(t,e,r,n,o,i,a,s,d,l){var u,c=this,p=when.defer(),h=e;return t==room.selfUser.id&&(h=room.setDeviceIdByUUID(0,e)),arguments.length<7?(u=new m(ErrorConstant.exporter_parameter_lack_error),p.reject(u)):c.checkoutArguments(r,n,o,i,a).then(function(){var e={userId:t,deviceId:h,x:parseFloat(r),y:parseFloat(n),width:parseFloat(o),height:parseFloat(i),zorder:parseFloat(a),videoData:l};c.videoItems.push(e),p.resolve()}).otherwise(function(e){p.reject(e)}),p.promise},e.prototype.removeAllVideoItem=function(){this.videoItems=[]},e.prototype.addSubVideo=function(e,t,r,n,o,i,a,s,d){var l=this,u=when.defer(),c=t;if(e==room.selfUser.id&&(c=room.setDeviceIdByUUID(0,t)),arguments.length<7){var p=new m(ErrorConstant.exporter_parameter_lack_error);u.reject(p)}else{var h,f=!1;for(h in l.videoItems)if(l.videoItems[h].deviceId==c){f=!0;break}f?(p=new m(ErrorConstant.video_has_exporter_error),u.reject(p)):l.addVideoItem(e,c,r,n,o,i,a,s,d).then(function(){l.selectMixedVideos4Exporter().then(function(e){u.resolve(e)}).otherwise(function(e){u.reject(e)})},function(e){u.reject(e)})}return u.promise},e.prototype.updataVideo=function(e,t,r){var n=!1,o=when.defer(),i=r;if(t==room.selfUser.id&&(i=room.setDeviceIdByUUID(0,r)),arguments.length<3){var a=new m(ErrorConstant.exporter_parameter_lack_error);o.reject(a)}else{for(var s in this.videoItems)if(this.videoItems[s].deviceId==e){n=!0,this.videoItems[s].deviceId=i,this.videoItems[s].userId=t;break}n?this.selectMixedVideos4Exporter().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}):(a=new m(ErrorConstant.video_not_exporter_error),o.reject(a))}},e.prototype.modSubVideo=function(e,t,r,n,o,i,a,s,d){var l,u=this,c=!1,p=when.defer(),h=t;return e==room.selfUser.id&&(h=room.setDeviceIdByUUID(0,t)),arguments.length<7?(l=new m(ErrorConstant.exporter_parameter_lack_error),p.reject(l)):this.checkoutArguments(r,n,o,i,a).then(function(){for(var e in u.videoItems)if(u.videoItems[e].deviceId==h){c=!0,u.videoItems[e].x=parseFloat(r),u.videoItems[e].y=parseFloat(n),u.videoItems[e].width=parseFloat(o),u.videoItems[e].height=parseFloat(i),u.videoItems[e].zorder=parseFloat(a);break}var t;c?u.selectMixedVideos4Exporter().then(function(e){p.resolve(e)}).otherwise(function(e){p.reject(e)}):(t=new m(ErrorConstant.video_not_exporter_error),p.reject(t))},function(e){p.reject(e)}),p.promise},e.prototype.rmvSubVideo=function(e,t){var r,n=!1,o=when.defer(),i=t;for(r in e==room.selfUser.id&&(i=room.setDeviceIdByUUID(0,t)),this.videoItems)if(this.videoItems[r].deviceId==i){n=!0,this.videoItems.splice(r,1);break}return n?this.selectMixedVideos4Exporter().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}):(e=new m(ErrorConstant.video_not_exporter_error),o.reject(e)),o.promise},e.prototype.pauseResume=function(){var e,t=this,r=when.defer(),n=!1;return t.status==exporterStatusEnum.stop?(e=new m(ErrorConstant.exporter_has_stop_error),r.reject(e)):(t.status==exporterStatusEnum.live&&(n=!0),room.masterServer.pauseResumeExporter(t.exporterId,room.id,n,t.exporterType).then(function(e){t.status=n?exporterStatusEnum.pause:exporterStatusEnum.live,r.resolve(e)}).otherwise(function(e){r.reject(e)})),r.promise},e.prototype.stopExporter=function(){var t=this,r=when.defer();return room.masterServer.destroyExporter(t.exporterId,room.id,t.exporterType).then(function(e){t.status=exporterStatusEnum.stop,r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.checkoutArguments=function(e,t,r,n,o){var i,a=when.defer();return"number"!=typeof e||"number"!=typeof t||"number"!=typeof r||"number"!=typeof n||"number"!=typeof o?(i=new m(ErrorConstant.exporter_parameter_type_error),a.reject(i)):1<e||e<0||1<t||t<0||1<r||r<0||1<n||n<0?(i=new m(ErrorConstant.exporter_parameter_number_error),a.reject(i)):o<0||10<o?(i=new m(ErrorConstant.exporter_parameter_number1_error),a.reject(i)):a.resolve(),a.promise},e}),ModuleBase.define("ElectronManager",["PeerConnection","Error"],function(u,e){function t(){"undefined"!=typeof require&&(this.mainVersion=require("process").versions.electron.split(".")[0],this.electron=require("electron"),this.path=require("path"),this.remote=12<this.mainVersion?require("@electron/remote"):require("electron").remote,this.ipc=12<this.mainVersion?require("@electron/remote/renderer"):require("electron").ipcRenderer,this.ipcRenderer=12<this.mainVersion?require("@electron/remote/renderer"):require("electron").ipcRenderer,this.BrowserWindow=(12<this.mainVersion?this.ipcRenderer:this.remote).BrowserWindow,this.curWindId=(12<this.mainVersion?this.ipcRenderer:this.remote).getCurrentWindow().id),this.desktopTypes=["window","screen"],this.appThumbnailSize={width:150,height:150},this.winId2PeerConnection={},this.renderPeerConnection=null,this.ipc&&this.registerElectronIPCInner()}return t.prototype.getDesktopSources=function(e,t){e&&(this.desktopTypes=e),t&&(this.appThumbnailSize=t);var e={types:this.desktopTypes,thumbnailSize:this.appThumbnailSize},o=when.defer();return(12<this.mainVersion?this.remote:this.electron).desktopCapturer.getSources(e).then(function(e){var t,r=[];for(t in e){var n=e[t],n=(console.log("===ElectronManager.getDesktopSources(),source:",n),{sourceId:n.id||"",sourceName:n.name||"",thumbnail:n.thumbnail?n.thumbnail.toDataURL():""});r.push(n)}o.resolve(r)}).catch(function(e){o.reject(e)}),o.promise},t.prototype.getAllDisplays=function(){return this.remote.screen.getAllDisplays()},t.prototype.getPrimaryDisplay=function(){return this.remote.screen.getPrimaryDisplay()},t.prototype.getExternalDisplays=function(){for(var e=[],t=this.remote.screen.getAllDisplays(),r=0;r<t.length;r++){var n=t[r];0===n.bounds.x&&0===n.bounds.y||e.push(n)}return e},t.prototype.renderToDisplay=function(e,t,r,n,o,i,a,s,d,l){t=this.createWindowInner(t,r,n,o,i,a,s,d,l);return t&&!(r=this.getPeerConnectionInner(t.id))&&((r=new u).createPeerConnectionInner(),r.startInner(e.srcObject,t,this.curWindId),this.winId2PeerConnection[t.id]=r),t.id},t.prototype.cancelRenderToDisplay=function(e){var t;e&&(t=this.getPeerConnectionInner(e))&&(t.close(),t=null,delete this.winId2PeerConnection[e],this.remote.BrowserWindow.fromId(e).close())},t.prototype.getRender=function(e){e=new u(e);this.renderPeerConnection=e},t.prototype.closeRenderWindow=function(){this.remote.BrowserWindow.fromId(this.renderPeerConnection.parentWindId).webContents.send("closeWindow",this.remote.getCurrentWindow().id),this.remote.getCurrentWindow().close()},t.prototype.createWindowInner=function(e,t,r,n,o,i,a,s,d){var l=this,u=new this.BrowserWindow({x:e.bounds.x+r,y:e.bounds.y+n,webPreferences:{webSecurity:!1,nodeIntegration:"boolean"==typeof a&&a,enableRemoteModule:"boolean"==typeof s&&s,contextIsolation:"boolean"==typeof d&&d}}),c=u.id;return u.on("close",function(){l.remote.getCurrentWindow().webContents.send("closeWindow",c),u=null}),u.loadURL(t),o&&u.webContents.openDevTools(),i&&u.maximize(),u.show(),u},t.prototype.getPeerConnectionInner=function(e){return this.winId2PeerConnection[e]},t.prototype.registerElectronIPCInner=function(){var n=this,e=n.ipc;(e=12<n.mainVersion?n.ipc.ipcMain:e).once("closeWindow",function(e,t){log.debug("==closeWindow,winId:",t);var r=n.winId2PeerConnection[t];r&&(r.close(),r=null,delete n.winId2PeerConnection[t])}),e.once("remoteSDP",function(e,t,r){log.debug("===ElectronManager.registerElectronIPCInner(),remoteSDP id:",t);t=n.winId2PeerConnection[t];t&&t.setAnswerRemoteDescriptionInner(r)}),e.once("candidates",function(e,t,r){t=n.winId2PeerConnection[t];t&&(log.debug("===ElectronManager.registerElectronIPCInner(),candidates remoteCandidates:",r),t.remoteCandidates=r)})},t}),ModuleBase.define("PeerConnection",["Error"],function(e){function t(e){"undefined"!=typeof require&&(this.mainVersion=require("process").versions.electron.split(".")[0],this.remote=12<this.mainVersion?require("@electron/remote"):require("electron").remote,this.ipc=12<this.mainVersion?require("@electron/remote/renderer"):require("electron").ipcRenderer,this.curWindId=this.remote.getCurrentWindow().id),this.pc=null,this.localSDP=null,this.remoteSDP=null,this.localCandidates=[],this.remoteCandidates=null,this.renderVideoElement=e,this.parentWindId=null,this.subWin=null,this.remoteCandidatesIntervalId=null,this.ipc&&this.registerElectronIPCInner()}return t.prototype.createPeerConnectionInner=function(){var r=this,e=new RTCPeerConnection({iceServers:[],sdpSemantics:"plan-b"});(r.pc=e).onicecandidate=function(e){e.candidate?(e=JSON.stringify(e.candidate.toJSON()),r.localCandidates.push(e)):(console.debug("===electron onicecandidate(),candidates:",r.localCandidates),r.subWin?r.subWin.webContents.send("candidates",r.localCandidates):r.remote.BrowserWindow.fromId(r.parentWindId).webContents.send("candidates",r.curWindId,r.localCandidates))},e.ontrack=function(e){console.debug("===ontrack(),track: ",e.track);var t=new window.MediaStream;t.addTrack(e.track),r.renderVideoElement.srcObject=t},e.oniceconnectionstatechange=function(e){console.info("electron oniceconnectionstatechange(),  iceConnectionState :"+e.target.iceConnectionState)},e.onsignalingstatechange=function(e){console.debug("electron onsignalingstatechange(),  signalingState :"+e.target.signalingState)}},t.prototype.startInner=function(r,n,e){var o=this;o.parentWindId=e,(o.subWin=n).webContents.on("did-finish-load",function(e){var t;r&&(t=r.getVideoTracks()[0],o.pc.addTrack(t,r)),o.createOfferInner().then(function(e){o.localSDP=e.sdp,o.setLocalDescriptionInner(e).then(function(){n.webContents.send("extrnal-show",o.parentWindId,o.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createOfferInner(),error:",e)})})},t.prototype.registerElectronIPCInner=function(){var n=this;n.ipc.once("extrnal-show",function(e,t,r){n.pc||n.createPeerConnectionInner(),n.parentWindId=t,(n.remoteSDP=r)&&(t={type:"offer",sdp:n.remoteSDP},r=new RTCSessionDescription(t),n.setRemoteDescriptionInner(r).then(function(){n.createAnswerInner().then(function(e){n.localSDP=e.sdp,n.setLocalDescriptionInner(e).then(function(){n.remote.BrowserWindow.fromId(n.parentWindId).webContents.send("remoteSDP",n.curWindId,n.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createAnswerInner(),error:",e)})}).catch(function(e){console.error("electron setRemoteDescriptionInner(),error:",e)}))})},t.prototype.createOfferInner=function(){var e=this;return new Promise(function(t,r){e.pc.createOffer(function(e){console.log("===electron createOffer sessionDescription:",e),t(e)},function(e){console.error("===electron createOffer,error:",e),r(e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1})})},t.prototype.createAnswerInner=function(){var e=this;return new Promise(function(t,r){e.pc.createAnswer(function(e){console.log("===electron  createAnswer sessionDescription:",e),t(e)},function(e){console.error("===electron createAnswer,error:",e),r(e)})})},t.prototype.setLocalDescriptionInner=function(r){var n=this;return new Promise(function(e,t){console.log("===electron Local SDP:",r.sdp),n.pc.setLocalDescription(r,function(){console.debug("===electron setLocalDescription Success"),e()},function(e){console.error("===electron setLocalDescription error,error:",e),t(e)})})},t.prototype.setAnswerRemoteDescriptionInner=function(e){e=new RTCSessionDescription({type:"answer",sdp:e});this.setRemoteDescriptionInner(e).then(function(){}).catch(function(e){console.error("===electron setRemoteDescription(),error:",e)})},t.prototype.setRemoteDescriptionInner=function(r){var n=this;return new Promise(function(e,t){r.sdp=r.sdp.replace(/a=inactive/g,"a=recvonly"),"answer"==r.type&&(n.subWin?r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:active"):r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:passive")),r.sdp=r.sdp.replace(/96 97 98 99 100 101 102 122 127/g,"127 96 97 98 99 100 101 102 122"),console.log("===electron Remote  SDP:",r.sdp),n.pc.setRemoteDescription(r,function(){console.debug("===electron setRemoteDescription Success"),n.addIceCandidateInner(),e()},function(e){console.error("===electron setRemoteDescription error,error:",e),t(e)})})},t.prototype.addIceCandidateInner=function(){var e=this;e.remoteCandidates?e.addIceCandidateHandleInner():e.remoteCandidatesIntervalId=setInterval(function(){e.remoteCandidates&&(e.addIceCandidateHandleInner(),null!=e.remoteCandidatesIntervalId)&&(clearInterval(e.remoteCandidatesIntervalId),e.remoteCandidatesIntervalId=null)},500)},t.prototype.addIceCandidateHandleInner=function(){var e,t;for(e in this.remoteCandidates)this.remoteCandidates.hasOwnProperty(e)&&(t=JSON.parse(this.remoteCandidates[e]),this.pc.addIceCandidate(t,function(){console.log("===electron addIceCandidate Success")},function(e){console.error("===electron addIceCandidate error:",e)}))},t.prototype.close=function(){this.pc&&"closed"!=this.pc.signalingState&&this.pc.close()},t}),ModuleBase.define("RtmManager",["RtmMessageManager","Error"],function(a,s){function e(e,t,r){this.mqttWSAddr=e,this.account=t,this.password=r}return e.prototype.connect=function(){var t=when.defer();try{var r=document.location.protocol,e=("http:"!=(r="httpsionic:"==r?"https:":r)&&"https:"!=r&&"httpsionic:"!=r&&(r="http:"),avdEngineHandle&&avdEngineHandle.applyToElectron&&(r=avdEngineHandle.electronProtocol),"ws://"),n=(e="https:"==r?"wss://":e)+this.mqttWSAddr,o=(log.debug("===mqtt webSocket URL:"+n),{clientId:this.account,username:this.account,password:this.password}),i=mqtt.connect(n,o);console.log("===client:",i),i.on("connect",function(){console.log("mqtt connect success!"),t.resolve(i)}),i.on("error",function(e){console.log("mqtt connect error:",e);e=new s(e.code,e.message);i.end(),t.reject(e)}),i.on("message",function(e,t){console.log([e,t]),(new a).OnWebSocketMessage(e,t)})}catch(e){log.info("MQTT  Operation  failed. with exception:"+e);r=new s(ErrorConstant.websock_catch_exception);t.reject(r)}return t.promise},e}),ModuleBase.define("RtmMessageManager",["Error"],function(e){function t(){}return t.prototype.OnWebSocketMessage=function(e,t){log.info("===RtmMessageManager.OnWebSocketMessage(),topic:"+e);var r=arrayUtil.contains(signalClient.topicReservedWords,e);if(log.info("===RtmMessageManager.OnWebSocketMessage(),isExit:"+r),r){var r=signalClient.rtmServer.rtmProtobufCoded.decodePacket(t),n=(console.log("===RtmMessageManager.OnWebSocketMessage(),signalHeader:",r),r.group_type),o=r.cmd_type,i=r.content,a=r.from,s=r.to,r=signalClient.rtmServer.signalGroupTypeEnum,d=signalClient.rtmServer.signalCmdTypeEnum;switch(n){case r.SIGNALE_GROUP_TYPE_INVITE:switch(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_INVITE"),o){case d.SIGNALE_CMD_TYPE_INVITE:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE");var l=signalClient.rtmServer.rtmProtobufCoded.decodeInvite(i);console.log("===RtmMessageManager.OnWebSocketMessage(),invite:",l),signalClient.inviteManager.emitCallNotify(l.id,a,s,l.options);break;case d.SIGNALE_CMD_TYPE_INVITE_CANCEL:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_CANCEL");var u=signalClient.rtmServer.rtmProtobufCoded.decodeInviteCancel(i);console.log("===RtmMessageManager.OnWebSocketMessage(),decodeInviteCancel:",u),(l=signalClient.inviteManager.getInvite(u.id)).emitCallCancelNotify();break;case d.SIGNALE_CMD_TYPE_INVITE_RINGING:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_RINGING");u=signalClient.rtmServer.rtmProtobufCoded.decodeInviteRinging(i);console.log("===RtmMessageManager.OnWebSocketMessage(),decodeInviteRinging:",u),(l=signalClient.inviteManager.getInvite(u.id)).emitCallRingingNotify();break;case d.SIGNALE_CMD_TYPE_INVITE_OK:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_OK");u=signalClient.rtmServer.rtmProtobufCoded.decodeInviteOk(i);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteOk:",u),(l=signalClient.inviteManager.getInvite(u.id)).emitCallAcceptNotify(l.options);break;case d.SIGNALE_CMD_TYPE_INVITE_REJECT:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_REJECT");u=signalClient.rtmServer.rtmProtobufCoded.decodeInviteReject(i);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteReject:",u),(l=signalClient.inviteManager.getInvite(u.id)).emitCallRejectNotify(u.reson);break;case d.SIGNALE_CMD_TYPE_INVITE_BYE:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_BYE");u=signalClient.rtmServer.rtmProtobufCoded.decodeInviteBye(i);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteBye:",u),(l=signalClient.inviteManager.getInvite(u.id)).emitCallCloseNotify(u.reson)}break;case r.SIGNALE_GROUP_TYPE_REMOTE_CONTROL:switch(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_REMOTE_CONTROL"),o){case d.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS");var c=signalClient.rtmServer.rtmProtobufCoded.decodeMouseEvents(i);console.log("===RtmMessageManager.OnWebSocketMessage(),mouseEvents:",c),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendMouseMessage(c.eventsType,c.video_x,c.video_y,c.video_w,c.video_h);break;case d.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS");c=signalClient.rtmServer.rtmProtobufCoded.decodeKeyBoardEvents(i);console.log("===RtmMessageManager.OnWebSocketMessage(),keyBoardEvents:",c),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendKeyboardMessage(c.eventsType,c.keyc,c.keyv)}break;case r.SIGNALE_GROUP_TYPE_MESSAGE:if(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_MESSAGE"),o===d.SIGNALE_CMD_TYPE_MESSAGE_DATA){if(a==signalClient.selfUser.userId)return;var p=signalClient.rtmServer.rtmProtobufCoded.decodeMsgData(i);console.log("===RtmMessageManager.OnWebSocketMessage(),msgData:",p),signalClient.chatManager.emitReceiveMessageNotify(a,p.msg_id,p.session_type,p.session_id,p.create_time,p.msg_type,p.msg_content.toArrayBuffer())}break;case r.SIGNALE_GROUP_TYPE_RPC:switch(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_RPC"),o){case d.SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE:var h=signalClient.rtmServer.rtmProtobufCoded.decodeRpcCallResponse(i);console.log("===RtmMessageManager.OnWebSocketMessage(),rpcCallResponse:",h),h&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+h.id,h.id,h.rpc_data);break;case d.SIGNALE_CMD_TYPE_RPC_NOTIFICATION:h=signalClient.rtmServer.rtmProtobufCoded.decodeRpcNotification(i);console.log("===RtmMessageManager.OnWebSocketMessage(),rpcNotification:",h),h&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.RPC_NOTIFICATION,h.rpc_data)}}}else log.info("===RtmMessageManager.OnWebSocketMessage(),Native payload"),n=new Uint8Array(t),r=typeConversionUtil.Uint8ArrayToString(n),signalClient.eventEmitter.emit(signalClient.ClientCallbackEnum.NATIVE_PAYLOAD_NOTIFY,e,r)},t}),ModuleBase.define("RtmServer",["RtmProtobufCoded","Error"],function(t,s){function e(e){this.signalingChannel=e,this.rtmProtobufCoded=new t,this.signalGroupTypeEnum=this.rtmProtobufCoded.getSignalGroupTypeEnum(),this.signalCmdTypeEnum=this.rtmProtobufCoded.getSignalCmdTypeEnum(),this.mouseEventsTypeEnum=this.rtmProtobufCoded.getMouseEventsTypeEnum(),this.keyboardEventsTypeEnum=this.rtmProtobufCoded.getKeyboardEventsTypeEnum(),this.keyboardVKTypeEnum=this.rtmProtobufCoded.getKeyboardVKTypeEnum()}return e.prototype.publish=function(e,t){log.debug("===RtmServer.publish(),topic:"+e),this.signalingChannel&&this.signalingChannel.publish(e,t)},e.prototype.subscribe=function(e){log.info("===RtmServer.subscribe(),topic:"+e),this.signalingChannel&&this.signalingChannel.subscribe(e)},e.prototype.unsubscribe=function(e){log.info("===RtmServer.unsubscribe(),topic:"+e),this.signalingChannel&&this.signalingChannel.unsubscribe(e)},e.prototype.end=function(){log.debug("===RtmServer.end()"),this.signalingChannel&&this.signalingChannel.end()},e.prototype.sendInviteCall=function(e,t,r,n){log.debug("===RtmServer.sendInviteCall()");var o=when.defer();try{var i="/u/"+r,a="",s=(n&&(a=JSON.stringify(n)),this.rtmProtobufCoded.newInvite(e,a)),d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE,t,r,s),l=(log.info("===RtmServer.sendInviteCall(),headerBuffer:"+d),new Uint8Array(d));this.publish(i,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteCancel=function(e,t,r){log.debug("===RtmServer.sendInviteCancel()");var n=when.defer();try{var o="/u/"+r,i=this.rtmProtobufCoded.newInviteCancel(e),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_CANCEL,t,r,i),s=(log.info("===RtmServer.sendInviteCancel(),headerBuffer:"+a),new Uint8Array(a));this.publish(o,s),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteRinging=function(e,t,r){log.debug("===RtmServer.sendInviteRinging()");var n=when.defer();try{var o="/u/"+r,i=this.rtmProtobufCoded.newInviteRinging(e),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_RINGING,t,r,i),s=(log.info("===rtmServer.sendInviteRinging(),headerBuffer:",a),new Uint8Array(a));this.publish(o,s),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteAccept=function(e,t,r,n){log.debug("===RtmServer.sendInviteAccept()");var o=when.defer();try{var i="/u/"+r,a="",s=(n&&(a=JSON.stringify(n)),this.rtmProtobufCoded.newInviteOk(e,a)),d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_OK,t,r,s),l=(log.info("===RtmServer.sendInviteAccept(),headerBuffer:"+d),new Uint8Array(d));this.publish(i,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteReject=function(e,t,r,n){log.debug("===RtmServer.sendInviteReject()");var o=when.defer();try{var i="/u/"+r,a=this.rtmProtobufCoded.newInviteReject(e,n),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_REJECT,t,r,a),d=(log.info("===RtmServer.sendInviteReject(),headerBuffer:"+s),new Uint8Array(s));this.publish(i,d),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteClose=function(e,t,r,n){log.debug("===RtmServer.sendInviteClose()");var o=when.defer();try{var i="/u/"+r,a=this.rtmProtobufCoded.newInviteBye(e,n),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_BYE,t,r,a),d=(log.info("===RtmServer.sendInviteClose(),headerBuffer:"+s),new Uint8Array(s));this.publish(i,d),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendMouseMessage=function(e,t,r,n,o,i,a,s){log.debug("===RtmServer.sendMouseMessage()");var d=when.defer();try{var l="/u/"+r,u=this.rtmProtobufCoded.newMouseEvents(e,o,i,a,s,n),c=(log.debug("===RtmServer.sendMouseMessage(),mouseEvents:"+u),this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS,t,r,u)),p=(log.debug("===RtmServer.sendMouseMessage(),headerBuffer:",c),new Uint8Array(c));this.publish(l,p),d.resolve()}catch(e){d.reject(e)}return d.promise},e.prototype.sendKeyboardMessage=function(e,t,r,n,o,i){log.debug("===RtmServer.sendKeyboardMessage()");var a=when.defer();try{var s="/u/"+r,d=this.rtmProtobufCoded.newKeyBoardEvents(e,o,i,n),l=(log.info("===RtmServer.sendKeyboardMessage(),keyBoardEvents:"+d),this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS,t,r,d)),u=(log.info("===RtmServer.sendKeyboardMessage(),headerBuffer:"+l),new Uint8Array(l));this.publish(s,u),a.resolve()}catch(e){a.reject(e)}return a.promise},e.prototype.sendMsgData=function(e,t){log.debug("===RtmServer.sendMsgData()");var r=when.defer();try{var n=typeConversionUtil.stringToUint8Array(t.content),o=this.rtmProtobufCoded.newMsgData(t.messageId,t.sessionType,t.sessionId,t.createTime,t.messageType,n),i=(log.info("===RtmServer.sendMsgData(),msgData:",o),this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_MESSAGE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_MESSAGE_DATA,t.sendUserId,t.sessionId,o)),a=(log.info("===RtmServer.sendMsgData(),headerBuffer:",i),new Uint8Array(i));this.publish(e,a),r.resolve()}catch(e){r.reject(e)}return r.promise},e.prototype.sendRpcCall=function(e,t,r,n){log.debug("===RtmServer.sendRpcCall()");var o=when.defer(),i=++Task_Id,n=JSON.stringify(n),n=this.rtmProtobufCoded.newRpcCallRequest(i,n),e=(log.info("===RtmServer.sendRpcCall(),rpcCallRequest:",n),this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_CALL_REQUEST,e,t,n)),t=(log.info("===RtmServer.sendMsgData(),headerBuffer:",e),new Uint8Array(e)),a=(this.publish(r,t),setTimeout(function(){var e=new s(1e4,"sendRpcCall time out");o.reject(e)},5e3));return signalClient.rpcManager.addCallback(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i,function(e,t){log.info("===RtmServer.sendRpcCall().addCallback(),id:",e,"parameters:",t),e==i&&(signalClient.rpcManager.offCallback([signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i]),o.resolve(t),clearTimeout(a))}),o.promise},e.prototype.sendRpcNotification=function(e,t,r,n){log.debug("===RtmServer.sendRpcNotification()");var o=when.defer();try{var i=++Task_Id,a=JSON.stringify(n),s=this.rtmProtobufCoded.newRpcNotification(i,a),d=(log.info("====RtmServer.sendRpcNotification(),rpcNotification:",s),this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_NOTIFICATION,e,t,s)),l=(log.info("===RtmServer.sendRpcNotification(),headerBuffer:",d),new Uint8Array(d));this.publish(r,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e}),ModuleBase.define("RtmProtobufCoded",[],function(){function e(){s=rtmBuilder.signal_pdu}var s;return e.prototype.getSignalGroupTypeEnum=function(){return s.signal_group_type},e.prototype.getSignalCmdTypeEnum=function(){return s.signal_cmd_type},e.prototype.getMouseEventsTypeEnum=function(){return s.mouse_events_type},e.prototype.getKeyboardEventsTypeEnum=function(){return s.keyboard_events_type},e.prototype.getKeyboardVKTypeEnum=function(){return s.keybaord_vk_type},e.prototype.getSessionTypeEnum=function(){return s.SessionType},e.prototype.getMsgTypeEnum=function(){return s.MsgType},e.prototype.getMsgStatusEnum=function(){return s.MsgStatus},e.prototype.encodedHeader=function(e,t,r,n,o){var i=null,o=(null!=o&&(i=o.toArrayBuffer()),Math.round((new Date).getTime()/1e3)),e=this.newSignalHeader("1.0",e,t,o,r,n,i);return console.log("===encodedHeader(),signalHeader:",e),e.toArrayBuffer()},e.prototype.newSignalHeader=function(e,t,r,n,o,i,a){return new s.signal_header(e,t,r,n,o,i,a)},e.prototype.newInvite=function(e,t){return new s.Invite(e,t)},e.prototype.newInviteCancel=function(e){return new s.InviteCancel(e)},e.prototype.newInviteRinging=function(e){return new s.InviteRinging(e)},e.prototype.newInviteOk=function(e,t){return new s.InviteOk(e,t)},e.prototype.newInviteReject=function(e,t){return new s.InviteReject(e,t)},e.prototype.newInviteBye=function(e,t){return new s.InviteBye(e,t)},e.prototype.newMouseEvents=function(e,t,r,n,o,i){return new s.MouseEvents(e,t,r,n,o,i)},e.prototype.newKeyBoardEvents=function(e,t,r,n){return new s.KeyBoardEvents(e,t,r,n)},e.prototype.newMsgData=function(e,t,r,n,o,i){return new s.MsgData(e,t,r,n,o,i)},e.prototype.newMsgDataDelivered=function(e,t,r){return new s.MsgDataDelivered(e,t,r)},e.prototype.newMsgDataRead=function(e,t,r){return new s.MsgDataRead(e,t,r)},e.prototype.newMsgDataRecalled=function(e,t,r){return new s.MsgDataRecalled(e,t,r)},e.prototype.newRpcCallRequest=function(e,t){return new s.RpcCallRequest(e,t)},e.prototype.newRpcNotification=function(e,t){return new s.RpcNotification(e,t)},e.prototype.decodePacket=function(e){return s.signal_header.decode(e)},e.prototype.decodeInvite=function(e){return s.Invite.decode(e)},e.prototype.decodeInviteCancel=function(e){return s.InviteCancel.decode(e)},e.prototype.decodeInviteRinging=function(e){return s.InviteRinging.decode(e)},e.prototype.decodeInviteOk=function(e){return s.InviteOk.decode(e)},e.prototype.decodeInviteReject=function(e){return s.InviteReject.decode(e)},e.prototype.decodeInviteBye=function(e){return s.InviteBye.decode(e)},e.prototype.decodeMouseEvents=function(e){return s.MouseEvents.decode(e)},e.prototype.decodeKeyBoardEvents=function(e){return s.KeyBoardEvents.decode(e)},e.prototype.decodeMsgData=function(e){return s.MsgData.decode(e)},e.prototype.decodeRpcCallResponse=function(e){return s.RpcCallResponse.decode(e)},e.prototype.decodeRpcNotification=function(e){return s.RpcNotification.decode(e)},e}),ModuleBase.define("ClientUser",["Error"],function(e){return function(e,t){this.userId=e,this.account=e,this.password=t,this.userName}}),ModuleBase.define("InviteManager",["Invite","Error"],function(i,e){function t(){this.InviteManagerCallbackEnum={CALL_NOTIFY:"call.notify"},this.invites={},this.eventEmitter=new EventEmitter}return t.prototype.createInvite=function(e,t,r){e=new i(e,t,r);return this.invites[e.inviteId]=e},t.prototype.getInvite=function(e){return this.invites[e]},t.prototype.call=function(e){var t=when.defer();return e.callInner().then(function(){log.debug("===InviteManager.call(),success"),t.resolve()}).otherwise(function(e){log.debug("===InviteManager.call(),error:",e),t.reject(e)}),t.promise},t.prototype.emitCallNotify=function(e,t,r,n){var o=null,n=(n&&(o=JSON.parse(n)),new i(r,t,o));n.inviteId=e,(this.invites[n.inviteId]=n).onCallTimeOutInner(),this.eventEmitter.emit(this.InviteManagerCallbackEnum.CALL_NOTIFY,n)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("Invite",["Error"],function(e){function t(e,t,r){this.InviteCallbackEnum={CALL_ACCEPT_NOTIFY:"call.accept.notify",CALL_REJECT_NOTIFY:"call.reject.notify",CALL_TIMEOUT_NOTIFY:"call.timeout.notify",CALL_RINGING_NOTIFY:"call.ringing.notify",CALL_CANCEL_NOTIFY:"call.cancel.notify",RESPONSE_CALL_TIMEOUT_NOTIFY:"response.call.timeout.notify",CALL_CLOSE_NOTIFY:"call.close.notify"},this.eventEmitter=new EventEmitter,this.inviteId=++Task_Id,this.fromUserId=e,this.toUserId=t,this.options=r,this.callTimeout=6e4,this.callBaseTime=null,this.callTimeoutIntervalId=null,this.onCallTimeout=55e3,this.onCallBaseTime=null,this.onCallTimeoutIntervalId=null}return t.prototype.callInner=function(){console.debug("===invite.callInner()");var e=this,t=(null==e.callBaseTime&&(e.callBaseTime=new Date),e.callTimeoutIntervalId=setInterval(function(){new Date-e.callBaseTime>=e.callTimeout&&(e.clearanceInner(),e.eventEmitter.emit(e.InviteCallbackEnum.CALL_TIMEOUT_NOTIFY,e.toUserId))},500),when.defer());return signalClient.rtmServer.sendInviteCall(e.inviteId,e.fromUserId,e.toUserId,e.options).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.onCallTimeOutInner=function(){console.debug("===invite.onCallTimeOutInner()");var e=this;null==e.onCallBaseTime&&(e.onCallBaseTime=new Date),e.onCallTimeoutIntervalId=setInterval(function(){new Date-e.onCallBaseTime>=e.onCallTimeout&&(e.clearanceInnerOnCall(),e.eventEmitter.emit(e.InviteCallbackEnum.RESPONSE_CALL_TIMEOUT_NOTIFY,e.fromUserId))},500)},t.prototype.clearanceInner=function(){clearInterval(this.callTimeoutIntervalId),this.callTimeoutIntervalId=null,this.callBaseTime=null},t.prototype.clearanceInnerOnCall=function(){clearInterval(this.onCallTimeoutIntervalId),this.onCallTimeoutIntervalId=null,this.onCallBaseTime=null},t.prototype.cancel=function(){var t=when.defer(),e=this;return signalClient.rtmServer.sendInviteCancel(e.inviteId,e.fromUserId,e.toUserId).then(function(){e.clearanceInner(),t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.ringing=function(){var t=when.defer();return signalClient.rtmServer.sendInviteRinging(this.inviteId,this.fromUserId,this.toUserId).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.accept=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteAccept(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.reject=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteReject(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.close=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteClose(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInner(),t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.emitCallCancelNotify=function(){this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CANCEL_NOTIFY,this.toUserId)},t.prototype.emitCallRingingNotify=function(){this.callBaseTime=new Date,this.eventEmitter.emit(this.InviteCallbackEnum.CALL_RINGING_NOTIFY,this.toUserId)},t.prototype.emitCallAcceptNotify=function(e){console.log("options: ",e),this.clearanceInner();var t=null;e&&(t=JSON.parse(JSON.stringify(e))),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_ACCEPT_NOTIFY,this.toUserId,t)},t.prototype.emitCallRejectNotify=function(e){this.clearanceInner(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_REJECT_NOTIFY,this.toUserId,e)},t.prototype.emitCallCloseNotify=function(e){this.clearanceInner(),this.clearanceInnerOnCall(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CLOSE_NOTIFY,this.toUserId,e)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("RemoteControlManager",["Error"],function(e){function t(){this.MouseEventsTypeEnum={WM_MOUSEMOVE:512,WM_LBUTTONDOWN:513,WM_LBUTTONUP:514,WM_LBUTTONDBLCLK:515,WM_RBUTTONDOWN:516,WM_RBUTTONUP:517,WM_RBUTTONDBLCLK:518,WM_MBUTTONDOWN:519,WM_MBUTTONUP:520,WM_MBUTTONDBLCLK:521,WM_MOUSEWHEEL:522},this.KeyboardEventsTypeEnum={WM_KEYDOWN:256,WM_KEYUP:257,WM_CHAR:258},this.KeyboardVKTypeEnum={VK_BACK:8,VK_TAB:9,VK_SHIFT:16,VK_CONTROL:17,VK_MENU:18,VK_PAUSE:19,VK_CAPITAL:20,VK_KANA:21,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_ESCAPE:27,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SPACE:32,VK_PRIOR:33,VK_NEXT:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SNAPSHOT:44,VK_INSERT:45,VK_DELETE:46,VK_HELP:47},this.RemoteControlManagerCallbackEnum={MOUSE_EVENTS_NOTIFY:"mouse.events.notify",KEYBOARD_EVENTS_NOTIFY:"KeyBoard.events.notify"},this.fromUserId="",this.toUserId="",this.baseRemotectrl=null,this.sendMouseMoveMessageInterval=200,this.sendMouseMoveMessageLastTime=null}return t.prototype.setSendMouseMoveMessageInterval=function(e){console.log("===RemoteControlManager.setSendMouseMoveMessageInterval(),sendMouseMoveMessageInterval:"+e),this.sendMouseMoveMessageInterval=e},t.prototype.setBaseRemotectrl=function(e){this.baseRemotectrl=e},t.prototype.setFromUserAndToUser=function(e,t){this.fromUserId=e,this.toUserId=t},t.prototype.sendMouseMessage=function(e,t,r,n,o){var i=this,a=when.defer(),s=++Task_Id;if(e==i.MouseEventsTypeEnum.WM_MOUSEMOVE&&i.sendMouseMoveMessageLastTime&&(new Date).getTime()-i.sendMouseMoveMessageLastTime<i.sendMouseMoveMessageInterval)return;return signalClient.rtmServer.sendMouseMessage(s,i.fromUserId,i.toUserId,e,t,r,n,o).then(function(){e==i.MouseEventsTypeEnum.WM_MOUSEMOVE&&(i.sendMouseMessageLastTime=(new Date).getTime()),a.resolve()}).otherwise(function(e){a.reject(e)}),a.promise},t.prototype.sendKeyboardMessage=function(e,t,r){var n=++Task_Id,o=when.defer();return signalClient.rtmServer.sendKeyboardMessage(n,this.fromUserId,this.toUserId,e,t,r).then(function(){o.resolve()}).otherwise(function(e){o.reject(e)}),o.promise},t}),ModuleBase.define("ChatManager",["Message","Error"],function(s,e){function t(){this.ChatManagerCallbackEnum={RECEIVE_MESSAGE_NOTIFY:"receive.message.notify",MESSAGE_STATUS_CHANGED_NOTIFY:"message.status.changed.notify"},this.SessionTypeEnum={peers:1,group:2,chatroom:3},this.MessageTypeEnum={text:1,image:2,file:3,audio:4,video:5,location:6},this.MessageStatussEnum={delivering:1,delivered:2,read:3,failed:4,recalled:5},this.eventEmitter=new EventEmitter}return t.prototype.registerGroups=function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t];signalClient.rtmServer.subscribe("/g/"+r)}},t.prototype.unregisterGroup=function(e){e&&signalClient.rtmServer.unsubscribe("/g/"+e)},t.prototype.newTextMessage=function(e,t,r){var n=Math.uuid(),n=new s(n,e,t);return n.sendUserId=signalClient.selfUser.userId,n.messageType=this.MessageTypeEnum.text,n.content=r,n.createTime=signalClient.getServeTime(),n.status=this.MessageStatussEnum.delivering,n},t.prototype.sendMessage=function(e){var t=when.defer(),r="/u/"+e.sessionId;return e.sessionType!=this.SessionTypeEnum.peers&&(r="/g/"+e.sessionId),signalClient.rtmServer.sendMsgData(r,e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.emitReceiveMessageNotify=function(e,t,r,n,o,i,a){t=new s(t,r,n),t.sendUserId=e,t.messageType=i,r=new Uint8Array(a);t.content=typeConversionUtil.Uint8ArrayToString(r),t.createTime=o,t.status=this.MessageStatussEnum.delivered,this.eventEmitter.emit(this.ChatManagerCallbackEnum.RECEIVE_MESSAGE_NOTIFY,t)},t.prototype.sendImageMessage=function(e,t,r,n){},t.prototype.sendFileMessage=function(e,t,r,n){},t.prototype.sendAudioMessage=function(e,t,r,n){},t.prototype.readMessage=function(e){},t.prototype.recallMessage=function(e){},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t.prototype.offCallback=function(e){for(var t in e){t=e[t];this.eventEmitter.off(t)}},t}),ModuleBase.define("Message",["Error"],function(e){return function(e,t,r){this.messageId=e,this.sessionType=t,this.sessionId=r,this.sendUserId=null,this.messageType=null,this.content=null,this.createTime=null,this.status=null}}),ModuleBase.define("RpcManager",["Error"],function(n){function e(){this.RpcManagerCallbackEnum={CALL_RESPONSE_SUCCESS:"call.response.success",CALL_RESPONSE_ERROR:"call.response.error",RPC_NOTIFICATION:"rpc.notification"},this.eventEmitter=new EventEmitter}return e.prototype.call=function(e){var r=when.defer(),t=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcCall(t,"root","/s",e).then(function(e){console.log("===RpcManager.call(),result rpcData:",e);var t,e=JSON.parse(e);console.log("===RpcManager.call(),result Json:",e),e.error?(t=new n(e.error.code,e.error.message),r.reject(t)):r.resolve(e.result)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.notification=function(e){var t=when.defer(),r=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcNotification(r,"root","/s",e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},e.prototype.offCallback=function(e){for(var t in e){t=e[t];this.eventEmitter.removeAllListeners(t)}},e}),log=log||log4javascript.getLogger();var bugout,bugout=bugout||null,signalClient=null,Task_Id=0,rtmVersion="1.0.0.0";ModuleBase.define("Client",["RestServer","RtmManager","RtmServer","ClientUser","InviteManager","RemoteControlManager","ChatManager","RpcManager","Error"],function(r,i,a,s,e,t,n,o,d){function l(e,t){this.ClientCallbackEnum={NATIVE_PAYLOAD_NOTIFY:"native.payload"},this.serverURI=e,this.accessToken=t,this.mqttWSAddr=null,this.restServer=new r,this.rtmManager=null,this.rtmServer=null,this.inviteManager=null,this.remoteControlManager=null,this.chatManager=null,this.rpcManager=null,this.selfUser=null,this.eventEmitter=new EventEmitter,this.topicReservedWords=["/u/","/g/","/s"],signalClient=this}return l.prototype.getVersion=function(){return"rtm-"+rtmVersion},l.prototype.setLog=function(e,t){var r;e==Appender.alert?r=new log4javascript.AlertAppender:e==Appender.inpage?r=new log4javascript.InPageAppender:e==Appender.popup?r=new log4javascript.PopUpAppender:e==Appender.browserConsole&&(r=new log4javascript.BrowserConsoleAppender),t==LogLevel.all?r.setThreshold(log4javascript.Level.ALL):t==LogLevel.trace?r.setThreshold(log4javascript.Level.TRACE):t==LogLevel.debug?r.setThreshold(log4javascript.Level.DEBUG):t==LogLevel.info?r.setThreshold(log4javascript.Level.INFO):t==LogLevel.warn?r.setThreshold(log4javascript.Level.WARN):t==LogLevel.error?r.setThreshold(log4javascript.Level.ERROR):t==LogLevel.fatal?r.setThreshold(log4javascript.Level.FATAL):t==LogLevel.off&&r.setThreshold(log4javascript.Level.OFF),e=r,t=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n"),e.setLayout(t),log.addAppender(e)},l.prototype.login=function(t,r){var n=when.defer(),o=this;return o.restServer.getMqttWSAddr(o.serverURI,o.accessToken).then(function(e){log.info("===client.login(),restServer.getMqttWSAddr(), mqttWSAddr:",e),o.mqttWSAddr=e,o.rtmManager=new i(o.mqttWSAddr,t,r),o.rtmManager.connect().then(function(e){signalClient.rtmServer=new a(e),signalClient.rtmServer.subscribe("/u/"+t);e=new s(t,r);o.selfUser=e,n.resolve()}).otherwise(function(e){n.reject(e)})}).otherwise(function(e){log.error("===client.login(),error:",e),n.reject(e)}),n.promise},l.prototype.logout=function(e){var t=when.defer();try{this.rtmServer.end(),signalClient=null,this.selfUser=null,t.resolve()}catch(e){t.reject(e)}return t.promise},l.prototype.getInviteManager=function(){return this.inviteManager||(this.inviteManager=new e),this.inviteManager},l.prototype.getRemoteControlManager=function(){return this.remoteControlManager||(this.remoteControlManager=new t),this.remoteControlManager},l.prototype.getChatManager=function(){return this.chatManager||(this.chatManager=new n),this.chatManager},l.prototype.getRpcManager=function(){return this.rpcManager||(this.rpcManager=new o),this.rpcManager},l.prototype.getServeTime=function(){var e=new Date,e=(e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e.getTime());return Math.round(e/1e3)},l.prototype.nativePublish=function(e,t){var r,n=when.defer();return arrayUtil.contains(this.topicReservedWords,e)?(r=new d(ErrorConstant.mqtt_topic_reservedword_error),n.reject(r)):(this.rtmServer.publish(e,t),n.resolve()),n.promise},l.prototype.nativeSubscribe=function(e){var t,r=when.defer();return arrayUtil.contains(this.topicReservedWords,e)?(t=new d(ErrorConstant.mqtt_topic_reservedword_error),r.reject(t)):(this.rtmServer.subscribe(e),r.resolve()),r.promise},l.prototype.getTopicReservedWords=function(){return this.topicReservedWords},l.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},l.prototype.offCallback=function(e){for(var t in e){t=e[t];this.eventEmitter.off(t)}},l}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.axios=t():e.axios=t()}(this,function(){return n=[function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(e){var e=new a(e),t=i(a.prototype.request,e);return o.extend(t,a.prototype,e),o.extend(t,e),t}var o=r(2),i=r(3),a=r(4),s=r(5),d=n(s);d.Axios=a,d.create=function(e){return n(o.merge(s,e))},d.Cancel=r(22),d.CancelToken=r(23),d.isCancel=r(19),d.all=function(e){return Promise.all(e)},d.spread=r(24),e.exports=d,e.exports.default=d},function(e,t,r){"use strict";function i(e){return"[object Array]"===d.call(e)}function n(e){return null!==e&&"object"==typeof e}function o(e){return"[object Function]"===d.call(e)}function a(e,t){if(null!=e)if("object"==typeof e||i(e)||(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var s=r(3),d=Object.prototype.toString;e.exports={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===d.call(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:n,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===d.call(e)},isFile:function(e){return"[object File]"===d.call(e)},isBlob:function(e){return"[object Blob]"===d.call(e)},isFunction:o,isStream:function(e){return n(e)&&o(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement},forEach:a,merge:function r(){function e(e,t){n[t]="object"==typeof n[t]&&"object"==typeof e?r(n[t],e):e}for(var n={},t=0,o=arguments.length;t<o;t++)a(arguments[t],e);return n},extend:function(r,e,n){return a(e,function(e,t){r[t]=n&&"function"==typeof e?s(e,n):e}),r},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){"use strict";e.exports=function(r,n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}}},function(e,t,r){"use strict";function o(e){this.defaults=e,this.interceptors={request:new a,response:new a}}var n=r(5),i=r(2),a=r(16),s=r(17),d=r(20),l=r(21);o.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(n,this.defaults,{method:"get"},e)).baseURL&&!d(e.url)&&(e.url=l(e.baseURL,e.url));var t=[s,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head"],function(r){o.prototype[r]=function(e,t){return this.request(i.merge(t||{},{method:r,url:e}))}}),i.forEach(["post","put","patch"],function(n){o.prototype[n]=function(e,t,r){return this.request(i.merge(r||{},{method:n,url:e,data:t}))}}),e.exports=o},function(e,t,r){"use strict";function n(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var o,i=r(2),a=r(6),s=/^\)\]\}',?\n/,d={"Content-Type":"application/x-www-form-urlencoded"},l={adapter:o="undefined"==typeof XMLHttpRequest&&"undefined"==typeof process?o:r(7),transformRequest:[function(e,t){return a(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(n(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(n(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e){e=e.replace(s,"");try{e=JSON.parse(e)}catch(e){}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};i.forEach(["delete","get","head"],function(e){l.headers[e]={}}),i.forEach(["post","put","patch"],function(e){l.headers[e]=i.merge(d)}),e.exports=l},function(e,t,r){"use strict";var o=r(2);e.exports=function(r,n){o.forEach(r,function(e,t){t!==n&&t.toUpperCase()===n.toUpperCase()&&(r[n]=e,delete r[t])})}},function(e,t,u){"use strict";var c=u(2),p=u(8),h=u(11),f=u(12),m=u(13),g=u(9),y="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||u(14);e.exports=function(l){return new Promise(function(t,r){var e,n,o=l.data,i=l.headers,a=(c.isFormData(o)&&delete i["Content-Type"],new XMLHttpRequest),s="onreadystatechange",d=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in a||m(l.url)||(a=new window.XDomainRequest,s="onload",d=!0,a.onprogress=function(){},a.ontimeout=function(){}),l.auth&&(e=l.auth.username||"",n=l.auth.password||"",i.Authorization="Basic "+y(e+":"+n)),a.open(l.method.toUpperCase(),h(l.url,l.params,l.paramsSerializer),!0),a.timeout=l.timeout,a[s]=function(){var e;a&&(4===a.readyState||d)&&(0!==a.status||a.responseURL&&0===a.responseURL.indexOf("file:"))&&(e="getAllResponseHeaders"in a?f(a.getAllResponseHeaders()):null,e={data:l.responseType&&"text"!==l.responseType?a.response:a.responseText,status:1223===a.status?204:a.status,statusText:1223===a.status?"No Content":a.statusText,headers:e,config:l,request:a},p(t,r,e),a=null)},a.onerror=function(){r(g("Network Error",l)),a=null},a.ontimeout=function(){r(g("timeout of "+l.timeout+"ms exceeded",l,"ECONNABORTED")),a=null},c.isStandardBrowserEnv()&&(e=u(15),n=(l.withCredentials||m(l.url))&&l.xsrfCookieName?e.read(l.xsrfCookieName):void 0)&&(i[l.xsrfHeaderName]=n),"setRequestHeader"in a&&c.forEach(i,function(e,t){void 0===o&&"content-type"===t.toLowerCase()?delete i[t]:a.setRequestHeader(t,e)}),l.withCredentials&&(a.withCredentials=!0),l.responseType)try{a.responseType=l.responseType}catch(e){if("json"!==a.responseType)throw e}"function"==typeof l.onDownloadProgress&&a.addEventListener("progress",l.onDownloadProgress),"function"==typeof l.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",l.onUploadProgress),l.cancelToken&&l.cancelToken.promise.then(function(e){a&&(a.abort(),r(e),a=null)}),void 0===o&&(o=null),a.send(o)})}},function(e,t,r){"use strict";var o=r(9);e.exports=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(o("Request failed with status code "+r.status,r.config,null,r)):e(r)}},function(e,t,r){"use strict";var o=r(10);e.exports=function(e,t,r,n){e=new Error(e);return o(e,t,r,n)}},function(e,t){"use strict";e.exports=function(e,t,r,n){return e.config=t,r&&(e.code=r),e.response=n,e}},function(e,t,r){"use strict";function o(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var i=r(2);e.exports=function(e,t,r){var n;return t&&(r=r?r(t):i.isURLSearchParams(t)?t.toString():(n=[],i.forEach(t,function(e,t){null!=e&&(i.isArray(e)&&(t+="[]"),i.isArray(e)||(e=[e]),i.forEach(e,function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),n.push(o(t)+"="+o(e))}))}),n.join("&")))&&(e+=(-1===e.indexOf("?")?"?":"&")+r),e}},function(e,t,r){"use strict";var o=r(2);e.exports=function(e){var t,r,n={};return e&&o.forEach(e.split("\n"),function(e){r=e.indexOf(":"),t=o.trim(e.substr(0,r)).toLowerCase(),r=o.trim(e.substr(r+1)),t&&(n[t]=n[t]?n[t]+", "+r:r)}),n}},function(e,t,r){"use strict";var n,o,i,a=r(2);function s(e){return n&&(o.setAttribute("href",e),e=o.href),o.setAttribute("href",e),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}e.exports=a.isStandardBrowserEnv()?(n=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a"),i=s(window.location.href),function(e){e=a.isString(e)?s(e):e;return e.protocol===i.protocol&&e.host===i.host}):function(){return!0}},function(e,t){"use strict";function s(){this.message="String contains an invalid character"}(s.prototype=new Error).code=5,s.prototype.name="InvalidCharacterError",e.exports=function(e){for(var t,r,n=String(e),o="",i=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|i)||(a="=",i%1);o+=a.charAt(63&t>>8-i%1*8)){if(255<(r=n.charCodeAt(i+=.75)))throw new s;t=t<<8|r}return o}},function(e,t,r){"use strict";var s=r(2);e.exports=s.isStandardBrowserEnv()?{write:function(e,t,r,n,o,i){var a=[];a.push(e+"="+encodeURIComponent(t)),s.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),s.isString(n)&&a.push("path="+n),s.isString(o)&&a.push("domain="+o),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";function n(){this.handlers=[]}var o=r(2);n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(t){o.forEach(this.handlers,function(e){null!==e&&t(e)})},e.exports=n},function(e,t,r){"use strict";function n(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var o=r(2),i=r(18),a=r(19),s=r(5);e.exports=function(t){return n(t),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=o.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),o.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||s.adapter)(t).then(function(e){return n(t),e.data=i(e.data,e.headers,t.transformResponse),e},function(e){return a(e)||(n(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(e,t,r){"use strict";var n=r(2);e.exports=function(t,r,e){return n.forEach(e,function(e){t=e(t,r)}),t}},function(e,t){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){"use strict";e.exports=function(e,t){return e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}},function(e,t){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t,r){"use strict";function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});var t,r=this;e(function(e){r.reason||(r.reason=new o(e),t(r.reason))})}var o=r(22);n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var t;return{token:new n(function(e){t=e}),cancel:t}},e.exports=n},function(e,t){"use strict";e.exports=function(t){return function(e){return t.apply(null,e)}}}],o={},r.m=n,r.c=o,r.p="",r(0);function r(e){var t;return(o[e]||(t=o[e]={exports:{},id:e,loaded:!1},n[e].call(t.exports,t,t.exports,r),t.loaded=!0,t)).exports}var n,o});