/*! rtc-4.0.7.9 2024-08-12 01:31:19 */

var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(e){var t,r,n,o,i,a;for(n=e.length,r=0,t="";r<n;){if(o=255&e.charCodeAt(r++),r==n){t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4),t+="==";break}if(i=e.charCodeAt(r++),r==n){t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2),t+="=";break}a=e.charCodeAt(r++),t+=base64EncodeChars.charAt(o>>2),t+=base64EncodeChars.charAt((3&o)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2|(192&a)>>6),t+=base64EncodeChars.charAt(63&a)}return t}function base64decode(e){var t,r,n,o,i,a,s;for(a=e.length,i=0,s="";i<a;){for(;t=base64DecodeChars[255&e.charCodeAt(i++)],i<a&&-1==t;);if(-1==t)break;for(;r=base64DecodeChars[255&e.charCodeAt(i++)],i<a&&-1==r;);if(-1==r)break;s+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(n=255&e.charCodeAt(i++)))return s;n=base64DecodeChars[n]}while(i<a&&-1==n);if(-1==n)break;s+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(o=255&e.charCodeAt(i++)))return s;o=base64DecodeChars[o]}while(i<a&&-1==o);if(-1==o)break;s+=String.fromCharCode((3&n)<<6|o)}return s}function utf16to8(e){var t,r,n,o;for(t="",n=e.length,r=0;r<n;r++)1<=(o=e.charCodeAt(r))&&o<=127?t+=e.charAt(r):(2047<o?(t+=String.fromCharCode(224|o>>12&15),t+=String.fromCharCode(128|o>>6&63)):t+=String.fromCharCode(192|o>>6&31),t+=String.fromCharCode(128|o>>0&63));return t}function utf8to16(e){var t,r,n,o,i,a;for(t="",n=e.length,r=0;r<n;)switch((o=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:i=e.charCodeAt(r++),t+=String.fromCharCode((31&o)<<6|63&i);break;case 14:i=e.charCodeAt(r++),a=e.charCodeAt(r++),t+=String.fromCharCode((15&o)<<12|(63&i)<<6|(63&a)<<0)}return t}function doit(){var e=document.f;e.output.value=base64encode(utf16to8(e.source.value)),e.decode.value=utf8to16(base64decode(e.output.value))}function SdpSerializer(e){for(var u={},o=[],t=!1,r=!1,n=!1,i=!1,a=e.split("\r\n"),s=0;s<a.length;s++){var d=a[s];t||0==d.indexOf("m=audio")?(t=!0,l("audio"),(d=a[s+1])&&0==d.indexOf("m=video")&&(i=t=!1)):r||0==d.indexOf("m=video")?(r=!0,l("video"),(d=a[s+1])&&0==d.indexOf("m=application")&&(i=r=!1)):n||0==d.indexOf("m=application")?(n=!0,l("data")):o.push(d)}function l(t){if(u[t])if(d=="a=mid:"+t){var e=a[s-1];e&&(u[t].direction=e.split("a=")[1],u[t].attributes.pop(1)),i=!0,u[t]["a=mid:"+t]={line:d,attributes:[]}}else if(i)if(0==d.indexOf("a=crypto:"))u[t].crypto[d.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=d;else if(0==d.indexOf("a=rtpmap:")){var r=d.split("a=rtpmap:")[1].split(" ");u[t].payload[r[0]]=r[1],function e(){(d=a[s+1])&&-1==d.indexOf("a=rtpmap:")&&-1==d.indexOf("m=")&&(-1!=d.indexOf("a=ssrc")&&u[t].ssrc.push(d),-1==d.indexOf("a=ssrc")&&(u[t].payload[r[0]]+="\r\n"+d),s++,e())}()}else u[t]["a=mid:"+t].attributes.push(d);else u[t].attributes.push(d);else if(u[t]={line:d,attributes:[],payload:{},ssrc:[],crypto:{}},-1!=d.indexOf("RTP/SAVPF"))for(var n=d.split("RTP/SAVPF ")[1].split(" "),o=0;o<n.length;o++)u[t].payload[n[o]]=""}function c(e){if(u[e]){for(var t=[],r="",n=0;n<u[e].ssrc.length;n++){var o=u[e].ssrc[n];""==r?r=o:r+="\r\n"+o,-1==o.indexOf("cname:")&&-1==o.indexOf("a=ssrc-group:")||t.push([]),0<t.length&&t[t.length-1].push(o)}u[e].ssrc=t,u[e].ssrcStr=r}}function p(e,t){if(!u[t])return e;e+=u[t].line+"\r\n";for(var r=0;r<u[t].attributes.length;r++)e+=u[t].attributes[r]+"\r\n";u[t].direction&&(e+="a="+u[t].direction+"\r\n"),e+="a=mid:"+t+"\r\n";for(r=0;r<u[t]["a=mid:"+t].attributes.length;r++)u[t]["a=mid:"+t].attributes[r]&&(e+=u[t]["a=mid:"+t].attributes[r]+"\r\n");for(var n in u[t].crypto)e+=u[t].crypto[n]+"\r\n";if(-1!=u[t].line.indexOf("RTP/SAVPF"))for(var o=u[t].line.split("RTP/SAVPF ")[1].split(" "),i=0;i<o.length;i++){var a=o[i];a&&(e+="a=rtpmap:"+a+" "+u[t].payload[a]+"\r\n")}for(var s=0;s<u[t].ssrc.length;s++)for(var d=u[t].ssrc[s],l=0;l<d.length;l++)e+=d[l]+"\r\n";return e}function h(r){return{mLine:r,payload:function(e){return u[this.mLine]&&u[this.mLine].payload[e]||log.error(e,"doesn'nt exits."),{payload:e,mLine:this.mLine,newLine:function(e){u[this.mLine].payload[this.payload]+="\r\n"+e},remove:function(){!function(e,t){if(u[t]&&-1!=u[t].line.indexOf(e)&&(u[t].payload[e]&&delete u[t].payload[e],-1!=u[t].line.indexOf("RTP/SAVPF"))){for(var r=u[t].line.split("RTP/SAVPF ")[1].split(" "),n=0;n<r.length;n++)r[n]==e&&delete r[n];r=swap(r),u[t].line=u[t].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+r.join(" ")}}(this.payload,this.mLine)},order:function(e){!function(e,t,r){if(u[r]&&-1!=u[r].line.indexOf(e)&&-1!=u[r].line.indexOf("RTP/SAVPF")){for(var n=u[r].line.split("RTP/SAVPF ")[1].split(" "),o=[],i=0;i<n.length;i++)n[i]==e&&(o[t]=n[i],delete n[i]);for(i=0;i<n.length;i++)i<t&&(o[i]=n[i]),t<=i&&(o[i+1]=n[i]);o=swap(o),u[r].line=u[r].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+o.join(" ")}}(this.payload,e,this.mLine)}}},remove:function(){!function(e){u[e]&&delete u[e];for(var t=0;t<o.length;t++)if(-1!=o[t].indexOf("a=group")){var r=o[t].split("a=group:BUNDLE ")[1].split(" ");o[t]="a=group:BUNDLE";for(var n=0;n<r.length;n++)r[n]!=e&&(o[t]+=" "+r[n])}}(this.mLine)},isRejected:function(){var e=u[this.mLine].line.split("m="+this.mLine)[1];return 0==parseInt(e)},crypto:function(e){var t=u[this.mLine].crypto[e];return{mLine:this.mLine,remove:function(){t&&delete u[this.mLine].crypto[e]},newLine:function(e){u[this.mLine].crypto[e.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=e}}},track:function(t){var e=u[r].ssrc[t];return{ssrc:e,set:function(e){u[this.mLine].ssrc[t]=e},mLine:this.mLine,remove:function(){e&&(delete u[r].ssrc[t],u[r].ssrc=swap(u[r].ssrc))}}}}}c("audio"),c("video"),c("data"),this.deserialize=function(){for(var e="",t=0;t<o.length;t++)e+=o[t]+"\r\n";return e=p(e=p(e=p(e,"audio"),"video"),"data")},this.audio=h("audio"),this.video=h("video"),this.data=h("data"),this._inner=u}function swap(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t}!function(e,t){"function"==typeof define&&define.amd?define([],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(this,function(){"use strict";function h(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}try{Object.defineProperty(h.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}h.isLong=function(e){return!0===(e&&e.__isLong__)};var o={},i={};h.fromInt=function(e,t){var r,n;return t?0<=(e>>>=0)&&e<256&&(n=i[e])?n:(r=new h(e,(0|e)<0?-1:0,!0),0<=e&&e<256&&(i[e]=r),r):-128<=(e|=0)&&e<128&&(n=o[e])?n:(r=new h(e,e<0?-1:0,!1),-128<=e&&e<128&&(o[e]=r),r)},h.fromNumber=function(e,t){return t=!!t,isNaN(e)||!isFinite(e)?h.ZERO:!t&&e<=-a?h.MIN_VALUE:!t&&a<=e+1?h.MAX_VALUE:t&&n<=e?h.MAX_UNSIGNED_VALUE:e<0?h.fromNumber(-e,t).negate():new h(e%r|0,e/r|0,t)},h.fromBits=function(e,t,r){return new h(e,t,r)},h.fromString=function(e,t,r){if(0===e.length)throw Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return h.ZERO;if("number"==typeof t&&(r=t,t=!1),(r=r||10)<2||36<r)throw Error("radix out of range: "+r);var n;if(0<(n=e.indexOf("-")))throw Error('number format error: interior "-" character: '+e);if(0===n)return h.fromString(e.substring(1),t,r).negate();for(var o=h.fromNumber(Math.pow(r,8)),i=h.ZERO,a=0;a<e.length;a+=8){var s=Math.min(8,e.length-a),d=parseInt(e.substring(a,a+s),r);if(s<8){var l=h.fromNumber(Math.pow(r,s));i=i.multiply(l).add(h.fromNumber(d))}else i=(i=i.multiply(o)).add(h.fromNumber(d))}return i.unsigned=t,i},h.fromValue=function(e){return e instanceof h?e:"number"==typeof e?h.fromNumber(e):"string"==typeof e?h.fromString(e):new h(e.low,e.high,e.unsigned)};var r=4294967296,n=r*r,a=n/2,f=h.fromInt(1<<24);return h.ZERO=h.fromInt(0),h.UZERO=h.fromInt(0,!0),h.ONE=h.fromInt(1),h.UONE=h.fromInt(1,!0),h.NEG_ONE=h.fromInt(-1),h.MAX_VALUE=h.fromBits(-1,2147483647,!1),h.MAX_UNSIGNED_VALUE=h.fromBits(-1,-1,!0),h.MIN_VALUE=h.fromBits(0,-2147483648,!1),h.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},h.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*r+(this.low>>>0):this.high*r+(this.low>>>0)},h.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix out of range: "+e);if(this.isZero())return"0";var t;if(this.isNegative()){if(this.equals(h.MIN_VALUE)){var r=h.fromNumber(e),n=this.divide(r);return t=n.multiply(r).subtract(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.negate().toString(e)}var o=h.fromNumber(Math.pow(e,6),this.unsigned);t=this;for(var i="";;){var a=t.divide(o),s=(t.subtract(a.multiply(o)).toInt()>>>0).toString(e);if((t=a).isZero())return s+i;for(;s.length<6;)s="0"+s;i=""+s+i}},h.prototype.getHighBits=function(){return this.high},h.prototype.getHighBitsUnsigned=function(){return this.high>>>0},h.prototype.getLowBits=function(){return this.low},h.prototype.getLowBitsUnsigned=function(){return this.low>>>0},h.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(h.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},h.prototype.isZero=function(){return 0===this.high&&0===this.low},h.prototype.isNegative=function(){return!this.unsigned&&this.high<0},h.prototype.isPositive=function(){return this.unsigned||0<=this.high},h.prototype.isOdd=function(){return 1==(1&this.low)},h.prototype.isEven=function(){return 0==(1&this.low)},h.eq=h.prototype.equals=function(e){return h.isLong(e)||(e=h.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},h.neq=h.prototype.notEquals=function(e){return!this.equals(e)},h.prototype.lt=h.prototype.lessThan=function(e){return this.compare(e)<0},h.prototype.lte=h.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},h.prototype.gt=h.prototype.greaterThan=function(e){return 0<this.compare(e)},h.prototype.gte=h.prototype.greaterThanOrEqual=function(e){return 0<=this.compare(e)},h.prototype.compare=function(e){if(h.isLong(e)||(e=h.fromValue(e)),this.equals(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1},h.prototype.neg=h.prototype.negate=function(){return!this.unsigned&&this.equals(h.MIN_VALUE)?h.MIN_VALUE:this.not().add(h.ONE)},h.prototype.add=function(e){h.isLong(e)||(e=h.fromValue(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,a=65535&e.high,s=e.low>>>16,d=0,l=0,u=0,c=0;return u+=(c+=o+(65535&e.low))>>>16,l+=(u+=n+s)>>>16,d+=(l+=r+a)>>>16,d+=t+i,h.fromBits((u&=65535)<<16|(c&=65535),(d&=65535)<<16|(l&=65535),this.unsigned)},h.prototype.sub=h.prototype.subtract=function(e){return h.isLong(e)||(e=h.fromValue(e)),this.add(e.negate())},h.prototype.mul=h.prototype.multiply=function(e){if(this.isZero())return h.ZERO;if(h.isLong(e)||(e=h.fromValue(e)),e.isZero())return h.ZERO;if(this.equals(h.MIN_VALUE))return e.isOdd()?h.MIN_VALUE:h.ZERO;if(e.equals(h.MIN_VALUE))return this.isOdd()?h.MIN_VALUE:h.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(f)&&e.lessThan(f))return h.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,i=e.high>>>16,a=65535&e.high,s=e.low>>>16,d=65535&e.low,l=0,u=0,c=0,p=0;return c+=(p+=o*d)>>>16,u+=(c+=n*d)>>>16,c&=65535,u+=(c+=o*s)>>>16,l+=(u+=r*d)>>>16,u&=65535,l+=(u+=n*s)>>>16,u&=65535,l+=(u+=o*a)>>>16,l+=t*d+r*s+n*a+o*i,h.fromBits((c&=65535)<<16|(p&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},h.prototype.div=h.prototype.divide=function(e){if(h.isLong(e)||(e=h.fromValue(e)),e.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?h.UZERO:h.ZERO;var t,r,n;{if(this.equals(h.MIN_VALUE))return e.equals(h.ONE)||e.equals(h.NEG_ONE)?h.MIN_VALUE:e.equals(h.MIN_VALUE)?h.ONE:(t=this.shiftRight(1).divide(e).shiftLeft(1)).equals(h.ZERO)?e.isNegative()?h.ONE:h.NEG_ONE:(r=this.subtract(e.multiply(t)),n=t.add(r.divide(e)));if(e.equals(h.MIN_VALUE))return this.unsigned?h.UZERO:h.ZERO}if(this.isNegative())return e.isNegative()?this.negate().divide(e.negate()):this.negate().divide(e).negate();if(e.isNegative())return this.divide(e.negate()).negate();for(n=h.ZERO,r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),i=o<=48?1:Math.pow(2,o-48),a=h.fromNumber(t),s=a.multiply(e);s.isNegative()||s.greaterThan(r);)s=(a=h.fromNumber(t-=i,this.unsigned)).multiply(e);a.isZero()&&(a=h.ONE),n=n.add(a),r=r.subtract(s)}return n},h.prototype.mod=h.prototype.modulo=function(e){return h.isLong(e)||(e=h.fromValue(e)),this.subtract(this.divide(e).multiply(e))},h.prototype.not=function(){return h.fromBits(~this.low,~this.high,this.unsigned)},h.prototype.and=function(e){return h.isLong(e)||(e=h.fromValue(e)),h.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},h.prototype.or=function(e){return h.isLong(e)||(e=h.fromValue(e)),h.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},h.prototype.xor=function(e){return h.isLong(e)||(e=h.fromValue(e)),h.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},h.prototype.shl=h.prototype.shiftLeft=function(e){return h.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?h.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):h.fromBits(0,this.low<<e-32,this.unsigned)},h.prototype.shr=h.prototype.shiftRight=function(e){return h.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?h.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):h.fromBits(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},h.prototype.shru=h.prototype.shiftRightUnsigned=function(e){if(h.isLong(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;if(e<32){var r=this.low;return h.fromBits(r>>>e|t<<32-e,t>>>e,this.unsigned)}return h.fromBits(32===e?t:t>>>e-32,0,this.unsigned)},h.prototype.toSigned=function(){return this.unsigned?new h(this.low,this.high,!1):this},h.prototype.toUnsigned=function(){return this.unsigned?this:new h(this.low,this.high,!0)},h}),function(e,t){"function"==typeof define&&define.amd?define(["long"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var e;try{e=require("long")}catch(e){}return t(e)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}(this,function(d){"use strict";var f=function(e,t,r){if(void 0===e&&(e=f.DEFAULT_CAPACITY),void 0===t&&(t=f.DEFAULT_ENDIAN),void 0===r&&(r=f.DEFAULT_NOASSERT),!r){if((e|=0)<0)throw RangeError("Illegal capacity");t=!!t,r=!!r}this.buffer=0===e?i:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=r};f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=d||null;var a=f.prototype;a.__isByteBuffer__;try{Object.defineProperty(a,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}try{var i=new ArrayBuffer(0)}catch(e){i=""}var r=String.fromCharCode;function s(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function l(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+r.apply(String,e);1024<e.length+arguments.length&&(t.push(r.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function n(e,t,r,n,o){var i,a,s=8*o-n-1,d=(1<<s)-1,l=d>>1,u=-7,c=r?o-1:0,p=r?-1:1,h=e[t+c];for(c+=p,i=h&(1<<-u)-1,h>>=-u,u+=s;0<u;i=256*i+e[t+c],c+=p,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=n;0<u;a=256*a+e[t+c],c+=p,u-=8);if(0===i)i=1-l;else{if(i===d)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),i-=l}return(h?-1:1)*a*Math.pow(2,i-n)}function o(e,t,r,n,o,i){var a,s,d,l=8*i-o-1,u=(1<<l)-1,c=u>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:i-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-a))<1&&(a--,d*=2),2<=(t+=1<=a+c?p/d:p*Math.pow(2,1-c))*d&&(a++,d/=2),u<=a+c?(s=0,a=u):1<=a+c?(s=(t*d-1)*Math.pow(2,o),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,o),a=0));8<=o;e[r+h]=255&s,h+=f,s/=256,o-=8);for(a=a<<o|s,l+=o;0<l;e[r+h]=255&a,h+=f,a/=256,l-=8);e[r+h-f]|=128*m}f.accessor=function(){return Uint8Array},f.allocate=function(e,t,r){return new f(e,t,r)},f.concat=function(e,t,r,n){"boolean"!=typeof t&&"string"==typeof t||(n=r,r=t,t=void 0);for(var o,i=0,a=0,s=e.length;a<s;++a)f.isByteBuffer(e[a])||(e[a]=f.wrap(e[a],t)),0<(o=e[a].limit-e[a].offset)&&(i+=o);if(0===i)return new f(0,r,n);var d,l=new f(i,r,n);for(a=0;a<s;)(o=(d=e[a++]).limit-d.offset)<=0||(l.view.set(d.view.subarray(d.offset,d.limit),l.offset),l.offset+=o);return l.limit=l.offset,l.offset=0,l},f.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},f.type=function(){return ArrayBuffer},f.wrap=function(e,t,r,n){if("string"!=typeof t&&(n=r,r=t,t=void 0),"string"==typeof e)switch(void 0===t&&(t="utf8"),t){case"base64":return f.fromBase64(e,r);case"hex":return f.fromHex(e,r);case"binary":return f.fromBinary(e,r);case"utf8":return f.fromUTF8(e,r);case"debug":return f.fromDebug(e,r);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var o;if(f.isByteBuffer(e))return(o=a.clone.call(e)).markedOffset=-1,o;if(e instanceof Uint8Array)o=new f(0,r,n),0<e.length&&(o.buffer=e.buffer,o.offset=e.byteOffset,o.limit=e.byteOffset+e.byteLength,o.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)o=new f(0,r,n),0<e.byteLength&&(o.buffer=e,o.offset=0,o.limit=e.byteLength,o.view=0<e.byteLength?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(o=new f(e.length,r,n)).limit=e.length;for(var i=0;i<e.length;++i)o.view[i]=e[i]}return o},a.writeBitSet=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=t,i=e.length,a=i>>3,s=0;for(t+=this.writeVarint32(i,t);a--;)n=1&!!e[s++]|(1&!!e[s++])<<1|(1&!!e[s++])<<2|(1&!!e[s++])<<3|(1&!!e[s++])<<4|(1&!!e[s++])<<5|(1&!!e[s++])<<6|(1&!!e[s++])<<7,this.writeByte(n,t++);if(s<i){var d=0;for(n=0;s<i;)n|=(1&!!e[s++])<<d++;this.writeByte(n,t++)}return r?(this.offset=t,this):t-o},a.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var r,n=this.readVarint32(e),o=n.value,i=o>>3,a=0,s=[];for(e+=n.length;i--;)r=this.readByte(e++),s[a++]=!!(1&r),s[a++]=!!(2&r),s[a++]=!!(4&r),s[a++]=!!(8&r),s[a++]=!!(16&r),s[a++]=!!(32&r),s[a++]=!!(64&r),s[a++]=!!(128&r);if(a<o){var d=0;for(r=this.readByte(e++);a<o;)s[a++]=!!(r>>d++&1)}return t&&(this.offset=e),s},a.readBytes=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var n=this.slice(t,t+e);return r&&(this.offset+=e),n},a.writeBytes=a.append,a.writeInt8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},a.writeByte=a.writeInt8,a.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return 128==(128&r)&&(r=-(255-r+1)),t&&(this.offset+=1),r},a.readByte=a.readInt8,a.writeUint8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},a.writeUInt8=a.writeUint8,a.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return t&&(this.offset+=1),r},a.readUInt8=a.readUint8,a.writeInt16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},a.writeShort=a.writeInt16,a.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),32768==(32768&r)&&(r=-(65535-r+1)),t&&(this.offset+=2),r},a.readShort=a.readInt16,a.writeUint16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},a.writeUInt16=a.writeUint16,a.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),t&&(this.offset+=2),r},a.readUInt16=a.readUint16,a.writeInt32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},a.writeInt=a.writeInt32,a.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),r|=0,t&&(this.offset+=4),r},a.readInt=a.readInt32,a.writeUint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},a.writeUInt32=a.writeUint32,a.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),t&&(this.offset+=4),r},a.readUInt32=a.readUint32,d&&(a.writeInt64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=d.fromNumber(e);else if("string"==typeof e)e=d.fromString(e);else if(!(e&&e instanceof d))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=d.fromNumber(e):"string"==typeof e&&(e=d.fromString(e)),t+=8;var n=this.buffer.byteLength;n<t&&this.resize((n*=2)>t?n:t),t-=8;var o=e.low,i=e.high;return this.littleEndian?(this.view[t+3]=o>>>24&255,this.view[t+2]=o>>>16&255,this.view[t+1]=o>>>8&255,this.view[t]=255&o,t+=4,this.view[t+3]=i>>>24&255,this.view[t+2]=i>>>16&255,this.view[t+1]=i>>>8&255,this.view[t]=255&i):(this.view[t]=i>>>24&255,this.view[t+1]=i>>>16&255,this.view[t+2]=i>>>8&255,this.view[t+3]=255&i,t+=4,this.view[t]=o>>>24&255,this.view[t+1]=o>>>16&255,this.view[t+2]=o>>>8&255,this.view[t+3]=255&o),r&&(this.offset+=8),this},a.writeLong=a.writeInt64,a.readInt64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0):(n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var o=new d(r,n,!1);return t&&(this.offset+=8),o},a.readLong=a.readInt64,a.writeUint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=d.fromNumber(e);else if("string"==typeof e)e=d.fromString(e);else if(!(e&&e instanceof d))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=d.fromNumber(e):"string"==typeof e&&(e=d.fromString(e)),t+=8;var n=this.buffer.byteLength;n<t&&this.resize((n*=2)>t?n:t),t-=8;var o=e.low,i=e.high;return this.littleEndian?(this.view[t+3]=o>>>24&255,this.view[t+2]=o>>>16&255,this.view[t+1]=o>>>8&255,this.view[t]=255&o,t+=4,this.view[t+3]=i>>>24&255,this.view[t+2]=i>>>16&255,this.view[t+1]=i>>>8&255,this.view[t]=255&i):(this.view[t]=i>>>24&255,this.view[t+1]=i>>>16&255,this.view[t+2]=i>>>8&255,this.view[t+3]=255&i,t+=4,this.view[t]=o>>>24&255,this.view[t+1]=o>>>16&255,this.view[t+2]=o>>>8&255,this.view[t+3]=255&o),r&&(this.offset+=8),this},a.writeUInt64=a.writeUint64,a.readUint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,n=this.view[e+2]<<16,n|=this.view[e+1]<<8,n|=this.view[e],n+=this.view[e+3]<<24>>>0):(n=this.view[e+1]<<16,n|=this.view[e+2]<<8,n|=this.view[e+3],n+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var o=new d(r,n,!0);return t&&(this.offset+=8),o},a.readUInt64=a.readUint64),a.writeFloat32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=4,o(this.view,e,t,this.littleEndian,23,4),r&&(this.offset+=4),this},a.writeFloat=a.writeFloat32,a.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=n(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),r},a.readFloat=a.readFloat32,a.writeFloat64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var n=this.buffer.byteLength;return n<t&&this.resize((n*=2)>t?n:t),t-=8,o(this.view,e,t,this.littleEndian,52,8),r&&(this.offset+=8),this},a.writeDouble=a.writeFloat64,a.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=n(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),r},a.readDouble=a.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},f.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},f.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},a.writeVarint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=f.calculateVarint32(e);t+=o;var i=this.buffer.byteLength;for(i<t&&this.resize((i*=2)>t?i:t),t-=o,e>>>=0;128<=e;)n=127&e|128,this.view[t++]=n,e>>>=7;return this.view[t++]=e,r?(this.offset=t,this):o},a.writeVarint32ZigZag=function(e,t){return this.writeVarint32(f.zigZagEncode32(e),t)},a.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=0,o=0;do{if(!this.noAssert&&e>this.limit){var i=Error("Truncated");throw i.truncated=!0,i}r=this.view[e++],n<5&&(o|=(127&r)<<7*n),++n}while(0!=(128&r));return o|=0,t?(this.offset=e,o):{value:o,length:n}},a.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return"object"==typeof t?t.value=f.zigZagDecode32(t.value):t=f.zigZagDecode32(t),t},d&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(e){"number"==typeof e?e=d.fromNumber(e):"string"==typeof e&&(e=d.fromString(e));var t=e.toInt()>>>0,r=e.shiftRightUnsigned(28).toInt()>>>0,n=e.shiftRightUnsigned(56).toInt()>>>0;return 0==n?0==r?t<16384?t<128?1:2:t<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:n<128?9:10},f.zigZagEncode64=function(e){return"number"==typeof e?e=d.fromNumber(e,!1):"string"==typeof e?e=d.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(e){return"number"==typeof e?e=d.fromNumber(e,!1):"string"==typeof e?e=d.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(d.ONE).toSigned().negate()).toSigned()},a.writeVarint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=d.fromNumber(e);else if("string"==typeof e)e=d.fromString(e);else if(!(e&&e instanceof d))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=d.fromNumber(e,!1):"string"==typeof e?e=d.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned());var n=f.calculateVarint64(e),o=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0,a=e.shiftRightUnsigned(56).toInt()>>>0;t+=n;var s=this.buffer.byteLength;switch(s<t&&this.resize((s*=2)>t?s:t),t-=n,n){case 10:this.view[t+9]=a>>>7&1;case 9:this.view[t+8]=9!==n?128|a:127&a;case 8:this.view[t+7]=8!==n?i>>>21|128:i>>>21&127;case 7:this.view[t+6]=7!==n?i>>>14|128:i>>>14&127;case 6:this.view[t+5]=6!==n?i>>>7|128:i>>>7&127;case 5:this.view[t+4]=5!==n?128|i:127&i;case 4:this.view[t+3]=4!==n?o>>>21|128:o>>>21&127;case 3:this.view[t+2]=3!==n?o>>>14|128:o>>>14&127;case 2:this.view[t+1]=2!==n?o>>>7|128:o>>>7&127;case 1:this.view[t]=1!==n?128|o:127&o}return r?(this.offset+=n,this):n},a.writeVarint64ZigZag=function(e,t){return this.writeVarint64(f.zigZagEncode64(e),t)},a.readVarint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,n=0,o=0,i=0,a=0;if(n=127&(a=this.view[e++]),128&a&&(n|=(127&(a=this.view[e++]))<<7,(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[e++]))<<14,(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[e++]))<<21,(128&a||this.noAssert&&void 0===a)&&(o=127&(a=this.view[e++]),(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<7,(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<14,(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<21,(128&a||this.noAssert&&void 0===a)&&(i=127&(a=this.view[e++]),(128&a||this.noAssert&&void 0===a)&&(i|=(127&(a=this.view[e++]))<<7,128&a||this.noAssert&&void 0===a))))))))))throw Error("Buffer overrun");var s=d.fromBits(n|o<<28,o>>>4|i<<24,!1);return t?(this.offset=e,s):{value:s,length:e-r}},a.readVarint64ZigZag=function(e){var t=this.readVarint64(e);return t&&t.value instanceof d?t.value=f.zigZagDecode64(t.value):t=f.zigZagDecode64(t),t}),a.writeCString=function(e,t){var r=void 0===t;r&&(t=this.offset);var n,o=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(n=0;n<o;++n)if(0===e.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}o=p.calculateUTF16asUTF8(s(e))[1],t+=o+1;var i=this.buffer.byteLength;return i<t&&this.resize((i*=2)>t?i:t),t-=o+1,p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),this.view[t++]=0,r?(this.offset=t,this):o},a.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,n=e,o=-1;return p.decodeUTF8toUTF16(function(){if(0===o)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(o=this.view[e++])?null:o}.bind(this),r=l(),!0),t?(this.offset=e,r()):{string:r(),length:e-n}},a.writeIString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o=t;n=p.calculateUTF16asUTF8(s(e),this.noAssert)[1],t+=4+n;var i=this.buffer.byteLength;if(i<t&&this.resize((i*=2)>t?i:t),t-=4+n,this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n):(this.view[t]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),t+=4,p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),t!==o+4+n)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+n));return r?(this.offset=t,this):t-o},a.readIString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=e,n=this.readUint32(e),o=this.readUTF8String(n,f.METRICS_BYTES,e+=4);return e+=o.length,t?(this.offset=e,o.string):{string:o.string,length:e-r}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",a.writeUTF8String=function(e,t){var r,n=void 0===t;if(n&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o=t;r=p.calculateUTF16asUTF8(s(e))[1],t+=r;var i=this.buffer.byteLength;return i<t&&this.resize((i*=2)>t?i:t),t-=r,p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),n?(this.offset=t,this):t-o},a.writeString=a.writeUTF8String,f.calculateUTF8Chars=function(e){return p.calculateUTF16asUTF8(s(e))[0]},f.calculateUTF8Bytes=function(e){return p.calculateUTF16asUTF8(s(e))[1]},f.calculateString=f.calculateUTF8Bytes,a.readUTF8String=function(e,t,r){"number"==typeof t&&(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),void 0===t&&(t=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var o,i=0,a=r;if(t===f.METRICS_CHARS){if(o=l(),p.decodeUTF8(function(){return i<e&&r<this.limit?this.view[r++]:null}.bind(this),function(e){++i,p.UTF8toUTF16(e,o)}),i!==e)throw RangeError("Illegal range: Truncated data, "+i+" == "+e);return n?(this.offset=r,o()):{string:o(),length:r-a}}if(t!==f.METRICS_BYTES)throw TypeError("Unsupported metrics: "+t);if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}var s=r+e;if(p.decodeUTF8toUTF16(function(){return r<s?this.view[r++]:null}.bind(this),o=l(),this.noAssert),r!==s)throw RangeError("Illegal range: Truncated data, "+r+" == "+s);return n?(this.offset=r,o()):{string:o(),length:r-a}},a.readString=a.readUTF8String,a.writeVString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n,o,i=t;n=p.calculateUTF16asUTF8(s(e),this.noAssert)[1],o=f.calculateVarint32(n),t+=o+n;var a=this.buffer.byteLength;if(a<t&&this.resize((a*=2)>t?a:t),t-=o+n,t+=this.writeVarint32(n,t),p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),t!==i+n+o)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+n+o));return r?(this.offset=t,this):t-i},a.readVString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,n=this.readVarint32(e),o=this.readUTF8String(n.value,f.METRICS_BYTES,e+=n.length);return e+=o.length,t?(this.offset=e,o.string):{string:o.string,length:e-r}},a.append=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof f||(e=f.wrap(e,t));var o=e.limit-e.offset;if(o<=0)return this;r+=o;var i=this.buffer.byteLength;return i<r&&this.resize((i*=2)>r?i:r),r-=o,this.view.set(e.view.subarray(e.offset,e.limit),r),e.offset+=o,n&&(this.offset+=o),this},a.appendTo=function(e,t){return e.append(this,t),this},a.assert=function(e){return this.noAssert=!e,this},a.capacity=function(){return this.buffer.byteLength},a.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},a.clone=function(e){var t=new f(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},a.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var r=t-e;if(0===r)return this.buffer=i,this.view=null,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var n=new ArrayBuffer(r),o=new Uint8Array(n);return o.set(this.view.subarray(e,t)),this.buffer=n,this.view=o,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=r,this},a.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new f(0,this.littleEndian,this.noAssert);var r=t-e,n=new f(r,this.littleEndian,this.noAssert);return n.offset=0,n.limit=r,0<=n.markedOffset&&(n.markedOffset-=e),this.copyTo(n,0,e,t),n},a.copyTo=function(e,t,r,n){var o,i;if(!this.noAssert&&!f.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(i=void 0===t)?e.offset:0|t,r=(o=void 0===r)?this.offset:0|r,n=void 0===n?this.limit:0|n,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(r<0||n>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var a=n-r;return 0===a?e:(e.ensureCapacity(t+a),e.view.set(this.view.subarray(r,n),t),o&&(this.offset+=a),i&&(e.offset+=a),this)},a.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},a.fill=function(e,t,r){var n=void 0===t;if(n&&(t=this.offset),"string"==typeof e&&0<e.length&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(r<=t)return this;for(;t<r;)this.view[t++]=e;return n&&(this.offset=t),this},a.flip=function(){return this.limit=this.offset,this.offset=0,this},a.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},a.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},a.LE=function(e){return this.littleEndian=void 0===e||!!e,this},a.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},a.prepend=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof f||(e=f.wrap(e,t));var o=e.limit-e.offset;if(o<=0)return this;var i=o-r;if(0<i){var a=new ArrayBuffer(this.buffer.byteLength+i),s=new Uint8Array(a);s.set(this.view.subarray(r,this.buffer.byteLength),o),this.buffer=a,this.view=s,this.offset+=i,0<=this.markedOffset&&(this.markedOffset+=i),this.limit+=i,r+=i}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),r-o),e.offset=e.limit,n&&(this.offset-=o),this},a.prependTo=function(e,t){return e.prepend(this,t),this},a.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},a.remaining=function(){return this.limit-this.offset},a.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},a.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),r=new Uint8Array(t);r.set(this.view),this.buffer=t,this.view=r}return this},a.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},a.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},a.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=e,r.limit=t,r},a.toBuffer=function(e){var t=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(!e&&0===t&&r===this.buffer.byteLength)return this.buffer;if(t===r)return i;var n=new ArrayBuffer(r-t);return new Uint8Array(n).set(new Uint8Array(this.buffer).subarray(t,r),0),n},a.toArrayBuffer=a.toBuffer,a.toString=function(e,t,r){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(r=t=e="utf8"),e){case"utf8":return this.toUTF8(t,r);case"base64":return this.toBase64(t,r);case"hex":return this.toHex(t,r);case"binary":return this.toBinary(t,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var u=function(){for(var e={},o=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],a=[],t=0,r=o.length;t<r;++t)a[o[t]]=t;return e.encode=function(e,t){for(var r,n;null!==(r=e());)t(o[r>>2&63]),n=(3&r)<<4,null!==(r=e())?(t(o[63&((n|=r>>4&15)|r>>4&15)]),n=(15&r)<<2,null!==(r=e())?(t(o[63&(n|r>>6&3)]),t(o[63&r])):(t(o[63&n]),t(61))):(t(o[63&n]),t(61),t(61))},e.decode=function(e,t){var r,n,o;function i(e){throw Error("Illegal character code: "+e)}for(;null!==(r=e());)if(void 0===(n=a[r])&&i(r),null!==(r=e())&&(void 0===(o=a[r])&&i(r),t(n<<2>>>0|(48&o)>>4),null!==(r=e()))){if(void 0===(n=a[r])){if(61===r)break;i(r)}if(t((15&o)<<4>>>0|(60&n)>>2),null!==(r=e())){if(void 0===(o=a[r])){if(61===r)break;i(r)}t((3&n)<<6>>>0|o)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}();a.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||t<e)throw RangeError("begin, end");var r;return u.encode(function(){return e<t?this.view[e++]:null}.bind(this),r=l()),r()},f.fromBase64=function(e,t){if("string"!=typeof e)throw TypeError("str");var r=new f(e.length/4*3,t),n=0;return u.decode(s(e),function(e){r.view[n++]=e}),r.limit=n,r},f.btoa=function(e){return f.fromBinary(e).toBase64()},f.atob=function(e){return f.fromBase64(e).toBinary()},a.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||t<e)throw RangeError("begin, end");if(e===t)return"";for(var r=[],n=[];e<t;)r.push(this.view[e++]),1024<=r.length&&(n.push(String.fromCharCode.apply(String,r)),r=[]);return n.join("")+String.fromCharCode.apply(String,r)},f.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var r,n=0,o=e.length,i=new f(o,t);n<o;){if(255<(r=e.charCodeAt(n)))throw RangeError("illegal char code: "+r);i.view[n++]=r}return i.limit=o,i},a.toDebug=function(e){for(var t,r=-1,n=this.buffer.byteLength,o="",i="",a="";r<n;){if(-1!==r&&(o+=(t=this.view[r])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(i+=32<t&&t<127?String.fromCharCode(t):".")),++r,e&&0<r&&r%16==0&&r!==n){for(;o.length<51;)o+=" ";a+=o+i+"\n",o=i=""}r===this.offset&&r===this.limit?o+=r===this.markedOffset?"!":"|":r===this.offset?o+=r===this.markedOffset?"[":"<":r===this.limit?o+=r===this.markedOffset?"]":">":o+=r===this.markedOffset?"'":e||0!==r&&r!==n?" ":""}if(e&&" "!==o){for(;o.length<51;)o+=" ";a+=o+i+"\n"}return e?a:o},f.fromDebug=function(e,t,r){for(var n,o,i=e.length,a=new f((i+1)/3|0,t,r),s=0,d=0,l=!1,u=!1,c=!1,p=!1,h=!1;s<i;){switch(n=e.charAt(s++)){case"!":if(!r){if(u||c||p){h=!0;break}u=c=p=!0}a.offset=a.markedOffset=a.limit=d,l=!1;break;case"|":if(!r){if(u||p){h=!0;break}u=p=!0}a.offset=a.limit=d,l=!1;break;case"[":if(!r){if(u||c){h=!0;break}u=c=!0}a.offset=a.markedOffset=d,l=!1;break;case"<":if(!r){if(u){h=!0;break}u=!0}a.offset=d,l=!1;break;case"]":if(!r){if(p||c){h=!0;break}p=c=!0}a.limit=a.markedOffset=d,l=!1;break;case">":if(!r){if(p){h=!0;break}p=!0}a.limit=d,l=!1;break;case"'":if(!r){if(c){h=!0;break}c=!0}a.markedOffset=d,l=!1;break;case" ":l=!1;break;default:if(!r&&l){h=!0;break}if(o=parseInt(n+e.charAt(s++),16),!r&&(isNaN(o)||o<0||255<o))throw TypeError("Illegal str: Not a debug encoded string");a.view[d++]=o,l=!0}if(h)throw TypeError("Illegal str: Invalid symbol at "+s)}if(!r){if(!u||!p)throw TypeError("Illegal str: Missing offset or limit");if(d<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+d+" < "+i)}return a},a.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var r,n=new Array(t-e);e<t;)(r=this.view[e++])<16?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},f.fromHex=function(e,t,r){if(!r){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var n,o=e.length,i=new f(o/2|0,t),a=0,s=0;a<o;a+=2){if(n=parseInt(e.substring(a,a+2),16),!r&&(!isFinite(n)||n<0||255<n))throw TypeError("Illegal str: Contains non-hex characters");i.view[s++]=n}return i.limit=s,i};var c,p=c={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<128?t(127&r):(r<2048?t(r>>6&31|192):(r<65536?t(r>>12&15|224):(t(r>>18&7|240),t(r>>12&63|128)),t(r>>6&63|128)),t(63&r|128)),r=null},decodeUTF8:function(e,t){for(var r,n,o,i,a=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(r=e());)if(0==(128&r))t(r);else if(192==(224&r))null===(n=e())&&a([r,n]),t((31&r)<<6|63&n);else if(224==(240&r))(null===(n=e())||null===(o=e()))&&a([r,n,o]),t((15&r)<<12|(63&n)<<6|63&o);else{if(240!=(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=e())||null===(o=e())||null===(i=e()))&&a([r,n,o,i]),t((7&r)<<18|(63&n)<<12|(63&o)<<6|63&i)}},UTF16toUTF8:function(e,t){for(var r,n=null;null!==(r=null!==n?n:e());)55296<=r&&r<=57343&&null!==(n=e())&&56320<=n&&n<=57343?(t(1024*(r-55296)+n-56320+65536),n=null):t(r);null!==n&&t(n)},UTF8toUTF16:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<=65535?t(r):(t(55296+((r-=65536)>>10)),t(r%1024+56320)),r=null},encodeUTF16toUTF8:function(e,t){c.UTF16toUTF8(e,function(e){c.encodeUTF8(e,t)})},decodeUTF8toUTF16:function(e,t){c.decodeUTF8(e,function(e){c.UTF8toUTF16(e,t)})},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,r=0;null!==(t=e());)r+=t<128?1:t<2048?2:t<65536?3:4;return r},calculateUTF16asUTF8:function(e){var t=0,r=0;return c.UTF16toUTF8(e,function(e){++t,r+=e<128?1:e<2048?2:e<65536?3:4}),[t,r]}};return a.toUTF8=function(t,r){if(void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}var e;try{p.decodeUTF8toUTF16(function(){return t<r?this.view[t++]:null}.bind(this),e=l())}catch(e){if(t!==r)throw RangeError("Illegal range: Truncated data, "+t+" != "+r)}return e()},f.fromUTF8=function(e,t,r){if(!r&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var n=new f(p.calculateUTF16asUTF8(s(e),!0)[1],t,r),o=0;return p.encodeUTF16toUTF8(s(e),function(e){n.view[o++]=e}),n.limit=o,n},f}),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.log4javascript=e()}(function(){function isUndefined(e){return void 0===e}function EventSupport(){}Array.prototype.push||(Array.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(0<this.length){for(var e=this[0],t=0,r=this.length-1;t<r;t++)this[t]=this[t+1];return this.length=this.length-1,e}}),Array.prototype.splice||(Array.prototype.splice=function(e,t){var r=this.slice(e+t),n=this.slice(e,e+t);this.length=e;for(var o=[],i=0,a=arguments.length;i<a;i++)o[i]=arguments[i];var s=2<o.length?r=o.slice(2).concat(r):r;for(i=0,a=s.length;i<a;i++)this.push(s[i]);return n}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(e){if(e instanceof Array){this.eventTypes=e,this.eventListeners={};for(var t=0,r=this.eventTypes.length;t<r;t++)this.eventListeners[this.eventTypes[t]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+e+"'"),this.eventListeners[e].push(t)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+e+"'"),array_remove(this.eventListeners[e],t)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(e,t){if(array_contains(this.eventTypes,e))for(var r=this.eventListeners[e],n=0,o=r.length;n<o;n++)r[n](this,e,t);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+e+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;function toStr(e){return e&&e.toString?e.toString():String(e)}function getExceptionMessage(e){return e.message?e.message:e.description?e.description:toStr(e)}function getUrlFileName(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return e.substr(t+1)}function getExceptionStringRep(e){if(e){var t="Exception: "+getExceptionMessage(e);try{e.lineNumber&&(t+=" on line number "+e.lineNumber),e.fileName&&(t+=" in file "+getUrlFileName(e.fileName))}catch(e){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&e.stack&&(t+=newLine+"Stack trace:"+newLine+e.stack),t}return null}function bool(e){return Boolean(e)}function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}log4javascript.version="1.4.11",log4javascript.edition="log4javascript";var urlEncode=void 0!==window.encodeURIComponent?function(e){return encodeURIComponent(e)}:function(e){return escape(e).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};function array_remove(e,t){for(var r=-1,n=0,o=e.length;n<o;n++)if(e[n]===t){r=n;break}return 0<=r&&(e.splice(r,1),!0)}function array_contains(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]==t)return!0;return!1}function extractBooleanFromParam(e,t){return isUndefined(e)?t:bool(e)}function extractStringFromParam(e,t){return isUndefined(e)?t:String(e)}function extractIntFromParam(t,r){if(isUndefined(t))return r;try{var e=parseInt(t,10);return isNaN(e)?r:e}catch(e){return logLog.warn("Invalid int param "+t,e),r}}function extractFunctionFromParam(e,t){return"function"==typeof e?e:t}function isError(e){return e instanceof Error}Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";void 0!==obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(e){for(var t=[],r=1,n=arguments.length;r<n;r++)t[r-1]=arguments[r];return this.apply(e,t)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(e){this.quietMode=bool(e)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(e){this.alertAllErrors=e},debug:function(e){this.debugMessages.push(e)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(e,t){},error:function(e,t){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var r="log4javascript error: "+e;t&&(r+=newLine+newLine+"Original error: "+getExceptionStringRep(t)),alert(r)}}};function handleError(e,t){logLog.error(e,t),log4javascript.dispatchEvent("error",{message:e,exception:t})}log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(e){enabled=bool(e)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(e){useTimeStampsInMilliseconds=bool(e)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(e){showStackTraces=bool(e)};var Level=function(e,t){this.level=e,this.name=t};function Timer(e,t){this.name=e,this.level=isUndefined(t)?Level.INFO:t,this.start=new Date}Level.prototype={toString:function(){return this.name},equals:function(e){return this.level==e.level},isGreaterOrEqual:function(e){return this.level>=e.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";function Logger(e){this.name=e,this.parent=null,this.children=[];var r=[],t=null,n=this.name===rootLoggerName,o=this.name===nullLoggerName,i=null,a=!1;this.addChild=function(e){this.children.push(e),e.parent=this,e.invalidateAppenderCache()};var s=!0;this.getAdditivity=function(){return s},this.setAdditivity=function(e){var t=s!=e;s=e,t&&this.invalidateAppenderCache()},this.addAppender=function(e){o?handleError("Logger.addAppender: you may not add an appender to the null logger"):e instanceof log4javascript.Appender?array_contains(r,e)||(r.push(e),e.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(e)+"') is not a subclass of Appender")},this.removeAppender=function(e){array_remove(r,e),e.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var e=r.length;if(0<e){for(var t=0;t<e;t++)r[t].setRemovedFromLogger(this);r.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===i||a){var e=n||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();i=e.concat(r),a=!1}return i},this.invalidateAppenderCache=function(){a=!0;for(var e=0,t=this.children.length;e<t;e++)this.children[e].invalidateAppenderCache()},this.log=function(e,t){if(enabled&&e.isGreaterOrEqual(this.getEffectiveLevel())){var r,n=t.length-1,o=t[n];1<t.length&&isError(o)&&(r=o,n--);for(var i=[],a=0;a<=n;a++)i[a]=t[a];var s=new LoggingEvent(this,new Date,e,i,r);if(this.callAppenders(s),avdEngineHandle&&avdEngineHandle.appSign&&avdEngineHandle.appFunName&&e.level>=avdEngineHandle.levelValue){var d=this.formatTimestamp(new Date);d+=e+" - ",d+=i.toString(),avdEngineHandle.appFunName(avdEngineHandle.appSign,d)}avdEngineHandle&&avdEngineHandle.bugout&&(e==Level.TRACE?avdEngineHandle.bugout.trace(i.toString()):e==Level.DEBUG?avdEngineHandle.bugout.debug(i.toString()):e==Level.INFO?avdEngineHandle.bugout.info(i.toString()):e==Level.ERROR?avdEngineHandle.bugout.error(i.toString()):avdEngineHandle.bugout.info(i.toString()))}"undefined"!=typeof logAjax&&logAjax.enabled&&e.level>=logAjax.level&&saveLog(e.name,t[0],t[1])},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+" "+e.getMilliseconds()+"]: "},this.callAppenders=function(e){for(var t=this.getEffectiveAppenders(),r=0,n=t.length;r<n;r++)t[r].doAppend(e)},this.setLevel=function(e){n&&null===e?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):e instanceof Level?t=e:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return t},this.getEffectiveLevel=function(){for(var e=this;null!==e;e=e.parent){var t=e.getLevel();if(null!==t)return t}},this.group=function(e,t){if(enabled)for(var r=this.getEffectiveAppenders(),n=0,o=r.length;n<o;n++)r[n].group(e,t)},this.groupEnd=function(){if(enabled)for(var e=this.getEffectiveAppenders(),t=0,r=e.length;t<r;t++)e[t].groupEnd()};var d={};this.time=function(e,t){enabled&&(isUndefined(e)?handleError("Logger.time: a name for the timer must be supplied"):!t||t instanceof Level?d[e]=new Timer(e,t):handleError("Logger.time: level supplied to timer "+e+" is not an instance of log4javascript.Level"))},this.timeEnd=function(e){if(enabled)if(isUndefined(e))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(d[e]){var t=d[e],r=t.getElapsedTime();this.log(t.level,["Timer "+toStr(e)+" completed in "+r+"ms"]),delete d[e]}else logLog.warn("Logger.timeEnd: no timer found with name "+e)},this.assert=function(e){if(enabled&&!e){for(var t=[],r=1,n=arguments.length;r<n;r++)t.push(arguments[r]);(t=0<t.length?t:["Assertion Failure"]).push(newLine),t.push(e),this.log(Level.ERROR,t)}},this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(e){return e.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(e){if("string"!=typeof e&&(e=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(e)+" supplied, returning anonymous logger")),e==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[e]){var t=new Logger(e);loggers[e]=t,loggerNames.push(e);var r,n=e.lastIndexOf(".");if(-1<n){var o=e.substring(0,n);r=log4javascript.getLogger(o)}else r=rootLogger;r.addChild(t)}return loggers[e]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName)).setLevel(Level.OFF),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(e,t,r,n,o){this.logger=e,this.timeStamp=t,this.timeStampInMilliseconds=t.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=r,this.messages=n,this.exception=o};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(e){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(e)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(e){return this.isTimeStampsInMilliseconds()?e.timeStampInMilliseconds:e.timeStampInSeconds},getDataValues:function(e,t){var r=[[this.loggerKey,e.logger.name],[this.timeStampKey,this.getTimeStampValue(e)],[this.levelKey,e.level.name],[this.urlKey,window.location.href],[this.messageKey,t?e.getCombinedMessages():e.messages]];if(this.isTimeStampsInMilliseconds()||r.push([this.millisecondsKey,e.milliseconds]),e.exception&&r.push([this.exceptionKey,getExceptionStringRep(e.exception)]),this.hasCustomFields())for(var n=0,o=this.customFields.length;n<o;n++){var i=this.customFields[n].value;"function"==typeof i&&(i=i(this,e)),r.push([this.customFields[n].name,i])}return r},setKeys:function(e,t,r,n,o,i,a){this.loggerKey=extractStringFromParam(e,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(t,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(r,this.defaults.levelKey),this.messageKey=extractStringFromParam(n,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(o,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(i,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(a,this.defaults.millisecondsKey)},setCustomField:function(e,t){for(var r=!1,n=0,o=this.customFields.length;n<o;n++)this.customFields[n].name===e&&(this.customFields[n].value=t,r=!0);r||this.customFields.push({name:e,value:t})},hasCustomFields:function(){return 0<this.customFields.length},formatWithException:function(e){var t=this.format(e);return e.exception&&this.ignoresThrowable()&&(t+=e.getThrowableStrRep()),t},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){},SimpleDateFormat;function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(e){this.combineMessages=extractBooleanFromParam(e,!0),this.customFields=[]}function escapeNewLines(e){return e.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(e,t){this.readable=extractBooleanFromParam(e,!1),this.combineMessages=extractBooleanFromParam(t,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(e,t,r){var p=[];return function e(t,r,o){var n,i,a,s,d,l,u;function c(e){for(var t=splitIntoLines(e),r=1,n=t.length;r<n;r++)t[r]=o+t[r];return t.join(newLine)}if(o||(o=""),null===t)return"null";if(void 0===t)return"undefined";if("string"==typeof t)return c(t);if("object"==typeof t&&array_contains(p,t)){try{l=toStr(t)}catch(e){l="Error formatting property. Details: "+getExceptionStringRep(e)}return l+" [already expanded]"}if(t instanceof Array&&0<r){for(p.push(t),l="["+newLine,a=r-1,s=o+"  ",d=[],n=0,i=t.length;n<i;n++)try{u=e(t[n],a,s),d.push(s+u)}catch(e){d.push(s+"Error formatting array member. Details: "+getExceptionStringRep(e))}return l+=d.join(","+newLine)+newLine+o+"]"}if("[object Date]"==Object.prototype.toString.call(t))return t.toString();if("object"==typeof t&&0<r){for(n in p.push(t),l="{"+newLine,a=r-1,s=o+"  ",d=[],t)try{u=e(t[n],a,s),d.push(s+n+": "+u)}catch(e){d.push(s+n+": Error formatting property. Details: "+getExceptionStringRep(e))}return l+=d.join(","+newLine)+newLine+o+"}"}return c(toStr(t))}(e,t,r)}function PatternLayout(e){this.pattern=e||PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(e){enabled&&e.level.level>=this.threshold.level&&this.append(e)},Appender.prototype.append=function(e){},Appender.prototype.setLayout=function(e){e instanceof Layout?this.layout=e:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(e){e instanceof Level?this.threshold=e:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(e){this.loggers.push(e)},Appender.prototype.setRemovedFromLogger=function(e){array_remove(this.loggers,e)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(e){return e.level.name+" - "+e.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(e){return e.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(e){var t=e.messages,r=e.exception;return r?t.concat([r]):t},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(e){return e.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(e){var t,r,n=this;function o(e){return e="string"==typeof e?e:toStr(e),"<log4javascript:message><![CDATA["+n.escapeCdata(e)+"]]></log4javascript:message>"}var i='<log4javascript:event logger="'+e.logger.name+'" timestamp="'+this.getTimeStampValue(e)+'"';if(this.isTimeStampsInMilliseconds()||(i+=' milliseconds="'+e.milliseconds+'"'),i+=' level="'+e.level.name+'">'+newLine,this.combineMessages)i+=o(e.getCombinedMessages());else{for(i+="<log4javascript:messages>"+newLine,t=0,r=e.messages.length;t<r;t++)i+=o(e.messages[t])+newLine;i+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(t=0,r=this.customFields.length;t<r;t++)i+='<log4javascript:customfield name="'+this.customFields[t].name+'"><![CDATA['+this.customFields[t].value.toString()+"]]></log4javascript:customfield>"+newLine;return e.exception&&(i+="<log4javascript:exception><![CDATA["+getExceptionStringRep(e.exception)+"]]></log4javascript:exception>"+newLine),i+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(e){var t,r,d=this,n=this.getDataValues(e,this.combineMessages),o="{"+this.lineBreak;function l(e,t,r){var n,o=typeof e;if(e instanceof Date)n=String(e.getTime());else if(r&&e instanceof Array){n="["+d.lineBreak;for(var i=0,a=e.length;i<a;i++){var s=t+d.tab;n+=s+l(e[i],s,!1),i<e.length-1&&(n+=","),n+=d.lineBreak}n+=t+"]"}else n="number"!==o&&"boolean"!==o?'"'+escapeNewLines(toStr(e).replace(/\"/g,'\\"'))+'"':e;return n}for(t=0,r=n.length-1;t<=r;t++)o+=this.tab+'"'+n[t][0]+'"'+this.colon+l(n[t][1],this.tab,!0),t<r&&(o+=","),o+=this.lineBreak;return o+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(e){for(var t=this.getDataValues(e),r=[],n=0,o=t.length;n<o;n++){var i=t[n][1]instanceof Date?String(t[n][1].getTime()):t[n][1];r.push(urlEncode(t[n][0])+"="+urlEncode(i))}return r.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(e){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout,function(){var m=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,g=["January","February","March","April","May","June","July","August","September","October","November","December"],v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y={G:0,y:3,M:4,w:2,W:2,D:2,d:2,F:2,E:1,a:0,H:2,k:2,K:2,h:2,m:2,s:2,S:2,Z:5},o=function(e,t,r){var n=new Date(e,t,r,0,0,0);return n.setMilliseconds(0),n};Date.prototype.getDifference=function(e){return this.getTime()-e.getTime()},Date.prototype.isBefore=function(e){return this.getTime()<e.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(e){return this.getUTCTime()-e.getUTCTime()},Date.prototype.getPreviousSunday=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),t=new Date(e.getTime()-864e5*this.getDay());return o(t.getFullYear(),t.getMonth(),t.getDate())},Date.prototype.getWeekInYear=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=o(this.getFullYear(),0,1),n=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return 7-r.getDay()<e&&n--,n},Date.prototype.getWeekInMonth=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=o(this.getFullYear(),this.getMonth(),1),n=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return e<=7-r.getDay()&&n++,n},Date.prototype.getDayInYear=function(){var e=o(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(e)/864e5)},(SimpleDateFormat=function(e){this.formatString=e}).prototype.setMinimalDaysInFirstWeek=function(e){this.minimalDaysInFirstWeek=e},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?1:this.minimalDaysInFirstWeek};var _=function(e,t){for(;e.length<t;)e="0"+e;return e},b=function(e,t,r){return 4<=t?e:e.substr(0,Math.max(r,t))},S=function(e,t){return _(""+e,t)};SimpleDateFormat.prototype.format=function(e){for(var t,r="",n=this.formatString;t=m.exec(n);){var o=t[1],i=t[2],a=t[3],s=t[4];if(o)r+="''"==o?"'":o.substring(1,o.length-1);else if(a);else if(s)r+=s;else if(i){var d=i.charAt(0),l=i.length,u="";switch(d){case"G":u="AD";break;case"y":u=e.getFullYear();break;case"M":u=e.getMonth();break;case"w":u=e.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":u=e.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":u=e.getDayInYear();break;case"d":u=e.getDate();break;case"F":u=1+Math.floor((e.getDate()-1)/7);break;case"E":u=v[e.getDay()];break;case"a":u=12<=e.getHours()?"PM":"AM";break;case"H":u=e.getHours();break;case"k":u=e.getHours()||24;break;case"K":u=e.getHours()%12;break;case"h":u=e.getHours()%12||12;break;case"m":u=e.getMinutes();break;case"s":u=e.getSeconds();break;case"S":u=e.getMilliseconds();break;case"Z":u=e.getTimezoneOffset()}switch(y[d]){case 0:r+=b(u,l,2);break;case 1:r+=b(u,l,3);break;case 2:r+=S(u,l);break;case 3:if(l<=3)r+=(""+u).substr(2,2);else r+=S(u,l);break;case 4:r+=3<=l?b(g[u],l,l):S(u+1,l);break;case 5:var c=0<u?"-":"+",p=Math.abs(u),h=""+Math.floor(p/60),f=""+p%60;r+=c+(h=_(h,2))+(f=_(f,2))}}n=n.substr(t.index+t[0].length)}return r}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(e){for(var t,r=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,n="",o=this.pattern;t=r.exec(o);){var i=t[0],a=t[1],s=t[2],d=t[3],l=t[5],u=t[6];if(u)n+=""+u;else{var c,p="";switch(d){case"a":case"m":var h=0;l&&(h=parseInt(l,10),isNaN(h)&&(handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character '"+d+"' - should be a number"),h=0));for(var f="a"===d?e.messages[0]:e.messages,m=0,g=f.length;m<g;m++)0<m&&" "!==p.charAt(p.length-1)&&(p+=" "),p+=0===h?f[m]:formatObjectExpansion(f[m],h);break;case"c":var v=e.logger.name;if(l){var y=parseInt(l,10),_=e.logger.name.split(".");p=y>=_.length?v:_.slice(_.length-y).join(".")}else p=v;break;case"d":var b=PatternLayout.ISO8601_DATEFORMAT;l&&("ISO8601"==(b=l)?b=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==b?b=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==b&&(b=PatternLayout.DATETIME_DATEFORMAT)),p=new SimpleDateFormat(b).format(e.timeStamp);break;case"f":if(this.hasCustomFields()){var S=0;l&&(S=parseInt(l,10),isNaN(S)?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - should be a number"):0===S?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - must be greater than zero"):S>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - there aren't that many custom fields"):S-=1);var w=this.customFields[S].value;"function"==typeof w&&(w=w(this,e)),p=w}break;case"n":p=newLine;break;case"p":p=e.level.name;break;case"r":p=""+e.timeStamp.getDifference(applicationStartDate);break;case"%":p="%";break;default:p=i}if(s){c=parseInt(s.substr(1),10);var E=p.length;c<E&&(p=p.substring(E-c,E))}if(a)if("-"==a.charAt(0))for(c=parseInt(a.substr(1),10);p.length<c;)p+=" ";else for(c=parseInt(a,10);p.length<c;)p=" "+p;n+=p}o=o.substr(t.index+t[0].length)}return n},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(e){alert(this.getLayout().formatWithException(e))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(t){var e,r=this,n=function(){var e=r.getLayout().formatWithException(t);return"string"==typeof e?[e]:e};if((e=window.console)&&e.log){var o,i=n();e[o=e.debug&&Level.DEBUG.isGreaterOrEqual(t.level)?"debug":e.info&&Level.INFO.equals(t.level)?"info":e.warn&&Level.WARN.equals(t.level)?"warn":e.error&&t.level.isGreaterOrEqual(Level.ERROR)?"error":"log"].apply?e[o].apply(e,i):e[o](i)}else"undefined"!=typeof opera&&opera.postError&&opera.postError(n())},BrowserConsoleAppender.prototype.group=function(e){window.console&&window.console.group&&window.console.group(e)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(e){for(var t,r=null,n=0,o=xmlHttpFactories.length;n<o;n++){t=xmlHttpFactories[n];try{return r=t(),withCredentialsSupported=t==xhrFactory&&"withCredentials"in r,getXmlHttp=t,r}catch(e){}}e?e():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")},ConsoleAppender;function isHttpRequestSuccessful(e){return isUndefined(e.status)||0===e.status||200<=e.status&&e.status<300||1223==e.status}function AjaxAppender(s,d){var o=this,l=!0;s||(handleError("AjaxAppender: URL must be specified in constructor"),l=!1);var i=this.defaults.timed,a=this.defaults.waitForResponse,u=this.defaults.batchSize,t=this.defaults.timerInterval,c=this.defaults.requestSuccessCallback,p=this.defaults.failCallback,h=this.defaults.postVarName,f=this.defaults.sendAllOnUnload,m=this.defaults.contentType,r=null,g=[],v=[],y=[],_=!1,b=!1;function n(e){return!b||(handleError("AjaxAppender: configuration option '"+e+"' may not be set after the appender has been initialized"),!1)}function S(){var e;if(l&&enabled)if(_=!0,a)0<v.length?C(E(e=v.shift()),S):(_=!1,i&&I());else{for(;e=v.shift();)C(E(e));_=!1,i&&I()}}function w(){var e=!1;if(l&&enabled){for(var t,r=o.getLayout().allowBatching()?u:1,n=[];t=g.shift();)n.push(t),g.length>=r&&(v.push(n),n=[]);0<n.length&&v.push(n),e=0<v.length,i=a=!1,S()}return e}function E(e){for(var t,r=[],n="";t=e.shift();)r.push(o.getLayout().formatWithException(t));return n=1==e.length?r.join(""):o.getLayout().batchHeader+r.join(o.getLayout().batchSeparator)+o.getLayout().batchFooter,m==o.defaults.contentType&&(0<(n=o.getLayout().returnsPostData?n:urlEncode(h)+"="+urlEncode(n)).length&&(n+="&"),n+="layout="+urlEncode(o.getLayout().toString())),n}function I(){window.setTimeout(S,t)}function T(){var e="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(e),l=!1,p&&p(e)}function C(e,t){try{var r=getXmlHttp(T);if(l){r.onreadystatechange=function(){if(4==r.readyState){if(isHttpRequestSuccessful(r))c&&c(r),t&&t(r);else{var e="AjaxAppender.append: XMLHttpRequest request to URL "+s+" returned status code "+r.status;handleError(e),p&&p(e)}r.onreadystatechange=emptyFunction,r=null}},r.open("POST",s,!0),d&&withCredentialsSupported&&(r.withCredentials=!0);try{for(var n,o=0;n=y[o++];)r.setRequestHeader(n.name,n.value);r.setRequestHeader("Content-Type",m)}catch(e){var i="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(i),l=!1,void(p&&p(i))}r.send(e)}}catch(e){var a="AjaxAppender.append: error sending log message to "+s;handleError(a,e),l=!1,p&&p(a+". Details: "+getExceptionStringRep(e))}}this.getSessionId=function(){return r},this.setSessionId=function(e){r=extractStringFromParam(e,null),this.layout.setCustomField("sessionid",r)},this.setLayout=function(e){n("layout")&&(this.layout=e,null!==r&&this.setSessionId(r))},this.isTimed=function(){return i},this.setTimed=function(e){n("timed")&&(i=bool(e))},this.getTimerInterval=function(){return t},this.setTimerInterval=function(e){n("timerInterval")&&(t=extractIntFromParam(e,t))},this.isWaitForResponse=function(){return a},this.setWaitForResponse=function(e){n("waitForResponse")&&(a=bool(e))},this.getBatchSize=function(){return u},this.setBatchSize=function(e){n("batchSize")&&(u=extractIntFromParam(e,u))},this.isSendAllOnUnload=function(){return f},this.setSendAllOnUnload=function(e){n("sendAllOnUnload")&&(f=extractBooleanFromParam(e,f))},this.setRequestSuccessCallback=function(e){c=extractFunctionFromParam(e,c)},this.setFailCallback=function(e){p=extractFunctionFromParam(e,p)},this.getPostVarName=function(){return h},this.setPostVarName=function(e){n("postVarName")&&(h=extractStringFromParam(e,h))},this.getHeaders=function(){return y},this.addHeader=function(e,t){"content-type"==e.toLowerCase()?m=t:y.push({name:e,value:t})},this.sendAll=S,this.sendAllRemaining=w,this.append=function(e){if(l){b||function(){if(b=!0,f){var e=window.onbeforeunload;window.onbeforeunload=function(){e&&e(),w()}}i&&I()}(),g.push(e);var t=this.getLayout().allowBatching()?u:1;if(g.length>=t){for(var r,n=[];r=g.shift();)n.push(r);v.push(n),i||a&&(!a||_)||S()}}}}function setCookie(e,t,r,n){var o;if(n=n?"; path="+n:"",r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="; expires="+i.toGMTString()}else o="";document.cookie=escape(e)+"="+escape(t)+o+n}function getCookie(e){for(var t=escape(e)+"=",r=document.cookie.split(";"),n=0,o=r.length;n<o;n++){for(var i=r[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return unescape(i.substring(t.length,i.length))}return null}function getBaseUrl(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t)if(-1!=e[t].src.indexOf("log4javascript")){var n=e[t].src.lastIndexOf("/");return-1==n?"":e[t].src.substr(0,n+1)}return null}function isLoaded(e){try{return bool(e.loaded)}catch(e){return!1}}function padWithSpaces(e,t){if(e.length<t){for(var r=[],n=Math.max(0,t-e.length),o=0;o<n;o++)r[o]=" ";e+=r.join("")}return e}function createDefaultLogger(){var e=log4javascript.getLogger(defaultLoggerName),t=new log4javascript.PopUpAppender;return e.addAppender(t),e}if(AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender,function(){var ee=[],te=1;function e(e,t,r,n,o){this.create(!1,null,e,t,r,n,o,this.defaults.focusPopUp)}function t(e,t,r,n,o,i){this.create(!0,e,t,r,n,o,i,!1)}(ConsoleAppender=function(){}).prototype=new Appender,ConsoleAppender.prototype.create=function(e,r,t,s,d,l,u,n){var h=this,o=!1,c=!1,p=!1,f=!1,i=[],m=!0,g=te++;s=extractBooleanFromParam(s,this.defaults.initiallyMinimized),t=extractBooleanFromParam(t,this.defaults.lazyInit),d=extractBooleanFromParam(d,this.defaults.useDocumentWrite);var a=this.defaults.newestMessageAtTop,v=this.defaults.scrollToLatestMessage;l=l||this.defaults.width,u=u||this.defaults.height;var y,_,b,S,w,E=this.defaults.maxMessages,I=this.defaults.showCommandLine,T=this.defaults.commandLineObjectExpansionDepth,C=this.defaults.showHideButton,R=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var P=e?"InPageAppender":"PopUpAppender",k=function(e){return!c||(handleError(P+": configuration option '"+e+"' may not be set after the appender has been initialized"),!1)},x=function(){return p&&m&&!f};this.isNewestMessageAtTop=function(){return a},this.setNewestMessageAtTop=function(e){a=bool(e),x()&&S().setNewestAtTop(a)},this.isScrollToLatestMessage=function(){return v},this.setScrollToLatestMessage=function(e){v=bool(e),x()&&S().setScrollToLatest(v)},this.getWidth=function(){return l},this.setWidth=function(e){k("width")&&(l=extractStringFromParam(e,l))},this.getHeight=function(){return u},this.setHeight=function(e){k("height")&&(u=extractStringFromParam(e,u))},this.getMaxMessages=function(){return E},this.setMaxMessages=function(e){E=extractIntFromParam(e,E),x()&&S().setMaxMessages(E)},this.isShowCommandLine=function(){return I},this.setShowCommandLine=function(e){I=bool(e),x()&&S().setShowCommandLine(I)},this.isShowHideButton=function(){return C},this.setShowHideButton=function(e){C=bool(e),x()&&S().setShowHideButton(C)},this.isShowCloseButton=function(){return R},this.setShowCloseButton=function(e){R=bool(e),x()&&S().setShowCloseButton(R)},this.getCommandLineObjectExpansionDepth=function(){return T},this.setCommandLineObjectExpansionDepth=function(e){T=extractIntFromParam(e,T)};var M=s;function A(e,t){this.loggingEvent=e,this.levelName=e.level.name,this.formattedMessage=t}function O(e,t){this.name=e,this.initiallyExpanded=t}function U(){}this.isInitiallyMinimized=function(){return s},this.setInitiallyMinimized=function(e){k("initiallyMinimized")&&(s=bool(e),M=s)},this.isUseDocumentWrite=function(){return d},this.setUseDocumentWrite=function(e){k("useDocumentWrite")&&(d=bool(e))},A.prototype.append=function(){S().log(this.levelName,this.formattedMessage)},O.prototype.append=function(){S().group(this.name,this.initiallyExpanded)},U.prototype.append=function(){S().groupEnd()};var D=function(){b(),o?f&&$&&_():y(),b()&&L()};this.append=function(e){if(m){var t=h.getLayout().formatWithException(e);i.push(new A(e,t)),D()}},this.group=function(e,t){m&&(i.push(new O(e,t)),D())},this.groupEnd=function(){m&&(i.push(new U),D())};var L=function(){for(;0<i.length;)i.shift().append();n&&S().focus()};this.setAddedToLogger=function(e){this.loggers.push(e),enabled&&!t&&y()},this.clear=function(){x()&&S().clearLog(),i.length=0},this.focus=function(){x()&&S().focus()},this.focusCommandLine=function(){x()&&S().focusCommandLine()},this.focusSearch=function(){x()&&S().focusSearch()};var H=window;this.getCommandWindow=function(){return H},this.setCommandWindow=function(e){H=e},this.executeLastCommand=function(){x()&&S().evalLastCommand()};var N=new PatternLayout("%m");this.getCommandLayout=function(){return N},this.setCommandLayout=function(e){N=e},this.evalCommandAndAppend=function(e){var t={appendResult:!0,isError:!1},r="";try{var n,o;!H.eval&&H.execScript&&H.execScript("null");var i={};for(o=0,len=B.length;o<len;o++)i[B[o][0]]=B[o][1];var a=[],s=function(e){a.push([e,H[e]])};s("appender"),H.appender=h,s("commandReturnValue"),H.commandReturnValue=t,s("commandLineFunctionsHash"),H.commandLineFunctionsHash=i;var d=function(e){s(e),H[e]=function(){return this.commandLineFunctionsHash[e](h,arguments,t)}};for(o=0,len=B.length;o<len;o++)d(B[o][0]);for(r=isUndefined(n=H===window&&H.execScript?(s("evalExpr"),s("result"),window.evalExpr=e,H.execScript("window.result=eval(window.evalExpr);"),window.result):H.eval(e))?n:formatObjectExpansion(n,T),o=0,len=a.length;o<len;o++)H[a[o][0]]=a[o][1]}catch(e){r="Error evaluating command: "+getExceptionStringRep(e),t.isError=!0}if(t.appendResult){var l=">>> "+e;isUndefined(r)||(l+=newLine+r);var u=t.isError?Level.ERROR:Level.INFO,c=new LoggingEvent(null,new Date,u,[l],null),p=this.getLayout();this.setLayout(N),this.append(c),this.setLayout(p)}};var B=ee.concat([]);this.addCommandLineFunction=function(e,t){B.push([e,t])};var j="log4javascriptCommandHistory";this.storeCommandHistory=function(e){setCookie(j,e.join(","))};var V=function(e){var t=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"\t<head>","\t\t<title>log4javascript</title>",'\t\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\t\t\x3c!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work --\x3e",'\t\t<meta http-equiv="X-UA-Compatible" content="IE=7" />','\t\t<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','\t\t\x3c!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]--\x3e','\t\t\x3c!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]--\x3e','\t\t<script type="text/javascript">',"\t\t\t//<![CDATA[","\t\t\tvar loggingEnabled = true;","\t\t\tvar logQueuedEventsTimer = null;","\t\t\tvar logEntries = [];","\t\t\tvar logEntriesAndSeparators = [];","\t\t\tvar logItems = [];","\t\t\tvar renderDelay = 100;","\t\t\tvar unrenderedLogItemsExist = false;","\t\t\tvar rootGroup, currentGroup = null;","\t\t\tvar loaded = false;","\t\t\tvar currentLogItem = null;","\t\t\tvar logMainContainer;","","\t\t\tfunction copyProperties(obj, props) {","\t\t\t\tfor (var i in props) {","\t\t\t\t\tobj[i] = props[i];","\t\t\t\t}","\t\t\t}","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItem() {","\t\t\t}","","\t\t\tLogItem.prototype = {","\t\t\t\tmainContainer: null,","\t\t\t\twrappedContainer: null,","\t\t\t\tunwrappedContainer: null,","\t\t\t\tgroup: null,","","\t\t\t\tappendToLog: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].appendToLog();","\t\t\t\t\t}","\t\t\t\t\tthis.group.update();","\t\t\t\t},","","\t\t\t\tdoRemove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].remove();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = null;","\t\t\t\t\t\tthis.wrappedElementContainer = null;","\t\t\t\t\t\tthis.mainElementContainer = null;","\t\t\t\t\t}","\t\t\t\t\tif (this.group && removeFromGroup) {","\t\t\t\t\t\tthis.group.removeChild(this, doUpdate);","\t\t\t\t\t}","\t\t\t\t\tif (this === currentLogItem) {","\t\t\t\t\t\tcurrentLogItem = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\trender: function() {},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visit(this);","\t\t\t\t},","","\t\t\t\tgetUnwrappedDomContainer: function() {","\t\t\t\t\treturn this.group.unwrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetWrappedDomContainer: function() {","\t\t\t\t\treturn this.group.wrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetMainDomContainer: function() {","\t\t\t\t\treturn this.group.mainElementContainer.contentDiv;","\t\t\t\t}","\t\t\t};","","\t\t\tLogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContainerElement() {","\t\t\t}","","\t\t\tLogItemContainerElement.prototype = {","\t\t\t\tappendToLog: function() {","\t\t\t\t\tvar insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","\t\t\t\t\tif (insertBeforeFirst) {","\t\t\t\t\t\tthis.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.containerDomNode.appendChild(this.mainDiv);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction SeparatorElementContainer(containerDomNode) {","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "separator";','\t\t\t\tthis.mainDiv.innerHTML = "&nbsp;";',"\t\t\t}","","\t\t\tSeparatorElementContainer.prototype = new LogItemContainerElement();","","\t\t\tSeparatorElementContainer.prototype.remove = function() {","\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\tthis.mainDiv = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Separator() {","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tSeparator.prototype = new LogItem();","","\t\t\tcopyProperties(Separator.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","\t\t\t\tthis.group = group;","\t\t\t\tthis.containerDomNode = containerDomNode;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.isWrapped = isWrapped;","\t\t\t\tthis.expandable = false;","","\t\t\t\tif (this.isRoot) {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.contentDiv = logMainContainer.appendChild(document.createElement("div"));','\t\t\t\t\t\tthis.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentDiv = logMainContainer;","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tvar groupElementContainer = this;","\t\t\t\t\t",'\t\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\t\tthis.mainDiv.className = "group";',"",'\t\t\t\t\tthis.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tthis.headingDiv.className = "groupheading";',"",'\t\t\t\t\tthis.expander = this.headingDiv.appendChild(document.createElement("span"));','\t\t\t\t\tthis.expander.className = "expander unselectable greyedout";',"\t\t\t\t\tthis.expander.unselectable = true;",'\t\t\t\t\tvar expanderText = this.group.expanded ? "-" : "+";',"\t\t\t\t\tthis.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","\t\t\t\t\t",'\t\t\t\t\tthis.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'\t\t\t\t\tthis.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tvar contentCssClass = this.group.expanded ? "expanded" : "collapsed";','\t\t\t\t\tthis.contentDiv.className = "groupcontent " + contentCssClass;',"","\t\t\t\t\tthis.expander.onclick = function() {","\t\t\t\t\t\tif (groupElementContainer.group.expandable) {","\t\t\t\t\t\t\tgroupElementContainer.group.toggleExpanded();","\t\t\t\t\t\t}","\t\t\t\t\t};","\t\t\t\t}","\t\t\t}","","\t\t\tGroupElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(GroupElementContainer.prototype, {","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tvar oldCssClass, newCssClass, expanderText;","\t\t\t\t\t\tif (this.group.expanded) {",'\t\t\t\t\t\t\tnewCssClass = "expanded";','\t\t\t\t\t\t\toldCssClass = "collapsed";','\t\t\t\t\t\t\texpanderText = "-";',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tnewCssClass = "collapsed";','\t\t\t\t\t\t\toldCssClass = "expanded";','\t\t\t\t\t\t\texpanderText = "+";',"\t\t\t\t\t\t}","\t\t\t\t\t\treplaceClass(this.contentDiv, newCssClass, oldCssClass);","\t\t\t\t\t\tthis.expanderTextNode.nodeValue = expanderText;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tthis.headingDiv = null;","\t\t\t\t\t\tthis.expander.onclick = null;","\t\t\t\t\t\tthis.expander = null;","\t\t\t\t\t\tthis.expanderTextNode = null;","\t\t\t\t\t\tthis.contentDiv = null;","\t\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\t// Invert the order of the log entries","\t\t\t\t\tvar node = null;","","\t\t\t\t\t// Remove all the log container nodes","\t\t\t\t\tvar childDomNodes = [];","\t\t\t\t\twhile ((node = this.contentDiv.firstChild)) {","\t\t\t\t\t\tthis.contentDiv.removeChild(node);","\t\t\t\t\t\tchildDomNodes.push(node);","\t\t\t\t\t}","","\t\t\t\t\t// Put them all back in reverse order","\t\t\t\t\twhile ((node = childDomNodes.pop())) {","\t\t\t\t\t\tthis.contentDiv.appendChild(node);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tif (this.group.expandable) {",'\t\t\t\t\t\t\tremoveClass(this.expander, "greyedout");',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\taddClass(this.expander, "greyedout");',"\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tif (this.isRoot) {",'\t\t\t\t\t\tthis.contentDiv.innerHTML = "";',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Group(name, isRoot, initiallyExpanded) {","\t\t\t\tthis.name = name;","\t\t\t\tthis.group = null;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.initiallyExpanded = initiallyExpanded;","\t\t\t\tthis.elementContainers = [];","\t\t\t\tthis.children = [];","\t\t\t\tthis.expanded = initiallyExpanded;","\t\t\t\tthis.rendered = false;","\t\t\t\tthis.expandable = false;","\t\t\t}","","\t\t\tGroup.prototype = new LogItem();","","\t\t\tcopyProperties(Group.prototype, {","\t\t\t\taddChild: function(logItem) {","\t\t\t\t\tthis.children.push(logItem);","\t\t\t\t\tlogItem.group = this;","\t\t\t\t},","","\t\t\t\trender: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tvar unwrappedDomContainer, wrappedDomContainer;","\t\t\t\t\t\tif (this.isRoot) {","\t\t\t\t\t\t\tunwrappedDomContainer = logMainContainer;","\t\t\t\t\t\t\twrappedDomContainer = logMainContainer;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tunwrappedDomContainer = this.getUnwrappedDomContainer();","\t\t\t\t\t\t\twrappedDomContainer = this.getWrappedDomContainer();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tvar mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","\t\t\t\t\t\tthis.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tthis.expanded = !this.expanded;","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\texpand: function() {","\t\t\t\t\tif (!this.expanded) {","\t\t\t\t\t\tthis.toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitGroup(this);","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].reverseChildren();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tvar previouslyExpandable = this.expandable;","\t\t\t\t\tthis.expandable = (this.children.length !== 0);","\t\t\t\t\tif (this.expandable !== previouslyExpandable) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].update();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tflatten: function() {","\t\t\t\t\tvar visitor = new GroupFlattener();","\t\t\t\t\tthis.accept(visitor);","\t\t\t\t\treturn visitor.logEntriesAndSeparators;","\t\t\t\t},","","\t\t\t\tremoveChild: function(child, doUpdate) {","\t\t\t\t\tarray_remove(this.children, child);","\t\t\t\t\tchild.group = null;","\t\t\t\t\tif (doUpdate) {","\t\t\t\t\t\tthis.update();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].remove(false, false);","\t\t\t\t\t}","\t\t\t\t\tthis.children = [];","\t\t\t\t\tthis.update();","\t\t\t\t\tif (this === currentGroup) {","\t\t\t\t\t\tcurrentGroup = this.group;","\t\t\t\t\t}","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].serialize(items);","\t\t\t\t\t}","\t\t\t\t\tif (this !== currentGroup) {","\t\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_END]);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clear();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryElementContainer() {","\t\t\t}","","\t\t\tLogEntryElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(LogEntryElementContainer.prototype, {","\t\t\t\tremove: function() {","\t\t\t\t\tthis.doRemove();","\t\t\t\t},","","\t\t\t\tdoRemove: function() {","\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\tthis.contentElement = null;","\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentElement.innerHTML = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {",'\t\t\t\t\tvar oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','\t\t\t\t\tvar newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"\t\t\t\t\treplaceClass(this.mainDiv, newCssClass, oldCssClass);","\t\t\t\t},","","\t\t\t\tclearSearch: function() {",'\t\t\t\t\tremoveClass(this.mainDiv, "searchmatch");','\t\t\t\t\tremoveClass(this.mainDiv, "searchnonmatch");',"\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryWrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");',"\t\t\t\tthis.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"\t\t\t\tthis.contentElement = this.mainDiv;","\t\t\t}","","\t\t\tLogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t} else {","\t\t\t\t\tthis.contentElement.innerHTML = wrappedContent;","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','\t\t\t\tthis.pre = this.mainDiv.appendChild(document.createElement("pre"));',"\t\t\t\tthis.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.pre.className = "unwrapped";',"\t\t\t\tthis.contentElement = this.pre;","\t\t\t}","","\t\t\tLogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryUnwrappedElementContainer.prototype.remove = function() {","\t\t\t\tthis.doRemove();","\t\t\t\tthis.pre = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryMainElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','\t\t\t\tthis.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","\t\t\t}","","\t\t\tLogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntry(level, formattedMessage) {","\t\t\t\tthis.level = level;","\t\t\t\tthis.formattedMessage = formattedMessage;","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tLogEntry.prototype = new LogItem();","","\t\t\tcopyProperties(LogEntry.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar logEntry = this;","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","","\t\t\t\t\t// Support for the CSS attribute white-space in IE for Windows is","\t\t\t\t\t// non-existent pre version 6 and slightly odd in 6, so instead","\t\t\t\t\t// use two different HTML elements","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\tthis.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content != this.content) {","\t\t\t\t\t\tif (isIe && (content !== this.formattedMessage)) {",'\t\t\t\t\t\t\tcontent = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\t}","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].setContent(content, wrappedContent);","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.content = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tgetSearchMatches: function() {","\t\t\t\t\tvar matches = [];","\t\t\t\t\tvar i, len;","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tvar unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','\t\t\t\t\t\tvar wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = unwrappedEls.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tvar els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = els.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, els[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn matches;","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].setSearchMatch(isMatch);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclearSearch: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clearSearch();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitLogEntry(this);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemVisitor() {","\t\t\t}","","\t\t\tLogItemVisitor.prototype = {","\t\t\t\tvisit: function(logItem) {","\t\t\t\t},","","\t\t\t\tvisitParent: function(logItem) {","\t\t\t\t\tif (logItem.group) {","\t\t\t\t\t\tlogItem.group.accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitChildren: function(logItem) {","\t\t\t\t\tfor (var i = 0, len = logItem.children.length; i < len; i++) {","\t\t\t\t\t\tlogItem.children[i].accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitLogEntry: function(logEntry) {","\t\t\t\t\tthis.visit(logEntry);","\t\t\t\t},","","\t\t\t\tvisitSeparator: function(separator) {","\t\t\t\t\tthis.visit(separator);","\t\t\t\t},","","\t\t\t\tvisitGroup: function(group) {","\t\t\t\t\tthis.visit(group);","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupFlattener() {","\t\t\t\tthis.logEntriesAndSeparators = [];","\t\t\t}","","\t\t\tGroupFlattener.prototype = new LogItemVisitor();","","\t\t\tGroupFlattener.prototype.visitGroup = function(group) {","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitLogEntry = function(logEntry) {","\t\t\t\tthis.logEntriesAndSeparators.push(logEntry);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitSeparator = function(separator) {","\t\t\t\tthis.logEntriesAndSeparators.push(separator);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\twindow.onload = function() {","\t\t\t\t// Sort out document.domain","\t\t\t\tif (location.search) {",'\t\t\t\t\tvar queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"\t\t\t\t\tfor (var i = 0, len = queryBits.length; i < len; i++) {",'\t\t\t\t\t\tnameValueBits = queryBits[i].split("=");','\t\t\t\t\t\tif (nameValueBits[0] == "log4javascript_domain") {',"\t\t\t\t\t\t\tdocument.domain = nameValueBits[1];","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","","\t\t\t\t// Create DOM objects",'\t\t\t\tlogMainContainer = $("log");',"\t\t\t\tif (isIePre7) {",'\t\t\t\t\taddClass(logMainContainer, "oldIe");',"\t\t\t\t}","",'\t\t\t\trootGroup = new Group("root", true);',"\t\t\t\trootGroup.render();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\t","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t\ttoggleLoggingEnabled();","\t\t\t\ttoggleSearchEnabled();","\t\t\t\ttoggleSearchFilter();","\t\t\t\ttoggleSearchHighlight();","\t\t\t\tapplyFilters();","\t\t\t\tcheckAllLevels();","\t\t\t\ttoggleWrap();","\t\t\t\ttoggleNewestAtTop();","\t\t\t\ttoggleScrollToLatest();","\t\t\t\trenderQueuedLogItems();","\t\t\t\tloaded = true;",'\t\t\t\t$("command").value = "";','\t\t\t\t$("command").autocomplete = "off";','\t\t\t\t$("command").onkeydown = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","\t\t\t\t\t\tevalCommandLine();","\t\t\t\t\t\tstopPropagation(evt);","\t\t\t\t\t} else if (evt.keyCode == 27) { // Escape",'\t\t\t\t\t\tthis.value = "";',"\t\t\t\t\t\tthis.focus();","\t\t\t\t\t} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","\t\t\t\t\t\tcurrentCommandIndex = Math.max(0, currentCommandIndex - 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","\t\t\t\t\t\tcurrentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keypress moving the caret in Firefox",'\t\t\t\t$("command").onkeypress = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keyup event blurring the input in Opera",'\t\t\t\t$("command").onkeyup = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 27 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t\tthis.focus();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Add document keyboard shortcuts","\t\t\t\tdocument.onkeydown = function keyEventHandler(evt) {","\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tswitch (evt.keyCode) {","\t\t\t\t\t\tcase 69: // Ctrl + shift + E: re-execute last command","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tevalLastCommand();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 75: // Ctrl + shift + K: focus search","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusSearch();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 40: // Ctrl + shift + down arrow: focus command line","\t\t\t\t\t\tcase 76: // Ctrl + shift + L: focus command line","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusCommandLine();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Workaround to make sure log div starts at the correct size","\t\t\t\tsetTimeout(setLogContainerHeight, 20);","","\t\t\t\tsetShowCommandLine(showCommandLine);","\t\t\t\tdoSearch();","\t\t\t};","","\t\t\twindow.onunload = function() {","\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\tappender.unload();","\t\t\t\t}","\t\t\t\tappender = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction toggleLoggingEnabled() {",'\t\t\t\tsetLoggingEnabled($("enableLogging").checked);',"\t\t\t}","","\t\t\tfunction setLoggingEnabled(enable) {","\t\t\t\tloggingEnabled = enable;","\t\t\t}","","\t\t\tvar appender = null;","","\t\t\tfunction setAppender(appenderParam) {","\t\t\t\tappender = appenderParam;","\t\t\t}","","\t\t\tfunction setShowCloseButton(showCloseButton) {",'\t\t\t\t$("closeButton").style.display = showCloseButton ? "inline" : "none";',"\t\t\t}","","\t\t\tfunction setShowHideButton(showHideButton) {",'\t\t\t\t$("hideButton").style.display = showHideButton ? "inline" : "none";',"\t\t\t}","","\t\t\tvar newestAtTop = false;","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContentReverser() {","\t\t\t}","\t\t\t","\t\t\tLogItemContentReverser.prototype = new LogItemVisitor();","\t\t\t","\t\t\tLogItemContentReverser.prototype.visitGroup = function(group) {","\t\t\t\tgroup.reverseChildren();","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction setNewestAtTop(isNewestAtTop) {","\t\t\t\tvar oldNewestAtTop = newestAtTop;","\t\t\t\tvar i, iLen, j, jLen;","\t\t\t\tnewestAtTop = Boolean(isNewestAtTop);","\t\t\t\tif (oldNewestAtTop != newestAtTop) {","\t\t\t\t\tvar visitor = new LogItemContentReverser();","\t\t\t\t\trootGroup.accept(visitor);","","\t\t\t\t\t// Reassemble the matches array","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tvar matchIndex = 0;","\t\t\t\t\t\tvar matches = [];","\t\t\t\t\t\tvar actOnLogEntry = function(logEntry) {","\t\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\t\tfor (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","\t\t\t\t\t\t\t\tmatches[matchIndex] = logEntryMatches[j];","\t\t\t\t\t\t\t\tif (currentMatch && logEntryMatches[j].equals(currentMatch)) {","\t\t\t\t\t\t\t\t\tcurrentMatchIndex = matchIndex;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tmatchIndex++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t};","\t\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\t\tfor (i = logEntries.length - 1; i >= 0; i--) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfor (i = 0, iLen = logEntries.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tcurrentSearch.matches = matches;","\t\t\t\t\t\tif (currentMatch) {","\t\t\t\t\t\t\tcurrentMatch.setCurrent();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (scrollToLatest) {","\t\t\t\t\t\tdoScrollToLatest();","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\t$("newestAtTop").checked = isNewestAtTop;',"\t\t\t}","","\t\t\tfunction toggleNewestAtTop() {",'\t\t\t\tvar isNewestAtTop = $("newestAtTop").checked;',"\t\t\t\tsetNewestAtTop(isNewestAtTop);","\t\t\t}","","\t\t\tvar scrollToLatest = true;","","\t\t\tfunction setScrollToLatest(isScrollToLatest) {","\t\t\t\tscrollToLatest = isScrollToLatest;","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}",'\t\t\t\t$("scrollToLatest").checked = isScrollToLatest;',"\t\t\t}","","\t\t\tfunction toggleScrollToLatest() {",'\t\t\t\tvar isScrollToLatest = $("scrollToLatest").checked;',"\t\t\t\tsetScrollToLatest(isScrollToLatest);","\t\t\t}","","\t\t\tfunction doScrollToLatest() {","\t\t\t\tvar l = logMainContainer;",'\t\t\t\tif (typeof l.scrollTop != "undefined") {',"\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\tl.scrollTop = 0;","\t\t\t\t\t} else {","\t\t\t\t\t\tvar latestLogEntry = l.lastChild;","\t\t\t\t\t\tif (latestLogEntry) {","\t\t\t\t\t\t\tl.scrollTop = l.scrollHeight;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tvar closeIfOpenerCloses = true;","","\t\t\tfunction setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","\t\t\t\tcloseIfOpenerCloses = isCloseIfOpenerCloses;","\t\t\t}","","\t\t\tvar maxMessages = null;","","\t\t\tfunction setMaxMessages(max) {","\t\t\t\tmaxMessages = max;","\t\t\t\tpruneLogEntries();","\t\t\t}","","\t\t\tvar showCommandLine = false;","","\t\t\tfunction setShowCommandLine(isShowCommandLine) {","\t\t\t\tshowCommandLine = isShowCommandLine;","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("commandLine").style.display = showCommandLine ? "block" : "none";',"\t\t\t\t\tsetCommandInputWidth();","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusCommandLine() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("command").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusSearch() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("searchBox").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction getLogItems() {","\t\t\t\tvar items = [];","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tlogItems[i].serialize(items);","\t\t\t\t}","\t\t\t\treturn items;","\t\t\t}","","\t\t\tfunction setLogItems(items) {","\t\t\t\tvar loggingReallyEnabled = loggingEnabled;","\t\t\t\t// Temporarily turn logging on","\t\t\t\tloggingEnabled = true;","\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {","\t\t\t\t\tswitch (items[i][0]) {","\t\t\t\t\t\tcase LogItem.serializedItemKeys.LOG_ENTRY:","\t\t\t\t\t\t\tlog(items[i][1], items[i][2]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_START:","\t\t\t\t\t\t\tgroup(items[i][1]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_END:","\t\t\t\t\t\t\tgroupEnd();","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tloggingEnabled = loggingReallyEnabled;","\t\t\t}","","\t\t\tfunction log(logLevel, formattedMessage) {","\t\t\t\tif (loggingEnabled) {","\t\t\t\t\tvar logEntry = new LogEntry(logLevel, formattedMessage);","\t\t\t\t\tlogEntries.push(logEntry);","\t\t\t\t\tlogEntriesAndSeparators.push(logEntry);","\t\t\t\t\tlogItems.push(logEntry);","\t\t\t\t\tcurrentGroup.addChild(logEntry);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction renderQueuedLogItems() {","\t\t\t\tlogQueuedEventsTimer = null;","\t\t\t\tvar pruned = pruneLogEntries();","","\t\t\t\t// Render any unrendered log entries and apply the current search to them","\t\t\t\tvar initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tif (!logItems[i].rendered) {","\t\t\t\t\t\tlogItems[i].render();","\t\t\t\t\t\tlogItems[i].appendToLog();","\t\t\t\t\t\tif (currentSearch && (logItems[i] instanceof LogEntry)) {","\t\t\t\t\t\t\tcurrentSearch.applyTo(logItems[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (pruned) {","\t\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}","\t\t\t\tunrenderedLogItemsExist = false;","\t\t\t}","","\t\t\tfunction pruneLogEntries() {","\t\t\t\tif ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","\t\t\t\t\tvar numberToDelete = logEntriesAndSeparators.length - maxMessages;","\t\t\t\t\tvar prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tcurrentSearch.removeMatches(prunedLogEntries);","\t\t\t\t\t}","\t\t\t\t\tvar group;","\t\t\t\t\tfor (var i = 0; i < numberToDelete; i++) {","\t\t\t\t\t\tgroup = logEntriesAndSeparators[i].group;","\t\t\t\t\t\tarray_remove(logItems, logEntriesAndSeparators[i]);","\t\t\t\t\t\tarray_remove(logEntries, logEntriesAndSeparators[i]);","\t\t\t\t\t\tlogEntriesAndSeparators[i].remove(true, true);","\t\t\t\t\t\tif (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","\t\t\t\t\t\t\tarray_remove(logItems, group);","\t\t\t\t\t\t\tgroup.remove(true, true);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tlogEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","\t\t\t\t\treturn true;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction group(name, startExpanded) {","\t\t\t\tif (loggingEnabled) {",'\t\t\t\t\tinitiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"\t\t\t\t\tvar newGroup = new Group(name, false, initiallyExpanded);","\t\t\t\t\tcurrentGroup.addChild(newGroup);","\t\t\t\t\tcurrentGroup = newGroup;","\t\t\t\t\tlogItems.push(newGroup);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction groupEnd() {","\t\t\t\tcurrentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","\t\t\t}","","\t\t\tfunction mainPageReloaded() {","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tvar separator = new Separator();","\t\t\t\tlogEntriesAndSeparators.push(separator);","\t\t\t\tlogItems.push(separator);","\t\t\t\tcurrentGroup.addChild(separator);","\t\t\t}","","\t\t\tfunction closeWindow() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.close(true);","\t\t\t\t} else {","\t\t\t\t\twindow.close();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hide() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.hide();","\t\t\t\t}","\t\t\t}","","\t\t\tvar mainWindow = window;",'\t\t\tvar windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","\t\t\tfunction setMainWindow(win) {","\t\t\t\tmainWindow = win;","\t\t\t\tmainWindow[windowId] = window;","\t\t\t\t// If this is a pop-up, poll the opener to see if it's closed","\t\t\t\tif (opener && closeIfOpenerCloses) {","\t\t\t\t\tpollOpener();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction pollOpener() {","\t\t\t\tif (closeIfOpenerCloses) {","\t\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\t\tsetTimeout(pollOpener, 500);","\t\t\t\t\t} else {","\t\t\t\t\t\tcloseWindow();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction mainWindowExists() {","\t\t\t\ttry {","\t\t\t\t\treturn (mainWindow && !mainWindow.closed &&","\t\t\t\t\t\tmainWindow[windowId] == window);","\t\t\t\t} catch (ex) {}","\t\t\t\treturn false;","\t\t\t}","",'\t\t\tvar logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","\t\t\tfunction getCheckBox(logLevel) {",'\t\t\t\treturn $("switch_" + logLevel);',"\t\t\t}","","\t\t\tfunction getIeWrappedLogContainer() {",'\t\t\t\treturn $("log_wrapped");',"\t\t\t}","","\t\t\tfunction getIeUnwrappedLogContainer() {",'\t\t\t\treturn $("log_unwrapped");',"\t\t\t}","","\t\t\tfunction applyFilters() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (getCheckBox(logLevels[i]).checked) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tupdateSearchFromFilters();","\t\t\t}","","\t\t\tfunction toggleAllLevels() {",'\t\t\t\tvar turnOn = $("switch_ALL").checked;',"\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tgetCheckBox(logLevels[i]).checked = turnOn;","\t\t\t\t\tif (turnOn) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction checkAllLevels() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (!getCheckBox(logLevels[i]).checked) {",'\t\t\t\t\t\tgetCheckBox("ALL").checked = false;',"\t\t\t\t\t\treturn;","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\tgetCheckBox("ALL").checked = true;',"\t\t\t}","","\t\t\tfunction clearLog() {","\t\t\t\trootGroup.clear();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tlogEntries = [];","\t\t\t\tlogItems = [];","\t\t\t\tlogEntriesAndSeparators = [];"," \t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction toggleWrap() {",'\t\t\t\tvar enable = $("wrap").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "wrap");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "wrap");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------- */","","\t\t\t// Search","","\t\t\tvar searchTimer = null;","","\t\t\tfunction scheduleSearch() {","\t\t\t\ttry {","\t\t\t\t\tclearTimeout(searchTimer);","\t\t\t\t} catch (ex) {","\t\t\t\t\t// Do nothing","\t\t\t\t}","\t\t\t\tsearchTimer = setTimeout(doSearch, 500);","\t\t\t}","","\t\t\tfunction Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","\t\t\t\tthis.searchTerm = searchTerm;","\t\t\t\tthis.isRegex = isRegex;","\t\t\t\tthis.searchRegex = searchRegex;","\t\t\t\tthis.isCaseSensitive = isCaseSensitive;","\t\t\t\tthis.matches = [];","\t\t\t}","","\t\t\tSearch.prototype = {","\t\t\t\thasMatches: function() {","\t\t\t\t\treturn this.matches.length > 0;","\t\t\t\t},","","\t\t\t\thasVisibleMatches: function() {","\t\t\t\t\tif (this.hasMatches()) {","\t\t\t\t\t\tfor (var i = 0; i < this.matches.length; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn false;","\t\t\t\t},","","\t\t\t\tmatch: function(logEntry) {","\t\t\t\t\tvar entryText = String(logEntry.formattedMessage);","\t\t\t\t\tvar matchesSearch = false;","\t\t\t\t\tif (this.isRegex) {","\t\t\t\t\t\tmatchesSearch = this.searchRegex.test(entryText);","\t\t\t\t\t} else if (this.isCaseSensitive) {","\t\t\t\t\t\tmatchesSearch = (entryText.indexOf(this.searchTerm) > -1);","\t\t\t\t\t} else {","\t\t\t\t\t\tmatchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","\t\t\t\t\t}","\t\t\t\t\treturn matchesSearch;","\t\t\t\t},","","\t\t\t\tgetNextVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the first match","\t\t\t\t\tfor (i = 0; i <= currentMatchIndex; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tgetPreviousVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex - 1; i >= 0; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the last match","\t\t\t\t\tfor (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tapplyTo: function(logEntry) {","\t\t\t\t\tvar doesMatch = this.match(logEntry);","\t\t\t\t\tif (doesMatch) {","\t\t\t\t\t\tlogEntry.group.expand();","\t\t\t\t\t\tlogEntry.setSearchMatch(true);","\t\t\t\t\t\tvar logEntryContent;","\t\t\t\t\t\tvar wrappedLogEntryContent;",'\t\t\t\t\t\tvar searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','\t\t\t\t\t\tvar searchTermReplacementEndTag = "<" + "/span>";','\t\t\t\t\t\tvar preTagName = isIe ? "pre" : "span";','\t\t\t\t\t\tvar preStartTag = "<" + preTagName + " class=\\"pre\\">";','\t\t\t\t\t\tvar preEndTag = "<" + "/" + preTagName + ">";',"\t\t\t\t\t\tvar startIndex = 0;","\t\t\t\t\t\tvar searchIndex, matchedText, textBeforeMatch;","\t\t\t\t\t\tif (this.isRegex) {",'\t\t\t\t\t\t\tvar flags = this.isCaseSensitive ? "g" : "gi";','\t\t\t\t\t\t\tvar capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","\t\t\t\t\t\t\t// Replace the search term with temporary tokens for the start and end tags",'\t\t\t\t\t\t\tvar rnd = ("" + Math.random()).substr(2);','\t\t\t\t\t\t\tvar startToken = "%%s" + rnd + "%%";','\t\t\t\t\t\t\tvar endToken = "%%e" + rnd + "%%";','\t\t\t\t\t\t\tlogEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","\t\t\t\t\t\t\t// Escape the HTML to get rid of angle brackets","\t\t\t\t\t\t\tlogEntryContent = escapeHtml(logEntryContent);","","\t\t\t\t\t\t\t// Substitute the proper HTML back in for the search match","\t\t\t\t\t\t\tvar result;","\t\t\t\t\t\t\tvar searchString = logEntryContent;",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\twhile ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","\t\t\t\t\t\t\t\tvar endTokenIndex = searchString.indexOf(endToken, searchIndex);","\t\t\t\t\t\t\t\tmatchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","\t\t\t\t\t\t\t\ttextBeforeMatch = searchString.substring(startIndex, searchIndex);","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","\t\t\t\t\t\t\t\t\tpreEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = endTokenIndex + endToken.length;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tlogEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += searchString.substr(startIndex);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\tvar searchTermReplacementLength = searchTermReplacementStartTag.length +","\t\t\t\t\t\t\t\tthis.searchTerm.length + searchTermReplacementEndTag.length;","\t\t\t\t\t\t\tvar searchTermLength = this.searchTerm.length;","\t\t\t\t\t\t\tvar searchTermLowerCase = this.searchTerm.toLowerCase();","\t\t\t\t\t\t\tvar logTextLowerCase = logEntry.formattedMessage.toLowerCase();","\t\t\t\t\t\t\twhile ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","\t\t\t\t\t\t\t\tmatchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","\t\t\t\t\t\t\t\ttextBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","\t\t\t\t\t\t\t\tvar searchTermReplacement = searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\tpreStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = searchIndex + searchTermLength;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","\t\t\t\t\t\t\tlogEntryContent += preStartTag + textAfterLastMatch + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += textAfterLastMatch;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tlogEntry.setContent(logEntryContent, wrappedLogEntryContent);","\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\tthis.matches = this.matches.concat(logEntryMatches);","\t\t\t\t\t} else {","\t\t\t\t\t\tlogEntry.setSearchMatch(false);","\t\t\t\t\t\tlogEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","\t\t\t\t\t}","\t\t\t\t\treturn doesMatch;","\t\t\t\t},","","\t\t\t\tremoveMatches: function(logEntries) {","\t\t\t\t\tvar matchesToRemoveCount = 0;","\t\t\t\t\tvar currentMatchRemoved = false;","\t\t\t\t\tvar matchesToRemove = [];","\t\t\t\t\tvar i, iLen, j, jLen;","","\t\t\t\t\t// Establish the list of matches to be removed","\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\tfor (j = 0, jLen = logEntries.length; j < jLen; j++) {","\t\t\t\t\t\t\tif (this.matches[i].belongsTo(logEntries[j])) {","\t\t\t\t\t\t\t\tmatchesToRemove.push(this.matches[i]);","\t\t\t\t\t\t\t\tif (i === currentMatchIndex) {","\t\t\t\t\t\t\t\t\tcurrentMatchRemoved = true;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Set the new current match index if the current match has been deleted","\t\t\t\t\t// This will be the first match that appears after the first log entry being","\t\t\t\t\t// deleted, if one exists; otherwise, it's the first match overall","\t\t\t\t\tvar newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","\t\t\t\t\tif (currentMatchRemoved) {","\t\t\t\t\t\tfor (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","\t\t\t\t\t\t\t\tnewMatch = this.matches[i];","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Remove the matches","\t\t\t\t\tfor (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","\t\t\t\t\t\tarray_remove(this.matches, matchesToRemove[i]);","\t\t\t\t\t\tmatchesToRemove[i].remove();","\t\t\t\t\t}","","\t\t\t\t\t// Set the new match, if one exists","\t\t\t\t\tif (this.hasVisibleMatches()) {","\t\t\t\t\t\tif (newMatch === null) {","\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t// Get the index of the new match","\t\t\t\t\t\t\tvar newMatchIndex = 0;","\t\t\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tif (newMatch === this.matches[i]) {","\t\t\t\t\t\t\t\t\tnewMatchIndex = i;","\t\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tsetCurrentMatchIndex(newMatchIndex);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tcurrentMatchIndex = null;","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tfunction getPageOffsetTop(el, container) {","\t\t\t\tvar currentEl = el;","\t\t\t\tvar y = 0;","\t\t\t\twhile (currentEl && currentEl != container) {","\t\t\t\t\ty += currentEl.offsetTop;","\t\t\t\t\tcurrentEl = currentEl.offsetParent;","\t\t\t\t}","\t\t\t\treturn y;","\t\t\t}","","\t\t\tfunction scrollIntoView(el) {","\t\t\t\tvar logContainer = logMainContainer;","\t\t\t\t// Check if the whole width of the element is visible and centre if not",'\t\t\t\tif (!$("wrap").checked) {',"\t\t\t\t\tvar logContainerLeft = logContainer.scrollLeft;","\t\t\t\t\tvar logContainerRight = logContainerLeft  + logContainer.offsetWidth;","\t\t\t\t\tvar elLeft = el.offsetLeft;","\t\t\t\t\tvar elRight = elLeft + el.offsetWidth;","\t\t\t\t\tif (elLeft < logContainerLeft || elRight > logContainerRight) {","\t\t\t\t\t\tlogContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Check if the whole height of the element is visible and centre if not","\t\t\t\tvar logContainerTop = logContainer.scrollTop;","\t\t\t\tvar logContainerBottom = logContainerTop  + logContainer.offsetHeight;","\t\t\t\tvar elTop = getPageOffsetTop(el) - getToolBarsHeight();","\t\t\t\tvar elBottom = elTop + el.offsetHeight;","\t\t\t\tif (elTop < logContainerTop || elBottom > logContainerBottom) {","\t\t\t\t\tlogContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","\t\t\t\tthis.logEntryLevel = logEntryLevel;","\t\t\t\tthis.spanInMainDiv = spanInMainDiv;","\t\t\t\tif (isIe) {","\t\t\t\t\tthis.spanInUnwrappedPre = spanInUnwrappedPre;","\t\t\t\t\tthis.spanInWrappedDiv = spanInWrappedDiv;","\t\t\t\t}","\t\t\t\tthis.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","\t\t\t}","","\t\t\tMatch.prototype = {","\t\t\t\tequals: function(match) {","\t\t\t\t\treturn this.mainSpan === match.mainSpan;","\t\t\t\t},","","\t\t\t\tsetCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\taddClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\taddClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t\t// Scroll the visible one into view",'\t\t\t\t\t\tvar elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"\t\t\t\t\t\tscrollIntoView(elementToScroll);","\t\t\t\t\t} else {",'\t\t\t\t\t\taddClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t\tscrollIntoView(this.spanInMainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tbelongsTo: function(logEntry) {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\treturn isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn isDescendant(this.spanInMainDiv, logEntry.mainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetNotCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tremoveClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\tremoveClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tisOrphan: function() {","\t\t\t\t\treturn isOrphan(this.mainSpan);","\t\t\t\t},","","\t\t\t\tisVisible: function() {","\t\t\t\t\treturn getCheckBox(this.logEntryLevel).checked;","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.spanInUnwrappedPre = null;","\t\t\t\t\t\tthis.spanInWrappedDiv = null;","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.spanInMainDiv = null;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tvar currentSearch = null;","\t\t\tvar currentMatchIndex = null;","","\t\t\tfunction doSearch() {",'\t\t\t\tvar searchBox = $("searchBox");',"\t\t\t\tvar searchTerm = searchBox.value;",'\t\t\t\tvar isRegex = $("searchRegex").checked;','\t\t\t\tvar isCaseSensitive = $("searchCaseSensitive").checked;',"\t\t\t\tvar i;","",'\t\t\t\tif (searchTerm === "") {','\t\t\t\t\t$("searchReset").disabled = true;','\t\t\t\t\t$("searchNav").style.display = "none";','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(searchBox, "hasmatches");','\t\t\t\t\tremoveClass(searchBox, "nomatches");',"\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tlogEntries[i].clearSearch();","\t\t\t\t\t\tlogEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","\t\t\t\t\t}","\t\t\t\t\tcurrentSearch = null;","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t} else {",'\t\t\t\t\t$("searchReset").disabled = false;','\t\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\t\tvar searchRegex;","\t\t\t\t\tvar regexValid;","\t\t\t\t\tif (isRegex) {","\t\t\t\t\t\ttry {",'\t\t\t\t\t\t\tsearchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"\t\t\t\t\t\t\tregexValid = true;",'\t\t\t\t\t\t\treplaceClass(searchBox, "validregex", "invalidregex");','\t\t\t\t\t\t\tsearchBox.title = "Valid regex";',"\t\t\t\t\t\t} catch (ex) {","\t\t\t\t\t\t\tregexValid = false;",'\t\t\t\t\t\t\treplaceClass(searchBox, "invalidregex", "validregex");','\t\t\t\t\t\t\tsearchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tsearchBox.title = "";','\t\t\t\t\t\tremoveClass(searchBox, "validregex");','\t\t\t\t\t\tremoveClass(searchBox, "invalidregex");',"\t\t\t\t\t}",'\t\t\t\t\taddClass(document.body, "searching");',"\t\t\t\t\tcurrentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tcurrentSearch.applyTo(logEntries[i]);","\t\t\t\t\t}","\t\t\t\t\tsetLogContainerHeight();","","\t\t\t\t\t// Highlight the first search match","\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction updateSearchFromFilters() {","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (currentSearch.hasMatches()) {","\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\tcurrentMatchIndex = 0;","\t\t\t\t\t\t}","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tif (currentMatch.isVisible()) {","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tcurrentMatch.setNotCurrent();","\t\t\t\t\t\t\t// Find the next visible match, if one exists","\t\t\t\t\t\t\tvar nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","\t\t\t\t\t\t\tif (nextVisibleMatchIndex > -1) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(nextVisibleMatchIndex);","\t\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction refreshCurrentMatch() {","\t\t\t\tif (currentSearch && currentSearch.hasVisibleMatches()) {","\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t}","\t\t\t}","","\t\t\tfunction displayMatches() {",'\t\t\t\treplaceClass($("searchBox"), "hasmatches", "nomatches");','\t\t\t\t$("searchBox").title = "" + currentSearch.matches.length + " matches found";','\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction displayNoMatches() {",'\t\t\t\treplaceClass($("searchBox"), "nomatches", "hasmatches");','\t\t\t\t$("searchBox").title = "No matches found";','\t\t\t\t$("searchNav").style.display = "none";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchEnabled(enable) {",'\t\t\t\tenable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','\t\t\t\t$("searchBox").disabled = !enable;','\t\t\t\t$("searchReset").disabled = !enable;','\t\t\t\t$("searchRegex").disabled = !enable;','\t\t\t\t$("searchNext").disabled = !enable;','\t\t\t\t$("searchPrevious").disabled = !enable;','\t\t\t\t$("searchCaseSensitive").disabled = !enable;','\t\t\t\t$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"\t\t\t\t\t\tcurrentSearch && currentSearch.hasVisibleMatches()) ?",'\t\t\t\t\t"block" : "none";',"\t\t\t\tif (enable) {",'\t\t\t\t\tremoveClass($("search"), "greyedout");','\t\t\t\t\taddClass(document.body, "searching");','\t\t\t\t\tif ($("searchHighlight").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t}",'\t\t\t\t\tif ($("searchFilter").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t\t}",'\t\t\t\t\t$("searchDisable").checked = !enable;',"\t\t\t\t} else {",'\t\t\t\t\taddClass($("search"), "greyedout");','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");','\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchFilter() {",'\t\t\t\tvar enable = $("searchFilter").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\tfunction toggleSearchHighlight() {",'\t\t\t\tvar enable = $("searchHighlight").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction clearSearch() {",'\t\t\t\t$("searchBox").value = "";',"\t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction searchNext() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'\t\t\t\t\tif (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(nextMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction searchPrevious() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'\t\t\t\t\tif (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(previousMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCurrentMatchIndex(index) {","\t\t\t\tcurrentMatchIndex = index;","\t\t\t\tcurrentSearch.matches[currentMatchIndex].setCurrent();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// CSS Utilities","","\t\t\tfunction addClass(el, cssClass) {","\t\t\t\tif (!hasClass(el, cssClass)) {","\t\t\t\t\tif (el.className) {",'\t\t\t\t\t\tel.className += " " + cssClass;',"\t\t\t\t\t} else {","\t\t\t\t\t\tel.className = cssClass;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hasClass(el, cssClass) {","\t\t\t\tif (el.className) {",'\t\t\t\t\tvar classNames = el.className.split(" ");',"\t\t\t\t\treturn array_contains(classNames, cssClass);","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction removeClass(el, cssClass) {","\t\t\t\tif (hasClass(el, cssClass)) {","\t\t\t\t\t// Rebuild the className property",'\t\t\t\t\tvar existingClasses = el.className.split(" ");',"\t\t\t\t\tvar newClasses = [];","\t\t\t\t\tfor (var i = 0, len = existingClasses.length; i < len; i++) {","\t\t\t\t\t\tif (existingClasses[i] != cssClass) {","\t\t\t\t\t\t\tnewClasses[newClasses.length] = existingClasses[i];","\t\t\t\t\t\t}","\t\t\t\t\t}",'\t\t\t\t\tel.className = newClasses.join(" ");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction replaceClass(el, newCssClass, oldCssClass) {","\t\t\t\tremoveClass(el, oldCssClass);","\t\t\t\taddClass(el, newCssClass);","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// Other utility functions","","\t\t\tfunction getElementsByClass(el, cssClass, tagName) {","\t\t\t\tvar elements = el.getElementsByTagName(tagName);","\t\t\t\tvar matches = [];","\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {","\t\t\t\t\tif (hasClass(elements[i], cssClass)) {","\t\t\t\t\t\tmatches.push(elements[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn matches;","\t\t\t}","","\t\t\t// Syntax borrowed from Prototype library","\t\t\tfunction $(id) {","\t\t\t\treturn document.getElementById(id);","\t\t\t}","","\t\t\tfunction isDescendant(node, ancestorNode) {","\t\t\t\twhile (node != null) {","\t\t\t\t\tif (node === ancestorNode) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t\tnode = node.parentNode;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction isOrphan(node) {","\t\t\t\tvar currentNode = node;","\t\t\t\twhile (currentNode) {","\t\t\t\t\tif (currentNode == document.body) {","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","\t\t\t\t\tcurrentNode = currentNode.parentNode;","\t\t\t\t}","\t\t\t\treturn true;","\t\t\t}","","\t\t\tfunction escapeHtml(str) {",'\t\t\t\treturn str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"\t\t\t}","","\t\t\tfunction getWindowWidth() {","\t\t\t\tif (window.innerWidth) {","\t\t\t\t\treturn window.innerWidth;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientWidth) {","\t\t\t\t\treturn document.documentElement.clientWidth;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientWidth;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getWindowHeight() {","\t\t\t\tif (window.innerHeight) {","\t\t\t\t\treturn window.innerHeight;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientHeight) {","\t\t\t\t\treturn document.documentElement.clientHeight;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientHeight;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getToolBarsHeight() {",'\t\t\t\treturn $("switches").offsetHeight;',"\t\t\t}","","\t\t\tfunction getChromeHeight() {","\t\t\t\tvar height = getToolBarsHeight();","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\theight += $("commandLine").offsetHeight;',"\t\t\t\t}","\t\t\t\treturn height;","\t\t\t}","","\t\t\tfunction setLogContainerHeight() {","\t\t\t\tif (logMainContainer) {","\t\t\t\t\tvar windowHeight = getWindowHeight();",'\t\t\t\t\t$("body").style.height = getWindowHeight() + "px";','\t\t\t\t\tlogMainContainer.style.height = "" +','\t\t\t\t\t\tMath.max(0, windowHeight - getChromeHeight()) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCommandInputWidth() {","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\t$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','\t\t\t\t\t\t($("evaluateButton").offsetWidth + 13)) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\twindow.onresize = function() {","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t};","","\t\t\tif (!Array.prototype.push) {","\t\t\t\tArray.prototype.push = function() {","\t\t\t        for (var i = 0, len = arguments.length; i < len; i++){","\t\t\t            this[this.length] = arguments[i];","\t\t\t        }","\t\t\t        return this.length;","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.pop) {","\t\t\t\tArray.prototype.pop = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar val = this[this.length - 1];","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn val;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.shift) {","\t\t\t\tArray.prototype.shift = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar firstItem = this[0];","\t\t\t\t\t\tfor (var i = 0, len = this.length - 1; i < len; i++) {","\t\t\t\t\t\t\tthis[i] = this[i + 1];","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn firstItem;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.splice) {","\t\t\t\tArray.prototype.splice = function(startIndex, deleteCount) {","\t\t\t\t\tvar itemsAfterDeleted = this.slice(startIndex + deleteCount);","\t\t\t\t\tvar itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","\t\t\t\t\tthis.length = startIndex;","\t\t\t\t\t// Copy the arguments into a proper Array object","\t\t\t\t\tvar argumentsArray = [];","\t\t\t\t\tfor (var i = 0, len = arguments.length; i < len; i++) {","\t\t\t\t\t\targumentsArray[i] = arguments[i];","\t\t\t\t\t}","\t\t\t\t\tvar itemsToAppend = (argumentsArray.length > 2) ?","\t\t\t\t\t\titemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","\t\t\t\t\tfor (i = 0, len = itemsToAppend.length; i < len; i++) {","\t\t\t\t\t\tthis.push(itemsToAppend[i]);","\t\t\t\t\t}","\t\t\t\t\treturn itemsDeleted;","\t\t\t\t};","\t\t\t}","","\t\t\tfunction array_remove(arr, val) {","\t\t\t\tvar index = -1;","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] === val) {","\t\t\t\t\t\tindex = i;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (index >= 0) {","\t\t\t\t\tarr.splice(index, 1);","\t\t\t\t\treturn index;","\t\t\t\t} else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction array_removeFromStart(array, numberToRemove) {","\t\t\t\tif (Array.prototype.splice) {","\t\t\t\t\tarray.splice(0, numberToRemove);","\t\t\t\t} else {","\t\t\t\t\tfor (var i = numberToRemove, len = array.length; i < len; i++) {","\t\t\t\t\t\tarray[i - numberToRemove] = array[i];","\t\t\t\t\t}","\t\t\t\t\tarray.length = array.length - numberToRemove;","\t\t\t\t}","\t\t\t\treturn array;","\t\t\t}","","\t\t\tfunction array_contains(arr, val) {","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] == val) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction getErrorMessage(ex) {","\t\t\t\tif (ex.message) {","\t\t\t\t\treturn ex.message;","\t\t\t\t} else if (ex.description) {","\t\t\t\t\treturn ex.description;","\t\t\t\t}",'\t\t\t\treturn "" + ex;',"\t\t\t}","","\t\t\tfunction moveCaretToEnd(input) {","\t\t\t\tif (input.setSelectionRange) {","\t\t\t\t\tinput.focus();","\t\t\t\t\tvar length = input.value.length;","\t\t\t\t\tinput.setSelectionRange(length, length);","\t\t\t\t} else if (input.createTextRange) {","\t\t\t\t\tvar range = input.createTextRange();","\t\t\t\t\trange.collapse(false);","\t\t\t\t\trange.select();","\t\t\t\t}","\t\t\t\tinput.focus();","\t\t\t}","","\t\t\tfunction stopPropagation(evt) {","\t\t\t\tif (evt.stopPropagation) {","\t\t\t\t\tevt.stopPropagation();",'\t\t\t\t} else if (typeof evt.cancelBubble != "undefined") {',"\t\t\t\t\tevt.cancelBubble = true;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction getEvent(evt) {","\t\t\t\treturn evt ? evt : event;","\t\t\t}","","\t\t\tfunction getTarget(evt) {","\t\t\t\treturn evt.target ? evt.target : evt.srcElement;","\t\t\t}","","\t\t\tfunction getRelatedTarget(evt) {","\t\t\t\tif (evt.relatedTarget) {","\t\t\t\t\treturn evt.relatedTarget;","\t\t\t\t} else if (evt.srcElement) {","\t\t\t\t\tswitch(evt.type) {",'\t\t\t\t\t\tcase "mouseover":',"\t\t\t\t\t\t\treturn evt.fromElement;",'\t\t\t\t\t\tcase "mouseout":',"\t\t\t\t\t\t\treturn evt.toElement;","\t\t\t\t\t\tdefault:","\t\t\t\t\t\t\treturn evt.srcElement;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction cancelKeyEvent(evt) {","\t\t\t\tevt.returnValue = false;","\t\t\t\tstopPropagation(evt);","\t\t\t}","","\t\t\tfunction evalCommandLine() {",'\t\t\t\tvar expr = $("command").value;',"\t\t\t\tevalCommand(expr);",'\t\t\t\t$("command").value = "";',"\t\t\t}","","\t\t\tfunction evalLastCommand() {","\t\t\t\tif (lastCommand != null) {","\t\t\t\t\tevalCommand(lastCommand);","\t\t\t\t}","\t\t\t}","","\t\t\tvar lastCommand = null;","\t\t\tvar commandHistory = [];","\t\t\tvar currentCommandIndex = 0;","","\t\t\tfunction evalCommand(expr) {","\t\t\t\tif (appender) {","\t\t\t\t\tappender.evalCommandAndAppend(expr);","\t\t\t\t} else {",'\t\t\t\t\tvar prefix = ">>> " + expr + "\\r\\n";',"\t\t\t\t\ttry {",'\t\t\t\t\t\tlog("INFO", prefix + eval(expr));',"\t\t\t\t\t} catch (ex) {",'\t\t\t\t\t\tlog("ERROR", prefix + "Error: " + getErrorMessage(ex));',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Update command history","\t\t\t\tif (expr != commandHistory[commandHistory.length - 1]) {","\t\t\t\t\tcommandHistory.push(expr);","\t\t\t\t\t// Update the appender","\t\t\t\t\tif (appender) {","\t\t\t\t\t\tappender.storeCommandHistory(commandHistory);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tcurrentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","\t\t\t\tlastCommand = expr;","\t\t\t}","\t\t\t//]]>","\t\t<\/script>",'\t\t<style type="text/css">',"\t\t\tbody {","\t\t\t\tbackground-color: white;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0;","\t\t\t\tmargin: 0;","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t\toverflow: hidden;","\t\t\t}","","\t\t\tdiv#switchesContainer input {","\t\t\t\tmargin-bottom: 0;","\t\t\t}","","\t\t\tdiv.toolbar {","\t\t\t\tborder-top: solid #ffffff 1px;","\t\t\t\tborder-bottom: solid #aca899 1px;","\t\t\t\tbackground-color: #f1efe7;","\t\t\t\tpadding: 3px 5px;","\t\t\t\tfont-size: 68.75%;","\t\t\t}","","\t\t\tdiv.toolbar, div#search input {","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t}","","\t\t\tdiv.toolbar input.button {","\t\t\t\tpadding: 0 5px;","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv.toolbar input.hidden {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#switches input#clearButton {","\t\t\t\tmargin-left: 20px;","\t\t\t}","","\t\t\tdiv#levels label {","\t\t\t\tfont-weight: bold;","\t\t\t}","","\t\t\tdiv#levels label, div#options label {","\t\t\t\tmargin-right: 5px;","\t\t\t}","","\t\t\tdiv#levels label#wrapLabel {","\t\t\t\tfont-weight: normal;","\t\t\t}","","\t\t\tdiv#search label {","\t\t\t\tmargin-right: 10px;","\t\t\t}","","\t\t\tdiv#search label.searchboxlabel {","\t\t\t\tmargin-right: 0;","\t\t\t}","","\t\t\tdiv#search input {","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv#search input.validregex {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#search input.invalidregex {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#searchNav {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine input#command {","\t\t\t\tfont-size: 100%;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t}","","\t\t\tdiv#commandLine input#evaluateButton {","\t\t\t}","","\t\t\t*.greyedout {","\t\t\t\tcolor: gray !important;","\t\t\t\tborder-color: gray !important;","\t\t\t}","","\t\t\t*.greyedout *.alwaysenabled { color: black; }","","\t\t\t*.unselectable {","\t\t\t\t-khtml-user-select: none;","\t\t\t\t-moz-user-select: none;","\t\t\t\tuser-select: none;","\t\t\t}","","\t\t\tdiv#log {","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 75%;","\t\t\t\twidth: 100%;","\t\t\t\toverflow: auto;","\t\t\t\tclear: both;","\t\t\t\tposition: relative;","\t\t\t}","","\t\t\tdiv.group {","\t\t\t\tborder-color: #cccccc;","\t\t\t\tborder-style: solid;","\t\t\t\tborder-width: 1px 0 1px 1px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupheading span.expander {","\t\t\t\tborder: solid black 1px;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 0.833em;","\t\t\t\tbackground-color: #eeeeee;","\t\t\t\tposition: relative;","\t\t\t\ttop: -1px;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0 2px;","\t\t\t\tcursor: pointer;","\t\t\t\tcursor: hand;","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupcontent {","\t\t\t\tmargin-left: 10px;","\t\t\t\tpadding-bottom: 2px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.group div.expanded {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.group div.collapsed {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\t*.logentry {","\t\t\t\toverflow: visible;","\t\t\t\tdisplay: none;","\t\t\t\twhite-space: pre;","\t\t\t}","","\t\t\tspan.pre {","\t\t\t\twhite-space: pre;","\t\t\t}","\t\t\t","\t\t\tpre.unwrapped {","\t\t\t\tdisplay: inline !important;","\t\t\t}","","\t\t\tpre.unwrapped pre.pre, div.wrapped pre.pre {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.wrapped pre.pre {","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tbody.searching *.logentry span.currentmatch {","\t\t\t\tcolor: white !important;","\t\t\t\tbackground-color: green !important;","\t\t\t}","","\t\t\tbody.searching div.searchhighlight *.logentry span.searchterm {","\t\t\t\tcolor: black;","\t\t\t\tbackground-color: yellow;","\t\t\t}","","\t\t\tdiv.wrap *.logentry {","\t\t\t\twhite-space: normal !important;","\t\t\t\tborder-width: 0 0 1px 0;","\t\t\t\tborder-color: #dddddd;","\t\t\t\tborder-style: dotted;","\t\t\t}","","\t\t\tdiv.wrap #log_wrapped, #log_unwrapped {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.wrap #log_unwrapped, #log_wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.pre {","\t\t\t\toverflow: visible;","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrap *.logentry pre.unwrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.wrapped {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.searchfilter *.searchnonmatch {","\t\t\t\tdisplay: none !important;","\t\t\t}","","\t\t\tdiv#log *.TRACE, label#label_TRACE {","\t\t\t\tcolor: #666666;","\t\t\t}","","\t\t\tdiv#log *.DEBUG, label#label_DEBUG {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#log *.INFO, label#label_INFO {","\t\t\t\tcolor: #000099;","\t\t\t}","","\t\t\tdiv#log *.WARN, label#label_WARN {","\t\t\t\tcolor: #999900;","\t\t\t}","","\t\t\tdiv#log *.ERROR, label#label_ERROR {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#log *.FATAL, label#label_FATAL {","\t\t\t\tcolor: #660066;","\t\t\t}","","\t\t\tdiv.TRACE#log *.TRACE,","\t\t\tdiv.DEBUG#log *.DEBUG,","\t\t\tdiv.INFO#log *.INFO,","\t\t\tdiv.WARN#log *.WARN,","\t\t\tdiv.ERROR#log *.ERROR,","\t\t\tdiv.FATAL#log *.FATAL {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv#log div.separator {","\t\t\t\tbackground-color: #cccccc;","\t\t\t\tmargin: 5px 0;","\t\t\t\tline-height: 1px;","\t\t\t}","\t\t</style>","\t</head>","",'\t<body id="body">','\t\t<div id="switchesContainer">','\t\t\t<div id="switches">','\t\t\t\t<div id="levels" class="toolbar">',"\t\t\t\t\tFilters:",'\t\t\t\t\t<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','\t\t\t\t\t<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','\t\t\t\t\t<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','\t\t\t\t\t<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','\t\t\t\t\t<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','\t\t\t\t\t<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','\t\t\t\t\t<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"\t\t\t\t</div>",'\t\t\t\t<div id="search" class="toolbar">','\t\t\t\t\t<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','\t\t\t\t\t<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','\t\t\t\t\t<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','\t\t\t\t\t<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','\t\t\t\t\t<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','\t\t\t\t\t<div id="searchNav">','\t\t\t\t\t\t<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','\t\t\t\t\t\t<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','\t\t\t\t\t\t<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','\t\t\t\t\t\t<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"\t\t\t\t\t</div>","\t\t\t\t</div>",'\t\t\t\t<div id="options" class="toolbar">',"\t\t\t\t\tOptions:",'\t\t\t\t\t<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','\t\t\t\t\t<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','\t\t\t\t\t<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','\t\t\t\t\t<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','\t\t\t\t\t<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','\t\t\t\t\t<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','\t\t\t\t\t<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>",'\t\t<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','\t\t<div id="commandLine" class="toolbar">','\t\t\t<div id="commandLineContainer">','\t\t\t\t<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','\t\t\t\t<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"\t\t\t</div>","\t\t</div>","\t</body>","</html>",""];e.open();for(var r=0,n=t.length;r<n;r++)e.writeln(t[r]);e.close()};this.setEventTypes(["load","unload"]);var F=function(){var e=S();e.setAppender(h),e.setNewestAtTop(a),e.setScrollToLatest(v),e.setMaxMessages(E),e.setShowCommandLine(I),e.setShowHideButton(C),e.setShowCloseButton(R),e.setMainWindow(window);var t=getCookie(j);t&&(e.commandHistory=t.split(","),e.currentCommandIndex=e.commandHistory.length),h.dispatchEvent("load",{win:e})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),f||(logLog.debug("really doing unload "+this),c=p=!(f=!0),h.dispatchEvent("unload",{}))};var q=function(e,t,r,n){var o=setInterval(function(){try{f&&clearInterval(o),e(S())&&(clearInterval(o),r())}catch(e){clearInterval(o),m=!1,handleError(n,e)}},t)},G=function(){var e=document.domain!=location.hostname;return d?"":getBaseUrl()+"console_uncompressed.html"+(e?"?log4javascript_domain="+escape(document.domain):"")};if(e){var W,z=null,Y=[],K=!(this.addCssProperty=function(e,t){k("cssProperties")&&Y.push([e,t])}),X=uniqueId+"_InPageAppender_"+g;this.hide=function(){o&&c&&(x()&&S().$("command").blur(),W.style.display="none",M=!0)},this.show=function(){o&&(c?(W.style.display="block",this.setShowCommandLine(I),M=!1):K||_(!0))},this.isVisible=function(){return!M&&!f},this.close=function(e){f||e&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(W.parentNode.removeChild(W),this.unload())},w=function(){var t="InPageAppender.open: unable to create console iframe";function r(){try{s||h.show(),F(),p=!0,L()}catch(e){m=!1,handleError(t,e)}}function e(){try{var e=function(e){return isLoaded(e)};d&&V(S().document),e(S())?r():q(e,100,r,t)}catch(e){m=!1,handleError(t,e)}}M=!1,(W=z.appendChild(document.createElement("div"))).style.width=l,W.style.height=u,W.style.border="solid gray 1px";for(var n=0,o=Y.length;n<o;n++)W.style[Y[n][0]]=Y[n][1];var i=d?"":" src='"+G()+"'";W.innerHTML="<iframe id='"+X+"' name='"+X+"' width='100%' height='100%' frameborder='0'"+i+" scrolling='no'></iframe>",f=!1;var a=function(e){try{return bool(e)&&bool(e.document)}catch(e){return!1}};a(S())?e():q(a,100,e,t),c=!0},_=function(e){if(e||!s){var t=function(){if(r)try{var e=document.getElementById(r);1==e.nodeType&&(z=e),w()}catch(e){handleError("InPageAppender.init: invalid container element '"+r+"' supplied",e)}else(z=document.createElement("div")).style.position="fixed",z.style.left="0",z.style.right="0",z.style.bottom="0",document.body.appendChild(z),h.addCssProperty("borderWidth","1px 0 0 0"),h.addCssProperty("zIndex",1e6),w()};pageLoaded&&r&&r.appendChild?(z=r,w()):pageLoaded?t():log4javascript.addEventListener("load",t),K=!0}},y=function(){_(),o=!0},S=function(){var e=window.frames[X];if(e)return e},b=function(){return!(!m||f)&&(c&&!p&&S()&&isLoaded(S())&&(p=!0),p)}}else{var J,Q=h.defaults.useOldPopUp,Z=h.defaults.complainAboutPopUpBlocking,$=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return Q},this.setUseOldPopUp=function(e){k("useOldPopUp")&&(Q=bool(e))},this.isComplainAboutPopUpBlocking=function(){return Z},this.setComplainAboutPopUpBlocking=function(e){k("complainAboutPopUpBlocking")&&(Z=bool(e))},this.isFocusPopUp=function(){return n},this.setFocusPopUp=function(e){n=bool(e)},this.isReopenWhenClosed=function(){return $},this.setReopenWhenClosed=function(e){$=bool(e)},this.close=function(){logLog.debug("close "+this);try{J.close(),this.unload()}catch(e){}},this.hide=function(){logLog.debug("hide "+this),x()&&this.close()},this.show=function(){logLog.debug("show "+this),c||w()},this.isVisible=function(){return b()},w=function(){var e="width="+l+",height="+u+",status,resizable",t="";try{var r=window.frameElement;r&&(t="_"+r.tagName+"_"+(r.name||r.id||""))}catch(e){t="_inaccessibleParentFrame"}var n="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+g+t;Q&&d||(n=n+"_"+uniqueId);var o=function(e){if(f)return!0;try{return bool(e)&&e.closed}catch(e){}return!1},i=function(){f||h.unload()};function a(){S().setCloseIfOpenerCloses(!Q||!d),F(),p=!0,L(),q(o,500,i,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{if(J=window.open(G(),n,e),c=!(f=!1),J&&J.document)if(d&&Q&&isLoaded(J))J.mainPageReloaded(),a();else{d&&V(J.document);isLoaded(J)?a():q(function(e){return bool(e)&&isLoaded(e)},100,a,"PopUpAppender.init: unable to create console window")}else m=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),Z&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(e){handleError("PopUpAppender.init: error creating pop-up",e)}},_=function(){s||w()},y=function(){_(),o=!0},S=function(){return J},b=function(){if(m&&!isUndefined(J)&&!f){if(J.closed||p&&isUndefined(J.closed))return h.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!p&&isLoaded(J)&&(p=!0)}return m&&p&&!f}}this.getConsoleWindow=S},ConsoleAppender.addGlobalCommandLineFunction=function(e,t){ee.push([e,t])},(e.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},e.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=e,(t.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},t.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=t,log4javascript.InlineAppender=t}(),function(){function a(e){var t=0;for(var r in e)t=Math.max(toStr(r).length,t);var n=[];for(r in e){var o,i="  "+padWithSpaces(toStr(r),t+2);try{o=splitIntoLines(toStr(e[r])).join(padWithSpaces(newLine,t+6))}catch(e){o="[Error obtaining property. Details: "+getExceptionMessage(e)+"]"}n.push(i+o)}return n.join(newLine)}var b={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},S=["script","pre"],w=["br","img","hr","param","link","area","input","col","base","meta"],E="  ";function I(e,t,r,n,o){var i;function a(e){for(var t=e.style.cssText.split(";"),r="",n=0,o=t.length;n<o;n++){var i=t[n].split(":"),a=[];/^\s*$/.test(i[0])||a.push(trim(i[0]).toLowerCase()+":"+trim(i[1])),r=a.join(";")}return r}"string"!=typeof r&&(r=""),n=!!n,o=!!o;var s,d,l,u;if(!(t=void 0===t||!!t)||e.nodeType==b.DOCUMENT_FRAGMENT_NODE){for(i="",s=0,d=e.childNodes.length;s<d;s++)i+=I(e.childNodes[s],!0,r+E);return i}switch(e.nodeType){case b.ELEMENT_NODE:var c=e.tagName.toLowerCase();i=n?newLine+r:"",i+="<";var p=(u=e).prefix?u.prefix:u.outerHTML&&new RegExp("<([^:]+):"+u.tagName+"[^>]*>","i").test(u.outerHTML)?RegExp.$1.toLowerCase():"",h=!!p;for(h&&(i+=p+":"),i+=c,s=0,d=e.attributes.length;s<d;s++){var f=e.attributes[s];f.specified&&null!==f.nodeValue&&"style"!==f.nodeName.toLowerCase()&&"string"==typeof f.nodeValue&&0!==f.nodeName.indexOf("_moz")&&(i+=" "+f.nodeName.toLowerCase()+'="',i+=f.nodeValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;"),i+='"')}if(e.style.cssText)""!==a(e)&&(i+=' style="'+a(e)+'"');if(array_contains(w,c)||h&&!e.hasChildNodes())i+="/>";else{i+=">";var m=!(1===e.childNodes.length&&e.childNodes[0].nodeType===b.TEXT_NODE),g=array_contains(S,c);for(s=0,d=e.childNodes.length;s<d;s++)i+=I(e.childNodes[s],!0,r+E,m,g);var v="</"+c+">";i+=m?newLine+r+v:v}return i;case b.TEXT_NODE:if((l=e).nodeType==b.TEXT_NODE&&/^[ \t\r\n]*$/.test(l.nodeValue))i="";else{if(o)i=e.nodeValue;else{var y=splitIntoLines(trim(e.nodeValue)),_=[];for(s=0,d=y.length;s<d;s++)_[s]=trim(y[s]);i=_.join(newLine+r)}n&&(i=newLine+r+i)}return i;case b.CDATA_SECTION_NODE:return"<![CDATA["+e.nodeValue+"]]>"+newLine;case b.DOCUMENT_NODE:for(i="",s=0,d=e.childNodes.length;s<d;s++)i+=I(e.childNodes[s],!0,r);return i;default:return""}}ConsoleAppender.addGlobalCommandLineFunction("$",function(e,t,r){return document.getElementById(t[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(e,t,r){for(var n=[],o=0,i=t.length;o<i;o++)n[o]=a(t[o]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(e,t,r){for(var n=[],o=0,i=t.length;o<i;o++)n[o]=I(t[o]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(e,t,r){var n,o;return 0===t.length||""===t[0]?(n=window,o="Command line set to run in main window"):t[0].window==t[0]?(n=t[0],o="Command line set to run in frame '"+t[0].name+"'"):(n=window.frames[t[0]])?o="Command line set to run in frame '"+t[0]+"'":(r.isError=!0,o="Frame '"+t[0]+"' does not exist",n=e.getCommandWindow()),e.setCommandWindow(n),o}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(e,t,r){r.appendResult=!1,e.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(e,t,r){var n=[];for(var o in t[0])n.push(o);return n}),ConsoleAppender.addGlobalCommandLineFunction("values",function(e,t,r){var n=[];for(var o in t[0])try{n.push(t[0][o])}catch(e){logLog.warn("values(): Unable to obtain value for key "+o+". Details: "+getExceptionMessage(e))}return n}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(e,t,r){var n=parseInt(t[0],10);return isNaN(n)||n<0?(r.isError=!0,t[0]+" is not a valid expansion depth"):(e.setCommandLineObjectExpansionDepth(n),"Object expansion depth set to "+n)})}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(e){oldOnload&&oldOnload(e),log4javascript.setDocumentReady()}}return log4javascript},this),function(e,t){"function"==typeof define&&define.amd?define(["bytebuffer"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(I,e){"use strict";var o,c,t,a,s,r,i={};return i.ByteBuffer=I,i.Long=I.Long||null,i.VERSION="5.0.1",i.WIRE_TYPES={},i.WIRE_TYPES.VARINT=0,i.WIRE_TYPES.BITS64=1,i.WIRE_TYPES.LDELIM=2,i.WIRE_TYPES.STARTGROUP=3,i.WIRE_TYPES.ENDGROUP=4,i.WIRE_TYPES.BITS32=5,i.PACKABLE_WIRE_TYPES=[i.WIRE_TYPES.VARINT,i.WIRE_TYPES.BITS64,i.WIRE_TYPES.BITS32],i.TYPES={int32:{name:"int32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},uint64:{name:"uint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.UZERO:void 0},sint64:{name:"sint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},bool:{name:"bool",wireType:i.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:i.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:i.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.ZERO:void 0},float:{name:"float",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:i.WIRE_TYPES.STARTGROUP,defaultValue:null}},i.MAP_KEY_TYPES=[i.TYPES.int32,i.TYPES.sint32,i.TYPES.sfixed32,i.TYPES.uint32,i.TYPES.fixed32,i.TYPES.int64,i.TYPES.sint64,i.TYPES.sfixed64,i.TYPES.uint64,i.TYPES.fixed64,i.TYPES.bool,i.TYPES.string,i.TYPES.bytes],i.ID_MIN=1,i.ID_MAX=536870911,i.convertFieldsToCamelCase=!1,i.populateAccessors=!0,i.populateDefaults=!0,i.Util=((o={}).IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),o.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,r=0;r<e.length;r++){try{t=e[r]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},o.fetch=function(e,r){if(r&&"function"!=typeof r&&(r=null),o.IS_NODE){var t=require("fs");if(r)t.readFile(e,function(e,t){r(e?null:""+t)});else try{return t.readFileSync(e)}catch(e){return null}}else{var n=o.XHR();if(n.open("GET",e,!!r),n.setRequestHeader("Accept","text/plain"),"function"==typeof n.overrideMimeType&&n.overrideMimeType("text/plain"),!r)return n.send(null),200==n.status||0==n.status&&"string"==typeof n.responseText?n.responseText:null;if(n.onreadystatechange=function(){4==n.readyState&&(200==n.status||0==n.status&&"string"==typeof n.responseText?r(n.responseText):r(null))},4==n.readyState)return;n.send(null)}},o.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},o),i.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},i.DotProto=function(o,a){var e={},t=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},r=t.prototype;r._readString=function(){var e='"'===this._stringOpen?a.STRING_DQ:a.STRING_SQ;e.lastIndex=this.index-1;var t=e.exec(this.source);if(!t)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,t[1]},r.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,t,r;do{for(e=!1;a.WHITESPACE.test(r=this.source.charAt(this.index));)if("\n"===r&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(r=this.source.charAt(this.index)))return"/";do{if("\n"===r&&++this.line,++this.index===this.source.length)return null;t=r,r=this.source.charAt(this.index)}while("*"!==t||"/"!==r);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;var n=this.index;if(a.DELIM.lastIndex=0,!a.DELIM.test(this.source.charAt(n++)))for(;n<this.source.length&&!a.DELIM.test(this.source.charAt(n));)++n;var o=this.source.substring(this.index,this.index=n);return'"'!==o&&"'"!==o||(this._stringOpen=o),o},r.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},r.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},r.omit=function(e){return this.peek()===e&&(this.next(),!0)},r.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},e.Tokenizer=t;var n=function(e){this.tn=new t(e),this.proto3=!1},i=n.prototype;function s(e,t){var r=-1,n=1;if("-"==e.charAt(0)&&(n=-1,e=e.substring(1)),a.NUMBER_DEC.test(e))r=parseInt(e);else if(a.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!a.NUMBER_OCT.test(e))throw Error("illegal id value: "+(n<0?"-":"")+e);r=parseInt(e.substring(1),8)}if(r=n*r|0,!t&&r<0)throw Error("illegal id value: "+(n<0?"-":"")+e);return r}function d(e){var t=1;if("-"==e.charAt(0)&&(t=-1,e=e.substring(1)),a.NUMBER_DEC.test(e))return t*parseInt(e,10);if(a.NUMBER_HEX.test(e))return t*parseInt(e.substring(2),16);if(a.NUMBER_OCT.test(e))return t*parseInt(e.substring(1),8);if("inf"===e)return t*(1/0);if("nan"===e)return NaN;if(a.NUMBER_FLT.test(e))return t*parseFloat(e);throw Error("illegal number value: "+(t<0?"-":"")+e)}function l(e,t,r){void 0===e[t]?e[t]=r:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(r))}return i.parse=function(){var e,t,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},n=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!n||null!==r.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!a.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),r.package=e;break;case"import":if(!n)throw Error("unexpected 'import'");("public"===(e=this.tn.peek())||(t="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),t||r.imports.push(e);break;case"syntax":if(!n)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),n=!1;break;case"enum":this._parseEnum(r),n=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete r.name,r},n.parse=function(e){return new n(e).parse()},i._readString=function(){var e,t,r="";do{if("'"!==(t=this.tn.next())&&'"'!==t)throw Error("illegal string delimiter: "+t);r+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('"'===e||'"'===e);return r},i._readValue=function(e){var t=this.tn.peek();if('"'===t||"'"===t)return this._readString();if(this.tn.next(),a.NUMBER.test(t))return d(t);if(a.BOOL.test(t))return"true"===t.toLowerCase();if(e&&a.TYPEREF.test(t))return t;throw Error("illegal value: "+t)},i._parseOption=function(e,t){var r=this.tn.next(),n=!1;if("("===r&&(n=!0,r=this.tn.next()),!a.TYPEREF.test(r))throw Error("illegal option name: "+r);var o=r;n&&(this.tn.skip(")"),o="("+o+")",r=this.tn.peek(),a.FQTYPEREF.test(r)&&(o+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,o),t||this.tn.skip(";")},i._parseOptionValue=function(e,t){var r=this.tn.peek();if("{"!==r)l(e.options,t,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!a.NAME.test(r))throw Error("illegal option name: "+t+"."+r);this.tn.omit(":")?l(e.options,t+"."+r,this._readValue(!0)):this._parseOptionValue(e,t+"."+r)}},i._parseService=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal service name at line "+this.tn.line+": "+t);var r={name:t,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if("option"===t)this._parseOption(r);else{if("rpc"!==t)throw Error("illegal service token: "+t);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},i._parseServiceRPC=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal rpc service method name: "+t);var r=t,n={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(n.request_stream=!0,t=this.tn.next()),!a.TYPEREF.test(t))throw Error("illegal rpc service request type: "+t);if(n.request=t,this.tn.skip(")"),"returns"!==(t=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+t);if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(n.response_stream=!0,t=this.tn.next()),n.response=t,this.tn.skip(")"),"{"===(t=this.tn.peek())){for(this.tn.next();"}"!==(t=this.tn.next());){if("option"!==t)throw Error("illegal rpc service token: "+t);this._parseOption(n)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[r]=n},i._parseMessage=function(e,t){var r=!!t,n=this.tn.next(),o={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!a.NAME.test(n))throw Error("illegal "+(r?"group":"message")+" name: "+n);for(o.name=n,r&&(this.tn.skip("="),t.id=s(this.tn.next()),o.isGroup=!0),"["===(n=this.tn.peek())&&t&&this._parseFieldOptions(t),this.tn.skip("{");"}"!==(n=this.tn.next());)if(a.RULE.test(n))this._parseMessageField(o,n);else if("oneof"===n)this._parseMessageOneOf(o);else if("enum"===n)this._parseEnum(o);else if("message"===n)this._parseMessage(o);else if("option"===n)this._parseOption(o);else if("service"===n)this._parseService(o);else if("extensions"===n)o.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(o);else{if(!a.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(o,"optional",n)}return this.tn.omit(";"),e.messages.push(o),o},i._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},i._parseMessageField=function(e,t,r){if(!a.RULE.test(t))throw Error("illegal message field rule: "+t);var n,o={rule:t,type:"",name:"",options:{},id:0};if("map"===t){if(r)throw Error("illegal type: "+r);if(this.tn.skip("<"),n=this.tn.next(),!a.TYPE.test(n)&&!a.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(o.keytype=n,this.tn.skip(","),n=this.tn.next(),!a.TYPE.test(n)&&!a.TYPEREF.test(n))throw Error("illegal message field: "+n);if(o.type=n,this.tn.skip(">"),n=this.tn.next(),!a.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=s(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}else if("group"===(r=void 0!==r?r:this.tn.next())){var i=this._parseMessage(e,o);if(!/^[A-Z]/.test(i.name))throw Error("illegal group name: "+i.name);o.type=i.name,o.name=i.name.toLowerCase(),this.tn.omit(";")}else{if(!a.TYPE.test(r)&&!a.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(o.type=r,n=this.tn.next(),!a.NAME.test(n))throw Error("illegal message field name: "+n);o.name=n,this.tn.skip("="),o.id=s(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(o),this.tn.skip(";")}return e.fields.push(o),o},i._parseMessageOneOf=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal oneof name: "+t);var r,n=t,o=[];for(this.tn.skip("{");"}"!==(t=this.tn.next());)(r=this._parseMessageField(e,"optional",t)).oneof=n,o.push(r.id);this.tn.omit(";"),e.oneofs[n]=o},i._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},i._parseEnum=function(e){var t={name:"",values:[],options:{}},r=this.tn.next();if(!a.NAME.test(r))throw Error("illegal name: "+r);for(t.name=r,this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(t);else{if(!a.NAME.test(r))throw Error("illegal name: "+r);this.tn.skip("=");var n={name:r,id:s(this.tn.next(),!0)};"["===(r=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),t.values.push(n)}this.tn.omit(";"),e.enums.push(t)},i._parseExtensionRanges=function(){var e,t,r,n=[];do{for(t=[];;){switch(e=this.tn.next()){case"min":r=o.ID_MIN;break;case"max":r=o.ID_MAX;break;default:r=d(e)}if(t.push(r),2===t.length)break;if("to"!==this.tn.peek()){t.push(r);break}this.tn.next()}n.push(t)}while(this.tn.omit(","));return this.tn.skip(";"),n},i._parseExtend=function(e){var t=this.tn.next();if(!a.TYPEREF.test(t))throw Error("illegal extend reference: "+t);var r={ref:t,fields:[]};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if(a.RULE.test(t))this._parseMessageField(r,t);else{if(!a.TYPEREF.test(t))throw Error("illegal extend token: "+t);if(!this.proto3)throw Error("illegal field rule: "+t);this._parseMessageField(r,"optional",t)}return this.tn.omit(";"),e.messages.push(r),r},i.toString=function(){return"Parser at line "+this.tn.line},e.Parser=n,e}(i,i.Lang),i.Reflect=function(m){var a={},u=function(e,t,r){this.builder=e,this.parent=t,this.name=r,this.className},e=u.prototype;e.fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},e.toString=function(e){return(e?this.className+" ":"")+this.fqn()},e.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},a.T=u;var s=function(e,t,r,n,o){u.call(this,e,t,r),this.className="Namespace",this.children=[],this.options=n||{},this.syntax=o||"proto2"};try{var t=s.prototype=Object.create(u.prototype)}catch(e){t=""}t.getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],r=0,n=this.children.length;r<n;++r)this.children[r]instanceof e&&t.push(this.children[r]);return t},t.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof p.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof p.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},t.getChild=function(e){for(var t="number"==typeof e?"id":"name",r=0,n=this.children.length;r<n;++r)if(this.children[r][t]===e)return this.children[r];return null},t.resolve=function(e,t){var r,n="string"==typeof e?e.split("."):e,o=this,i=0;if(""===n[i]){for(;null!==o.parent;)o=o.parent;i++}do{do{if(!(o instanceof a.Namespace)){o=null;break}if(!(r=o.getChild(n[i]))||!(r instanceof a.T)||t&&!(r instanceof a.Namespace)){o=null;break}o=r,i++}while(i<n.length);if(null!=o)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=o);return o},t.qn=function(e){for(var t=[],r=e;t.unshift(r.name),null!==(r=r.parent););for(var n=1;n<=t.length;n++){var o=t.slice(t.length-n);if(e===this.resolve(o,e instanceof a.Namespace))return o.join(".")}return e.fqn()},t.build=function(){for(var e,t={},r=this.children,n=0,o=r.length;n<o;++n)(e=r[n])instanceof s&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},t.buildOpt=function(){for(var e={},t=Object.keys(this.options),r=0,n=t.length;r<n;++r){var o=t[r],i=this.options[t[r]];e[o]=i}return e},t.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},a.Namespace=s;var c=function(e,t,r,n){if(this.type=e,this.resolvedType=t,this.isMapKey=r,this.syntax=n,r&&m.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)},r=c.prototype;function d(e,t){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new m.Long(e.low,e.high,void 0===t?e.unsigned:t);if("string"==typeof e)return m.Long.fromString(e,t||!1,10);if("number"==typeof e)return m.Long.fromNumber(e,t||!1);throw Error("not convertible to Long")}c.defaultFieldValue=function(e){if("string"==typeof e&&(e=m.TYPES[e]),void 0===e.defaultValue)throw Error("default value for type "+e.name+" is not supported");return e==m.TYPES.bytes?new I(0):e.defaultValue},r.verifyValue=function(t){var r=this;function n(e,t){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+e+" ("+t+")")}switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),4294967295<t?0|t:t;case m.TYPES.uint32:case m.TYPES.fixed32:return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),t<0?t>>>0:t;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:if(m.Long)try{return d(t,!1)}catch(e){n(typeof t,e.message)}else n(typeof t,"requires Long.js");case m.TYPES.uint64:case m.TYPES.fixed64:if(m.Long)try{return d(t,!0)}catch(e){n(typeof t,e.message)}else n(typeof t,"requires Long.js");case m.TYPES.bool:return"boolean"!=typeof t&&n(typeof t,"not a boolean"),t;case m.TYPES.float:case m.TYPES.double:return"number"!=typeof t&&n(typeof t,"not a number"),t;case m.TYPES.string:return"string"==typeof t||t&&t instanceof String||n(typeof t,"not a string"),""+t;case m.TYPES.bytes:return I.isByteBuffer(t)?t:I.wrap(t,"base64");case m.TYPES.enum:var e=this.resolvedType.getChildren(m.Reflect.Enum.Value);for(i=0;i<e.length;i++){if(e[i].name==t)return e[i].id;if(e[i].id==t)return e[i].id}if("proto3"===this.syntax)return("number"!=typeof t||t==t&&t%1!=0)&&n(typeof t,"not an integer"),(4294967295<t||t<0)&&n(typeof t,"not in range for uint32"),t;n(t,"not a valid enum value");case m.TYPES.group:case m.TYPES.message:if(t&&"object"==typeof t||n(typeof t,"object expected"),t instanceof this.resolvedType.clazz)return t;if(t instanceof m.Builder.Message){var o={};for(var i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);t=o}return new this.resolvedType.clazz(t)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+t+" (undefined type "+this.type+")")},r.calculateLength=function(e,t){if(null===t)return 0;var r;switch(this.type){case m.TYPES.int32:return t<0?I.calculateVarint64(t):I.calculateVarint32(t);case m.TYPES.uint32:return I.calculateVarint32(t);case m.TYPES.sint32:return I.calculateVarint32(I.zigZagEncode32(t));case m.TYPES.fixed32:case m.TYPES.sfixed32:case m.TYPES.float:return 4;case m.TYPES.int64:case m.TYPES.uint64:return I.calculateVarint64(t);case m.TYPES.sint64:return I.calculateVarint64(I.zigZagEncode64(t));case m.TYPES.fixed64:case m.TYPES.sfixed64:return 8;case m.TYPES.bool:return 1;case m.TYPES.enum:return I.calculateVarint32(t);case m.TYPES.double:return 8;case m.TYPES.string:return r=I.calculateUTF8Bytes(t),I.calculateVarint32(r)+r;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");return I.calculateVarint32(t.remaining())+t.remaining();case m.TYPES.message:return r=this.resolvedType.calculate(t),I.calculateVarint32(r)+r;case m.TYPES.group:return(r=this.resolvedType.calculate(t))+I.calculateVarint32(e<<3|m.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")},r.encodeValue=function(e,t,r){if(null===t)return r;switch(this.type){case m.TYPES.int32:t<0?r.writeVarint64(t):r.writeVarint32(t);break;case m.TYPES.uint32:r.writeVarint32(t);break;case m.TYPES.sint32:r.writeVarint32ZigZag(t);break;case m.TYPES.fixed32:r.writeUint32(t);break;case m.TYPES.sfixed32:r.writeInt32(t);break;case m.TYPES.int64:case m.TYPES.uint64:r.writeVarint64(t);break;case m.TYPES.sint64:r.writeVarint64ZigZag(t);break;case m.TYPES.fixed64:r.writeUint64(t);break;case m.TYPES.sfixed64:r.writeInt64(t);break;case m.TYPES.bool:"string"==typeof t?r.writeVarint32("false"===t.toLowerCase()?0:!!t):r.writeVarint32(t?1:0);break;case m.TYPES.enum:r.writeVarint32(t);break;case m.TYPES.float:r.writeFloat32(t);break;case m.TYPES.double:r.writeFloat64(t);break;case m.TYPES.string:r.writeVString(t);break;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");var n=t.offset;r.writeVarint32(t.remaining()),r.append(t),t.offset=n;break;case m.TYPES.message:var o=(new I).LE();this.resolvedType.encode(t,o),r.writeVarint32(o.offset),r.append(o.flip());break;case m.TYPES.group:this.resolvedType.encode(t,r),r.writeVarint32(e<<3|m.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")}return r},r.decode=function(e,t,r){if(t!=this.type.wireType)throw Error("Unexpected wire type for element");var n,o;switch(this.type){case m.TYPES.int32:return 0|e.readVarint32();case m.TYPES.uint32:return e.readVarint32()>>>0;case m.TYPES.sint32:return 0|e.readVarint32ZigZag();case m.TYPES.fixed32:return e.readUint32()>>>0;case m.TYPES.sfixed32:return 0|e.readInt32();case m.TYPES.int64:return e.readVarint64();case m.TYPES.uint64:return e.readVarint64().toUnsigned();case m.TYPES.sint64:return e.readVarint64ZigZag();case m.TYPES.fixed64:return e.readUint64();case m.TYPES.sfixed64:return e.readInt64();case m.TYPES.bool:return!!e.readVarint32();case m.TYPES.enum:return e.readVarint32();case m.TYPES.float:return e.readFloat();case m.TYPES.double:return e.readDouble();case m.TYPES.string:return e.readVString();case m.TYPES.bytes:if(o=e.readVarint32(),e.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+e.remaining());return(n=e.clone()).limit=n.offset+o,e.offset+=o,n;case m.TYPES.message:return o=e.readVarint32(),this.resolvedType.decode(e,o);case m.TYPES.group:return this.resolvedType.decode(e,-1,r)}throw Error("[INTERNAL] Illegal decode type")},r.valueFromString=function(e){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return this.verifyValue(parseInt(e));case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return this.verifyValue(e);case m.TYPES.bool:return"true"===e;case m.TYPES.string:return this.verifyValue(e);case m.TYPES.bytes:return I.fromBinary(e)}},r.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===m.TYPES.bytes?e.toString("binary"):e.toString()},a.Element=c;var p=function(e,t,r,n,o,i){s.call(this,e,t,r,n,i),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!o,this._fields=null,this._fieldsById=null,this._fieldsByName=null};try{var n=p.prototype=Object.create(s.prototype)}catch(e){n=""}function g(e,t){var r=t.readVarint32(),n=7&r,o=r>>>3;switch(n){case m.WIRE_TYPES.VARINT:for(;128==(128&(r=t.readUint8())););break;case m.WIRE_TYPES.BITS64:t.offset+=8;break;case m.WIRE_TYPES.LDELIM:r=t.readVarint32(),t.offset+=r;break;case m.WIRE_TYPES.STARTGROUP:g(o,t);break;case m.WIRE_TYPES.ENDGROUP:if(o===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+o+" ("+e+" expected)");case m.WIRE_TYPES.BITS32:t.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+n)}return!0}n.build=function(e){if(this.clazz&&!e)return this.clazz;var t=function(c,a){var s=a.getChildren(c.Reflect.Message.Field),d=a.getChildren(c.Reflect.Message.OneOf),l=function(e,t){c.Builder.Message.call(this);for(var r=0,n=d.length;r<n;++r)this[d[r].name]=null;for(r=0,n=s.length;r<n;++r){var o=s[r];this[o.name]=o.repeated?[]:o.map?new c.Map(o):null,!o.required&&"proto3"!==a.syntax||null===o.defaultValue||(this[o.name]=o.defaultValue)}var i;if(0<arguments.length)if(1!==arguments.length||null===e||"object"!=typeof e||!("function"!=typeof e.encode||e instanceof l)||Array.isArray(e)||e instanceof c.Map||I.isByteBuffer(e)||e instanceof ArrayBuffer||c.Long&&e instanceof c.Long)for(r=0,n=arguments.length;r<n;++r)void 0!==(i=arguments[r])&&this.$set(s[r].name,i);else this.$set(e)};try{var i=l.prototype=Object.create(c.Builder.Message.prototype)}catch(e){i=""}i.add=function(e,t,r){var n=a._fieldsByName[e];if(!r){if(!n)throw Error(this+"#"+e+" is undefined");if(!(n instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+e+" is not a repeated field");t=n.verifyValue(t,!0)}return null===this[e]&&(this[e]=[]),this[e].push(t),this},i.$add=i.add,i.set=function(e,t,r){if(e&&"object"==typeof e){for(var n in r=t,e)e.hasOwnProperty(n)&&void 0!==(t=e[n])&&this.$set(n,t,r);return this}var o=a._fieldsByName[e];if(r)this[e]=t;else{if(!o)throw Error(this+"#"+e+" is not a field: undefined");if(!(o instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+o.toString(!0));this[o.name]=t=o.verifyValue(t)}if(o&&o.oneof){var i=this[o.oneof.name];null!==t?(null!==i&&i!==o.name&&(this[i]=null),this[o.oneof.name]=o.name):i===e&&(this[o.oneof.name]=null)}return this},i.$set=i.set,i.get=function(e,t){if(t)return this[e];var r=a._fieldsByName[e];if(!(r&&r instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(r instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+r.toString(!0));return this[r.name]},i.$get=i.get;for(var e=0;e<s.length;e++){var t=s[e];t instanceof c.Reflect.Message.ExtensionField||a.builder.options.populateAccessors&&function(r){var e=r.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});e=e.substring(0,1).toUpperCase()+e.substring(1);var t=r.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),n=function(e,t){return this[r.name]=t?e:r.verifyValue(e),this},o=function(){return this[r.name]};null===a.getChild("set"+e)&&(i["set"+e]=n),null===a.getChild("set_"+t)&&(i["set_"+t]=n),null===a.getChild("get"+e)&&(i["get"+e]=o),null===a.getChild("get_"+t)&&(i["get_"+t]=o)}(t)}function p(e,r,n,o){if(null===e||"object"!=typeof e){if(o&&o instanceof c.Reflect.Enum){var t=c.Reflect.Enum.getName(o.object,e);if(null!==t)return t}return e}if(I.isByteBuffer(e))return r?e.toBase64():e.toBuffer();if(c.Long.isLong(e))return n?e.toString():c.Long.fromValue(e);var i;if(Array.isArray(e))return i=[],e.forEach(function(e,t){i[t]=p(e,r,n,o)}),i;if(i={},e instanceof c.Map){for(var a=e.entries(),s=a.next();!s.done;s=a.next())i[e.keyElem.valueToString(s.value[0])]=p(s.value[1],r,n,e.valueElem.resolvedType);return i}var d=e.$type,l=void 0;for(var u in e)e.hasOwnProperty(u)&&(d&&(l=d.getChild(u))?i[u]=p(e[u],r,n,l.resolvedType):i[u]=p(e[u],r,n));return i}return i.encode=function(t,e){"boolean"==typeof t&&(e=t,t=void 0);var r=!1;t||(t=new I,r=!0);var n=t.littleEndian;try{return a.encode(this,t.LE(),e),(r?t.flip():t).LE(n)}catch(e){throw t.LE(n),e}},l.encode=function(e,t,r){return new l(e).encode(t,r)},i.calculate=function(){return a.calculate(this)},i.encodeDelimited=function(e,t){var r=!1;e||(e=new I,r=!0);var n=(new I).LE();return a.encode(this,n,t).flip(),e.writeVarint32(n.remaining()),e.append(n),r?e.flip():e},i.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},i.toArrayBuffer=i.encodeAB,i.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},i.toBuffer=i.encodeNB,i.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},i.toBase64=i.encode64,i.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},i.toHex=i.encodeHex,i.toRaw=function(e,t){return p(this,!!e,!!t,this.$type)},i.encodeJSON=function(){return JSON.stringify(p(this,!0,!0,this.$type))},l.decode=function(t,e,r){"string"==typeof e&&(r=e,e=-1),"string"==typeof t&&(t=I.wrap(t,r||"base64"));var n=(t=I.isByteBuffer(t)?t:I.wrap(t)).littleEndian;try{var o=a.decode(t.LE());return t.LE(n),o}catch(e){throw t.LE(n),e}},l.decodeDelimited=function(t,e){if("string"==typeof t&&(t=I.wrap(t,e||"base64")),(t=I.isByteBuffer(t)?t:I.wrap(t)).remaining()<1)return null;var r=t.offset,n=t.readVarint32();if(t.remaining()<n)return t.offset=r,null;try{var o=a.decode(t.slice(t.offset,t.offset+n).LE());return t.offset+=n,o}catch(e){throw t.offset+=n,e}},l.decode64=function(e){return l.decode(e,"base64")},l.decodeHex=function(e){return l.decode(e,"hex")},l.decodeJSON=function(e){return new l(JSON.parse(e))},i.toString=function(){return a.toString()},Object.defineProperty&&(Object.defineProperty(l,"$options",{value:a.buildOpt()}),Object.defineProperty(i,"$options",{value:l.$options}),Object.defineProperty(l,"$type",{value:a}),Object.defineProperty(i,"$type",{value:a})),l}(m,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,o=this.children.length;n<o;n++)if((r=this.children[n])instanceof h||r instanceof p||r instanceof _){if(t.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");t[r.name]=r.build()}else if(r instanceof p.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof p.OneOf||r instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=t},n.encode=function(e,t,r){for(var n,o,i=null,a=0,s=this._fields.length;a<s;++a)o=e[(n=this._fields[a]).name],n.required&&null===o?null===i&&(i=n):n.encode(r?o:n.verifyValue(o),t,e);if(null===i)return t;var d=Error("Missing at least one required field for "+this.toString(!0)+": "+i);throw d.encoded=t,d},n.calculate=function(e){for(var t,r,n=0,o=0,i=this._fields.length;o<i;++o){if(r=e[(t=this._fields[o]).name],t.required&&null===r)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);n+=t.calculate(r,e)}return n},n.decode=function(e,t,r){t="number"==typeof t?t:-1;for(var n,o,i,a,s=e.offset,d=new this.clazz;e.offset<s+t||-1===t&&0<e.remaining();){if(i=(n=e.readVarint32())>>>3,(o=7&n)===m.WIRE_TYPES.ENDGROUP){if(i!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+i+" ("+(r?r+" expected":"not a group")+")");break}if(a=this._fieldsById[i]){if(a.repeated&&!a.options.packed)d[a.name].push(a.decode(o,e));else if(a.map){var l=a.decode(o,e);d[a.name].set(l[0],l[1])}else if(d[a.name]=a.decode(o,e),a.oneof){var u=d[a.oneof.name];null!==u&&u!==a.name&&(d[u]=null),d[a.oneof.name]=a.name}}else switch(o){case m.WIRE_TYPES.VARINT:e.readVarint32();break;case m.WIRE_TYPES.BITS32:e.offset+=4;break;case m.WIRE_TYPES.BITS64:e.offset+=8;break;case m.WIRE_TYPES.LDELIM:var c=e.readVarint32();e.offset+=c;break;case m.WIRE_TYPES.STARTGROUP:for(;g(i,e););break;default:throw Error("Illegal wire type for unknown field "+i+" in "+this.toString(!0)+"#decode: "+o)}}for(var p=0,h=this._fields.length;p<h;++p)if(null===d[(a=this._fields[p]).name])if("proto3"===this.syntax)d[a.name]=a.defaultValue;else{if(a.required){var f=Error("Missing at least one required field for "+this.toString(!0)+": "+a.name);throw f.decoded=d,f}m.populateDefaults&&null!==a.defaultValue&&(d[a.name]=a.defaultValue)}return d},a.Message=p;var l=function(e,t,r,n,o,i,a,s,d,l){u.call(this,e,t,i),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=n||null,this.type=o,this.resolvedType=null,this.id=a,this.options=s||{},this.defaultValue=null,this.oneof=d||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof p.ExtensionField||(this.name=m.Util.toCamelCase(this.name))};try{var o=l.prototype=Object.create(u.prototype)}catch(e){o=""}o.build=function(){this.element=new c(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new c(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=c.defaultFieldValue(this.type)},o.verifyValue=function(e,t){t=t||!1;var r,n=this;function o(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}if(null===e)return this.required&&o(typeof e,"required"),"proto3"===this.syntax&&this.type!==m.TYPES.message&&o(typeof e,"proto3 field without field presence cannot be null"),null;if(!this.repeated||t)return this.map&&!t?e instanceof m.Map?e:(e instanceof Object||o(typeof e,"expected ProtoBuf.Map or raw object for map field"),new m.Map(this,e)):(!this.repeated&&Array.isArray(e)&&o(typeof e,"no array expected"),this.element.verifyValue(e));Array.isArray(e)||(e=[e]);var i=[];for(r=0;r<e.length;r++)i.push(this.element.verifyValue(e[r]));return i},o.hasWirePresence=function(e,t){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&t[this.oneof.name]===this.name)return!0;switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return 0!==e;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return 0!==e.low||0!==e.high;case m.TYPES.bool:return e;case m.TYPES.float:case m.TYPES.double:return 0!==e;case m.TYPES.string:return 0<e.length;case m.TYPES.bytes:return 0<e.remaining();case m.TYPES.enum:return 0!==e;case m.TYPES.message:return null!==e;default:return!0}},o.encode=function(t,o,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return o;try{var r;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){o.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),o.ensureCapacity(o.offset+=1);var n=o.offset;for(r=0;r<t.length;r++)this.element.encodeValue(this.id,t[r],o);var i=o.offset-n,a=I.calculateVarint32(i);if(1<a){var s=o.slice(n,o.offset);n+=a-1,o.offset=n,o.append(s)}o.writeVarint32(i,n-a)}else for(r=0;r<t.length;r++)o.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t[r],o);else this.map?t.forEach(function(e,t,r){var n=I.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+I.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);o.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),o.writeVarint32(n),o.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,t,o),o.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,o)},this):this.hasWirePresence(t,e)&&(o.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t,o))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return o},o.calculate=function(t,e){if(t=this.verifyValue(t),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return 0;var o=0;try{var r,n;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(o+=I.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),r=n=0;r<t.length;r++)n+=this.element.calculateLength(this.id,t[r]);o+=I.calculateVarint32(n),o+=n}else for(r=0;r<t.length;r++)o+=I.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,t[r]);else this.map?t.forEach(function(e,t,r){var n=I.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+I.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);o+=I.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),o+=I.calculateVarint32(n),o+=n},this):this.hasWirePresence(t,e)&&(o+=I.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,t))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return o},o.decode=function(e,t,r){var n,o;if(!(!this.map&&e==this.type.wireType||!r&&this.repeated&&this.options.packed&&e==m.WIRE_TYPES.LDELIM||this.map&&e==m.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==m.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){o=t.readVarint32(),o=t.offset+o;for(var i=[];t.offset<o;)i.push(this.decode(this.type.wireType,t,!0));return i}if(this.map){var a=c.defaultFieldValue(this.keyType);if(n=c.defaultFieldValue(this.type),o=t.readVarint32(),t.remaining()<o)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+o+" required but got only "+t.remaining());var s=t.clone();for(s.limit=s.offset+o,t.offset+=o;0<s.remaining();){var d=s.readVarint32();e=7&d;var l=d>>>3;if(1===l)a=this.keyElement.decode(s,e,l);else{if(2!==l)throw Error("Unexpected tag in map field key/value submessage");n=this.element.decode(s,e,l)}}return[a,n]}return this.element.decode(t,e,this.id)},a.Message.Field=l;var i=function(e,t,r,n,o,i,a){l.call(this,e,t,r,null,n,o,i,a),this.extension};try{i.prototype=Object.create(l.prototype)}catch(e){i.prototype=null}a.Message.ExtensionField=i;a.Message.OneOf=function(e,t,r){u.call(this,e,t,r),this.fields=[]};var h=function(e,t,r,n,o){s.call(this,e,t,r,n,o),this.className="Enum",this.object=null};h.getName=function(e,t){for(var r,n=Object.keys(e),o=0;o<n.length;++o)if(e[r=n[o]]===t)return r;return null};try{var f=h.prototype=Object.create(s.prototype)}catch(e){f=h.prototype=null}f&&(f.build=function(e){if(this.object&&!e)return this.object;for(var t=new m.Builder.Enum,r=this.getChildren(h.Value),n=0,o=r.length;n<o;++n)t[r[n].name]=r[n].id;return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=t}),a.Enum=h;var v=function(e,t,r,n){u.call(this,e,t,r),this.className="Enum.Value",this.id=n};try{v.prototype=Object.create(u.prototype)}catch(e){v.prototype=null}a.Enum.Value=v;var y=function(e,t,r,n){u.call(this,e,t,r),this.field=n};try{y.prototype=Object.create(u.prototype)}catch(e){y.prototype=null}a.Extension=y;var _=function(e,t,r,n){s.call(this,e,t,r,n),this.className="Service",this.clazz=null};try{var b=_.prototype=Object.create(s.prototype)}catch(e){b=null}b&&(b.build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(t,o){for(var i=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,r){setTimeout(r.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=i.prototype=Object.create(t.Builder.Service.prototype),r=o.getChildren(t.Reflect.Service.RPCMethod),n=0;n<r.length;n++)!function(n){e[n.name]=function(e,r){try{try{e=n.resolvedRequestType.clazz.decode(I.wrap(e))}catch(e){if(!(e instanceof TypeError))throw e}if(null===e||"object"!=typeof e)throw Error("Illegal arguments");e instanceof n.resolvedRequestType.clazz||(e=new n.resolvedRequestType.clazz(e)),this.rpcImpl(n.fqn(),e,function(e,t){if(e)r(e);else{null===t&&(t="");try{t=n.resolvedResponseType.clazz.decode(t)}catch(e){}t&&t instanceof n.resolvedResponseType.clazz?r(null,t):r(Error("Illegal response type received in service method "+o.name+"#"+n.name))}})}catch(e){setTimeout(r.bind(this,e),0)}},i[n.name]=function(e,t,r){new i(e)[n.name](t,r)},Object.defineProperty&&(Object.defineProperty(i[n.name],"$options",{value:n.buildOpt()}),Object.defineProperty(e[n.name],"$options",{value:i[n.name].$options}))}(r[n]);return Object.defineProperty&&(Object.defineProperty(i,"$options",{value:o.buildOpt()}),Object.defineProperty(e,"$options",{value:i.$options}),Object.defineProperty(i,"$type",{value:o}),Object.defineProperty(e,"$type",{value:o})),i}(m,this)}),a.Service=_;var S=function(e,t,r,n){u.call(this,e,t,r),this.className="Service.Method",this.options=n||{}};try{var w=S.prototype=Object.create(u.prototype)}catch(e){w=null}w&&(w.buildOpt=t.buildOpt),a.Service.Method=S;var E=function(e,t,r,n,o,i,a,s){S.call(this,e,t,r,s),this.className="Service.RPCMethod",this.requestName=n,this.responseName=o,this.requestStream=i,this.responseStream=a,this.resolvedRequestType=null,this.resolvedResponseType=null};try{E.prototype=Object.create(S.prototype)}catch(e){E.prototype=null}return a.Service.RPCMethod=E,a}(i),i.Builder=(t=(c=i).Lang,a=i.Reflect,r=(s=function(e){this.ns=new a.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}}).prototype,s.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},s.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},s.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},s.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},s.isExtend=function(e){return"string"==typeof e.ref},r.reset=function(){return this.ptr=this.ns,this},r.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new a.Namespace(this,this.ptr,e)),this.ptr=t},this),this},r.create=function(e){if(!e)return this;if(Array.isArray(e)){if(0===e.length)return this;e=e.slice()}else e=[e];for(var t=[e];0<t.length;){if(e=t.pop(),!Array.isArray(e))throw Error("not a valid namespace: "+JSON.stringify(e));for(;0<e.length;){var r=e.shift();if(s.isMessage(r)){var i=new a.Message(this,this.ptr,r.name,r.options,r.isGroup,r.syntax),n={};r.oneofs&&Object.keys(r.oneofs).forEach(function(e){i.addChild(n[e]=new a.Message.OneOf(this,i,e))},this),r.fields&&r.fields.forEach(function(e){if(null!==i.getChild(0|e.id))throw Error("duplicate or invalid field id in "+i.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+i.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=n[e.oneof]))throw Error("illegal oneof in "+i.name+"#"+e.name+": "+e.oneof);e=new a.Message.Field(this,i,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,r.syntax),t&&t.fields.push(e),i.addChild(e)},this);var o=[];if(r.enums&&r.enums.forEach(function(e){o.push(e)}),r.messages&&r.messages.forEach(function(e){o.push(e)}),r.services&&r.services.forEach(function(e){o.push(e)}),r.extensions&&("number"==typeof r.extensions[0]?i.extensions=[r.extensions]:i.extensions=r.extensions),this.ptr.addChild(i),0<o.length){t.push(e),e=o,o=null,this.ptr=i,i=null;continue}o=null}else if(s.isEnum(r))i=new a.Enum(this,this.ptr,r.name,r.options,r.syntax),r.values.forEach(function(e){i.addChild(new a.Enum.Value(this,i,e.name,e.id))},this),this.ptr.addChild(i);else if(s.isService(r))i=new a.Service(this,this.ptr,r.name,r.options),Object.keys(r.rpc).forEach(function(e){var t=r.rpc[e];i.addChild(new a.Service.RPCMethod(this,i,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(i);else{if(!s.isExtend(r))throw Error("not a valid definition: "+JSON.stringify(r));if(i=this.ptr.resolve(r.ref,!0))r.fields.forEach(function(t){if(null!==i.getChild(0|t.id))throw Error("duplicate extended field id in "+i.name+": "+t.id);if(i.extensions){var r=!1;if(i.extensions.forEach(function(e){t.id>=e[0]&&t.id<=e[1]&&(r=!0)}),!r)throw Error("illegal extended field id in "+i.name+": "+t.id+" (not within valid ranges)")}var e=t.name;this.options.convertFieldsToCamelCase&&(e=c.Util.toCamelCase(e));var n=new a.Message.ExtensionField(this,i,t.rule,t.type,this.ptr.fqn()+"."+e,t.id,t.options),o=new a.Extension(this,this.ptr,t.name,n);n.extension=o,this.ptr.addChild(o),i.addChild(n)},this);else if(!/\.?google\.protobuf\./.test(r.ref))throw Error("extended message "+r.ref+" is not defined")}i=r=null}e=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},r.import=function(t,e){var r="/";if("string"==typeof e){if(c.Util.IS_NODE&&(e=require("path").resolve(e)),!0===this.files[e])return this.reset();this.files[e]=!0}else if("object"==typeof e){var n=e.root;c.Util.IS_NODE&&(n=require("path").resolve(n)),(0<=n.indexOf("\\")||0<=e.file.indexOf("\\"))&&(r="\\");var o=n+r+e.file;if(!0===this.files[o])return this.reset();this.files[o]=!0}if(t.imports&&0<t.imports.length){var i,a=!1;"object"==typeof e?(this.importRoot=e.root,a=!0,i=this.importRoot,e=e.file,(0<=i.indexOf("\\")||0<=e.indexOf("\\"))&&(r="\\")):"string"==typeof e?this.importRoot?i=this.importRoot:0<=e.indexOf("/")?""===(i=e.replace(/\/[^\/]*$/,""))&&(i="/"):0<=e.indexOf("\\")?(i=e.replace(/\\[^\\]*$/,""),r="\\"):i=".":i=null;for(var s=0;s<t.imports.length;s++)if("string"==typeof t.imports[s]){if(!i)throw Error("cannot determine import root");var d=t.imports[s];if("google/protobuf/descriptor.proto"===d)continue;if(d=i+r+d,!0===this.files[d])continue;/\.proto$/i.test(d)&&!c.DotProto&&(d=d.replace(/\.proto$/,".json"));var l=c.Util.fetch(d);if(null===l)throw Error("failed to import '"+d+"' in '"+e+"': file not found");/\.json$/i.test(d)?this.import(JSON.parse(l+""),d):this.import(c.DotProto.Parser.parse(l),d)}else e?/\.(\w+)$/.test(e)?this.import(t.imports[s],e.replace(/^(.+)\.(\w+)$/,function(e,t,r){return t+"_import"+s+"."+r})):this.import(t.imports[s],e+"_import"+s):this.import(t.imports[s]);a&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&function t(r){r.messages&&r.messages.forEach(function(e){e.syntax=r.syntax,t(e)}),r.enums&&r.enums.forEach(function(e){e.syntax=r.syntax})}(t);var u=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){u.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=u),t.enums&&(this.create(t.enums),this.ptr=u),t.services&&(this.create(t.services),this.ptr=u),t.extends&&this.create(t.extends),this.reset()},r.resolveAll=function(){var e;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof a.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof a.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=c.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(e=(this.ptr instanceof a.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if((this.ptr.resolvedType=e)instanceof a.Enum){if(this.ptr.type=c.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==e.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(e instanceof a.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=e.isGroup?c.TYPES.group:c.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=c.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof c.Reflect.Service.Method){if(!(this.ptr instanceof c.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((e=this.ptr.parent.resolve(this.ptr.requestName,!0))&&e instanceof c.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=e,!((e=this.ptr.parent.resolve(this.ptr.responseName,!0))&&e instanceof c.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=e}else if(!(this.ptr instanceof c.Reflect.Message.OneOf||this.ptr instanceof c.Reflect.Extension||this.ptr instanceof c.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},r.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(var t="string"==typeof e?e.split("."):e,r=this.result,n=0;n<t.length;n++){if(!r[t[n]]){r=null;break}r=r[t[n]]}return r},r.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},r.toString=function(){return"Builder"},s.Message=function(){},s.Enum=function(){},s.Service=function(){},s),i.Map=function(e,a){var t=function(e,t){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new a.Element(e.keyType,null,!0,e.syntax),this.valueElem=new a.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),t)for(var r=Object.keys(t),n=0;n<r.length;n++){var o=this.keyElem.valueFromString(r[n]),i=this.valueElem.verifyValue(t[r[n]]);this.map[this.keyElem.valueToString(o)]={key:o,value:i}}},r=t.prototype;function o(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}return r.clear=function(){this.map={}},r.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),r=t in this.map;return delete this.map[t],r},r.entries=function(){for(var e,t=[],r=Object.keys(this.map),n=0;n<r.length;n++)t.push([(e=this.map[r[n]]).key,e.value]);return o(t)},r.keys=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return o(e)},r.values=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return o(e)},r.forEach=function(e,t){for(var r,n=Object.keys(this.map),o=0;o<n.length;o++)e.call(t,(r=this.map[n[o]]).value,r.key,this)},r.set=function(e,t){var r=this.keyElem.verifyValue(e),n=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(r)]={key:r,value:n},this},r.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));if(t in this.map)return this.map[t].value},r.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},t}(0,i.Reflect),i.loadProto=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=void 0),i.loadJson(i.DotProto.Parser.parse(e),t,r)},i.protoFromString=i.loadProto,i.loadProtoFile=function(t,r,n){if(r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{r(null,i.loadProto(e,n,t))}catch(e){r(e)}else r(Error("Failed to fetch file"))});var e=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:i.loadProto(e,n,t)},i.protoFromFile=i.loadProtoFile,i.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=i.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=i.populateAccessors),new i.Builder(e)},i.loadJson=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=null),t&&"object"==typeof t||(t=i.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,r),t.resolveAll(),t},i.loadJsonFile=function(t,r,n){if(r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{r(null,i.loadJson(JSON.parse(e),n,t))}catch(e){r(e)}else r(Error("Failed to fetch file"))});var e=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:i.loadJson(JSON.parse(e),n,t)},i}),SdpSerializer.SerializeASBandwidth=function(e,t){return t=t||{},e=(e=(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+(t.audio||50)+"\r\n")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(t.video||256)+"\r\n")).replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+(t.data||1638400)+"\r\n")},SdpSerializer.SerializePTime=function(e,t){return t=t||{},e=(e=e.replace("a=fmtp:111 minptime=10","a=fmtp:111 minptime="+(t.minptime||10))).replace("a=maxptime:60","a=maxptime:"+(t.maxptime||60))},SdpSerializer.SerializeGoogleMinBitrate=function(e,t){return e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\na=rtpmap:120 VP8/90000\r\na=fmtp:120 \t\t\t\t\t\t\tx-google-min-bitrate="+(t||10)+"\r\n")},SdpSerializer.RTPOverTCP=function(e){return e.replace(/a=candidate:.*udp.*\r\n/g,"")};var SDPTransform=function(){var s={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"sdptype",reg:/^sdptype:([\w-_]*)/,format:"sdptype:%s"},{push:"t3s",reg:/^t3:(\w*) ([\S|]*)/,names:["type","config"],format:"t3:%s %s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(s).forEach(function(e){s[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});var i=function(e){return String(Number(e))===e?Number(e):e},d=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:n?t[e.name]:t;!function(e,t,r,n){if(n&&!r)t[n]=i(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(t[r[o]]=i(e[o+1]))}(r.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);this.parse=function(e){var t={},i=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),a=i[i.length-1]);for(var n=0;n<(s[t]||[]).length;n+=1){var o=s[t][n];if(o.reg.test(r))return d(o,a,r)}}),t.media=i,t},this.paramReducer=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=i(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e},this.parseParams=function(e){return e.split(/\;\s?/).reduce(paramReducer,{})},this.parseFmtpConfig=this.parseParams,this.parsePayloads=function(e){return e.split(" ").map(Number)},this.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(i),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},this.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(paramReducer,{})})},this.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})};var a=/%[sdv%]/g,l=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return function(e){var r=1,n=arguments,o=n.length;return e.replace(a,function(e){if(o<=r)return e;var t=n[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})}.apply(null,n)},u=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];this.writer=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||u,n=t.innerOrder||c,o=[];return r.forEach(function(r){s[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(l(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(l(r,t,e))})})}),e.media.forEach(function(e){o.push(l("m",s.m[0],e)),n.forEach(function(r){s[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(l(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(l(r,t,e))})})})}),o.join("\r\n")+"\r\n"},this.mediaWriter=function(e,t){t=t||{},null==e.payloads&&(e.payloads="");t.outerOrder;var r=t.innerOrder||c,n=[];return n.push(l("m",s.m[0],e)),r.forEach(function(r){s[r].forEach(function(t){t.name in e&&null!=e[t.name]?n.push(l(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){n.push(l(r,t,e))})})}),n.join("\r\n")+"\r\n"},this.ssrcGroupsAndSsrcsWriter=function(e,t,r){(r=r||{}).outerOrder;var n=r.innerOrder||c,o=[];return e&&e.forEach(function(r){n.forEach(function(t){s[t].forEach(function(e){"ssrcGroups"==e.push&&o.push(l(t,e,r))})})}),t&&t.forEach(function(r){n.forEach(function(t){s[t].forEach(function(e){"ssrcs"==e.push&&o.push(l(t,e,r))})})}),o.join("\r\n")+"\r\n"}};function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}function debugout(){var s=this;if(s.realTimeLoggingOn=!0,s.useTimestamps=!1,s.useLocalStorage=!1,s.recordLogs=!0,s.autoTrim=!0,s.maxLines=2e5,s.tailNumLines=100,s.logFilename="debugout.txt",s.maxDepth=25,s.depth=0,s.parentSizes=[0],s.currentResult="",s.startTime=new Date,s.output="",s.logLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},this.version=function(){return"0.5.0"},this.getLog=function(){var e=new Date;if(s.recordLogs||s.log("[debugout.js] log recording is off."),s.useLocalStorage){var t=window.localStorage.getItem("debugout.js");t&&(t=JSON.parse(t),s.startTime=new Date(t.startTime),s.output=t.log,e=new Date(t.lastLog))}return s.output+"\n---- Log retrieved: "+e+" ----\n"+s.formatSessionDuration(s.startTime,e)},this.tail=function(e){e=e||s.tailLines;return s.trimLog(s.getLog(),e)},this.search=function(e){for(var t=s.output.split("\n"),r=new RegExp(e),n=[],o=0;o<t.length;o++){var i="["+o+"] ";t[o].match(r)&&n.push(i+t[o])}var a=n.join("\n");return 0==a.length&&(a='Nothing found for "'+e+'".'),a},this.getSlice=function(e,t){return s.output.split("\n").slice(e,e+t).join("\n")},this.downloadLog=function(){var e="data:text/plain;charset=utf-8,",t=s.getLog();e+=encodeURIComponent(t);var r=document.createElement("a");r.href=e,r.target="_blank",r.download=s.logFilename,document.body.appendChild(r),r.click(),r.remove()},this.clear=function(){var e=new Date;if(s.output="---- Log cleared: "+e+" ----\n",s.useLocalStorage){var t={startTime:s.startTime,log:s.output,lastLog:e};t=JSON.stringify(t),window.localStorage.setItem("debugout.js",t)}s.realTimeLoggingOn&&console.log("[debugout.js] clear()")},this.track=function(e){s.log(s.logLevel.track,e)},this.debug=function(e){s.log(s.logLevel.debug,e)},this.info=function(e){s.log(s.logLevel.info,e)},this.error=function(e){s.log(s.logLevel.error,e)},this.log=function(e,t){s.realTimeLoggingOn&&(e==this.logLevel.trace?console.trace(t):e==this.logLevel.debug?console.debug(t):e==this.logLevel.info?console.info(t):e==this.logLevel.error?console.error(t):console.info(t));var r=s.determineType(t);if(null!=r&&s.recordLogs){var n=s.formatType(r,t);if(s.useTimestamps){var o=new Date;s.output+=s.formatTimestamp(o)}if(e==this.logLevel.trace?s.output+="TRACK - ":e==this.logLevel.debug?s.output+="DEBUG - ":e==this.logLevel.info?s.output+="INFO - ":e==this.logLevel.error?s.output+="ERROR - ":s.output+="INFO - ",s.output+=n+"\n",s.autoTrim&&(s.output=s.trimLog(s.output,s.maxLines)),s.useLocalStorage){var i=new Date,a={startTime:s.startTime,log:s.output,lastLog:i};a=JSON.stringify(a),window.localStorage.setItem("debugout.js",a)}}s.depth=0,s.parentSizes=[0],s.currentResult=""},this.determineType=function(e){if(null==e)return null;var t=typeof e;return"object"==t?null==e.length?"function"==typeof e.getTime?"Date":"function"==typeof e.test?"RegExp":"Object":"Array":t},this.formatType=function(e,t){if(s.maxDepth&&s.depth>=s.maxDepth)return"... (max-depth reached)";switch(e){case"Object":s.currentResult+="{\n",s.depth++,s.parentSizes.push(s.objectSize(t));var r=0;for(var n in t){s.currentResult+=s.indentsForDepth(s.depth),s.currentResult+=n+": ";var o=s.determineType(t[n]);(i=s.formatType(o,t[n]))&&(s.currentResult+=i),r!=s.parentSizes[s.depth]-1&&(s.currentResult+=","),s.currentResult+="\n",r++}if(s.depth--,s.parentSizes.pop(),s.currentResult+=s.indentsForDepth(s.depth),s.currentResult+="}",0==s.depth)return s.currentResult;break;case"Array":s.currentResult+="[",s.depth++,s.parentSizes.push(t.length);for(r=0;r<t.length;r++){var i;"Object"!=(o=s.determineType(t[r]))&&"Array"!=o||(s.currentResult+="\n"+s.indentsForDepth(s.depth)),(i=s.formatType(o,t[r]))?(s.currentResult+=i,r!=s.parentSizes[s.depth]-1&&(s.currentResult+=", "),"Array"==o&&(s.currentResult+="\n")):(r!=s.parentSizes[s.depth]-1&&(s.currentResult+=", "),"Object"!=o?s.currentResult+="\n":r==s.parentSizes[s.depth]-1&&(s.currentResult+="\n"))}if(s.depth--,s.parentSizes.pop(),s.currentResult+="]",0==s.depth)return s.currentResult;break;case"function":var a=(t+="").split("\n");for(r=0;r<a.length;r++)a[r].match(/\}/)&&s.depth--,s.currentResult+=s.indentsForDepth(s.depth),a[r].match(/\{/)&&s.depth++,s.currentResult+=a[r]+"\n";return s.currentResult;case"RegExp":return"/"+t.source+"/";case"Date":case"string":return 0<s.depth||0==t.length?'"'+t+'"':t;case"boolean":return t?"true":"false";case"number":return t+""}},this.indentsForDepth=function(e){for(var t="",r=0;r<e;r++)t+="\t";return t},this.trimLog=function(e,t){var r=e.split("\n");return r.length>t&&(r=r.slice(r.length-t)),r.join("\n")},this.lines=function(){return s.output.split("\n").length},this.formatSessionDuration=function(e,t){var r=t-e,n=Math.floor(r/1e3/60/60),o=("0"+n).slice(-2);r-=1e3*n*60*60;var i=Math.floor(r/1e3/60),a=("0"+i).slice(-2);r-=1e3*i*60;var s=Math.floor(r/1e3);return r-=1e3*s,"---- Session duration: "+o+":"+a+":"+("0"+s).slice(-2)+" ----"},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+" "+e.getMilliseconds()+"]: "},this.objectSize=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},s.useLocalStorage){var e=window.localStorage.getItem("debugout.js");if(e){e=JSON.parse(e),s.output=e.log;var t=new Date(e.startTime),r=new Date(e.lastLog);s.output+="\n---- Session end: "+e.lastLog+" ----\n",s.output+=s.formatSessionDuration(t,r),s.output+="\n\n"}}s.output+="---- Session started: "+s.startTime+" ----\n\n"}!function(e,C){e(function(){function m(e,t,r,n){return s(e).then(t,r,n)}function a(e,t){this.then=e,this.inspect=t}function s(t){return c(function(e){e(t)})}function c(e){function t(e){d&&(s=o(e),n(d,s),d=T)}function r(e){t(l(e))}var s,d=[];try{e(t,r,function(e){d&&n(d,function n(o){var i=new a(function(e,t,r){try{return"function"==typeof r?n(r(o)):i}catch(e){return n(e)}});return i}(e))})}catch(e){r(e)}return new a(function(o,i,a){return c(function(t,r,n){d?d.push(function(e){e.then(o,i,a).then(t,r,n)}):h(function(){s.then(o,i,a).then(t,r,n)})})},function(){return s?s.inspect():{state:"pending"}})}function o(o){return o instanceof a?o:o===Object(o)&&"then"in o?c(function(t,r,n){h(function(){try{var e=o.then;"function"==typeof e?_(e,o,t,r,n):t(i(o))}catch(e){r(e)}})}):i(o)}function i(t){var r=new a(function(e){try{return"function"==typeof e?o(e(t)):r}catch(e){return l(e)}},function(){return p(t)});return r}function l(r){var n=new a(function(e,t){try{return"function"==typeof t?o(t(r)):n}catch(e){return l(e)}},function(){return t(r)});return n}function n(r,n){h(function(){for(var e,t=0;e=r[t++];)e(n)})}function d(e,f,t,r,n){return m(e,function(h){return c(function(t,r,e){function n(e){u(e)}function o(e){l(e)}var i,a,s,d,l,u,c,p;if(c=h.length>>>0,i=Math.max(0,Math.min(f,c)),s=[],a=c-i+1,d=[],i)for(u=function(e){d.push(e),--a||(l=u=g,r(d))},l=function(e){s.push(e),--i||(l=u=g,t(s))},p=0;p<c;++p)p in h&&m(h[p],o,n,e);else t(s)}).then(t,r,n)})}function r(e,t,r,n){return u(e,g).then(t,r,n)}function u(e,l,u){return m(e,function(d){return c(function(r,n,o){var i,e,a,t,s;if(a=e=d.length>>>0,i=[],a)for(t=function(e,t){m(e,l,u).then(function(e){i[t]=e,--a||r(i)},n,o)},s=0;s<e;s++)s in d?t(d[s],s):--a;else r(i)})})}function p(e){return{state:"fulfilled",value:e}}function t(e){return{state:"rejected",reason:e}}function h(e){1===S.push(e)&&b(f)}function f(){for(var e,t=0;e=S[t++];)e();S=[]}function g(e){return e}var v,y,_,b,S,w,e,E,I,T;return m.defer=function(){var e,o,i;return(e={promise:T,resolve:T,reject:T,notify:T,resolver:{resolve:T,reject:T,notify:T}}).promise=o=c(function(t,r,n){e.resolve=e.resolver.resolve=function(e){return i?s(e):(i=!0,t(e),o)},e.reject=e.resolver.reject=function(e){return i?s(l(e)):(i=!0,r(e),o)},e.notify=e.resolver.notify=function(e){return n(e),e}}),e},m.resolve=s,m.reject=function(e){return m(e,l)},m.join=function(){return u(arguments,g)},m.all=r,m.map=function(e,t){return u(e,t)},m.reduce=function(e,i){var t=_(y,arguments,1);return m(e,function(e){var o;return o=e.length,t[0]=function(e,r,n){return m(e,function(t){return m(r,function(e){return i(t,e,n,o)})})},v.apply(e,t)})},m.settle=function(e){return u(e,p,t)},m.any=function(e,t,r,n){return d(e,1,function(e){return t?t(e[0]):e[0]},r,n)},m.some=d,m.isPromise=function(e){return e&&"function"==typeof e.then},m.promise=c,a.prototype={otherwise:function(e){return this.then(T,e)},ensure:function(e){function t(){return s(e())}return this.then(t,t).yield2(this)},yield2:function(e){return this.then(function(){return e})},spread:function(t){return this.then(function(e){return r(e,function(e){return t.apply(T,e)})})},always:function(e,t){return this.then(e,e,t)}},S=[],w=C.setTimeout,b="function"==typeof setImmediate?setImmediate.bind(C):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(e){w(e,0)},E=(e=Function.prototype).call,_=e.bind?E.bind(E):function(e,t){return e.apply(t,y.call(arguments,2))},y=(I=[]).slice,v=I.reduce||function(e){var t,r,n,o,i;if(i=0,o=(t=Object(this)).length>>>0,(r=arguments).length<=1)for(;;){if(i in t){n=t[i++];break}if(++i>=o)throw new TypeError}else n=r[1];for(;i<o;++i)i in t&&(n=e(n,t[i],i,t));return n},m})}("function"==typeof define&&define.amd?define:function(e){window.when=e()},this),EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=500,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,r,n,o,i,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(isUndefined(r=this._events[e]))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];r.apply(this,o)}else if(isObject(r)){for(n=arguments.length,o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];for(n=(a=r.slice()).length,i=0;i<n;i++)a[i].apply(this,o)}return!0},EventEmitter.prototype.addListener=function(e,t){var r;if(!isFunction(t))throw TypeError("listener must be a function");(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned)&&((r=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()));return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){if(!isFunction(t))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var r,n,o,i;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(r=this._events[e]).length,n=-1,r===t||isFunction(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(r)){for(i=o;0<i--;)if(r[i]===t||r[i].listener&&r[i].listener===t){n=i;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(r=this._events[e]))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){return e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).zrender={})}(this,function(e){"use strict";var t=function(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1},l=new function(){this.browser=new t,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow="undefined"!=typeof window};"object"==typeof wx&&"function"==typeof wx.getSystemInfoSync?(l.wxa=!0,l.touchEventsSupported=!0):"undefined"==typeof document&&"undefined"!=typeof self?l.worker=!0:"undefined"==typeof navigator?(l.node=!0,l.svgSupported=!0):function(e,t){var r=t.browser,n=e.match(/Firefox\/([\d.]+)/),o=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/.+?rv:(([\d.]+))/),i=e.match(/Edge?\/([\d.]+)/),a=/micromessenger/i.test(e);n&&(r.firefox=!0,r.version=n[1]);o&&(r.ie=!0,r.version=o[1]);i&&(r.edge=!0,r.version=i[1],r.newEdge=18<+i[1].split(".")[0]);a&&(r.weChat=!0);t.svgSupported="undefined"!=typeof SVGRect,t.touchEventsSupported="ontouchstart"in window&&!r.ie&&!r.edge,t.pointerEventsSupported="onpointerdown"in window&&(r.edge||r.ie&&11<=+r.version),t.domSupported="undefined"!=typeof document;var s=document.documentElement.style;t.transform3dSupported=(r.ie&&"transition"in s||r.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in s)&&!("OTransition"in s),t.transformSupported=t.transform3dSupported||r.ie&&9<=+r.version}(navigator.userAgent,l);var d=12,g="sans-serif",x=d+"px "+g;var u,c,p=function(e){var t={};if("undefined"==typeof JSON)return t;for(var r=0;r<e.length;r++){var n=String.fromCharCode(r+32),o=(e.charCodeAt(r)-20)/100;t[n]=o}return t}("007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N"),h={createCanvas:function(){return"undefined"!=typeof document&&document.createElement("canvas")},measureText:function(e,t){if(!u){var r=h.createCanvas();u=r&&r.getContext("2d")}if(u)return c!==t&&(c=u.font=t||x),u.measureText(e);e=e||"";var n=/^([0-9]*?)px$/.exec(t=t||x),o=+(n&&n[1])||d,i=0;if(0<=t.indexOf("mono"))i=o*e.length;else for(var a=0;a<e.length;a++){var s=p[e[a]];i+=null==s?o:s*o}return{width:i}},loadImage:function(e,t,r){var n=new Image;return n.onload=t,n.onerror=r,n.src=e,n}};var s=A(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(e,t){return e["[object "+t+"]"]=!0,e},{}),f=A(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(e,t){return e["[object "+t+"Array]"]=!0,e},{}),m=Object.prototype.toString,r=Array.prototype,a=r.forEach,v=r.filter,o=r.slice,y=r.map,n=function(){}.constructor,i=n?n.prototype:null,_="__proto__",b=2311;function S(){return b++}function w(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];"undefined"!=typeof console&&console.error.apply(console,e)}function E(e){if(null==e||"object"!=typeof e)return e;var t=e,r=m.call(e);if("[object Array]"===r){if(!re(e)){t=[];for(var n=0,o=e.length;n<o;n++)t[n]=E(e[n])}}else if(f[r]){if(!re(e)){var i=e.constructor;if(i.from)t=i.from(e);else{t=new i(e.length);for(n=0,o=e.length;n<o;n++)t[n]=e[n]}}}else if(!s[r]&&!re(e)&&!G(e))for(var a in t={},e)e.hasOwnProperty(a)&&a!==_&&(t[a]=E(e[a]));return t}function I(e,t,r){if(!V(t)||!V(e))return r?E(t):e;for(var n in t)if(t.hasOwnProperty(n)&&n!==_){var o=e[n],i=t[n];!V(i)||!V(o)||K(i)||K(o)||G(i)||G(o)||F(i)||F(o)||re(i)||re(o)?!r&&n in e||(e[n]=E(t[n])):I(o,i,r)}return e}function O(e,t){if(Object.assign)Object.assign(e,t);else for(var r in t)t.hasOwnProperty(r)&&r!==_&&(e[r]=t[r]);return e}function T(e,t,r){for(var n=L(t),o=0;o<n.length;o++){var i=n[o];(r?null!=t[i]:null==e[i])&&(e[i]=t[i])}return e}var C=h.createCanvas;function P(e,t){if(e){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r}return-1}function R(e,t,r){if(e="prototype"in e?e.prototype:e,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames)for(var n=Object.getOwnPropertyNames(t),o=0;o<n.length;o++){var i=n[o];"constructor"!==i&&(r?null!=t[i]:null==e[i])&&(e[i]=t[i])}else T(e,t,r)}function k(e){return!!e&&("string"!=typeof e&&"number"==typeof e.length)}function U(e,t,r){if(e&&t)if(e.forEach&&e.forEach===a)e.forEach(t,r);else if(e.length===+e.length)for(var n=0,o=e.length;n<o;n++)t.call(r,e[n],n,e);else for(var i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}function M(e,t,r){if(!e)return[];if(!t)return Q(e);if(e.map&&e.map===y)return e.map(t,r);for(var n=[],o=0,i=e.length;o<i;o++)n.push(t.call(r,e[o],o,e));return n}function A(e,t,r,n){if(e&&t){for(var o=0,i=e.length;o<i;o++)r=t.call(n,r,e[o],o,e);return r}}function D(e,t,r){if(!e)return[];if(!t)return Q(e);if(e.filter&&e.filter===v)return e.filter(t,r);for(var n=[],o=0,i=e.length;o<i;o++)t.call(r,e[o],o,e)&&n.push(e[o]);return n}function L(e){if(!e)return[];if(Object.keys)return Object.keys(e);var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}var H=i&&N(i.bind)?i.call.bind(i.bind):function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return function(){return e.apply(t,r.concat(o.call(arguments)))}};function K(e){return Array.isArray?Array.isArray(e):"[object Array]"===m.call(e)}function N(e){return"function"==typeof e}function B(e){return"string"==typeof e}function j(e){return"number"==typeof e}function V(e){var t=typeof e;return"function"===t||!!e&&"object"===t}function F(e){return!!s[m.call(e)]}function q(e){return!!f[m.call(e)]}function G(e){return"object"==typeof e&&"number"==typeof e.nodeType&&"object"==typeof e.ownerDocument}function W(e){return null!=e.colorStops}function z(e){return null!=e.image}function Y(e){return e!=e}function X(e,t){return null!=e?e:t}function J(e,t,r){return null!=e?e:null!=t?t:r}function Q(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return o.apply(e,t)}function Z(e){if("number"==typeof e)return[e,e,e,e];var t=e.length;return 2===t?[e[0],e[1],e[0],e[1]]:3===t?[e[0],e[1],e[2],e[1]]:e}function $(e,t){if(!e)throw new Error(t)}function ee(e){return null==e?null:"function"==typeof e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var te="__ec_primitive__";function re(e){return e[te]}var ne=function(){function o(e){this.data={};var r=K(e);this.data={};var n=this;function t(e,t){r?n.set(e,t):n.set(t,e)}e instanceof o?e.each(t):e&&U(e,t)}return o.prototype.get=function(e){return this.data.hasOwnProperty(e)?this.data[e]:null},o.prototype.set=function(e,t){return this.data[e]=t},o.prototype.each=function(e,t){for(var r in this.data)this.data.hasOwnProperty(r)&&e.call(t,this.data[r],r)},o.prototype.keys=function(){return L(this.data)},o.prototype.removeKey=function(e){delete this.data[e]},o}();function oe(e,t){var r;if(Object.create)r=Object.create(e);else{var n=function(){};n.prototype=e,r=new n}return t&&O(r,t),r}function ie(e){var t=e.style;t.webkitUserSelect="none",t.userSelect="none",t.webkitTapHighlightColor="rgba(0,0,0,0)",t["-webkit-touch-callout"]="none"}function ae(e,t){return e.hasOwnProperty(t)}function se(){}var de=180/Math.PI,le=Object.freeze({__proto__:null,guid:S,logError:w,clone:E,merge:I,mergeAll:function(e,t){for(var r=e[0],n=1,o=e.length;n<o;n++)r=I(r,e[n],t);return r},extend:O,defaults:T,createCanvas:C,indexOf:P,inherits:function(e,t){var r=e.prototype;function n(){}for(var o in n.prototype=t.prototype,e.prototype=new n,r)r.hasOwnProperty(o)&&(e.prototype[o]=r[o]);(e.prototype.constructor=e).superClass=t},mixin:R,isArrayLike:k,each:U,map:M,reduce:A,filter:D,find:function(e,t,r){if(e&&t)for(var n=0,o=e.length;n<o;n++)if(t.call(r,e[n],n,e))return e[n]},keys:L,bind:H,curry:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(){return e.apply(this,t.concat(o.call(arguments)))}},isArray:K,isFunction:N,isString:B,isStringSafe:function(e){return"[object String]"===m.call(e)},isNumber:j,isObject:V,isBuiltInObject:F,isTypedArray:q,isDom:G,isGradientObject:W,isImagePatternObject:z,isRegExp:function(e){return"[object RegExp]"===m.call(e)},eqNaN:Y,retrieve:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e.length;r<n;r++)if(null!=e[r])return e[r]},retrieve2:X,retrieve3:J,slice:Q,normalizeCssArray:Z,assert:$,trim:ee,setAsPrimitive:function(e){e[te]=!0},isPrimitive:re,HashMap:ne,createHashMap:function(e){return new ne(e)},concatArray:function(e,t){for(var r=new e.constructor(e.length+t.length),n=0;n<e.length;n++)r[n]=e[n];var o=e.length;for(n=0;n<t.length;n++)r[n+o]=t[n];return r},createObject:oe,disableUserSelect:ie,hasOwn:ae,noop:se,RADIAN_TO_DEGREE:de}),ue=function(e,t){return(ue=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function ce(e,t){function r(){this.constructor=e}ue(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function pe(e,t){return null==e&&(e=0),null==t&&(t=0),[e,t]}function he(e){return[e[0],e[1]]}function fe(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function me(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function ge(e){return Math.sqrt(ye(e))}var ve=ge;function ye(e){return e[0]*e[0]+e[1]*e[1]}var _e=ye;function be(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Se(e,t){var r=ge(t);return 0===r?(e[0]=0,e[1]=0):(e[0]=t[0]/r,e[1]=t[1]/r),e}function we(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var Ee=we;function Ie(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var Te=Ie;function Ce(e,t,r,n){return e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e}function Re(e,t,r){var n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o+r[4],e[1]=r[1]*n+r[3]*o+r[5],e}function Pe(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function ke(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}var xe=Object.freeze({__proto__:null,create:pe,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},clone:he,set:function(e,t,r){return e[0]=t,e[1]=r,e},add:fe,scaleAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e},sub:me,len:ge,length:ve,lenSquare:ye,lengthSquare:_e,mul:function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},div:function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},scale:be,normalize:Se,distance:we,dist:Ee,distanceSquare:Ie,distSquare:Te,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},lerp:Ce,applyTransform:Re,min:Pe,max:ke}),Me=function(e,t){this.target=e,this.topTarget=t&&t.topTarget},Ae=function(){function e(e){(this.handler=e).on("mousedown",this._dragStart,this),e.on("mousemove",this._drag,this),e.on("mouseup",this._dragEnd,this)}return e.prototype._dragStart=function(e){for(var t=e.target;t&&!t.draggable;)t=t.parent||t.__hostTarget;t&&((this._draggingTarget=t).dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.handler.dispatchToElement(new Me(t,e),"dragstart",e.event))},e.prototype._drag=function(e){var t=this._draggingTarget;if(t){var r=e.offsetX,n=e.offsetY,o=r-this._x,i=n-this._y;this._x=r,this._y=n,t.drift(o,i,e),this.handler.dispatchToElement(new Me(t,e),"drag",e.event);var a=this.handler.findHover(r,n,t).target,s=this._dropTarget;t!==(this._dropTarget=a)&&(s&&a!==s&&this.handler.dispatchToElement(new Me(s,e),"dragleave",e.event),a&&a!==s&&this.handler.dispatchToElement(new Me(a,e),"dragenter",e.event))}},e.prototype._dragEnd=function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.handler.dispatchToElement(new Me(t,e),"dragend",e.event),this._dropTarget&&this.handler.dispatchToElement(new Me(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null},e}(),Oe=function(){function e(e){e&&(this._$eventProcessor=e)}return e.prototype.on=function(e,t,r,n){this._$handlers||(this._$handlers={});var o=this._$handlers;if("function"==typeof t&&(n=r,r=t,t=null),!r||!e)return this;var i=this._$eventProcessor;null!=t&&i&&i.normalizeQuery&&(t=i.normalizeQuery(t)),o[e]||(o[e]=[]);for(var a=0;a<o[e].length;a++)if(o[e][a].h===r)return this;var s={h:r,query:t,ctx:n||this,callAtLast:r.zrEventfulCallAtLast},d=o[e].length-1,l=o[e][d];return l&&l.callAtLast?o[e].splice(d,0,s):o[e].push(s),this},e.prototype.isSilent=function(e){var t=this._$handlers;return!t||!t[e]||!t[e].length},e.prototype.off=function(e,t){var r=this._$handlers;if(!r)return this;if(!e)return this._$handlers={},this;if(t){if(r[e]){for(var n=[],o=0,i=r[e].length;o<i;o++)r[e][o].h!==t&&n.push(r[e][o]);r[e]=n}r[e]&&0===r[e].length&&delete r[e]}else delete r[e];return this},e.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!this._$handlers)return this;var n=this._$handlers[e],o=this._$eventProcessor;if(n)for(var i=t.length,a=n.length,s=0;s<a;s++){var d=n[s];if(!o||!o.filter||null==d.query||o.filter(e,d.query))switch(i){case 0:d.h.call(d.ctx);break;case 1:d.h.call(d.ctx,t[0]);break;case 2:d.h.call(d.ctx,t[0],t[1]);break;default:d.h.apply(d.ctx,t)}}return o&&o.afterTrigger&&o.afterTrigger(e),this},e.prototype.triggerWithContext=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(!this._$handlers)return this;var n=this._$handlers[e],o=this._$eventProcessor;if(n)for(var i=t.length,a=t[i-1],s=n.length,d=0;d<s;d++){var l=n[d];if(!o||!o.filter||null==l.query||o.filter(e,l.query))switch(i){case 0:l.h.call(a);break;case 1:l.h.call(a,t[0]);break;case 2:l.h.call(a,t[0],t[1]);break;default:l.h.apply(a,t.slice(1,i-1))}}return o&&o.afterTrigger&&o.afterTrigger(e),this},e}(),Ue=Math.log(2);function De(e,t,r,n,o,i){var a=n+"-"+o,s=e.length;if(i.hasOwnProperty(a))return i[a];if(1===t){var d=Math.round(Math.log((1<<s)-1&~o)/Ue);return e[r][d]}for(var l=n|1<<r,u=r+1;n&1<<u;)u++;for(var c=0,p=0,h=0;p<s;p++){var f=1<<p;f&o||(c+=(h%2?-1:1)*e[r][p]*De(e,t-1,u,l,o|f,i),h++)}return i[a]=c}function Le(e,t){var r=[[e[0],e[1],1,0,0,0,-t[0]*e[0],-t[0]*e[1]],[0,0,0,e[0],e[1],1,-t[1]*e[0],-t[1]*e[1]],[e[2],e[3],1,0,0,0,-t[2]*e[2],-t[2]*e[3]],[0,0,0,e[2],e[3],1,-t[3]*e[2],-t[3]*e[3]],[e[4],e[5],1,0,0,0,-t[4]*e[4],-t[4]*e[5]],[0,0,0,e[4],e[5],1,-t[5]*e[4],-t[5]*e[5]],[e[6],e[7],1,0,0,0,-t[6]*e[6],-t[6]*e[7]],[0,0,0,e[6],e[7],1,-t[7]*e[6],-t[7]*e[7]]],n={},o=De(r,8,0,0,0,n);if(0!==o){for(var i=[],a=0;a<8;a++)for(var s=0;s<8;s++)null==i[s]&&(i[s]=0),i[s]+=((a+s)%2?-1:1)*De(r,7,0===a?1:0,1<<a,1<<s,n)/o*t[a];return function(e,t,r){var n=t*i[6]+r*i[7]+1;e[0]=(t*i[0]+r*i[1]+i[2])/n,e[1]=(t*i[3]+r*i[4]+i[5])/n}}}var He="___zrEVENTSAVED";function Ne(e,t,r,n,o){if(t.getBoundingClientRect&&l.domSupported&&!Be(t)){var i=t[He]||(t[He]={}),a=function(e,t,r){for(var n=r?"invTrans":"trans",o=t[n],i=t.srcCoords,a=[],s=[],d=!0,l=0;l<4;l++){var u=e[l].getBoundingClientRect(),c=2*l,p=u.left,h=u.top;a.push(p,h),d=d&&i&&p===i[c]&&h===i[c+1],s.push(e[l].offsetLeft,e[l].offsetTop)}return d&&o?o:(t.srcCoords=a,t[n]=r?Le(s,a):Le(a,s))}(function(e,t){var r=t.markers;if(r)return r;r=t.markers=[];for(var n=["left","right"],o=["top","bottom"],i=0;i<4;i++){var a=document.createElement("div"),s=a.style,d=i%2,l=(i>>1)%2;s.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",n[d]+":0",o[l]+":0",n[1-d]+":auto",o[1-l]+":auto",""].join("!important;"),e.appendChild(a),r.push(a)}return r}(t,i),i,o);if(a)return a(e,r,n),!0}return!1}function Be(e){return"CANVAS"===e.nodeName.toUpperCase()}var je=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ve=[],Fe=l.browser.firefox&&+l.browser.version.split(".")[0]<39;function qe(e,t,r,n){return r=r||{},n?Ge(e,t,r):Fe&&null!=t.layerX&&t.layerX!==t.offsetX?(r.zrX=t.layerX,r.zrY=t.layerY):null!=t.offsetX?(r.zrX=t.offsetX,r.zrY=t.offsetY):Ge(e,t,r),r}function Ge(e,t,r){if(l.domSupported&&e.getBoundingClientRect){var n=t.clientX,o=t.clientY;if(Be(e)){var i=e.getBoundingClientRect();return r.zrX=n-i.left,void(r.zrY=o-i.top)}if(Ne(Ve,e,n,o))return r.zrX=Ve[0],void(r.zrY=Ve[1])}r.zrX=r.zrY=0}function We(e){return e||window.event}function ze(e,t,r){if(null!=(t=We(t)).zrX)return t;var n=t.type;if(n&&0<=n.indexOf("touch")){var o="touchend"!==n?t.targetTouches[0]:t.changedTouches[0];o&&qe(e,o,t,r)}else{qe(e,t,t,r);var i=function(e){var t=e.wheelDelta;if(t)return t;var r=e.deltaX,n=e.deltaY;return null!=r&&null!=n?3*(0!==n?Math.abs(n):Math.abs(r))*(0<n?-1:n<0?1:0<r?-1:1):t}(t);t.zrDelta=i?i/120:-(t.detail||0)/3}var a=t.button;return null==t.which&&void 0!==a&&je.test(t.type)&&(t.which=1&a?1:2&a?3:4&a?2:0),t}var Ye=function(e){e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0},Ke=function(){function e(){this._track=[]}return e.prototype.recognize=function(e,t,r){return this._doTrack(e,t,r),this._recognize(e)},e.prototype.clear=function(){return this._track.length=0,this},e.prototype._doTrack=function(e,t,r){var n=e.touches;if(n){for(var o={points:[],touches:[],target:t,event:e},i=0,a=n.length;i<a;i++){var s=n[i],d=qe(r,s,{});o.points.push([d.zrX,d.zrY]),o.touches.push(s)}this._track.push(o)}},e.prototype._recognize=function(e){for(var t in Je)if(Je.hasOwnProperty(t)){var r=Je[t](this._track,e);if(r)return r}},e}();function Xe(e){var t=e[1][0]-e[0][0],r=e[1][1]-e[0][1];return Math.sqrt(t*t+r*r)}var Je={pinch:function(e,t){var r=e.length;if(r){var n,o=(e[r-1]||{}).points,i=(e[r-2]||{}).points||o;if(i&&1<i.length&&o&&1<o.length){var a=Xe(o)/Xe(i);!isFinite(a)&&(a=1),t.pinchScale=a;var s=[((n=o)[0][0]+n[1][0])/2,(n[0][1]+n[1][1])/2];return t.pinchX=s[0],t.pinchY=s[1],{type:"pinch",target:e[0].target,event:t}}}}},Qe="silent";function Ze(){Ye(this.event)}var $e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handler=null,e}return ce(e,t),e.prototype.dispose=function(){},e.prototype.setCursor=function(){},e}(Oe),et=function(e,t){this.x=e,this.y=t},tt=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],rt=function(i){function e(e,t,r,n){var o=i.call(this)||this;return o._hovered=new et(0,0),o.storage=e,o.painter=t,o.painterRoot=n,r=r||new $e,o.proxy=null,o.setHandlerProxy(r),o._draggingMgr=new Ae(o),o}return ce(e,i),e.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(U(tt,function(e){t.on&&t.on(e,this[e],this)},this),t.handler=this),this.proxy=t},e.prototype.mousemove=function(e){var t=e.zrX,r=e.zrY,n=ot(this,t,r),o=this._hovered,i=o.target;i&&!i.__zr&&(i=(o=this.findHover(o.x,o.y)).target);var a=this._hovered=n?new et(t,r):this.findHover(t,r),s=a.target,d=this.proxy;d.setCursor&&d.setCursor(""!=avdEngineHandle.eraserCustomIconPath?avdEngineHandle.eraserCustomIconPath:"default"),i&&s!==i&&this.dispatchToElement(o,"mouseout",e),this.dispatchToElement(a,"mousemove",e),s&&s!==i&&this.dispatchToElement(a,"mouseover",e)},e.prototype.mouseout=function(e){var t=e.zrEventControl;"only_globalout"!==t&&this.dispatchToElement(this._hovered,"mouseout",e),"no_globalout"!==t&&this.trigger("globalout",{type:"globalout",event:e})},e.prototype.resize=function(){this._hovered=new et(0,0)},e.prototype.dispatch=function(e,t){var r=this[e];r&&r.call(this,t)},e.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},e.prototype.setCursorStyle=function(e){var t=this.proxy;t.setCursor&&t.setCursor(e)},e.prototype.dispatchToElement=function(e,t,r){var n=(e=e||{}).target;if(!n||!n.silent){for(var o,i,a="on"+t,s={type:t,event:i=r,target:(o=e).target,topTarget:o.topTarget,cancelBubble:!1,offsetX:i.zrX,offsetY:i.zrY,gestureEvent:i.gestureEvent,pinchX:i.pinchX,pinchY:i.pinchY,pinchScale:i.pinchScale,wheelDelta:i.zrDelta,zrByTouch:i.zrByTouch,which:i.which,stop:Ze};n&&(n[a]&&(s.cancelBubble=!!n[a].call(n,s)),n.trigger(t,s),n=n.__hostTarget?n.__hostTarget:n.parent,!s.cancelBubble););s.cancelBubble||(this.trigger(t,s),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(e){"function"==typeof e[a]&&e[a].call(e,s),e.trigger&&e.trigger(t,s)}))}},e.prototype.findHover=function(e,t,r){for(var n=this.storage.getDisplayList(),o=new et(e,t),i=n.length-1;0<=i;i--){var a=void 0;if(n[i]!==r&&!n[i].ignore&&(a=nt(n[i],e,t))&&(!o.topTarget&&(o.topTarget=n[i]),a!==Qe)){o.target=n[i];break}}return o},e.prototype.processGesture=function(e,t){this._gestureMgr||(this._gestureMgr=new Ke);var r=this._gestureMgr;"start"===t&&r.clear();var n=r.recognize(e,this.findHover(e.zrX,e.zrY,null).target,this.proxy.dom);if("end"===t&&r.clear(),n){var o=n.type;e.gestureEvent=o;var i=new et;i.target=n.target,this.dispatchToElement(i,o,n.event)}},e}(Oe);function nt(e,t,r){if(e[e.rectHover?"rectContain":"contain"](t,r)){for(var n=e,o=void 0,i=!1;n;){if(n.ignoreClip&&(i=!0),!i){var a=n.getClipPath();if(a&&!a.contain(t,r))return!1;n.silent&&(o=!0)}var s=n.__hostTarget;n=s||n.parent}return!o||Qe}return!1}function ot(e,t,r){var n=e.painter;return t<0||t>n.getWidth()||r<0||r>n.getHeight()}U(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(a){rt.prototype[a]=function(e){var t,r,n=e.zrX,o=e.zrY,i=ot(this,n,o);if("mouseup"===a&&i||(r=(t=this.findHover(n,o)).target),"mousedown"===a)this._downEl=r,this._downPoint=[e.zrX,e.zrY],this._upEl=r;else if("mouseup"===a)this._upEl=r;else if("click"===a){if(this._downEl!==this._upEl||!this._downPoint||4<Ee(this._downPoint,[e.zrX,e.zrY]))return;this._downPoint=null}this.dispatchToElement(t,a,e)}});var it=32,at=7;function st(e,t,r,n){var o=t+1;if(o===r)return 1;if(n(e[o++],e[t])<0){for(;o<r&&n(e[o],e[o-1])<0;)o++;!function(e,t,r){r--;for(;t<r;){var n=e[t];e[t++]=e[r],e[r--]=n}}(e,t,o)}else for(;o<r&&0<=n(e[o],e[o-1]);)o++;return o-t}function dt(e,t,r,n,o){for(n===t&&n++;n<r;n++){for(var i,a=e[n],s=t,d=n;s<d;)o(a,e[i=s+d>>>1])<0?d=i:s=i+1;var l=n-s;switch(l){case 3:e[s+3]=e[s+2];case 2:e[s+2]=e[s+1];case 1:e[s+1]=e[s];break;default:for(;0<l;)e[s+l]=e[s+l-1],l--}e[s]=a}}function lt(e,t,r,n,o,i){var a=0,s=0,d=1;if(0<i(e,t[r+o])){for(s=n-o;d<s&&0<i(e,t[r+o+d]);)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s),a+=o,d+=o}else{for(s=o+1;d<s&&i(e,t[r+o-d])<=0;)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s);var l=a;a=o-d,d=o-l}for(a++;a<d;){var u=a+(d-a>>>1);0<i(e,t[r+u])?a=u+1:d=u}return d}function ut(e,t,r,n,o,i){var a=0,s=0,d=1;if(i(e,t[r+o])<0){for(s=o+1;d<s&&i(e,t[r+o-d])<0;)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s);var l=a;a=o-d,d=o-l}else{for(s=n-o;d<s&&0<=i(e,t[r+o+d]);)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s),a+=o,d+=o}for(a++;a<d;){var u=a+(d-a>>>1);i(e,t[r+u])<0?d=u:a=u+1}return d}function ct(f,m){var a,s,g=at,d=0;f.length;var v=[];function t(e){var t=a[e],r=s[e],n=a[e+1],o=s[e+1];s[e]=r+o,e===d-3&&(a[e+1]=a[e+2],s[e+1]=s[e+2]),d--;var i=ut(f[n],f,t,r,0,m);t+=i,0!==(r-=i)&&0!==(o=lt(f[t+r-1],f,n,o,o-1,m))&&(r<=o?function(e,t,r,n){var o=0;for(o=0;o<t;o++)v[o]=f[e+o];var i=0,a=r,s=e;if(f[s++]=f[a++],0==--n){for(o=0;o<t;o++)f[s+o]=v[i+o];return}if(1===t){for(o=0;o<n;o++)f[s+o]=f[a+o];return f[s+n]=v[i]}var d,l,u,c=g;for(;;){l=d=0,u=!1;do{if(m(f[a],v[i])<0){if(f[s++]=f[a++],l++,(d=0)==--n){u=!0;break}}else if(f[s++]=v[i++],d++,l=0,1==--t){u=!0;break}}while((d|l)<c);if(u)break;do{if(0!==(d=ut(f[a],v,i,t,0,m))){for(o=0;o<d;o++)f[s+o]=v[i+o];if(s+=d,i+=d,(t-=d)<=1){u=!0;break}}if(f[s++]=f[a++],0==--n){u=!0;break}if(0!==(l=lt(v[i],f,a,n,0,m))){for(o=0;o<l;o++)f[s+o]=f[a+o];if(s+=l,a+=l,0===(n-=l)){u=!0;break}}if(f[s++]=v[i++],1==--t){u=!0;break}c--}while(at<=d||at<=l);if(u)break;c<0&&(c=0),c+=2}if((g=c)<1&&(g=1),1===t){for(o=0;o<n;o++)f[s+o]=f[a+o];f[s+n]=v[i]}else{if(0===t)throw new Error;for(o=0;o<t;o++)f[s+o]=v[i+o]}}(t,r,n,o):function(e,t,r,n){var o=0;for(o=0;o<n;o++)v[o]=f[r+o];var i=e+t-1,a=n-1,s=r+n-1,d=0,l=0;if(f[s--]=f[i--],0==--t){for(d=s-(n-1),o=0;o<n;o++)f[d+o]=v[o];return}if(1===n){for(l=(s-=t)+1,d=(i-=t)+1,o=t-1;0<=o;o--)f[l+o]=f[d+o];return f[s]=v[a]}var u=g;for(;;){var c=0,p=0,h=!1;do{if(m(v[a],f[i])<0){if(f[s--]=f[i--],c++,(p=0)==--t){h=!0;break}}else if(f[s--]=v[a--],p++,c=0,1==--n){h=!0;break}}while((c|p)<u);if(h)break;do{if(0!==(c=t-ut(v[a],f,e,t,t-1,m))){for(t-=c,l=(s-=c)+1,d=(i-=c)+1,o=c-1;0<=o;o--)f[l+o]=f[d+o];if(0===t){h=!0;break}}if(f[s--]=v[a--],1==--n){h=!0;break}if(0!==(p=n-lt(f[i],v,0,n,n-1,m))){for(n-=p,l=(s-=p)+1,d=(a-=p)+1,o=0;o<p;o++)f[l+o]=v[d+o];if(n<=1){h=!0;break}}if(f[s--]=f[i--],0==--t){h=!0;break}u--}while(at<=c||at<=p);if(h)break;u<0&&(u=0),u+=2}(g=u)<1&&(g=1);if(1===n){for(l=(s-=t)+1,d=(i-=t)+1,o=t-1;0<=o;o--)f[l+o]=f[d+o];f[s]=v[a]}else{if(0===n)throw new Error;for(d=s-(n-1),o=0;o<n;o++)f[d+o]=v[o]}}(t,r,n,o))}return a=[],s=[],{mergeRuns:function(){for(;1<d;){var e=d-2;if(1<=e&&s[e-1]<=s[e]+s[e+1]||2<=e&&s[e-2]<=s[e]+s[e-1])s[e-1]<s[e+1]&&e--;else if(s[e]>s[e+1])break;t(e)}},forceMergeRuns:function(){for(;1<d;){var e=d-2;0<e&&s[e-1]<s[e+1]&&e--,t(e)}},pushRun:function(e,t){a[d]=e,s[d]=t,d+=1}}}function pt(e,t,r,n){r||(r=0),n||(n=e.length);var o=n-r;if(!(o<2)){var i=0;if(o<it)dt(e,r,n,r+(i=st(e,r,n,t)),t);else{var a=ct(e,t),s=function(e){for(var t=0;it<=e;)t|=1&e,e>>=1;return e+t}(o);do{if((i=st(e,r,n,t))<s){var d=o;s<d&&(d=s),dt(e,r,r+d,r+i,t),i=d}a.pushRun(r,i),a.mergeRuns(),o-=i,r+=i}while(0!==o);a.forceMergeRuns()}}}var ht=1,ft=4,mt=!1;function gt(){mt||(mt=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function vt(e,t){return e.zlevel===t.zlevel?e.z===t.z?e.z2-t.z2:e.z-t.z:e.zlevel-t.zlevel}var yt=function(){function e(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=vt}return e.prototype.traverse=function(e,t){for(var r=0;r<this._roots.length;r++)this._roots[r].traverse(e,t)},e.prototype.getDisplayList=function(e,t){t=t||!1;var r=this._displayList;return!e&&r.length||this.updateDisplayList(t),r},e.prototype.updateDisplayList=function(e){this._displayListLen=0;for(var t=this._roots,r=this._displayList,n=0,o=t.length;n<o;n++)this._updateAndAddDisplayable(t[n],null,e);r.length=this._displayListLen,pt(r,vt)},e.prototype._updateAndAddDisplayable=function(e,t,r){if(!e.ignore||r){e.beforeUpdate(),e.update(),e.afterUpdate();var n=e.getClipPath();if(e.ignoreClip)t=null;else if(n){t=t?t.slice():[];for(var o=n,i=e;o;)o.parent=i,o.updateTransform(),t.push(o),o=(i=o).getClipPath()}if(e.childrenRef){for(var a=e.childrenRef(),s=0;s<a.length;s++){var d=a[s];e.__dirty&&(d.__dirty|=ht),this._updateAndAddDisplayable(d,t,r)}e.__dirty=0}else{var l=e;t&&t.length?l.__clipPaths=t:l.__clipPaths&&0<l.__clipPaths.length&&(l.__clipPaths=[]),isNaN(l.z)&&(gt(),l.z=0),isNaN(l.z2)&&(gt(),l.z2=0),isNaN(l.zlevel)&&(gt(),l.zlevel=0),this._displayList[this._displayListLen++]=l}var u=e.getDecalElement&&e.getDecalElement();u&&this._updateAndAddDisplayable(u,t,r);var c=e.getTextGuideLine();c&&this._updateAndAddDisplayable(c,t,r);var p=e.getTextContent();p&&this._updateAndAddDisplayable(p,t,r)}},e.prototype.addRoot=function(e){e.__zr&&e.__zr.storage===this||this._roots.push(e)},e.prototype.delRoot=function(e){if(e instanceof Array)for(var t=0,r=e.length;t<r;t++)this.delRoot(e[t]);else{var n=P(this._roots,e);0<=n&&this._roots.splice(n,1)}},e.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},e.prototype.getRoots=function(){return this._roots},e.prototype.dispose=function(){this._displayList=null,this._roots=null},e}(),_t=l.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){return setTimeout(e,16)},bt={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},exponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},elasticOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},elasticInOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:r*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)},backIn:function(e){return e*e*(2.70158*e-1.70158)},backOut:function(e){return--e*e*(2.70158*e+1.70158)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:function(e){return 1-bt.bounceOut(1-e)},bounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bounceInOut:function(e){return e<.5?.5*bt.bounceIn(2*e):.5*bt.bounceOut(2*e-1)+.5}},St=Math.pow,wt=Math.sqrt,Et=1e-8,It=1e-4,Tt=wt(3),Ct=1/3,Rt=pe(),Pt=pe(),kt=pe();function xt(e){return-Et<e&&e<Et}function Mt(e){return Et<e||e<-Et}function At(e,t,r,n,o){var i=1-o;return i*i*(i*e+3*o*t)+o*o*(o*n+3*i*r)}function Ot(e,t,r,n,o){var i=1-o;return 3*(((t-e)*i+2*(r-t)*o)*i+(n-r)*o*o)}function Ut(e,t,r,n,o,i){var a=n+3*(t-r)-e,s=3*(r-2*t+e),d=3*(t-e),l=e-o,u=s*s-3*a*d,c=s*d-9*a*l,p=d*d-3*s*l,h=0;if(xt(u)&&xt(c)){if(xt(s))i[0]=0;else 0<=(I=-d/s)&&I<=1&&(i[h++]=I)}else{var f=c*c-4*u*p;if(xt(f)){var m=c/u,g=-m/2;0<=(I=-s/a+m)&&I<=1&&(i[h++]=I),0<=g&&g<=1&&(i[h++]=g)}else if(0<f){var v=wt(f),y=u*s+1.5*a*(-c+v),_=u*s+1.5*a*(-c-v);0<=(I=(-s-((y=y<0?-St(-y,Ct):St(y,Ct))+(_=_<0?-St(-_,Ct):St(_,Ct))))/(3*a))&&I<=1&&(i[h++]=I)}else{var b=(2*u*s-3*a*c)/(2*wt(u*u*u)),S=Math.acos(b)/3,w=wt(u),E=Math.cos(S),I=(-s-2*w*E)/(3*a),T=(g=(-s+w*(E+Tt*Math.sin(S)))/(3*a),(-s+w*(E-Tt*Math.sin(S)))/(3*a));0<=I&&I<=1&&(i[h++]=I),0<=g&&g<=1&&(i[h++]=g),0<=T&&T<=1&&(i[h++]=T)}}return h}function Dt(e,t,r,n,o){var i=6*r-12*t+6*e,a=9*t+3*n-3*e-9*r,s=3*t-3*e,d=0;if(xt(a)){if(Mt(i))0<=(u=-s/i)&&u<=1&&(o[d++]=u)}else{var l=i*i-4*a*s;if(xt(l))o[0]=-i/(2*a);else if(0<l){var u,c=wt(l),p=(-i-c)/(2*a);0<=(u=(-i+c)/(2*a))&&u<=1&&(o[d++]=u),0<=p&&p<=1&&(o[d++]=p)}}return d}function Lt(e,t,r,n,o,i){var a=(t-e)*o+e,s=(r-t)*o+t,d=(n-r)*o+r,l=(s-a)*o+a,u=(d-s)*o+s,c=(u-l)*o+l;i[0]=e,i[1]=a,i[2]=l,i[3]=c,i[4]=c,i[5]=u,i[6]=d,i[7]=n}function Ht(e,t,r,n,o,i,a,s,d){for(var l=e,u=t,c=0,p=1/d,h=1;h<=d;h++){var f=h*p,m=At(e,r,o,a,f),g=At(t,n,i,s,f),v=m-l,y=g-u;c+=Math.sqrt(v*v+y*y),l=m,u=g}return c}function Nt(e,t,r,n){var o=1-n;return o*(o*e+2*n*t)+n*n*r}function Bt(e,t,r,n){return 2*((1-n)*(t-e)+n*(r-t))}function jt(e,t,r){var n=e+r-2*t;return 0===n?.5:(e-t)/n}function Vt(e,t,r,n,o){var i=(t-e)*n+e,a=(r-t)*n+t,s=(a-i)*n+i;o[0]=e,o[1]=i,o[2]=s,o[3]=s,o[4]=a,o[5]=r}function Ft(e,t,r,n,o,i,a){for(var s=e,d=t,l=0,u=1/a,c=1;c<=a;c++){var p=c*u,h=Nt(e,r,o,p),f=Nt(t,n,i,p),m=h-s,g=f-d;l+=Math.sqrt(m*m+g*g),s=h,d=f}return l}var qt=/cubic-bezier\(([0-9,\.e ]+)\)/;function Gt(e){var t=e&&qt.exec(e);if(t){var r=t[1].split(","),n=+ee(r[0]),o=+ee(r[1]),i=+ee(r[2]),a=+ee(r[3]);if(isNaN(n+o+i+a))return;var s=[];return function(e){return e<=0?0:1<=e?1:Ut(0,n,i,1,e,s)&&At(0,o,a,1,s[0])}}}var Wt=function(){function e(e){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=e.life||1e3,this._delay=e.delay||0,this.loop=e.loop||!1,this.onframe=e.onframe||se,this.ondestroy=e.ondestroy||se,this.onrestart=e.onrestart||se,e.easing&&this.setEasing(e.easing)}return e.prototype.step=function(e,t){if(this._inited||(this._startTime=e+this._delay,this._inited=!0),!this._paused){var r=this._life,n=e-this._startTime-this._pausedTime,o=n/r;o<0&&(o=0),o=Math.min(o,1);var i=this.easingFunc,a=i?i(o):o;if(this.onframe(a),1===o){if(!this.loop)return!0;var s=n%r;this._startTime=e-s,this._pausedTime=0,this.onrestart()}return!1}this._pausedTime+=t},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){this._paused=!1},e.prototype.setEasing=function(e){this.easing=e,this.easingFunc=N(e)?e:bt[e]||Gt(e)},e}(),zt=function(e){this.value=e},Yt=function(){function e(){this._len=0}return e.prototype.insert=function(e){var t=new zt(e);return this.insertEntry(t),t},e.prototype.insertEntry=function(e){this.head?((this.tail.next=e).prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},e.prototype.remove=function(e){var t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t,e.next=e.prev=null,this._len--},e.prototype.len=function(){return this._len},e.prototype.clear=function(){this.head=this.tail=null,this._len=0},e}(),Kt=function(){function e(e){this._list=new Yt,this._maxSize=10,this._map={},this._maxSize=e}return e.prototype.put=function(e,t){var r=this._list,n=this._map,o=null;if(null==n[e]){var i=r.len(),a=this._lastRemovedEntry;if(i>=this._maxSize&&0<i){var s=r.head;r.remove(s),delete n[s.key],o=s.value,this._lastRemovedEntry=s}a?a.value=t:a=new zt(t),a.key=e,r.insertEntry(a),n[e]=a}return o},e.prototype.get=function(e){var t=this._map[e],r=this._list;if(null!=t)return t!==r.tail&&(r.remove(t),r.insertEntry(t)),t.value},e.prototype.clear=function(){this._list.clear(),this._map={}},e.prototype.len=function(){return this._list.len()},e}(),Xt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Jt(e){return(e=Math.round(e))<0?0:255<e?255:e}function Qt(e){return e<0?0:1<e?1:e}function Zt(e){var t=e;return t.length&&"%"===t.charAt(t.length-1)?Jt(parseFloat(t)/100*255):Jt(parseInt(t,10))}function $t(e){var t=e;return t.length&&"%"===t.charAt(t.length-1)?Qt(parseFloat(t)/100):Qt(parseFloat(t))}function er(e,t,r){return r<0?r+=1:1<r&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function tr(e,t,r){return e+(t-e)*r}function rr(e,t,r,n,o){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e}function nr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var or=new Kt(20),ir=null;function ar(e,t){ir&&nr(ir,t),ir=or.put(e,ir||t.slice())}function sr(e,t){if(e){t=t||[];var r=or.get(e);if(r)return nr(t,r);var n=(e+="").replace(/ /g,"").toLowerCase();if(n in Xt)return nr(t,Xt[n]),ar(e,t),t;var o,i=n.length;if("#"===n.charAt(0))return 4===i||5===i?0<=(o=parseInt(n.slice(1,4),16))&&o<=4095?(rr(t,(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,5===i?parseInt(n.slice(4),16)/15:1),ar(e,t),t):void rr(t,0,0,0,1):7===i||9===i?0<=(o=parseInt(n.slice(1,7),16))&&o<=16777215?(rr(t,(16711680&o)>>16,(65280&o)>>8,255&o,9===i?parseInt(n.slice(7),16)/255:1),ar(e,t),t):void rr(t,0,0,0,1):void 0;var a=n.indexOf("("),s=n.indexOf(")");if(-1!==a&&s+1===i){var d=n.substr(0,a),l=n.substr(a+1,s-(a+1)).split(","),u=1;switch(d){case"rgba":if(4!==l.length)return 3===l.length?rr(t,+l[0],+l[1],+l[2],1):rr(t,0,0,0,1);u=$t(l.pop());case"rgb":return 3!==l.length?void rr(t,0,0,0,1):(rr(t,Zt(l[0]),Zt(l[1]),Zt(l[2]),u),ar(e,t),t);case"hsla":return 4!==l.length?void rr(t,0,0,0,1):(l[3]=$t(l[3]),dr(l,t),ar(e,t),t);case"hsl":return 3!==l.length?void rr(t,0,0,0,1):(dr(l,t),ar(e,t),t);default:return}}rr(t,0,0,0,1)}}function dr(e,t){var r=(parseFloat(e[0])%360+360)%360/360,n=$t(e[1]),o=$t(e[2]),i=o<=.5?o*(n+1):o+n-o*n,a=2*o-i;return rr(t=t||[],Jt(255*er(a,i,r+1/3)),Jt(255*er(a,i,r)),Jt(255*er(a,i,r-1/3)),1),4===e.length&&(t[3]=e[3]),t}function lr(e,t,r){if(t&&t.length&&0<=e&&e<=1){r=r||[];var n=e*(t.length-1),o=Math.floor(n),i=Math.ceil(n),a=t[o],s=t[i],d=n-o;return r[0]=Jt(tr(a[0],s[0],d)),r[1]=Jt(tr(a[1],s[1],d)),r[2]=Jt(tr(a[2],s[2],d)),r[3]=Qt(tr(a[3],s[3],d)),r}}var ur=lr;function cr(e,t,r){if(t&&t.length&&0<=e&&e<=1){var n=e*(t.length-1),o=Math.floor(n),i=Math.ceil(n),a=sr(t[o]),s=sr(t[i]),d=n-o,l=hr([Jt(tr(a[0],s[0],d)),Jt(tr(a[1],s[1],d)),Jt(tr(a[2],s[2],d)),Qt(tr(a[3],s[3],d))],"rgba");return r?{color:l,leftIndex:o,rightIndex:i,value:n}:l}}var pr=cr;function hr(e,t){if(e&&e.length){var r=e[0]+","+e[1]+","+e[2];return"rgba"!==t&&"hsva"!==t&&"hsla"!==t||(r+=","+e[3]),t+"("+r+")"}}function fr(e,t){var r=sr(e);return r?(.299*r[0]+.587*r[1]+.114*r[2])*r[3]/255+(1-r[3])*t:0}var mr=Object.freeze({__proto__:null,parse:sr,lift:function(e,t){var r=sr(e);if(r){for(var n=0;n<3;n++)r[n]=t<0?r[n]*(1-t)|0:(255-r[n])*t+r[n]|0,255<r[n]?r[n]=255:r[n]<0&&(r[n]=0);return hr(r,4===r.length?"rgba":"rgb")}},toHex:function(e){var t=sr(e);if(t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)},fastLerp:lr,fastMapToColor:ur,lerp:cr,mapToColor:pr,modifyHSL:function(e,t,r,n){var o,i=sr(e);if(e)return i=function(e){if(e){var t,r,n=e[0]/255,o=e[1]/255,i=e[2]/255,a=Math.min(n,o,i),s=Math.max(n,o,i),d=s-a,l=(s+a)/2;if(0===d)r=t=0;else{r=l<.5?d/(s+a):d/(2-s-a);var u=((s-n)/6+d/2)/d,c=((s-o)/6+d/2)/d,p=((s-i)/6+d/2)/d;n===s?t=p-c:o===s?t=1/3+u-p:i===s&&(t=2/3+c-u),t<0&&(t+=1),1<t&&(t-=1)}var h=[360*t,r,l];return null!=e[3]&&h.push(e[3]),h}}(i),null!=t&&(i[0]=(o=t,(o=Math.round(o))<0?0:360<o?360:o)),null!=r&&(i[1]=$t(r)),null!=n&&(i[2]=$t(n)),hr(dr(i),"rgba")},modifyAlpha:function(e,t){var r=sr(e);if(r&&null!=t)return r[3]=Qt(t),hr(r,"rgba")},stringify:hr,lum:fr,random:function(){return hr([Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random())],"rgb")}}),gr=Math.round;function vr(e){var t;if(e&&"transparent"!==e){if("string"==typeof e&&-1<e.indexOf("rgba")){var r=sr(e);r&&(e="rgb("+r[0]+","+r[1]+","+r[2]+")",t=r[3])}}else e="none";return{color:e,opacity:null==t?1:t}}var yr=1e-4;function _r(e){return e<yr&&-yr<e}function br(e){return gr(1e3*e)/1e3}function Sr(e){return gr(1e4*e)/1e4}var wr={left:"start",right:"end",center:"middle",middle:"middle"};function Er(e){return e&&!!e.image}function Ir(e){return"linear"===e.type}function Tr(e){return"radial"===e.type}function Cr(e){return"url(#"+e+")"}function Rr(e){var t=e.getGlobalScale(),r=Math.max(t[0],t[1]);return Math.max(Math.ceil(Math.log(r)/Math.log(10)),1)}function Pr(e){var t=e.x||0,r=e.y||0,n=(e.rotation||0)*de,o=X(e.scaleX,1),i=X(e.scaleY,1),a=e.skewX||0,s=e.skewY||0,d=[];return(t||r)&&d.push("translate("+t+"px,"+r+"px)"),n&&d.push("rotate("+n+")"),1===o&&1===i||d.push("scale("+o+","+i+")"),(a||s)&&d.push("skew("+gr(a*de)+"deg, "+gr(s*de)+"deg)"),d.join(" ")}var kr=l.hasGlobalWindow&&N(window.btoa)?function(e){return window.btoa(unescape(e))}:"undefined"!=typeof Buffer?function(e){return Buffer.from(e).toString("base64")}:function(e){return w("Base64 isn't natively supported in the current environment."),null},xr=Array.prototype.slice;function Mr(e,t,r){return(t-e)*r+e}function Ar(e,t,r,n){for(var o=t.length,i=0;i<o;i++)e[i]=Mr(t[i],r[i],n);return e}function Or(e,t,r,n){for(var o=t.length,i=0;i<o;i++)e[i]=t[i]+r[i]*n;return e}function Ur(e,t,r,n){for(var o=t.length,i=o&&t[0].length,a=0;a<o;a++){e[a]||(e[a]=[]);for(var s=0;s<i;s++)e[a][s]=t[a][s]+r[a][s]*n}return e}function Dr(e,t){for(var r=e.length,n=t.length,o=n<r?t:e,i=Math.min(r,n),a=o[i-1]||{color:[0,0,0,0],offset:0},s=i;s<Math.max(r,n);s++)o.push({offset:a.offset,color:a.color.slice()})}function Lr(e,t,r){var n=e,o=t;if(n.push&&o.push){var i=n.length,a=o.length;if(i!==a)if(a<i)n.length=a;else for(var s=i;s<a;s++)n.push(1===r?o[s]:xr.call(o[s]));var d=n[0]&&n[0].length;for(s=0;s<n.length;s++)if(1===r)isNaN(n[s])&&(n[s]=o[s]);else for(var l=0;l<d;l++)isNaN(n[s][l])&&(n[s][l]=o[s][l])}}function Hr(e){if(k(e)){var t=e.length;if(k(e[0])){for(var r=[],n=0;n<t;n++)r.push(xr.call(e[n]));return r}return xr.call(e)}return e}function Nr(e){return e[0]=Math.floor(e[0])||0,e[1]=Math.floor(e[1])||0,e[2]=Math.floor(e[2])||0,e[3]=null==e[3]?1:e[3],"rgba("+e.join(",")+")"}function Br(e){return 4===e||5===e}function jr(e){return 1===e||2===e}var Vr=[0,0,0,0],Fr=function(){function e(e){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=e}return e.prototype.isFinished=function(){return this._finished},e.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},e.prototype.needsAnimate=function(){return 1<=this.keyframes.length},e.prototype.getAdditiveTrack=function(){return this._additiveTrack},e.prototype.addKeyframe=function(e,t,r){this._needsSort=!0;var n,o=this.keyframes,i=o.length,a=!1,s=6,d=t;if(k(t)){var l=k((n=t)&&n[0])?2:1;(1===(s=l)&&!j(t[0])||2===l&&!j(t[0][0]))&&(a=!0)}else if(j(t)&&!Y(t))s=0;else if(B(t))if(isNaN(+t)){var u=sr(t);u&&(d=u,s=3)}else s=0;else if(W(t)){var c=O({},d);c.colorStops=M(t.colorStops,function(e){return{offset:e.offset,color:sr(e.color)}}),Ir(t)?s=4:Tr(t)&&(s=5),d=c}0===i?this.valType=s:s===this.valType&&6!==s||(a=!0),this.discrete=this.discrete||a;var p={time:e,value:d,rawValue:t,percent:0};return r&&(p.easing=r,p.easingFunc=N(r)?r:bt[r]||Gt(r)),o.push(p),p},e.prototype.prepare=function(e,t){var r=this.keyframes;this._needsSort&&r.sort(function(e,t){return e.time-t.time});for(var n=this.valType,o=r.length,i=r[o-1],a=this.discrete,s=jr(n),d=Br(n),l=0;l<o;l++){var u=r[l],c=u.value,p=i.value;u.percent=u.time/e,a||(s&&l!==o-1?Lr(c,p,n):d&&Dr(c.colorStops,p.colorStops))}if(!a&&5!==n&&t&&this.needsAnimate()&&t.needsAnimate()&&n===t.valType&&!t._finished){this._additiveTrack=t;var h=r[0].value;for(l=0;l<o;l++)0===n?r[l].additiveValue=r[l].value-h:3===n?r[l].additiveValue=Or([],r[l].value,h,-1):jr(n)&&(r[l].additiveValue=1===n?Or([],r[l].value,h,-1):Ur([],r[l].value,h,-1))}},e.prototype.step=function(e,t){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var r,n,o,i=null!=this._additiveTrack,a=i?"additiveValue":"value",s=this.valType,d=this.keyframes,l=d.length,u=this.propName,c=3===s,p=this._lastFr,h=Math.min;if(1===l)n=o=d[0];else{if(t<0)r=0;else if(t<this._lastFrP){for(r=h(p+1,l-1);0<=r&&!(d[r].percent<=t);r--);r=h(r,l-2)}else{for(r=p;r<l&&!(d[r].percent>t);r++);r=h(r-1,l-2)}o=d[r+1],n=d[r]}if(n&&o){this._lastFr=r,this._lastFrP=t;var f=o.percent-n.percent,m=0===f?1:h((t-n.percent)/f,1);o.easingFunc&&(m=o.easingFunc(m));var g=i?this._additiveValue:c?Vr:e[u];if(!jr(s)&&!c||g||(g=this._additiveValue=[]),this.discrete)e[u]=m<1?n.rawValue:o.rawValue;else if(jr(s))1===s?Ar(g,n[a],o[a],m):function(e,t,r,n){for(var o=t.length,i=o&&t[0].length,a=0;a<o;a++){e[a]||(e[a]=[]);for(var s=0;s<i;s++)e[a][s]=Mr(t[a][s],r[a][s],n)}}(g,n[a],o[a],m);else if(Br(s)){var v=n[a],y=o[a],_=4===s;e[u]={type:_?"linear":"radial",x:Mr(v.x,y.x,m),y:Mr(v.y,y.y,m),colorStops:M(v.colorStops,function(e,t){var r=y.colorStops[t];return{offset:Mr(e.offset,r.offset,m),color:Nr(Ar([],e.color,r.color,m))}}),global:y.global},_?(e[u].x2=Mr(v.x2,y.x2,m),e[u].y2=Mr(v.y2,y.y2,m)):e[u].r=Mr(v.r,y.r,m)}else if(c)Ar(g,n[a],o[a],m),i||(e[u]=Nr(g));else{var b=Mr(n[a],o[a],m);i?this._additiveValue=b:e[u]=b}i&&this._addToTarget(e)}}},e.prototype._addToTarget=function(e){var t=this.valType,r=this.propName,n=this._additiveValue;0===t?e[r]=e[r]+n:3===t?(sr(e[r],Vr),Or(Vr,Vr,n,1),e[r]=Nr(Vr)):1===t?Or(e[r],e[r],n,1):2===t&&Ur(e[r],e[r],n,1)},e}(),qr=function(){function e(e,t,r,n){this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=e,(this._loop=t)&&n?w("Can' use additive animation on looped animation."):(this._additiveAnimators=n,this._allowDiscrete=r)}return e.prototype.getMaxTime=function(){return this._maxTime},e.prototype.getDelay=function(){return this._delay},e.prototype.getLoop=function(){return this._loop},e.prototype.getTarget=function(){return this._target},e.prototype.changeTarget=function(e){this._target=e},e.prototype.when=function(e,t,r){return this.whenWithKeys(e,t,L(t),r)},e.prototype.whenWithKeys=function(e,t,r,n){for(var o=this._tracks,i=0;i<r.length;i++){var a=r[i],s=o[a];if(!s){s=o[a]=new Fr(a);var d=void 0,l=this._getAdditiveTrack(a);if(l){var u=l.keyframes,c=u[u.length-1];d=c&&c.value,3===l.valType&&d&&(d=Nr(d))}else d=this._target[a];if(null==d)continue;0<e&&s.addKeyframe(0,Hr(d),n),this._trackKeys.push(a)}s.addKeyframe(e,Hr(t[a]),n)}return this._maxTime=Math.max(this._maxTime,e),this},e.prototype.pause=function(){this._clip.pause(),this._paused=!0},e.prototype.resume=function(){this._clip.resume(),this._paused=!1},e.prototype.isPaused=function(){return!!this._paused},e.prototype.duration=function(e){return this._maxTime=e,this._force=!0,this},e.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var e=this._doneCbs;if(e)for(var t=e.length,r=0;r<t;r++)e[r].call(this)},e.prototype._abortedCallback=function(){this._setTracksFinished();var e=this.animation,t=this._abortedCbs;if(e&&e.removeClip(this._clip),this._clip=null,t)for(var r=0;r<t.length;r++)t[r].call(this)},e.prototype._setTracksFinished=function(){for(var e=this._tracks,t=this._trackKeys,r=0;r<t.length;r++)e[t[r]].setFinished()},e.prototype._getAdditiveTrack=function(e){var t,r=this._additiveAnimators;if(r)for(var n=0;n<r.length;n++){var o=r[n].getTrack(e);o&&(t=o)}return t},e.prototype.start=function(e){if(!(0<this._started)){this._started=1;for(var i=this,a=[],t=this._maxTime||0,r=0;r<this._trackKeys.length;r++){var n=this._trackKeys[r],o=this._tracks[n],s=this._getAdditiveTrack(n),d=o.keyframes,l=d.length;if(o.prepare(t,s),o.needsAnimate())if(!this._allowDiscrete&&o.discrete){var u=d[l-1];u&&(i._target[o.propName]=u.rawValue),o.setFinished()}else a.push(o)}if(a.length||this._force){var c=new Wt({life:t,loop:this._loop,delay:this._delay||0,onframe:function(e){i._started=2;var t=i._additiveAnimators;if(t){for(var r=!1,n=0;n<t.length;n++)if(t[n]._clip){r=!0;break}r||(i._additiveAnimators=null)}for(n=0;n<a.length;n++)a[n].step(i._target,e);var o=i._onframeCbs;if(o)for(n=0;n<o.length;n++)o[n](i._target,e)},ondestroy:function(){i._doneCallback()}});this._clip=c,this.animation&&this.animation.addClip(c),e&&c.setEasing(e)}else this._doneCallback();return this}},e.prototype.stop=function(e){if(this._clip){var t=this._clip;e&&t.onframe(1),this._abortedCallback()}},e.prototype.delay=function(e){return this._delay=e,this},e.prototype.during=function(e){return e&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(e)),this},e.prototype.done=function(e){return e&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(e)),this},e.prototype.aborted=function(e){return e&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(e)),this},e.prototype.getClip=function(){return this._clip},e.prototype.getTrack=function(e){return this._tracks[e]},e.prototype.getTracks=function(){var t=this;return M(this._trackKeys,function(e){return t._tracks[e]})},e.prototype.stopTracks=function(e,t){if(!e.length||!this._clip)return!0;for(var r=this._tracks,n=this._trackKeys,o=0;o<e.length;o++){var i=r[e[o]];i&&!i.isFinished()&&(t?i.step(this._target,1):1===this._started&&i.step(this._target,0),i.setFinished())}var a=!0;for(o=0;o<n.length;o++)if(!r[n[o]].isFinished()){a=!1;break}return a&&this._abortedCallback(),a},e.prototype.saveTo=function(e,t,r){if(e){t=t||this._trackKeys;for(var n=0;n<t.length;n++){var o=t[n],i=this._tracks[o];if(i&&!i.isFinished()){var a=i.keyframes,s=a[r?0:a.length-1];s&&(e[o]=Hr(s.rawValue))}}}},e.prototype.__changeFinalValue=function(e,t){t=t||L(e);for(var r=0;r<t.length;r++){var n=t[r],o=this._tracks[n];if(o){var i=o.keyframes;if(1<i.length){var a=i.pop();o.addKeyframe(a.time,e[n]),o.prepare(this._maxTime,o.getAdditiveTrack())}}}},e}();function Gr(){return(new Date).getTime()}var Wr,zr,Yr=function(r){function e(e){var t=r.call(this)||this;return t._running=!1,t._time=0,t._pausedTime=0,t._pauseStart=0,t._paused=!1,e=e||{},t.stage=e.stage||{},t}return ce(e,r),e.prototype.addClip=function(e){e.animation&&this.removeClip(e),this._head?((this._tail.next=e).prev=this._tail,e.next=null,this._tail=e):this._head=this._tail=e,e.animation=this},e.prototype.addAnimator=function(e){e.animation=this;var t=e.getClip();t&&this.addClip(t)},e.prototype.removeClip=function(e){if(e.animation){var t=e.prev,r=e.next;t?t.next=r:this._head=r,r?r.prev=t:this._tail=t,e.next=e.prev=e.animation=null}},e.prototype.removeAnimator=function(e){var t=e.getClip();t&&this.removeClip(t),e.animation=null},e.prototype.update=function(e){for(var t=Gr()-this._pausedTime,r=t-this._time,n=this._head;n;){var o=n.next;n=(n.step(t,r)&&(n.ondestroy(),this.removeClip(n)),o)}this._time=t,e||(this.trigger("frame",r),this.stage.update&&this.stage.update())},e.prototype._startLoop=function(){var t=this;this._running=!0,_t(function e(){t._running&&(_t(e),!t._paused&&t.update())})},e.prototype.start=function(){this._running||(this._time=Gr(),this._pausedTime=0,this._startLoop())},e.prototype.stop=function(){this._running=!1},e.prototype.pause=function(){this._paused||(this._pauseStart=Gr(),this._paused=!0)},e.prototype.resume=function(){this._paused&&(this._pausedTime+=Gr()-this._pauseStart,this._paused=!1)},e.prototype.clear=function(){for(var e=this._head;e;){var t=e.next;e.prev=e.next=e.animation=null,e=t}this._head=this._tail=null},e.prototype.isFinished=function(){return null==this._head},e.prototype.animate=function(e,t){t=t||{},this.start();var r=new qr(e,t.loop);return this.addAnimator(r),r},e}(Oe),Kr=l.domSupported,Xr=(zr={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},{mouse:Wr=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],touch:["touchstart","touchend","touchmove"],pointer:M(Wr,function(e){var t=e.replace("mouse","pointer");return zr.hasOwnProperty(t)?t:e})}),Jr=["mousemove","mouseup"],Qr=["pointermove","pointerup"],Zr=!1;function $r(e){var t=e.pointerType;return"pen"===t||"touch"===t}function en(e){e&&(e.zrByTouch=!0)}function tn(e,t){for(var r=t,n=!1;r&&9!==r.nodeType&&!(n=r.domBelongToZr||r!==t&&r===e.painterRoot);)r=r.parentNode;return n}var rn=function(e,t){this.stopPropagation=se,this.stopImmediatePropagation=se,this.preventDefault=se,this.type=t.type,this.target=this.currentTarget=e.dom,this.pointerType=t.pointerType,this.clientX=t.clientX,this.clientY=t.clientY},nn={mousedown:function(e){e=ze(this.dom,e),this.__mayPointerCapture=[e.zrX,e.zrY],this.trigger("mousedown",e)},mousemove:function(e){e=ze(this.dom,e);var t=this.__mayPointerCapture;!t||e.zrX===t[0]&&e.zrY===t[1]||this.__togglePointerCapture(!0),this.trigger("mousemove",e)},mouseup:function(e){e=ze(this.dom,e),this.__togglePointerCapture(!1),this.trigger("mouseup",e)},mouseout:function(e){tn(this,(e=ze(this.dom,e)).toElement||e.relatedTarget)||(this.__pointerCapturing&&(e.zrEventControl="no_globalout"),this.trigger("mouseout",e))},wheel:function(e){Zr=!0,e=ze(this.dom,e),this.trigger("mousewheel",e)},mousewheel:function(e){Zr||(e=ze(this.dom,e),this.trigger("mousewheel",e))},touchstart:function(e){en(e=ze(this.dom,e)),this.__lastTouchMoment=new Date,this.handler.processGesture(e,"start"),nn.mousemove.call(this,e),nn.mousedown.call(this,e)},touchmove:function(e){en(e=ze(this.dom,e)),this.handler.processGesture(e,"change"),nn.mousemove.call(this,e)},touchend:function(e){en(e=ze(this.dom,e)),this.handler.processGesture(e,"end"),nn.mouseup.call(this,e),+new Date-+this.__lastTouchMoment<300&&nn.click.call(this,e)},pointerdown:function(e){nn.mousedown.call(this,e)},pointermove:function(e){$r(e)||nn.mousemove.call(this,e)},pointerup:function(e){nn.mouseup.call(this,e)},pointerout:function(e){$r(e)||nn.mouseout.call(this,e)}};U(["click","dblclick","contextmenu"],function(t){nn[t]=function(e){e=ze(this.dom,e),this.trigger(t,e)}});var on={pointermove:function(e){$r(e)||on.mousemove.call(this,e)},pointerup:function(e){on.mouseup.call(this,e)},mousemove:function(e){this.trigger("mousemove",e)},mouseup:function(e){var t=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",e),t&&(e.zrEventControl="only_globalout",this.trigger("mouseout",e))}};function an(n,o){var i=o.domHandlers;l.pointerEventsSupported?U(Xr.pointer,function(t){dn(o,t,function(e){i[t].call(n,e)})}):(l.touchEventsSupported&&U(Xr.touch,function(r){dn(o,r,function(e){var t;i[r].call(n,e),(t=o).touching=!0,null!=t.touchTimer&&(clearTimeout(t.touchTimer),t.touchTimer=null),t.touchTimer=setTimeout(function(){t.touching=!1,t.touchTimer=null},700)})}),U(Xr.mouse,function(t){dn(o,t,function(e){e=We(e),o.touching||i[t].call(n,e)})}))}function sn(o,i){function e(n){dn(i,n,function(e){var t,r;e=We(e),tn(o,e.target)||(r=e,e=ze((t=o).dom,new rn(t,r),!0),i.domHandlers[n].call(o,e))},{capture:!0})}l.pointerEventsSupported?U(Qr,e):l.touchEventsSupported||U(Jr,e)}function dn(e,t,r,n){var o,i,a,s;e.mounted[t]=r,e.listenerOpts[t]=n,o=e.domTarget,i=t,a=r,s=n,o.addEventListener(i,a,s)}function ln(e){var t,r,n,o,i=e.mounted;for(var a in i)i.hasOwnProperty(a)&&(t=e.domTarget,n=i[r=a],o=e.listenerOpts[a],t.removeEventListener(r,n,o));e.mounted={}}var un=function(e,t){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=e,this.domHandlers=t},cn=function(n){function e(e,t){var r=n.call(this)||this;return r.__pointerCapturing=!1,r.dom=e,r.painterRoot=t,r._localHandlerScope=new un(e,nn),Kr&&(r._globalHandlerScope=new un(document,on)),an(r,r._localHandlerScope),r}return ce(e,n),e.prototype.dispose=function(){ln(this._localHandlerScope),Kr&&ln(this._globalHandlerScope)},e.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},e.prototype.__togglePointerCapture=function(e){if(this.__mayPointerCapture=null,Kr&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;var t=this._globalHandlerScope;e?sn(this,t):ln(t)}},e}(Oe),pn=1;l.hasGlobalWindow&&(pn=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var hn=pn,fn="#333",mn="#ccc";function gn(){return[1,0,0,1,0,0]}function vn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function yn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function _n(e,t,r){var n=t[0]*r[0]+t[2]*r[1],o=t[1]*r[0]+t[3]*r[1],i=t[0]*r[2]+t[2]*r[3],a=t[1]*r[2]+t[3]*r[3],s=t[0]*r[4]+t[2]*r[5]+t[4],d=t[1]*r[4]+t[3]*r[5]+t[5];return e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=s,e[5]=d,e}function bn(e,t,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+r[0],e[5]=t[5]+r[1],e}function Sn(e,t,r){var n=t[0],o=t[2],i=t[4],a=t[1],s=t[3],d=t[5],l=Math.sin(r),u=Math.cos(r);return e[0]=n*u+a*l,e[1]=-n*l+a*u,e[2]=o*u+s*l,e[3]=-o*l+u*s,e[4]=u*i+l*d,e[5]=u*d-l*i,e}function wn(e,t,r){var n=r[0],o=r[1];return e[0]=t[0]*n,e[1]=t[1]*o,e[2]=t[2]*n,e[3]=t[3]*o,e[4]=t[4]*n,e[5]=t[5]*o,e}function En(e,t){var r=t[0],n=t[2],o=t[4],i=t[1],a=t[3],s=t[5],d=r*a-i*n;return d?(d=1/d,e[0]=a*d,e[1]=-i*d,e[2]=-n*d,e[3]=r*d,e[4]=(n*s-a*o)*d,e[5]=(i*o-r*s)*d,e):null}var In=Object.freeze({__proto__:null,create:gn,identity:vn,copy:yn,mul:_n,translate:bn,rotate:Sn,scale:wn,invert:En,clone:function(e){var t=[1,0,0,1,0,0];return yn(t,e),t}}),Tn=vn;function Cn(e){return 5e-5<e||e<-5e-5}var Rn=[],Pn=[],kn=[1,0,0,1,0,0],xn=Math.abs,Mn=function(){function t(){}var e;return t.prototype.getLocalTransform=function(e){return t.getLocalTransform(this,e)},t.prototype.setPosition=function(e){this.x=e[0],this.y=e[1]},t.prototype.setScale=function(e){this.scaleX=e[0],this.scaleY=e[1]},t.prototype.setSkew=function(e){this.skewX=e[0],this.skewY=e[1]},t.prototype.setOrigin=function(e){this.originX=e[0],this.originY=e[1]},t.prototype.needLocalTransform=function(){return Cn(this.rotation)||Cn(this.x)||Cn(this.y)||Cn(this.scaleX-1)||Cn(this.scaleY-1)||Cn(this.skewX)||Cn(this.skewY)},t.prototype.updateTransform=function(){var e=this.parent&&this.parent.transform,t=this.needLocalTransform(),r=this.transform;t||e?(r=r||[1,0,0,1,0,0],t?this.getLocalTransform(r):Tn(r),e&&(t?_n(r,e,r):yn(r,e)),this.transform=r,this._resolveGlobalScaleRatio(r)):r&&Tn(r)},t.prototype._resolveGlobalScaleRatio=function(e){var t=this.globalScaleRatio;if(null!=t&&1!==t){this.getGlobalScale(Rn);var r=Rn[0]<0?-1:1,n=Rn[1]<0?-1:1,o=((Rn[0]-r)*t+r)/Rn[0]||0,i=((Rn[1]-n)*t+n)/Rn[1]||0;e[0]*=o,e[1]*=o,e[2]*=i,e[3]*=i}this.invTransform=this.invTransform||[1,0,0,1,0,0],En(this.invTransform,e)},t.prototype.getComputedTransform=function(){for(var e=this,t=[];e;)t.push(e),e=e.parent;for(;e=t.pop();)e.updateTransform();return this.transform},t.prototype.setLocalTransform=function(e){if(e){var t=e[0]*e[0]+e[1]*e[1],r=e[2]*e[2]+e[3]*e[3],n=Math.atan2(e[1],e[0]),o=Math.PI/2+n-Math.atan2(e[3],e[2]);r=Math.sqrt(r)*Math.cos(o),t=Math.sqrt(t),this.skewX=o,this.skewY=0,this.rotation=-n,this.x=+e[4],this.y=+e[5],this.scaleX=t,this.scaleY=r,this.originX=0,this.originY=0}},t.prototype.decomposeTransform=function(){if(this.transform){var e=this.parent,t=this.transform;e&&e.transform&&(_n(Pn,e.invTransform,t),t=Pn);var r=this.originX,n=this.originY;(r||n)&&(kn[4]=r,kn[5]=n,_n(Pn,t,kn),Pn[4]-=r,Pn[5]-=n,t=Pn),this.setLocalTransform(t)}},t.prototype.getGlobalScale=function(e){var t=this.transform;return e=e||[],t?(e[0]=Math.sqrt(t[0]*t[0]+t[1]*t[1]),e[1]=Math.sqrt(t[2]*t[2]+t[3]*t[3]),t[0]<0&&(e[0]=-e[0]),t[3]<0&&(e[1]=-e[1])):(e[0]=1,e[1]=1),e},t.prototype.transformCoordToLocal=function(e,t){var r=[e,t],n=this.invTransform;return n&&Re(r,r,n),r},t.prototype.transformCoordToGlobal=function(e,t){var r=[e,t],n=this.transform;return n&&Re(r,r,n),r},t.prototype.getLineScale=function(){var e=this.transform;return e&&1e-10<xn(e[0]-1)&&1e-10<xn(e[3]-1)?Math.sqrt(xn(e[0]*e[3]-e[2]*e[1])):1},t.prototype.copyTransform=function(e){On(this,e)},t.getLocalTransform=function(e,t){t=t||[];var r=e.originX||0,n=e.originY||0,o=e.scaleX,i=e.scaleY,a=e.anchorX,s=e.anchorY,d=e.rotation||0,l=e.x,u=e.y,c=e.skewX?Math.tan(e.skewX):0,p=e.skewY?Math.tan(-e.skewY):0;if(r||n||a||s){var h=r+a,f=n+s;t[4]=-h*o-c*f*i,t[5]=-f*i-p*h*o}else t[4]=t[5]=0;return t[0]=o,t[3]=i,t[1]=p*o,t[2]=c*i,d&&Sn(t,t,d),t[4]+=r+l,t[5]+=n+u,t},t.initDefaultProps=((e=t.prototype).scaleX=e.scaleY=e.globalScaleRatio=1,void(e.x=e.y=e.originX=e.originY=e.skewX=e.skewY=e.rotation=e.anchorX=e.anchorY=0)),t}(),An=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function On(e,t){for(var r=0;r<An.length;r++){var n=An[r];e[n]=t[n]}}var Un=function(){function e(e,t){this.x=e||0,this.y=t||0}return e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.set=function(e,t){return this.x=e,this.y=t,this},e.prototype.equal=function(e){return e.x===this.x&&e.y===this.y},e.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.scale=function(e){this.x*=e,this.y*=e},e.prototype.scaleAndAdd=function(e,t){this.x+=e.x*t,this.y+=e.y*t},e.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y},e.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){var e=this.len();return this.x/=e,this.y/=e,this},e.prototype.distance=function(e){var t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)},e.prototype.distanceSquare=function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.transform=function(e){if(e){var t=this.x,r=this.y;return this.x=e[0]*t+e[2]*r+e[4],this.y=e[1]*t+e[3]*r+e[5],this}},e.prototype.toArray=function(e){return e[0]=this.x,e[1]=this.y,e},e.prototype.fromArray=function(e){this.x=e[0],this.y=e[1]},e.set=function(e,t,r){e.x=t,e.y=r},e.copy=function(e,t){e.x=t.x,e.y=t.y},e.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.lenSquare=function(e){return e.x*e.x+e.y*e.y},e.dot=function(e,t){return e.x*t.x+e.y*t.y},e.add=function(e,t,r){e.x=t.x+r.x,e.y=t.y+r.y},e.sub=function(e,t,r){e.x=t.x-r.x,e.y=t.y-r.y},e.scale=function(e,t,r){e.x=t.x*r,e.y=t.y*r},e.scaleAndAdd=function(e,t,r,n){e.x=t.x+r.x*n,e.y=t.y+r.y*n},e.lerp=function(e,t,r,n){var o=1-n;e.x=o*t.x+n*r.x,e.y=o*t.y+n*r.y},e}(),Dn=Math.min,Ln=Math.max,Hn=new Un,Nn=new Un,Bn=new Un,jn=new Un,Vn=new Un,Fn=new Un,qn=function(){function _(e,t,r,n){r<0&&(e+=r,r=-r),n<0&&(t+=n,n=-n),this.x=e,this.y=t,this.width=r,this.height=n}return _.prototype.union=function(e){var t=Dn(e.x,this.x),r=Dn(e.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=Ln(e.x+e.width,this.x+this.width)-t:this.width=e.width,isFinite(this.y)&&isFinite(this.height)?this.height=Ln(e.y+e.height,this.y+this.height)-r:this.height=e.height,this.x=t,this.y=r},_.prototype.applyTransform=function(e){_.applyTransform(this,this,e)},_.prototype.calculateTransform=function(e){var t=e.width/this.width,r=e.height/this.height,n=[1,0,0,1,0,0];return bn(n,n,[-this.x,-this.y]),wn(n,n,[t,r]),bn(n,n,[e.x,e.y]),n},_.prototype.intersect=function(e,t){if(!e)return!1;e instanceof _||(e=_.create(e));var r=this.x,n=this.x+this.width,o=this.y,i=this.y+this.height,a=e.x,s=e.x+e.width,d=e.y,l=e.y+e.height,u=!(n<a||s<r||i<d||l<o);if(t){var c=1/0,p=0,h=Math.abs(n-a),f=Math.abs(s-r),m=Math.abs(i-d),g=Math.abs(l-o),v=Math.min(h,f),y=Math.min(m,g);n<a||s<r?p<v&&(p=v,h<f?Un.set(Fn,-h,0):Un.set(Fn,f,0)):v<c&&(c=v,h<f?Un.set(Vn,h,0):Un.set(Vn,-f,0)),i<d||l<o?p<y&&(p=y,m<g?Un.set(Fn,0,-m):Un.set(Fn,0,g)):v<c&&(c=v,m<g?Un.set(Vn,0,m):Un.set(Vn,0,-g))}return t&&Un.copy(t,u?Vn:Fn),u},_.prototype.contain=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},_.prototype.clone=function(){return new _(this.x,this.y,this.width,this.height)},_.prototype.copy=function(e){_.copy(this,e)},_.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},_.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},_.prototype.isZero=function(){return 0===this.width||0===this.height},_.create=function(e){return new _(e.x,e.y,e.width,e.height)},_.copy=function(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},_.applyTransform=function(e,t,r){if(r){if(r[1]<1e-5&&-1e-5<r[1]&&r[2]<1e-5&&-1e-5<r[2]){var n=r[0],o=r[3],i=r[4],a=r[5];return e.x=t.x*n+i,e.y=t.y*o+a,e.width=t.width*n,e.height=t.height*o,e.width<0&&(e.x+=e.width,e.width=-e.width),void(e.height<0&&(e.y+=e.height,e.height=-e.height))}Hn.x=Bn.x=t.x,Hn.y=jn.y=t.y,Nn.x=jn.x=t.x+t.width,Nn.y=Bn.y=t.y+t.height,Hn.transform(r),jn.transform(r),Nn.transform(r),Bn.transform(r),e.x=Dn(Hn.x,Nn.x,Bn.x,jn.x),e.y=Dn(Hn.y,Nn.y,Bn.y,jn.y);var s=Ln(Hn.x,Nn.x,Bn.x,jn.x),d=Ln(Hn.y,Nn.y,Bn.y,jn.y);e.width=s-e.x,e.height=d-e.y}else e!==t&&_.copy(e,t)},_}(),Gn={};function Wn(e,t){var r=Gn[t=t||x];r||(r=Gn[t]=new Kt(500));var n=r.get(e);return null==n&&(n=h.measureText(e,t).width,r.put(e,n)),n}function zn(e,t,r,n){var o=Wn(e,t),i=Xn(t),a=Yn(0,o,r),s=Kn(0,i,n);return new qn(a,s,o,i)}function Yn(e,t,r){return"right"===r?e-=t:"center"===r&&(e-=t/2),e}function Kn(e,t,r){return"middle"===r?e-=t/2:"bottom"===r&&(e-=t),e}function Xn(e){return Wn("国",e)}function Jn(e,t){return"string"==typeof e?0<=e.lastIndexOf("%")?parseFloat(e)/100*t:parseFloat(e):e}var Qn="__zr_normal__",Zn=An.concat(["ignore"]),$n=A(An,function(e,t){return e[t]=!0,e},{ignore:!1}),eo={},to=new qn(0,0,0,0),ro=function(){function r(e){this.id=S(),this.animators=[],this.currentStates=[],this.states={},this._init(e)}return r.prototype._init=function(e){this.attr(e)},r.prototype.drift=function(e,t,r){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=e,n[5]+=t,this.decomposeTransform(),this.markRedraw()},r.prototype.beforeUpdate=function(){},r.prototype.afterUpdate=function(){},r.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},r.prototype.updateInnerText=function(e){var t=this._textContent;if(t&&(!t.ignore||e)){this.textConfig||(this.textConfig={});var r=this.textConfig,n=r.local,o=t.innerTransformable,i=void 0,a=void 0,s=!1;o.parent=n?this:null;var d=!1;if(o.copyTransform(t),null!=r.position){var l=to;r.layoutRect?l.copy(r.layoutRect):l.copy(this.getBoundingRect()),n||l.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(eo,r,l):function(e,t,r){var n=t.position||"inside",o=null!=t.distance?t.distance:5,i=r.height,a=r.width,s=i/2,d=r.x,l=r.y,u="left",c="top";if(n instanceof Array)d+=Jn(n[0],r.width),l+=Jn(n[1],r.height),c=u=null;else switch(n){case"left":d-=o,l+=s,u="right",c="middle";break;case"right":d+=o+a,l+=s,c="middle";break;case"top":d+=a/2,l-=o,u="center",c="bottom";break;case"bottom":d+=a/2,l+=i+o,u="center";break;case"inside":d+=a/2,l+=s,u="center",c="middle";break;case"insideLeft":d+=o,l+=s,c="middle";break;case"insideRight":d+=a-o,l+=s,u="right",c="middle";break;case"insideTop":d+=a/2,l+=o,u="center";break;case"insideBottom":d+=a/2,l+=i-o,u="center",c="bottom";break;case"insideTopLeft":d+=o,l+=o;break;case"insideTopRight":d+=a-o,l+=o,u="right";break;case"insideBottomLeft":d+=o,l+=i-o,c="bottom";break;case"insideBottomRight":d+=a-o,l+=i-o,u="right",c="bottom"}(e=e||{}).x=d,e.y=l,e.align=u,e.verticalAlign=c}(eo,r,l),o.x=eo.x,o.y=eo.y,i=eo.align,a=eo.verticalAlign;var u=r.origin;if(u&&null!=r.rotation){var c=void 0,p=void 0;p="center"===u?(c=.5*l.width,.5*l.height):(c=Jn(u[0],l.width),Jn(u[1],l.height)),d=!0,o.originX=-o.x+c+(n?0:l.x),o.originY=-o.y+p+(n?0:l.y)}}null!=r.rotation&&(o.rotation=r.rotation);var h=r.offset;h&&(o.x+=h[0],o.y+=h[1],d||(o.originX=-h[0],o.originY=-h[1]));var f=null==r.inside?"string"==typeof r.position&&0<=r.position.indexOf("inside"):r.inside,m=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),g=void 0,v=void 0,y=void 0;f&&this.canBeInsideText()?(g=r.insideFill,v=r.insideStroke,null!=g&&"auto"!==g||(g=this.getInsideTextFill()),null!=v&&"auto"!==v||(v=this.getInsideTextStroke(g),y=!0)):(g=r.outsideFill,v=r.outsideStroke,null!=g&&"auto"!==g||(g=this.getOutsideFill()),null!=v&&"auto"!==v||(v=this.getOutsideStroke(g),y=!0)),(g=g||"#000")===m.fill&&v===m.stroke&&y===m.autoStroke&&i===m.align&&a===m.verticalAlign||(s=!0,m.fill=g,m.stroke=v,m.autoStroke=y,m.align=i,m.verticalAlign=a,t.setDefaultTextStyle(m)),t.__dirty|=ht,s&&t.dirtyStyle(!0)}},r.prototype.canBeInsideText=function(){return!0},r.prototype.getInsideTextFill=function(){return"#fff"},r.prototype.getInsideTextStroke=function(e){return"#000"},r.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?mn:fn},r.prototype.getOutsideStroke=function(e){var t=this.__zr&&this.__zr.getBackgroundColor(),r="string"==typeof t&&sr(t);r||(r=[255,255,255,1]);for(var n=r[3],o=this.__zr.isDarkMode(),i=0;i<3;i++)r[i]=r[i]*n+(o?0:255)*(1-n);return r[3]=1,hr(r,"rgba")},r.prototype.traverse=function(e,t){},r.prototype.attrKV=function(e,t){"textConfig"===e?this.setTextConfig(t):"textContent"===e?this.setTextContent(t):"clipPath"===e?this.setClipPath(t):"extra"===e?(this.extra=this.extra||{},O(this.extra,t)):this[e]=t},r.prototype.hide=function(){this.ignore=!0,this.markRedraw()},r.prototype.show=function(){this.ignore=!1,this.markRedraw()},r.prototype.attr=function(e,t){if("string"==typeof e)this.attrKV(e,t);else if(V(e))for(var r=L(e),n=0;n<r.length;n++){var o=r[n];this.attrKV(o,e[o])}return this.markRedraw(),this},r.prototype.saveCurrentToNormalState=function(e){this._innerSaveToNormal(e);for(var t=this._normalState,r=0;r<this.animators.length;r++){var n=this.animators[r],o=n.__fromStateTransition;if(!(n.getLoop()||o&&o!==Qn)){var i=n.targetName,a=i?t[i]:t;n.saveTo(a)}}},r.prototype._innerSaveToNormal=function(e){var t=this._normalState;t||(t=this._normalState={}),e.textConfig&&!t.textConfig&&(t.textConfig=this.textConfig),this._savePrimaryToNormal(e,t,Zn)},r.prototype._savePrimaryToNormal=function(e,t,r){for(var n=0;n<r.length;n++){var o=r[n];null==e[o]||o in t||(t[o]=this[o])}},r.prototype.hasState=function(){return 0<this.currentStates.length},r.prototype.getState=function(e){return this.states[e]},r.prototype.ensureState=function(e){var t=this.states;return t[e]||(t[e]={}),t[e]},r.prototype.clearStates=function(e){this.useState(Qn,!1,e)},r.prototype.useState=function(e,t,r,n){var o=e===Qn;if(this.hasState()||!o){var i=this.currentStates,a=this.stateTransition;if(!(0<=P(i,e))||!t&&1!==i.length){var s;if(this.stateProxy&&!o&&(s=this.stateProxy(e)),s||(s=this.states&&this.states[e]),s||o){o||this.saveCurrentToNormalState(s);var d=!!(s&&s.hoverLayer||n);d&&this._toggleHoverLayerFlag(!0),this._applyStateObj(e,s,this._normalState,t,!r&&!this.__inHover&&a&&0<a.duration,a);var l=this._textContent,u=this._textGuide;return l&&l.useState(e,t,r,d),u&&u.useState(e,t,r,d),o?(this.currentStates=[],this._normalState={}):t?this.currentStates.push(e):this.currentStates=[e],this._updateAnimationTargets(),this.markRedraw(),!d&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~ht),s}w("State "+e+" not exists.")}}},r.prototype.useStates=function(e,t,r){if(e.length){var n=[],o=this.currentStates,i=e.length,a=i===o.length;if(a)for(var s=0;s<i;s++)if(e[s]!==o[s]){a=!1;break}if(a)return;for(s=0;s<i;s++){var d=e[s],l=void 0;this.stateProxy&&(l=this.stateProxy(d,e)),l||(l=this.states[d]),l&&n.push(l)}var u=n[i-1],c=!!(u&&u.hoverLayer||r);c&&this._toggleHoverLayerFlag(!0);var p=this._mergeStates(n),h=this.stateTransition;this.saveCurrentToNormalState(p),this._applyStateObj(e.join(","),p,this._normalState,!1,!t&&!this.__inHover&&h&&0<h.duration,h);var f=this._textContent,m=this._textGuide;f&&f.useStates(e,t,c),m&&m.useStates(e,t,c),this._updateAnimationTargets(),this.currentStates=e.slice(),this.markRedraw(),!c&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~ht)}else this.clearStates()},r.prototype._updateAnimationTargets=function(){for(var e=0;e<this.animators.length;e++){var t=this.animators[e];t.targetName&&t.changeTarget(this[t.targetName])}},r.prototype.removeState=function(e){var t=P(this.currentStates,e);if(0<=t){var r=this.currentStates.slice();r.splice(t,1),this.useStates(r)}},r.prototype.replaceState=function(e,t,r){var n=this.currentStates.slice(),o=P(n,e),i=0<=P(n,t);0<=o?i?n.splice(o,1):n[o]=t:r&&!i&&n.push(t),this.useStates(n)},r.prototype.toggleState=function(e,t){t?this.useState(e,!0):this.removeState(e)},r.prototype._mergeStates=function(e){for(var t,r={},n=0;n<e.length;n++){var o=e[n];O(r,o),o.textConfig&&O(t=t||{},o.textConfig)}return t&&(r.textConfig=t),r},r.prototype._applyStateObj=function(e,t,r,n,o,i){var a=!(t&&n);t&&t.textConfig?(this.textConfig=O({},n?this.textConfig:r.textConfig),O(this.textConfig,t.textConfig)):a&&r.textConfig&&(this.textConfig=r.textConfig);for(var s={},d=!1,l=0;l<Zn.length;l++){var u=Zn[l],c=o&&$n[u];t&&null!=t[u]?c?(d=!0,s[u]=t[u]):this[u]=t[u]:a&&null!=r[u]&&(c?(d=!0,s[u]=r[u]):this[u]=r[u])}if(!o)for(l=0;l<this.animators.length;l++){var p=this.animators[l],h=p.targetName;p.getLoop()||p.__changeFinalValue(h?(t||r)[h]:t||r)}d&&this._transitionState(e,s,i)},r.prototype._attachComponent=function(e){if(e.__zr&&!e.__hostTarget)throw new Error("Text element has been added to zrender.");if(e===this)throw new Error("Recursive component attachment.");var t=this.__zr;t&&e.addSelfToZr(t),e.__zr=t,e.__hostTarget=this},r.prototype._detachComponent=function(e){e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__hostTarget=null},r.prototype.getClipPath=function(){return this._clipPath},r.prototype.setClipPath=function(e){this._clipPath&&this._clipPath!==e&&this.removeClipPath(),this._attachComponent(e),this._clipPath=e,this.markRedraw()},r.prototype.removeClipPath=function(){var e=this._clipPath;e&&(this._detachComponent(e),this._clipPath=null,this.markRedraw())},r.prototype.getTextContent=function(){return this._textContent},r.prototype.setTextContent=function(e){var t=this._textContent;if(t!==e){if(t&&t!==e&&this.removeTextContent(),e.__zr&&!e.__hostTarget)throw new Error("Text element has been added to zrender.");e.innerTransformable=new Mn,this._attachComponent(e),this._textContent=e,this.markRedraw()}},r.prototype.setTextConfig=function(e){this.textConfig||(this.textConfig={}),O(this.textConfig,e),this.markRedraw()},r.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},r.prototype.removeTextContent=function(){var e=this._textContent;e&&(e.innerTransformable=null,this._detachComponent(e),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},r.prototype.getTextGuideLine=function(){return this._textGuide},r.prototype.setTextGuideLine=function(e){this._textGuide&&this._textGuide!==e&&this.removeTextGuideLine(),this._attachComponent(e),this._textGuide=e,this.markRedraw()},r.prototype.removeTextGuideLine=function(){var e=this._textGuide;e&&(this._detachComponent(e),this._textGuide=null,this.markRedraw())},r.prototype.markRedraw=function(){this.__dirty|=ht;var e=this.__zr;e&&(this.__inHover?e.refreshHover():e.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},r.prototype.dirty=function(){this.markRedraw()},r.prototype._toggleHoverLayerFlag=function(e){this.__inHover=e;var t=this._textContent,r=this._textGuide;t&&(t.__inHover=e),r&&(r.__inHover=e)},r.prototype.addSelfToZr=function(e){if(this.__zr!==e){this.__zr=e;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.addAnimator(t[r]);this._clipPath&&this._clipPath.addSelfToZr(e),this._textContent&&this._textContent.addSelfToZr(e),this._textGuide&&this._textGuide.addSelfToZr(e)}},r.prototype.removeSelfFromZr=function(e){if(this.__zr){this.__zr=null;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.removeAnimator(t[r]);this._clipPath&&this._clipPath.removeSelfFromZr(e),this._textContent&&this._textContent.removeSelfFromZr(e),this._textGuide&&this._textGuide.removeSelfFromZr(e)}},r.prototype.animate=function(e,t,r){var n=e?this[e]:this;if(n){var o=new qr(n,t,r);return e&&(o.targetName=e),this.addAnimator(o,e),o}w('Property "'+e+'" is not existed in element '+this.id)},r.prototype.addAnimator=function(r,e){var t=this.__zr,n=this;r.during(function(){n.updateDuringAnimation(e)}).done(function(){var e=n.animators,t=P(e,r);0<=t&&e.splice(t,1)}),this.animators.push(r),t&&t.animation.addAnimator(r),t&&t.wakeUp()},r.prototype.updateDuringAnimation=function(e){this.markRedraw()},r.prototype.stopAnimation=function(e,t){for(var r=this.animators,n=r.length,o=[],i=0;i<n;i++){var a=r[i];e&&e!==a.scope?o.push(a):a.stop(t)}return this.animators=o,this},r.prototype.animateTo=function(e,t,r){no(this,e,t,r)},r.prototype.animateFrom=function(e,t,r){no(this,e,t,r,!0)},r.prototype._transitionState=function(e,t,r,n){for(var o=no(this,t,r,n),i=0;i<o.length;i++)o[i].__fromStateTransition=e},r.prototype.getBoundingRect=function(){return null},r.prototype.getPaintRect=function(){return null},r.initDefaultProps=function(){var e=r.prototype;e.type="element",e.name="",e.ignore=e.silent=e.isGroup=e.draggable=e.dragging=e.ignoreClip=e.__inHover=!1,e.__dirty=ht;var n={};function a(e,t,r){n[e+t+r]||(console.warn("DEPRECATED: '"+e+"' has been deprecated. use '"+t+"', '"+r+"' instead"),n[e+t+r]=!0)}function t(t,r,n,o){function i(t,e){Object.defineProperty(e,0,{get:function(){return t[n]},set:function(e){t[n]=e}}),Object.defineProperty(e,1,{get:function(){return t[o]},set:function(e){t[o]=e}})}Object.defineProperty(e,t,{get:function(){if(a(t,n,o),!this[r]){var e=this[r]=[];i(this,e)}return this[r]},set:function(e){a(t,n,o),this[n]=e[0],this[o]=e[1],this[r]=e,i(this,e)}})}Object.defineProperty&&(t("position","_legacyPos","x","y"),t("scale","_legacyScale","scaleX","scaleY"),t("origin","_legacyOrigin","originX","originY"))}(),r}();function no(e,t,r,n,o){var i=[];!function e(t,r,n,o,i,a,s,d){var l=L(o);var u=i.duration;var c=i.delay;var p=i.additive;var h=i.setToFinal;var f=!V(a);var m=t.animators;var g=[];for(var v=0;v<l.length;v++){var y=l[v],_=o[y];if(null!=_&&null!=n[y]&&(f||a[y]))if(!V(_)||k(_)||W(_))g.push(y);else{if(r){d||(n[y]=_,t.updateDuringAnimation(r));continue}e(t,y,n[y],_,i,a&&a[y],s,d)}else d||(n[y]=_,t.updateDuringAnimation(r),g.push(y))}var b=g.length;if(!p&&b)for(var S=0;S<m.length;S++){var w=m[S];if(w.targetName===r){var E=w.stopTracks(g);if(E){var I=P(m,w);m.splice(I,1)}}}i.force||(g=D(g,function(e){return t=o[e],r=n[e],!(t===r||k(t)&&k(r)&&function(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}(t,r));var t,r}),b=g.length);if(0<b||i.force&&!s.length){var T=void 0,C=void 0,R=void 0;if(d){C={},h&&(T={});for(var S=0;S<b;S++){var y=g[S];C[y]=n[y],h?T[y]=o[y]:n[y]=o[y]}}else if(h){R={};for(var S=0;S<b;S++){var y=g[S];R[y]=Hr(n[y]),io(n,o,y)}}var w=new qr(n,!1,!1,p?D(m,function(e){return e.targetName===r}):null);w.targetName=r,i.scope&&(w.scope=i.scope),h&&T&&w.whenWithKeys(0,T,g),R&&w.whenWithKeys(0,R,g),w.whenWithKeys(null==u?500:u,d?C:o,g).delay(c||0),t.addAnimator(w,r),s.push(w)}}(e,"",e,t,r=r||{},n,i,o);var a=i.length,s=!1,d=r.done,l=r.aborted,u=function(){s=!0,--a<=0&&(s?d&&d():l&&l())},c=function(){--a<=0&&(s?d&&d():l&&l())};a||d&&d(),0<i.length&&r.during&&i[0].during(function(e,t){r.during(t)});for(var p=0;p<i.length;p++){var h=i[p];h.done(u),h.aborted(c),r.force&&h.duration(r.duration),h.start(r.easing)}return i}function oo(e,t,r){for(var n=0;n<r;n++)e[n]=t[n]}function io(e,t,r){if(k(t[r]))if(k(e[r])||(e[r]=[]),q(t[r])){var n=t[r].length;e[r].length!==n&&(e[r]=new t[r].constructor(n),oo(e[r],t[r],n))}else{var o=t[r],i=e[r],a=o.length;if(k(o[0]))for(var s=o[0].length,d=0;d<a;d++)i[d]?oo(i[d],o[d],s):i[d]=Array.prototype.slice.call(o[d]);else oo(i,o,a);i.length=o.length}else e[r]=t[r]}R(ro,Oe),R(ro,Mn);var ao=function(r){function e(e){var t=r.call(this)||this;return t.isGroup=!0,t._children=[],t.attr(e),t}return ce(e,r),e.prototype.childrenRef=function(){return this._children},e.prototype.children=function(){return this._children.slice()},e.prototype.childAt=function(e){return this._children[e]},e.prototype.childOfName=function(e){for(var t=this._children,r=0;r<t.length;r++)if(t[r].name===e)return t[r]},e.prototype.childCount=function(){return this._children.length},e.prototype.add=function(e){if(e&&(e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),e.__hostTarget))throw"This elemenet has been used as an attachment";return this},e.prototype.addBefore=function(e,t){if(e&&e!==this&&e.parent!==this&&t&&t.parent===this){var r=this._children,n=r.indexOf(t);0<=n&&(r.splice(n,0,e),this._doAdd(e))}return this},e.prototype.replace=function(e,t){var r=P(this._children,e);return 0<=r&&this.replaceAt(t,r),this},e.prototype.replaceAt=function(e,t){var r=this._children,n=r[t];if(e&&e!==this&&e.parent!==this&&e!==n){r[t]=e,n.parent=null;var o=this.__zr;o&&n.removeSelfFromZr(o),this._doAdd(e)}return this},e.prototype._doAdd=function(e){e.parent&&e.parent.remove(e);var t=(e.parent=this).__zr;t&&t!==e.__zr&&e.addSelfToZr(t),t&&t.refresh()},e.prototype.remove=function(e){var t=this.__zr,r=this._children,n=P(r,e);return n<0||(r.splice(n,1),e.parent=null,t&&e.removeSelfFromZr(t),t&&t.refresh()),this},e.prototype.removeAll=function(){for(var e=this._children,t=this.__zr,r=0;r<e.length;r++){var n=e[r];t&&n.removeSelfFromZr(t),n.parent=null}return e.length=0,this},e.prototype.eachChild=function(e,t){for(var r=this._children,n=0;n<r.length;n++){var o=r[n];e.call(t,o,n)}return this},e.prototype.traverse=function(e,t){for(var r=0;r<this._children.length;r++){var n=this._children[r],o=e.call(t,n);n.isGroup&&!o&&n.traverse(e,t)}return this},e.prototype.addSelfToZr=function(e){r.prototype.addSelfToZr.call(this,e);for(var t=0;t<this._children.length;t++){this._children[t].addSelfToZr(e)}},e.prototype.removeSelfFromZr=function(e){r.prototype.removeSelfFromZr.call(this,e);for(var t=0;t<this._children.length;t++){this._children[t].removeSelfFromZr(e)}},e.prototype.getBoundingRect=function(e){for(var t=new qn(0,0,0,0),r=e||this._children,n=[],o=null,i=0;i<r.length;i++){var a=r[i];if(!a.ignore&&!a.invisible){var s=a.getBoundingRect(),d=a.getLocalTransform(n);d?(qn.applyTransform(t,s,d),(o=o||t.clone()).union(t)):(o=o||s.clone()).union(s)}}return o||t},e}(ro);ao.prototype.type="group";var so={},lo={};var uo=function(){function e(e,t,r){var n=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,r=r||{},this.dom=t,this.id=e;var o=new yt,i=r.renderer||"canvas";if(so[i]||(i=L(so)[0]),!so[i])throw new Error("Renderer '"+i+"' is not imported. Please import it first.");r.useDirtyRect=null!=r.useDirtyRect&&r.useDirtyRect;var a=new so[i](t,o,r,e),s=r.ssr||a.ssrOnly;this.storage=o,this.painter=a;var d=l.node||l.worker||s?null:new cn(a.getViewportRoot(),a.root);this.handler=new rt(o,a,d,a.root),this.animation=new Yr({stage:{update:s?null:function(){return n._flush(!0)}}}),s||this.animation.start()}return e.prototype.add=function(e){e&&(this.storage.addRoot(e),e.addSelfToZr(this),this.refresh())},e.prototype.remove=function(e){e&&(this.storage.delRoot(e),e.removeSelfFromZr(this),this.refresh())},e.prototype.configLayer=function(e,t){this.painter.configLayer&&this.painter.configLayer(e,t),this.refresh()},e.prototype.setBackgroundColor=function(e){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(e),this.refresh(),this._backgroundColor=e,this._darkMode=function(e){if(!e)return!1;if("string"==typeof e)return fr(e,1)<.4;if(e.colorStops){for(var t=e.colorStops,r=0,n=t.length,o=0;o<n;o++)r+=fr(t[o].color,1);return(r/=n)<.4}return!1}(e)},e.prototype.getBackgroundColor=function(){return this._backgroundColor},e.prototype.setDarkMode=function(e){this._darkMode=e},e.prototype.isDarkMode=function(){return this._darkMode},e.prototype.refreshImmediately=function(e){e||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},e.prototype.refresh=function(){this._needsRefresh=!0,this.animation.start()},e.prototype.flush=function(){this._flush(!1)},e.prototype._flush=function(e){var t,r=Gr();this._needsRefresh&&(t=!0,this.refreshImmediately(e)),this._needsRefreshHover&&(t=!0,this.refreshHoverImmediately());var n=Gr();t?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:n-r})):0<this._sleepAfterStill&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},e.prototype.setSleepAfterStill=function(e){this._sleepAfterStill=e},e.prototype.wakeUp=function(){this.animation.start(),this._stillFrameAccum=0},e.prototype.refreshHover=function(){this._needsRefreshHover=!0},e.prototype.refreshHoverImmediately=function(){this._needsRefreshHover=!1,this.painter.refreshHover&&"canvas"===this.painter.getType()&&this.painter.refreshHover()},e.prototype.resize=function(e){e=e||{},this.painter.resize(e.width,e.height),this.handler.resize()},e.prototype.clearAnimation=function(){this.animation.clear()},e.prototype.getWidth=function(){return this.painter.getWidth()},e.prototype.getHeight=function(){return this.painter.getHeight()},e.prototype.setCursorStyle=function(e){this.handler.setCursorStyle(e)},e.prototype.findHover=function(e,t){return this.handler.findHover(e,t)},e.prototype.on=function(e,t,r){return this.handler.on(e,t,r),this},e.prototype.off=function(e,t){this.handler.off(e,t)},e.prototype.trigger=function(e,t){this.handler.trigger(e,t)},e.prototype.clear=function(){for(var e=this.storage.getRoots(),t=0;t<e.length;t++)e[t]instanceof ao&&e[t].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()},e.prototype.dispose=function(){var e;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,e=this.id,delete lo[e]},e}();function co(e,t){so[e]=t}var po="__zr_style_"+Math.round(10*Math.random()),ho={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},fo={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};ho[po]=!0;var mo=["z","z2","invisible"],go=["invisible"],vo=function(f){function e(e){return f.call(this,e)||this}var t;return ce(e,f),e.prototype._init=function(e){for(var t=L(e),r=0;r<t.length;r++){var n=t[r];"style"===n?this.useStyle(e[n]):f.prototype.attrKV.call(this,n,e[n])}this.style||this.useStyle({})},e.prototype.beforeBrush=function(){},e.prototype.afterBrush=function(){},e.prototype.innerBeforeBrush=function(){},e.prototype.innerAfterBrush=function(){},e.prototype.shouldBePainted=function(e,t,r,n){var o=this.transform;if(this.ignore||this.invisible||0===this.style.opacity||this.culling&&function(e,t,r){yo.copy(e.getBoundingRect()),e.transform&&yo.applyTransform(e.transform);return _o.width=t,_o.height=r,!yo.intersect(_o)}(this,e,t)||o&&!o[0]&&!o[3])return!1;if(r&&this.__clipPaths)for(var i=0;i<this.__clipPaths.length;++i)if(this.__clipPaths[i].isZeroArea())return!1;if(n&&this.parent)for(var a=this.parent;a;){if(a.ignore)return!1;a=a.parent}return!0},e.prototype.contain=function(e,t){return this.rectContain(e,t)},e.prototype.traverse=function(e,t){e.call(t,this)},e.prototype.rectContain=function(e,t){var r=this.transformCoordToLocal(e,t);return this.getBoundingRect().contain(r[0],r[1])},e.prototype.getPaintRect=function(){var e=this._paintRect;if(!this._paintRect||this.__dirty){var t=this.transform,r=this.getBoundingRect(),n=this.style,o=n.shadowBlur||0,i=n.shadowOffsetX||0,a=n.shadowOffsetY||0;e=this._paintRect||(this._paintRect=new qn(0,0,0,0)),t?qn.applyTransform(e,r,t):e.copy(r),(o||i||a)&&(e.width+=2*o+Math.abs(i),e.height+=2*o+Math.abs(a),e.x=Math.min(e.x,e.x+i-o),e.y=Math.min(e.y,e.y+a-o));var s=this.dirtyRectTolerance;e.isZero()||(e.x=Math.floor(e.x-s),e.y=Math.floor(e.y-s),e.width=Math.ceil(e.width+1+2*s),e.height=Math.ceil(e.height+1+2*s))}return e},e.prototype.setPrevPaintRect=function(e){e?(this._prevPaintRect=this._prevPaintRect||new qn(0,0,0,0),this._prevPaintRect.copy(e)):this._prevPaintRect=null},e.prototype.getPrevPaintRect=function(){return this._prevPaintRect},e.prototype.animateStyle=function(e){return this.animate("style",e)},e.prototype.updateDuringAnimation=function(e){"style"===e?this.dirtyStyle():this.markRedraw()},e.prototype.attrKV=function(e,t){"style"!==e?f.prototype.attrKV.call(this,e,t):this.style?this.setStyle(t):this.useStyle(t)},e.prototype.setStyle=function(e,t){return"string"==typeof e?this.style[e]=t:O(this.style,e),this.dirtyStyle(),this},e.prototype.dirtyStyle=function(e){e||this.markRedraw(),this.__dirty|=2,this._rect&&(this._rect=null)},e.prototype.dirty=function(){this.dirtyStyle()},e.prototype.styleChanged=function(){return!!(2&this.__dirty)},e.prototype.styleUpdated=function(){this.__dirty&=-3},e.prototype.createStyle=function(e){return oe(ho,e)},e.prototype.useStyle=function(e){e[po]||(e=this.createStyle(e)),this.__inHover?this.__hoverStyle=e:this.style=e,this.dirtyStyle()},e.prototype.isStyleObject=function(e){return e[po]},e.prototype._innerSaveToNormal=function(e){f.prototype._innerSaveToNormal.call(this,e);var t=this._normalState;e.style&&!t.style&&(t.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,t,mo)},e.prototype._applyStateObj=function(e,t,r,n,o,i){f.prototype._applyStateObj.call(this,e,t,r,n,o,i);var a,s=!(t&&n);if(t&&t.style?o?n?a=t.style:(a=this._mergeStyle(this.createStyle(),r.style),this._mergeStyle(a,t.style)):(a=this._mergeStyle(this.createStyle(),n?this.style:r.style),this._mergeStyle(a,t.style)):s&&(a=r.style),a)if(o){var d=this.style;if(this.style=this.createStyle(s?{}:d),s)for(var l=L(d),u=0;u<l.length;u++){(p=l[u])in a&&(a[p]=a[p],this.style[p]=d[p])}var c=L(a);for(u=0;u<c.length;u++){var p=c[u];this.style[p]=this.style[p]}this._transitionState(e,{style:a},i,this.getAnimationStyleProps())}else this.useStyle(a);var h=this.__inHover?go:mo;for(u=0;u<h.length;u++){p=h[u];t&&null!=t[p]?this[p]=t[p]:s&&null!=r[p]&&(this[p]=r[p])}},e.prototype._mergeStates=function(e){for(var t,r=f.prototype._mergeStates.call(this,e),n=0;n<e.length;n++){var o=e[n];o.style&&(t=t||{},this._mergeStyle(t,o.style))}return t&&(r.style=t),r},e.prototype._mergeStyle=function(e,t){return O(e,t),e},e.prototype.getAnimationStyleProps=function(){return fo},e.initDefaultProps=((t=e.prototype).type="displayable",t.invisible=!1,t.z=0,t.z2=0,t.zlevel=0,t.culling=!1,t.cursor="pointer",t.rectHover=!1,t.incremental=!1,t._rect=null,t.dirtyRectTolerance=0,void(t.__dirty=2|ht)),e}(ro),yo=new qn(0,0,0,0),_o=new qn(0,0,0,0);var bo=Math.min,So=Math.max,wo=Math.sin,Eo=Math.cos,Io=2*Math.PI,To=pe(),Co=pe(),Ro=pe();function Po(e,t,r){if(0!==e.length){for(var n=e[0],o=n[0],i=n[0],a=n[1],s=n[1],d=1;d<e.length;d++)n=e[d],o=bo(o,n[0]),i=So(i,n[0]),a=bo(a,n[1]),s=So(s,n[1]);t[0]=o,t[1]=a,r[0]=i,r[1]=s}}function ko(e,t,r,n,o,i){o[0]=bo(e,r),o[1]=bo(t,n),i[0]=So(e,r),i[1]=So(t,n)}var xo=[],Mo=[];function Ao(e,t,r,n,o,i,a,s,d,l){var u=Dt,c=At,p=u(e,r,o,a,xo);d[0]=1/0,d[1]=1/0,l[0]=-1/0,l[1]=-1/0;for(var h=0;h<p;h++){var f=c(e,r,o,a,xo[h]);d[0]=bo(f,d[0]),l[0]=So(f,l[0])}p=u(t,n,i,s,Mo);for(h=0;h<p;h++){var m=c(t,n,i,s,Mo[h]);d[1]=bo(m,d[1]),l[1]=So(m,l[1])}d[0]=bo(e,d[0]),l[0]=So(e,l[0]),d[0]=bo(a,d[0]),l[0]=So(a,l[0]),d[1]=bo(t,d[1]),l[1]=So(t,l[1]),d[1]=bo(s,d[1]),l[1]=So(s,l[1])}function Oo(e,t,r,n,o,i,a,s,d){var l=Pe,u=ke,c=Math.abs(o-i);if(c%Io<1e-4&&1e-4<c)return s[0]=e-r,s[1]=t-n,d[0]=e+r,void(d[1]=t+n);if(To[0]=Eo(o)*r+e,To[1]=wo(o)*n+t,Co[0]=Eo(i)*r+e,Co[1]=wo(i)*n+t,l(s,To,Co),u(d,To,Co),(o%=Io)<0&&(o+=Io),(i%=Io)<0&&(i+=Io),i<o&&!a?i+=Io:o<i&&a&&(o+=Io),a){var p=i;i=o,o=p}for(var h=0;h<i;h+=Math.PI/2)o<h&&(Ro[0]=Eo(h)*r+e,Ro[1]=wo(h)*n+t,l(s,Ro,s),u(d,Ro,d))}var Uo={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},Do=[],Lo=[],Ho=[],No=[],Bo=[],jo=[],Vo=Math.min,Fo=Math.max,qo=Math.cos,Go=Math.sin,Wo=Math.abs,zo=Math.PI,Yo=2*zo,Ko="undefined"!=typeof Float32Array,Xo=[];function Jo(e){return Math.round(e/zo*1e8)/1e8%2*zo}var Qo=function(){function r(e){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,e&&(this._saveData=!1),this._saveData&&(this.data=[])}var e;return r.prototype.increaseVersion=function(){this._version++},r.prototype.getVersion=function(){return this._version},r.prototype.setScale=function(e,t,r){0<(r=r||0)&&(this._ux=Wo(r/hn/e)||0,this._uy=Wo(r/hn/t)||0)},r.prototype.setDPR=function(e){this.dpr=e},r.prototype.setContext=function(e){this._ctx=e},r.prototype.getContext=function(){return this._ctx},r.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},r.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},r.prototype.moveTo=function(e,t){return this._drawPendingPt(),this.addData(Uo.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},r.prototype.lineTo=function(e,t){var r=Wo(e-this._xi),n=Wo(t-this._yi),o=r>this._ux||n>this._uy;if(this.addData(Uo.L,e,t),this._ctx&&o&&this._ctx.lineTo(e,t),o)this._xi=e,this._yi=t,this._pendingPtDist=0;else{var i=r*r+n*n;i>this._pendingPtDist&&(this._pendingPtX=e,this._pendingPtY=t,this._pendingPtDist=i)}return this},r.prototype.bezierCurveTo=function(e,t,r,n,o,i){return this._drawPendingPt(),this.addData(Uo.C,e,t,r,n,o,i),this._ctx&&this._ctx.bezierCurveTo(e,t,r,n,o,i),this._xi=o,this._yi=i,this},r.prototype.quadraticCurveTo=function(e,t,r,n){return this._drawPendingPt(),this.addData(Uo.Q,e,t,r,n),this._ctx&&this._ctx.quadraticCurveTo(e,t,r,n),this._xi=r,this._yi=n,this},r.prototype.arc=function(e,t,r,n,o,i){this._drawPendingPt(),Xo[0]=n,Xo[1]=o,function(e,t){var r=Jo(e[0]);r<0&&(r+=Yo);var n=r-e[0],o=e[1];o+=n,!t&&Yo<=o-r?o=r+Yo:t&&Yo<=r-o?o=r-Yo:!t&&o<r?o=r+(Yo-Jo(r-o)):t&&r<o&&(o=r-(Yo-Jo(o-r))),e[0]=r,e[1]=o}(Xo,i),n=Xo[0];var a=(o=Xo[1])-n;return this.addData(Uo.A,e,t,r,r,n,a,0,i?0:1),this._ctx&&this._ctx.arc(e,t,r,n,o,i),this._xi=qo(o)*r+e,this._yi=Go(o)*r+t,this},r.prototype.arcTo=function(e,t,r,n,o){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(e,t,r,n,o),this},r.prototype.rect=function(e,t,r,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(e,t,r,n),this.addData(Uo.R,e,t,r,n),this},r.prototype.closePath=function(){this._drawPendingPt(),this.addData(Uo.Z);var e=this._ctx,t=this._x0,r=this._y0;return e&&e.closePath(),this._xi=t,this._yi=r,this},r.prototype.fill=function(e){e&&e.fill(),this.toStatic()},r.prototype.stroke=function(e){e&&e.stroke(),this.toStatic()},r.prototype.len=function(){return this._len},r.prototype.setData=function(e){var t=e.length;this.data&&this.data.length===t||!Ko||(this.data=new Float32Array(t));for(var r=0;r<t;r++)this.data[r]=e[r];this._len=t},r.prototype.appendPath=function(e){e instanceof Array||(e=[e]);for(var t=e.length,r=0,n=this._len,o=0;o<t;o++)r+=e[o].len();Ko&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+r));for(o=0;o<t;o++)for(var i=e[o].data,a=0;a<i.length;a++)this.data[n++]=i[a];this._len=n},r.prototype.addData=function(e,t,r,n,o,i,a,s,d){if(this._saveData){var l=this.data;this._len+arguments.length>l.length&&(this._expandData(),l=this.data);for(var u=0;u<arguments.length;u++)l[this._len++]=arguments[u]}},r.prototype._drawPendingPt=function(){0<this._pendingPtDist&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},r.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},r.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var e=this.data;e instanceof Array&&(e.length=this._len,Ko&&11<this._len&&(this.data=new Float32Array(e)))}},r.prototype.getBoundingRect=function(){Ho[0]=Ho[1]=Bo[0]=Bo[1]=Number.MAX_VALUE,No[0]=No[1]=jo[0]=jo[1]=-Number.MAX_VALUE;var e,t,r,n,o,i,a,s,d,l,u,c,p,h,f,m=this.data,g=0,v=0,y=0,_=0;for(e=0;e<this._len;){var b=m[e++],S=1===e;switch(S&&(y=g=m[e],_=v=m[e+1]),b){case Uo.M:g=y=m[e++],v=_=m[e++],Bo[0]=y,Bo[1]=_,jo[0]=y,jo[1]=_;break;case Uo.L:ko(g,v,m[e],m[e+1],Bo,jo),g=m[e++],v=m[e++];break;case Uo.C:Ao(g,v,m[e++],m[e++],m[e++],m[e++],m[e],m[e+1],Bo,jo),g=m[e++],v=m[e++];break;case Uo.Q:t=g,r=v,n=m[e++],o=m[e++],i=m[e],a=m[e+1],s=Bo,d=jo,u=l=void 0,u=Nt,c=So(bo((l=jt)(t,n,i),1),0),p=So(bo(l(r,o,a),1),0),h=u(t,n,i,c),f=u(r,o,a,p),s[0]=bo(t,i,h),s[1]=bo(r,a,f),d[0]=So(t,i,h),d[1]=So(r,a,f),g=m[e++],v=m[e++];break;case Uo.A:var w=m[e++],E=m[e++],I=m[e++],T=m[e++],C=m[e++],R=m[e++]+C;e+=1;var P=!m[e++];S&&(y=qo(C)*I+w,_=Go(C)*T+E),Oo(w,E,I,T,C,R,P,Bo,jo),g=qo(R)*I+w,v=Go(R)*T+E;break;case Uo.R:ko(y=g=m[e++],_=v=m[e++],y+m[e++],_+m[e++],Bo,jo);break;case Uo.Z:g=y,v=_}Pe(Ho,Ho,Bo),ke(No,No,jo)}return 0===e&&(Ho[0]=Ho[1]=No[0]=No[1]=0),new qn(Ho[0],Ho[1],No[0]-Ho[0],No[1]-Ho[1])},r.prototype._calculateLength=function(){var e=this.data,t=this._len,r=this._ux,n=this._uy,o=0,i=0,a=0,s=0;this._pathSegLen||(this._pathSegLen=[]);for(var d=this._pathSegLen,l=0,u=0,c=0;c<t;){var p=e[c++],h=1===c;h&&(a=o=e[c],s=i=e[c+1]);var f=-1;switch(p){case Uo.M:o=a=e[c++],i=s=e[c++];break;case Uo.L:var m=e[c++],g=(_=e[c++])-i;(Wo(k=m-o)>r||Wo(g)>n||c===t-1)&&(f=Math.sqrt(k*k+g*g),o=m,i=_);break;case Uo.C:var v=e[c++],y=e[c++],_=(m=e[c++],e[c++]),b=e[c++],S=e[c++];f=Ht(o,i,v,y,m,_,b,S,10),o=b,i=S;break;case Uo.Q:f=Ft(o,i,v=e[c++],y=e[c++],m=e[c++],_=e[c++],10),o=m,i=_;break;case Uo.A:var w=e[c++],E=e[c++],I=e[c++],T=e[c++],C=e[c++],R=e[c++],P=R+C;c+=1;e[c++];h&&(a=qo(C)*I+w,s=Go(C)*T+E),f=Fo(I,T)*Vo(Yo,Math.abs(R)),o=qo(P)*I+w,i=Go(P)*T+E;break;case Uo.R:a=o=e[c++],s=i=e[c++],f=2*e[c++]+2*e[c++];break;case Uo.Z:var k=a-o;g=s-i;f=Math.sqrt(k*k+g*g),o=a,i=s}0<=f&&(l+=d[u++]=f)}return this._pathLen=l},r.prototype.rebuildPath=function(e,t){var r,n,o,i,a,s,d,l,u,c,p=this.data,h=this._ux,f=this._uy,m=this._len,g=t<1,v=0,y=0,_=0;if(!g||(this._pathSegLen||this._calculateLength(),d=this._pathSegLen,l=t*this._pathLen))e:for(var b=0;b<m;){var S=p[b++],w=1===b;switch(w&&(r=o=p[b],n=i=p[b+1]),S!==Uo.L&&0<_&&(e.lineTo(u,c),_=0),S){case Uo.M:r=o=p[b++],n=i=p[b++],e.moveTo(o,i);break;case Uo.L:a=p[b++],s=p[b++];var E=Wo(a-o),I=Wo(s-i);if(h<E||f<I){if(g){if(l<v+(K=d[y++])){var T=(l-v)/K;e.lineTo(o*(1-T)+a*T,i*(1-T)+s*T);break e}v+=K}e.lineTo(a,s),o=a,i=s,_=0}else{var C=E*E+I*I;_<C&&(u=a,c=s,_=C)}break;case Uo.C:var R=p[b++],P=p[b++],k=p[b++],x=p[b++],M=p[b++],A=p[b++];if(g){if(l<v+(K=d[y++])){Lt(o,R,k,M,T=(l-v)/K,Do),Lt(i,P,x,A,T,Lo),e.bezierCurveTo(Do[1],Lo[1],Do[2],Lo[2],Do[3],Lo[3]);break e}v+=K}e.bezierCurveTo(R,P,k,x,M,A),o=M,i=A;break;case Uo.Q:R=p[b++],P=p[b++],k=p[b++],x=p[b++];if(g){if(l<v+(K=d[y++])){Vt(o,R,k,T=(l-v)/K,Do),Vt(i,P,x,T,Lo),e.quadraticCurveTo(Do[1],Lo[1],Do[2],Lo[2]);break e}v+=K}e.quadraticCurveTo(R,P,k,x),o=k,i=x;break;case Uo.A:var O=p[b++],U=p[b++],D=p[b++],L=p[b++],H=p[b++],N=p[b++],B=p[b++],j=!p[b++],V=L<D?D:L,F=.001<Wo(D-L),q=H+N,G=!1;if(g)l<v+(K=d[y++])&&(q=H+N*(l-v)/K,G=!0),v+=K;if(F&&e.ellipse?e.ellipse(O,U,D,L,B,H,q,j):e.arc(O,U,V,H,q,j),G)break e;w&&(r=qo(H)*D+O,n=Go(H)*L+U),o=qo(q)*D+O,i=Go(q)*L+U;break;case Uo.R:r=o=p[b],n=i=p[b+1],a=p[b++],s=p[b++];var W=p[b++],z=p[b++];if(g){if(l<v+(K=d[y++])){var Y=l-v;e.moveTo(a,s),e.lineTo(a+Vo(Y,W),s),0<(Y-=W)&&e.lineTo(a+W,s+Vo(Y,z)),0<(Y-=z)&&e.lineTo(a+Fo(W-Y,0),s+z),0<(Y-=W)&&e.lineTo(a,s+Fo(z-Y,0));break e}v+=K}e.rect(a,s,W,z);break;case Uo.Z:if(g){var K;if(l<v+(K=d[y++])){T=(l-v)/K;e.lineTo(o*(1-T)+r*T,i*(1-T)+n*T);break e}v+=K}e.closePath(),o=r,i=n}}},r.prototype.clone=function(){var e=new r,t=this.data;return e.data=t.slice?t.slice():Array.prototype.slice.call(t),e._len=this._len,e},r.CMD=Uo,r.initDefaultProps=((e=r.prototype)._saveData=!0,e._ux=0,e._uy=0,e._pendingPtDist=0,void(e._version=0)),r}();function Zo(e,t,r,n,o,i,a){if(0===o)return!1;var s=o,d=0;if(t+s<a&&n+s<a||a<t-s&&a<n-s||e+s<i&&r+s<i||i<e-s&&i<r-s)return!1;if(e===r)return Math.abs(i-e)<=s/2;var l=(d=(t-n)/(e-r))*i-a+(e*n-r*t)/(e-r);return l*l/(d*d+1)<=s/2*s/2}function $o(e,t,r,n,o,i,a,s,d,l,u){if(0===d)return!1;var c=d;return!(t+c<u&&n+c<u&&i+c<u&&s+c<u||u<t-c&&u<n-c&&u<i-c&&u<s-c||e+c<l&&r+c<l&&o+c<l&&a+c<l||l<e-c&&l<r-c&&l<o-c&&l<a-c)&&function(e,t,r,n,o,i,a,s,d,l,u){var c,p,h,f,m,g=.005,v=1/0;Rt[0]=d,Rt[1]=l;for(var y=0;y<1;y+=.05)Pt[0]=At(e,r,o,a,y),Pt[1]=At(t,n,i,s,y),(f=Te(Rt,Pt))<v&&(c=y,v=f);v=1/0;for(var _=0;_<32&&!(g<It);_++)p=c-g,h=c+g,Pt[0]=At(e,r,o,a,p),Pt[1]=At(t,n,i,s,p),f=Te(Pt,Rt),0<=p&&f<v?(c=p,v=f):(kt[0]=At(e,r,o,a,h),kt[1]=At(t,n,i,s,h),m=Te(kt,Rt),h<=1&&m<v?(c=h,v=m):g*=.5);return u&&(u[0]=At(e,r,o,a,c),u[1]=At(t,n,i,s,c)),wt(v)}(e,t,r,n,o,i,a,s,l,u,null)<=c/2}function ei(e,t,r,n,o,i,a,s,d){if(0===a)return!1;var l=a;return!(t+l<d&&n+l<d&&i+l<d||d<t-l&&d<n-l&&d<i-l||e+l<s&&r+l<s&&o+l<s||s<e-l&&s<r-l&&s<o-l)&&function(e,t,r,n,o,i,a,s,d){var l,u=.005,c=1/0;Rt[0]=a,Rt[1]=s;for(var p=0;p<1;p+=.05)Pt[0]=Nt(e,r,o,p),Pt[1]=Nt(t,n,i,p),(g=Te(Rt,Pt))<c&&(l=p,c=g);c=1/0;for(var h=0;h<32&&!(u<It);h++){var f=l-u,m=l+u;Pt[0]=Nt(e,r,o,f),Pt[1]=Nt(t,n,i,f);var g=Te(Pt,Rt);if(0<=f&&g<c)l=f,c=g;else{kt[0]=Nt(e,r,o,m),kt[1]=Nt(t,n,i,m);var v=Te(kt,Rt);m<=1&&v<c?(l=m,c=v):u*=.5}}return d&&(d[0]=Nt(e,r,o,l),d[1]=Nt(t,n,i,l)),wt(c)}(e,t,r,n,o,i,s,d,null)<=l/2}var ti=2*Math.PI;function ri(e){return(e%=ti)<0&&(e+=ti),e}var ni=2*Math.PI;function oi(e,t,r,n,o,i,a,s,d){if(0===a)return!1;var l=a;s-=e,d-=t;var u=Math.sqrt(s*s+d*d);if(r<u-l||u+l<r)return!1;if(Math.abs(n-o)%ni<1e-4)return!0;if(i){var c=n;n=ri(o),o=ri(c)}else n=ri(n),o=ri(o);o<n&&(o+=ni);var p=Math.atan2(d,s);return p<0&&(p+=ni),n<=p&&p<=o||n<=p+ni&&p+ni<=o}function ii(e,t,r,n,o,i){if(t<i&&n<i||i<t&&i<n)return 0;if(n===t)return 0;var a=(i-t)/(n-t),s=n<t?1:-1;1!==a&&0!==a||(s=n<t?.5:-.5);var d=a*(r-e)+e;return d===o?1/0:o<d?s:0}var ai=Qo.CMD,si=2*Math.PI,di=1e-4;var li=[-1,-1,-1],ui=[-1,-1];function ci(e,t,r,n,o,i,a,s,d,l){if(t<l&&n<l&&i<l&&s<l||l<t&&l<n&&l<i&&l<s)return 0;var u,c=Ut(t,n,i,s,l,li);if(0===c)return 0;for(var p=0,h=-1,f=void 0,m=void 0,g=0;g<c;g++){var v=li[g],y=0===v||1===v?.5:1;At(e,r,o,a,v)<d||(h<0&&(h=Dt(t,n,i,s,ui),ui[1]<ui[0]&&1<h&&(void 0,u=ui[0],ui[0]=ui[1],ui[1]=u),f=At(t,n,i,s,ui[0]),1<h&&(m=At(t,n,i,s,ui[1]))),2===h?v<ui[0]?p+=f<t?y:-y:v<ui[1]?p+=m<f?y:-y:p+=s<m?y:-y:v<ui[0]?p+=f<t?y:-y:p+=s<f?y:-y)}return p}function pi(e,t,r,n,o,i,a,s){if(t<s&&n<s&&i<s||s<t&&s<n&&s<i)return 0;var d=function(e,t,r,n,o){var i=e-2*t+r,a=2*(t-e),s=e-n,d=0;if(xt(i))Mt(a)&&0<=(u=-s/a)&&u<=1&&(o[d++]=u);else{var l=a*a-4*i*s;if(xt(l))0<=(u=-a/(2*i))&&u<=1&&(o[d++]=u);else if(0<l){var u,c=wt(l),p=(-a-c)/(2*i);0<=(u=(-a+c)/(2*i))&&u<=1&&(o[d++]=u),0<=p&&p<=1&&(o[d++]=p)}}return d}(t,n,i,s,li);if(0===d)return 0;var l=jt(t,n,i);if(0<=l&&l<=1){for(var u=0,c=Nt(t,n,i,l),p=0;p<d;p++){var h=0===li[p]||1===li[p]?.5:1;Nt(e,r,o,li[p])<a||(li[p]<l?u+=c<t?h:-h:u+=i<c?h:-h)}return u}h=0===li[0]||1===li[0]?.5:1;return Nt(e,r,o,li[0])<a?0:i<t?h:-h}function hi(e,t,r,n,o,i,a,s){if(r<(s-=t)||s<-r)return 0;var d=Math.sqrt(r*r-s*s);li[0]=-d,li[1]=d;var l=Math.abs(n-o);if(l<1e-4)return 0;if(si-1e-4<=l){o=si;var u=i?1:-1;return a>=li[n=0]+e&&a<=li[1]+e?u:0}if(o<n){var c=n;n=o,o=c}n<0&&(n+=si,o+=si);for(var p=0,h=0;h<2;h++){var f=li[h];if(a<f+e){var m=Math.atan2(s,f);u=i?1:-1;m<0&&(m=si+m),(n<=m&&m<=o||n<=m+si&&m+si<=o)&&(m>Math.PI/2&&m<1.5*Math.PI&&(u=-u),p+=u)}}return p}function fi(e,t,r,n,o){for(var i,a,s,d,l=e.data,u=e.len(),c=0,p=0,h=0,f=0,m=0,g=0;g<u;){var v=l[g++],y=1===g;switch(v===ai.M&&1<g&&(r||(c+=ii(p,h,f,m,n,o))),y&&(f=p=l[g],m=h=l[g+1]),v){case ai.M:p=f=l[g++],h=m=l[g++];break;case ai.L:if(r){if(Zo(p,h,l[g],l[g+1],t,n,o))return!0}else c+=ii(p,h,l[g],l[g+1],n,o)||0;p=l[g++],h=l[g++];break;case ai.C:if(r){if($o(p,h,l[g++],l[g++],l[g++],l[g++],l[g],l[g+1],t,n,o))return!0}else c+=ci(p,h,l[g++],l[g++],l[g++],l[g++],l[g],l[g+1],n,o)||0;p=l[g++],h=l[g++];break;case ai.Q:if(r){if(ei(p,h,l[g++],l[g++],l[g],l[g+1],t,n,o))return!0}else c+=pi(p,h,l[g++],l[g++],l[g],l[g+1],n,o)||0;p=l[g++],h=l[g++];break;case ai.A:var _=l[g++],b=l[g++],S=l[g++],w=l[g++],E=l[g++],I=l[g++];g+=1;var T=!!(1-l[g++]);i=Math.cos(E)*S+_,a=Math.sin(E)*w+b,y?(f=i,m=a):c+=ii(p,h,i,a,n,o);var C=(n-_)*w/S+_;if(r){if(oi(_,b,w,E,E+I,T,t,C,o))return!0}else c+=hi(_,b,w,E,E+I,T,C,o);p=Math.cos(E+I)*S+_,h=Math.sin(E+I)*w+b;break;case ai.R:if(f=p=l[g++],m=h=l[g++],i=f+l[g++],a=m+l[g++],r){if(Zo(f,m,i,m,t,n,o)||Zo(i,m,i,a,t,n,o)||Zo(i,a,f,a,t,n,o)||Zo(f,a,f,m,t,n,o))return!0}else c+=ii(i,m,i,a,n,o),c+=ii(f,a,f,m,n,o);break;case ai.Z:if(r){if(Zo(p,h,f,m,t,n,o))return!0}else c+=ii(p,h,f,m,n,o);p=f,h=m}}return r||(s=h,d=m,Math.abs(s-d)<di)||(c+=ii(p,h,f,m,n,o)||0),0!==c}var mi=T({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},ho),gi={style:T({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},fo.style)},vi=An.concat(["invisible","culling","z","z2","zlevel","parent"]),yi=function(p){function a(e){return p.call(this,e)||this}var e;return ce(a,p),a.prototype.update=function(){var t=this;p.prototype.update.call(this);var e=this.style;if(e.decal){var r=this._decalEl=this._decalEl||new a;r.buildPath===a.prototype.buildPath&&(r.buildPath=function(e){t.buildPath(e,t.shape)}),r.silent=!0;var n=r.style;for(var o in e)n[o]!==e[o]&&(n[o]=e[o]);n.fill=e.fill?e.decal:null,n.decal=null,n.shadowColor=null,e.strokeFirst&&(n.stroke=null);for(var i=0;i<vi.length;++i)r[vi[i]]=this[vi[i]];r.__dirty|=ht}else this._decalEl&&(this._decalEl=null)},a.prototype.getDecalElement=function(){return this._decalEl},a.prototype._init=function(e){var t=L(e);this.shape=this.getDefaultShape();var r=this.getDefaultStyle();r&&this.useStyle(r);for(var n=0;n<t.length;n++){var o=t[n],i=e[o];"style"===o?this.style?O(this.style,i):this.useStyle(i):"shape"===o?O(this.shape,i):p.prototype.attrKV.call(this,o,i)}this.style||this.useStyle({})},a.prototype.getDefaultStyle=function(){return null},a.prototype.getDefaultShape=function(){return{}},a.prototype.canBeInsideText=function(){return this.hasFill()},a.prototype.getInsideTextFill=function(){var e=this.style.fill;if("none"!==e){if(B(e)){var t=fr(e,0);return.5<t?fn:.2<t?"#eee":mn}if(e)return mn}return fn},a.prototype.getInsideTextStroke=function(e){var t=this.style.fill;if(B(t)){var r=this.__zr;if(!(!r||!r.isDarkMode())===fr(e,0)<.4)return t}},a.prototype.buildPath=function(e,t,r){},a.prototype.pathUpdated=function(){this.__dirty&=~ft},a.prototype.getUpdatedPathProxy=function(e){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,e),this.path},a.prototype.createPathProxy=function(){this.path=new Qo(!1)},a.prototype.hasStroke=function(){var e=this.style,t=e.stroke;return!(null==t||"none"===t||!(0<e.lineWidth))},a.prototype.hasFill=function(){var e=this.style.fill;return null!=e&&"none"!==e},a.prototype.getBoundingRect=function(){var e=this._rect,t=this.style,r=!e;if(r){var n=!1;this.path||(n=!0,this.createPathProxy());var o=this.path;(n||this.__dirty&ft)&&(o.beginPath(),this.buildPath(o,this.shape,!1),this.pathUpdated()),e=o.getBoundingRect()}if(this._rect=e,this.hasStroke()&&this.path&&0<this.path.len()){var i=this._rectStroke||(this._rectStroke=e.clone());if(this.__dirty||r){i.copy(e);var a=t.strokeNoScale?this.getLineScale():1,s=t.lineWidth;if(!this.hasFill()){var d=this.strokeContainThreshold;s=Math.max(s,null==d?4:d)}1e-10<a&&(i.width+=s/a,i.height+=s/a,i.x-=s/a/2,i.y-=s/a/2)}return i}return e},a.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t),n=this.getBoundingRect(),o=this.style;if(e=r[0],t=r[1],n.contain(e,t)){var i=this.path;if(this.hasStroke()){var a=o.lineWidth,s=o.strokeNoScale?this.getLineScale():1;if(1e-10<s&&(this.hasFill()||(a=Math.max(a,this.strokeContainThreshold)),fi(i,a/s,!0,e,t)))return!0}if(this.hasFill())return fi(i,0,!1,e,t)}return!1},a.prototype.dirtyShape=function(){this.__dirty|=ft,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},a.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},a.prototype.animateShape=function(e){return this.animate("shape",e)},a.prototype.updateDuringAnimation=function(e){"style"===e?this.dirtyStyle():"shape"===e?this.dirtyShape():this.markRedraw()},a.prototype.attrKV=function(e,t){"shape"===e?this.setShape(t):p.prototype.attrKV.call(this,e,t)},a.prototype.setShape=function(e,t){var r=this.shape;return r||(r=this.shape={}),"string"==typeof e?r[e]=t:O(r,e),this.dirtyShape(),this},a.prototype.shapeChanged=function(){return!!(this.__dirty&ft)},a.prototype.createStyle=function(e){return oe(mi,e)},a.prototype._innerSaveToNormal=function(e){p.prototype._innerSaveToNormal.call(this,e);var t=this._normalState;e.shape&&!t.shape&&(t.shape=O({},this.shape))},a.prototype._applyStateObj=function(e,t,r,n,o,i){p.prototype._applyStateObj.call(this,e,t,r,n,o,i);var a,s=!(t&&n);if(t&&t.shape?o?n?a=t.shape:O(a=O({},r.shape),t.shape):O(a=O({},n?this.shape:r.shape),t.shape):s&&(a=r.shape),a)if(o){this.shape=O({},this.shape);for(var d={},l=L(a),u=0;u<l.length;u++){var c=l[u];"object"==typeof a[c]?this.shape[c]=a[c]:d[c]=a[c]}this._transitionState(e,{shape:d},i)}else this.shape=a,this.dirtyShape()},a.prototype._mergeStates=function(e){for(var t,r=p.prototype._mergeStates.call(this,e),n=0;n<e.length;n++){var o=e[n];o.shape&&(t=t||{},this._mergeStyle(t,o.shape))}return t&&(r.shape=t),r},a.prototype.getAnimationStyleProps=function(){return gi},a.prototype.isZeroArea=function(){return!1},a.extend=function(n){var e=function(r){function e(e){var t=r.call(this,e)||this;return n.init&&n.init.call(t,e),t}return ce(e,r),e.prototype.getDefaultStyle=function(){return E(n.style)},e.prototype.getDefaultShape=function(){return E(n.shape)},e}(a);for(var t in n)"function"==typeof n[t]&&(e.prototype[t]=n[t]);return e},a.initDefaultProps=((e=a.prototype).type="path",e.strokeContainThreshold=5,e.segmentIgnoreThreshold=0,e.subPixelOptimize=!1,e.autoBatch=!1,void(e.__dirty=2|ht|ft)),a}(vo),_i=yi.extend({type:"Arrowline",shape:{x1:0,y1:0,x2:0,y2:0,percent:1,arrowlength:10,arrowtype:1,points:[]},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.x1,n=t.y1,o=t.x2,i=t.y2,a=t.percent,s=t.arrowlength;if(0!==a)if(e.moveTo(r,n),a<1&&(o=r*(1-a)+o*a,i=n*(1-a)+i*a),e.lineTo(o,i),1==t.arrowtype);else{var d=[],l=Math.sqrt((o-r)*(o-r)+(i-n)*(i-n)),u=-(i-n)/l,c=(o-r)/l,p=s*(Math.cos(5*Math.PI/6)*c-Math.sin(5*Math.PI/6)*u),h=s*(Math.cos(5*Math.PI/6)*u+Math.sin(5*Math.PI/6)*c),f=r*(1-(a=1-s*(Math.cos(Math.PI/6)-.5)/l))+o*a,m=n*(1-a)+i*a,g=s*(Math.cos(7*Math.PI/6)*c-Math.sin(7*Math.PI/6)*u),v=s*(Math.cos(7*Math.PI/6)*u+Math.sin(7*Math.PI/6)*c),y=r*(1-(a=1-a))+o*a,_=n*(1-a)+i*a;3==t.arrowtype?(d.push([o,i]),d.push([o+p,i-h]),d.push([f,m]),d.push([o+g,i-v]),d.push([o,i])):2==t.arrowtype?(d.push([r,n]),d.push([r-p,n+h]),d.push([y,_]),d.push([r-g,n+v]),d.push([r,n])):4==t.arrowtype&&(d.push([o,i]),d.push([o+p,i-h]),d.push([f,m]),d.push([o+g,i-v]),d.push([o,i]),d.push([r,n]),d.push([r-p,n+h]),d.push([y,_]),d.push([r-g,n+v]),d.push([r,n])),t.points=d,ra(e,t,!0)}}}),bi=Qo.CMD,Si=[[],[],[]],wi=Math.sqrt,Ei=Math.atan2;function Ii(e,t){if(t){var r,n,o,i,a,s,d=e.data,l=e.len(),u=bi.M,c=bi.C,p=bi.L,h=bi.R,f=bi.A,m=bi.Q;for(i=o=0;o<l;){switch(r=d[o++],i=o,n=0,r){case u:case p:n=1;break;case c:n=3;break;case m:n=2;break;case f:var g=t[4],v=t[5],y=wi(t[0]*t[0]+t[1]*t[1]),_=wi(t[2]*t[2]+t[3]*t[3]),b=Ei(-t[1]/_,t[0]/y);d[o]*=y,d[o++]+=g,d[o]*=_,d[o++]+=v,d[o++]*=y,d[o++]*=_,d[o++]+=b,d[o++]+=b,i=o+=2;break;case h:s[0]=d[o++],s[1]=d[o++],Re(s,s,t),d[i++]=s[0],d[i++]=s[1],s[0]+=d[o++],s[1]+=d[o++],Re(s,s,t),d[i++]=s[0],d[i++]=s[1]}for(a=0;a<n;a++){var S=Si[a];S[0]=d[o++],S[1]=d[o++],Re(S,S,t),d[i++]=S[0],d[i++]=S[1]}}e.increaseVersion()}}var Ti=Math.sqrt,Ci=Math.sin,Ri=Math.cos,Pi=Math.PI;function ki(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function xi(e,t){return(e[0]*t[0]+e[1]*t[1])/(ki(e)*ki(t))}function Mi(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(xi(e,t))}function Ai(e,t,r,n,o,i,a,s,d,l,u){var c=d*(Pi/180),p=Ri(c)*(e-r)/2+Ci(c)*(t-n)/2,h=-1*Ci(c)*(e-r)/2+Ri(c)*(t-n)/2,f=p*p/(a*a)+h*h/(s*s);1<f&&(a*=Ti(f),s*=Ti(f));var m=(o===i?-1:1)*Ti((a*a*(s*s)-a*a*(h*h)-s*s*(p*p))/(a*a*(h*h)+s*s*(p*p)))||0,g=m*a*h/s,v=m*-s*p/a,y=(e+r)/2+Ri(c)*g-Ci(c)*v,_=(t+n)/2+Ci(c)*g+Ri(c)*v,b=Mi([1,0],[(p-g)/a,(h-v)/s]),S=[(p-g)/a,(h-v)/s],w=[(-1*p-g)/a,(-1*h-v)/s],E=Mi(S,w);if(xi(S,w)<=-1&&(E=Pi),1<=xi(S,w)&&(E=0),E<0){var I=Math.round(E/Pi*1e6)/1e6;E=2*Pi+I%2*Pi}u.addData(l,y,_,a,s,b,E,c,i)}var Oi=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/gi,Ui=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;var Di=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ce(t,e),t.prototype.applyTransform=function(e){},t}(yi);function Li(e){return null!=e.setData}function Hi(e,t){var r=function(e){var t=new Qo;if(!e)return t;var r,n=0,o=0,i=n,a=o,s=Qo.CMD,d=e.match(Oi);if(!d)return t;for(var l=0;l<d.length;l++){for(var u=d[l],c=u.charAt(0),p=void 0,h=u.match(Ui)||[],f=h.length,m=0;m<f;m++)h[m]=parseFloat(h[m]);for(var g=0;g<f;){var v=void 0,y=void 0,_=void 0,b=void 0,S=void 0,w=void 0,E=void 0,I=n,T=o,C=void 0,R=void 0;switch(c){case"l":n+=h[g++],o+=h[g++],p=s.L,t.addData(p,n,o);break;case"L":n=h[g++],o=h[g++],p=s.L,t.addData(p,n,o);break;case"m":n+=h[g++],o+=h[g++],p=s.M,t.addData(p,n,o),i=n,a=o,c="l";break;case"M":n=h[g++],o=h[g++],p=s.M,t.addData(p,n,o),i=n,a=o,c="L";break;case"h":n+=h[g++],p=s.L,t.addData(p,n,o);break;case"H":n=h[g++],p=s.L,t.addData(p,n,o);break;case"v":o+=h[g++],p=s.L,t.addData(p,n,o);break;case"V":o=h[g++],p=s.L,t.addData(p,n,o);break;case"C":p=s.C,t.addData(p,h[g++],h[g++],h[g++],h[g++],h[g++],h[g++]),n=h[g-2],o=h[g-1];break;case"c":p=s.C,t.addData(p,h[g++]+n,h[g++]+o,h[g++]+n,h[g++]+o,h[g++]+n,h[g++]+o),n+=h[g-2],o+=h[g-1];break;case"S":v=n,y=o,C=t.len(),R=t.data,r===s.C&&(v+=n-R[C-4],y+=o-R[C-3]),p=s.C,I=h[g++],T=h[g++],n=h[g++],o=h[g++],t.addData(p,v,y,I,T,n,o);break;case"s":v=n,y=o,C=t.len(),R=t.data,r===s.C&&(v+=n-R[C-4],y+=o-R[C-3]),p=s.C,I=n+h[g++],T=o+h[g++],n+=h[g++],o+=h[g++],t.addData(p,v,y,I,T,n,o);break;case"Q":I=h[g++],T=h[g++],n=h[g++],o=h[g++],p=s.Q,t.addData(p,I,T,n,o);break;case"q":I=h[g++]+n,T=h[g++]+o,n+=h[g++],o+=h[g++],p=s.Q,t.addData(p,I,T,n,o);break;case"T":v=n,y=o,C=t.len(),R=t.data,r===s.Q&&(v+=n-R[C-4],y+=o-R[C-3]),n=h[g++],o=h[g++],p=s.Q,t.addData(p,v,y,n,o);break;case"t":v=n,y=o,C=t.len(),R=t.data,r===s.Q&&(v+=n-R[C-4],y+=o-R[C-3]),n+=h[g++],o+=h[g++],p=s.Q,t.addData(p,v,y,n,o);break;case"A":_=h[g++],b=h[g++],S=h[g++],w=h[g++],E=h[g++],Ai(I=n,T=o,n=h[g++],o=h[g++],w,E,_,b,S,p=s.A,t);break;case"a":_=h[g++],b=h[g++],S=h[g++],w=h[g++],E=h[g++],Ai(I=n,T=o,n+=h[g++],o+=h[g++],w,E,_,b,S,p=s.A,t)}}"z"!==c&&"Z"!==c||(p=s.Z,t.addData(p),n=i,o=a),r=p}return t.toStatic(),t}(e),n=O({},t);return n.buildPath=function(e){if(Li(e)){e.setData(r.data),(t=e.getContext())&&e.rebuildPath(t,1)}else{var t=e;r.rebuildPath(t,1)}},n.applyTransform=function(e){Ii(r,e),this.dirtyShape()},n}function Ni(e,t){return new Di(Hi(e,t))}function Bi(e,t){t=t||{};var r=new yi;return e.shape&&r.setShape(e.shape),r.setStyle(e.style),t.bakeTransform?Ii(r.path,e.getComputedTransform()):t.toLocal?r.setLocalTransform(e.getComputedTransform()):r.copyTransform(e),r.buildPath=e.buildPath,r.applyTransform=r.applyTransform,r.z=e.z,r.z2=e.z2,r.zlevel=e.zlevel,r}var ji=Object.freeze({__proto__:null,createFromString:Ni,extendFromString:function(e,t){var n=Hi(e,t);return function(r){function e(e){var t=r.call(this,e)||this;return t.applyTransform=n.applyTransform,t.buildPath=n.buildPath,t}return ce(e,r),e}(Di)},mergePath:function(e,t){for(var r=[],n=e.length,o=0;o<n;o++){var i=e[o];r.push(i.getUpdatedPathProxy(!0))}var a=new yi(t);return a.createPathProxy(),a.buildPath=function(e){if(Li(e)){e.appendPath(r);var t=e.getContext();t&&e.rebuildPath(t,1)}},a},clonePath:Bi}),Vi=T({x:0,y:0},ho),Fi={style:T({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},fo.style)};var qi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ce(t,e),t.prototype.createStyle=function(e){return oe(Vi,e)},t.prototype._getSize=function(e){var t=this.style,r=t[e];if(null!=r)return r;var n,o=(n=t.image)&&"string"!=typeof n&&n.width&&n.height?t.image:this.__image;if(!o)return 0;var i="width"===e?"height":"width",a=t[i];return null==a?o[e]:o[e]/o[i]*a},t.prototype.getWidth=function(){return this._getSize("width")},t.prototype.getHeight=function(){return this._getSize("height")},t.prototype.getAnimationStyleProps=function(){return Fi},t.prototype.getBoundingRect=function(){var e=this.style;return this._rect||(this._rect=new qn(e.x||0,e.y||0,this.getWidth(),this.getHeight())),this._rect},t}(vo);qi.prototype.type="image";var Gi=function(){this.cx=0,this.cy=0,this.r=0},Wi=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new Gi},e.prototype.buildPath=function(e,t){e.moveTo(t.cx+t.r,t.cy),e.arc(t.cx,t.cy,t.r,0,2*Math.PI)},e}(yi);Wi.prototype.type="circle";var zi=Math.round;function Yi(e,t,r){if(!t)return e;var n=zi(2*e);return(n+zi(t))%2==0?n/2:(n+(r?1:-1))/2}var Ki=function(){this.x=0,this.y=0,this.width=0,this.height=0},Xi={},Ji=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new Ki},e.prototype.buildPath=function(e,t){var r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,v;if(this.subPixelOptimize){var y=function(e,t,r){if(t){var n=t.x,o=t.y,i=t.width,a=t.height;e.x=n,e.y=o,e.width=i,e.height=a;var s=r&&r.lineWidth;return s&&(e.x=Yi(n,s,!0),e.y=Yi(o,s,!0),e.width=Math.max(Yi(n+i,s,!1)-e.x,0===i?0:1),e.height=Math.max(Yi(o+a,s,!1)-e.y,0===a?0:1)),e}}(Xi,t,this.style);r=y.x,n=y.y,o=y.width,i=y.height,y.r=t.r,t=y}else r=t.x,n=t.y,o=t.width,i=t.height;t.r?(a=e,h=(s=t).x,f=s.y,m=s.width,g=s.height,v=s.r,m<0&&(h+=m,m=-m),g<0&&(f+=g,g=-g),"number"==typeof v?d=l=u=c=v:v instanceof Array?1===v.length?d=l=u=c=v[0]:2===v.length?(d=u=v[0],l=c=v[1]):3===v.length?(d=v[0],l=c=v[1],u=v[2]):(d=v[0],l=v[1],u=v[2],c=v[3]):d=l=u=c=0,m<d+l&&(d*=m/(p=d+l),l*=m/p),m<u+c&&(u*=m/(p=u+c),c*=m/p),g<l+u&&(l*=g/(p=l+u),u*=g/p),g<d+c&&(d*=g/(p=d+c),c*=g/p),a.moveTo(h+d,f),a.lineTo(h+m-l,f),0!==l&&a.arc(h+m-l,f+l,l,-Math.PI/2,0),a.lineTo(h+m,f+g-u),0!==u&&a.arc(h+m-u,f+g-u,u,0,Math.PI/2),a.lineTo(h+c,f+g),0!==c&&a.arc(h+c,f+g-c,c,Math.PI/2,Math.PI),a.lineTo(h,f+d),0!==d&&a.arc(h+d,f+d,d,Math.PI,1.5*Math.PI)):e.rect(r,n,o,i)},e.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},e}(yi);Ji.prototype.type="rect";var Qi=function(){this.cx=0,this.cy=0,this.rx=0,this.ry=0},Zi=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new Qi},e.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=t.rx,i=t.ry,a=.5522848*o,s=.5522848*i;e.moveTo(r-o,n),e.bezierCurveTo(r-o,n-s,r-a,n-i,r,n-i),e.bezierCurveTo(r+a,n-i,r+o,n-s,r+o,n),e.bezierCurveTo(r+o,n+s,r+a,n+i,r,n+i),e.bezierCurveTo(r-a,n+i,r-o,n+s,r-o,n),e.closePath()},e}(yi);Zi.prototype.type="ellipse";var $i={},ea=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1},ta=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new ea},e.prototype.buildPath=function(e,t){var r,n,o,i;if(this.subPixelOptimize){var a=function(e,t,r){if(t){var n=t.x1,o=t.x2,i=t.y1,a=t.y2;e.x1=n,e.x2=o,e.y1=i,e.y2=a;var s=r&&r.lineWidth;return s&&(zi(2*n)===zi(2*o)&&(e.x1=e.x2=Yi(n,s,!0)),zi(2*i)===zi(2*a)&&(e.y1=e.y2=Yi(i,s,!0))),e}}($i,t,this.style);r=a.x1,n=a.y1,o=a.x2,i=a.y2}else r=t.x1,n=t.y1,o=t.x2,i=t.y2;var s=t.percent;0!==s&&(e.moveTo(r,n),s<1&&(o=r*(1-s)+o*s,i=n*(1-s)+i*s),e.lineTo(o,i))},e.prototype.pointAt=function(e){var t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]},e}(yi);function ra(e,t,r){var n=t.smooth,o=t.points;if(o&&2<=o.length){if(n){var i=function(e,t,r,n){var o,i,a,s,d=[],l=[],u=[],c=[];if(n){a=[1/0,1/0],s=[-1/0,-1/0];for(var p=0,h=e.length;p<h;p++)Pe(a,a,e[p]),ke(s,s,e[p]);Pe(a,a,n[0]),ke(s,s,n[1])}for(p=0,h=e.length;p<h;p++){var f=e[p];if(r)o=e[p?p-1:h-1],i=e[(p+1)%h];else{if(0===p||p===h-1){d.push(he(e[p]));continue}o=e[p-1],i=e[p+1]}me(l,i,o),be(l,l,t);var m=we(f,o),g=we(f,i),v=m+g;0!==v&&(m/=v,g/=v),be(u,l,-m),be(c,l,g);var y=fe([],f,u),_=fe([],f,c);n&&(ke(y,y,a),Pe(y,y,s),ke(_,_,a),Pe(_,_,s)),d.push(y),d.push(_)}return r&&d.push(d.shift()),d}(o,n,r,t.smoothConstraint);e.moveTo(o[0][0],o[0][1]);for(var a=o.length,s=0;s<(r?a:a-1);s++){var d=i[2*s],l=i[2*s+1],u=o[(s+1)%a];e.bezierCurveTo(d[0],d[1],l[0],l[1],u[0],u[1])}}else{e.moveTo(o[0][0],o[0][1]);s=1;for(var c=o.length;s<c;s++)e.lineTo(o[s][0],o[s][1])}r&&e.closePath()}}ta.prototype.type="line";var na=function(){this.points=null,this.smooth=0,this.smoothConstraint=null},oa=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new na},e.prototype.buildPath=function(e,t){ra(e,t,!0)},e}(yi);oa.prototype.type="polygon";var ia=function(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null},aa=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new ia},e.prototype.buildPath=function(e,t){ra(e,t,!1)},e}(yi);aa.prototype.type="polyline";var sa,da=function(){function e(e){this.colorStops=e||[]}return e.prototype.addColorStop=function(e,t){this.colorStops.push({offset:e,color:t})},e}(),la=function(s){function e(e,t,r,n,o,i){var a=s.call(this,o)||this;return a.x=null==e?0:e,a.y=null==t?0:t,a.x2=null==r?1:r,a.y2=null==n?0:n,a.type="linear",a.global=i||!1,a}return ce(e,s),e}(da),ua=function(a){function e(e,t,r,n,o){var i=a.call(this,n)||this;return i.x=null==e?.5:e,i.y=null==t?.5:t,i.r=null==r?.5:r,i.type="radial",i.global=o||!1,i}return ce(e,a),e}(da),ca=T({strokeFirst:!0,font:x,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},mi),pa=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ce(t,e),t.prototype.hasStroke=function(){var e=this.style,t=e.stroke;return null!=t&&"none"!==t&&0<e.lineWidth},t.prototype.hasFill=function(){var e=this.style.fill;return null!=e&&"none"!==e},t.prototype.createStyle=function(e){return oe(ca,e)},t.prototype.setBoundingRect=function(e){this._rect=e},t.prototype.getBoundingRect=function(){var e=this.style;if(!this._rect){var t=e.text;null!=t?t+="":t="";var r=function(e,t,r,n){var o=((e||"")+"").split("\n");if(1===o.length)return zn(o[0],t,r,n);for(var i=new qn(0,0,0,0),a=0;a<o.length;a++){var s=zn(o[a],t,r,n);0===a?i.copy(s):i.union(s)}return i}(t,e.font,e.textAlign,e.textBaseline);if(r.x+=e.x||0,r.y+=e.y||0,this.hasStroke()){var n=e.lineWidth;r.x-=n/2,r.y-=n/2,r.width+=n,r.height+=n}this._rect=r}return this._rect},t.initDefaultProps=void(t.prototype.dirtyRectTolerance=10),t}(vo);pa.prototype.type="tspan";var ha={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},fa=L(ha),ma={"alignment-baseline":"textBaseline","stop-color":"stopColor"},ga=L(ma),va=function(){function e(){this._defs={},this._root=null}return e.prototype.parse=function(e,t){t=t||{};var r=function(e){B(e)&&(e=(new DOMParser).parseFromString(e,"text/xml"));var t=e;for(9===t.nodeType&&(t=t.firstChild);"svg"!==t.nodeName.toLowerCase()||1!==t.nodeType;)t=t.nextSibling;return t}(e);if(!r)throw new Error("Illegal svg");this._defsUsePending=[];var n=new ao;this._root=n;var o=[],i=r.getAttribute("viewBox")||"",a=parseFloat(r.getAttribute("width")||t.width),s=parseFloat(r.getAttribute("height")||t.height);isNaN(a)&&(a=null),isNaN(s)&&(s=null),Ea(r,n,null,!0,!1);for(var d,l,u,c,p,h,f,m=r.firstChild;m;)this._parseNode(m,n,o,null,!1,!1),m=m.nextSibling;if(function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n[0].style[n[1]]=e[n[2]]}}(this._defs,this._defsUsePending),this._defsUsePending=[],i){var g=Ra(i);4<=g.length&&(d={x:parseFloat(g[0]||0),y:parseFloat(g[1]||0),width:parseFloat(g[2]),height:parseFloat(g[3])})}if(d&&null!=a&&null!=s&&(p=(c={x:0,y:0,width:a,height:s}).width/(u=d).width,h=c.height/u.height,l={scale:f=Math.min(p,h),x:-(u.x+u.width/2)*f+(c.x+c.width/2),y:-(u.y+u.height/2)*f+(c.y+c.height/2)},!t.ignoreViewBox)){var v=n;(n=new ao).add(v),v.scaleX=v.scaleY=l.scale,v.x=l.x,v.y=l.y}return t.ignoreRootClip||null==a||null==s||n.setClipPath(new Ji({shape:{x:0,y:0,width:a,height:s}})),{root:n,width:a,height:s,viewBoxRect:d,viewBoxTransform:l,named:o}},e.prototype._parseNode=function(e,t,r,n,o,i){var a,s=e.nodeName.toLowerCase(),d=n;if("defs"===s&&(o=!0),"text"===s&&(i=!0),"defs"===s||"switch"===s)a=t;else{if(!o){var l=sa[s];if(l&&ae(sa,s)){a=l.call(this,e,t);var u=e.getAttribute("name");if(u){var c={name:u,namedFrom:null,svgNodeTagLower:s,el:a};r.push(c),"g"===s&&(d=c)}else n&&r.push({name:n.name,namedFrom:n,svgNodeTagLower:s,el:a});t.add(a)}}var p=ya[s];if(p&&ae(ya,s)){var h=p.call(this,e),f=e.getAttribute("id");f&&(this._defs[f]=h)}}if(a&&a.isGroup)for(var m=e.firstChild;m;)1===m.nodeType?this._parseNode(m,a,r,d,o,i):3===m.nodeType&&i&&this._parseText(m,a),m=m.nextSibling},e.prototype._parseText=function(e,t){var r=new pa({style:{text:e.textContent},silent:!0,x:this._textX||0,y:this._textY||0});Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),function(e,t){var r=t.__selfStyle;if(r){var n=r.textBaseline,o=n;n&&"auto"!==n?"baseline"===n?o="alphabetic":"before-edge"===n||"text-before-edge"===n?o="top":"after-edge"===n||"text-after-edge"===n?o="bottom":"central"!==n&&"mathematical"!==n||(o="middle"):o="alphabetic",e.style.textBaseline=o}var i=t.__inheritedStyle;if(i){var a=i.textAlign,s=a;a&&("middle"===a&&(s="center"),e.style.textAlign=s)}}(r,t);var n=r.style,o=n.fontSize;o&&o<9&&(n.fontSize=9,r.scaleX*=o/9,r.scaleY*=o/9);var i=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");n.font=i;var a=r.getBoundingRect();return this._textX+=a.width,t.add(r),r},e.internalField=void(sa={g:function(e,t){var r=new ao;return Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),r},rect:function(e,t){var r=new Ji;return Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),r.setShape({x:parseFloat(e.getAttribute("x")||"0"),y:parseFloat(e.getAttribute("y")||"0"),width:parseFloat(e.getAttribute("width")||"0"),height:parseFloat(e.getAttribute("height")||"0")}),r.silent=!0,r},circle:function(e,t){var r=new Wi;return Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),r:parseFloat(e.getAttribute("r")||"0")}),r.silent=!0,r},line:function(e,t){var r=new ta;return Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),r.setShape({x1:parseFloat(e.getAttribute("x1")||"0"),y1:parseFloat(e.getAttribute("y1")||"0"),x2:parseFloat(e.getAttribute("x2")||"0"),y2:parseFloat(e.getAttribute("y2")||"0")}),r.silent=!0,r},ellipse:function(e,t){var r=new Zi;return Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),r.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),rx:parseFloat(e.getAttribute("rx")||"0"),ry:parseFloat(e.getAttribute("ry")||"0")}),r.silent=!0,r},polygon:function(e,t){var r,n=e.getAttribute("points");n&&(r=wa(n));var o=new oa({shape:{points:r||[]},silent:!0});return Sa(t,o),Ea(e,o,this._defsUsePending,!1,!1),o},polyline:function(e,t){var r,n=e.getAttribute("points");n&&(r=wa(n));var o=new aa({shape:{points:r||[]},silent:!0});return Sa(t,o),Ea(e,o,this._defsUsePending,!1,!1),o},image:function(e,t){var r=new qi;return Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),r.setStyle({image:e.getAttribute("xlink:href")||e.getAttribute("href"),x:+e.getAttribute("x"),y:+e.getAttribute("y"),width:+e.getAttribute("width"),height:+e.getAttribute("height")}),r.silent=!0,r},text:function(e,t){var r=e.getAttribute("x")||"0",n=e.getAttribute("y")||"0",o=e.getAttribute("dx")||"0",i=e.getAttribute("dy")||"0";this._textX=parseFloat(r)+parseFloat(o),this._textY=parseFloat(n)+parseFloat(i);var a=new ao;return Sa(t,a),Ea(e,a,this._defsUsePending,!1,!0),a},tspan:function(e,t){var r=e.getAttribute("x"),n=e.getAttribute("y");null!=r&&(this._textX=parseFloat(r)),null!=n&&(this._textY=parseFloat(n));var o=e.getAttribute("dx")||"0",i=e.getAttribute("dy")||"0",a=new ao;return Sa(t,a),Ea(e,a,this._defsUsePending,!1,!0),this._textX+=parseFloat(o),this._textY+=parseFloat(i),a},path:function(e,t){var r=Ni(e.getAttribute("d")||"");return Sa(t,r),Ea(e,r,this._defsUsePending,!1,!1),r.silent=!0,r}}),e}(),ya={lineargradient:function(e){var t=parseInt(e.getAttribute("x1")||"0",10),r=parseInt(e.getAttribute("y1")||"0",10),n=parseInt(e.getAttribute("x2")||"10",10),o=parseInt(e.getAttribute("y2")||"0",10),i=new la(t,r,n,o);return _a(e,i),ba(e,i),i},radialgradient:function(e){var t=parseInt(e.getAttribute("cx")||"0",10),r=parseInt(e.getAttribute("cy")||"0",10),n=parseInt(e.getAttribute("r")||"0",10),o=new ua(t,r,n);return _a(e,o),ba(e,o),o}};function _a(e,t){"userSpaceOnUse"===e.getAttribute("gradientUnits")&&(t.global=!0)}function ba(e,t){for(var r=e.firstChild;r;){if(1===r.nodeType&&"stop"===r.nodeName.toLocaleLowerCase()){var n=r.getAttribute("offset"),o=void 0;o=n&&0<n.indexOf("%")?parseInt(n,10)/100:n?parseFloat(n):0;var i={};Ma(r,i,i);var a=i.stopColor||r.getAttribute("stop-color")||"#000000";t.colorStops.push({offset:o,color:a})}r=r.nextSibling}}function Sa(e,t){e&&e.__inheritedStyle&&(t.__inheritedStyle||(t.__inheritedStyle={}),T(t.__inheritedStyle,e.__inheritedStyle))}function wa(e){for(var t=Ra(e),r=[],n=0;n<t.length;n+=2){var o=parseFloat(t[n]),i=parseFloat(t[n+1]);r.push([o,i])}return r}function Ea(e,t,r,n,o){var i=t,a=i.__inheritedStyle=i.__inheritedStyle||{},s={};1===e.nodeType&&(function(e,t){var r=e.getAttribute("transform");if(r){r=r.replace(/,/g," ");var n=[],o=null;r.replace(Pa,function(e,t,r){return n.push(t,r),""});for(var i=n.length-1;0<i;i-=2){var a=n[i],s=n[i-1],d=Ra(a);switch(o=o||[1,0,0,1,0,0],s){case"translate":bn(o,o,[parseFloat(d[0]),parseFloat(d[1]||"0")]);break;case"scale":wn(o,o,[parseFloat(d[0]),parseFloat(d[1]||d[0])]);break;case"rotate":Sn(o,o,-parseFloat(d[0])*ka);break;case"skewX":var l=Math.tan(parseFloat(d[0])*ka);_n(o,[1,0,l,1,0,0],o);break;case"skewY":var u=Math.tan(parseFloat(d[0])*ka);_n(o,[1,u,0,1,0,0],o);break;case"matrix":o[0]=parseFloat(d[0]),o[1]=parseFloat(d[1]),o[2]=parseFloat(d[2]),o[3]=parseFloat(d[3]),o[4]=parseFloat(d[4]),o[5]=parseFloat(d[5])}}t.setLocalTransform(o)}}(e,t),Ma(e,a,s),n||function(e,t,r){for(var n=0;n<fa.length;n++){var o=fa[n],i=e.getAttribute(o);null!=i&&(t[ha[o]]=i)}for(var n=0;n<ga.length;n++){var o=ga[n],i=e.getAttribute(o);null!=i&&(r[ma[o]]=i)}}(e,a,s)),i.style=i.style||{},null!=a.fill&&(i.style.fill=Ta(i,"fill",a.fill,r)),null!=a.stroke&&(i.style.stroke=Ta(i,"stroke",a.stroke,r)),U(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(e){null!=a[e]&&(i.style[e]=parseFloat(a[e]))}),U(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(e){null!=a[e]&&(i.style[e]=a[e])}),o&&(i.__selfStyle=s),a.lineDash&&(i.style.lineDash=M(Ra(a.lineDash),function(e){return parseFloat(e)})),"hidden"!==a.visibility&&"collapse"!==a.visibility||(i.invisible=!0),"none"===a.display&&(i.ignore=!0)}var Ia=/^url\(\s*#(.*?)\)/;function Ta(e,t,r,n){var o=r&&r.match(Ia);if(!o)return"none"===r&&(r=null),r;var i=ee(o[1]);n.push([e,t,i])}var Ca=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function Ra(e){return e.match(Ca)||[]}var Pa=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,ka=Math.PI/180;var xa=/([^\s:;]+)\s*:\s*([^:;]+)/g;function Ma(e,t,r){var n,o=e.getAttribute("style");if(o)for(xa.lastIndex=0;null!=(n=xa.exec(o));){var i=n[1],a=ae(ha,i)?ha[i]:null;a&&(t[a]=n[2]);var s=ae(ma,i)?ma[i]:null;s&&(r[s]=n[2])}}var Aa=Math.PI,Oa=2*Aa,Ua=Math.sin,Da=Math.cos,La=Math.acos,Ha=Math.atan2,Na=Math.abs,Ba=Math.sqrt,ja=Math.max,Va=Math.min,Fa=1e-4;function qa(e,t,r,n,o,i,a){var s=e-r,d=t-n,l=(a?i:-i)/Ba(s*s+d*d),u=l*d,c=-l*s,p=e+u,h=t+c,f=r+u,m=n+c,g=(p+f)/2,v=(h+m)/2,y=f-p,_=m-h,b=y*y+_*_,S=o-i,w=p*m-f*h,E=(_<0?-1:1)*Ba(ja(0,S*S*b-w*w)),I=(w*_-y*E)/b,T=(-w*y-_*E)/b,C=(w*_+y*E)/b,R=(-w*y+_*E)/b,P=I-g,k=T-v,x=C-g,M=R-v;return x*x+M*M<P*P+k*k&&(I=C,T=R),{cx:I,cy:T,x0:-u,y0:-c,x1:I*(o/S-1),y1:T*(o/S-1)}}function Ga(e,t){var r,n=ja(t.r,0),o=ja(t.r0||0,0),i=0<n;if(i||0<o){if(i||(n=o,o=0),n<o){var a=n;n=o,o=a}var s=t.startAngle,d=t.endAngle;if(!isNaN(s)&&!isNaN(d)){var l=t.cx,u=t.cy,c=!!t.clockwise,p=Na(d-s),h=Oa<p&&p%Oa;if(Fa<h&&(p=h),Fa<n)if(Oa-Fa<p)e.moveTo(l+n*Da(s),u+n*Ua(s)),e.arc(l,u,n,s,d,!c),Fa<o&&(e.moveTo(l+o*Da(d),u+o*Ua(d)),e.arc(l,u,o,d,s,c));else{var f=void 0,m=void 0,g=void 0,v=void 0,y=void 0,_=void 0,b=void 0,S=void 0,w=void 0,E=void 0,I=void 0,T=void 0,C=void 0,R=void 0,P=void 0,k=void 0,x=n*Da(s),M=n*Ua(s),A=o*Da(d),O=o*Ua(d),U=Fa<p;if(U){var D=t.cornerRadius;D&&(f=(r=function(e){var t;if(K(e)){var r=e.length;if(!r)return e;t=1===r?[e[0],e[0],0,0]:2===r?[e[0],e[0],e[1],e[1]]:3===r?e.concat(e[2]):e}else t=[e,e,e,e];return t}(D))[0],m=r[1],g=r[2],v=r[3]);var L=Na(n-o)/2;if(y=Va(L,g),_=Va(L,v),b=Va(L,f),S=Va(L,m),I=w=ja(y,_),T=E=ja(b,S),(Fa<w||Fa<E)&&(C=n*Da(d),R=n*Ua(d),P=o*Da(s),k=o*Ua(s),p<Aa)){var H=function(e,t,r,n,o,i,a,s){var d=r-e,l=n-t,u=a-o,c=s-i,p=c*d-u*l;if(!(p*p<Fa))return[e+(p=(u*(t-i)-c*(e-o))/p)*d,t+p*l]}(x,M,P,k,C,R,A,O);if(H){var N=x-H[0],B=M-H[1],j=C-H[0],V=R-H[1],F=1/Ua(La((N*j+B*V)/(Ba(N*N+B*B)*Ba(j*j+V*V)))/2),q=Ba(H[0]*H[0]+H[1]*H[1]);I=Va(w,(n-q)/(F+1)),T=Va(E,(o-q)/(F-1))}}}if(U)if(Fa<I){var G=Va(g,I),W=Va(v,I),z=qa(P,k,x,M,n,G,c),Y=qa(C,R,A,O,n,W,c);e.moveTo(l+z.cx+z.x0,u+z.cy+z.y0),I<w&&G===W?e.arc(l+z.cx,u+z.cy,I,Ha(z.y0,z.x0),Ha(Y.y0,Y.x0),!c):(0<G&&e.arc(l+z.cx,u+z.cy,G,Ha(z.y0,z.x0),Ha(z.y1,z.x1),!c),e.arc(l,u,n,Ha(z.cy+z.y1,z.cx+z.x1),Ha(Y.cy+Y.y1,Y.cx+Y.x1),!c),0<W&&e.arc(l+Y.cx,u+Y.cy,W,Ha(Y.y1,Y.x1),Ha(Y.y0,Y.x0),!c))}else e.moveTo(l+x,u+M),e.arc(l,u,n,s,d,!c);else e.moveTo(l+x,u+M);if(Fa<o&&U)if(Fa<T){G=Va(f,T),z=qa(A,O,C,R,o,-(W=Va(m,T)),c),Y=qa(x,M,P,k,o,-G,c);e.lineTo(l+z.cx+z.x0,u+z.cy+z.y0),T<E&&G===W?e.arc(l+z.cx,u+z.cy,T,Ha(z.y0,z.x0),Ha(Y.y0,Y.x0),!c):(0<W&&e.arc(l+z.cx,u+z.cy,W,Ha(z.y0,z.x0),Ha(z.y1,z.x1),!c),e.arc(l,u,o,Ha(z.cy+z.y1,z.cx+z.x1),Ha(Y.cy+Y.y1,Y.cx+Y.x1),c),0<G&&e.arc(l+Y.cx,u+Y.cy,G,Ha(Y.y1,Y.x1),Ha(Y.y0,Y.x0),!c))}else e.lineTo(l+A,u+O),e.arc(l,u,o,d,s,c);else e.lineTo(l+A,u+O)}else e.moveTo(l,u);e.closePath()}}}var Wa=function(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.cornerRadius=0},za=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new Wa},e.prototype.buildPath=function(e,t){Ga(e,t)},e.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},e}(yi);za.prototype.type="sector";var Ya=Qo.CMD;function Ka(e,t){return Math.abs(e-t)<1e-5}function Xa(e){var o,t,r,n,i,a,s,d,l,u,c,p,h,f,m,g,v,y,_,b,S,w,E,I,T=e.data,C=e.len(),R=[],P=0,k=0,x=0,M=0;function A(e,t){o&&2<o.length&&R.push(o),o=[e,t]}function O(e,t,r,n){Ka(e,r)&&Ka(t,n)||o.push(e,t,r,n,r,n)}for(var U=0;U<C;){var D=T[U++],L=1===U;switch(L&&(x=P=T[U],M=k=T[U+1],D!==Ya.L&&D!==Ya.C&&D!==Ya.Q||(o=[x,M])),D){case Ya.M:P=x=T[U++],k=M=T[U++],A(x,M);break;case Ya.L:O(P,k,t=T[U++],r=T[U++]),P=t,k=r;break;case Ya.C:o.push(T[U++],T[U++],T[U++],T[U++],P=T[U++],k=T[U++]);break;case Ya.Q:t=T[U++],r=T[U++],n=T[U++],i=T[U++],o.push(P+2/3*(t-P),k+2/3*(r-k),n+2/3*(t-n),i+2/3*(r-i),n,i),P=n,k=i;break;case Ya.A:var H=T[U++],N=T[U++],B=T[U++],j=T[U++],V=T[U++],F=T[U++]+V;U+=1;var q=!T[U++];t=Math.cos(V)*B+H,r=Math.sin(V)*j+N,L?A(x=t,M=r):O(P,k,t,r),P=Math.cos(F)*B+H,k=Math.sin(F)*j+N;for(var G=(q?-1:1)*Math.PI/2,W=V;q?F<W:W<F;W+=G){var z=q?Math.max(W+G,F):Math.min(W+G,F);a=W,s=z,d=H,l=N,u=B,c=j,void 0,p=Math.abs(s-a),h=4*Math.tan(p/4)/3,f=s<a?-1:1,m=Math.cos(a),g=Math.sin(a),v=Math.cos(s),y=Math.sin(s),_=m*u+d,b=g*c+l,S=v*u+d,w=y*c+l,E=u*h*f,I=c*h*f,o.push(_-E*g,b+I*m,S+E*y,w-I*v,S,w)}break;case Ya.R:x=P=T[U++],M=k=T[U++],t=x+T[U++],r=M+T[U++],A(t,M),O(t,M,t,r),O(t,r,x,r),O(x,r,x,M),O(x,M,t,M);break;case Ya.Z:o&&O(P,k,x,M),P=x,k=M}}return o&&2<o.length&&R.push(o),R}function Ja(e,t,r,n,o,i,a,s,d,l){if(Ka(e,r)&&Ka(t,n)&&Ka(o,a)&&Ka(i,s))d.push(a,s);else{var u=2/l,c=u*u,p=a-e,h=s-t,f=Math.sqrt(p*p+h*h);p/=f,h/=f;var m=r-e,g=n-t,v=o-a,y=i-s,_=m*m+g*g,b=v*v+y*y;if(_<c&&b<c)d.push(a,s);else{var S=p*m+h*g,w=-p*v-h*y;if(_-S*S<c&&0<=S&&b-w*w<c&&0<=w)d.push(a,s);else{var E=[],I=[];Lt(e,r,o,a,.5,E),Lt(t,n,i,s,.5,I),Ja(E[0],I[0],E[1],I[1],E[2],I[2],E[3],I[3],d,l),Ja(E[4],I[4],E[5],I[5],E[6],I[6],E[7],I[7],d,l)}}}}function Qa(e,t,r){var n=e[t],o=e[1-t],i=Math.abs(n/o),a=Math.ceil(Math.sqrt(i*r)),s=Math.floor(r/a);0===s&&(s=1,a=r);for(var d=[],l=0;l<a;l++)d.push(s);var u=r-a*s;if(0<u)for(l=0;l<u;l++)d[l%a]+=1;return d}function Za(e,t,r){for(var n=e.r0,o=e.r,i=e.startAngle,a=e.endAngle,s=Math.abs(a-i),d=s*o,l=o-n,u=d>Math.abs(l),c=Qa([d,l],u?0:1,t),p=(u?s:l)/c.length,h=0;h<c.length;h++)for(var f=(u?l:s)/c[h],m=0;m<c[h];m++){var g={};u?(g.startAngle=i+p*h,g.endAngle=i+p*(h+1),g.r0=n+f*m,g.r=n+f*(m+1)):(g.startAngle=i+f*m,g.endAngle=i+f*(m+1),g.r0=n+p*h,g.r=n+p*(h+1)),g.clockwise=e.clockwise,g.cx=e.cx,g.cy=e.cy,r.push(g)}}function $a(e,t,r,n){return e*n-r*t}function es(e,t,r,n,o,i,a,s){var d=r-e,l=n-t,u=a-o,c=s-i,p=$a(u,c,d,l);if(Math.abs(p)<1e-6)return null;var h=$a(e-o,t-i,u,c)/p;return h<0||1<h?null:new Un(h*d+e,h*l+t)}function ts(e,t,r){var n=new Un;Un.sub(n,r,t),n.normalize();var o=new Un;return Un.sub(o,e,t),o.dot(n)}function rs(e,t){var r=e[e.length-1];r&&r[0]===t[0]&&r[1]===t[1]||e.push(t)}function ns(e){var t=e.points,r=[],n=[];Po(t,r,n);var o=new qn(r[0],r[1],n[0]-r[0],n[1]-r[1]),i=o.width,a=o.height,s=o.x,d=o.y,l=new Un,u=new Un;return a<i?(l.x=u.x=s+i/2,l.y=d,u.y=d+a):(l.y=u.y=d+a/2,l.x=s,u.x=s+i),function(e,t,r){for(var n=e.length,o=[],i=0;i<n;i++){var a=e[i],s=e[(i+1)%n],d=es(a[0],a[1],s[0],s[1],t.x,t.y,r.x,r.y);d&&o.push({projPt:ts(d,t,r),pt:d,idx:i})}if(o.length<2)return[{points:e},{points:e}];o.sort(function(e,t){return e.projPt-t.projPt});var l=o[0],u=o[o.length-1];if(u.idx<l.idx){var c=l;l=u,u=c}var p=[l.pt.x,l.pt.y],h=[u.pt.x,u.pt.y],f=[p],m=[h];for(i=l.idx+1;i<=u.idx;i++)rs(f,e[i].slice());for(rs(f,h),rs(f,p),i=u.idx+1;i<=l.idx+n;i++)rs(m,e[i%n].slice());return rs(m,p),rs(m,h),[{points:f},{points:m}]}(t,l,u)}function os(e,t,r,n){if(1===r)n.push(t);else{var o=Math.floor(r/2),i=e(t);os(e,i[0],o,n),os(e,i[1],r-o,n)}return n}function is(e,t){var r,n=[],o=e.shape;switch(e.type){case"rect":!function(e,t,r){for(var n=e.width,o=e.height,i=o<n,a=Qa([n,o],i?0:1,t),s=i?"width":"height",d=i?"height":"width",l=i?"x":"y",u=i?"y":"x",c=e[s]/a.length,p=0;p<a.length;p++)for(var h=e[d]/a[p],f=0;f<a[p];f++){var m={};m[l]=p*c,m[u]=f*h,m[s]=c,m[d]=h,m.x+=e.x,m.y+=e.y,r.push(m)}}(o,t,n),r=Ji;break;case"sector":Za(o,t,n),r=za;break;case"circle":Za({r0:0,r:o.r,startAngle:0,endAngle:2*Math.PI,cx:o.cx,cy:o.cy},t,n),r=za;break;default:var i=e.getComputedTransform(),a=i?Math.sqrt(Math.max(i[0]*i[0]+i[1]*i[1],i[2]*i[2]+i[3]*i[3])):1,s=M(function(e,t){var r=Xa(e),n=[];t=t||1;for(var o=0;o<r.length;o++){var i=r[o],a=[],s=i[0],d=i[1];a.push(s,d);for(var l=2;l<i.length;){var u=i[l++],c=i[l++],p=i[l++],h=i[l++],f=i[l++],m=i[l++];Ja(s,d,u,c,p,h,f,m,a,t),s=f,d=m}n.push(a)}return n}(e.getUpdatedPathProxy(),a),function(e){return function(e){for(var t=[],r=0;r<e.length;)t.push([e[r++],e[r++]]);return t}(e)}),d=s.length;if(0===d)os(ns,{points:s[0]},t,n);else if(d===t)for(var l=0;l<d;l++)n.push({points:s[l]});else{var u=0,c=M(s,function(e){var t=[],r=[];Po(e,t,r);var n=(r[1]-t[1])*(r[0]-t[0]);return u+=n,{poly:e,area:n}});c.sort(function(e,t){return t.area-e.area});var p=t;for(l=0;l<d;l++){var h=c[l];if(p<=0)break;var f=l===d-1?p:Math.ceil(h.area/u*t);f<0||(os(ns,{points:h.poly},f,n),p-=f)}}r=oa}if(!r)return function(e,t){for(var r=[],n=0;n<t;n++)r.push(Bi(e));return r}(e,t);var m,g,v=[];for(l=0;l<n.length;l++){var y=new r;y.setShape(n[l]),m=e,(g=y).setStyle(m.style),g.z=m.z,g.z2=m.z2,g.zlevel=m.zlevel,v.push(y)}return v}function as(e,t){var r=e.length,n=t.length;if(r===n)return[e,t];for(var o=[],i=[],a=r<n?e:t,s=Math.min(r,n),d=Math.abs(n-r)/6,l=(s-2)/6,u=Math.ceil(d/l)+1,c=[a[0],a[1]],p=d,h=2;h<s;){var f=a[h-2],m=a[h-1],g=a[h++],v=a[h++],y=a[h++],_=a[h++],b=a[h++],S=a[h++];if(p<=0)c.push(g,v,y,_,b,S);else{for(var w=Math.min(p,u-1)+1,E=1;E<=w;E++){var I=E/w;Lt(f,g,y,b,I,o),Lt(m,v,_,S,I,i),f=o[3],m=i[3],c.push(o[1],i[1],o[2],i[2],f,m),g=o[5],v=i[5],y=o[6],_=i[6]}p-=w-1}}return a===e?[c,t]:[e,c]}function ss(e,t){for(var r=e.length,n=e[r-2],o=e[r-1],i=[],a=0;a<t.length;)i[a++]=n,i[a++]=o;return i}function ds(e,t){for(var r,n,o,i=[],a=[],s=0;s<Math.max(e.length,t.length);s++){var d=e[s],l=t[s],u=void 0,c=void 0;d?l?(n=u=(r=as(d,l))[0],o=c=r[1]):(c=ss(o||d,d),u=d):(u=ss(n||l,l),c=l),i.push(u),a.push(c)}return[i,a]}function ls(e){for(var t=0,r=0,n=0,o=e.length,i=0,a=o-2;i<o;a=i,i+=2){var s=e[a],d=e[a+1],l=e[i],u=e[i+1],c=s*u-l*d;t+=c,r+=(s+l)*c,n+=(d+u)*c}return 0===t?[e[0]||0,e[1]||0]:[r/t/3,n/t/3,t]}function us(e,t,r,n){for(var o=(e.length-2)/6,i=1/0,a=0,s=e.length,d=s-2,l=0;l<o;l++){for(var u=6*l,c=0,p=0;p<s;p+=2){var h=0===p?u:(u+p-2)%d+2,f=e[h]-r[0],m=e[h+1]-r[1],g=t[p]-n[0]-f,v=t[p+1]-n[1]-m;c+=g*g+v*v}c<i&&(i=c,a=l)}return a}function cs(e){for(var t=[],r=e.length,n=0;n<r;n+=2)t[n]=e[r-n-2],t[n+1]=e[r-n-1];return t}function ps(e){return e.__isCombineMorphing}var hs="__mOriginal_";function fs(e,t,r){var n=hs+t,o=e[n]||e[t];e[n]||(e[n]=e[t]);var i=r.replace,a=r.after,s=r.before;e[t]=function(){var e,t=arguments;return s&&s.apply(this,t),e=i?i.apply(this,t):o.apply(this,t),a&&a.apply(this,t),e}}function ms(e,t){var r=hs+t;e[r]&&(e[t]=e[r],e[r]=null)}function gs(e,t){for(var r=0;r<e.length;r++)for(var n=e[r],o=0;o<n.length;){var i=n[o],a=n[o+1];n[o++]=t[0]*i+t[2]*a+t[4],n[o++]=t[1]*i+t[3]*a+t[5]}}function vs(e,C){var t=e.getUpdatedPathProxy(),r=C.getUpdatedPathProxy(),n=ds(Xa(t),Xa(r)),o=n[0],i=n[1],a=e.getComputedTransform(),s=C.getComputedTransform();a&&gs(o,a),s&&gs(i,s),fs(C,"updateTransform",{replace:function(){this.transform=null}}),C.transform=null;var R=function(e,t,r,n){for(var o,i=[],a=0;a<e.length;a++){var s=e[a],d=t[a],l=ls(s),u=ls(d);null==o&&(o=l[2]<0!=u[2]<0);var c=[],p=[],h=0,f=1/0,m=[],g=s.length;o&&(s=cs(s));for(var v=6*us(s,d,l,u),y=g-2,_=0;_<y;_+=2){var b=(v+_)%y+2;c[_+2]=s[b]-l[0],c[_+3]=s[b+1]-l[1]}if(c[0]=s[v]-l[0],c[1]=s[v+1]-l[1],0<r)for(var S=n/r,w=-n/2;w<=n/2;w+=S){var E=Math.sin(w),I=Math.cos(w),T=0;for(_=0;_<s.length;_+=2){var C=c[_],R=c[_+1],P=d[_]-u[0],k=d[_+1]-u[1],x=P*I-k*E,M=P*E+k*I,A=(m[_]=x)-C,O=(m[_+1]=M)-R;T+=A*A+O*O}if(T<f){f=T,h=w;for(var U=0;U<m.length;U++)p[U]=m[U]}}else for(var D=0;D<g;D+=2)p[D]=d[D]-u[0],p[D+1]=d[D+1]-u[1];i.push({from:c,to:p,fromCp:l,toCp:u,rotation:-h})}return i}(o,i,10,Math.PI),P=[];fs(C,"buildPath",{replace:function(e){for(var t=C.__morphT,r=1-t,n=[],o=0;o<R.length;o++){var i=R[o],a=i.from,s=i.to,d=i.rotation*t,l=i.fromCp,u=i.toCp,c=Math.sin(d),p=Math.cos(d);Ce(n,l,u,t);for(var h=0;h<a.length;h+=2){var f=a[h],m=a[h+1],g=f*r+(b=s[h])*t,v=m*r+(S=s[h+1])*t;P[h]=g*p-v*c+n[0],P[h+1]=g*c+v*p+n[1]}var y=P[0],_=P[1];e.moveTo(y,_);for(h=2;h<a.length;){var b=P[h++],S=P[h++],w=P[h++],E=P[h++],I=P[h++],T=P[h++];y===b&&_===S&&w===I&&E===T?e.lineTo(I,T):e.bezierCurveTo(b,S,w,E,I,T),y=I,_=T}}}})}function ys(e,t,r){if(!e||!t)return t;var n=r.done,o=r.during;return vs(e,t),t.__morphT=0,t.animateTo({__morphT:1},T({during:function(e){t.dirtyShape(),o&&o(e)},done:function(){ms(t,"buildPath"),ms(t,"updateTransform"),t.__morphT=-1,t.createPathProxy(),t.dirtyShape(),n&&n()}},r)),t}function _s(r){var i=1/0,a=1/0,s=-1/0,d=-1/0;return M(M(r,function(e){var t=e.getBoundingRect(),r=e.getComputedTransform(),n=t.x+t.width/2+(r?r[4]:0),o=t.y+t.height/2+(r?r[5]:0);return i=Math.min(n,i),a=Math.min(o,a),s=Math.max(n,s),d=Math.max(o,d),[n,o]}),function(e,t){return{cp:e,z:function(e,t,r,n,o,i){e=o===r?0:Math.round(32767*(e-r)/(o-r)),t=i===n?0:Math.round(32767*(t-n)/(i-n));for(var a,s=0,d=32768;0<d;d/=2){var l=0,u=0;0<(e&d)&&(l=1),0<(t&d)&&(u=1),s+=d*d*(3*l^u),0===u&&(1===l&&(e=d-1-e,t=d-1-t),a=e,e=t,t=a)}return s}(e[0],e[1],i,a,s,d),path:r[t]}}).sort(function(e,t){return e.z-t.z}).map(function(e){return e.path})}function bs(e){return is(e.path,e.count)}var Ss=Object.freeze({__proto__:null,alignBezierCurves:ds,centroid:ls,isCombineMorphing:ps,isMorphing:function(e){return 0<=e.__morphT},morphPath:ys,combineMorph:function(t,n,e){var o=[];!function e(t){for(var r=0;r<t.length;r++){var n=t[r];ps(n)?e(n.childrenRef()):n instanceof yi&&o.push(n)}}(t);var r=o.length;if(!r)return{fromIndividuals:[],toIndividuals:[],count:0};var i=(e.dividePath||bs)({path:n,count:r});if(i.length!==r)return console.error("Invalid morphing: unmatched splitted path"),{fromIndividuals:[],toIndividuals:[],count:0};o=_s(o),i=_s(i);for(var a=e.done,s=e.during,d=e.individualDelay,l=new Mn,u=0;u<r;u++){var c=o[u],p=i[u];p.parent=n,p.copyTransform(l),d||vs(c,p)}function h(e){for(var t=0;t<i.length;t++)i[t].addSelfToZr(e)}function f(){n.__isCombineMorphing=!1,n.__morphT=-1,n.childrenRef=null,ms(n,"addSelfToZr"),ms(n,"removeSelfFromZr")}n.__isCombineMorphing=!0,n.childrenRef=function(){return i},fs(n,"addSelfToZr",{after:function(e){h(e)}}),fs(n,"removeSelfFromZr",{after:function(e){for(var t=0;t<i.length;t++)i[t].removeSelfFromZr(e)}});var m=i.length;if(d){var g=m,v=function(){0==--g&&(f(),a&&a())};for(u=0;u<m;u++){var y=d?T({delay:(e.delay||0)+d(u,m,o[u],i[u]),done:v},e):e;ys(o[u],i[u],y)}}else n.__morphT=0,n.animateTo({__morphT:1},T({during:function(e){for(var t=0;t<m;t++){var r=i[t];r.__morphT=n.__morphT,r.dirtyShape()}s&&s(e)},done:function(){f();for(var e=0;e<t.length;e++)ms(t[e],"updateTransform");a&&a()}},e));return n.__zr&&h(n.__zr),{fromIndividuals:o,toIndividuals:i,count:m}},separateMorph:function(e,t,r){var n=t.length,o=[],i=r.dividePath||bs;if(ps(e)){!function e(t){for(var r=0;r<t.length;r++){var n=t[r];ps(n)?e(n.childrenRef()):n instanceof yi&&o.push(n)}}(e.childrenRef());var a=o.length;if(a<n)for(var s=0,d=a;d<n;d++)o.push(Bi(o[s++%a]));o.length=n}else{o=i({path:e,count:n});var l=e.getComputedTransform();for(d=0;d<o.length;d++)o[d].setLocalTransform(l);if(o.length!==n)return console.error("Invalid morphing: unmatched splitted path"),{fromIndividuals:[],toIndividuals:[],count:0}}o=_s(o),t=_s(t);var u=r.individualDelay;for(d=0;d<n;d++){var c=u?T({delay:(r.delay||0)+u(d,n,o[d],t[d])},r):r;ys(o[d],t[d],c)}return{fromIndividuals:o,toIndividuals:t,count:t.length}},defaultDividePath:is}),ws=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="compound",e}return ce(e,t),e.prototype._updatePathDirty=function(){for(var e=this.shape.paths,t=this.shapeChanged(),r=0;r<e.length;r++)t=t||e[r].shapeChanged();t&&this.dirtyShape()},e.prototype.beforeBrush=function(){this._updatePathDirty();for(var e=this.shape.paths||[],t=this.getGlobalScale(),r=0;r<e.length;r++)e[r].path||e[r].createPathProxy(),e[r].path.setScale(t[0],t[1],e[r].segmentIgnoreThreshold)},e.prototype.buildPath=function(e,t){for(var r=t.paths||[],n=0;n<r.length;n++)r[n].buildPath(e,r[n].shape,!0)},e.prototype.afterBrush=function(){for(var e=this.shape.paths||[],t=0;t<e.length;t++)e[t].pathUpdated()},e.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),yi.prototype.getBoundingRect.call(this)},e}(yi),Es=[],Is=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}return ce(e,t),e.prototype.traverse=function(e,t){e.call(t,this)},e.prototype.useStyle=function(){this.style={}},e.prototype.getCursor=function(){return this._cursor},e.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},e.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},e.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},e.prototype.addDisplayable=function(e,t){t?this._temporaryDisplayables.push(e):this._displayables.push(e),this.markRedraw()},e.prototype.addDisplayables=function(e,t){t=t||!1;for(var r=0;r<e.length;r++)this.addDisplayable(e[r],t)},e.prototype.getDisplayables=function(){return this._displayables},e.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},e.prototype.eachPendingDisplayable=function(e){for(var t=this._cursor;t<this._displayables.length;t++)e&&e(this._displayables[t]);for(t=0;t<this._temporaryDisplayables.length;t++)e&&e(this._temporaryDisplayables[t])},e.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){(t=this._displayables[e]).parent=this,t.update(),t.parent=null}for(e=0;e<this._temporaryDisplayables.length;e++){var t;(t=this._temporaryDisplayables[e]).parent=this,t.update(),t.parent=null}},e.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new qn(1/0,1/0,-1/0,-1/0),t=0;t<this._displayables.length;t++){var r=this._displayables[t],n=r.getBoundingRect().clone();r.needLocalTransform()&&n.applyTransform(r.getLocalTransform(Es)),e.union(n)}this._rect=e}return this._rect},e.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t);if(this.getBoundingRect().contain(r[0],r[1]))for(var n=0;n<this._displayables.length;n++){if(this._displayables[n].contain(e,t))return!0}return!1},e}(vo),Ts=new Kt(50);function Cs(e){if("string"!=typeof e)return e;var t=Ts.get(e);return t&&t.image}function Rs(e,t,r,n,o){if(e){if("string"!=typeof e)return e;if(t&&t.__zrImageSrc===e||!r)return t;var i=Ts.get(e),a={hostEl:r,cb:n,cbPayload:o};return i?!ks(t=i.image)&&i.pending.push(a):((t=h.loadImage(e,Ps,Ps)).__zrImageSrc=e,Ts.put(e,t.__cachedImgObj={image:t,pending:[a]})),t}return t}function Ps(){var e=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var r=e.pending[t],n=r.cb;n&&n(this,r.cbPayload),r.hostEl.dirty()}e.pending.length=0}function ks(e){return e&&e.width&&e.height}var xs=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function Ms(e,t,r,n,o){if(!t)return"";var i=(e+"").split("\n");o=As(t,r,n,o);for(var a=0,s=i.length;a<s;a++)i[a]=Os(i[a],o);return i.join("\n")}function As(e,t,r,n){var o=O({},n=n||{});o.font=t,r=X(r,"..."),o.maxIterations=X(n.maxIterations,2);var i=o.minChar=X(n.minChar,0);o.cnCharWidth=Wn("国",t);var a=o.ascCharWidth=Wn("a",t);o.placeholder=X(n.placeholder,"");for(var s=e=Math.max(0,e-1),d=0;d<i&&a<=s;d++)s-=a;var l=Wn(r,t);return s<l&&(r="",l=0),s=e-l,o.ellipsis=r,o.ellipsisWidth=l,o.contentWidth=s,o.containerWidth=e,o}function Os(e,t){var r=t.containerWidth,n=t.font,o=t.contentWidth;if(!r)return"";var i=Wn(e,n);if(i<=r)return e;for(var a=0;;a++){if(i<=o||a>=t.maxIterations){e+=t.ellipsis;break}var s=0===a?Us(e,o,t.ascCharWidth,t.cnCharWidth):0<i?Math.floor(e.length*o/i):0;i=Wn(e=e.substr(0,s),n)}return""===e&&(e=t.placeholder),e}function Us(e,t,r,n){for(var o=0,i=0,a=e.length;i<a&&o<t;i++){var s=e.charCodeAt(i);o+=0<=s&&s<=127?r:n}return i}var Ds=function(){},Ls=function(e){this.tokens=[],e&&(this.tokens=e)},Hs=function(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]};function Ns(e,t,r,n,o){var i,a,s=""===t,d=o&&r.rich[o]||{},l=e.lines,u=d.font||r.font,c=!1;if(n){var p=d.padding,h=p?p[1]+p[3]:0;if(null!=d.width&&"auto"!==d.width){var f=Jn(d.width,n.width)+h;0<l.length&&f+n.accumWidth>n.width&&(i=t.split("\n"),c=!0),n.accumWidth=f}else{var m=js(t,u,n.width,n.breakAll,n.accumWidth);n.accumWidth=m.accumWidth+h,a=m.linesWidths,i=m.lines}}else i=t.split("\n");for(var g=0;g<i.length;g++){var v=i[g],y=new Ds;if(y.styleName=o,y.text=v,y.isLineHolder=!v&&!s,"number"==typeof d.width?y.width=d.width:y.width=a?a[g]:Wn(v,u),g||c)l.push(new Ls([y]));else{var _=(l[l.length-1]||(l[0]=new Ls)).tokens,b=_.length;1===b&&_[0].isLineHolder?_[0]=y:(v||!b||s)&&_.push(y)}}}var Bs=A(",&?/;] ".split(""),function(e,t){return e[t]=!0,e},{});function js(e,t,r,n,o){for(var i,a,s=[],d=[],l="",u="",c=0,p=0,h=0;h<e.length;h++){var f=e.charAt(h);if("\n"!==f){var m=Wn(f,t),g=!n&&(a=void 0,!(!(33<=(a=(i=f).charCodeAt(0))&&a<=383)||Bs[i]));(s.length?r<p+m:r<o+p+m)?p?(l||u)&&(p=g?(l||(l=u,u="",p=c=0),s.push(l),d.push(p-c),u+=f,l="",c+=m):(u&&(l+=u,u="",c=0),s.push(l),d.push(p),l=f,m)):g?(s.push(u),d.push(c),u=f,c=m):(s.push(f),d.push(m)):(p+=m,g?(u+=f,c+=m):(u&&(l+=u,u="",c=0),l+=f))}else u&&(l+=u,p+=c),s.push(l),d.push(p),u=l="",p=c=0}return s.length||l||(l=e,u="",c=0),u&&(l+=u),l&&(s.push(l),d.push(p)),1===s.length&&(p+=o),{accumWidth:p,lines:s,linesWidths:d}}var Vs={fill:"#000"},Fs={style:T({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},fo.style)},qs=function(r){function e(e){var t=r.call(this)||this;return t.type="text",t._children=[],t._defaultStyle=Vs,t.attr(e),t}return ce(e,r),e.prototype.childrenRef=function(){return this._children},e.prototype.update=function(){r.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var t=this._children[e];t.zlevel=this.zlevel,t.z=this.z,t.z2=this.z2,t.culling=this.culling,t.cursor=this.cursor,t.invisible=this.invisible}},e.prototype.updateTransform=function(){var e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):r.prototype.updateTransform.call(this)},e.prototype.getLocalTransform=function(e){var t=this.innerTransformable;return t?t.getLocalTransform(e):r.prototype.getLocalTransform.call(this,e)},e.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),r.prototype.getComputedTransform.call(this)},e.prototype._updateSubTexts=function(){var e;this._childCursor=0,Js(e=this.style),U(e.rich,Js),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},e.prototype.addSelfToZr=function(e){r.prototype.addSelfToZr.call(this,e);for(var t=0;t<this._children.length;t++)this._children[t].__zr=e},e.prototype.removeSelfFromZr=function(e){r.prototype.removeSelfFromZr.call(this,e);for(var t=0;t<this._children.length;t++)this._children[t].__zr=null},e.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var e=new qn(0,0,0,0),t=this._children,r=[],n=null,o=0;o<t.length;o++){var i=t[o],a=i.getBoundingRect(),s=i.getLocalTransform(r);s?(e.copy(a),e.applyTransform(s),(n=n||e.clone()).union(e)):(n=n||a.clone()).union(a)}this._rect=n||e}return this._rect},e.prototype.setDefaultTextStyle=function(e){this._defaultStyle=e||Vs},e.prototype.setTextContent=function(e){throw new Error("Can't attach text on another text")},e.prototype._mergeStyle=function(e,t){if(!t)return e;var r=t.rich,n=e.rich||r&&{};return O(e,t),r&&n?(this._mergeRich(n,r),e.rich=n):n&&(e.rich=n),e},e.prototype._mergeRich=function(e,t){for(var r=L(t),n=0;n<r.length;n++){var o=r[n];e[o]=e[o]||{},O(e[o],t[o])}},e.prototype.getAnimationStyleProps=function(){return Fs},e.prototype._getOrCreateChild=function(e){var t=this._children[this._childCursor];return t&&t instanceof e||(t=new e),(this._children[this._childCursor++]=t).__zr=this.__zr,t.parent=this,t},e.prototype._updatePlainTexts=function(){var e=this.style,t=e.font||x,r=e.padding,n=function(e,t){null!=e&&(e+="");var r,n=t.overflow,o=t.padding,i=t.font,a="truncate"===n,s=Xn(i),d=X(t.lineHeight,s),l=!!t.backgroundColor,u="truncate"===t.lineOverflow,c=t.width,p=(r=null==c||"break"!==n&&"breakAll"!==n?e?e.split("\n"):[]:e?js(e,t.font,c,"breakAll"===n,0).lines:[]).length*d,h=X(t.height,p);if(h<p&&u){var f=Math.floor(h/d);r=r.slice(0,f)}if(e&&a&&null!=c)for(var m=As(c,i,t.ellipsis,{minChar:t.truncateMinChar,placeholder:t.placeholder}),g=0;g<r.length;g++)r[g]=Os(r[g],m);var v=h,y=0;for(g=0;g<r.length;g++)y=Math.max(Wn(r[g],i),y);null==c&&(c=y);var _=y;return o&&(v+=o[0]+o[2],_+=o[1]+o[3],c+=o[1]+o[3]),l&&(_=c),{lines:r,height:h,outerWidth:_,outerHeight:v,lineHeight:d,calculatedLineHeight:s,contentWidth:y,contentHeight:p,width:c}}(ed(e),e),o=td(e),i=!!e.backgroundColor,a=n.outerHeight,s=n.outerWidth,d=n.contentWidth,l=n.lines,u=n.lineHeight,c=this._defaultStyle,p=e.x||0,h=e.y||0,f=e.align||c.align||"left",m=e.verticalAlign||c.verticalAlign||"top",g=p,v=Kn(h,n.contentHeight,m);if(o||r){var y=Yn(p,s,f),_=Kn(h,a,m);o&&this._renderBackground(e,e,y,_,s,a)}v+=u/2,r&&(g=$s(p,f,r),"top"===m?v+=r[0]:"bottom"===m&&(v-=r[2]));for(var b=0,S=!1,w=(Zs("fill"in e?e.fill:(S=!0,c.fill))),E=(Qs("stroke"in e?e.stroke:i||c.autoStroke&&!S?null:(b=2,c.stroke))),I=0<e.textShadowBlur,T=null!=e.width&&("truncate"===e.overflow||"break"===e.overflow||"breakAll"===e.overflow),C=n.calculatedLineHeight,R=0;R<l.length;R++){var P=this._getOrCreateChild(pa),k=P.createStyle();P.useStyle(k),k.text=l[R],k.x=g,k.y=v,f&&(k.textAlign=f),k.textBaseline="middle",k.opacity=e.opacity,k.strokeFirst=!0,I&&(k.shadowBlur=e.textShadowBlur||0,k.shadowColor=e.textShadowColor||"transparent",k.shadowOffsetX=e.textShadowOffsetX||0,k.shadowOffsetY=e.textShadowOffsetY||0),k.stroke=E,k.fill=w,E&&(k.lineWidth=e.lineWidth||b,k.lineDash=e.lineDash,k.lineDashOffset=e.lineDashOffset||0),k.font=t,Ks(k,e),v+=u,T&&P.setBoundingRect(new qn(Yn(k.x,e.width,k.textAlign),Kn(k.y,C,k.textBaseline),d,C))}},e.prototype._updateRichTexts=function(){var e=this.style,t=function(e,t){var r=new Hs;if(null!=e&&(e+=""),!e)return r;for(var n,o=t.width,i=t.height,a=t.overflow,s="break"!==a&&"breakAll"!==a||null==o?null:{width:o,accumWidth:0,breakAll:"breakAll"===a},d=xs.lastIndex=0;null!=(n=xs.exec(e));){var l=n.index;d<l&&Ns(r,e.substring(d,l),t,s),Ns(r,n[2],t,s,n[1]),d=xs.lastIndex}d<e.length&&Ns(r,e.substring(d,e.length),t,s);var u=[],c=0,p=0,h=t.padding,f="truncate"===a,m="truncate"===t.lineOverflow;function g(e,t,r){e.width=t,e.lineHeight=r,c+=r,p=Math.max(p,t)}e:for(var v=0;v<r.lines.length;v++){for(var y=r.lines[v],_=0,b=0,S=0;S<y.tokens.length;S++){var w=(A=y.tokens[S]).styleName&&t.rich[A.styleName]||{},E=A.textPadding=w.padding,I=E?E[1]+E[3]:0,T=A.font=w.font||t.font;A.contentHeight=Xn(T);var C=X(w.height,A.contentHeight);if(A.innerHeight=C,E&&(C+=E[0]+E[2]),A.height=C,A.lineHeight=J(w.lineHeight,t.lineHeight,C),A.align=w&&w.align||t.align,A.verticalAlign=w&&w.verticalAlign||"middle",m&&null!=i&&c+A.lineHeight>i){0<S?(y.tokens=y.tokens.slice(0,S),g(y,b,_),r.lines=r.lines.slice(0,v+1)):r.lines=r.lines.slice(0,v);break e}var R=w.width,P=null==R||"auto"===R;if("string"==typeof R&&"%"===R.charAt(R.length-1))A.percentWidth=R,u.push(A),A.contentWidth=Wn(A.text,T);else{if(P){var k=w.backgroundColor,x=k&&k.image;x&&ks(x=Cs(x))&&(A.width=Math.max(A.width,x.width*C/x.height))}var M=f&&null!=o?o-b:null;null!=M&&M<A.width?!P||M<I?(A.text="",A.width=A.contentWidth=0):(A.text=Ms(A.text,M-I,T,t.ellipsis,{minChar:t.truncateMinChar}),A.width=A.contentWidth=Wn(A.text,T)):A.contentWidth=Wn(A.text,T)}A.width+=I,b+=A.width,w&&(_=Math.max(_,A.lineHeight))}g(y,b,_)}for(r.outerWidth=r.width=X(o,p),r.outerHeight=r.height=X(i,c),r.contentHeight=c,r.contentWidth=p,h&&(r.outerWidth+=h[1]+h[3],r.outerHeight+=h[0]+h[2]),v=0;v<u.length;v++){var A,O=(A=u[v]).percentWidth;A.width=parseInt(O,10)/100*r.width}return r}(ed(e),e),r=t.width,n=t.outerWidth,o=t.outerHeight,i=e.padding,a=e.x||0,s=e.y||0,d=this._defaultStyle,l=e.align||d.align,u=e.verticalAlign||d.verticalAlign,c=Yn(a,n,l),p=Kn(s,o,u),h=c,f=p;i&&(h+=i[3],f+=i[0]);var m=h+r;td(e)&&this._renderBackground(e,e,c,p,n,o);for(var g=!!e.backgroundColor,v=0;v<t.lines.length;v++){for(var y=t.lines[v],_=y.tokens,b=_.length,S=y.lineHeight,w=y.width,E=0,I=h,T=m,C=b-1,R=void 0;E<b&&(!(R=_[E]).align||"left"===R.align);)this._placeToken(R,e,S,f,I,"left",g),w-=R.width,I+=R.width,E++;for(;0<=C&&"right"===(R=_[C]).align;)this._placeToken(R,e,S,f,T,"right",g),w-=R.width,T-=R.width,C--;for(I+=(r-(I-h)-(m-T)-w)/2;E<=C;)R=_[E],this._placeToken(R,e,S,f,I+R.width/2,"center",g),I+=R.width,E++;f+=S}},e.prototype._placeToken=function(e,t,r,n,o,i,a){var s=t.rich[e.styleName]||{};s.text=e.text;var d=e.verticalAlign,l=n+r/2;"top"===d?l=n+e.height/2:"bottom"===d&&(l=n+r-e.height/2),!e.isLineHolder&&td(s)&&this._renderBackground(s,t,"right"===i?o-e.width:"center"===i?o-e.width/2:o,l-e.height/2,e.width,e.height);var u=!!s.backgroundColor,c=e.textPadding;c&&(o=$s(o,i,c),l-=e.height/2-c[0]-e.innerHeight/2);var p=this._getOrCreateChild(pa),h=p.createStyle();p.useStyle(h);var f=this._defaultStyle,m=!1,g=0,v=Zs("fill"in s?s.fill:"fill"in t?t.fill:(m=!0,f.fill)),y=Qs("stroke"in s?s.stroke:"stroke"in t?t.stroke:u||a||f.autoStroke&&!m?null:(g=2,f.stroke)),_=0<s.textShadowBlur||0<t.textShadowBlur;h.text=e.text,h.x=o,h.y=l,_&&(h.shadowBlur=s.textShadowBlur||t.textShadowBlur||0,h.shadowColor=s.textShadowColor||t.textShadowColor||"transparent",h.shadowOffsetX=s.textShadowOffsetX||t.textShadowOffsetX||0,h.shadowOffsetY=s.textShadowOffsetY||t.textShadowOffsetY||0),h.textAlign=i,h.textBaseline="middle",h.font=e.font||x,h.opacity=J(s.opacity,t.opacity,1),Ks(h,s),y&&(h.lineWidth=J(s.lineWidth,t.lineWidth,g),h.lineDash=X(s.lineDash,t.lineDash),h.lineDashOffset=t.lineDashOffset||0,h.stroke=y),v&&(h.fill=v);var b=e.contentWidth,S=e.contentHeight;p.setBoundingRect(new qn(Yn(h.x,b,h.textAlign),Kn(h.y,S,h.textBaseline),b,S))},e.prototype._renderBackground=function(e,t,r,n,o,i){var a,s,d,l=e.backgroundColor,u=e.borderWidth,c=e.borderColor,p=l&&l.image,h=l&&!p,f=e.borderRadius,m=this;if(h||e.lineHeight||u&&c){(a=this._getOrCreateChild(Ji)).useStyle(a.createStyle()),a.style.fill=null;var g=a.shape;g.x=r,g.y=n,g.width=o,g.height=i,g.r=f,a.dirtyShape()}if(h)(d=a.style).fill=l||null,d.fillOpacity=X(e.fillOpacity,1);else if(p){(s=this._getOrCreateChild(qi)).onload=function(){m.dirtyStyle()};var v=s.style;v.image=l.image,v.x=r,v.y=n,v.width=o,v.height=i}u&&c&&((d=a.style).lineWidth=u,d.stroke=c,d.strokeOpacity=X(e.strokeOpacity,1),d.lineDash=e.borderDash,d.lineDashOffset=e.borderDashOffset||0,a.strokeContainThreshold=0,a.hasFill()&&a.hasStroke()&&(d.strokeFirst=!0,d.lineWidth*=2));var y=(a||s).style;y.shadowBlur=e.shadowBlur||0,y.shadowColor=e.shadowColor||"transparent",y.shadowOffsetX=e.shadowOffsetX||0,y.shadowOffsetY=e.shadowOffsetY||0,y.opacity=J(e.opacity,t.opacity,1)},e.makeFont=function(e){var t="";return Xs(e)&&(t=[e.fontStyle,e.fontWeight,Ys(e.fontSize),e.fontFamily||"sans-serif"].join(" ")),t&&ee(t)||e.textFont||e.font},e}(vo),Gs={left:!0,right:1,center:1},Ws={top:1,bottom:1,middle:1},zs=["fontStyle","fontWeight","fontSize","fontFamily"];function Ys(e){return"string"!=typeof e||-1===e.indexOf("px")&&-1===e.indexOf("rem")&&-1===e.indexOf("em")?isNaN(+e)?d+"px":e+"px":e}function Ks(e,t){for(var r=0;r<zs.length;r++){var n=zs[r],o=t[n];null!=o&&(e[n]=o)}}function Xs(e){return null!=e.fontSize||e.fontFamily||e.fontWeight}function Js(e){if(e){e.font=qs.makeFont(e);var t=e.align;"middle"===t&&(t="center"),e.align=null==t||Gs[t]?t:"left";var r=e.verticalAlign;"center"===r&&(r="middle"),e.verticalAlign=null==r||Ws[r]?r:"top",e.padding&&(e.padding=Z(e.padding))}}function Qs(e,t){return null==e||t<=0||"transparent"===e||"none"===e?null:e.image||e.colorStops?"#000":e}function Zs(e){return null==e||"none"===e?null:e.image||e.colorStops?"#000":e}function $s(e,t,r){return"right"===t?e-r[1]:"center"===t?e+r[3]/2-r[1]/2:e+r[3]}function ed(e){var t=e.text;return null!=t&&(t+=""),t}function td(e){return!!(e.backgroundColor||e.lineHeight||e.borderWidth&&e.borderColor)}var rd=function(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0},nd=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new rd},e.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=Math.max(t.r,0),i=t.startAngle,a=t.endAngle,s=t.clockwise,d=Math.cos(i),l=Math.sin(i);e.moveTo(d*o+r,l*o+n),e.arc(r,n,o,i,a,!s)},e}(yi);nd.prototype.type="arc";var od=[],id=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1};function ad(e,t,r){var n=e.cpx2,o=e.cpy2;return null!=n||null!=o?[(r?Ot:At)(e.x1,e.cpx1,e.cpx2,e.x2,t),(r?Ot:At)(e.y1,e.cpy1,e.cpy2,e.y2,t)]:[(r?Bt:Nt)(e.x1,e.cpx1,e.x2,t),(r?Bt:Nt)(e.y1,e.cpy1,e.y2,t)]}var sd=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new id},e.prototype.buildPath=function(e,t){var r=t.x1,n=t.y1,o=t.x2,i=t.y2,a=t.cpx1,s=t.cpy1,d=t.cpx2,l=t.cpy2,u=t.percent;0!==u&&(e.moveTo(r,n),null==d||null==l?(u<1&&(Vt(r,a,o,u,od),a=od[1],o=od[2],Vt(n,s,i,u,od),s=od[1],i=od[2]),e.quadraticCurveTo(a,s,o,i)):(u<1&&(Lt(r,a,d,o,u,od),a=od[1],d=od[2],o=od[3],Lt(n,s,l,i,u,od),s=od[1],l=od[2],i=od[3]),e.bezierCurveTo(a,s,d,l,o,i)))},e.prototype.pointAt=function(e){return ad(this.shape,e,!1)},e.prototype.tangentAt=function(e){var t=ad(this.shape,e,!0);return Se(t,t)},e}(yi);sd.prototype.type="bezier-curve";var dd=function(){this.cx=0,this.cy=0,this.width=0,this.height=0},ld=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new dd},e.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=t.width,i=t.height;e.moveTo(r,n+o),e.bezierCurveTo(r+o,n+o,r+3*o/2,n-o/3,r,n-i),e.bezierCurveTo(r-3*o/2,n-o/3,r-o,n+o,r,n+o),e.closePath()},e}(yi);ld.prototype.type="droplet";var ud=function(){this.cx=0,this.cy=0,this.width=0,this.height=0},cd=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new ud},e.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=t.width,i=t.height;e.moveTo(r,n),e.bezierCurveTo(r+o/2,n-2*i/3,r+2*o,n+i/3,r,n+i),e.bezierCurveTo(r-2*o,n+i/3,r-o/2,n-2*i/3,r,n)},e}(yi);cd.prototype.type="heart";var pd=Math.PI,hd=Math.sin,fd=Math.cos,md=function(){this.x=0,this.y=0,this.r=0,this.n=0},gd=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new md},e.prototype.buildPath=function(e,t){var r=t.n;if(r&&!(r<2)){var n=t.x,o=t.y,i=t.r,a=2*pd/r,s=-pd/2;e.moveTo(n+i*fd(s),o+i*hd(s));for(var d=0,l=r-1;d<l;d++)s+=a,e.lineTo(n+i*fd(s),o+i*hd(s));e.closePath()}},e}(yi);gd.prototype.type="isogon";var vd=function(){this.cx=0,this.cy=0,this.r=0,this.r0=0},yd=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new vd},e.prototype.buildPath=function(e,t){var r=t.cx,n=t.cy,o=2*Math.PI;e.moveTo(r+t.r,n),e.arc(r,n,t.r,0,o,!1),e.moveTo(r+t.r0,n),e.arc(r,n,t.r0,0,o,!0)},e}(yi);yd.prototype.type="ring";var _d=Math.sin,bd=Math.cos,Sd=Math.PI/180,wd=function(){this.cx=0,this.cy=0,this.r=[],this.k=0,this.n=1},Ed=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new wd},e.prototype.buildPath=function(e,t){var r,n,o,i=t.r,a=t.k,s=t.n,d=t.cx,l=t.cy;e.moveTo(d,l);for(var u=0,c=i.length;u<c;u++){o=i[u];for(var p=0;p<=360*s;p++)r=o*_d(a/s*p%360*Sd)*bd(p*Sd)+d,n=o*_d(a/s*p%360*Sd)*_d(p*Sd)+l,e.lineTo(r,n)}},e}(yi);Ed.prototype.type="rose";var Id=Math.PI,Td=Math.cos,Cd=Math.sin,Rd=function(){this.cx=0,this.cy=0,this.n=3,this.r=0},Pd=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultShape=function(){return new Rd},e.prototype.buildPath=function(e,t){var r=t.n;if(r&&!(r<2)){var n=t.cx,o=t.cy,i=t.r,a=t.r0;null==a&&(a=4<r?i*Td(2*Id/r)/Td(Id/r):i/3);var s=Id/r,d=-Id/2,l=n+i*Td(d),u=o+i*Cd(d);d+=s,e.moveTo(l,u);for(var c=0,p=2*r-1,h=void 0;c<p;c++)h=c%2==0?a:i,e.lineTo(n+h*Td(d),o+h*Cd(d)),d+=s;e.closePath()}},e}(yi);Pd.prototype.type="star";var kd=Math.cos,xd=Math.sin,Md=function(){this.cx=0,this.cy=0,this.r=0,this.r0=0,this.d=0,this.location="out"},Ad=function(t){function e(e){return t.call(this,e)||this}return ce(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Md},e.prototype.buildPath=function(e,t){var r,n,o,i,a=t.r,s=t.r0,d=t.d,l=t.cx,u=t.cy,c="out"===t.location?1:-1;if(!(t.location&&a<=s)){var p,h=0,f=1;for(r=(a+c*s)*kd(0)-c*d*kd(0)+l,n=(a+c*s)*xd(0)-d*xd(0)+u,e.moveTo(r,n);s*++h%(a+c*s)!=0;);for(;p=Math.PI/180*f,o=(a+c*s)*kd(p)-c*d*kd((a/s+c)*p)+l,i=(a+c*s)*xd(p)-d*xd((a/s+c)*p)+u,e.lineTo(o,i),++f<=s*h/(a+c*s)*360;);}},e}(yi);Ad.prototype.type="trochoid";var Od=function(e,t){this.image=e,this.repeat=t,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1},Ud=[0,0],Dd=[0,0],Ld=new Un,Hd=new Un,Nd=function(){function e(e,t){this._corners=[],this._axes=[],this._origin=[0,0];for(var r=0;r<4;r++)this._corners[r]=new Un;for(r=0;r<2;r++)this._axes[r]=new Un;e&&this.fromBoundingRect(e,t)}return e.prototype.fromBoundingRect=function(e,t){var r=this._corners,n=this._axes,o=e.x,i=e.y,a=o+e.width,s=i+e.height;if(r[0].set(o,i),r[1].set(a,i),r[2].set(a,s),r[3].set(o,s),t)for(var d=0;d<4;d++)r[d].transform(t);Un.sub(n[0],r[1],r[0]),Un.sub(n[1],r[3],r[0]),n[0].normalize(),n[1].normalize();for(d=0;d<2;d++)this._origin[d]=n[d].dot(r[0])},e.prototype.intersect=function(e,t){var r=!0,n=!t;return Ld.set(1/0,1/0),Hd.set(0,0),!this._intersectCheckOneSide(this,e,Ld,Hd,n,1)&&(r=!1,n)||!this._intersectCheckOneSide(e,this,Ld,Hd,n,-1)&&(r=!1,n)||n||Un.copy(t,r?Ld:Hd),r},e.prototype._intersectCheckOneSide=function(e,t,r,n,o,i){for(var a=!0,s=0;s<2;s++){var d=this._axes[s];if(this._getProjMinMaxOnAxis(s,e._corners,Ud),this._getProjMinMaxOnAxis(s,t._corners,Dd),Ud[1]<Dd[0]||Dd[1]<Ud[0]){if(a=!1,o)return a;var l=Math.abs(Dd[0]-Ud[1]),u=Math.abs(Ud[0]-Dd[1]);Math.min(l,u)>n.len()&&(l<u?Un.scale(n,d,-l*i):Un.scale(n,d,u*i))}else if(r){l=Math.abs(Dd[0]-Ud[1]),u=Math.abs(Ud[0]-Dd[1]);Math.min(l,u)<r.len()&&(l<u?Un.scale(r,d,l*i):Un.scale(r,d,-u*i))}}return a},e.prototype._getProjMinMaxOnAxis=function(e,t,r){for(var n=this._axes[e],o=this._origin,i=t[0].dot(n)+o[e],a=i,s=i,d=1;d<t.length;d++){var l=t[d].dot(n)+o[e];a=Math.min(l,a),s=Math.max(l,s)}r[0]=a,r[1]=s},e}(),Bd=function(){function e(e){var t=this.dom=document.createElement("div");for(var r in t.className="ec-debug-dirty-rect",O(e=O({},e),{backgroundColor:"rgba(0, 0, 255, 0.2)",border:"1px solid #00f"}),t.style.cssText="\nposition: absolute;\nopacity: 0;\ntransition: opacity 0.5s linear;\npointer-events: none;\n",e)e.hasOwnProperty(r)&&(t.style[r]=e[r])}return e.prototype.update=function(e){var t=this.dom.style;t.width=e.width+"px",t.height=e.height+"px",t.left=e.x+"px",t.top=e.y+"px"},e.prototype.hide=function(){this.dom.style.opacity="0"},e.prototype.show=function(e){var t=this;clearTimeout(this._hideTimeout),this.dom.style.opacity="1",this._hideTimeout=setTimeout(function(){t.hide()},e||1e3)},e}();function jd(e){return isFinite(e)}function Vd(e,t,r){for(var n,o,i,a,s,d,l,u,c,p,h,f,m,g,v,y,_="radial"===t.type?(u=e,c=t,h=(p=r).width,f=p.height,m=Math.min(h,f),g=null==c.x?.5:c.x,v=null==c.y?.5:c.y,y=null==c.r?.5:c.r,c.global||(g=g*h+p.x,v=v*f+p.y,y*=m),g=jd(g)?g:.5,v=jd(v)?v:.5,y=0<=y&&jd(y)?y:.5,u.createRadialGradient(g,v,0,g,v,y)):(n=e,i=r,a=null==(o=t).x?0:o.x,s=null==o.x2?1:o.x2,d=null==o.y?0:o.y,l=null==o.y2?0:o.y2,o.global||(a=a*i.width+i.x,s=s*i.width+i.x,d=d*i.height+i.y,l=l*i.height+i.y),a=jd(a)?a:0,s=jd(s)?s:1,d=jd(d)?d:0,l=jd(l)?l:0,n.createLinearGradient(a,d,s,l)),b=t.colorStops,S=0;S<b.length;S++)_.addColorStop(b[S].offset,b[S].color);return _}function Fd(e){return parseInt(e,10)}function qd(e,t,r){var n=["width","height"][t],o=["clientWidth","clientHeight"][t],i=["paddingLeft","paddingTop"][t],a=["paddingRight","paddingBottom"][t];if(null!=r[n]&&"auto"!==r[n])return parseFloat(r[n]);var s=document.defaultView.getComputedStyle(e);return(e[o]||Fd(s[n])||Fd(e.style[n]))-(Fd(s[i])||0)-(Fd(s[a])||0)|0}function Gd(e){var t,r,n=e.style,o=n.lineDash&&0<n.lineWidth&&(t=n.lineDash,r=n.lineWidth,t&&"solid"!==t&&0<r?"dashed"===t?[4*r,2*r]:"dotted"===t?[r]:j(t)?[t]:K(t)?t:null:null),i=n.lineDashOffset;if(o){var a=n.strokeNoScale&&e.getLineScale?e.getLineScale():1;a&&1!==a&&(o=M(o,function(e){return e/a}),i/=a)}return[o,i]}var Wd=new Qo(!0);function zd(e){var t=e.stroke;return!(null==t||"none"===t||!(0<e.lineWidth))}function Yd(e){return"string"==typeof e&&"none"!==e}function Kd(e){var t=e.fill;return null!=t&&"none"!==t}function Xd(e,t){if(null!=t.fillOpacity&&1!==t.fillOpacity){var r=e.globalAlpha;e.globalAlpha=t.fillOpacity*t.opacity,e.fill(),e.globalAlpha=r}else e.fill()}function Jd(e,t){if(null!=t.strokeOpacity&&1!==t.strokeOpacity){var r=e.globalAlpha;e.globalAlpha=t.strokeOpacity*t.opacity,e.stroke(),e.globalAlpha=r}else e.stroke()}function Qd(e,t,r){var n=Rs(t.image,t.__image,r);if(ks(n)){var o=e.createPattern(n,t.repeat||"repeat");if("function"==typeof DOMMatrix&&o&&o.setTransform){var i=new DOMMatrix;i.translateSelf(t.x||0,t.y||0),i.rotateSelf(0,0,(t.rotation||0)*de),i.scaleSelf(t.scaleX||1,t.scaleY||1),o.setTransform(i)}return o}}var Zd=["shadowBlur","shadowOffsetX","shadowOffsetY"],$d=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function el(e,t,r,n,o){var i=!1;if(!n&&t===(r=r||{}))return!1;if(n||t.opacity!==r.opacity){sl(e,o),i=!0;var a=Math.max(Math.min(t.opacity,1),0);e.globalAlpha=isNaN(a)?ho.opacity:a}(n||t.blend!==r.blend)&&(i||(sl(e,o),i=!0),e.globalCompositeOperation=t.blend||ho.blend);for(var s=0;s<Zd.length;s++){var d=Zd[s];(n||t[d]!==r[d])&&(i||(sl(e,o),i=!0),e[d]=e.dpr*(t[d]||0))}return(n||t.shadowColor!==r.shadowColor)&&(i||(sl(e,o),i=!0),e.shadowColor=t.shadowColor||ho.shadowColor),i}function tl(e,t,r,n,o){var i=dl(t,o.inHover),a=n?null:r&&dl(r,o.inHover)||{};if(i===a)return!1;var s=el(e,i,a,n,o);if((n||i.fill!==a.fill)&&(s||(sl(e,o),s=!0),Yd(i.fill)&&(e.fillStyle=i.fill)),(n||i.stroke!==a.stroke)&&(s||(sl(e,o),s=!0),Yd(i.stroke)&&(e.strokeStyle=i.stroke)),(n||i.opacity!==a.opacity)&&(s||(sl(e,o),s=!0),e.globalAlpha=null==i.opacity?1:i.opacity),t.hasStroke()){var d=i.lineWidth/(i.strokeNoScale&&t.getLineScale?t.getLineScale():1);e.lineWidth!==d&&(s||(sl(e,o),s=!0),e.lineWidth=d)}for(var l=0;l<$d.length;l++){var u=$d[l],c=u[0];(n||i[c]!==a[c])&&(s||(sl(e,o),s=!0),e[c]=i[c]||u[1])}return s}function rl(e,t){var r=t.transform,n=e.dpr||1;r?e.setTransform(n*r[0],n*r[1],n*r[2],n*r[3],n*r[4],n*r[5]):e.setTransform(n,0,0,n,0,0)}var nl=1,ol=2,il=3,al=4;function sl(e,t){t.batchFill&&e.fill(),t.batchStroke&&e.stroke(),t.batchFill="",t.batchStroke=""}function dl(e,t){return t&&e.__hoverStyle||e.style}function ll(e,t,r,n){var o=t.transform;if(!t.shouldBePainted(r.viewWidth,r.viewHeight,!1,!1))return t.__dirty&=~ht,void(t.__isRendered=!1);var i=t.__clipPaths,a=r.prevElClipPaths,s=!1,d=!1;if(a&&!function(e,t){if(e===t||!e&&!t)return!1;if(!e||!t||e.length!==t.length)return!0;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!0;return!1}(i,a)||(a&&a.length&&(sl(e,r),e.restore(),d=s=!0,r.prevElClipPaths=null,r.allClipped=!1,r.prevEl=null),i&&i.length&&(sl(e,r),e.save(),function(e,t,r){for(var n=!1,o=0;o<e.length;o++){var i=e[o];n=n||i.isZeroArea(),rl(t,i),t.beginPath(),i.buildPath(t,i.shape),t.clip()}r.allClipped=n}(i,e,r),s=!0),r.prevElClipPaths=i),r.allClipped)t.__isRendered=!1;else{t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush();var l=r.prevEl;l||(d=s=!0);var u,c,p,h,f,m=t instanceof yi&&t.autoBatch&&(u=t.style,c=Kd(u),p=zd(u),!(u.lineDash||!(+c^+p)||c&&"string"!=typeof u.fill||p&&"string"!=typeof u.stroke||u.strokePercent<1||u.strokeOpacity<1||u.fillOpacity<1));s||(h=o,f=l.transform,h&&f?h[0]!==f[0]||h[1]!==f[1]||h[2]!==f[2]||h[3]!==f[3]||h[4]!==f[4]||h[5]!==f[5]:h||f)?(sl(e,r),rl(e,t)):m||sl(e,r);var g,v,y,_=dl(t,r.inHover);t instanceof yi?(r.lastDrawType!==nl&&(d=!0,r.lastDrawType=nl),tl(e,t,l,d,r),m&&(r.batchFill||r.batchStroke)||e.beginPath(),function(e,t,r,n){var o,i=zd(r),a=Kd(r),s=r.strokePercent,d=s<1,l=!t.path;t.silent&&!d||!l||t.createPathProxy();var u=t.path||Wd,c=t.__dirty;if(!n){var p=r.fill,h=r.stroke,f=a&&!!p.colorStops,m=i&&!!h.colorStops,g=a&&!!p.image,v=i&&!!h.image,y=void 0,_=void 0,b=void 0,S=void 0,w=void 0;(f||m)&&(w=t.getBoundingRect()),f&&(y=c?Vd(e,p,w):t.__canvasFillGradient,t.__canvasFillGradient=y),m&&(_=c?Vd(e,h,w):t.__canvasStrokeGradient,t.__canvasStrokeGradient=_),g&&(b=c||!t.__canvasFillPattern?Qd(e,p,t):t.__canvasFillPattern,t.__canvasFillPattern=b),v&&(S=c||!t.__canvasStrokePattern?Qd(e,h,t):t.__canvasStrokePattern,t.__canvasStrokePattern=b),f?e.fillStyle=y:g&&(b?e.fillStyle=b:a=!1),m?e.strokeStyle=_:v&&(S?e.strokeStyle=S:i=!1)}var E,I,T=t.getGlobalScale();u.setScale(T[0],T[1],t.segmentIgnoreThreshold),e.setLineDash&&r.lineDash&&(E=(o=Gd(t))[0],I=o[1]);var C=!0;(l||c&ft)&&(u.setDPR(e.dpr),d?u.setContext(null):(u.setContext(e),C=!1),u.reset(),t.buildPath(u,t.shape,n),u.toStatic(),t.pathUpdated()),C&&u.rebuildPath(e,d?s:1),E&&(e.setLineDash(E),e.lineDashOffset=I),n||(r.strokeFirst?(i&&Jd(e,r),a&&Xd(e,r)):(a&&Xd(e,r),i&&Jd(e,r))),E&&e.setLineDash([])}(e,t,_,m),m&&(r.batchFill=_.fill||"",r.batchStroke=_.stroke||"")):t instanceof pa?(r.lastDrawType!==il&&(d=!0,r.lastDrawType=il),tl(e,t,l,d,r),function(e,t,r){var n,o=r.text;if(null!=o&&(o+=""),o){e.font=r.font||x,e.textAlign=r.textAlign,e.textBaseline=r.textBaseline;var i=void 0,a=void 0;e.setLineDash&&r.lineDash&&(i=(n=Gd(t))[0],a=n[1]),i&&(e.setLineDash(i),e.lineDashOffset=a),r.strokeFirst?(zd(r)&&e.strokeText(o,r.x,r.y),Kd(r)&&e.fillText(o,r.x,r.y)):(Kd(r)&&e.fillText(o,r.x,r.y),zd(r)&&e.strokeText(o,r.x,r.y)),i&&e.setLineDash([])}}(e,t,_)):t instanceof qi?(r.lastDrawType!==ol&&(d=!0,r.lastDrawType=ol),g=l,v=d,el(e,dl(t,(y=r).inHover),g&&dl(g,y.inHover),v,y),function(e,t,r){var n=t.__image=Rs(r.image,t.__image,t,t.onload);if(n&&ks(n)){var o=r.x||0,i=r.y||0,a=t.getWidth(),s=t.getHeight(),d=n.width/n.height;if(null==a&&null!=s?a=s*d:null==s&&null!=a?s=a/d:null==a&&null==s&&(a=n.width,s=n.height),r.sWidth&&r.sHeight){var l=r.sx||0,u=r.sy||0;e.drawImage(n,l,u,r.sWidth,r.sHeight,o,i,a,s)}else if(r.sx&&r.sy){var c=a-(l=r.sx),p=s-(u=r.sy);e.drawImage(n,l,u,c,p,o,i,a,s)}else e.drawImage(n,o,i,a,s)}}(e,t,_)):t.getTemporalDisplayables&&(r.lastDrawType!==al&&(d=!0,r.lastDrawType=al),function(e,t,r){var n=t.getDisplayables(),o=t.getTemporalDisplayables();e.save();var i,a,s={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:r.viewWidth,viewHeight:r.viewHeight,inHover:r.inHover};for(i=t.getCursor(),a=n.length;i<a;i++){var d=n[i];d.beforeBrush&&d.beforeBrush(),d.innerBeforeBrush(),ll(e,d,s,i===a-1),d.innerAfterBrush(),d.afterBrush&&d.afterBrush(),s.prevEl=d}for(var l=0,u=o.length;l<u;l++){var d=o[l];d.beforeBrush&&d.beforeBrush(),d.innerBeforeBrush(),ll(e,d,s,l===u-1),d.innerAfterBrush(),d.afterBrush&&d.afterBrush(),s.prevEl=d}t.clearTemporalDisplayables(),t.notClear=!0,e.restore()}(e,t,r)),m&&n&&sl(e,r),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),(r.prevEl=t).__dirty=0,t.__isRendered=!0}}function ul(e,t,r){var n=h.createCanvas(),o=t.getWidth(),i=t.getHeight(),a=n.style;return a&&(a.position="absolute",a.left="0",a.top="0",a.width=o+"px",a.height=i+"px",n.setAttribute("data-zr-dom-id",e)),n.width=o*r,n.height=i*r,n}var cl=function(a){function e(e,t,r){var n,o=a.call(this)||this;o.motionBlur=!1,o.lastFrameAlpha=.7,o.dpr=1,o.virtual=!1,o.config={},o.incremental=!1,o.zlevel=0,o.maxRepaintRectCount=5,o.__dirty=!0,o.__firstTimePaint=!0,o.__used=!1,o.__drawIndex=0,o.__startIndex=0,o.__endIndex=0,o.__prevStartIndex=null,o.__prevEndIndex=null,r=r||hn,"string"==typeof e?n=ul(e,t,r):V(e)&&(e=(n=e).id),o.id=e;var i=(o.dom=n).style;return i&&(ie(n),n.onselectstart=function(){return!1},i.padding="0",i.margin="0",i.borderWidth="0"),o.painter=t,o.dpr=r,o}return ce(e,a),e.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},e.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},e.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},e.prototype.setUnpainted=function(){this.__firstTimePaint=!0},e.prototype.createBackBuffer=function(){var e=this.dpr;this.domBack=ul("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),1!==e&&this.ctxBack.scale(e,e)},e.prototype.createRepaintRects=function(e,t,r,n){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var o,c=[],p=this.maxRepaintRectCount,h=!1,f=new qn(0,0,0,0);function i(e){if(e.isFinite()&&!e.isZero())if(0===c.length){(t=new qn(0,0,0,0)).copy(e),c.push(t)}else{for(var t,r=!1,n=1/0,o=0,i=0;i<c.length;++i){var a=c[i];if(a.intersect(e)){var s=new qn(0,0,0,0);s.copy(a),s.union(e),c[i]=s,r=!0;break}if(h){f.copy(e),f.union(a);var d=e.width*e.height,l=a.width*a.height,u=f.width*f.height-d-l;u<n&&(n=u,o=i)}}if(h&&(c[o].union(e),r=!0),!r)(t=new qn(0,0,0,0)).copy(e),c.push(t);h||(h=c.length>=p)}}for(var a=this.__startIndex;a<this.__endIndex;++a){if(l=e[a]){var s=l.shouldBePainted(r,n,!0,!0);(u=l.__isRendered&&(l.__dirty&ht||!s)?l.getPrevPaintRect():null)&&i(u);var d=s&&(l.__dirty&ht||!l.__isRendered)?l.getPaintRect():null;d&&i(d)}}for(a=this.__prevStartIndex;a<this.__prevEndIndex;++a){var l,u;s=(l=t[a]).shouldBePainted(r,n,!0,!0);if(l&&(!s||!l.__zr)&&l.__isRendered)(u=l.getPrevPaintRect())&&i(u)}do{o=!1;for(a=0;a<c.length;)if(c[a].isZero())c.splice(a,1);else{for(var m=a+1;m<c.length;)c[a].intersect(c[m])?(o=!0,c[a].union(c[m]),c.splice(m,1)):m++;a++}}while(o);return this._paintRects=c},e.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},e.prototype.resize=function(e,t){var r=this.dpr,n=this.dom,o=n.style,i=this.domBack;o&&(o.width=e+"px",o.height=t+"px"),n.width=e*r,n.height=t*r,i&&(i.width=e*r,i.height=t*r,1!==r&&this.ctxBack.scale(r,r))},e.prototype.clear=function(e,i,t){var r=this.dom,a=this.ctx,n=r.width,o=r.height;i=i||this.clearColor;var s=this.motionBlur&&!e,d=this.lastFrameAlpha,l=this.dpr,u=this;s&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(r,0,0,n/l,o/l));var c=this.domBack;function p(e,t,r,n){if(a.clearRect(e,t,r,n),i&&"transparent"!==i){var o=void 0;W(i)?(o=i.__canvasGradient||Vd(a,i,{x:0,y:0,width:r,height:n}),i.__canvasGradient=o):z(i)&&(o=Qd(a,i,{dirty:function(){u.setUnpainted(),u.__painter.refresh()}})),a.save(),a.fillStyle=o||i,a.fillRect(e,t,r,n),a.restore()}s&&(a.save(),a.globalAlpha=d,a.drawImage(c,e,t,r,n),a.restore())}!t||s?p(0,0,n,o):t.length&&U(t,function(e){p(e.x*l,e.y*l,e.width*l,e.height*l)})},e}(Oe),pl=314159;var hl=function(){function e(e,t,r,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var o=!e.nodeName||"CANVAS"===e.nodeName.toUpperCase();this._opts=r=O({},r||{}),this.dpr=r.devicePixelRatio||hn,this._singleCanvas=o,(this.root=e).style&&(ie(e),e.innerHTML=""),this.storage=t;var i=this._zlevelList;this._prevDisplayList=[];var a,s,d,l=this._layers;if(o){var u=e,c=u.width,p=u.height;null!=r.width&&(c=r.width),null!=r.height&&(p=r.height),this.dpr=r.devicePixelRatio||1,u.width=c*this.dpr,u.height=p*this.dpr,this._width=c,this._height=p;var h=new cl(u,this,this.dpr);h.__builtin__=!0,h.initContext(),(l[pl]=h).zlevel=pl,i.push(pl),this._domRoot=e}else{this._width=qd(e,0,r),this._height=qd(e,1,r);var f=this._domRoot=(a=this._width,s=this._height,(d=document.createElement("div")).style.cssText=["position:relative","width:"+a+"px","height:"+s+"px","padding:0","margin:0","border-width:0"].join(";")+";",d);e.appendChild(f)}}return e.prototype.getType=function(){return"canvas"},e.prototype.isSingleCanvas=function(){return this._singleCanvas},e.prototype.getViewportRoot=function(){return this._domRoot},e.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},e.prototype.refresh=function(e){var t=this.storage.getDisplayList(!0),r=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(t,r,e,this._redrawId);for(var o=0;o<n.length;o++){var i=n[o],a=this._layers[i];if(!a.__builtin__&&a.refresh){var s=0===o?this._backgroundColor:null;a.refresh(s)}}return this._opts.useDirtyRect&&(this._prevDisplayList=t.slice()),this},e.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},e.prototype._paintHoverList=function(e){var t=e.length,r=this._hoverlayer;if(r&&r.clear(),t){for(var n,o={inHover:!0,viewWidth:this._width,viewHeight:this._height},i=0;i<t;i++){var a=e[i];a.__inHover&&(r||(r=this._hoverlayer=this.getLayer(1e5)),n||(n=r.ctx).save(),ll(n,a,o,i===t-1))}n&&n.restore()}},e.prototype.getHoverLayer=function(){return this.getLayer(1e5)},e.prototype.paintOne=function(e,t){ll(e,t,{inHover:!1,viewWidth:0,viewHeight:0},!0)},e.prototype._paintList=function(e,t,r,n){if(this._redrawId===n){r=r||!1,this._updateLayerStatus(e);var o=this._doPaintList(e,t,r),i=o.finished,a=o.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),a&&this._paintHoverList(e),i)this.eachLayer(function(e){e.afterBrush&&e.afterBrush()});else{var s=this;_t(function(){s._paintList(e,t,r,n)})}}},e.prototype._compositeManually=function(){var t=this.getLayer(pl).ctx,r=this._domRoot.width,n=this._domRoot.height;t.clearRect(0,0,r,n),this.eachBuiltinLayer(function(e){e.virtual&&t.drawImage(e.dom,0,0,r,n)})},e.prototype._doPaintList=function(f,m,g){for(var v=this,y=[],_=this._opts.useDirtyRect,e=0;e<this._zlevelList.length;e++){var t=this._zlevelList[e],r=this._layers[t];r.__builtin__&&r!==this._hoverlayer&&(r.__dirty||g)&&y.push(r)}for(var b=!0,S=!1,n=function(e){var n,o=y[e],i=o.ctx,t=_&&o.createRepaintRects(f,m,w._width,w._height),a=g?o.__startIndex:o.__drawIndex,s=!g&&o.incremental&&Date.now,d=s&&Date.now(),r=o.zlevel===w._zlevelList[0]?w._backgroundColor:null;if(o.__startIndex===o.__endIndex)o.clear(!1,r,t);else if(a===o.__startIndex){var l=f[a];l.incremental&&l.notClear&&!g||o.clear(!1,r,t)}-1===a&&(console.error("For some unknown reason. drawIndex is -1"),a=o.__startIndex);var u=function(e){var t={inHover:!1,allClipped:!1,prevEl:null,viewWidth:v._width,viewHeight:v._height};for(n=a;n<o.__endIndex;n++){var r=f[n];if(r.__inHover&&(S=!0),v._doPaintEl(r,o,_,e,t,n===o.__endIndex-1),s)if(15<Date.now()-d)break}t.prevElClipPaths&&i.restore()};if(t)if(0===t.length)n=o.__endIndex;else for(var c=w.dpr,p=0;p<t.length;++p){var h=t[p];i.save(),i.beginPath(),i.rect(h.x*c,h.y*c,h.width*c,h.height*c),i.clip(),u(h),i.restore()}else i.save(),u(),i.restore();o.__drawIndex=n,o.__drawIndex<o.__endIndex&&(b=!1)},w=this,o=0;o<y.length;o++)n(o);return l.wxa&&U(this._layers,function(e){e&&e.ctx&&e.ctx.draw&&e.ctx.draw()}),{finished:b,needsRefreshHover:S}},e.prototype._doPaintEl=function(e,t,r,n,o,i){var a=t.ctx;if(r){var s=e.getPaintRect();(!n||s&&s.intersect(n))&&(ll(a,e,o,i),e.setPrevPaintRect(s))}else ll(a,e,o,i)},e.prototype.getLayer=function(e,t){this._singleCanvas&&!this._needsManuallyCompositing&&(e=pl);var r=this._layers[e];return r||((r=new cl("zr_"+e,this,this.dpr)).zlevel=e,r.__builtin__=!0,this._layerConfig[e]?I(r,this._layerConfig[e],!0):this._layerConfig[e-.01]&&I(r,this._layerConfig[e-.01],!0),t&&(r.virtual=t),this.insertLayer(e,r),r.initContext()),r},e.prototype.insertLayer=function(e,t){var r=this._layers,n=this._zlevelList,o=n.length,i=this._domRoot,a=null,s=-1;if(r[e])w("ZLevel "+e+" has been used already");else if((d=t)&&(d.__builtin__||"function"==typeof d.resize&&"function"==typeof d.refresh)){var d;if(0<o&&e>n[0]){for(s=0;s<o-1&&!(n[s]<e&&n[s+1]>e);s++);a=r[n[s]]}if(n.splice(s+1,0,e),!(r[e]=t).virtual)if(a){var l=a.dom;l.nextSibling?i.insertBefore(t.dom,l.nextSibling):i.appendChild(t.dom)}else i.firstChild?i.insertBefore(t.dom,i.firstChild):i.appendChild(t.dom);t.__painter=this}else w("Layer of zlevel "+e+" is not valid")},e.prototype.eachLayer=function(e,t){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n];e.call(t,this._layers[o],o)}},e.prototype.eachBuiltinLayer=function(e,t){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],i=this._layers[o];i.__builtin__&&e.call(t,i,o)}},e.prototype.eachOtherLayer=function(e,t){for(var r=this._zlevelList,n=0;n<r.length;n++){var o=r[n],i=this._layers[o];i.__builtin__||e.call(t,i,o)}},e.prototype.getLayers=function(){return this._layers},e.prototype._updateLayerStatus=function(e){function t(e){i&&(i.__endIndex!==e&&(i.__dirty=!0),i.__endIndex=e)}if(this.eachBuiltinLayer(function(e,t){e.__dirty=e.__used=!1}),this._singleCanvas)for(var r=1;r<e.length;r++){if((s=e[r]).zlevel!==e[r-1].zlevel||s.incremental){this._needsManuallyCompositing=!0;break}}var n,o,i=null,a=0;for(o=0;o<e.length;o++){var s,d=(s=e[o]).zlevel,l=void 0;n!==d&&(n=d,a=0),s.incremental?((l=this.getLayer(d+.001,this._needsManuallyCompositing)).incremental=!0,a=1):l=this.getLayer(d+(0<a?.01:0),this._needsManuallyCompositing),l.__builtin__||w("ZLevel "+d+" has been used by unkown layer "+l.id),l!==i&&(l.__used=!0,l.__startIndex!==o&&(l.__dirty=!0),l.__startIndex=o,l.incremental?l.__drawIndex=-1:l.__drawIndex=o,t(o),i=l),s.__dirty&ht&&!s.__inHover&&(l.__dirty=!0,l.incremental&&l.__drawIndex<0&&(l.__drawIndex=o))}t(o),this.eachBuiltinLayer(function(e,t){!e.__used&&0<e.getElementCount()&&(e.__dirty=!0,e.__startIndex=e.__endIndex=e.__drawIndex=0),e.__dirty&&e.__drawIndex<0&&(e.__drawIndex=e.__startIndex)})},e.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},e.prototype._clearLayer=function(e){e.clear()},e.prototype.setBackgroundColor=function(e){this._backgroundColor=e,U(this._layers,function(e){e.setUnpainted()})},e.prototype.configLayer=function(e,t){if(t){var r=this._layerConfig;r[e]?I(r[e],t,!0):r[e]=t;for(var n=0;n<this._zlevelList.length;n++){var o=this._zlevelList[n];if(o===e||o===e+.01)I(this._layers[o],r[e],!0)}}},e.prototype.delLayer=function(e){var t=this._layers,r=this._zlevelList,n=t[e];n&&(n.dom.parentNode.removeChild(n.dom),delete t[e],r.splice(P(r,e),1))},e.prototype.resize=function(e,t){if(this._domRoot.style){var r=this._domRoot;r.style.display="none";var n=this._opts,o=this.root;if(null!=e&&(n.width=e),null!=t&&(n.height=t),e=qd(o,0,n),t=qd(o,1,n),r.style.display="",this._width!==e||t!==this._height){for(var i in r.style.width=e+"px",r.style.height=t+"px",this._layers)this._layers.hasOwnProperty(i)&&this._layers[i].resize(e,t);this.refresh(!0)}this._width=e,this._height=t}else{if(null==e||null==t)return;this._width=e,this._height=t,this.getLayer(pl).resize(e,t)}return this},e.prototype.clearLayer=function(e){var t=this._layers[e];t&&t.clear()},e.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},e.prototype.getRenderedCanvas=function(e){if(e=e||{},this._singleCanvas&&!this._compositeManually)return this._layers[pl].dom;var t=new cl("image",this,e.pixelRatio||this.dpr);t.initContext(),t.clear(!1,e.backgroundColor||this._backgroundColor);var r=t.ctx;if(e.pixelRatio<=this.dpr){this.refresh();var n=t.dom.width,o=t.dom.height;this.eachLayer(function(e){e.__builtin__?r.drawImage(e.dom,0,0,n,o):e.renderToCanvas&&(r.save(),e.renderToCanvas(r),r.restore())})}else for(var i={inHover:!1,viewWidth:this._width,viewHeight:this._height},a=this.storage.getDisplayList(!0),s=0,d=a.length;s<d;s++){var l=a[s];ll(r,l,i,s===d-1)}return t.dom},e.prototype.getWidth=function(){return this._width},e.prototype.getHeight=function(){return this._height},e}(),fl=Math.sin,ml=Math.cos,gl=Math.PI,vl=2*Math.PI,yl=180/gl,_l=function(){function e(){}return e.prototype.reset=function(e){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,e||4)},e.prototype.moveTo=function(e,t){this._add("M",e,t)},e.prototype.lineTo=function(e,t){this._add("L",e,t)},e.prototype.bezierCurveTo=function(e,t,r,n,o,i){this._add("C",e,t,r,n,o,i)},e.prototype.quadraticCurveTo=function(e,t,r,n){this._add("Q",e,t,r,n)},e.prototype.arc=function(e,t,r,n,o,i){this.ellipse(e,t,r,r,0,n,o,i)},e.prototype.ellipse=function(e,t,r,n,o,i,a,s){var d=a-i,l=!s,u=Math.abs(d),c=_r(u-vl)||(l?vl<=d:vl<=-d),p=0<d?d%vl:d%vl+vl,h=!1;h=!!c||!_r(u)&&gl<=p==!!l;var f=e+r*ml(i),m=t+n*fl(i);this._start&&this._add("M",f,m);var g=Math.round(o*yl);if(c){var v=1/this._p,y=(l?1:-1)*(vl-v);this._add("A",r,n,g,1,+l,e+r*ml(i+y),t+n*fl(i+y)),.01<v&&this._add("A",r,n,g,0,+l,f,m)}else{var _=e+r*ml(a),b=t+n*fl(a);this._add("A",r,n,g,+h,+l,_,b)}},e.prototype.rect=function(e,t,r,n){this._add("M",e,t),this._add("l",r,0),this._add("l",0,n),this._add("l",-r,0),this._add("Z")},e.prototype.closePath=function(){0<this._d.length&&this._add("Z")},e.prototype._add=function(e,t,r,n,o,i,a,s,d){for(var l=[],u=this._p,c=1;c<arguments.length;c++){var p=arguments[c];if(isNaN(p))return void(this._invalid=!0);l.push(Math.round(p*u)/u)}this._d.push(e+l.join(" ")),this._start="Z"===e},e.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},e.prototype.getStr=function(){return this._str},e}(),bl="none",Sl=Math.round;var wl=["lineCap","miterLimit","lineJoin"],El=M(wl,function(e){return"stroke-"+e.toLowerCase()});function Il(e,t,r,n){var o=null==t.opacity?1:t.opacity;if(r instanceof qi)e("opacity",o);else{if(null!=(s=t.fill)&&s!==bl){var i=vr(t.fill);e("fill",i.color);var a=null!=t.fillOpacity?t.fillOpacity*i.opacity*o:i.opacity*o;(n||a<1)&&e("fill-opacity",a)}else e("fill",bl);var s,d;if(null!=(d=t.stroke)&&d!==bl){var l=vr(t.stroke);e("stroke",l.color);var u=t.strokeNoScale?r.getLineScale():1,c=u?(t.lineWidth||0)/u:0,p=null!=t.strokeOpacity?t.strokeOpacity*l.opacity*o:l.opacity*o,h=t.strokeFirst;if((n||1!==c)&&e("stroke-width",c),(n||h)&&e("paint-order",h?"stroke":"fill"),(n||p<1)&&e("stroke-opacity",p),t.lineDash){var f=Gd(r),m=f[0],g=f[1];m&&(g=Sl(g||0),e("stroke-dasharray",m.join(",")),(g||n)&&e("stroke-dashoffset",g))}else n&&e("stroke-dasharray",bl);for(var v=0;v<wl.length;v++){var y=wl[v];if(n||t[y]!==mi[y]){var _=t[y]||mi[y];_&&e(El[v],_)}}}else n&&e("stroke",bl)}}var Tl="http://www.w3.org/2000/svg",Cl="http://www.w3.org/1999/xlink",Rl="http://www.w3.org/2000/xmlns/",Pl="http://www.w3.org/XML/1998/namespace";function kl(e){return document.createElementNS(Tl,e)}function xl(e,t,r,n,o){return{tag:e,attrs:r||{},children:n,text:o,key:t}}function Ml(e,t){var o=(t=t||{}).newline?"\n":"";return function t(e){var r=e.children,n=e.tag;return function(e,t){var r=[];if(t)for(var n in t){var o=t[n],i=n;!1!==o&&(!0!==o&&null!=o&&(i+='="'+o+'"'),r.push(i))}return"<"+e+" "+r.join(" ")+">"}(n,e.attrs)+(e.text||"")+(r?""+o+M(r,function(e){return t(e)}).join(o)+o:"")+"</"+n+">"}(e)}function Al(e){return{zrId:e,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssClassIdx:0,cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function Ol(e,t,r,n){return xl("svg","root",{width:e,height:t,xmlns:Tl,"xmlns:xlink":Cl,version:"1.1",baseProfile:"full",viewBox:!!n&&"0 0 "+e+" "+t},r)}var Ul={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Dl="transform-origin";function Ll(e,t,r){var n=O({},e.shape);O(n,t),e.buildPath(r,n);var o=new _l;return o.reset(Rr(e)),r.rebuildPath(o,1),o.generateStr(),o.getStr()}var Hl={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function Nl(e,t){var r=t.zrId+"-ani-"+t.cssAnimIdx++;return t.cssAnims[r]=e,r}function Bl(e){return B(e)?Ul[e]?"cubic-bezier("+Ul[e]+")":Gt(e)?e:"":""}function jl(k,x,M,A){var e=k.animators,t=e.length,r=[];if(k instanceof ws){if(p=function(e,t,c){var p,h,r=e.shape.paths,f={};if(U(r,function(e){var t=Al(c.zrId);t.animation=!0,jl(e,{},t,!0);var r=t.cssAnims,n=t.cssNodes,o=L(r),i=o.length;if(i){var a=r[h=o[i-1]];for(var s in a){var d=a[s];f[s]=f[s]||{d:""},f[s].d+=d.d||""}for(var l in n){var u=n[l].animation;0<=u.indexOf(h)&&(p=u)}}}),p){t.d=!1;var n=Nl(f,c);return p.replace(h,n)}}(k,x,M))r.push(p);else if(!t)return}else if(!t)return;for(var n={},o=0;o<t;o++){var i=e[o],a=[i.getMaxTime()/1e3+"s"],s=Bl(i.getClip().easing),d=i.getDelay();s?a.push(s):a.push("linear"),d&&a.push(d/1e3+"s"),i.getLoop()&&a.push("infinite");var l=a.join(" ");n[l]=n[l]||[l,[]],n[l][1].push(i)}function u(e){var t,r,n,o,i,a=e[1],s=a.length,d={},l={},u={},f="animation-timing-function";function c(e,t,r){for(var n=e.getTracks(),o=e.getMaxTime(),i=0;i<n.length;i++){var a=n[i];if(a.needsAnimate()){var s=a.keyframes,d=a.propName;if(r&&(d=r(d)),d)for(var l=0;l<s.length;l++){var u=s[l],c=Math.round(u.time/o*100)+"%",p=Bl(u.easing),h=u.rawValue;(B(h)||j(h))&&(t[c]=t[c]||{},t[c][d]=u.rawValue,p&&(t[c][f]=p))}}}}for(var p=0;p<s;p++){(E=(w=a[p]).targetName)?"shape"===E&&c(w,l):!A&&c(w,d)}for(var h in d){var m={};On(m,k),O(m,d[h]);var g=Pr(m),v=d[h][f];u[h]=g?{transform:g}:{},t=u[h],void 0,n=(r=m).originX,o=r.originY,(n||o)&&(t[Dl]=n+"px "+o+"px"),v&&(u[h][f]=v)}var y=!0;for(var h in l){u[h]=u[h]||{};var _=!i;v=l[h][f];_&&(i=new Qo);var b=i.len();i.reset(),u[h].d=Ll(k,l[h],i);var S=i.len();if(!_&&b!==S){y=!1;break}v&&(u[h][f]=v)}if(!y)for(var h in u)delete u[h].d;if(!A)for(p=0;p<s;p++){var w,E;"style"===(E=(w=a[p]).targetName)&&c(w,u,function(e){return Hl[e]})}var I,T=L(u),C=!0;for(p=1;p<T.length;p++){var R=T[p-1],P=T[p];if(u[R][Dl]!==u[P][Dl]){C=!1;break}I=u[R][Dl]}if(C&&I){for(var h in u)u[h][Dl]&&delete u[h][Dl];x[Dl]=I}if(D(T,function(e){return 0<L(u[e]).length}).length)return Nl(u,M)+" "+e[0]+" both"}for(var c in n){var p;(p=u(n[c]))&&r.push(p)}if(r.length){var h=M.zrId+"-cls-"+M.cssClassIdx++;M.cssNodes["."+h]={animation:r.join(",")},x.class=h}}var Vl=Math.round;function Fl(e){return e&&B(e.src)}function ql(e){return e&&N(e.toDataURL)}function Gl(a,s,d,l){Il(function(e,t){var r,n,o,i="fill"===e||"stroke"===e;i&&((o=t)&&("linear"===o.type||"radial"===o.type))?function(e,t,r,n){var o,i=e[r],a={gradientUnits:i.global?"userSpaceOnUse":"objectBoundingBox"};if(Ir(i))o="linearGradient",a.x1=i.x,a.y1=i.y,a.x2=i.x2,a.y2=i.y2;else{if(!Tr(i))return w("Illegal gradient type.");o="radialGradient",a.cx=X(i.x,.5),a.cy=X(i.y,.5),a.r=X(i.r,.5)}for(var s=i.colorStops,d=[],l=0,u=s.length;l<u;++l){var c=100*Sr(s[l].offset)+"%",p=s[l].color,h=vr(p),f=h.color,m=h.opacity,g={offset:c};g["stop-color"]=f,m<1&&(g["stop-opacity"]=m),d.push(xl("stop",l+"",g))}var v=Ml(xl(o,"",a,d)),y=n.gradientCache,_=y[v];_||(_=n.zrId+"-g"+n.gradientIdx++,y[v]=_,a.id=_,n.defs[_]=xl(o,_,a,d));t[r]=Cr(_)}(s,a,e,l):i&&(Er(r=t)||(n=r)&&n.svgElement)?function(e,t,r,n){var o,i=e.style[r],a={patternUnits:"userSpaceOnUse"};if(Er(i)){var s=i.imageWidth,d=i.imageHeight,l=void 0,u=i.image;if(B(u)?l=u:Fl(u)?l=u.src:ql(u)&&(l=u.toDataURL()),"undefined"==typeof Image){var c="Image width/height must been given explictly in svg-ssr renderer.";$(s,c),$(d,c)}else if(null==s||null==d){var p=function(e,t){if(e){var r=e.elm,n=e.attrs.width=s||t.width,o=e.attrs.height=d||t.height;r&&(r.setAttribute("width",n),r.setAttribute("height",o))}},h=Rs(l,null,e,function(e){p(f,e),p(o,e)});h&&h.width&&h.height&&(s=s||h.width,d=d||h.height)}o=xl("image","img",{href:l,width:s,height:d}),a.width=s,a.height=d}else i.svgElement&&(o=E(i.svgElement),a.width=i.svgWidth,a.height=i.svgHeight);if(!o)return;a.patternTransform=Pr(i);var f=xl("pattern","",a,[o]),m=Ml(f),g=n.patternCache,v=g[m];v||(v=n.zrId+"-p"+n.patternIdx++,g[m]=v,a.id=v,f=n.defs[v]=xl("pattern",v,a,[o]));t[r]=Cr(v)}(d,a,e,l):a[e]=t},s,d,!1),function(e,t,r){var n=e.style;if(w=n,w&&(w.shadowBlur||w.shadowOffsetX||w.shadowOffsetY)){var o=(b=(_=e).style,S=_.getGlobalScale(),[b.shadowColor,(b.shadowBlur||0).toFixed(2),(b.shadowOffsetX||0).toFixed(2),(b.shadowOffsetY||0).toFixed(2),S[0],S[1]].join(",")),i=r.shadowCache,a=i[o];if(!a){var s=e.getGlobalScale(),d=s[0],l=s[1];if(!d||!l)return;var u=n.shadowOffsetX||0,c=n.shadowOffsetY||0,p=n.shadowBlur,h=vr(n.shadowColor),f=h.opacity,m=h.color,g=p/2/d,v=p/2/l,y=g+" "+v;a=r.zrId+"-s"+r.shadowIdx++,r.defs[a]=xl("filter",a,{id:a,x:"-100%",y:"-100%",width:"300%",height:"300%"},[xl("feDropShadow","",{dx:u/d,dy:c/l,stdDeviation:y,"flood-color":m,"flood-opacity":f})]),i[o]=a}t.filter=Cr(a)}var _,b,S;var w}(d,a,l)}function Wl(e){return _r(e[0]-1)&&_r(e[1])&&_r(e[2])&&_r(e[3]-1)}function zl(e,t,r){if(t&&!(_r((i=t)[4])&&_r(i[5])&&Wl(t))){var n=r?10:1e4;e.transform=Wl(t)?"translate("+Vl(t[4]*n)/n+" "+Vl(t[5]*n)/n+")":"matrix("+br((o=t)[0])+","+br(o[1])+","+br(o[2])+","+br(o[3])+","+Sr(o[4])+","+Sr(o[5])+")"}var o,i}function Yl(e,t,r){for(var n=e.points,o=[],i=0;i<n.length;i++)o.push(Vl(n[i][0]*r)/r),o.push(Vl(n[i][1]*r)/r);t.points=o.join(" ")}function Kl(e){return!e.smooth}var Xl,Jl,Ql={circle:[(Xl=["cx","cy","r"],Jl=M(Xl,function(e){return"string"==typeof e?[e,e]:e}),function(e,t,r){for(var n=0;n<Jl.length;n++){var o=Jl[n],i=e[o[0]];null!=i&&(t[o[1]]=Vl(i*r)/r)}})],polyline:[Yl,Kl],polygon:[Yl,Kl]};function Zl(e,t){var r=e.style,n=e.shape,o=Ql[e.type],i={},a=t.animation,s="path",d=e.style.strokePercent,l=t.compress&&Rr(e)||4;if(!o||t.willUpdate||o[1]&&!o[1](n)||a&&function(e){for(var t=e.animators,r=0;r<t.length;r++)if("shape"===t[r].targetName)return!0;return!1}(e)||d<1){e.path||e.createPathProxy();var u=e.path;e.shapeChanged()&&(u.beginPath(),e.buildPath(u,e.shape),e.pathUpdated());var c=u.getVersion(),p=e,h=p.__svgPathBuilder;p.__svgPathVersion===c&&h&&d===p.__svgPathStrokePercent||(h||(h=p.__svgPathBuilder=new _l),h.reset(l),u.rebuildPath(h,d),h.generateStr(),p.__svgPathVersion=c,p.__svgPathStrokePercent=d),i.d=h.getStr()}else{s=e.type;var f=Math.pow(10,l);o[0](n,i,f)}return zl(i,e.transform),Gl(i,r,e,t),t.animation&&jl(e,i,t),xl(s,e.id+"",i)}function $l(e,t){return e instanceof yi?Zl(e,t):e instanceof qi?function(e,t){var r=e.style,n=r.image;if(n&&!B(n)&&(Fl(n)?n=n.src:ql(n)&&(n=n.toDataURL())),n){var o=r.x||0,i=r.y||0,a={href:n,width:r.width,height:r.height};return o&&(a.x=o),i&&(a.y=i),zl(a,e.transform),Gl(a,r,e,t),t.animation&&jl(e,a,t),xl("image",e.id+"",a)}}(e,t):e instanceof pa?function(e,t){var r=e.style,n=r.text;if(null!=n&&(n+=""),n&&!isNaN(r.x)&&!isNaN(r.y)){var o,i,a,s=r.font||x,d=r.x||0,l=(o=r.y||0,i=Xn(s),"top"===(a=r.textBaseline)?o+=i/2:"bottom"===a&&(o-=i/2),o),u={"dominant-baseline":"central","text-anchor":wr[r.textAlign]||r.textAlign};if(Xs(r)){var c="",p=r.fontStyle,h=Ys(r.fontSize);if(!parseFloat(h))return;var f=r.fontFamily||g,m=r.fontWeight;c+="font-size:"+h+";font-family:"+f+";",p&&"normal"!==p&&(c+="font-style:"+p+";"),m&&"normal"!==m&&(c+="font-weight:"+m+";"),u.style=c}else u.style="font: "+s;return n.match(/\s/)&&(u["xml:space"]="preserve"),d&&(u.x=d),l&&(u.y=l),zl(u,e.transform),Gl(u,r,e,t),t.animation&&jl(e,u,t),xl("text",e.id+"",u,void 0,n)}}(e,t):void 0}function eu(e,t,r){var n=r.clipPathCache,o=r.defs,i=n[e.id];if(!i){var a={id:i=r.zrId+"-c"+r.clipPathIdx++};o[n[e.id]=i]=xl("clipPath",i,a,[Zl(e,r)])}t["clip-path"]=Cr(i)}function tu(e){return document.createTextNode(e)}function ru(e,t,r){e.insertBefore(t,r)}function nu(e,t){e.removeChild(t)}function ou(e,t){e.appendChild(t)}function iu(e){return e.parentNode}function au(e){return e.nextSibling}function su(e,t){e.textContent=t}var du=58,lu=120,uu=xl("","");function cu(e){return void 0===e}function pu(e){return void 0!==e}function hu(e,t,r){for(var n={},o=t;o<=r;++o){var i=e[o].key;void 0!==i&&(null!=n[i]&&console.error("Duplicate key "+i),n[i]=o)}return n}function fu(e,t){var r=e.key===t.key;return e.tag===t.tag&&r}function mu(e){var t,r=e.children,n=e.tag;if(pu(n)){var o=e.elm=kl(n);if(yu(uu,e),K(r))for(t=0;t<r.length;++t){var i=r[t];null!=i&&ou(o,mu(i))}else pu(e.text)&&!V(e.text)&&ou(o,tu(e.text))}else e.elm=tu(e.text);return e.elm}function gu(e,t,r,n,o){for(;n<=o;++n){var i=r[n];null!=i&&ru(e,mu(i),t)}}function vu(e,t,r,n){for(;r<=n;++r){var o=t[r];if(null!=o)if(pu(o.tag))nu(iu(o.elm),o.elm);else nu(e,o.elm)}}function yu(e,t){var r,n=t.elm,o=e&&e.attrs||{},i=t.attrs||{};if(o!==i){for(r in i){var a=i[r];o[r]!==a&&(!0===a?n.setAttribute(r,""):!1===a?n.removeAttribute(r):r.charCodeAt(0)!==lu?n.setAttribute(r,a):"xmlns:xlink"===r||"xmlns"===r?n.setAttributeNS(Rl,r,a):r.charCodeAt(3)===du?n.setAttributeNS(Pl,r,a):r.charCodeAt(5)===du?n.setAttributeNS(Cl,r,a):n.setAttribute(r,a))}for(r in o)r in i||n.removeAttribute(r)}}function _u(e,t){var r=t.elm=e.elm,n=e.children,o=t.children;e!==t&&(yu(e,t),cu(t.text)?pu(n)&&pu(o)?n!==o&&function(e,t,r){for(var n,o,i,a=0,s=0,d=t.length-1,l=t[0],u=t[d],c=r.length-1,p=r[0],h=r[c];a<=d&&s<=c;)null==l?l=t[++a]:null==u?u=t[--d]:null==p?p=r[++s]:null==h?h=r[--c]:fu(l,p)?(_u(l,p),l=t[++a],p=r[++s]):fu(u,h)?(_u(u,h),u=t[--d],h=r[--c]):fu(l,h)?(_u(l,h),ru(e,l.elm,au(u.elm)),l=t[++a],h=r[--c]):(fu(u,p)?(_u(u,p),ru(e,u.elm,l.elm),u=t[--d]):(cu(n)&&(n=hu(t,a,d)),cu(o=n[p.key])?ru(e,mu(p),l.elm):(i=t[o]).tag!==p.tag?ru(e,mu(p),l.elm):(_u(i,p),t[o]=void 0,ru(e,i.elm,l.elm))),p=r[++s]);(a<=d||s<=c)&&(d<a?gu(e,null==r[c+1]?null:r[c+1].elm,r,s,c):vu(e,t,a,d))}(r,n,o):pu(o)?(pu(e.text)&&su(r,""),gu(r,null,o,0,o.length-1)):pu(n)?vu(r,n,0,n.length-1):pu(e.text)&&su(r,""):e.text!==t.text&&(pu(n)&&vu(r,n,0,n.length-1),su(r,t.text)))}var bu=0,Su=function(){function e(e,t,r){if(this.type="svg",this.refreshHover=wu("refreshHover"),this.configLayer=wu("configLayer"),this.storage=t,this._opts=r=O({},r),this.root=e,this._id="zr"+bu++,this._oldVNode=Ol(r.width,r.height),e&&!r.ssr){var n=this._viewport=document.createElement("div");n.style.cssText="position:relative;overflow:hidden";var o=this._svgDom=this._oldVNode.elm=kl("svg");yu(null,this._oldVNode),n.appendChild(o),e.appendChild(n)}this.resize(r.width,r.height)}return e.prototype.getType=function(){return this.type},e.prototype.getViewportRoot=function(){return this._viewport},e.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},e.prototype.getSvgDom=function(){return this._svgDom},e.prototype.refresh=function(){if(this.root){var e=this.renderToVNode({willUpdate:!0});e.attrs.style="position:absolute;left:0;top:0;user-select:none",function(e,t){if(fu(e,t))_u(e,t);else{var r=e.elm,n=iu(r);mu(t),null!==n&&(ru(n,t.elm,au(r)),vu(n,[e],0,0))}}(this._oldVNode,e),this._oldVNode=e}},e.prototype.renderOneToVNode=function(e){return $l(e,Al(this._id))},e.prototype.renderToVNode=function(e){e=e||{};var t=this.storage.getDisplayList(!0),r=this._backgroundColor,n=this._width,o=this._height,i=Al(this._id);i.animation=e.animation,i.willUpdate=e.willUpdate,i.compress=e.compress;var a=[];if(r&&"none"!==r){var s=vr(r),d=s.color,l=s.opacity;this._bgVNode=xl("rect","bg",{width:n,height:o,x:"0",y:"0",id:"0",fill:d,"fill-opacity":l}),a.push(this._bgVNode)}else this._bgVNode=null;var u=e.compress?null:this._mainVNode=xl("g","main",{},[]);this._paintList(t,i,u?u.children:a),u&&a.push(u);var c,p,h,f,m,g,v,y=M(L(i.defs),function(e){return i.defs[e]});if(y.length&&a.push(xl("defs","defs",{},y)),e.animation){var _=(c=i.cssNodes,p=i.cssAnims,h=({newline:!0}||{}).newline?"\n":"",f=" {"+h,m=h+"}",g=M(L(c),function(t){return t+f+M(L(c[t]),function(e){return e+":"+c[t][e]+";"}).join(h)+m}).join(h),v=M(L(p),function(n){return"@keyframes "+n+f+M(L(p[n]),function(r){return r+f+M(L(p[n][r]),function(e){var t=p[n][r][e];return"d"===e&&(t='path("'+t+'")'),e+":"+t+";"}).join(h)+m}).join(h)+m}).join(h),g||v?["<![CDATA[",g,v,"]]>"].join(h):"");if(_){var b=xl("style","stl",{},[],_);a.push(b)}}return Ol(n,o,a,e.useViewBox)},e.prototype.renderToString=function(e){return e=e||{},Ml(this.renderToVNode({animation:X(e.cssAnimation,!0),willUpdate:!1,compress:!0,useViewBox:X(e.useViewBox,!0)}),{newline:!0})},e.prototype.setBackgroundColor=function(e){this._backgroundColor=e;var t=this._bgVNode;if(t&&t.elm){var r=vr(e),n=r.color,o=r.opacity;t.elm.setAttribute("fill",n),o<1&&t.elm.setAttribute("fill-opacity",o)}},e.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},e.prototype._paintList=function(e,t,r){for(var n,o,i=e.length,a=[],s=0,d=0,l=0;l<i;l++){var u=e[l];if(!u.invisible){var c=u.__clipPaths,p=c&&c.length||0,h=o&&o.length||0,f=void 0;for(f=Math.max(p-1,h-1);0<=f&&(!c||!o||c[f]!==o[f]);f--);for(var m=h-1;f<m;m--)n=a[--s-1];for(var g=f+1;g<p;g++){var v={};eu(c[g],v,t);var y=xl("g","clip-g-"+d++,v,[]);(n?n.children:r).push(y),n=a[s++]=y}o=c;var _=$l(u,t);_&&(n?n.children:r).push(_)}}},e.prototype.resize=function(e,t){var r=this._opts,n=this.root,o=this._viewport;if(null!=e&&(r.width=e),null!=t&&(r.height=t),n&&o&&(o.style.display="none",e=qd(n,0,r),t=qd(n,1,r),o.style.display=""),this._width!==e||this._height!==t){if(this._width=e,this._height=t,o){var i=o.style;i.width=e+"px",i.height=t+"px"}var a=this._svgDom;a&&(a.setAttribute("width",e),a.setAttribute("height",t))}},e.prototype.getWidth=function(){return this._width},e.prototype.getHeight=function(){return this._height},e.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},e.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},e.prototype.toDataURL=function(e){var t=encodeURIComponent(this.renderToString()),r="data:image/svg+xml;";return e?(t=kr(t))&&r+"base64,"+t:r+"charset=UTF-8,"+t},e}();function wu(e){return function(){w('In SVG mode painter not support method "'+e+'"')}}co("canvas",hl),co("svg",Su),e.Arc=nd,e.ArcShape=rd,e.BezierCurve=sd,e.BezierCurveShape=id,e.BoundingRect=qn,e.Circle=Wi,e.CircleShape=Gi,e.CompoundPath=ws,e.Displayable=vo,e.Droplet=ld,e.DropletShape=dd,e.Element=ro,e.Ellipse=Zi,e.EllipseShape=Qi,e.Group=ao,e.Heart=cd,e.HeartShape=ud,e.Image=qi,e.IncrementalDisplayable=Is,e.Isogon=gd,e.IsogonShape=md,e.Line=ta,e.LineShape=ea,e.LinearGradient=la,e.OrientedBoundingRect=Nd,e.Path=yi,e.Pattern=Od,e.Point=Un,e.Polygon=oa,e.PolygonShape=na,e.Polyline=aa,e.PolylineShape=ia,e.RadialGradient=ua,e.Rect=Ji,e.RectShape=Ki,e.Ring=yd,e.RingShape=vd,e.Rose=Ed,e.RoseShape=wd,e.Sector=za,e.SectorShape=Wa,e.Star=Pd,e.StarShape=Rd,e.TSpan=pa,e.Text=qs,e.Arrowline=_i,e.Trochoid=Ad,e.TrochoidShape=Md,e.color=mr,e.dispose=function(e){e.dispose()},e.disposeAll=function(){for(var e in lo)lo.hasOwnProperty(e)&&lo[e].dispose();lo={}},e.getInstance=function(e){return lo[e]},e.init=function(e,t){var r=new uo(S(),e,t);return lo[r.id]=r},e.matrix=In,e.morph=Ss,e.parseSVG=function(e,t){return(new va).parse(e,t)},e.path=ji,e.registerPainter=co,e.setPlatformAPI=function(e){for(var t in h)e[t]&&(h[t]=e[t])},e.showDebugDirtyRect=function(e,o){o=o||{};var t=e.painter;if(!t.getLayers)throw new Error("Debug dirty rect can only been used on canvas renderer.");if(t.isSingleCanvas())throw new Error("Debug dirty rect can only been used on zrender inited with container.");var i=document.createElement("div");i.style.cssText="\nposition:absolute;\nleft:0;\ntop:0;\nright:0;\nbottom:0;\npointer-events:none;\n",i.className="ec-debug-dirty-rect-container";var a=[],r=e.dom;r.appendChild(i),"static"===getComputedStyle(r).position&&(r.style.position="relative"),e.on("rendered",function(){if(t.getLayers){var n=0;t.eachBuiltinLayer(function(e){if(e.debugGetPaintRects)for(var t=e.debugGetPaintRects(),r=0;r<t.length;r++)t[r].width&&t[r].height&&(a[n]||(a[n]=new Bd(o.style),i.appendChild(a[n].dom)),a[n].show(o.autoHideDelay),a[n].update(t[r]),n++)});for(var e=n;e<a.length;e++)a[e].hide()}})},e.util=le,e.vector=xe,e.version="5.3.2",Object.defineProperty(e,"__esModule",{value:!0})}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mqtt=e()}}(function(){return function i(a,s,d){function l(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};a[t][0].call(o.exports,function(e){return l(a[t][1][e]||e)},o,o.exports,i,a,s,d)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<d.length;e++)l(d[e]);return l}({1:[function(v,y,e){(function(d,e){"use strict";var n=v("events"),i=v("./store"),l=v("mqtt-packet"),u=v("readable-stream").Writable,t=v("inherits"),r=v("reinterval"),h=v("./validations"),f=v("xtend"),m=e.setImmediate||function(e){d.nextTick(e)},a={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},c={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",6:"User repeat login",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function p(e,t,r){e.emit("packetsend",t),!l.writeToStream(t,e.stream,e.options)&&r?e.stream.once("drain",r):r&&r()}function o(t,r,n,o){t.outgoingStore.put(r,function(e){if(e)return n&&n(e);o(),p(t,r,n)})}function g(){}function s(e,t){var r,o=this;if(!(this instanceof s))return new s(e,t);for(r in this.options=t||{},a)void 0===this.options[r]?this.options[r]=a[r]:this.options[r]=t[r];this.options.clientId="string"==typeof t.clientId?t.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),this.options.customHandleAcks=5===t.protocolVersion&&t.customHandleAcks?t.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=e,this.outgoingStore=t.outgoingStore||new i,this.incomingStore=t.incomingStore||new i,this.queueQoSZero=void 0===t.queueQoSZero||t.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("close",function(){this.connected=!1,clearTimeout(this.connackTimer)}),this.on("connect",function(){var n=this.queue;!function t(){var e,r=n.shift();r&&(e=r.packet,o._sendPacket(e,function(e){r.cb&&r.cb(e),t()}))}()}),this.on("close",function(){null!==o.pingTimer&&(o.pingTimer.clear(),o.pingTimer=null)}),this.on("close",this._setupReconnect),n.EventEmitter.call(this),this._setupStream()}t(s,n.EventEmitter),s.prototype._setupStream=function(){var e,r=this,t=new u,n=l.parser(this.options),o=null,i=[];function a(){if(i.length)d.nextTick(s);else{var e=o;o=null,e()}}function s(){var e=i.shift();if(e)r._handlePacket(e,a);else{var t=o;o=null,t&&t()}}if(this._clearReconnect(),this.stream=this.streamBuilder(this),n.on("packet",function(e){i.push(e)}),t._write=function(e,t,r){o=r,n.parse(e),s()},this.stream.pipe(t),this.stream.on("error",g),this.stream.on("close",function(){var t;(t=r.outgoing)&&Object.keys(t).forEach(function(e){t[e].volatile&&"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])}),r.emit("close")}),(e=Object.create(this.options)).cmd="connect",p(this,e),n.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.emit("error",new Error("Packet has no Authentication Method")),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket)p(this,f({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){r._cleanUp(!0)},this.options.connectTimeout)},s.prototype._handlePacket=function(e,t){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<e.length)return this.emit("error",new Error("exceeding packets size "+e.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(this.emit("packetreceive",e),e.cmd){case"publish":this._handlePublish(e,t);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(e),t();break;case"pubrel":this._handlePubrel(e,t);break;case"connack":this._handleConnack(e),t();break;case"pingresp":this._handlePingresp(e),t();break;case"disconnect":this._handleDisconnect(e),t()}},s.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},s.prototype.publish=function(e,t,r,n){var o,i=this.options;"function"==typeof r&&(n=r,r=null);if(r=f({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(n))return this;switch(o={cmd:"publish",topic:e,payload:t,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===i.protocolVersion&&(o.properties=r.properties,(!i.properties&&o.properties&&o.properties.topicAlias||r.properties&&i.properties&&(r.properties.topicAlias&&i.properties.topicAliasMaximum&&r.properties.topicAlias>i.properties.topicAliasMaximum||!i.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete o.properties.topicAlias),r.qos){case 1:case 2:this.outgoing[o.messageId]={volatile:!1,cb:n||g},this._storeProcessing?(this._packetIdsDuringStoreProcessing[o.messageId]=!1,this._storePacket(o,void 0,r.cbStorePut)):this._sendPacket(o,void 0,r.cbStorePut);break;default:this._storeProcessing?this._storePacket(o,n,r.cbStorePut):this._sendPacket(o,n,r.cbStorePut)}return this},s.prototype.subscribe=function(){for(var e,t=new Array(arguments.length),r=0;r<arguments.length;r++)t[r]=arguments[r];var n,o=[],i=t.shift(),a=i.resubscribe,s=t.pop()||g,d=t.pop(),l=this,u=this.options.protocolVersion;if(delete i.resubscribe,"string"==typeof i&&(i=[i]),"function"!=typeof s&&(d=s,s=g),null!==(n=h.validateTopics(i)))return m(s,new Error("Invalid topic "+n)),this;if(this._checkDisconnecting(s))return this;var c={qos:0};if(5===u&&(c.nl=!1,c.rap=!1,c.rh=0),d=f(c,d),Array.isArray(i)?i.forEach(function(e){if(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<d.qos||a){var t={topic:e,qos:d.qos};5===u&&(t.nl=d.nl,t.rap=d.rap,t.rh=d.rh,t.properties=d.properties),o.push(t)}}):Object.keys(i).forEach(function(e){if(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<i[e].qos||a){var t={topic:e,qos:i[e].qos};5===u&&(t.nl=i[e].nl,t.rap=i[e].rap,t.rh=i[e].rh,t.properties=d.properties),o.push(t)}}),e={cmd:"subscribe",subscriptions:o,qos:1,retain:!1,dup:!1,messageId:this._nextId()},d.properties&&(e.properties=d.properties),o.length){if(this.options.resubscribe){var p=[];o.forEach(function(e){if(0<l.options.reconnectPeriod){var t={qos:e.qos};5===u&&(t.nl=e.nl||!1,t.rap=e.rap||!1,t.rh=e.rh||0,t.properties=e.properties),l._resubscribeTopics[e.topic]=t,p.push(e.topic)}}),l.messageIdToTopic[e.messageId]=p}return this.outgoing[e.messageId]={volatile:!0,cb:function(e,t){if(!e)for(var r=t.granted,n=0;n<r.length;n+=1)o[n].qos=r[n];s(e,o)}},this._sendPacket(e),this}s(null,[])},s.prototype.unsubscribe=function(){for(var e={cmd:"unsubscribe",qos:1,messageId:this._nextId()},t=this,r=new Array(arguments.length),n=0;n<arguments.length;n++)r[n]=arguments[n];var o=r.shift(),i=r.pop()||g,a=r.pop();return"string"==typeof o&&(o=[o]),"function"!=typeof i&&(a=i,i=g),this._checkDisconnecting(i)||("string"==typeof o?e.unsubscriptions=[o]:"object"==typeof o&&o.length&&(e.unsubscriptions=o),this.options.resubscribe&&e.unsubscriptions.forEach(function(e){delete t._resubscribeTopics[e]}),"object"==typeof a&&a.properties&&(e.properties=a.properties),this.outgoing[e.messageId]={volatile:!0,cb:i},this._sendPacket(e)),this},s.prototype.end=function(){var e=this,t=arguments[0],r=arguments[1],n=arguments[2];function o(){e.disconnected=!0,e.incomingStore.close(function(){e.outgoingStore.close(function(){n&&n.apply(null,arguments),e.emit("end")})}),e._deferredReconnect&&e._deferredReconnect()}function i(){e._cleanUp(t,m.bind(null,o),r)}return null!=t&&"boolean"==typeof t||(n=r||g,r=t,t=!1,"object"!=typeof r&&(n=r,r=null,"function"!=typeof n&&(n=g))),"object"!=typeof r&&(n=r,r=null),n=n||g,this.disconnecting||(this._clearReconnect(),this.disconnecting=!0,!t&&0<Object.keys(this.outgoing).length?this.once("outgoingEmpty",setTimeout.bind(null,i,10)):i()),this},s.prototype.removeOutgoingMessage=function(e){var t=this.outgoing[e]?this.outgoing[e].cb:null;return delete this.outgoing[e],this.outgoingStore.del({messageId:e},function(){t(new Error("Message removed"))}),this},s.prototype.reconnect=function(e){var t=this,r=function(){e?(t.options.incomingStore=e.incomingStore,t.options.outgoingStore=e.outgoingStore):(t.options.incomingStore=null,t.options.outgoingStore=null),t.incomingStore=t.options.incomingStore||new i,t.outgoingStore=t.options.outgoingStore||new i,t.disconnecting=!1,t.disconnected=!1,t._deferredReconnect=null,t._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this},s.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},s.prototype._setupReconnect=function(){var e=this;!e.disconnecting&&!e.reconnectTimer&&0<e.options.reconnectPeriod&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),e.reconnectTimer=setInterval(function(){e._reconnect()},e.options.reconnectPeriod))},s.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},s.prototype._cleanUp=function(e,t){var r,n=arguments[2];if(t&&this.stream.on("close",t),e)0===this.options.reconnectPeriod&&this.options.clean&&(r=this.outgoing)&&Object.keys(r).forEach(function(e){"function"==typeof r[e].cb&&(r[e].cb(new Error("Connection closed")),delete r[e])}),this.stream.destroy();else{var o=f({cmd:"disconnect"},n);this._sendPacket(o,m.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),t&&!this.connected&&(this.stream.removeListener("close",t),t())},s.prototype._sendPacket=function(e,t,r){if(r=r||g,this.connected){switch(this._shiftPingInterval(),e.cmd){case"publish":break;case"pubrel":return void o(this,e,t,r);default:return void p(this,e,t)}switch(e.qos){case 2:case 1:o(this,e,t,r);break;case 0:default:p(this,e,t)}}else this._storePacket(e,t,r)},s.prototype._storePacket=function(e,t,r){r=r||g,0===(e.qos||0)&&this.queueQoSZero||"publish"!==e.cmd?this.queue.push({packet:e,cb:t}):0<e.qos?(t=this.outgoing[e.messageId]?this.outgoing[e.messageId].cb:null,this.outgoingStore.put(e,function(e){if(e)return t&&t(e);r()})):t&&t(new Error("No connection to broker"))},s.prototype._setupPingTimer=function(){var e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=r(function(){e._checkPing()},1e3*this.options.keepalive))},s.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},s.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},s.prototype._handlePingresp=function(){this.pingResp=!0},s.prototype._handleConnack=function(e){var t=this.options,r=5===t.protocolVersion?e.reasonCode:e.returnCode;if(clearTimeout(this.connackTimer),e.properties&&(e.properties.topicAliasMaximum&&(t.properties||(t.properties={}),t.properties.topicAliasMaximum=e.properties.topicAliasMaximum),e.properties.serverKeepAlive&&t.keepalive&&(t.keepalive=e.properties.serverKeepAlive,this._shiftPingInterval()),e.properties.maximumPacketSize&&(t.properties||(t.properties={}),t.properties.maximumPacketSize=e.properties.maximumPacketSize)),0===r)this.reconnecting=!1,this._onConnect(e);else if(0<r){var n=new Error("Connection refused: "+c[r]);n.code=r,this.emit("error",n)}},s.prototype._handlePublish=function(r,n){n=void 0!==n?n:g;var o=r.topic.toString(),i=r.payload,e=r.qos,a=r.messageId,s=this,t=this.options,d=[0,16,128,131,135,144,145,151,153];switch(e){case 2:t.customHandleAcks(o,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?s.emit("error",e):-1===d.indexOf(t)?s.emit("error",new Error("Wrong reason code for pubrec")):void(t?s._sendPacket({cmd:"pubrec",messageId:a,reasonCode:t},n):s.incomingStore.put(r,function(){s._sendPacket({cmd:"pubrec",messageId:a},n)}))});break;case 1:t.customHandleAcks(o,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?s.emit("error",e):-1===d.indexOf(t)?s.emit("error",new Error("Wrong reason code for puback")):(t||s.emit("message",o,i,r),void s.handleMessage(r,function(e){if(e)return n&&n(e);s._sendPacket({cmd:"puback",messageId:a,reasonCode:t},n)}))});break;case 0:this.emit("message",o,i,r),this.handleMessage(r,n)}},s.prototype.handleMessage=function(e,t){t()},s.prototype._handleAck=function(e){var t,r=e.messageId,n=e.cmd,o=null,i=this.outgoing[r]?this.outgoing[r].cb:null,a=this;if(i){switch(n){case"pubcomp":case"puback":var s=e.reasonCode;s&&0<s&&16!==s&&((t=new Error("Publish error: "+c[s])).code=s,i(t,e)),delete this.outgoing[r],this.outgoingStore.del(e,i);break;case"pubrec":o={cmd:"pubrel",qos:2,messageId:r};var d=e.reasonCode;d&&0<d&&16!==d?((t=new Error("Publish error: "+c[d])).code=d,i(t,e)):this._sendPacket(o);break;case"suback":delete this.outgoing[r];for(var l=0;l<e.granted.length;l++)if(0!=(128&e.granted[l])){var u=this.messageIdToTopic[r];u&&u.forEach(function(e){delete a._resubscribeTopics[e]})}i(null,e);break;case"unsuback":delete this.outgoing[r],i(null);break;default:a.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},s.prototype._handlePubrel=function(e,r){r=void 0!==r?r:g;var t=e.messageId,n=this,o={cmd:"pubcomp",messageId:t};n.incomingStore.get(e,function(e,t){e?n._sendPacket(o,r):(n.emit("message",t.topic,t.payload,t),n.handleMessage(t,function(e){if(e)return r(e);n.incomingStore.del(t,g),n._sendPacket(o,r)}))})},s.prototype._handleDisconnect=function(e){this.emit("disconnect",e)},s.prototype._nextId=function(){var e=this.nextId++;return 65536===this.nextId&&(this.nextId=1),e},s.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},s.prototype._resubscribe=function(e){var t=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!e.sessionPresent)&&0<t.length)if(this.options.resubscribe)if(5===this.options.protocolVersion)for(var r=0;r<t.length;r++){var n={};n[t[r]]=this._resubscribeTopics[t[r]],n.resubscribe=!0,this.subscribe(n,{properties:n[t[r]].properties})}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},s.prototype._onConnect=function(i){if(this.disconnected)this.emit("connect",i);else{var a=this;this._setupPingTimer(),this._resubscribe(i),this.connected=!0,function r(){var t=a.outgoingStore.createStream();function n(){a._storeProcessing=!1,a._packetIdsDuringStoreProcessing={}}function o(){t.destroy(),t=null,n()}a.once("close",o),t.on("error",function(e){n(),a.removeListener("close",o),a.emit("error",e)}),t.on("end",function(){var e=!0;for(var t in a._packetIdsDuringStoreProcessing)if(!a._packetIdsDuringStoreProcessing[t]){e=!1;break}e?(n(),a.removeListener("close",o),a.emit("connect",i)):r()}),function r(){if(t){a._storeProcessing=!0;var n,e=t.read(1);e?a._packetIdsDuringStoreProcessing[e.messageId]?r():a.disconnecting||a.reconnectTimer?t.destroy&&t.destroy():(n=a.outgoing[e.messageId]?a.outgoing[e.messageId].cb:null,a.outgoing[e.messageId]={volatile:!1,cb:function(e,t){n&&n(e,t),r()}},a._packetIdsDuringStoreProcessing[e.messageId]=!0,a._sendPacket(e)):t.once("readable",r)}}()}()}},y.exports=s}).call(this,v("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:92,events:13,inherits:80,"mqtt-packet":84,"readable-stream":108,reinterval:109,xtend:121}],2:[function(e,t,r){(function(u){"use strict";var c,p,h,f=e("readable-stream").Transform,m=e("duplexify"),g=e("base64-js"),v=!1;t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var r,n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var o,i,a,s,d,l=(i=e,a="alis"===(o=t).protocol?"wss":"ws",s=a+"://"+o.hostname+o.path,o.port&&80!==o.port&&443!==o.port&&(s=a+"://"+o.hostname+":"+o.port+o.path),"function"==typeof o.transformWsUrl&&(s=o.transformWsUrl(s,o,i)),s);return(c=t.my).connectSocket({url:l,protocols:n}),(d=new f)._write=function(e,t,r){c.sendSocketMessage({data:e.buffer,success:function(){r()},fail:function(){r(new Error)}})},d._flush=function(e){c.closeSocket({success:function(){e()}})},p=d,h=m.obj(),v||(v=!0,c.onSocketOpen(function(){h.setReadable(p),h.setWritable(p),h.emit("connect")}),c.onSocketMessage(function(e){if("string"==typeof e.data){var t=g.toByteArray(e.data),r=u.from(t);p.push(r)}else{var n=new FileReader;n.addEventListener("load",function(){var e=n.result;e=e instanceof ArrayBuffer?u.from(e):u.from(e,"utf8"),p.push(e)}),n.readAsArrayBuffer(e.data)}}),c.onSocketClose(function(){h.end(),h.destroy()}),c.onSocketError(function(e){h.destroy(e)})),h}}).call(this,e("buffer").Buffer)},{"base64-js":10,buffer:12,duplexify:17,"readable-stream":108}],3:[function(e,t,r){"use strict";var o=e("net");t.exports=function(e,t){var r,n;return t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",r=t.port,n=t.hostname,o.createConnection(r,n)}},{net:11}],4:[function(e,t,r){"use strict";var o=e("tls");t.exports=function(t,r){var n;function e(e){r.rejectUnauthorized&&t.emit("error",e),n.end()}return r.port=r.port||8883,r.host=r.hostname||r.host||"localhost",r.rejectUnauthorized=!1!==r.rejectUnauthorized,delete r.path,(n=o.connect(r)).on("secureConnect",function(){r.rejectUnauthorized&&!n.authorized?n.emit("error",new Error("TLS not authorized")):n.removeListener("error",e)}),n.on("error",e),n}},{tls:11}],5:[function(t,r,e){(function(e){"use strict";var d=t("websocket-stream"),n=t("url"),l=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],u="browser"===e.title;function o(e,t){var r,n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.port||("wss"===r.protocol?r.port=443:r.port=80),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={}),u||"wss"!==r.protocol||l.forEach(function(e){r.hasOwnProperty(e)&&!r.wsOptions.hasOwnProperty(e)&&(r.wsOptions[e]=r[e])});var o,i,a,s=(i=e,a=(o=t).protocol+"://"+o.hostname+":"+o.port+o.path,"function"==typeof o.transformWsUrl&&(a=o.transformWsUrl(a,o,i)),a);return d(s,[n],t.wsOptions)}r.exports=u?function(e,t){if(t.hostname||(t.hostname=t.host),!t.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");var r=n.parse(document.URL);t.hostname=r.hostname,t.port||(t.port=r.port)}return o(e,t)}:function(e,t){return o(e,t)}}).call(this,t("_process"))},{_process:92,url:113,"websocket-stream":118}],6:[function(e,t,r){(function(c,p){"use strict";var h,f,m,g=e("readable-stream").Transform,v=e("duplexify");t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var r,n="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var o,i,a,s,d,l=(i=e,a="wxs"===(o=t).protocol?"wss":"ws",s=a+"://"+o.hostname+o.path,o.port&&80!==o.port&&443!==o.port&&(s=a+"://"+o.hostname+":"+o.port+o.path),"function"==typeof o.transformWsUrl&&(s=o.transformWsUrl(s,o,i)),s);h=wx.connectSocket({url:l,protocols:n}),(d=new g)._write=function(e,t,r){h.send({data:e.buffer,success:function(){r()},fail:function(e){r(new Error(e))}})},d._flush=function(e){h.close({success:function(){e()}})},f=d,(m=v.obj())._destroy=function(e,t){h.close({success:function(){t&&t(e)}})};var u=m.destroy;return m.destroy=function(){m.destroy=u;var e=this;c.nextTick(function(){h.close({fail:function(){e._destroy(new Error)}})})}.bind(m),h.onOpen(function(){m.setReadable(f),m.setWritable(f),m.emit("connect")}),h.onMessage(function(e){var t=e.data;t=t instanceof ArrayBuffer?p.from(t):p.from(t,"utf8"),f.push(t)}),h.onClose(function(){m.end(),m.destroy()}),h.onError(function(e){m.destroy(new Error(e.errMsg))}),m}}).call(this,e("_process"),e("buffer").Buffer)},{_process:92,buffer:12,duplexify:17,"readable-stream":108}],7:[function(e,d,t){(function(o){"use strict";var t=e("xtend"),i=e("readable-stream").Readable,a={objectMode:!0},r={clean:!0},n=e("es6-map");function s(e){if(!(this instanceof s))return new s(e);this.options=e||{},this.options=t(r,e),this._inflights=new n}s.prototype.put=function(e,t){return this._inflights.set(e.messageId,e),t&&t(),this},s.prototype.createStream=function(){var e=new i(a),t=!1,r=[],n=0;return this._inflights.forEach(function(e,t){r.push(e)}),e._read=function(){!t&&n<r.length?this.push(r[n++]):this.push(null)},e.destroy=function(){if(!t){var e=this;t=!0,o.nextTick(function(){e.emit("close")})}},e},s.prototype.del=function(e,t){return(e=this._inflights.get(e.messageId))?(this._inflights.delete(e.messageId),t(null,e)):t&&t(new Error("missing packet")),this},s.prototype.get=function(e,t){return(e=this._inflights.get(e.messageId))?t(null,e):t&&t(new Error("missing packet")),this},s.prototype.close=function(e){this.options.clean&&(this._inflights=null),e&&e()},d.exports=s}).call(this,e("_process"))},{_process:92,"es6-map":67,"readable-stream":108,xtend:121}],8:[function(e,t,r){"use strict";function n(e){for(var t=e.split("/"),r=0;r<t.length;r++)if("+"!==t[r]){if("#"===t[r])return r===t.length-1;if(-1!==t[r].indexOf("+")||-1!==t[r].indexOf("#"))return!1}return!0}t.exports={validateTopics:function(e){if(0===e.length)return"empty_topic_list";for(var t=0;t<e.length;t++)if(!n(e[t]))return e[t];return null}}},{}],9:[function(n,o,e){(function(e){"use strict";var a=n("../client"),t=n("../store"),s=n("url"),d=n("xtend"),l={};function r(e,t){if("object"!=typeof e||t||(t=e,e=null),t=t||{},e){var r=s.parse(e,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(t=d(r,t)).protocol)throw new Error("Missing protocol");t.protocol=t.protocol.replace(/:$/,"")}var n,o;if((n=t).auth&&((o=n.auth.match(/^(.+):(.+)$/))?(n.username=o[1],n.password=o[2]):n.username=n.auth),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(t.protocol))switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;case"wx":t.protocol="wxs";break;case"ali":t.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+t.protocol+'"!')}}if(!l[t.protocol]){var i=-1!==["mqtts","wss"].indexOf(t.protocol);t.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(e,t){return(!i||t%2!=0)&&"function"==typeof l[e]})[0]}if(!1===t.clean&&!t.clientId)throw new Error("Missing clientId for unclean clients");return t.protocol&&(t.defaultProtocol=t.protocol),new a(function(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.protocol=t.servers[e._reconnectCount].protocol?t.servers[e._reconnectCount].protocol:t.defaultProtocol,t.hostname=t.host,e._reconnectCount++),l[t.protocol](e,t)},t)}"browser"!==e.title?(l.mqtt=n("./tcp"),l.tcp=n("./tcp"),l.ssl=n("./tls"),l.tls=n("./tls"),l.mqtts=n("./tls")):(l.wx=n("./wx"),l.wxs=n("./wx"),l.ali=n("./ali"),l.alis=n("./ali")),l.ws=n("./ws"),l.wss=n("./ws"),o.exports=r,o.exports.connect=r,o.exports.MqttClient=a,o.exports.Store=t}).call(this,n("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:92,url:113,xtend:121}],10:[function(e,t,r){"use strict";r.byteLength=function(e){var t=h(e),r=t[0],n=t[1];return 3*(r+n)/4-n},r.toByteArray=function(e){for(var t,r=h(e),n=r[0],o=r[1],i=new p((l=n,u=o,3*(l+u)/4-u)),a=0,s=0<o?n-4:n,d=0;d<s;d+=4)t=c[e.charCodeAt(d)]<<18|c[e.charCodeAt(d+1)]<<12|c[e.charCodeAt(d+2)]<<6|c[e.charCodeAt(d+3)],i[a++]=t>>16&255,i[a++]=t>>8&255,i[a++]=255&t;var l,u;2===o&&(t=c[e.charCodeAt(d)]<<2|c[e.charCodeAt(d+1)]>>4,i[a++]=255&t);1===o&&(t=c[e.charCodeAt(d)]<<10|c[e.charCodeAt(d+1)]<<4|c[e.charCodeAt(d+2)]>>2,i[a++]=t>>8&255,i[a++]=255&t);return i},r.fromByteArray=function(e){for(var t,r=e.length,n=r%3,o=[],i=0,a=r-n;i<a;i+=16383)o.push(d(e,i,a<i+16383?a:i+16383));1===n?(t=e[r-1],o.push(s[t>>2]+s[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],o.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return o.join("")};for(var s=[],c=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,i=n.length;o<i;++o)s[o]=n[o],c[n.charCodeAt(o)]=o;function h(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function d(e,t,r){for(var n,o,i=[],a=t;a<r;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(s[(o=n)>>18&63]+s[o>>12&63]+s[o>>6&63]+s[63&o]);return i.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],11:[function(e,t,r){},{}],12:[function(e,t,r){"use strict";var n=e("base64-js"),i=e("ieee754");r.Buffer=c,r.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function a(e){if(o<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=c.prototype,t}function c(e,t,r){if("number"!=typeof e)return s(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}function s(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|h(e,t),n=a(r),o=n.write(e,t);o!==r&&(n=n.slice(0,o));return n}(e,t);if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(L(e,ArrayBuffer)||e&&L(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return n.__proto__=c.prototype,n}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return c.from(n,t,r);var o=function(e){if(c.isBuffer(e)){var t=0|p(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||H(e.length)?a(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return d(e),a(e<0?0:0|p(e))}function u(e){for(var t=e.length<0?0:0|p(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e){if(o<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function h(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||L(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(o)return n?-1:O(e).length;t=(""+t).toLowerCase(),o=!0}}function f(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function m(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:g(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,n,o){var i,a=1,s=e.length,d=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s/=a=2,d/=2,r/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(o){var u=-1;for(i=r;i<s;i++)if(l(e,i)===l(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===d)return u*a}else-1!==u&&(i-=i-u),u=-1}else for(s<r+d&&(r=s-d),i=r;0<=i;i--){for(var c=!0,p=0;p<d;p++)if(l(e,i+p)!==l(t,p)){c=!1;break}if(c)return i}return-1}function v(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?o<(n=Number(n))&&(n=o):n=o;var i=t.length;i/2<n&&(n=i/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(H(s))return a;e[r+a]=s}return a}function y(e,t,r,n){return D(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function _(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function b(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,a,s,d,l=e[o],u=null,c=239<l?4:223<l?3:191<l?2:1;if(o+c<=r)switch(c){case 1:l<128&&(u=l);break;case 2:128==(192&(i=e[o+1]))&&127<(d=(31&l)<<6|63&i)&&(u=d);break;case 3:i=e[o+1],a=e[o+2],128==(192&i)&&128==(192&a)&&2047<(d=(15&l)<<12|(63&i)<<6|63&a)&&(d<55296||57343<d)&&(u=d);break;case 4:i=e[o+1],a=e[o+2],s=e[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&65535<(d=(15&l)<<18|(63&i)<<12|(63&a)<<6|63&s)&&d<1114112&&(u=d)}null===u?(u=65533,c=1):65535<u&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),o+=c}return function(e){var t=e.length;if(t<=S)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=S));return r}(n)}r.kMaxLength=o,(c.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=function(e,t,r){return s(e,t,r)},c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=function(e,t,r){return o=t,i=r,d(n=e),n<=0?a(n):void 0!==o?"string"==typeof i?a(n).fill(o,i):a(n).fill(o):a(n);var n,o,i},c.allocUnsafe=function(e){return l(e)},c.allocUnsafeSlow=function(e){return l(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(L(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),L(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;var n=c.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var i=e[r];if(L(i,Uint8Array)&&(i=c.from(i)),!c.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},c.byteLength=h,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},c.prototype.toLocaleString=c.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?b(this,0,e):function(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,r);case"utf8":case"utf-8":return b(this,t,r);case"ascii":return w(this,t,r);case"latin1":case"binary":return E(this,t,r);case"base64":return _(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,n,o){if(L(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(o<=n&&r<=t)return 0;if(o<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(i,a),d=this.slice(n,o),l=e.slice(t,r),u=0;u<s;++u)if(d[u]!==l[u]){i=d[u],a=l[u];break}return i<a?-1:a<i?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},c.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||o<r)&&(r=o),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i,a,s,d,l,u,c,p,h,f=!1;;)switch(n){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return p=t,h=r,D(O(e,(c=this).length-p),c,p,h);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return d=this,l=t,u=r,D(U(e),d,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=t,s=r,D(function(e,t){for(var r,n,o,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(e,(i=this).length-a),i,a,s);default:if(f)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function w(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function E(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function I(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||n<r)&&(r=n);for(var o="",i=t;i<r;++i)o+=A(e[i]);return o}function T(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function C(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,o,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(o<t||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function P(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function k(e,t,r,n,o){return t=+t,r>>>=0,o||P(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function x(e,t,r,n,o){return t=+t,r>>>=0,o||P(e,0,r,8),i.write(e,t,r,n,52,8),r+8}c.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return n.__proto__=c.prototype,n},c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=this[e+--t],o=1;0<t&&(o*=256);)n+=this[e+--t]*o;return n},c.prototype.readUInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return(o*=128)<=n&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||C(e,t,this.length);for(var n=t,o=1,i=this[e+--n];0<n&&(o*=256);)i+=this[e+--n]*o;return(o*=128)<=i&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||C(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||C(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return e>>>=0,t||C(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||C(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||C(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||C(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;0<=--o&&(i*=256);)this[t+o]=e/i&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);R(this,e,t,r,o-1,-o)}var i=0,a=1,s=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},c.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);R(this,e,t,r,o-1,-o)}var i=r-1,a=1,s=0;for(this[t+i]=255&e;0<=--i&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeFloatLE=function(e,t,r){return k(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return k(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,n){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),0<n&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=o-1;0<=i;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return o},c.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var o=e.charCodeAt(0);("utf8"===n&&o<128||"latin1"===n)&&(e=o)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=c.isBuffer(e)?e:c.from(e,n),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%s]}return this};var M=/[^+/0-9A-Za-z-_]/g;function A(e){return e<16?"0"+e.toString(16):e.toString(16)}function O(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],a=0;a<n;++a){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!o){if(56319<r){-1<(t-=3)&&i.push(239,191,189);continue}if(a+1===n){-1<(t-=3)&&i.push(239,191,189);continue}o=r;continue}if(r<56320){-1<(t-=3)&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&-1<(t-=3)&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function U(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function D(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function L(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}},{"base64-js":10,ieee754:79}],13:[function(e,t,r){var d=Object.create||function(e){var t=function(){};return t.prototype=e,new t},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},i=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=d(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var o,s=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),o=0===l.x}catch(e){o=!1}function u(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function c(e,t,r,n){var o,i,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]):(i=e._events=d(null),e._eventsCount=0),a){if("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),!a.warned&&(o=u(e))&&0<o&&a.length>o){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message)}}else a=i[t]=r,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=i.call(p,n);return o.listener=r,n.wrapFn=o}function f(e,t,r){var n=e._events;if(!n)return[];var o=n[t];return o?"function"==typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):g(o,o.length):[]}function m(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}o?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):n.defaultMaxListeners=s,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return u(this)},n.prototype.emit=function(e){var t,r,n,o,i,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(1<arguments.length&&(t=arguments[1]),t instanceof Error)throw t;var d=new Error('Unhandled "error" event. ('+t+")");throw d.context=t,d}if(!(r=a[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,o=g(e,n),i=0;i<n;++i)o[i].call(r)}(r,l,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,i=g(e,o),a=0;a<o;++a)i[a].call(r,n)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,n,o){if(t)e.call(r,n,o);else for(var i=e.length,a=g(e,i),s=0;s<i;++s)a[s].call(r,n,o)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,o,i){if(t)e.call(r,n,o,i);else for(var a=e.length,s=g(e,a),d=0;d<a;++d)s[d].call(r,n,o,i)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(n-1),i=1;i<n;i++)o[i-1]=arguments[i];!function(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,i=g(e,o),a=0;a<o;++a)i[a].apply(r,n)}(r,l,this,o)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){return c(this,e,t,!1)},n.prototype.prependListener=function(e,t){return c(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,n,o,i,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=d(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,i=r.length-1;0<=i;i--)if(r[i]===t||r[i].listener===t){a=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),n.removeListener&&this.emit("removeListener",e,a||t)}return this},n.prototype.removeAllListeners=function(e){var t,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=d(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=d(null):delete r[e]),this;if(0===arguments.length){var o,i=a(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=d(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(n=t.length-1;0<=n;n--)this.removeListener(e,t[n]);return this},n.prototype.listeners=function(e){return f(this,e,!0)},n.prototype.rawListeners=function(e){return f(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},n.prototype.listenerCount=m,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],14:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":81}],15:[function(e,t,r){"use strict";var n,i=e("es5-ext/object/copy"),o=e("es5-ext/object/normalize-options"),a=e("es5-ext/object/valid-callable"),s=e("es5-ext/object/map"),d=e("es5-ext/object/valid-callable"),l=e("es5-ext/object/valid-value"),u=Function.prototype.bind,c=Object.defineProperty,p=Object.prototype.hasOwnProperty;n=function(e,t,r){var n,o=l(t)&&d(t.value);return delete(n=i(t)).writable,delete n.value,n.get=function(){return!r.overwriteDefinition&&p.call(this,e)?o:(t.value=u.call(o,r.resolveContext?r.resolveContext(this):this),c(this,e,t),this[e])},n},t.exports=function(e){var r=o(arguments[1]);return null!=r.resolveContext&&a(r.resolveContext),s(e,function(e,t){return n(t,e,r)})}},{"es5-ext/object/copy":39,"es5-ext/object/map":48,"es5-ext/object/normalize-options":49,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55}],16:[function(e,t,r){"use strict";var s=e("es5-ext/object/assign"),d=e("es5-ext/object/normalize-options"),l=e("es5-ext/object/is-callable"),u=e("es5-ext/string/#/contains");(t.exports=function(e,t){var r,n,o,i,a;return arguments.length<2||"string"!=typeof e?(i=t,t=e,e=null):i=arguments[2],null==e?(r=o=!0,n=!1):(r=u.call(e,"c"),n=u.call(e,"e"),o=u.call(e,"w")),a={value:t,configurable:r,enumerable:n,writable:o},i?s(d(i),a):a}).gs=function(e,t,r){var n,o,i,a;return"string"!=typeof e?(i=r,r=t,t=e,e=null):i=arguments[3],null==t?t=void 0:l(t)?null==r?r=void 0:l(r)||(i=r,r=void 0):(i=t,t=r=void 0),o=null==e?!(n=!0):(n=u.call(e,"c"),u.call(e,"e")),a={get:t,set:r,configurable:n,enumerable:o},i?s(d(i),a):a}},{"es5-ext/object/assign":36,"es5-ext/object/is-callable":42,"es5-ext/object/normalize-options":49,"es5-ext/string/#/contains":56}],17:[function(u,c,e){(function(o,e){var a=u("readable-stream"),s=u("end-of-stream"),t=u("inherits"),r=u("stream-shift"),n=e.from&&e.from!==Uint8Array.from?e.from([0]):new e([0]),i=function(e,t){e._corked?e.once("uncork",t):t()},d=function(n,o){return function(e){var t,r;e?(t=n,r="premature close"===e.message?null:e,t._autoDestroy&&t.destroy(r)):o&&!n._ended&&n.end()}},l=function(e,t,r){if(!(this instanceof l))return new l(e,t,r);a.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)};t(l,a.Duplex),l.obj=function(e,t,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new l(e,t,r)},l.prototype.cork=function(){1==++this._corked&&this.emit("cork")},l.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},l.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)e&&e.destroy&&e.destroy();else if(null!==e&&!1!==e){var t=this,r=s(e,{writable:!0,readable:!1},d(this,this._forwardEnd)),n=function(){var e=t._ondrain;t._ondrain=null,e&&e()};this._unwrite&&o.nextTick(n),this._writable=e,this._writable.on("drain",n),this._unwrite=function(){t._writable.removeListener("drain",n),r()},this.uncork()}else this.end()},l.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)e&&e.destroy&&e.destroy();else{if(null===e||!1===e)return this.push(null),void this.resume();var t,r=this,n=s(e,{writable:!1,readable:!0},d(this)),o=function(){r._forward()},i=function(){r.push(null)};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:(t=e,new a.Readable({objectMode:!0,highWaterMark:16}).wrap(t)),this._readable2.on("readable",o),this._readable2.on("end",i),this._unread=function(){r._readable2.removeListener("readable",o),r._readable2.removeListener("end",i),n()},this._forward()}},l.prototype._read=function(){this._drained=!0,this._forward()},l.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var e;for(this._forwarding=!0;this._drained&&null!==(e=r(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},l.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0;var t=this;o.nextTick(function(){t._destroy(e)})}},l.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},l.prototype._write=function(e,t,r){return this.destroyed?r():this._corked?i(this,this._write.bind(this,e,t,r)):e===n?this._finish(r):this._writable?void(!1===this._writable.write(e)?this._ondrain=r:r()):r()},l.prototype._finish=function(r){var n=this;this.emit("preend"),i(this,function(){var e,t;e=n._forwardEnd&&n._writable,t=function(){!1===n._writableState.prefinished&&(n._writableState.prefinished=!0),n.emit("prefinish"),i(n,r)},e?e._writableState&&e._writableState.finished?t():e._writableState?e.end(t):(e.end(),t()):t()})},l.prototype.end=function(e,t,r){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(n),a.Writable.prototype.end.call(this,r))},c.exports=l}).call(this,u("_process"),u("buffer").Buffer)},{_process:92,buffer:12,"end-of-stream":18,inherits:80,"readable-stream":108,"stream-shift":111}],18:[function(e,t,r){var g=e("once"),v=function(){},y=function(t,e,r){if("function"==typeof e)return y(t,null,e);e||(e={}),r=g(r||v);var n,o,i=t._writableState,a=t._readableState,s=e.readable||!1!==e.readable&&t.readable,d=e.writable||!1!==e.writable&&t.writable,l=function(){t.writable||u()},u=function(){d=!1,s||r.call(t)},c=function(){s=!1,d||r.call(t)},p=function(e){r.call(t,e?new Error("exited with error code: "+e):null)},h=function(e){r.call(t,e)},f=function(){return(!s||a&&a.ended)&&(!d||i&&i.ended)?void 0:r.call(t,new Error("premature close"))},m=function(){t.req.on("finish",u)};return(n=t).setHeader&&"function"==typeof n.abort?(t.on("complete",u),t.on("abort",f),t.req?m():t.on("request",m)):d&&!i&&(t.on("end",l),t.on("close",l)),(o=t).stdio&&Array.isArray(o.stdio)&&3===o.stdio.length&&t.on("exit",p),t.on("end",c),t.on("finish",u),!1!==e.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("exit",p),t.removeListener("end",c),t.removeListener("error",h),t.removeListener("close",f)}};t.exports=y},{once:90}],19:[function(e,t,r){"use strict";var n=e("../../object/valid-value");t.exports=function(){return n(this).length=0,this}},{"../../object/valid-value":55}],20:[function(e,t,r){"use strict";var i=e("../../number/is-nan"),a=e("../../number/to-pos-integer"),s=e("../../object/valid-value"),d=Array.prototype.indexOf,l=Object.prototype.hasOwnProperty,u=Math.abs,c=Math.floor;t.exports=function(e){var t,r,n,o;if(!i(e))return d.apply(this,arguments);for(r=a(s(this).length),n=arguments[1],t=n=isNaN(n)?0:0<=n?c(n):a(this.length)-c(u(n));t<r;++t)if(l.call(this,t)&&(o=this[t],i(o)))return t;return-1}},{"../../number/is-nan":30,"../../number/to-pos-integer":34,"../../object/valid-value":55}],21:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":22,"./shim":23}],22:[function(e,t,r){"use strict";t.exports=function(){var e,t,r=Array.from;return"function"==typeof r&&(t=r(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},{}],23:[function(e,t,r){"use strict";var h=e("es6-symbol").iterator,f=e("../../function/is-arguments"),m=e("../../function/is-function"),g=e("../../number/to-pos-integer"),v=e("../../object/valid-callable"),y=e("../../object/valid-value"),_=e("../../object/is-value"),b=e("../../string/is-string"),S=Array.isArray,w=Function.prototype.call,E={configurable:!0,enumerable:!0,writable:!0,value:null},I=Object.defineProperty;t.exports=function(e){var t,r,n,o,i,a,s,d,l,u,c=arguments[1],p=arguments[2];if(e=Object(y(e)),_(c)&&v(c),this&&this!==Array&&m(this))t=this;else{if(!c){if(f(e))return 1!==(i=e.length)?Array.apply(null,e):((o=new Array(1))[0]=e[0],o);if(S(e)){for(o=new Array(i=e.length),r=0;r<i;++r)o[r]=e[r];return o}}o=[]}if(!S(e))if(void 0!==(l=e[h])){for(s=v(l).call(e),t&&(o=new t),d=s.next(),r=0;!d.done;)u=c?w.call(c,p,d.value,r):d.value,t?(E.value=u,I(o,r,E)):o[r]=u,d=s.next(),++r;i=r}else if(b(e)){for(i=e.length,t&&(o=new t),n=r=0;r<i;++r)u=e[r],r+1<i&&55296<=(a=u.charCodeAt(0))&&a<=56319&&(u+=e[++r]),u=c?w.call(c,p,u,n):u,t?(E.value=u,I(o,n,E)):o[n]=u,++n;i=n}if(void 0===i)for(i=g(e.length),t&&(o=new t(i)),r=0;r<i;++r)u=c?w.call(c,p,e[r],r):e[r],t?(E.value=u,I(o,r,E)):o[r]=u;return t&&(E.value=null,o.length=i),o}},{"../../function/is-arguments":24,"../../function/is-function":25,"../../number/to-pos-integer":34,"../../object/is-value":44,"../../object/valid-callable":54,"../../object/valid-value":55,"../../string/is-string":59,"es6-symbol":73}],24:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call(function(){return arguments}());t.exports=function(e){return n.call(e)===o}},{}],25:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call(e("./noop"));t.exports=function(e){return"function"==typeof e&&n.call(e)===o}},{"./noop":26}],26:[function(e,t,r){"use strict";t.exports=function(){}},{}],27:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(e,t,r){"use strict";t.exports=function(){var e=Math.sign;return"function"==typeof e&&(1===e(10)&&-1===e(-20))}},{}],29:[function(e,t,r){"use strict";t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:0<e?1:-1}},{}],30:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Number.isNaN:e("./shim")},{"./is-implemented":31,"./shim":32}],31:[function(e,t,r){"use strict";t.exports=function(){var e=Number.isNaN;return"function"==typeof e&&(!e({})&&e(NaN)&&!e(34))}},{}],32:[function(e,t,r){"use strict";t.exports=function(e){return e!=e}},{}],33:[function(e,t,r){"use strict";var n=e("../math/sign"),o=Math.abs,i=Math.floor;t.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?n(e)*i(o(e)):e}},{"../math/sign":27}],34:[function(e,t,r){"use strict";var n=e("./to-integer"),o=Math.max;t.exports=function(e){return o(0,n(e))}},{"./to-integer":33}],35:[function(e,t,r){"use strict";var s=e("./valid-callable"),d=e("./valid-value"),l=Function.prototype.bind,u=Function.prototype.call,c=Object.keys,p=Object.prototype.propertyIsEnumerable;t.exports=function(i,a){return function(r,n){var e,o=arguments[2],t=arguments[3];return r=Object(d(r)),s(n),e=c(r),t&&e.sort("function"==typeof t?l.call(t,r):void 0),"function"!=typeof i&&(i=e[i]),u.call(i,e,function(e,t){return p.call(r,e)?u.call(n,o,r[e],e,r,t):a})}}},{"./valid-callable":54,"./valid-value":55}],36:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":37,"./shim":38}],37:[function(e,t,r){"use strict";t.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],38:[function(e,t,r){"use strict";var a=e("../keys"),s=e("../valid-value"),d=Math.max;t.exports=function(t,r){var n,e,o,i=d(arguments.length,2);for(t=Object(s(t)),o=function(e){try{t[e]=r[e]}catch(e){n||(n=e)}},e=1;e<i;++e)r=arguments[e],a(r).forEach(o);if(void 0!==n)throw n;return t}},{"../keys":45,"../valid-value":55}],39:[function(e,t,r){"use strict";var i=e("../array/from"),a=e("./assign"),s=e("./valid-value");t.exports=function(t){var e=Object(s(t)),r=arguments[1],n=Object(arguments[2]);if(e!==t&&!r)return e;var o={};return r?i(r,function(e){(n.ensure||e in t)&&(o[e]=t[e])}):a(o,t),o}},{"../array/from":21,"./assign":36,"./valid-value":55}],40:[function(e,t,r){"use strict";var n,o,i,a,s=Object.create;e("./set-prototype-of/is-implemented")()||(n=e("./set-prototype-of/shim")),t.exports=n?1!==n.level?s:(a={configurable:(i={},!1),enumerable:(o={},!1),writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){i[e]="__proto__"!==e?a:{configurable:!0,enumerable:!1,writable:!0,value:void 0}}),Object.defineProperties(o,i),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:o}),function(e,t){return s(null===e?o:e,t)}):s},{"./set-prototype-of/is-implemented":52,"./set-prototype-of/shim":53}],41:[function(e,t,r){"use strict";t.exports=e("./_iterate")("forEach")},{"./_iterate":35}],42:[function(e,t,r){"use strict";t.exports=function(e){return"function"==typeof e}},{}],43:[function(e,t,r){"use strict";var n=e("./is-value"),o={function:!0,object:!0};t.exports=function(e){return n(e)&&o[typeof e]||!1}},{"./is-value":44}],44:[function(e,t,r){"use strict";var n=e("../function/noop")();t.exports=function(e){return e!==n&&null!==e}},{"../function/noop":26}],45:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":46,"./shim":47}],46:[function(e,t,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],47:[function(e,t,r){"use strict";var n=e("../is-value"),o=Object.keys;t.exports=function(e){return o(n(e)?Object(e):e)}},{"../is-value":44}],48:[function(e,t,r){"use strict";var n=e("./valid-callable"),s=e("./for-each"),d=Function.prototype.call;t.exports=function(e,o){var i={},a=arguments[2];return n(o),s(e,function(e,t,r,n){i[t]=d.call(o,a,e,t,r,n)}),i}},{"./for-each":41,"./valid-callable":54}],49:[function(e,t,r){"use strict";var n=e("./is-value"),o=Array.prototype.forEach,i=Object.create;t.exports=function(e){var t=i(null);return o.call(arguments,function(e){n(e)&&function(e,t){var r;for(r in e)t[r]=e[r]}(Object(e),t)}),t}},{"./is-value":44}],50:[function(e,t,r){"use strict";var n=Array.prototype.forEach,o=Object.create;t.exports=function(e){var t=o(null);return n.call(arguments,function(e){t[e]=!0}),t}},{}],51:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.setPrototypeOf:e("./shim")},{"./is-implemented":52,"./shim":53}],52:[function(e,t,r){"use strict";var n=Object.create,o=Object.getPrototypeOf,i={};t.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||n;return"function"==typeof e&&o(e(t(null),i))===i}},{}],53:[function(e,t,r){"use strict";var o,n,i,a,s=e("../is-object"),d=e("../valid-value"),l=Object.prototype.isPrototypeOf,u=Object.defineProperty,c={configurable:!0,enumerable:!1,writable:!0,value:void 0};o=function(e,t){if(d(e),null===t||s(t))return e;throw new TypeError("Prototype must be null or an object")},t.exports=(n=function(){var e,t=Object.create(null),r={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{(e=n.set).call(t,r)}catch(e){}if(Object.getPrototypeOf(t)===r)return{set:e,level:2}}return t.__proto__=r,Object.getPrototypeOf(t)===r?{level:2}:((t={}).__proto__=r,Object.getPrototypeOf(t)===r&&{level:1})}())?(i=2===n.level?n.set?(a=n.set,function(e,t){return a.call(o(e,t),t),e}):function(e,t){return o(e,t).__proto__=t,e}:function e(t,r){var n;return o(t,r),(n=l.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===r&&(r=e.nullPolyfill),t.__proto__=r,n&&u(e.nullPolyfill,"__proto__",c),t},Object.defineProperty(i,"level",{configurable:!1,enumerable:!1,writable:!1,value:n.level})):null,e("../create")},{"../create":40,"../is-object":43,"../valid-value":55}],54:[function(e,t,r){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],55:[function(e,t,r){"use strict";var n=e("./is-value");t.exports=function(e){if(!n(e))throw new TypeError("Cannot use null or undefined");return e}},{"./is-value":44}],56:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":57,"./shim":58}],57:[function(e,t,r){"use strict";var n="razdwatrzy";t.exports=function(){return"function"==typeof n.contains&&(!0===n.contains("dwa")&&!1===n.contains("foo"))}},{}],58:[function(e,t,r){"use strict";var n=String.prototype.indexOf;t.exports=function(e){return-1<n.call(this,e,arguments[1])}},{}],59:[function(e,t,r){"use strict";var n=Object.prototype.toString,o=n.call("");t.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||n.call(e)===o)||!1}},{}],60:[function(e,t,r){"use strict";var n,o=e("es5-ext/object/set-prototype-of"),i=e("es5-ext/string/#/contains"),a=e("d"),s=e("es6-symbol"),d=e("./"),l=Object.defineProperty;n=t.exports=function(e,t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");d.call(this,e),t=t?i.call(t,"key+value")?"key+value":i.call(t,"key")?"key":"value":"value",l(this,"__kind__",a("",t))},o&&o(n,d),delete n.prototype.constructor,n.prototype=Object.create(d.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),l(n.prototype,s.toStringTag,a("c","Array Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es5-ext/string/#/contains":56,"es6-symbol":73}],61:[function(e,t,r){"use strict";var c=e("es5-ext/function/is-arguments"),p=e("es5-ext/object/valid-callable"),h=e("es5-ext/string/is-string"),f=e("./get"),m=Array.isArray,g=Function.prototype.call,v=Array.prototype.some;t.exports=function(e,t){var r,n,o,i,a,s,d,l,u=arguments[2];if(m(e)||c(e)?r="array":h(e)?r="string":e=f(e),p(t),o=function(){i=!0},"array"!==r)if("string"!==r)for(n=e.next();!n.done;){if(g.call(t,u,n.value,o),i)return;n=e.next()}else for(s=e.length,a=0;a<s&&(d=e[a],a+1<s&&55296<=(l=d.charCodeAt(0))&&l<=56319&&(d+=e[++a]),g.call(t,u,d,o),!i);++a);else v.call(e,function(e){return g.call(t,u,e,o),i})}},{"./get":62,"es5-ext/function/is-arguments":24,"es5-ext/object/valid-callable":54,"es5-ext/string/is-string":59}],62:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),o=e("es5-ext/string/is-string"),i=e("./array"),a=e("./string"),s=e("./valid-iterable"),d=e("es6-symbol").iterator;t.exports=function(e){return"function"==typeof s(e)[d]?e[d]():n(e)?new i(e):o(e)?new a(e):new i(e)}},{"./array":60,"./string":65,"./valid-iterable":66,"es5-ext/function/is-arguments":24,"es5-ext/string/is-string":59,"es6-symbol":73}],63:[function(e,t,r){"use strict";var n,o=e("es5-ext/array/#/clear"),i=e("es5-ext/object/assign"),a=e("es5-ext/object/valid-callable"),s=e("es5-ext/object/valid-value"),d=e("d"),l=e("d/auto-bind"),u=e("es6-symbol"),c=Object.defineProperty,p=Object.defineProperties;t.exports=n=function(e,t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");p(this,{__list__:d("w",s(e)),__context__:d("w",t),__nextIndex__:d("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete n.prototype.constructor,p(n.prototype,i({_next:d(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:d(function(){return this._createResult(this._next())}),_createResult:d(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:d(function(e){return this.__list__[e]}),_unBind:d(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:d(function(){return"[object "+(this[u.toStringTag]||"Object")+"]"})},l({_onAdd:d(function(r){r>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(e,t){r<=e&&(this.__redo__[t]=++e)},this),this.__redo__.push(r)):c(this,"__redo__",d("c",[r])))}),_onDelete:d(function(r){var e;r>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(e=this.__redo__.indexOf(r))&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,t){r<e&&(this.__redo__[t]=--e)},this)))}),_onClear:d(function(){this.__redo__&&o.call(this.__redo__),this.__nextIndex__=0})}))),c(n.prototype,u.iterator,d(function(){return this}))},{d:16,"d/auto-bind":15,"es5-ext/array/#/clear":19,"es5-ext/object/assign":36,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-symbol":73}],64:[function(e,t,r){"use strict";var n=e("es5-ext/function/is-arguments"),o=e("es5-ext/object/is-value"),i=e("es5-ext/string/is-string"),a=e("es6-symbol").iterator,s=Array.isArray;t.exports=function(e){return!!o(e)&&(!!s(e)||(!!i(e)||(!!n(e)||"function"==typeof e[a])))}},{"es5-ext/function/is-arguments":24,"es5-ext/object/is-value":44,"es5-ext/string/is-string":59,"es6-symbol":73}],65:[function(e,t,r){"use strict";var n,o=e("es5-ext/object/set-prototype-of"),i=e("d"),a=e("es6-symbol"),s=e("./"),d=Object.defineProperty;n=t.exports=function(e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");e=String(e),s.call(this,e),d(this,"__length__",i("",e.length))},o&&o(n,s),delete n.prototype.constructor,n.prototype=Object.create(s.prototype,{_next:i(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:i(function(e){var t,r=this.__list__[e];return this.__nextIndex__===this.__length__?r:55296<=(t=r.charCodeAt(0))&&t<=56319?r+this.__list__[this.__nextIndex__++]:r})}),d(n.prototype,a.toStringTag,i("c","String Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es6-symbol":73}],66:[function(e,t,r){"use strict";var n=e("./is-iterable");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not iterable");return e}},{"./is-iterable":64}],67:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Map:e("./polyfill")},{"./is-implemented":68,"./polyfill":72}],68:[function(e,t,r){"use strict";t.exports=function(){var e,t;if("function"!=typeof Map)return!1;try{e=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(e){return!1}return"[object Map]"===String(e)&&(3===e.size&&("function"==typeof e.clear&&("function"==typeof e.delete&&("function"==typeof e.entries&&("function"==typeof e.forEach&&("function"==typeof e.get&&("function"==typeof e.has&&("function"==typeof e.keys&&("function"==typeof e.set&&("function"==typeof e.values&&(!1===(t=e.entries().next()).done&&(!!t.value&&("raz"===t.value[0]&&"one"===t.value[1])))))))))))))}},{}],69:[function(e,t,r){"use strict";t.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},{}],70:[function(e,t,r){"use strict";t.exports=e("es5-ext/object/primitive-set")("key","value","key+value")},{"es5-ext/object/primitive-set":50}],71:[function(e,t,r){"use strict";var n,o=e("es5-ext/object/set-prototype-of"),i=e("d"),a=e("es6-iterator"),s=e("es6-symbol").toStringTag,d=e("./iterator-kinds"),l=Object.defineProperties,u=a.prototype._unBind;n=t.exports=function(e,t){if(!(this instanceof n))return new n(e,t);a.call(this,e.__mapKeysData__,e),t&&d[t]||(t="key+value"),l(this,{__kind__:i("",t),__values__:i("w",e.__mapValuesData__)})},o&&o(n,a),n.prototype=Object.create(a.prototype,{constructor:i(n),_resolve:i(function(e){return"value"===this.__kind__?this.__values__[e]:"key"===this.__kind__?this.__list__[e]:[this.__list__[e],this.__values__[e]]}),_unBind:i(function(){this.__values__=null,u.call(this)}),toString:i(function(){return"[object Map Iterator]"})}),Object.defineProperty(n.prototype,s,i("c","Map Iterator"))},{"./iterator-kinds":70,d:16,"es5-ext/object/set-prototype-of":51,"es6-iterator":63,"es6-symbol":73}],72:[function(e,t,r){"use strict";var o,n=e("es5-ext/array/#/clear"),i=e("es5-ext/array/#/e-index-of"),a=e("es5-ext/object/set-prototype-of"),s=e("es5-ext/object/valid-callable"),d=e("es5-ext/object/valid-value"),l=e("d"),u=e("event-emitter"),c=e("es6-symbol"),p=e("es6-iterator/valid-iterable"),h=e("es6-iterator/for-of"),f=e("./lib/iterator"),m=e("./is-native-implemented"),g=Function.prototype.call,v=Object.defineProperties,y=Object.getPrototypeOf;t.exports=o=function(){var r,n,e,t=arguments[0];if(!(this instanceof o))throw new TypeError("Constructor requires 'new'");return e=m&&a&&Map!==o?a(new Map,y(this)):this,null!=t&&p(t),v(e,{__mapKeysData__:l("c",r=[]),__mapValuesData__:l("c",n=[])}),t&&h(t,function(e){var t=d(e)[0];e=e[1],-1===i.call(r,t)&&(r.push(t),n.push(e))},e),e},m&&(a&&a(o,Map),o.prototype=Object.create(Map.prototype,{constructor:l(o)})),u(v(o.prototype,{clear:l(function(){this.__mapKeysData__.length&&(n.call(this.__mapKeysData__),n.call(this.__mapValuesData__),this.emit("_clear"))}),delete:l(function(e){var t=i.call(this.__mapKeysData__,e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),this.emit("_delete",t,e),!0)}),entries:l(function(){return new f(this,"key+value")}),forEach:l(function(e){var t,r,n=arguments[1];for(s(e),r=(t=this.entries())._next();void 0!==r;)g.call(e,n,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=t._next()}),get:l(function(e){var t=i.call(this.__mapKeysData__,e);if(-1!==t)return this.__mapValuesData__[t]}),has:l(function(e){return-1!==i.call(this.__mapKeysData__,e)}),keys:l(function(){return new f(this,"key")}),set:l(function(e,t){var r,n=i.call(this.__mapKeysData__,e);return-1===n&&(n=this.__mapKeysData__.push(e)-1,r=!0),this.__mapValuesData__[n]=t,r&&this.emit("_add",n,e),this}),size:l.gs(function(){return this.__mapKeysData__.length}),values:l(function(){return new f(this,"value")}),toString:l(function(){return"[object Map]"})})),Object.defineProperty(o.prototype,c.iterator,l(function(){return this.entries()})),Object.defineProperty(o.prototype,c.toStringTag,l("c","Map"))},{"./is-native-implemented":69,"./lib/iterator":71,d:16,"es5-ext/array/#/clear":19,"es5-ext/array/#/e-index-of":20,"es5-ext/object/set-prototype-of":51,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-iterator/for-of":61,"es6-iterator/valid-iterable":66,"es6-symbol":73,"event-emitter":78}],73:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Symbol:e("./polyfill")},{"./is-implemented":74,"./polyfill":76}],74:[function(e,t,r){"use strict";var n={object:!0,symbol:!0};t.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!n[typeof Symbol.iterator]&&(!!n[typeof Symbol.toPrimitive]&&!!n[typeof Symbol.toStringTag])}},{}],75:[function(e,t,r){"use strict";t.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&("Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag]))}},{}],76:[function(e,t,r){"use strict";var n,o,i,a,s=e("d"),d=e("./validate-symbol"),l=Object.create,u=Object.defineProperties,c=Object.defineProperty,p=Object.prototype,h=l(null);if("function"==typeof Symbol){n=Symbol;try{String(n()),a=!0}catch(e){}}var f,m=(f=l(null),function(e){for(var t,r,n=0;f[e+(n||"")];)++n;return f[e+=n||""]=!0,c(p,t="@@"+e,s.gs(null,function(e){r||(r=!0,c(this,t,s(e)),r=!1)})),t});i=function(e){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return o(e)},t.exports=o=function e(t){var r;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return a?n(t):(r=l(i.prototype),t=void 0===t?"":String(t),u(r,{__description__:s("",t),__name__:s("",m(t))}))},u(o,{for:s(function(e){return h[e]?h[e]:h[e]=o(String(e))}),keyFor:s(function(e){var t;for(t in d(e),h)if(h[t]===e)return t}),hasInstance:s("",n&&n.hasInstance||o("hasInstance")),isConcatSpreadable:s("",n&&n.isConcatSpreadable||o("isConcatSpreadable")),iterator:s("",n&&n.iterator||o("iterator")),match:s("",n&&n.match||o("match")),replace:s("",n&&n.replace||o("replace")),search:s("",n&&n.search||o("search")),species:s("",n&&n.species||o("species")),split:s("",n&&n.split||o("split")),toPrimitive:s("",n&&n.toPrimitive||o("toPrimitive")),toStringTag:s("",n&&n.toStringTag||o("toStringTag")),unscopables:s("",n&&n.unscopables||o("unscopables"))}),u(i.prototype,{constructor:s(o),toString:s("",function(){return this.__name__})}),u(o.prototype,{toString:s(function(){return"Symbol ("+d(this).__description__+")"}),valueOf:s(function(){return d(this)})}),c(o.prototype,o.toPrimitive,s("",function(){var e=d(this);return"symbol"==typeof e?e:e.toString()})),c(o.prototype,o.toStringTag,s("c","Symbol")),c(i.prototype,o.toStringTag,s("c",o.prototype[o.toStringTag])),c(i.prototype,o.toPrimitive,s("c",o.prototype[o.toPrimitive]))},{"./validate-symbol":77,d:16}],77:[function(e,t,r){"use strict";var n=e("./is-symbol");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":75}],78:[function(e,t,r){"use strict";var o,n,i,a,s,d,l,u=e("d"),c=e("es5-ext/object/valid-callable"),p=Function.prototype.apply,h=Function.prototype.call,f=Object.create,m=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};n=function(e,t){var r,n;return c(t),o.call(n=this,e,r=function(){i.call(n,e,r),p.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:o=function(e,t){var r;return c(t),v.call(this,"__ee__")?r=this.__ee__:(r=y.value=f(null),m(this,"__ee__",y),y.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:n,off:i=function(e,t){var r,n,o,i;if(c(t),!v.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==typeof(n=r[e]))for(i=0;o=n[i];++i)o!==t&&o.__eeOnceListener__!==t||(2===n.length?r[e]=n[i?0:1]:n.splice(i,1));else n!==t&&n.__eeOnceListener__!==t||delete r[e];return this},emit:a=function(e){var t,r,n,o,i;if(v.call(this,"__ee__")&&(o=this.__ee__[e]))if("object"==typeof o){for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];for(o=o.slice(),t=0;n=o[t];++t)p.call(n,this,i)}else switch(arguments.length){case 1:h.call(o,this);break;case 2:h.call(o,this,arguments[1]);break;case 3:h.call(o,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];p.call(o,this,i)}}},d={on:u(o),once:u(n),off:u(i),emit:u(a)},l=g({},d),t.exports=r=function(e){return null==e?f(l):g(Object(e),d)},r.methods=s},{d:16,"es5-ext/object/valid-callable":54}],79:[function(e,t,r){r.read=function(e,t,r,n,o){var i,a,s=8*o-n-1,d=(1<<s)-1,l=d>>1,u=-7,c=r?o-1:0,p=r?-1:1,h=e[t+c];for(c+=p,i=h&(1<<-u)-1,h>>=-u,u+=s;0<u;i=256*i+e[t+c],c+=p,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=n;0<u;a=256*a+e[t+c],c+=p,u-=8);if(0===i)i=1-l;else{if(i===d)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),i-=l}return(h?-1:1)*a*Math.pow(2,i-n)},r.write=function(e,t,r,n,o,i){var a,s,d,l=8*i-o-1,u=(1<<l)-1,c=u>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:i-1,f=n?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-a))<1&&(a--,d*=2),2<=(t+=1<=a+c?p/d:p*Math.pow(2,1-c))*d&&(a++,d/=2),u<=a+c?(s=0,a=u):1<=a+c?(s=(t*d-1)*Math.pow(2,o),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,o),a=0));8<=o;e[r+h]=255&s,h+=f,s/=256,o-=8);for(a=a<<o|s,l+=o;0<l;e[r+h]=255&a,h+=f,a/=256,l-=8);e[r+h-f]|=128*m}},{}],80:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],81:[function(e,t,r){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(n(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))||!!e._isBuffer);var t}},{}],82:[function(e,t,r){"use strict";var i=e("safe-buffer").Buffer,a=t.exports;for(var n in a.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},a.codes={},a.types){var o=a.types[n];a.codes[o]=n}for(var s in a.CMD_SHIFT=4,a.CMD_MASK=240,a.DUP_MASK=8,a.QOS_MASK=3,a.QOS_SHIFT=1,a.RETAIN_MASK=1,a.LENGTH_MASK=127,a.LENGTH_FIN_MASK=128,a.SESSIONPRESENT_MASK=1,a.SESSIONPRESENT_HEADER=i.from([a.SESSIONPRESENT_MASK]),a.CONNACK_HEADER=i.from([a.codes.connack<<a.CMD_SHIFT]),a.USERNAME_MASK=128,a.PASSWORD_MASK=64,a.WILL_RETAIN_MASK=32,a.WILL_QOS_MASK=24,a.WILL_QOS_SHIFT=3,a.WILL_FLAG_MASK=4,a.CLEAN_SESSION_MASK=2,a.CONNECT_HEADER=i.from([a.codes.connect<<a.CMD_SHIFT]),a.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},a.propertiesCodes={},a.properties){var d=a.properties[s];a.propertiesCodes[d]=s}function l(o){return[0,1,2].map(function(n){return[0,1].map(function(r){return[0,1].map(function(e){var t=new i(1);return t.writeUInt8(a.codes[o]<<a.CMD_SHIFT|(r?a.DUP_MASK:0)|n<<a.QOS_SHIFT|e,0,!0),t})})})}a.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int32",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},a.PUBLISH_HEADER=l("publish"),a.SUBSCRIBE_HEADER=l("subscribe"),a.SUBSCRIBE_OPTIONS_QOS_MASK=3,a.SUBSCRIBE_OPTIONS_NL_MASK=1,a.SUBSCRIBE_OPTIONS_NL_SHIFT=2,a.SUBSCRIBE_OPTIONS_RAP_MASK=1,a.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,a.SUBSCRIBE_OPTIONS_RH_MASK=3,a.SUBSCRIBE_OPTIONS_RH_SHIFT=4,a.SUBSCRIBE_OPTIONS_RH=[0,16,32],a.SUBSCRIBE_OPTIONS_NL=4,a.SUBSCRIBE_OPTIONS_RAP=8,a.SUBSCRIBE_OPTIONS_QOS=[0,1,2],a.UNSUBSCRIBE_HEADER=l("unsubscribe"),a.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},a.SUBACK_HEADER=i.from([a.codes.suback<<a.CMD_SHIFT]),a.VERSION3=i.from([3]),a.VERSION4=i.from([4]),a.VERSION5=i.from([5]),a.QOS=[0,1,2].map(function(e){return i.from([e])}),a.EMPTY={pingreq:i.from([a.codes.pingreq<<4,0]),pingresp:i.from([a.codes.pingresp<<4,0]),disconnect:i.from([a.codes.disconnect<<4,0])}},{"safe-buffer":110}],83:[function(e,t,r){"use strict";var a=e("safe-buffer").Buffer,n=e("./writeToStream"),o=e("events").EventEmitter;function i(){this._array=new Array(20),this._i=0}e("inherits")(i,o),i.prototype.write=function(e){return this._array[this._i++]=e,!0},i.prototype.concat=function(){var e,t,r=0,n=new Array(this._array.length),o=this._array,i=0;for(e=0;e<o.length&&void 0!==o[e];e++)"string"!=typeof o[e]?n[e]=o[e].length:n[e]=a.byteLength(o[e]),r+=n[e];for(t=a.allocUnsafe(r),e=0;e<o.length&&void 0!==o[e];e++)"string"!=typeof o[e]?o[e].copy(t,i):t.write(o[e],i),i+=n[e];return t},t.exports=function(e,t){var r=new i;return n(e,r,t),r.concat()}},{"./writeToStream":89,events:13,inherits:80,"safe-buffer":110}],84:[function(e,t,r){"use strict";r.parser=e("./parser"),r.generate=e("./generate"),r.writeToStream=e("./writeToStream")},{"./generate":83,"./parser":88,"./writeToStream":89}],85:[function(e,t,r){var n=e("readable-stream/duplex"),o=e("util"),p=e("safe-buffer").Buffer;function i(e){if(!(this instanceof i))return new i(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)})}else this.append(e);n.call(this)}o.inherits(i,n),i.prototype._offset=function(e){var t,r=0,n=0;if(0===e)return[0,0];for(;n<this._bufs.length;n++){if(e<(t=r+this._bufs[n].length)||n==this._bufs.length-1)return[n,e-r];r=t}},i.prototype.append=function(e){var t=0;if(p.isBuffer(e))this._appendBuffer(e);else if(Array.isArray(e))for(;t<e.length;t++)this.append(e[t]);else if(e instanceof i)for(;t<e._bufs.length;t++)this.append(e._bufs[t]);else null!=e&&("number"==typeof e&&(e=e.toString()),this._appendBuffer(p.from(e)));return this},i.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},i.prototype._write=function(e,t,r){this._appendBuffer(e),"function"==typeof r&&r()},i.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},i.prototype.end=function(e){n.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},i.prototype.get=function(e){return this.slice(e,e+1)[0]},i.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},i.prototype.copy=function(e,t,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return e||p.alloc(0);if(n<=0)return e||p.alloc(0);var o,i,a=!!e,s=this._offset(r),d=n-r,l=d,u=a&&t||0,c=s[1];if(0===r&&n==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:p.concat(this._bufs,this.length);for(i=0;i<this._bufs.length;i++)this._bufs[i].copy(e,u),u+=this._bufs[i].length;return e}if(l<=this._bufs[s[0]].length-c)return a?this._bufs[s[0]].copy(e,t,c,c+l):this._bufs[s[0]].slice(c,c+l);for(a||(e=p.allocUnsafe(d)),i=s[0];i<this._bufs.length;i++){if(!((o=this._bufs[i].length-c)<l)){this._bufs[i].copy(e,u,c,c+l);break}this._bufs[i].copy(e,u,c),u+=o,l-=o,c&&(c=0)}return e},i.prototype.shallowSlice=function(e,t){e=e||0,t=t||this.length,e<0&&(e+=this.length),t<0&&(t+=this.length);var r=this._offset(e),n=this._offset(t),o=this._bufs.slice(r[0],n[0]+1);return 0==n[1]?o.pop():o[o.length-1]=o[o.length-1].slice(0,n[1]),0!=r[1]&&(o[0]=o[0].slice(r[1])),new i(o)},i.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},i.prototype.consume=function(e){for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},i.prototype.duplicate=function(){for(var e=0,t=new i;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},i.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var e in r)!function(t){i.prototype[t]=function(e){return this.slice(e,e+r[t])[t](0)}}(e)}(),t.exports=i},{"readable-stream/duplex":97,"safe-buffer":110,util:117}],86:[function(e,t,r){"use strict";var a=e("safe-buffer").Buffer,n={};function o(e){var t=a.allocUnsafe(2);return t.writeUInt8(e>>8,0),t.writeUInt8(255&e,1),t}t.exports={cache:n,generateCache:function(){for(var e=0;e<65536;e++)n[e]=o(e)},generateNumber:o,genBufVariableByteInt:function(e){for(var t,r=0,n=0,o=0<=(t=e)&&t<128?1:128<=t&&t<16384?2:16384<=t&&t<2097152?3:2097152<=t&&t<268435456?4:0,i=a.allocUnsafe(o);r=e%128|0,0<(e=e/128|0)&&(r|=128),i.writeUInt8(r,n++),0<e;);return{data:i,length:o}},generate4ByteBuffer:function(e){var t=a.allocUnsafe(4);return t.writeUInt32BE(e,0),t}}},{"safe-buffer":110}],87:[function(e,t,r){t.exports=function(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}},{}],88:[function(e,t,r){"use strict";var n=e("bl"),o=e("inherits"),i=e("events").EventEmitter,a=e("./packet"),u=e("./constants");function s(e){if(!(this instanceof s))return new s(e);this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}o(s,i),s.prototype._resetState=function(){this.packet=new a,this.error=null,this._list=n(),this._stateCounter=0},s.prototype.parse=function(e){for(this.error&&this._resetState(),this._list.append(e);(-1!==this.packet.length||0<this._list.length)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},s.prototype._parseHeader=function(){var e=this._list.readUInt8(0);return this.packet.cmd=u.types[e>>u.CMD_SHIFT],this.packet.retain=0!=(e&u.RETAIN_MASK),this.packet.qos=e>>u.QOS_SHIFT&u.QOS_MASK,this.packet.dup=0!=(e&u.DUP_MASK),this._list.consume(1),!0},s.prototype._parseLength=function(){var e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),!!e},s.prototype._parsePayload=function(){var e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return e},s.prototype._parseConnect=function(){var e,t,r,n,o,i,a={},s=this.packet;if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==e&&"MQIsdp"!==e)return this._emitError(new Error("Invalid protocolId"));if(s.protocolId=e,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.protocolVersion=this._list.readUInt8(this._pos),3!==s.protocolVersion&&4!==s.protocolVersion&&5!==s.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(a.username=this._list.readUInt8(this._pos)&u.USERNAME_MASK,a.password=this._list.readUInt8(this._pos)&u.PASSWORD_MASK,a.will=this._list.readUInt8(this._pos)&u.WILL_FLAG_MASK,a.will&&(s.will={},s.will.retain=0!=(this._list.readUInt8(this._pos)&u.WILL_RETAIN_MASK),s.will.qos=(this._list.readUInt8(this._pos)&u.WILL_QOS_MASK)>>u.WILL_QOS_SHIFT),s.clean=0!=(this._list.readUInt8(this._pos)&u.CLEAN_SESSION_MASK),this._pos++,s.keepalive=this._parseNum(),-1===s.keepalive)return this._emitError(new Error("Packet too short"));if(5===s.protocolVersion){var d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(s.properties=d)}if(null===(t=this._parseString()))return this._emitError(new Error("Packet too short"));if(s.clientId=t,a.will){if(5===s.protocolVersion){var l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(s.will.properties=l)}if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(s.will.topic=r,null===(n=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));s.will.payload=n}if(a.username){if(null===(i=this._parseString()))return this._emitError(new Error("Cannot parse username"));s.username=i}if(a.password){if(null===(o=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));s.password=o}return this.settings=s},s.prototype._parseConnack=function(){var e=this.packet;if(this._list.length<2)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&u.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?e.reasonCode=this._list.readUInt8(this._pos++):e.returnCode=this._list.readUInt8(this._pos++),-1===e.returnCode||-1===e.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}},s.prototype._parsePublish=function(){var e=this.packet;if(e.topic=this._parseString(),null===e.topic)return this._emitError(new Error("Cannot parse topic"));if(!(0<e.qos)||this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}e.payload=this._list.slice(this._pos,e.length)}},s.prototype._parseSubscribe=function(){var e,t,r,n,o,i,a,s=this.packet;if(1!==s.qos)return this._emitError(new Error("Wrong subscribe header"));if(s.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(s.properties=d)}for(;this._pos<s.length;){if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse topic"));r=(t=this._parseByte())&u.SUBSCRIBE_OPTIONS_QOS_MASK,i=0!=(t>>u.SUBSCRIBE_OPTIONS_NL_SHIFT&u.SUBSCRIBE_OPTIONS_NL_MASK),o=0!=(t>>u.SUBSCRIBE_OPTIONS_RAP_SHIFT&u.SUBSCRIBE_OPTIONS_RAP_MASK),n=t>>u.SUBSCRIBE_OPTIONS_RH_SHIFT&u.SUBSCRIBE_OPTIONS_RH_MASK,a={topic:e,qos:r},5===this.settings.protocolVersion&&(a.nl=i,a.rap=o,a.rh=n),s.subscriptions.push(a)}}},s.prototype._parseSuback=function(){var e=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},s.prototype._parseUnsubscribe=function(){var e=this.packet;if(e.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<e.length;){var r;if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse topic"));e.unsubscriptions.push(r)}}},s.prototype._parseUnsuback=function(){var e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},s.prototype._parseConfirmation=function(){var e=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&2<e.length){e.reasonCode=this._parseByte();var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0},s.prototype._parseDisconnect=function(){var e=this.packet;if(5===this.settings.protocolVersion){e.reasonCode=this._parseByte();var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0},s.prototype._parseAuth=function(){var e=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();var t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),!0},s.prototype._parseMessageId=function(){var e=this.packet;return e.messageId=this._parseNum(),null!==e.messageId||(this._emitError(new Error("Cannot parse messageId")),!1)},s.prototype._parseString=function(e){var t,r=this._parseNum(),n=r+this._pos;return-1===r||n>this._list.length||n>this.packet.length?null:(t=this._list.toString("utf8",this._pos,n),this._pos+=r,t)},s.prototype._parseStringPair=function(){return{name:this._parseString(),value:this._parseString()}},s.prototype._parseBuffer=function(){var e,t=this._parseNum(),r=t+this._pos;return-1===t||r>this._list.length||r>this.packet.length?null:(e=this._list.slice(this._pos,r),this._pos+=t,e)},s.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var e=this._list.readUInt16BE(this._pos);return this._pos+=2,e},s.prototype._parse4ByteNum=function(){if(this._list.length-this._pos<4)return-1;var e=this._list.readUInt32BE(this._pos);return this._pos+=4,e},s.prototype._parseVarByteNum=function(e){for(var t,r=0,n=1,o=0,i=!0,a=this._pos?this._pos:0;r<5&&(o+=n*((t=this._list.readUInt8(a+r++))&u.LENGTH_MASK),n*=128,0!=(t&u.LENGTH_FIN_MASK));)if(this._list.length<=r){i=!1;break}return a&&(this._pos+=r),i=!!i&&(e?{bytes:r,value:o}:o)},s.prototype._parseByte=function(){var e=this._list.readUInt8(this._pos);return this._pos++,e},s.prototype._parseByType=function(e){switch(e){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},s.prototype._parseProperties=function(){for(var e=this._parseVarByteNum(),t=this._pos+e,r={};this._pos<t;){var n=this._parseByte(),o=u.propertiesCodes[n];if(!o)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==o)r[o]=this._parseByType(u.propertiesTypes[o]);else{r[o]||(r[o]={});var i=this._parseByType(u.propertiesTypes[o]);r[o][i.name]=i.value}}return r},s.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new a,!(this._pos=0)},s.prototype._emitError=function(e){this.error=e,this.emit("error",e)},t.exports=s},{"./constants":82,"./packet":87,bl:85,events:13,inherits:80}],89:[function(e,t,r){"use strict";var C=e("./constants"),R=e("safe-buffer").Buffer,h=R.allocUnsafe(0),l=R.from([0]),n=e("./numbers"),o=e("process-nextick-args").nextTick,i=n.cache,a=n.generateNumber,s=n.generateCache,d=n.genBufVariableByteInt,u=n.generate4ByteBuffer,P=g,c=!0;function p(e,t,r){switch(t.cork&&(t.cork(),o(f,t)),c&&(c=!1,s()),e.cmd){case"connect":return function(e,t,r){var n=e||{},o=n.protocolId||"MQTT",i=n.protocolVersion||4,a=n.will,s=n.clean,d=n.keepalive||0,l=n.clientId||"",u=n.username,c=n.password,p=n.properties;void 0===s&&(s=!0);var h=0;{if(!o||"string"!=typeof o&&!R.isBuffer(o))return t.emit("error",new Error("Invalid protocolId")),!1;h+=o.length+2}{if(3!==i&&4!==i&&5!==i)return t.emit("error",new Error("Invalid protocol version")),!1;h+=1}if("string"!=typeof l&&!R.isBuffer(l)||!l&&4!==i||!l&&!s){if(i<4)return t.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*s==0)return t.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else h+=l.length+2;{if("number"!=typeof d||d<0||65535<d||d%1!=0)return t.emit("error",new Error("Invalid keepalive")),!1;h+=2}if(h+=1,5===i){var f=M(t,p);h+=f.length}if(a){if("object"!=typeof a)return t.emit("error",new Error("Invalid will")),!1;if(!a.topic||"string"!=typeof a.topic)return t.emit("error",new Error("Invalid will topic")),!1;if(h+=R.byteLength(a.topic)+2,a.payload){if(!(0<=a.payload.length))return t.emit("error",new Error("Invalid will payload")),!1;"string"==typeof a.payload?h+=R.byteLength(a.payload)+2:h+=a.payload.length+2;var m={};5===i&&(m=M(t,a.properties),h+=m.length)}}var g=!1;if(null!=u){if(!w(u))return t.emit("error",new Error("Invalid username")),!1;g=!0,h+=R.byteLength(u)+2}if(null!=c){if(!g)return t.emit("error",new Error("Username is required to use password")),!1;if(!w(c))return t.emit("error",new Error("Invalid password")),!1;h+=S(c)+2}t.write(C.CONNECT_HEADER),k(t,h),y(t,o),t.write(4===i?C.VERSION4:5===i?C.VERSION5:C.VERSION3);var v=0;v|=null!=u?C.USERNAME_MASK:0,v|=null!=c?C.PASSWORD_MASK:0,v|=a&&a.retain?C.WILL_RETAIN_MASK:0,v|=a&&a.qos?a.qos<<C.WILL_QOS_SHIFT:0,v|=a?C.WILL_FLAG_MASK:0,v|=s?C.CLEAN_SESSION_MASK:0,t.write(R.from([v])),P(t,d),5===i&&f.write();y(t,l),a&&(5===i&&m.write(),x(t,a.topic),y(t,a.payload));null!=u&&y(t,u);null!=c&&y(t,c);return!0}(e,t);case"connack":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=5===n?o.reasonCode:o.returnCode,a=o.properties,s=2;if("number"!=typeof i)return t.emit("error",new Error("Invalid return code")),!1;var d=null;5===n&&(d=M(t,a),s+=d.length);t.write(C.CONNACK_HEADER),k(t,s),t.write(o.sessionPresent?C.SESSIONPRESENT_HEADER:l),t.write(R.from([i])),null!=d&&d.write();return!0}(e,t,r);case"publish":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.qos||0,a=o.retain?C.RETAIN_MASK:0,s=o.topic,d=o.payload||h,l=o.messageId,u=o.properties,c=0;if("string"==typeof s)c+=R.byteLength(s)+2;else{if(!R.isBuffer(s))return t.emit("error",new Error("Invalid topic")),!1;c+=s.length+2}R.isBuffer(d)?c+=d.length:c+=R.byteLength(d);{if(i&&"number"!=typeof l)return t.emit("error",new Error("Invalid messageId")),!1;i&&(c+=2)}var p=null;5===n&&(p=M(t,u),c+=p.length);t.write(C.PUBLISH_HEADER[i][o.dup?1:0][a?1:0]),k(t,c),P(t,S(s)),t.write(s),0<i&&P(t,l);null!=p&&p.write();return t.write(d)}(e,t,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.cmd||"puback",a=o.messageId,s=o.dup&&"pubrel"===i?C.DUP_MASK:0,d=0,l=o.reasonCode,u=o.properties,c=5===n?3:2;"pubrel"===i&&(d=1);if("number"!=typeof a)return t.emit("error",new Error("Invalid messageId")),!1;var p=null;if(5===n){if(!(p=_(t,u,r,c)))return!1;c+=p.length}t.write(C.ACKS[i][d][s][0]),k(t,c),P(t,a),5===n&&t.write(R.from([l]));null!==p&&p.write();return!0}(e,t,r);case"subscribe":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.dup?C.DUP_MASK:0,a=o.messageId,s=o.subscriptions,d=o.properties,l=0;{if("number"!=typeof a)return t.emit("error",new Error("Invalid messageId")),!1;l+=2}var u=null;5===n&&(u=M(t,d),l+=u.length);{if("object"!=typeof s||!s.length)return t.emit("error",new Error("Invalid subscriptions")),!1;for(var c=0;c<s.length;c+=1){var p=s[c].topic,h=s[c].qos;if("string"!=typeof p)return t.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof h)return t.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===n){var f=s[c].nl||!1;if("boolean"!=typeof f)return t.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var m=s[c].rap||!1;if("boolean"!=typeof m)return t.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var g=s[c].rh||0;if("number"!=typeof g||2<g)return t.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}l+=R.byteLength(p)+2+1}}t.write(C.SUBSCRIBE_HEADER[1][i?1:0][0]),k(t,l),P(t,a),null!==u&&u.write();for(var v=!0,y=0;y<s.length;y++){var _,b=s[y],S=b.topic,w=b.qos,E=+b.nl,I=+b.rap,T=b.rh;x(t,S),_=C.SUBSCRIBE_OPTIONS_QOS[w],5===n&&(_|=E?C.SUBSCRIBE_OPTIONS_NL:0,_|=I?C.SUBSCRIBE_OPTIONS_RAP:0,_|=T?C.SUBSCRIBE_OPTIONS_RH[T]:0),v=t.write(R.from([_]))}return v}(e,t,r);case"suback":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.messageId,a=o.granted,s=o.properties,d=0;{if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;d+=2}{if("object"!=typeof a||!a.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var l=0;l<a.length;l+=1){if("number"!=typeof a[l])return t.emit("error",new Error("Invalid qos vector")),!1;d+=1}}var u=null;if(5===n){if(!(u=_(t,s,r,d)))return!1;d+=u.length}t.write(C.SUBACK_HEADER),k(t,d),P(t,i),null!==u&&u.write();return t.write(R.from(a))}(e,t,r);case"unsubscribe":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.messageId,a=o.dup?C.DUP_MASK:0,s=o.unsubscriptions,d=o.properties,l=0;{if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;l+=2}{if("object"!=typeof s||!s.length)return t.emit("error",new Error("Invalid unsubscriptions")),!1;for(var u=0;u<s.length;u+=1){if("string"!=typeof s[u])return t.emit("error",new Error("Invalid unsubscriptions")),!1;l+=R.byteLength(s[u])+2}}var c=null;5===n&&(c=M(t,d),l+=c.length);t.write(C.UNSUBSCRIBE_HEADER[1][a?1:0][0]),k(t,l),P(t,i),null!==c&&c.write();for(var p=!0,h=0;h<s.length;h++)p=x(t,s[h]);return p}(e,t,r);case"unsuback":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.messageId,a=o.dup?C.DUP_MASK:0,s=o.granted,d=o.properties,l=o.cmd,u=2;if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;if(5===n){if("object"!=typeof s||!s.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var c=0;c<s.length;c+=1){if("number"!=typeof s[c])return t.emit("error",new Error("Invalid qos vector")),!1;u+=1}}var p=null;if(5===n){if(!(p=_(t,d,r,u)))return!1;u+=p.length}t.write(C.ACKS[l][0][a][0]),k(t,u),P(t,i),null!==p&&p.write();5===n&&t.write(R.from(s));return!0}(e,t,r);case"pingreq":case"pingresp":return n=e,t.write(C.EMPTY[n.cmd]);case"disconnect":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.reasonCode,a=o.properties,s=5===n?1:0,d=null;if(5===n){if(!(d=_(t,a,r,s)))return!1;s+=d.length}t.write(R.from([C.codes.disconnect<<4])),k(t,s),5===n&&t.write(R.from([i]));null!==d&&d.write();return!0}(e,t,r);case"auth":return function(e,t,r){var n=r?r.protocolVersion:4,o=e||{},i=o.reasonCode,a=o.properties,s=5===n?1:0;5!==n&&t.emit("error",new Error("Invalid mqtt version for auth packet"));var d=_(t,a,r,s);if(!d)return!1;s+=d.length,t.write(R.from([C.codes.auth<<4])),k(t,s),t.write(R.from([i])),null!==d&&d.write();return!0}(e,t,r);default:return t.emit("error",new Error("Unknown command")),!1}var n}function f(e){e.uncork()}Object.defineProperty(p,"cacheNumbers",{get:function(){return P===g},set:function(e){P=e?(i&&0!==Object.keys(i).length||(c=!0),g):(c=!1,v)}});var m={};function k(e,t){var r=m[t];r||(r=d(t).data,t<16384&&(m[t]=r)),e.write(r)}function x(e,t){var r=R.byteLength(t);P(e,r),e.write(t,"utf8")}function g(e,t){return e.write(i[t])}function v(e,t){return e.write(a(t))}function y(e,t){"string"==typeof t?x(e,t):t?(P(e,t.length),e.write(t)):P(e,0)}function M(o,i){if("object"!=typeof i||null!=i.length)return{length:1,write:function(){b(o,{},0)}};var e=0;function t(e){var t=C.propertiesTypes[e],r=i[e],n=0;switch(t){case"byte":if("boolean"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=2;break;case"int8":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=2;break;case"binary":if(r&&null===r)return o.emit("error",new Error("Invalid "+e)),!1;n+=1+R.byteLength(r)+2;break;case"int16":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=3;break;case"int32":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=5;break;case"var":if("number"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=1+d(r).length;break;case"string":if("string"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=3+R.byteLength(r.toString());break;case"pair":if("object"!=typeof r)return o.emit("error",new Error("Invalid "+e)),!1;n+=Object.getOwnPropertyNames(r).reduce(function(e,t){return e+=3+R.byteLength(t.toString())+2+R.byteLength(r[t].toString())},0);break;default:return o.emit("error",new Error("Invalid property "+e)),!1}return n}if(i)for(var r in i){var n=t(r);if(!n)return!1;e+=n}return{length:d(e).length+e,write:function(){b(o,i,e)}}}function _(e,t,r,n){var o=["reasonString","userProperties"],i=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,a=M(e,t);if(i)for(;n+a.length>i;){var s=o.shift();if(!s||!t[s])return!1;delete t[s],a=M(e,t)}return a}function b(o,e,t){for(var i in k(o,t),e)if(e.hasOwnProperty(i)&&null!==e[i]){var a=e[i];switch(C.propertiesTypes[i]){case"byte":o.write(R.from([C.properties[i]])),o.write(R.from([+a]));break;case"int8":o.write(R.from([C.properties[i]])),o.write(R.from([a]));break;case"binary":o.write(R.from([C.properties[i]])),y(o,a);break;case"int16":o.write(R.from([C.properties[i]])),P(o,a);break;case"int32":o.write(R.from([C.properties[i]])),r=a,o.write(u(r));break;case"var":o.write(R.from([C.properties[i]])),k(o,a);break;case"string":o.write(R.from([C.properties[i]])),x(o,a);break;case"pair":Object.getOwnPropertyNames(a).forEach(function(e){var t,r,n;o.write(R.from([C.properties[i]])),t=o,r=e.toString(),n=a[e].toString(),x(t,r),x(t,n)});break;default:return o.emit("error",new Error("Invalid property "+i)),!1}}var r}function S(e){return e?e instanceof R?e.length:R.byteLength(e):0}function w(e){return"string"==typeof e||e instanceof R}t.exports=p},{"./constants":82,"./numbers":86,"process-nextick-args":91,"safe-buffer":110}],90:[function(e,t,r){var n=e("wrappy");function o(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function i(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}t.exports=n(o),t.exports.strict=n(i),o.proto=o(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return o(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},{wrappy:120}],91:[function(e,t,r){(function(s){"use strict";!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,r,n){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,i,a=arguments.length;switch(a){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick(function(){e.call(null,t)});case 3:return s.nextTick(function(){e.call(null,t,r)});case 4:return s.nextTick(function(){e.call(null,t,r,n)});default:for(o=new Array(a-1),i=0;i<o.length;)o[i++]=arguments[i];return s.nextTick(function(){e.apply(null,o)})}}}:t.exports=s}).call(this,e("_process"))},{_process:92}],92:[function(e,t,r){var n,o,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function d(t){if(n===setTimeout)return setTimeout(t,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var l,u=[],c=!1,p=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):p=-1,u.length&&f())}function f(){if(!c){var e=d(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++p<t;)l&&l[p].run();p=-1,t=u.length}l=null,c=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||c||d(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],93:[function(e,A,O){(function(M){!function(e){var t="object"==typeof O&&O&&!O.nodeType&&O,r="object"==typeof A&&A&&!A.nodeType&&A,n="object"==typeof M&&M;n.global!==n&&n.window!==n&&n.self!==n||(e=n);var o,i,v=2147483647,y=36,_=1,b=26,a=38,s=700,S=72,w=128,E="-",d=/^xn--/,l=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,c={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=y-_,I=Math.floor,T=String.fromCharCode;function C(e){throw new RangeError(c[e])}function h(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function f(e,t){var r=e.split("@"),n="";return 1<r.length&&(n=r[0]+"@",e=r[1]),n+h((e=e.replace(u,".")).split("."),t).join(".")}function R(e){for(var t,r,n=[],o=0,i=e.length;o<i;)55296<=(t=e.charCodeAt(o++))&&t<=56319&&o<i?56320==(64512&(r=e.charCodeAt(o++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),o--):n.push(t);return n}function P(e){return h(e,function(e){var t="";return 65535<e&&(t+=T((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=T(e)}).join("")}function k(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function x(e,t,r){var n=0;for(e=r?I(e/s):e>>1,e+=I(e/t);p*b>>1<e;n+=y)e=I(e/p);return I(n+(p+1)*e/(e+a))}function m(e){var t,r,n,o,i,a,s,d,l,u,c,p=[],h=e.length,f=0,m=w,g=S;for((r=e.lastIndexOf(E))<0&&(r=0),n=0;n<r;++n)128<=e.charCodeAt(n)&&C("not-basic"),p.push(e.charCodeAt(n));for(o=0<r?r+1:0;o<h;){for(i=f,a=1,s=y;h<=o&&C("invalid-input"),c=e.charCodeAt(o++),(y<=(d=c-48<10?c-22:c-65<26?c-65:c-97<26?c-97:y)||d>I((v-f)/a))&&C("overflow"),f+=d*a,!(d<(l=s<=g?_:g+b<=s?b:s-g));s+=y)a>I(v/(u=y-l))&&C("overflow"),a*=u;g=x(f-i,t=p.length+1,0==i),I(f/t)>v-m&&C("overflow"),m+=I(f/t),f%=t,p.splice(f++,0,m)}return P(p)}function g(e){var t,r,n,o,i,a,s,d,l,u,c,p,h,f,m,g=[];for(p=(e=R(e)).length,t=w,i=S,a=r=0;a<p;++a)(c=e[a])<128&&g.push(T(c));for(n=o=g.length,o&&g.push(E);n<p;){for(s=v,a=0;a<p;++a)t<=(c=e[a])&&c<s&&(s=c);for(s-t>I((v-r)/(h=n+1))&&C("overflow"),r+=(s-t)*h,t=s,a=0;a<p;++a)if((c=e[a])<t&&++r>v&&C("overflow"),c==t){for(d=r,l=y;!(d<(u=l<=i?_:i+b<=l?b:l-i));l+=y)m=d-u,f=y-u,g.push(T(k(u+m%f,0))),d=I(m/f);g.push(T(k(d,0))),i=x(r,h,n==o),r=0,++n}++r,++t}return g.join("")}if(o={version:"1.4.1",ucs2:{decode:R,encode:P},decode:m,encode:g,toASCII:function(e){return f(e,function(e){return l.test(e)?"xn--"+g(e):e})},toUnicode:function(e){return f(e,function(e){return d.test(e)?m(e.slice(4).toLowerCase()):e})}},t&&r)if(A.exports==t)r.exports=o;else for(i in o)o.hasOwnProperty(i)&&(t[i]=o[i]);else e.punycode=o}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],94:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){t=t||"&",r=r||"=";var o={};if("string"!=typeof e||0===e.length)return o;var i=/\+/g;e=e.split(t);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var s,d,l=e.length;0<a&&a<l&&(l=a);for(var u=0;u<l;++u){var c,p,h,f,m=e[u].replace(i,"%20"),g=m.indexOf(r);p=0<=g?(c=m.substr(0,g),m.substr(g+1)):(c=m,""),h=decodeURIComponent(c),f=decodeURIComponent(p),s=o,d=h,Object.prototype.hasOwnProperty.call(s,d)?v(o[h])?o[h].push(f):o[h]=[o[h],f]:o[h]=f}return o};var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],95:[function(e,t,r){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(r,n,o,e){return n=n||"&",o=o||"=",null===r&&(r=void 0),"object"==typeof r?s(d(r),function(e){var t=encodeURIComponent(i(e))+o;return a(r[e])?s(r[e],function(e){return t+encodeURIComponent(i(e))}).join(n):t+encodeURIComponent(i(r[e]))}).join(n):e?encodeURIComponent(i(e))+o+encodeURIComponent(i(r)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var d=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],96:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":94,"./encode":95}],97:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":98}],98:[function(e,t,r){"use strict";var n=e("process-nextick-args"),o=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=c;var i=e("core-util-is");i.inherits=e("inherits");var a=e("./_stream_readable"),s=e("./_stream_writable");i.inherits(c,a);for(var d=o(s.prototype),l=0;l<d.length;l++){var u=d[l];c.prototype[u]||(c.prototype[u]=s.prototype[u])}function c(e){if(!(this instanceof c))return new c(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||n.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),c.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":14,inherits:80,"process-nextick-args":91}],99:[function(e,t,r){"use strict";t.exports=i;var n=e("./_stream_transform"),o=e("core-util-is");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}o.inherits=e("inherits"),o.inherits(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":101,"core-util-is":14,inherits:80}],100:[function(O,U,e){(function(g,e){"use strict";var v=O("process-nextick-args");U.exports=p;var a,y=O("isarray");p.ReadableState=i;O("events").EventEmitter;var _=function(e,t){return e.listeners(t).length},o=O("./internal/streams/stream"),l=O("safe-buffer").Buffer,u=e.Uint8Array||function(){};var t=O("core-util-is");t.inherits=O("inherits");var r=O("util"),b=void 0;b=r&&r.debuglog?r.debuglog("stream"):function(){};var s,d=O("./internal/streams/BufferList"),n=O("./internal/streams/destroy");t.inherits(p,o);var c=["error","close","destroy","pause","resume"];function i(e,t){e=e||{};var r=t instanceof(a=a||O("./_stream_duplex"));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,o=e.readableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(o||0===o)?o:i,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(s||(s=O("string_decoder/").StringDecoder),this.decoder=new s(e.encoding),this.encoding=e.encoding)}function p(e){if(a=a||O("./_stream_duplex"),!(this instanceof p))return new p(e);this._readableState=new i(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function h(e,t,r,n,o){var i,a,s,d=e._readableState;null===t?(d.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,w(e)}(e,d)):(o||(i=function(e,t){var r;n=t,l.isBuffer(n)||n instanceof u||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(d,t)),i?e.emit("error",i):d.objectMode||t&&0<t.length?("string"==typeof t||d.objectMode||Object.getPrototypeOf(t)===l.prototype||(a=t,t=l.from(a)),n?d.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):f(e,d,t,!0):d.ended?e.emit("error",new Error("stream.push() after EOF")):(d.reading=!1,d.decoder&&!r?(t=d.decoder.write(t),d.objectMode||0!==t.length?f(e,d,t,!1):I(e,d)):f(e,d,t,!1))):n||(d.reading=!1));return!(s=d).ended&&(s.needReadable||s.length<s.highWaterMark||0===s.length)}function f(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&w(e)),I(e,t)}Object.defineProperty(p.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),p.prototype.destroy=n.destroy,p.prototype._undestroy=n.undestroy,p.prototype._destroy=function(e,t){this.push(null),t(e)},p.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=l.from(e,t),t=""),r=!0),h(this,e,t,!1,r)},p.prototype.unshift=function(e){return h(this,e,null,!0,!1)},p.prototype.isPaused=function(){return!1===this._readableState.flowing},p.prototype.setEncoding=function(e){return s||(s=O("string_decoder/").StringDecoder),this._readableState.decoder=new s(e),this._readableState.encoding=e,this};var m=8388608;function S(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=(m<=(r=e)?r=m:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var r}function w(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(b("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?v.nextTick(E,e):E(e))}function E(e){b("emit readable"),e.emit("readable"),P(e)}function I(e,t){t.readingMore||(t.readingMore=!0,v.nextTick(T,e,t))}function T(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(b("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function C(e){b("readable nexttick read 0"),e.read(0)}function R(e,t){t.reading||(b("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),P(e),t.flowing&&!t.reading&&e.read(0)}function P(e){var t=e._readableState;for(b("flow",t.flowing);t.flowing&&null!==e.read(););}function k(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var n;e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,n=1,o=r.data;e-=o.length;for(;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(a===i.length?o+=i:o+=i.slice(0,e),0===(e-=a)){a===i.length?(++n,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=i.slice(a);break}++n}return t.length-=n,o}(e,t):function(e,t){var r=l.allocUnsafe(e),n=t.head,o=1;n.data.copy(r),e-=n.data.length;for(;n=n.next;){var i=n.data,a=e>i.length?i.length:e;if(i.copy(r,r.length-e,0,a),0===(e-=a)){a===i.length?(++o,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=i.slice(a);break}++o}return t.length-=o,r}(e,t);return n}(e,t.buffer,t.decoder),r);var r}function x(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,v.nextTick(M,t,e))}function M(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function A(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}p.prototype.read=function(e){b("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return b("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):w(this),null;if(0===(e=S(e,t))&&t.ended)return 0===t.length&&x(this),null;var n,o=t.needReadable;return b("need readable",o),(0===t.length||t.length-e<t.highWaterMark)&&b("length less than watermark",o=!0),t.ended||t.reading?b("reading or ended",o=!1):o&&(b("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=S(r,t))),null===(n=0<e?k(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&x(this)),null!==n&&this.emit("data",n),n},p.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},p.prototype.pipe=function(r,e){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=r;break;case 1:o.pipes=[o.pipes,r];break;default:o.pipes.push(r)}o.pipesCount+=1,b("pipe count=%d opts=%j",o.pipesCount,e);var t=(!e||!1!==e.end)&&r!==g.stdout&&r!==g.stderr?a:m;function i(e,t){b("onunpipe"),e===n&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,b("cleanup"),r.removeListener("close",h),r.removeListener("finish",f),r.removeListener("drain",d),r.removeListener("error",p),r.removeListener("unpipe",i),n.removeListener("end",a),n.removeListener("end",m),n.removeListener("data",c),l=!0,!o.awaitDrain||r._writableState&&!r._writableState.needDrain||d())}function a(){b("onend"),r.end()}o.endEmitted?v.nextTick(t):n.once("end",t),r.on("unpipe",i);var s,d=(s=n,function(){var e=s._readableState;b("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&_(s,"data")&&(e.flowing=!0,P(s))});r.on("drain",d);var l=!1;var u=!1;function c(e){b("ondata"),(u=!1)!==r.write(e)||u||((1===o.pipesCount&&o.pipes===r||1<o.pipesCount&&-1!==A(o.pipes,r))&&!l&&(b("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,u=!0),n.pause())}function p(e){b("onerror",e),m(),r.removeListener("error",p),0===_(r,"error")&&r.emit("error",e)}function h(){r.removeListener("finish",f),m()}function f(){b("onfinish"),r.removeListener("close",h),m()}function m(){b("unpipe"),n.unpipe(r)}return n.on("data",c),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?y(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(r,"error",p),r.once("close",h),r.once("finish",f),r.emit("pipe",n),o.flowing||(b("pipe resume"),n.resume()),r},p.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<o;i++)n[i].emit("unpipe",this,r);return this}var a=A(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},p.prototype.addListener=p.prototype.on=function(e,t){var r=o.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&w(this):v.nextTick(C,this))}return r},p.prototype.resume=function(){var e,t,r=this._readableState;return r.flowing||(b("resume"),r.flowing=!0,e=this,(t=r).resumeScheduled||(t.resumeScheduled=!0,v.nextTick(R,e,t))),this},p.prototype.pause=function(){return b("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(b("pause"),this._readableState.flowing=!1,this.emit("pause")),this},p.prototype.wrap=function(t){var r=this,n=this._readableState,o=!1;for(var e in t.on("end",function(){if(b("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),t.on("data",function(e){(b("wrapped data"),n.decoder&&(e=n.decoder.write(e)),n.objectMode&&null==e)||(n.objectMode||e&&e.length)&&(r.push(e)||(o=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var i=0;i<c.length;i++)t.on(c[i],this.emit.bind(this,c[i]));return this._read=function(e){b("wrapped _read",e),o&&(o=!1,t.resume())},this},Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),p._fromList=k}).call(this,O("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":98,"./internal/streams/BufferList":103,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,events:13,inherits:80,isarray:106,"process-nextick-args":91,"safe-buffer":110,"string_decoder/":107,util:11}],101:[function(e,t,r){"use strict";t.exports=i;var n=e("./_stream_duplex"),o=e("core-util-is");function i(e){if(!(this instanceof i))return new i(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=t&&this.push(t),n(e);var o=this._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var r=this;"function"==typeof this._flush?this._flush(function(e,t){s(r,e,t)}):s(this,null,null)}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}o.inherits=e("inherits"),o.inherits(i,n),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var o=this._readableState;(n.needTransform||o.needReadable||o.length<o.highWaterMark)&&this._read(o.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var r=this;n.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":98,"core-util-is":14,inherits:80}],102:[function(E,I,e){(function(e,t,r){"use strict";var v=E("process-nextick-args");function c(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var n=e.entry;e.entry=null;for(;n;){var o=n.callback;t.pendingcb--,o(r),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}I.exports=u;var s,p=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?r:v.nextTick;u.WritableState=l;var n=E("core-util-is");n.inherits=E("inherits");var o={deprecate:E("util-deprecate")},i=E("./internal/streams/stream"),y=E("safe-buffer").Buffer,_=t.Uint8Array||function(){};var a,d=E("./internal/streams/destroy");function b(){}function l(e,t){s=s||E("./_stream_duplex"),e=e||{};var r=t instanceof s;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,o=e.writableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(o||0===o)?o:i,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,o=r.writecb;if(c=r,c.writing=!1,c.writecb=null,c.length-=c.writelen,c.writelen=0,t)a=e,s=r,d=n,l=t,u=o,--s.pendingcb,d?(v.nextTick(u,l),v.nextTick(w,a,s),a._writableState.errorEmitted=!0,a.emit("error",l)):(u(l),a._writableState.errorEmitted=!0,a.emit("error",l),w(a,s));else{var i=m(r);i||r.corked||r.bufferProcessing||!r.bufferedRequest||f(e,r),n?p(h,e,r,i,o):h(e,r,i,o)}var a,s,d,l,u;var c}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new c(this)}function u(e){if(s=s||E("./_stream_duplex"),!(a.call(u,this)||this instanceof s))return new u(e);this._writableState=new l(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),i.call(this)}function S(e,t,r,n,o,i,a){t.writelen=n,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(o,t.onwrite):e._write(o,i,t.onwrite),t.sync=!1}function h(e,t,r,n){var o,i;r||(o=e,0===(i=t).length&&i.needDrain&&(i.needDrain=!1,o.emit("drain"))),t.pendingcb--,n(),w(e,t)}function f(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount,o=new Array(n),i=t.corkedRequestsFree;i.entry=r;for(var a=0,s=!0;r;)(o[a]=r).isBuf||(s=!1),r=r.next,a+=1;o.allBuffers=s,S(e,t,!0,t.length,o,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new c(t),t.bufferedRequestCount=0}else{for(;r;){var d=r.chunk,l=r.encoding,u=r.callback;if(S(e,t,!1,t.objectMode?1:d.length,d,l,u),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function m(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function g(t,r){t._final(function(e){r.pendingcb--,e&&t.emit("error",e),r.prefinished=!0,t.emit("prefinish"),w(t,r)})}function w(e,t){var r,n,o=m(t);return o&&(r=e,(n=t).prefinished||n.finalCalled||("function"==typeof r._final?(n.pendingcb++,n.finalCalled=!0,v.nextTick(g,r,n)):(n.prefinished=!0,r.emit("prefinish"))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),o}n.inherits(u,i),l.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(l.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(u,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===u&&(e&&e._writableState instanceof l)}})):a=function(e){return e instanceof this},u.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},u.prototype.write=function(e,t,r){var n,o,i,a,s,d,l,u,c,p,h,f=this._writableState,m=!1,g=!f.objectMode&&(n=e,y.isBuffer(n)||n instanceof _);return g&&!y.isBuffer(e)&&(o=e,e=y.from(o)),"function"==typeof t&&(r=t,t=null),g?t="buffer":t||(t=f.defaultEncoding),"function"!=typeof r&&(r=b),f.ended?(c=this,p=r,h=new Error("write after end"),c.emit("error",h),v.nextTick(p,h)):(g||(i=this,a=f,d=r,u=!(l=!0),null===(s=e)?u=new TypeError("May not write null values to stream"):"string"==typeof s||void 0===s||a.objectMode||(u=new TypeError("Invalid non-string/buffer chunk")),u&&(i.emit("error",u),v.nextTick(d,u),l=!1),l))&&(f.pendingcb++,m=function(e,t,r,n,o,i){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=y.from(t,r));return t}(t,n,o);n!==a&&(r=!0,o="buffer",n=a)}var s=t.objectMode?1:n.length;t.length+=s;var d=t.length<t.highWaterMark;d||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:o,isBuf:r,callback:i,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else S(e,t,!1,s,n,o,i);return d}(this,f,g,e,t,r)),m},u.prototype.cork=function(){this._writableState.corked++},u.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||f(this,e))},u.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),u.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},u.prototype._writev=null,u.prototype.end=function(e,t,r){var n=this._writableState;"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,r){t.ending=!0,w(e,t),r&&(t.finished?v.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,n,r)},Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),u.prototype.destroy=d.destroy,u.prototype._undestroy=d.undestroy,u.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,E("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},E("timers").setImmediate)},{"./_stream_duplex":98,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,inherits:80,"process-nextick-args":91,"safe-buffer":110,timers:112,"util-deprecate":115}],103:[function(e,t,r){"use strict";var s=e("safe-buffer").Buffer,n=e("util");t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return s.alloc(0);if(1===this.length)return this.head.data;for(var t,r,n,o=s.allocUnsafe(e>>>0),i=this.head,a=0;i;)t=i.data,r=o,n=a,t.copy(r,n),a+=i.data.length,i=i.next;return o},e}(),n&&n.inspect&&n.inspect.custom&&(t.exports.prototype[n.inspect.custom]=function(){var e=n.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":110,util:11}],104:[function(e,t,r){"use strict";var i=e("process-nextick-args");function a(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,n=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return n||o?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(a,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i.nextTick(a,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":91}],105:[function(e,t,r){t.exports=e("events").EventEmitter},{events:13}],106:[function(e,t,r){var n={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},{}],107:[function(e,t,r){"use strict";var n=e("safe-buffer").Buffer,o=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===o||!o(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=d,this.end=l,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=c,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function d(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(55296<=n&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function c(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}(r.StringDecoder=i).prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},i.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var o=a(t[n]);if(0<=o)return 0<o&&(e.lastNeed=o-1),o;if(--n<r||-2===o)return 0;if(0<=(o=a(t[n])))return 0<o&&(e.lastNeed=o-2),o;if(--n<r||-2===o)return 0;if(0<=(o=a(t[n])))return 0<o&&(2===o?o=0:e.lastNeed=o-3),o;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":110}],108:[function(e,t,r){(((r=t.exports=e("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":98,"./lib/_stream_passthrough.js":99,"./lib/_stream_readable.js":100,"./lib/_stream_transform.js":101,"./lib/_stream_writable.js":102}],109:[function(e,t,r){"use strict";function n(e,t,r){var n=this;this._callback=e,this._args=r,this._interval=setInterval(e,t,this._args),this.reschedule=function(e){e||(e=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,e,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}t.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var e;if(0<arguments.length){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new n(arguments[0],arguments[1],e)}},{}],110:[function(e,t,r){var n=e("buffer"),o=n.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return o(e,t,r)}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?t.exports=n:(i(n,r),r.Buffer=a),i(o,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return o(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=o(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},{buffer:12}],111:[function(e,t,r){t.exports=function(e){var t=e._readableState;return t?t.objectMode?e.read():e.read((r=t,r.buffer.length?r.buffer.head?r.buffer.head.data.length:r.buffer[0].length:r.length)):null;var r}},{}],112:[function(d,e,l){(function(e,t){var n=d("process/browser.js").nextTick,r=Function.prototype.apply,o=Array.prototype.slice,i={},a=0;function s(e,t){this._id=e,this._clearFn=t}l.setTimeout=function(){return new s(r.call(setTimeout,window,arguments),clearTimeout)},l.setInterval=function(){return new s(r.call(setInterval,window,arguments),clearInterval)},l.clearTimeout=l.clearInterval=function(e){e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},l.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},l.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},l._unrefActive=l.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},l.setImmediate="function"==typeof e?e:function(e){var t=a++,r=!(arguments.length<2)&&o.call(arguments,1);return i[t]=!0,n(function(){i[t]&&(r?e.apply(null,r):e.call(null),l.clearImmediate(t))}),t},l.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}).call(this,d("timers").setImmediate,d("timers").clearImmediate)},{"process/browser.js":92,timers:112}],113:[function(e,t,r){"use strict";var O=e("punycode"),U=e("./util");function R(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=i,r.resolve=function(e,t){return i(e,!1,!0).resolve(t)},r.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},r.format=function(e){U.isString(e)&&(e=i(e));return e instanceof R?e.format():R.prototype.format.call(e)},r.Url=R;var D=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,L=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,o=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),H=["'"].concat(o),N=["%","/","?",";","#"].concat(H),B=["/","?","#"],j=/^[+a-z0-9A-Z_-]{0,63}$/,V=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,F={javascript:!0,"javascript:":!0},q={javascript:!0,"javascript:":!0},G={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},W=e("querystring");function i(e,t,r){if(e&&U.isObject(e)&&e instanceof R)return e;var n=new R;return n.parse(e,t,r),n}R.prototype.parse=function(e,t,r){if(!U.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),o=-1!==n&&n<e.indexOf("#")?"?":"#",i=e.split(o);i[0]=i[0].replace(/\\/g,"/");var a=e=i.join(o);if(a=a.trim(),!r&&1===e.split("#").length){var s=L.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?W.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var d=D.exec(a);if(d){var l=(d=d[0]).toLowerCase();this.protocol=l,a=a.substr(d.length)}if(r||d||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===a.substr(0,2);!u||d&&q[d]||(a=a.substr(2),this.slashes=!0)}if(!q[d]&&(u||d&&!G[d])){for(var c,p,h=-1,f=0;f<B.length;f++){-1!==(m=a.indexOf(B[f]))&&(-1===h||m<h)&&(h=m)}-1!==(p=-1===h?a.lastIndexOf("@"):a.lastIndexOf("@",h))&&(c=a.slice(0,p),a=a.slice(p+1),this.auth=decodeURIComponent(c)),h=-1;for(f=0;f<N.length;f++){var m;-1!==(m=a.indexOf(N[f]))&&(-1===h||m<h)&&(h=m)}-1===h&&(h=a.length),this.host=a.slice(0,h),a=a.slice(h),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var v=this.hostname.split(/\./),y=(f=0,v.length);f<y;f++){var _=v[f];if(_&&!_.match(j)){for(var b="",S=0,w=_.length;S<w;S++)127<_.charCodeAt(S)?b+="x":b+=_[S];if(!b.match(j)){var E=v.slice(0,f),I=v.slice(f+1),T=_.match(V);T&&(E.push(T[1]),I.unshift(T[2])),I.length&&(a="/"+I.join(".")+a),this.hostname=E.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=O.toASCII(this.hostname));var C=this.port?":"+this.port:"",R=this.hostname||"";this.host=R+C,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!F[l])for(f=0,y=H.length;f<y;f++){var P=H[f];if(-1!==a.indexOf(P)){var k=encodeURIComponent(P);k===P&&(k=escape(P)),a=a.split(P).join(k)}}var x=a.indexOf("#");-1!==x&&(this.hash=a.substr(x),a=a.slice(0,x));var M=a.indexOf("?");if(-1!==M?(this.search=a.substr(M),this.query=a.substr(M+1),t&&(this.query=W.parse(this.query)),a=a.slice(0,M)):t&&(this.search="",this.query={}),a&&(this.pathname=a),G[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){C=this.pathname||"";var A=this.search||"";this.path=C+A}return this.href=this.format(),this},R.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&U.isObject(this.query)&&Object.keys(this.query).length&&(i=W.stringify(this.query));var a=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||G[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+n},R.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},R.prototype.resolveObject=function(e){if(U.isString(e)){var t=new R;t.parse(e,!1,!0),e=t}for(var r=new R,n=Object.keys(this),o=0;o<n.length;o++){var i=n[o];r[i]=this[i]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),s=0;s<a.length;s++){var d=a[s];"protocol"!==d&&(r[d]=e[d])}return G[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!G[e.protocol]){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];r[c]=e[c]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||q[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var h=r.pathname||"",f=r.search||"";r.path=h+f}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=g||m||r.host&&e.pathname,y=v,_=r.pathname&&r.pathname.split("/")||[],b=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!G[r.protocol]);if(b&&(r.hostname="",r.port=null,r.host&&(""===_[0]?_[0]=r.host:_.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),v=v&&(""===p[0]||""===_[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,_=p;else if(p.length)_||(_=[]),_.pop(),_=_.concat(p),r.search=e.search,r.query=e.query;else if(!U.isNullOrUndefined(e.search)){if(b)r.hostname=r.host=_.shift(),(T=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift());return r.search=e.search,r.query=e.query,U.isNull(r.pathname)&&U.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!_.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var S=_.slice(-1)[0],w=(r.host||e.host||1<_.length)&&("."===S||".."===S)||""===S,E=0,I=_.length;0<=I;I--)"."===(S=_[I])?_.splice(I,1):".."===S?(_.splice(I,1),E++):E&&(_.splice(I,1),E--);if(!v&&!y)for(;E--;E)_.unshift("..");!v||""===_[0]||_[0]&&"/"===_[0].charAt(0)||_.unshift(""),w&&"/"!==_.join("/").substr(-1)&&_.push("");var T,C=""===_[0]||_[0]&&"/"===_[0].charAt(0);b&&(r.hostname=r.host=C?"":_.length?_.shift():"",(T=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift()));return(v=v||r.host&&_.length)&&!C&&_.unshift(""),_.length?r.pathname=_.join("/"):(r.pathname=null,r.path=null),U.isNull(r.pathname)&&U.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},R.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":114,punycode:93,querystring:96}],114:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],115:[function(e,t,r){(function(r){function n(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}t.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],116:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],117:[function(p,e,R){(function(n,o){var s=/%[sdj%]/g;R.format=function(e){if(!b(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(d(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,i=String(e).replace(s,function(e){if("%%"===e)return"%";if(o<=r)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<o;a=n[++r])y(a)||!u(a)?i+=" "+a:i+=" "+d(a);return i},R.deprecate=function(e,t){if(S(o.process))return function(){return R.deprecate(e,t).apply(this,arguments)};if(!0===n.noDeprecation)return e;var r=!1;return function(){if(!r){if(n.throwDeprecation)throw new Error(t);n.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}};var e,i={};function d(e,t){var r={seen:[],stylize:l};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),v(t)?r.showHidden=t:t&&R._extend(r,t),S(r.showHidden)&&(r.showHidden=!1),S(r.depth)&&(r.depth=2),S(r.colors)&&(r.colors=!1),S(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),h(r,e,r.depth)}function a(e,t){var r=d.styles[t];return r?"["+d.colors[r][0]+"m"+e+"["+d.colors[r][1]+"m":e}function l(e,t){return e}function h(t,r,n){if(t.customInspect&&r&&T(r.inspect)&&r.inspect!==R.inspect&&(!r.constructor||r.constructor.prototype!==r)){var e=r.inspect(n,t);return b(e)||(e=h(t,e,n)),e}var o=function(e,t){if(S(t))return e.stylize("undefined","undefined");if(b(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(_(t))return e.stylize(""+t,"number");if(v(t))return e.stylize(""+t,"boolean");if(y(t))return e.stylize("null","null")}(t,r);if(o)return o;var i,a=Object.keys(r),s=(i={},a.forEach(function(e,t){i[e]=!0}),i);if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),I(r)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return f(r);if(0===a.length){if(T(r)){var d=r.name?": "+r.name:"";return t.stylize("[Function"+d+"]","special")}if(w(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return t.stylize(Date.prototype.toString.call(r),"date");if(I(r))return f(r)}var l,u="",c=!1,p=["{","}"];(g(r)&&(c=!0,p=["[","]"]),T(r))&&(u=" [Function"+(r.name?": "+r.name:"")+"]");return w(r)&&(u=" "+RegExp.prototype.toString.call(r)),E(r)&&(u=" "+Date.prototype.toUTCString.call(r)),I(r)&&(u=" "+f(r)),0!==a.length||c&&0!=r.length?n<0?w(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),l=c?function(t,r,n,o,e){for(var i=[],a=0,s=r.length;a<s;++a)C(r,String(a))?i.push(m(t,r,n,o,String(a),!0)):i.push("");return e.forEach(function(e){e.match(/^\d+$/)||i.push(m(t,r,n,o,e,!0))}),i}(t,r,n,s,a):a.map(function(e){return m(t,r,n,s,e,c)}),t.seen.pop(),function(e,t,r){if(60<e.reduce(function(e,t){return 0,0<=t.indexOf("\n")&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0))return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(l,u,p)):p[0]+u+p[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,r,n,o,i){var a,s,d;if((d=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?s=d.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):d.set&&(s=e.stylize("[Setter]","special")),C(n,o)||(a="["+o+"]"),s||(e.seen.indexOf(d.value)<0?-1<(s=y(r)?h(e,d.value,null):h(e,d.value,r-1)).indexOf("\n")&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),S(a)){if(i&&o.match(/^\d+$/))return s;a=(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(a,"string"))}return a+": "+s}function g(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function y(e){return null===e}function _(e){return"number"==typeof e}function b(e){return"string"==typeof e}function S(e){return void 0===e}function w(e){return u(e)&&"[object RegExp]"===t(e)}function u(e){return"object"==typeof e&&null!==e}function E(e){return u(e)&&"[object Date]"===t(e)}function I(e){return u(e)&&("[object Error]"===t(e)||e instanceof Error)}function T(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function r(e){return e<10?"0"+e.toString(10):e.toString(10)}R.debuglog=function(t){if(S(e)&&(e=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(e)){var r=n.pid;i[t]=function(){var e=R.format.apply(R,arguments);console.error("%s %d: %s",t,r,e)}}else i[t]=function(){};return i[t]},(R.inspect=d).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},R.isArray=g,R.isBoolean=v,R.isNull=y,R.isNullOrUndefined=function(e){return null==e},R.isNumber=_,R.isString=b,R.isSymbol=function(e){return"symbol"==typeof e},R.isUndefined=S,R.isRegExp=w,R.isObject=u,R.isDate=E,R.isError=I,R.isFunction=T,R.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},R.isBuffer=p("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}R.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[r(e.getHours()),r(e.getMinutes()),r(e.getSeconds())].join(":"),[e.getDate(),c[e.getMonth()],t].join(" ")),R.format.apply(R,arguments))},R.inherits=p("inherits"),R._extend=function(e,t){if(!t||!u(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,p("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":116,_process:92,inherits:80}],118:[function(e,t,r){(function(g,v){"use strict";var y=e("readable-stream").Transform,_=e("duplexify"),b=e("ws"),S=e("safe-buffer").Buffer;t.exports=function(e,t,r){var n,o,i="browser"===g.title,a=!!v.WebSocket,s=i?function e(t,r,n){if(o.bufferedAmount>h)return void setTimeout(e,f,t,r,n);m&&"string"==typeof t&&(t=S.from(t,"utf8"));try{o.send(t)}catch(e){return n(e)}n()}:function(e,t,r){if(o.readyState!==o.OPEN)return void r();m&&"string"==typeof e&&(e=S.from(e,"utf8"));o.send(e,r)};t&&!Array.isArray(t)&&"object"==typeof t&&(r=t,t=null,("string"==typeof r.protocol||Array.isArray(r.protocol))&&(t=r.protocol));r||(r={});void 0===r.objectMode&&(r.objectMode=!(!0===r.binary||void 0===r.binary));var d=(l=r,u=s,c=function(e){o.close(),e()},p=new y({objectMode:l.objectMode}),p._write=u,p._flush=c,p);var l,u,c,p;r.objectMode||(d._writev=function(e,t){for(var r=new Array(e.length),n=0;n<e.length;n++)"string"==typeof e[n].chunk?r[n]=S.from(e[n],"utf8"):r[n]=e[n].chunk;this._write(S.concat(r),"binary",t)});var h=r.browserBufferSize||524288,f=r.browserBufferTimeout||1e3;"object"==typeof e?o=e:(o=a&&i?new b(e,t):new b(e,t,r)).binaryType="arraybuffer";o.readyState===o.OPEN?n=d:(n=_.obj(),o.onopen=function(){n.setReadable(d),n.setWritable(d),n.emit("connect")});(n.socket=o).onclose=function(){n.end(),n.destroy()},o.onerror=function(e){n.destroy(e)},o.onmessage=function(e){var t=e.data;t=t instanceof ArrayBuffer?S.from(t):S.from(t,"utf8");d.push(t)},d.on("close",function(){o.close()});var m=!r.objectMode;return n}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:92,duplexify:17,"readable-stream":108,"safe-buffer":110,ws:119}],119:[function(e,t,r){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:"undefined"!=typeof window&&(n=window.WebSocket||window.MozWebSocket),t.exports=n},{}],120:[function(e,t,r){t.exports=function e(o,t){if(o&&t)return e(o)(t);if("function"!=typeof o)throw new TypeError("need wrapper function");Object.keys(o).forEach(function(e){r[e]=o[e]});return r;function r(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];var r=o.apply(this,e),n=e[e.length-1];return"function"==typeof r&&r!==n&&Object.keys(n).forEach(function(e){r[e]=n[e]}),r}}},{}],121:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)o.call(r,n)&&(e[n]=r[n])}return e};var o=Object.prototype.hasOwnProperty},{}]},{},[9])(9)}),function(o,c){"use strict";var p="function",i="undefined",h="object",a="string",s="model",e="name",t="type",d="vendor",l="version",u="architecture",r="console",n="mobile",f="tablet",m="smarttv",g="wearable",v="Amazon",y="BlackBerry",_="Browser",b="Chrome",S="Firefox",w="Google",E="Microsoft",I="Opera",T="Samsung",C=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},R=function(e,t){return typeof e===a&&-1!==P(t).indexOf(P(e))},P=function(e){return e.toLowerCase()},k=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===i?e:e.substring(0,255)},x=function(e,t){for(var r,n,o,i,a,s,d=0;d<t.length&&!a;){var l=t[d],u=t[d+1];for(r=n=0;r<l.length&&!a;)if(a=l[r++].exec(e))for(o=0;o<u.length;o++)s=a[++n],typeof(i=u[o])===h&&0<i.length?2===i.length?typeof i[1]==p?this[i[0]]=i[1].call(this,s):this[i[0]]=i[1]:3===i.length?typeof i[1]!==p||i[1].exec&&i[1].test?this[i[0]]=s?s.replace(i[1],i[2]):c:this[i[0]]=s?i[1].call(this,s,i[2]):c:4===i.length&&(this[i[0]]=s?i[3].call(this,s.replace(i[1],i[2])):c):this[i]=s||c;d+=2}},M=function(e,t){for(var r in t)if(typeof t[r]===h&&0<t[r].length){for(var n=0;n<t[r].length;n++)if(R(t[r][n],e))return"?"===r?c:r}else if(R(t[r],e))return"?"===r?c:r;return e},A={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},O={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[l,[e,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[l,[e,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[e,l],[/opios[\/ ]+([\w\.]+)/i],[l,[e,I+" Mini"]],[/\bopr\/([\w\.]+)/i],[l,[e,I]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[e,l],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[l,[e,"UC"+_]],[/\bqbcore\/([\w\.]+)/i],[l,[e,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[l,[e,"WeChat"]],[/konqueror\/([\w\.]+)/i],[l,[e,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[l,[e,"IE"]],[/yabrowser\/([\w\.]+)/i],[l,[e,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[e,/(.+)/,"$1 Secure "+_],l],[/\bfocus\/([\w\.]+)/i],[l,[e,S+" Focus"]],[/\bopt\/([\w\.]+)/i],[l,[e,I+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[l,[e,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[l,[e,"Dolphin"]],[/coast\/([\w\.]+)/i],[l,[e,I+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[l,[e,"MIUI "+_]],[/fxios\/([-\w\.]+)/i],[l,[e,S]],[/\bqihu|(qi?ho?o?|360)browser/i],[[e,"360 "+_]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[e,/(.+)/,"$1 "+_],l],[/(comodo_dragon)\/([\w\.]+)/i],[[e,/_/g," "],l],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[e,l],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[e],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[e,"Facebook"],l],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[e,l],[/\bgsa\/([\w\.]+) .*safari\//i],[l,[e,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[l,[e,b+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[e,b+" WebView"],l],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[l,[e,"Android "+_]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[e,l],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[l,[e,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[l,e],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[e,[l,M,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[e,l],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[e,"Netscape"],l],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[l,[e,S+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[e,l]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[u,"amd64"]],[/(ia32(?=;))/i],[[u,P]],[/((?:i[346]|x)86)[;\)]/i],[[u,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[u,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[u,"armhf"]],[/windows (ce|mobile); ppc;/i],[[u,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[u,/ower/,"",P]],[/(sun4\w)[;\)]/i],[[u,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[u,P]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[d,T],[t,f]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[d,T],[t,n]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[d,"Apple"],[t,n]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[d,"Apple"],[t,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[d,"Huawei"],[t,f]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[s,[d,"Huawei"],[t,n]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[d,"Xiaomi"],[t,n]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[d,"Xiaomi"],[t,f]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[d,"OPPO"],[t,n]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[d,"Vivo"],[t,n]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[d,"Realme"],[t,n]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[d,"Motorola"],[t,n]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[d,"Motorola"],[t,f]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[d,"LG"],[t,f]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[d,"LG"],[t,n]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[d,"Lenovo"],[t,f]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[d,"Nokia"],[t,n]],[/(pixel c)\b/i],[s,[d,w],[t,f]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[d,w],[t,n]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[d,"Sony"],[t,n]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[d,"Sony"],[t,f]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[d,"OnePlus"],[t,n]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[d,v],[t,f]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[d,v],[t,n]],[/(playbook);[-\w\),; ]+(rim)/i],[s,d,[t,f]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[d,y],[t,n]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[d,"ASUS"],[t,f]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[d,"ASUS"],[t,n]],[/(nexus 9)/i],[s,[d,"HTC"],[t,f]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[d,[s,/_/g," "],[t,n]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[d,"Acer"],[t,f]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[d,"Meizu"],[t,n]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[d,"Sharp"],[t,n]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,s,[t,n]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,s,[t,f]],[/(surface duo)/i],[s,[d,E],[t,f]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[d,"Fairphone"],[t,n]],[/(u304aa)/i],[s,[d,"AT&T"],[t,n]],[/\bsie-(\w*)/i],[s,[d,"Siemens"],[t,n]],[/\b(rct\w+) b/i],[s,[d,"RCA"],[t,f]],[/\b(venue[\d ]{2,7}) b/i],[s,[d,"Dell"],[t,f]],[/\b(q(?:mv|ta)\w+) b/i],[s,[d,"Verizon"],[t,f]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[d,"Barnes & Noble"],[t,f]],[/\b(tm\d{3}\w+) b/i],[s,[d,"NuVision"],[t,f]],[/\b(k88) b/i],[s,[d,"ZTE"],[t,f]],[/\b(nx\d{3}j) b/i],[s,[d,"ZTE"],[t,n]],[/\b(gen\d{3}) b.+49h/i],[s,[d,"Swiss"],[t,n]],[/\b(zur\d{3}) b/i],[s,[d,"Swiss"],[t,f]],[/\b((zeki)?tb.*\b) b/i],[s,[d,"Zeki"],[t,f]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],s,[t,f]],[/\b(ns-?\w{0,9}) b/i],[s,[d,"Insignia"],[t,f]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[d,"NextBook"],[t,f]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],s,[t,n]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],s,[t,n]],[/\b(ph-1) /i],[s,[d,"Essential"],[t,n]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[d,"Envizen"],[t,f]],[/\b(trio[-\w\. ]+) b/i],[s,[d,"MachSpeed"],[t,f]],[/\btu_(1491) b/i],[s,[d,"Rotor"],[t,f]],[/(shield[\w ]+) b/i],[s,[d,"Nvidia"],[t,f]],[/(sprint) (\w+)/i],[d,s,[t,n]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[d,E],[t,n]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[d,"Zebra"],[t,f]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[d,"Zebra"],[t,n]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,s,[t,r]],[/droid.+; (shield) bui/i],[s,[d,"Nvidia"],[t,r]],[/(playstation [345portablevi]+)/i],[s,[d,"Sony"],[t,r]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[d,E],[t,r]],[/smart-tv.+(samsung)/i],[d,[t,m]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[d,T],[t,m]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,"LG"],[t,m]],[/(apple) ?tv/i],[d,[s,"Apple TV"],[t,m]],[/crkey/i],[[s,b+"cast"],[d,w],[t,m]],[/droid.+aft(\w)( bui|\))/i],[s,[d,v],[t,m]],[/\(dtv[\);].+(aquos)/i],[s,[d,"Sharp"],[t,m]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[d,k],[s,k],[t,m]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[t,m]],[/((pebble))app/i],[d,s,[t,g]],[/droid.+; (glass) \d/i],[s,[d,w],[t,g]],[/droid.+; (wt63?0{2,3})\)/i],[s,[d,"Zebra"],[t,g]],[/(quest( 2)?)/i],[s,[d,"Facebook"],[t,g]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[t,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[t,n]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[t,f]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[t,f]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[t,n]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[l,[e,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[l,[e,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[e,l],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[l,e]],os:[[/microsoft (windows) (vista|xp)/i],[e,l],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[e,[l,M,A]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[e,"Windows"],[l,M,A]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[l,/_/g,"."],[e,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[e,"Mac OS"],[l,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[l,e],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[e,l],[/\(bb(10);/i],[l,[e,y]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[l,[e,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[l,[e,S+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[l,[e,"webOS"]],[/crkey\/([\d\.]+)/i],[l,[e,b+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[e,"Chromium OS"],l],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[e,l],[/(sunos) ?([\w\.\d]*)/i],[[e,"Solaris"],l],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[e,l]]},U=function(e,t){if(typeof e===h&&(t=e,e=c),!(this instanceof U))return new U(e,t).getResult();var r=e||(typeof o!==i&&o.navigator&&o.navigator.userAgent?o.navigator.userAgent:""),n=t?function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r}(O,t):O;return this.getBrowser=function(){var e,t={};return t.name=c,t[l]=c,x.call(t,r,n.browser),t.major=typeof(e=t.version)===a?e.replace(/[^\d\.]/g,"").split(".")[0]:c,t},this.getCPU=function(){var e={};return e[u]=c,x.call(e,r,n.cpu),e},this.getDevice=function(){var e={};return e[d]=c,e[s]=c,e.type=c,x.call(e,r,n.device),e},this.getEngine=function(){var e={};return e.name=c,e[l]=c,x.call(e,r,n.engine),e},this.getOS=function(){var e={};return e.name=c,e[l]=c,x.call(e,r,n.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===a&&255<e.length?k(e,255):e,this},this.setUA(r),this};U.VERSION="0.7.31",U.BROWSER=C([e,l,"major"]),U.CPU=C([u]),U.DEVICE=C([s,d,t,r,n,m,f,g,"embedded"]),U.ENGINE=U.OS=C([e,l]),typeof exports!==i?(typeof module!==i&&module.exports&&(exports=module.exports=U),exports.UAParser=U):typeof define===p&&define.amd?define(function(){return U}):typeof o!==i&&(o.UAParser=U);var D=typeof o!==i&&(o.jQuery||o.Zepto);if(D&&!D.ua){var L=new U;D.ua=L.getResult(),D.ua.get=function(){return L.getUA()},D.ua.set=function(e){L.setUA(e);var t=L.getResult();for(var r in t)D.ua[r]=t[r]}}}("object"==typeof window?window:this),function(e,t){"object"==typeof exports?module.exports=exports=t():"function"==typeof define&&define.amd?define([],t):e.CryptoJS=t()}(this,function(){var o,i,a,h,f,e,t,u,r,n,s,d,l,c,p,E,I,T,C,R,P,m,v,y,g,_,b,S,w,k,x,M,A,O,U,D,L,H,N,B,j,V,F,q,G=function(l){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),!(n=!(n=!(n="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:n)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:n)&&"undefined"!=typeof global&&global.crypto?global.crypto:n)&&"function"==typeof require)try{n=require("crypto")}catch(e){}var r=Object.create||function(e){return t.prototype=e,e=new t,t.prototype=null,e};function t(){}var e={},o=e.lib={},i=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var s=0;s<o;s+=4)t[n+s>>>2]=r[s>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=l.ceil(t/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new u.init(t,e)}}),a=e.enc={},s=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new u.init(r,t/2)}},d=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new u.init(r,t)}},c=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t,r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,a=o/(4*i),s=(a=e?l.ceil(a):l.max((0|a)-this._minBufferSize,0))*i;e=l.min(4*s,o);if(s){for(var d=0;d<s;d+=i)this._doProcessBlock(n,d);t=n.splice(0,s),r.sigBytes-=e}return new u.init(t,e)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(o.Hasher=p.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(e,t){return new r.init(t).finalize(e)}},_createHmacHelper:function(r){return function(e,t){return new h.HMAC.init(r,t).finalize(e)}}}),e.algo={});return e}(Math),W=(J=(J=(We=G).lib,o=J.Base,i=J.WordArray,(J=We.x64={}).Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),J.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var o=e[n];r.push(o.high),r.push(o.low)}return i.create(r,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),"function"==typeof ArrayBuffer&&(We=G.lib.WordArray,a=We.init,(We.init=function(e){if((e=(e=e instanceof ArrayBuffer?new Uint8Array(e):e)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e)instanceof Uint8Array){for(var t=e.byteLength,r=[],n=0;n<t;n++)r[n>>>2]|=e[n]<<24-n%4*8;a.call(this,r,t)}else a.apply(this,arguments)}).prototype=We),G)).lib.WordArray;function z(e){return e<<8&4278255360|e>>>8&16711935}(J=J.enc).Utf16=J.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o+=2){var i=t[o>>>2]>>>16-o%4*8&65535;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>1]|=e.charCodeAt(n)<<16-n%2*16;return W.create(r,2*t)}},J.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o+=2){var i=z(t[o>>>2]>>>16-o%4*8&65535);n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>1]|=z(e.charCodeAt(n)<<16-n%2*16);return W.create(r,2*t)}},h=(We=G).lib.WordArray,We.enc.Base64={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=this._map,o=(e.clamp(),[]),i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)o.push(n.charAt(a>>>6*(3-s)&63));var d=n.charAt(64);if(d)for(;o.length%4;)o.push(d);return o.join("")},parse:function(e){var t=e.length,r=this._map;if(!(n=this._reverseMap))for(var n=this._reverseMap=[],o=0;o<r.length;o++)n[r.charCodeAt(o)]=o;for(var i,a=r.charAt(64),s=(!a||-1!==(a=e.indexOf(a))&&(t=a),e),d=t,l=n,u=[],c=0,p=0;p<d;p++)p%4&&(i=l[s.charCodeAt(p-1)]<<p%4*2,i|=l[s.charCodeAt(p)]>>>6-p%4*2,u[c>>>2]|=i<<24-c%4*8,c++);return h.create(u,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},f=(J=G).lib.WordArray,J.enc.Base64url={stringify:function(e,t){for(var r=e.words,n=e.sigBytes,o=(t=void 0===t||t)?this._safe_map:this._map,i=(e.clamp(),[]),a=0;a<n;a+=3)for(var s=(r[a>>>2]>>>24-a%4*8&255)<<16|(r[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|r[a+2>>>2]>>>24-(a+2)%4*8&255,d=0;d<4&&a+.75*d<n;d++)i.push(o.charAt(s>>>6*(3-d)&63));var l=o.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e,t){var r=e.length,n=(t=void 0===t||t)?this._safe_map:this._map;if(!(o=this._reverseMap))for(var o=this._reverseMap=[],i=0;i<n.length;i++)o[n.charCodeAt(i)]=i;for(var a,s=(!(t=n.charAt(64))||-1!==(t=e.indexOf(t))&&(r=t),e),d=r,l=o,u=[],c=0,p=0;p<d;p++)p%4&&(a=l[s.charCodeAt(p-1)]<<p%4*2,a|=l[s.charCodeAt(p)]>>>6-p%4*2,u[c>>>2]|=a<<24-c%4*8,c++);return f.create(u,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};for(var Y=Math,K=(J=(We=G).lib).WordArray,X=J.Hasher,J=We.algo,Q=[],Z=0;Z<64;Z++)Q[Z]=4294967296*Y.abs(Y.sin(Z+1))|0;function $(e,t,r,n,o,i,a){return((e=e+(t&r|~t&n)+o+a)<<i|e>>>32-i)+t}function ee(e,t,r,n,o,i,a){return((e=e+(t&n|r&~n)+o+a)<<i|e>>>32-i)+t}function te(e,t,r,n,o,i,a){return((e=e+(t^r^n)+o+a)<<i|e>>>32-i)+t}function re(e,t,r,n,o,i,a){return((e=e+(r^(t|~n))+o+a)<<i|e>>>32-i)+t}J=J.MD5=X.extend({_doReset:function(){this._hash=new K.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[t+0],s=e[t+1],d=e[t+2],l=e[t+3],u=e[t+4],c=e[t+5],p=e[t+6],h=e[t+7],f=e[t+8],m=e[t+9],g=e[t+10],v=e[t+11],y=e[t+12],_=e[t+13],b=e[t+14],S=e[t+15],w=$(i[0],T=i[1],I=i[2],E=i[3],a,7,Q[0]),E=$(E,w,T,I,s,12,Q[1]),I=$(I,E,w,T,d,17,Q[2]),T=$(T,I,E,w,l,22,Q[3]);w=re(w=te(w=te(w=te(w=te(w=ee(w=ee(w=ee(w=ee(w=$(w=$(w=$(w,T,I,E,u,7,Q[4]),T=$(T,I=$(I,E=$(E,w,T,I,c,12,Q[5]),w,T,p,17,Q[6]),E,w,h,22,Q[7]),I,E,f,7,Q[8]),T=$(T,I=$(I,E=$(E,w,T,I,m,12,Q[9]),w,T,g,17,Q[10]),E,w,v,22,Q[11]),I,E,y,7,Q[12]),T=$(T,I=$(I,E=$(E,w,T,I,_,12,Q[13]),w,T,b,17,Q[14]),E,w,S,22,Q[15]),I,E,s,5,Q[16]),T=ee(T,I=ee(I,E=ee(E,w,T,I,p,9,Q[17]),w,T,v,14,Q[18]),E,w,a,20,Q[19]),I,E,c,5,Q[20]),T=ee(T,I=ee(I,E=ee(E,w,T,I,g,9,Q[21]),w,T,S,14,Q[22]),E,w,u,20,Q[23]),I,E,m,5,Q[24]),T=ee(T,I=ee(I,E=ee(E,w,T,I,b,9,Q[25]),w,T,l,14,Q[26]),E,w,f,20,Q[27]),I,E,_,5,Q[28]),T=ee(T,I=ee(I,E=ee(E,w,T,I,d,9,Q[29]),w,T,h,14,Q[30]),E,w,y,20,Q[31]),I,E,c,4,Q[32]),T=te(T,I=te(I,E=te(E,w,T,I,f,11,Q[33]),w,T,v,16,Q[34]),E,w,b,23,Q[35]),I,E,s,4,Q[36]),T=te(T,I=te(I,E=te(E,w,T,I,u,11,Q[37]),w,T,h,16,Q[38]),E,w,g,23,Q[39]),I,E,_,4,Q[40]),T=te(T,I=te(I,E=te(E,w,T,I,a,11,Q[41]),w,T,l,16,Q[42]),E,w,p,23,Q[43]),I,E,m,4,Q[44]),T=te(T,I=te(I,E=te(E,w,T,I,y,11,Q[45]),w,T,S,16,Q[46]),E,w,d,23,Q[47]),I,E,a,6,Q[48]),T=re(T=re(T=re(T=re(T,I=re(I,E=re(E,w,T,I,h,10,Q[49]),w,T,b,15,Q[50]),E,w,c,21,Q[51]),I=re(I,E=re(E,w=re(w,T,I,E,y,6,Q[52]),T,I,l,10,Q[53]),w,T,g,15,Q[54]),E,w,s,21,Q[55]),I=re(I,E=re(E,w=re(w,T,I,E,f,6,Q[56]),T,I,S,10,Q[57]),w,T,p,15,Q[58]),E,w,_,21,Q[59]),I=re(I,E=re(E,w=re(w,T,I,E,u,6,Q[60]),T,I,v,10,Q[61]),w,T,d,15,Q[62]),E,w,m,21,Q[63]),i[0]=i[0]+w|0,i[1]=i[1]+T|0,i[2]=i[2]+I|0,i[3]=i[3]+E|0},_doFinalize:function(){for(var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes,o=(t[n>>>5]|=128<<24-n%32,Y.floor(r/4294967296)),i=(o=(t[15+(64+n>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t[14+(64+n>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process(),this._hash)).words,a=0;a<4;a++){var s=i[a];i[a]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return o},clone:function(){var e=X.clone.call(this);return e._hash=this._hash.clone(),e}}),We.MD5=X._createHelper(J),We.HmacMD5=X._createHmacHelper(J),J=(We=G).lib,e=J.WordArray,t=J.Hasher,J=We.algo,u=[],J=J.SHA1=t.extend({_doReset:function(){this._hash=new e.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],d=0;d<80;d++){d<16?u[d]=0|e[t+d]:(l=u[d-3]^u[d-8]^u[d-14]^u[d-16],u[d]=l<<1|l>>>31);var l=(n<<5|n>>>27)+s+u[d];l+=d<20?1518500249+(o&i|~o&a):d<40?1859775393+(o^i^a):d<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,s=a,a=i,i=o<<30|o>>>2,o=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=Math.floor(r/4294967296),t[15+(64+n>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e}}),We.SHA1=t._createHelper(J),We.HmacSHA1=t._createHmacHelper(J);var ne=Math,oe=(J=(We=G).lib).WordArray,ie=J.Hasher,ae=(J=We.algo,[]),se=[];function de(e){return 4294967296*(e-(0|e))|0}for(var le=2,ue=0;ue<64;)!function(e){for(var t=ne.sqrt(e),r=2;r<=t;r++)if(!(e%r))return;return 1}(le)||(ue<8&&(ae[ue]=de(ne.pow(le,.5))),se[ue]=de(ne.pow(le,1/3)),ue++),le++;var ce=[],pe=(J=J.SHA256=ie.extend({_doReset:function(){this._hash=new oe.init(ae.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],d=r[5],l=r[6],u=r[7],c=0;c<64;c++){c<16?ce[c]=0|e[t+c]:(p=ce[c-15],h=ce[c-2],ce[c]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+ce[c-7]+((h<<15|h>>>17)^(h<<13|h>>>19)^h>>>10)+ce[c-16]);var p=n&o^n&i^o&i,h=u+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&d^~s&l)+se[c]+ce[c];u=l,l=d,d=s,s=a+h|0,a=i,i=o,o=n,n=h+(((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+p)|0}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0,r[5]=r[5]+d|0,r[6]=r[6]+l|0,r[7]=r[7]+u|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(64+n>>>9<<4)]=ne.floor(r/4294967296),t[15+(64+n>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=ie.clone.call(this);return e._hash=this._hash.clone(),e}}),(We=(We.SHA256=ie._createHelper(J),We.HmacSHA256=ie._createHmacHelper(J),r=(We=G).lib.WordArray,J=We.algo,n=J.SHA256,J=J.SHA224=n.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=n._doFinalize.call(this);return e.sigBytes-=4,e}}),We.SHA224=n._createHelper(J),We.HmacSHA224=n._createHmacHelper(J),G)).lib.Hasher),he=(J=We.x64).Word,fe=J.WordArray;J=We.algo;function me(){return he.create.apply(he,arguments)}for(var ge=[me(1116352408,3609767458),me(1899447441,602891725),me(3049323471,3964484399),me(3921009573,2173295548),me(961987163,4081628472),me(1508970993,3053834265),me(2453635748,2937671579),me(2870763221,3664609560),me(3624381080,2734883394),me(310598401,1164996542),me(607225278,1323610764),me(1426881987,3590304994),me(1925078388,4068182383),me(2162078206,991336113),me(2614888103,633803317),me(3248222580,3479774868),me(3835390401,2666613458),me(4022224774,944711139),me(264347078,2341262773),me(604807628,2007800933),me(770255983,1495990901),me(1249150122,1856431235),me(1555081692,3175218132),me(1996064986,2198950837),me(2554220882,3999719339),me(2821834349,766784016),me(2952996808,2566594879),me(3210313671,3203337956),me(3336571891,1034457026),me(3584528711,2466948901),me(113926993,3758326383),me(338241895,168717936),me(666307205,1188179964),me(773529912,1546045734),me(1294757372,1522805485),me(1396182291,2643833823),me(1695183700,2343527390),me(1986661051,1014477480),me(2177026350,1206759142),me(2456956037,344077627),me(2730485921,1290863460),me(2820302411,3158454273),me(3259730800,3505952657),me(3345764771,106217008),me(3516065817,3606008344),me(3600352804,1432725776),me(4094571909,1467031594),me(275423344,851169720),me(430227734,3100823752),me(506948616,1363258195),me(659060556,3750685593),me(883997877,3785050280),me(958139571,3318307427),me(1322822218,3812723403),me(1537002063,2003034995),me(1747873779,3602036899),me(1955562222,1575990012),me(2024104815,1125592928),me(2227730452,2716904306),me(2361852424,442776044),me(2428436474,593698344),me(2756734187,3733110249),me(3204031479,2999351573),me(3329325298,3815920427),me(3391569614,3928383900),me(3515267271,566280711),me(3940187606,3454069534),me(4118630271,4000239992),me(116418474,1914138554),me(174292421,2731055270),me(289380356,3203993006),me(460393269,320620315),me(685471733,587496836),me(852142971,1086792851),me(1017036298,365543100),me(1126000580,2618297676),me(1288033470,3409855158),me(1501505948,4234509866),me(1607167915,987167468),me(1816402316,1246189591)],ve=[],ye=0;ye<80;ye++)ve[ye]=me();J=J.SHA512=pe.extend({_doReset:function(){this._hash=new fe.init([new he.init(1779033703,4089235720),new he.init(3144134277,2227873595),new he.init(1013904242,4271175723),new he.init(2773480762,1595750129),new he.init(1359893119,2917565137),new he.init(2600822924,725511199),new he.init(528734635,4215389547),new he.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=(l=this._hash.words)[0],n=l[1],o=l[2],i=l[3],a=l[4],s=l[5],d=l[6],l=l[7],u=r.high,c=r.low,p=n.high,h=n.low,f=o.high,m=o.low,g=i.high,v=i.low,y=a.high,_=a.low,b=s.high,S=s.low,w=d.high,E=d.low,I=l.high,T=l.low,C=u,R=c,P=p,k=h,x=f,M=m,A=g,O=v,U=y,D=_,L=b,H=S,N=w,B=E,j=I,V=T,F=0;F<80;F++){var q,G,W=ve[F],z=(F<16?(G=W.high=0|e[t+2*F],q=W.low=0|e[t+2*F+1]):($=(J=ve[F-15]).high,J=J.low,X=(K=ve[F-2]).high,K=K.low,Y=(z=ve[F-7]).high,z=z.low,Z=(Q=ve[F-16]).high,G=(G=(($>>>1|J<<31)^($>>>8|J<<24)^$>>>7)+Y+((q=(Y=(J>>>1|$<<31)^(J>>>8|$<<24)^(J>>>7|$<<25))+z)>>>0<Y>>>0?1:0))+((X>>>19|K<<13)^(X<<3|K>>>29)^X>>>6)+((q+=J=(K>>>19|X<<13)^(K<<3|X>>>29)^(K>>>6|X<<26))>>>0<J>>>0?1:0),q+=$=Q.low,W.high=G=G+Z+(q>>>0<$>>>0?1:0),W.low=q),U&L^~U&N),Y=D&H^~D&B,K=C&P^C&x^P&x,X=(R>>>28|C<<4)^(R<<30|C>>>2)^(R<<25|C>>>7),J=ge[F],Q=J.high,Z=J.low,$=V+((D>>>14|U<<18)^(D>>>18|U<<14)^(D<<23|U>>>9)),ee=(W=j+((U>>>14|D<<18)^(U>>>18|D<<14)^(U<<23|D>>>9))+($>>>0<V>>>0?1:0),X+(R&k^R&M^k&M));j=N,V=B,N=L,B=H,L=U,H=D,U=A+(W=W+z+(($+=Y)>>>0<Y>>>0?1:0)+Q+(($+=Z)>>>0<Z>>>0?1:0)+G+(($+=q)>>>0<q>>>0?1:0))+((D=O+$|0)>>>0<O>>>0?1:0)|0,A=x,O=M,x=P,M=k,P=C,k=R,C=W+(((C>>>28|R<<4)^(C<<30|R>>>2)^(C<<25|R>>>7))+K+(ee>>>0<X>>>0?1:0))+((R=$+ee|0)>>>0<$>>>0?1:0)|0}c=r.low=c+R,r.high=u+C+(c>>>0<R>>>0?1:0),h=n.low=h+k,n.high=p+P+(h>>>0<k>>>0?1:0),m=o.low=m+M,o.high=f+x+(m>>>0<M>>>0?1:0),v=i.low=v+O,i.high=g+A+(v>>>0<O>>>0?1:0),_=a.low=_+D,a.high=y+U+(_>>>0<D>>>0?1:0),S=s.low=S+H,s.high=b+L+(S>>>0<H>>>0?1:0),E=d.low=E+B,d.high=w+N+(E>>>0<B>>>0?1:0),T=l.low=T+V,l.high=I+j+(T>>>0<V>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(128+n>>>10<<5)]=Math.floor(r/4294967296),t[31+(128+n>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=pe.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),We.SHA512=pe._createHelper(J),We.HmacSHA512=pe._createHmacHelper(J),J=(We=G).x64,s=J.Word,d=J.WordArray,J=We.algo,l=J.SHA512,J=J.SHA384=l.extend({_doReset:function(){this._hash=new d.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var e=l._doFinalize.call(this);return e.sigBytes-=16,e}}),We.SHA384=l._createHelper(J),We.HmacSHA384=l._createHmacHelper(J);for(var _e=Math,be=(J=(We=G).lib).WordArray,Se=J.Hasher,we=We.x64.Word,Ee=(J=We.algo,[]),Ie=[],Te=[],Ce=1,Re=0,Pe=0;Pe<24;Pe++){Ee[Ce+5*Re]=(Pe+1)*(Pe+2)/2%64;var ke=(2*Ce+3*Re)%5;Ce=Re%5,Re=ke}for(Ce=0;Ce<5;Ce++)for(Re=0;Re<5;Re++)Ie[Ce+5*Re]=Re+(2*Ce+3*Re)%5*5;for(var xe=1,Me=0;Me<24;Me++){for(var Ae,Oe=0,Ue=0,De=0;De<7;De++)1&xe&&((Ae=(1<<De)-1)<32?Ue^=1<<Ae:Oe^=1<<Ae-32),128&xe?xe=xe<<1^113:xe<<=1;Te[Me]=we.create(Oe,Ue)}for(var Le=[],He=0;He<25;He++)Le[He]=we.create();function Ne(e,t,r){return e&t|~e&r}function Be(e,t,r){return e&r|t&~r}function je(e,t){return e<<t|e>>>32-t}function Ve(e){return"string"==typeof e?U:O}function Fe(e,t,r){var n,o=this._iv;o?(n=o,this._iv=void 0):n=this._prevBlock;for(var i=0;i<r;i++)e[t+i]^=n[i]}function qe(e,t,r,n){var o,i=this._iv;i?(o=i.slice(0),this._iv=void 0):o=this._prevBlock,n.encryptBlock(o,0);for(var a=0;a<r;a++)e[t+a]^=o[a]}function Ge(e){var t,r,n;return 255==(e>>24&255)?(r=e>>8&255,n=255&e,255==(t=e>>16&255)?(t=0,255===r?(r=0,255===n?n=0:++n):++r):++t,e=0,e=(e+=t<<16)+(r<<8)+n):e+=1<<24,e}J=J.SHA3=Se.extend({cfg:Se.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new we.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,n=this.blockSize/2,o=0;o<n;o++){var i=e[t+2*o],a=e[t+2*o+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);(w=r[o]).high^=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),w.low^=i}for(var s=0;s<24;s++){for(var d=0;d<5;d++){for(var l=0,u=0,c=0;c<5;c++)l^=(w=r[d+5*c]).high,u^=w.low;var p=Le[d];p.high=l,p.low=u}for(d=0;d<5;d++){var h=Le[(d+4)%5],f=(m=Le[(d+1)%5]).high,m=m.low;for(l=h.high^(f<<1|m>>>31),u=h.low^(m<<1|f>>>31),c=0;c<5;c++)(w=r[d+5*c]).high^=l,w.low^=u}for(var g=1;g<25;g++){var v=(w=r[g]).high,y=w.low,_=Ee[g];(v=(u=_<32?(l=v<<_|y>>>32-_,y<<_|v>>>32-_):(l=y<<_-32|v>>>64-_,v<<_-32|y>>>64-_),Le[Ie[g]])).high=l,v.low=u}var b=Le[0],S=r[0];for(b.high=S.high,b.low=S.low,d=0;d<5;d++)for(c=0;c<5;c++){var w=r[g=d+5*c],E=Le[g],I=Le[(d+1)%5+5*c],T=Le[(d+2)%5+5*c];w.high=E.high^~I.high&T.high,w.low=E.low^~I.low&T.low}w=r[0],b=Te[s],w.high^=b.high,w.low^=b.low}},_doFinalize:function(){for(var e=this._data,t=e.words,r=(this._nDataBytes,8*e.sigBytes),n=32*this.blockSize,o=(t[r>>>5]|=1<<24-r%32,t[(_e.ceil((1+r)/n)*n>>>5)-1]|=128,e.sigBytes=4*t.length,this._process(),this._state),i=(r=this.cfg.outputLength/8)/8,a=[],s=0;s<i;s++){var d=(l=o[s]).high,l=l.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8);a.push(16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)),a.push(d)}return new be.init(a,r)},clone:function(){for(var e=Se.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}}),We.SHA3=Se._createHelper(J),We.HmacSHA3=Se._createHmacHelper(J),Math,J=(We=G).lib,c=J.WordArray,p=J.Hasher,J=We.algo,E=c.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),I=c.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),T=c.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),C=c.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),R=c.create([0,1518500249,1859775393,2400959708,2840853838]),P=c.create([1352829926,1548603684,1836072691,2053994217,0]),J=J.RIPEMD160=p.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i,a,s,d,l,u,c=this._hash.words,p=R.words,h=P.words,f=E.words,m=I.words,g=T.words,v=C.words,y=i=c[0],_=a=c[1],b=s=c[2],S=d=c[3],w=l=c[4];for(r=0;r<80;r+=1)u=(u=je(u=(u=i+e[t+f[r]]|0)+(r<16?(a^s^d)+p[0]:r<32?Ne(a,s,d)+p[1]:r<48?((a|~s)^d)+p[2]:r<64?Be(a,s,d)+p[3]:(a^(s|~d))+p[4])|0,g[r]))+l|0,i=l,l=d,d=je(s,10),s=a,a=u,u=(u=je(u=(u=y+e[t+m[r]]|0)+(r<16?(_^(b|~S))+h[0]:r<32?Be(_,b,S)+h[1]:r<48?((_|~b)^S)+h[2]:r<64?Ne(_,b,S)+h[3]:(_^b^S)+h[4])|0,v[r]))+w|0,y=w,w=S,S=je(b,10),b=_,_=u;u=c[1]+s+S|0,c[1]=c[2]+d+w|0,c[2]=c[3]+l+y|0,c[3]=c[4]+i+_|0,c[4]=c[0]+a+b|0,c[0]=u},_doFinalize:function(){for(var e,t=this._data,r=t.words,n=8*this._nDataBytes,o=(e=(r[(e=8*t.sigBytes)>>>5]|=128<<24-e%32,r[14+(64+e>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(r.length+1),this._process(),this._hash)).words,i=0;i<5;i++){var a=o[i];o[i]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return e},clone:function(){var e=p.clone.call(this);return e._hash=this._hash.clone(),e}}),We.RIPEMD160=p._createHelper(J),We.HmacRIPEMD160=p._createHmacHelper(J),J=(We=G).lib.Base,m=We.enc.Utf8,We.algo.HMAC=J.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=m.parse(t));for(var r=e.blockSize,n=4*r,o=(e=((t=t.sigBytes>n?e.finalize(t):t).clamp(),this._oKey=t.clone()),t=this._iKey=t.clone(),e.words),i=t.words,a=0;a<r;a++)o[a]^=1549556828,i[a]^=909522486;e.sigBytes=t.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;e=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(e))}}),ht=(J=(We=G).lib).Base,v=J.WordArray,wt=(J=We.algo).SHA256,y=J.HMAC,g=J.PBKDF2=ht.extend({cfg:ht.extend({keySize:4,hasher:wt,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=y.create(r.hasher,e),o=v.create(),i=v.create([1]),a=o.words,s=i.words,d=r.keySize,l=r.iterations;a.length<d;){for(var u=n.update(t).finalize(i),c=(n.reset(),u.words),p=c.length,h=u,f=1;f<l;f++){h=n.finalize(h),n.reset();for(var m=h.words,g=0;g<p;g++)c[g]^=m[g]}o.concat(u),s[0]++}return o.sigBytes=4*d,o}}),We.PBKDF2=function(e,t,r){return g.create(r).compute(e,t)},wt=(ht=(J=G).lib).Base,_=ht.WordArray,We=(ht=J.algo).MD5,b=ht.EvpKDF=wt.extend({cfg:wt.extend({keySize:4,hasher:We,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,o=n.hasher.create(),i=_.create(),a=i.words,s=n.keySize,d=n.iterations;a.length<s;){r&&o.update(r),r=o.update(e).finalize(t),o.reset();for(var l=1;l<d;l++)r=o.finalize(r),o.reset();i.concat(r)}return i.sigBytes=4*s,i}}),J.EvpKDF=function(e,t,r){return b.create(r).compute(e,t)},G.lib.Cipher||(We=(wt=(ht=G).lib).Base,S=wt.WordArray,w=wt.BufferedBlockAlgorithm,(J=ht.enc).Utf8,k=J.Base64,x=ht.algo.EvpKDF,M=wt.Cipher=w.extend({cfg:We.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){w.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(n){return{encrypt:function(e,t,r){return Ve(t).encrypt(n,e,t,r)},decrypt:function(e,t,r){return Ve(t).decrypt(n,e,t,r)}}}}),wt.StreamCipher=M.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),J=ht.mode={},D=wt.BlockCipherMode=We.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),D=J.CBC=((J=D.extend()).Encryptor=J.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;Fe.call(this,e,t,n),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),J.Decryptor=J.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=e.slice(t,t+n);r.decryptBlock(e,t),Fe.call(this,e,t,n),this._prevBlock=o}}),J),J=(ht.pad={}).Pkcs7={pad:function(e,t){for(var r=(t=4*t)-e.sigBytes%t,n=r<<24|r<<16|r<<8|r,o=[],i=0;i<r;i+=4)o.push(n);t=S.create(o,r),e.concat(t)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},wt.BlockCipher=M.extend({cfg:M.cfg.extend({mode:D,padding:J}),reset:function(){M.reset.call(this);var e,t=(r=this.cfg).iv,r=r.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,t&&t.words):(this._mode=e.call(r,this,t&&t.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),A=wt.CipherParams=We.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),D=(ht.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return(e=(e=e.salt)?S.create([1398893684,1701076831]).concat(e).concat(t):t).toString(k)},parse:function(e){var t,r=(e=k.parse(e)).words;return 1398893684==r[0]&&1701076831==r[1]&&(t=S.create(r.slice(2,4)),r.splice(0,4),e.sigBytes-=16),A.create({ciphertext:e,salt:t})}},O=wt.SerializableCipher=We.extend({cfg:We.extend({format:D}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);t=(o=e.createEncryptor(r,n)).finalize(t);var o=o.cfg;return A.create({ciphertext:t,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),J=(ht.kdf={}).OpenSSL={execute:function(e,t,r,n,o){return n=n||S.random(8),o=(o?x.create({keySize:t+r,hasher:o}):x.create({keySize:t+r})).compute(e,n),e=S.create(o.words.slice(t),4*r),o.sigBytes=4*t,A.create({key:o,iv:e,salt:n})}},U=wt.PasswordBasedCipher=O.extend({cfg:O.cfg.extend({kdf:J}),encrypt:function(e,t,r,n){return r=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize,n.salt,n.hasher),n.iv=r.iv,(e=O.encrypt.call(this,e,t,r.key,n)).mixIn(r),e},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),r=n.kdf.execute(r,e.keySize,e.ivSize,t.salt,n.hasher),n.iv=r.iv,O.decrypt.call(this,e,t,r.key,n)}})),G.mode.CFB=((We=G.lib.BlockCipherMode.extend()).Encryptor=We.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize;qe.call(this,e,t,n,r),this._prevBlock=e.slice(t,t+n)}}),We.Decryptor=We.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=e.slice(t,t+n);qe.call(this,e,t,n,r),this._prevBlock=o}}),We),G.mode.CTR=(ht=(D=G.lib.BlockCipherMode.extend()).Encryptor=D.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=this._iv,i=this._counter,a=(o&&(i=this._counter=o.slice(0),this._iv=void 0),i.slice(0));r.encryptBlock(a,0),i[n-1]=i[n-1]+1|0;for(var s=0;s<n;s++)e[t+s]^=a[s]}}),D.Decryptor=ht,D),G.mode.CTRGladman=(J=(wt=G.lib.BlockCipherMode.extend()).Encryptor=wt.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=this._iv,i=this._counter,a=(o&&(i=this._counter=o.slice(0),this._iv=void 0),0===((o=i)[0]=Ge(o[0]))&&(o[1]=Ge(o[1])),i.slice(0));r.encryptBlock(a,0);for(var s=0;s<n;s++)e[t+s]^=a[s]}}),wt.Decryptor=J,wt),G.mode.OFB=(ht=(We=G.lib.BlockCipherMode.extend()).Encryptor=We.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,o=this._iv,i=this._keystream;o&&(i=this._keystream=o.slice(0),this._iv=void 0),r.encryptBlock(i,0);for(var a=0;a<n;a++)e[t+a]^=i[a]}}),We.Decryptor=ht,We),G.mode.ECB=((J=G.lib.BlockCipherMode.extend()).Encryptor=J.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),J.Decryptor=J.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),J),G.pad.AnsiX923={pad:function(e,t){var r=(r=e.sigBytes)+(t=(t=4*t)-r%t)-1;e.clamp(),e.words[r>>>2]|=t<<24-r%4*8,e.sigBytes+=t},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},G.pad.Iso10126={pad:function(e,t){t*=4,t-=e.sigBytes%t,e.concat(G.lib.WordArray.random(t-1)).concat(G.lib.WordArray.create([t<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},G.pad.Iso97971={pad:function(e,t){e.concat(G.lib.WordArray.create([2147483648],1)),G.pad.ZeroPadding.pad(e,t)},unpad:function(e){G.pad.ZeroPadding.unpad(e),e.sigBytes--}},G.pad.ZeroPadding={pad:function(e,t){t*=4,e.clamp(),e.sigBytes+=t-(e.sigBytes%t||t)},unpad:function(e){var t=e.words,r=e.sigBytes-1;for(r=e.sigBytes-1;0<=r;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},G.pad.NoPadding={pad:function(){},unpad:function(){}},L=(wt=G).lib.CipherParams,H=wt.enc.Hex,wt.format.Hex={stringify:function(e){return e.ciphertext.toString(H)},parse:function(e){return e=H.parse(e),L.create({ciphertext:e})}};for(var We=(ht=G).lib.BlockCipher,ze=(J=ht.algo,[]),Ye=[],Ke=[],Xe=[],Je=[],Qe=[],Ze=[],$e=[],et=[],tt=[],rt=[],nt=0;nt<256;nt++)rt[nt]=nt<128?nt<<1:nt<<1^283;var ot=0,it=0;for(nt=0;nt<256;nt++){var at=it^it<<1^it<<2^it<<3^it<<4,st=(ze[ot]=at=at>>>8^255&at^99,rt[Ye[at]=ot]),dt=rt[st],lt=rt[dt],ut=257*rt[at]^16843008*at;Ke[ot]=ut<<24|ut>>>8,Xe[ot]=ut<<16|ut>>>16,Je[ot]=ut<<8|ut>>>24,Qe[ot]=ut,Ze[at]=(ut=16843009*lt^65537*dt^257*st^16843008*ot)<<24|ut>>>8,$e[at]=ut<<16|ut>>>16,et[at]=ut<<8|ut>>>24,tt[at]=ut,ot?(ot=st^rt[rt[rt[lt^st]]],it^=rt[rt[it]]):ot=it=1}var ct=[0,1,2,4,8,16,32,64,128,27,54],pt=(J=J.AES=We.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*(1+(this._nRounds=6+r)),o=this._keySchedule=[],i=0;i<n;i++)i<r?o[i]=t[i]:(d=o[i-1],i%r?6<r&&i%r==4&&(d=ze[d>>>24]<<24|ze[d>>>16&255]<<16|ze[d>>>8&255]<<8|ze[255&d]):(d=ze[(d=d<<8|d>>>24)>>>24]<<24|ze[d>>>16&255]<<16|ze[d>>>8&255]<<8|ze[255&d],d^=ct[i/r|0]<<24),o[i]=o[i-r]^d);for(var a=this._invKeySchedule=[],s=0;s<n;s++){var d;i=n-s;d=s%4?o[i]:o[i-4],a[s]=s<4||i<=4?d:Ze[ze[d>>>24]]^$e[ze[d>>>16&255]]^et[ze[d>>>8&255]]^tt[ze[255&d]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,Ke,Xe,Je,Qe,ze)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,Ze,$e,et,tt,Ye),r=e[t+1];e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,o,i,a,s){for(var d=this._nRounds,l=e[t]^r[0],u=e[t+1]^r[1],c=e[t+2]^r[2],p=e[t+3]^r[3],h=4,f=1;f<d;f++){var m=n[l>>>24]^o[u>>>16&255]^i[c>>>8&255]^a[255&p]^r[h++],g=n[u>>>24]^o[c>>>16&255]^i[p>>>8&255]^a[255&l]^r[h++],v=n[c>>>24]^o[p>>>16&255]^i[l>>>8&255]^a[255&u]^r[h++],y=n[p>>>24]^o[l>>>16&255]^i[u>>>8&255]^a[255&c]^r[h++];l=m,u=g,c=v,p=y}m=(s[l>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&p])^r[h++],g=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[p>>>8&255]<<8|s[255&l])^r[h++],v=(s[c>>>24]<<24|s[p>>>16&255]<<16|s[l>>>8&255]<<8|s[255&u])^r[h++],y=(s[p>>>24]<<24|s[l>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^r[h++],e[t]=m,e[t+1]=g,e[t+2]=v,e[t+3]=y},keySize:8}),(ht=(wt=(ht.AES=We._createHelper(J),G)).lib).WordArray),ht=ht.BlockCipher,ft=(We=wt.algo,[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4]),mt=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],gt=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],vt=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],yt=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],_t=We.DES=ht.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var n=ft[r]-1;t[r]=e[n>>>5]>>>31-n%32&1}for(var o=this._subKeys=[],i=0;i<16;i++){var a=o[i]=[],s=gt[i];for(r=0;r<24;r++)a[r/6|0]|=t[(mt[r]-1+s)%28]<<31-r%6,a[4+(r/6|0)]|=t[28+(mt[r+24]-1+s)%28]<<31-r%6;for(a[0]=a[0]<<1|a[0]>>>31,r=1;r<7;r++)a[r]=a[r]>>>4*(r-1)+3;a[7]=a[7]<<5|a[7]>>>27}var d=this._invSubKeys=[];for(r=0;r<16;r++)d[r]=o[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],bt.call(this,4,252645135),bt.call(this,16,65535),St.call(this,2,858993459),St.call(this,8,16711935),bt.call(this,1,1431655765);for(var n=0;n<16;n++){for(var o=r[n],i=this._lBlock,a=this._rBlock,s=0,d=0;d<8;d++)s|=vt[d][((a^o[d])&yt[d])>>>0];this._lBlock=a,this._rBlock=i^s}var l=this._lBlock;this._lBlock=this._rBlock,this._rBlock=l,bt.call(this,1,1431655765),St.call(this,8,16711935),St.call(this,2,858993459),bt.call(this,16,65535),bt.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function bt(e,t){t=(this._lBlock>>>e^this._rBlock)&t,this._rBlock^=t,this._lBlock^=t<<e}function St(e,t){t=(this._rBlock>>>e^this._lBlock)&t,this._lBlock^=t,this._rBlock^=t<<e}wt.DES=ht._createHelper(_t),We=We.TripleDES=ht.extend({_doReset:function(){if(2!==(r=this._key.words).length&&4!==r.length&&r.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var e=r.slice(0,2),t=r.length<4?r.slice(0,2):r.slice(2,4),r=r.length<6?r.slice(0,2):r.slice(4,6);this._des1=_t.createEncryptor(pt.create(e)),this._des2=_t.createEncryptor(pt.create(t)),this._des3=_t.createEncryptor(pt.create(r))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2}),wt.TripleDES=ht._createHelper(We);var wt=(J=G).lib.StreamCipher,Et=(ht=J.algo).RC4=wt.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],o=0;o<256;o++)n[o]=o;o=0;for(var i=0;o<256;o++){var a=t[(a=o%r)>>>2]>>>24-a%4*8&255;i=(i+n[o]+a)%256,a=n[o];n[o]=n[i],n[i]=a}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=It.call(this)},keySize:8,ivSize:0});function It(){for(var e=this._S,t=this._i,r=this._j,n=0,o=0;o<4;o++){r=(r+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[r],e[r]=i,n|=e[(e[t]+e[r])%256]<<24-8*o}return this._i=t,this._j=r,n}function Tt(){for(var e=this._X,t=this._C,r=0;r<8;r++)B[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<B[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<B[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<B[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<B[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<B[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<B[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<B[6]>>>0?1:0)|0,this._b=t[7]>>>0<B[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],o=65535&n,i=n>>>16;j[r]=((o*o>>>17)+o*i>>>15)+i*i^((4294901760&n)*n|0)+((65535&n)*n|0)}e[0]=j[0]+(j[7]<<16|j[7]>>>16)+(j[6]<<16|j[6]>>>16)|0,e[1]=j[1]+(j[0]<<8|j[0]>>>24)+j[7]|0,e[2]=j[2]+(j[1]<<16|j[1]>>>16)+(j[0]<<16|j[0]>>>16)|0,e[3]=j[3]+(j[2]<<8|j[2]>>>24)+j[1]|0,e[4]=j[4]+(j[3]<<16|j[3]>>>16)+(j[2]<<16|j[2]>>>16)|0,e[5]=j[5]+(j[4]<<8|j[4]>>>24)+j[3]|0,e[6]=j[6]+(j[5]<<16|j[5]>>>16)+(j[4]<<16|j[4]>>>16)|0,e[7]=j[7]+(j[6]<<8|j[6]>>>24)+j[5]|0}function Ct(){for(var e=this._X,t=this._C,r=0;r<8;r++)F[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<F[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<F[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<F[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<F[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<F[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<F[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<F[6]>>>0?1:0)|0,this._b=t[7]>>>0<F[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],o=65535&n,i=n>>>16;q[r]=((o*o>>>17)+o*i>>>15)+i*i^((4294901760&n)*n|0)+((65535&n)*n|0)}e[0]=q[0]+(q[7]<<16|q[7]>>>16)+(q[6]<<16|q[6]>>>16)|0,e[1]=q[1]+(q[0]<<8|q[0]>>>24)+q[7]|0,e[2]=q[2]+(q[1]<<16|q[1]>>>16)+(q[0]<<16|q[0]>>>16)|0,e[3]=q[3]+(q[2]<<8|q[2]>>>24)+q[1]|0,e[4]=q[4]+(q[3]<<16|q[3]>>>16)+(q[2]<<16|q[2]>>>16)|0,e[5]=q[5]+(q[4]<<8|q[4]>>>24)+q[3]|0,e[6]=q[6]+(q[5]<<16|q[5]>>>16)+(q[4]<<16|q[4]>>>16)|0,e[7]=q[7]+(q[6]<<8|q[6]>>>24)+q[5]|0}J.RC4=wt._createHelper(Et),ht=ht.RC4Drop=Et.extend({cfg:Et.cfg.extend({drop:192}),_doReset:function(){Et._doReset.call(this);for(var e=this.cfg.drop;0<e;e--)It.call(this)}}),J.RC4Drop=wt._createHelper(ht),J=(We=G).lib.StreamCipher,wt=We.algo,N=[],B=[],j=[],wt=wt.Rabbit=J.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(r=this._b=0;r<4;r++)Tt.call(this);for(r=0;r<8;r++)o[r]^=n[r+4&7];if(t){var i,a=(i=16711935&((i=(t=t.words)[0])<<8|i>>>24)|4278255360&(i<<24|i>>>8))>>>16|4294901760&(t=16711935&((t=t[1])<<8|t>>>24)|4278255360&(t<<24|t>>>8)),s=t<<16|65535&i;for(o[0]^=i,o[1]^=a,o[2]^=t,o[3]^=s,o[4]^=i,o[5]^=a,o[6]^=t,o[7]^=s,r=0;r<4;r++)Tt.call(this)}},_doProcessBlock:function(e,t){var r=this._X;Tt.call(this),N[0]=r[0]^r[5]>>>16^r[3]<<16,N[1]=r[2]^r[7]>>>16^r[5]<<16,N[2]=r[4]^r[1]>>>16^r[7]<<16,N[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)N[n]=16711935&(N[n]<<8|N[n]>>>24)|4278255360&(N[n]<<24|N[n]>>>8),e[t+n]^=N[n]},blockSize:4,ivSize:2}),We.Rabbit=J._createHelper(wt),We=(ht=G).lib.StreamCipher,J=ht.algo,V=[],F=[],q=[],J=J.RabbitLegacy=We.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]],o=this._b=0;o<4;o++)Ct.call(this);for(o=0;o<8;o++)n[o]^=r[o+4&7];if(t){var i=(t=16711935&((t=(e=t.words)[0])<<8|t>>>24)|4278255360&(t<<24|t>>>8))>>>16|4294901760&(e=16711935&((e=e[1])<<8|e>>>24)|4278255360&(e<<24|e>>>8)),a=e<<16|65535&t;for(n[0]^=t,n[1]^=i,n[2]^=e,n[3]^=a,n[4]^=t,n[5]^=i,n[6]^=e,n[7]^=a,o=0;o<4;o++)Ct.call(this)}},_doProcessBlock:function(e,t){var r=this._X;Ct.call(this),V[0]=r[0]^r[5]>>>16^r[3]<<16,V[1]=r[2]^r[7]>>>16^r[5]<<16,V[2]=r[4]^r[1]>>>16^r[7]<<16,V[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)V[n]=16711935&(V[n]<<8|V[n]>>>24)|4278255360&(V[n]<<24|V[n]>>>8),e[t+n]^=V[n]},blockSize:4,ivSize:2}),ht.RabbitLegacy=We._createHelper(J),ht=(wt=G).lib.BlockCipher,We=wt.algo;var Rt=16,Pt=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],kt=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]],xt={pbox:[],sbox:[]};function Mt(e,t){var r=e.sbox[0][t>>24&255]+e.sbox[1][t>>16&255];return(r^=e.sbox[2][t>>8&255])+e.sbox[3][255&t]}function At(e,t,r){var n,o=t,i=r;for(t=0;t<Rt;++t)n=o^=e.pbox[t],o=i=Mt(e,o)^i,i=n;return n=o,o=i,i=n,i^=e.pbox[Rt],{left:o^=e.pbox[Rt+1],right:i}}return We=We.Blowfish=ht.extend({_doReset:function(){if(this._keyPriorReset!==this._key){for(var e=(t=this._keyPriorReset=this._key).words,t=t.sigBytes/4,r=xt,n=e,o=t,i=0;i<4;i++){r.sbox[i]=[];for(t=0;t<256;t++)r.sbox[i][t]=kt[i][t]}for(i=0,t=0;t<Rt+2;t++)r.pbox[t]=Pt[t]^n[i],++i>=o&&(i=0);var a=0,s=0,d=0;for(t=0;t<Rt+2;t+=2)a=(d=At(r,a,s)).left,s=d.right,r.pbox[t]=a,r.pbox[t+1]=s;for(i=0;i<4;i++)for(t=0;t<256;t+=2)a=(d=At(r,a,s)).left,s=d.right,r.sbox[i][t]=a,r.sbox[i][t+1]=s}},encryptBlock:function(e,t){var r=At(xt,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},decryptBlock:function(a,s){var e=function(e,t,r){var n,o=t,i=a[s+1];for(t=Rt+1;1<t;--t)n=o^=e.pbox[t],o=i=Mt(e,o)^i,i=n;return n=o,o=i,i=n,i^=e.pbox[1],{left:o^=e.pbox[0],right:i}}(xt,a[s]);a[s]=e.left,a[s+1]=e.right},blockSize:2,keySize:4,ivSize:2}),wt.Blowfish=ht._createHelper(We),G});var ErrorConstant={join_room_timeout:{code:1014,message:"addition will timeout"},oemname_notfound:{code:1017,message:"OEM name not found"},avdEngine_init_failed:{code:1018,message:"The sdk engine failed to initialize"},set_audioCoding_failed:{code:1019,message:"Description Failed to set the audio codec"},set_videCoding_failed:{code:1020,message:"Description Failed to set the video codec"},set_speakerDevice_notsupport_failed:{code:1021,message:"Browser does not support output device selection"},set_speakerDevice_https_failed:{code:1022,message:"You need to use HTTPS for selecting audio output device"},set_speakerDevice_else_failed:{code:1023,message:"else error for selecting audio output device"},userId_format:{code:1309,message:"UserId cannot contain _ characters"},userId_required:{code:1300,message:"UserId is mandatory and cannot be empty"},mulLanding_error:{code:1301,message:"The same userId cannot be logged in multiple times"},roomId_required:{code:1302,message:"roomId is required and cannot be empty"},params_require:{code:1303,message:"params are mandatory and cannot be empty"},userAddress_require:{code:1304,message:"userAddress are required, cannot be empty"},ft_no_authorization:{code:1305,message:"Module without authorization."},upload_filer_required:{code:1306,message:"The uploaded file cannot be empty"},upload_filer_fileType:{code:1307,message:"The type of the uploaded file is not supported"},upload_filer_fileSize:{code:1308,message:"The size of the uploaded file exceeds the threshold"},operate_timeout:{code:1311,message:"The operation has timed out"},exporter_parameter_type_error:{code:1401,message:"Parameter type error"},exporter_parameter_number_error:{code:1402,message:"Parameter range is incorrect, x,y,width,height Please enter a value between 0 and 1"},exporter_parameter_number1_error:{code:1403,message:"The parameter range is incorrect. zorder Please enter a value between 0 and 10"},exporter_parameter_lack_error:{code:1404,message:"Necessary parameters are missing"},video_not_exporter_error:{code:1405,message:"The video has not yet been recorded"},video_has_exporter_error:{code:1406,message:"This video has started recording. Do not repeat recording"},exporter_mix_start_error:{code:1407,message:"No video has been added and cannot be mixed screen recorded"},video_and_userId_error:{code:1408,message:"The user Id and device Id do not match"},exporter_has_stop_error:{code:1409,message:"Recording has stopped"},mqtt_topic_reservedword_error:{code:1500,message:"The current topic value is an internal reserved word, please verify"},room_state_invalid:{code:1503,message:"The current room state  dissatisfy"},data_oversize:{code:1504,message:"The data is oversize, limiting it to 60k."},check_webrtc_supported:{code:2e3,message:"This browser is not supported WebRTC"},not_support_mediaStreamTrack:{code:2001,message:"This browser is not supported MediaStreamTrack."},screen_sharing_plugin_not_accessible:{code:2003,message:"The screen sharing plugin cannot be found"},screen_sharing_response_is_null:{code:2004,message:"No screen sharing"},not_join_room:{code:2005,message:"Haven't join room"},navigatorUserMediaError_notSupportedError:{code:2010,message:"The permission to open the device is insufficient due to non-HTTPS access"},navigatorUserMediaError_overconstrainedError:{code:2011,message:"The device failed to open because the device constraint may not be met"},navigatorUserMediaError_trackStartError:{code:2012,message:"The device failed to open because the device was already occupied"},navigatorUserMediaError_notAllowedError:{code:2013,message:"The open device permission is insufficient because the user denied the media access request"},navigatorUserMediaError_typeError:{code:2014,message:"The device failed to open because at least one audio and video was requested"},navigatorUserMediaError_unknown:{code:2015,message:"Device opening failure Unknown error"},navigatorUserMediaError_notFoundError:{code:2016,message:"Device failed to open, please ensure that the audio/video device you want to open is connected properly"},cameraId_does_not_exist:{code:2017,message:"The camera ID does not exist"},closeVideo_before_operation_warnings:{code:2018,message:"Please turn off the camera before performing this operation"},open_device_no_response:{code:2019,message:"If the device does not respond, restart the browser and try again"},websock_create_error:{code:2020,message:"Websocket failed device create"},websock_catch_exception:{code:2021,message:"Websocket  file is corrupted"},navigatorDisplayMediaError_notSupportedError:{code:2030,message:"The desktop sharing permission is insufficient because the access is not https. Procedure"},navigatorDisplayMediaError_overconstrainedError:{code:2031,message:"Failed to open desktop sharing because desktop sharing constraints may not be met"},navigatorDisplayMediaError_notAllowedError:{code:2033,message:"The desktop sharing failed to be enabled because the user did not select the shared content"},navigatorDisplayMediaError_unknown:{code:2035,message:"Desktop sharing failed to open unknown error"},navigatorDisplayMediaError_screenAudioSelectError:{code:2034,message:"Failed to open desktop sharing! Please turn on the share audio switch and share again!"}},USER_AGENT_AVD_DEFAULT="web",USER_AGENT_AVD_WEB_RECORD="avd_web_record",USER_AGENT_AVD_VIDEO_TRANSCODING="avd_video_transcoding",USER_AGENT_AVD_IOS="web_ios",USER_AGENT_AVD_MEDIA_MIXER="avd_media_mixer",USER_AGENT_AVD_MEDIA_MIXER_ADMIN="avd_media_mixer_admin",USER_AGENT_AVD_THROWING_SCREEN_ANONYM="avd_throwing_screen_anonym",ModulesEnum={avdEngine:"AVDEngine",browserDetect:"BrowserDetect",video:"Video",audio:"Audio",error:"Error",annotation:"Annotation",client:"Client"},Appender={alert:1,inpage:2,popup:3,browserConsole:4},LogLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},SignalType={websocket:"websocket",dataChannel:"dataChannel"},RoomTypeEnum={join_host_first:"join.host.first",net_acc:"net.acc",host_control:"host.control",free_speech:"free.speech"},roomTypePrivilige={join_host_first:2,net_acc:4,host_control:8},EngineCallback={open_rep_return_0:"open.rep.return.0",room_join_success:"room.join.success",room_join_error:"room.join.error",room_join_websocket_reconnection_success:"room.join.websocket.reconnection.success",pub_roomresourcemsg_rep_success:"pub.roomresourcemsg.rep.success",pub_roomresourcemsg_rep_error:"pub.roomresourcemsg.rep.error",unpub_roomresourcemsg_rep_success:"unpub.roomresourcemsg.rep.success",unpub_roomresourcemsg_rep_error:"unpub.roomresourcemsg.rep.error",sub_roomresourcemsg_rep_success:"sub.roomresourcemsg.rep.success",sub_roomresourcemsg_rep_error:"sub.roomresourcemsg.rep.error",unsub_roomresourcemsg_rep_success:"unsub.roomresourcemsg.rep.success",unsub_roomresourcemsg_rep_error:"unsub.roomresourcemsg.rep.error",device_camera_change:"device.camera.change",device_microphone_change:"device.microphone.change",updateboardmsg_rep_success:"updateboardms.rep.success",updateboardmsg_rep_error:"updateboardms.rep.error"},DataCryptoType={AES128:1,AES256:2,SM4:3},VideoCodingType={VP8:0,VP9:1,H264:2},AudioCodingType={ISAC_16k:0,ISAC_32k:1,opus:2,G722:3,PCMA:4,PCMU:5},Resolution={"1920*1280":{width:1920,height:1280,order:16},"1920*1080":{width:1920,height:1080,order:15},"1280*1024":{width:1280,height:1024,order:14},"1280*720":{width:1280,height:720,order:13},"960*720":{width:960,height:720,order:12},"640*1024":{width:640,height:1024,order:11},"640*960":{width:640,height:960,order:10},"640*480":{width:640,height:480,order:9},"640*360":{width:640,height:360,order:8},"508*360":{width:508,height:360,order:7},"480*854":{width:480,height:854,order:6},"480*800":{width:480,height:800,order:5},"320*480":{width:320,height:480,order:4},"320*240":{width:320,height:240,order:3},"320*180":{width:320,height:180,order:2},"160*120":{width:160,height:120,order:1}},ResolutionSetType={exact:0,ideal:1},ConnectionStatus={init:0,connecting:1,connected:2,connectFailed:3,reJoinRoomTimeOut:4,reJoinConnected:5,reconnected:6},MCUPeerConnectionStatus={failed:0,completed:1},RoomStatus={scheduled:0,opening:1,locked:2,closed:3};StreamStatus={none:0,init:1,published:2,muted:3,forbided:4,subed:5,opened:6},CameraType={unknown:0,front:1,back:2},VideoQualityType={high:4,normal:3,low:2};var RoomCallback={connection_status:"connection.status",connection_indicator:"connection.indicator",room_status_notify:"room.status.notify",app_data_notify:"app.data.notify",user_data_notify:"user.data.notify",user_name_notify:"user.name.notify",public_data:"public.data",private_data:"private.data",private_data_to_user:"private.data.to.user",public_message:"public.message ",private_message:"private.message",user_join_notify:"user.join.notify",user_leave_notify:"user.leave.notify",leave_indication:"leave.indication",close_room_result:"close.room.result",close_room_notify:"close.room.notify",screen_sharing_ended:"screen.sharing.ended",mcu_peerconnection_completed:"mcu.peerconnection.completed",outgoing_invite_status_notify:"outgoing.invite.status.notify",room_control_change_notify:"room.control.change.notify",mediaplay_started_notify:"mediaplay.started.notify",mediaplay_stoped_notify:"mediaplay.stoped.notify",mediaplay_progress_notify:"mediaplay.progress.notify",stream_keep_alive_timeout_notify:"stream.keep.alive.timeout.notify"},UserCallback={microphone_status_notify:"microphone.status.notify",camera_status_notify:"camera.status.notify",screen_status_notify:"screen.status.notify",screen_audio_status_notify:"screen,audio.status.notify",camera_data_notify:"camera.data.notify",screen_data_notify:"screen.data.notify",publish_camera_notify:"publish.camera.notify",unpublish_camera_notify:"unpublish.camera.notify",subscrible_camera_result:"subscrible.camera.result",unsubscrible_camera_result:"unsubscrible.camera.result",publish_screen_notify:"publish.screen.notify",unpublish_screen_notify:"unpublish.screen.notify",subscrible_screen_result:"subscrible.screen.result",unsubscrible_screen_result:"unsubscrible.screen.result",publish_microphone_notify:"publish.microphone.notify",unpublish_microphone_notify:"unpublish.microphone.notify",subscrible_microphone_result:"subscrible.microphone.result",unsubscrible_microphone_result:"unsubscrible.microphone.result",board_add_result:"board.add.result",board_update_result:"board.update.result",board_remove_result:"board.remove.result",board_share_result:"board.share.result",board_close_result:"board.close.result",room_set_stream_name_rep_success:"room.set.stream.name.rep.success",room_set_stream_name_rep_error:"room.set.stream.name.rep.error",video_stream_control_rep_success:"video.stream.control.rep.success",video_stream_control_rep_error:"video.stream.control.rep.error",subscrible_screen_audio_result:"subscrible.screen.audio.result",unsubscrible_screen_audio_result:"unsubscrible.screen.audio.result"},ExporderCallBack={stop_stream_rep_success:"stop.stream.rep.success",stop_stream_rep_error:"stop.stream.rep.error",pause_stream_rep_error:"pause.stream.rep.error",pause_stream_rep_success:"pause.stream.rep.success",mix_media_rep_error:"mix.media.rep.error",mix_media_rep_success:"mix.media.rep.success",select_stream_rep_success:"select.stream.rep.success",select_stream_rep_error:"select.stream.rep.error",create_server_recorder_rep_success:"create.server.recorder.rep.success",create_server_recorder_rep_error:"create.server.recorder.rep.error",bind_audio2video_rep_success:"bind.audio2video.rep.success",bind_audio2video_rep_error:"bind.audio2video.rep.error",set_focus_video_rep_success:"set.focus.video.rep.success",set_focus_video_rep_error:"set.focus.video.rep.error",get_exporter_info_rep_success:"get.exporter.info.rep.success",get_exporter_info_rep_error:"get.exporter.info.rep.error"};OperType={add:1,remove:2,update:3,share:4,close:5};var RecordEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2},FileType:{mp4:0,webM:1}},LiveEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2}},shapeTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17,img:18,txt:20},AnnotationInitTypeEnum={proportional:"proportional",full:"full"},boardStatusEnum={close:0,open:1},annoSelectTypeEnum={mouse:1,draw:2,eraser:3},canvasTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},fillTypeEnum={none:1,full:2},arrowTypeEnum={none:1,begin:2,end:3,double:4},connectionEventTypeEnum={sendVideo:1,recvVideo:2,sendAudio:3,recvAudio:4,conndidate:5},exporterTypeEnum={record:0,record_real_time:1,liver:2,avc_media_mixer:7},viewLayoutModeEnum={fixation:0,auto:1,auto_orato:2},exporterStatusEnum={stop:0,live:1,pause:2},recorderAudioEnum={AVD_userId_allUser:"userId2allUser",AVD_userId_allUserWithoutMe:"userId2withoutMe",AVD_userId_noneUser:"userId2None"},appDataKeyEnum={lecturer:"meeting_lecturer",voiceActivated:"voice_activated"},changeTypeEnum={remove:0,add:1},RoomStateEnum={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED",RECONNECTING:"RECONNECTING",DISCONNECTING:"DISCONNECTING"},arrayUtil={intersection:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=e[n];for(n=0,o=t.length;n<o;n++)r[t[n]]=t[n];var i=new Array;n=0;for(var a in r)i[n++]=r[a];return i},chaji:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(n=0,o=t.length;n<o;n++)r[t[n]]=r[t[n]]?2:1;var i=new Array;n=0;for(var a in r)1==r[a]&&(i[n++]=a);return i},chajiObject:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n].nodeId]=1;for(n=0,o=t.length;n<o;n++)r[t[n].nodeId]=r[t[n].nodeId]?2:1;var i=new Array;n=0;for(var a in r)1==r[a]&&(i[n++]=a);return i},inANotInB:function(e,t){for(var r=new Object,n=0,o=e.length;n<o;n++)r[e[n]]=1;for(n=0,o=t.length;n<o;n++)r.hasOwnProperty(t[n])&&(r[t[n]]=void 0);var i=new Array;n=0;for(var a in r)r[a]&&(i[n++]=a);return i},baseSplice:function(e,t){for(var r,n=0;n<e.length;n++){if(e[n]==t){r=n;break}}-1<r&&e.splice(r,1)},objectSplice:function(e,t){for(var r,n=0;n<e.length;n++){if(e[n].id==t){r=n;break}}-1<r&&e.splice(r,1)},userIdSplice:function(e,t){for(var r,n=0;n<e.length;n++){if(e[n].userId==t){r=n;break}}-1<r&&e.splice(r,1)},userIdAndNodeIdSplice:function(e,t,r){for(var n,o=0;o<e.length;o++){var i=e[o];if(i.id==t&&i.nodeId==r){n=o;break}}-1<n&&e.splice(n,1)},contains:function(e,t){for(var r=0;r<e.length;r++)if(0<=t.indexOf(e[r]))return!0;return!1}};function getRandomNum(e,t){var r=t-e,n=Math.random();return e+Math.round(n*r)}var typeConversionUtil={String2ArrayBuffer:function(e){e=btoa(unescape(encodeURIComponent(e)));for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,o=e.length;n<o;n++)r[n]=e.charCodeAt(n);return t},ArrayBuffer2String:function(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(atob(t)))},Uint8ArrayToString:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},stringToUint8Array:function(e){for(var t=[],r=0,n=e.length;r<n;++r)t.push(e.charCodeAt(r));return new Uint8Array(t)}};function versionStringCompare(e,t){for(var r=e.split("."),n=t.split("."),o=Math.max(r.length,n.length),i=0,a=0;a<o;a++){var s=r.length>a?r[a]:0,d=isNaN(Number(s))?s.charCodeAt():Number(s),l=n.length>a?n[a]:0,u=isNaN(Number(l))?l.charCodeAt():Number(l);if(d<u){i=-1;break}if(u<d){i=1;break}}return i}function resizeVideo(e,t,r){doResizeVideo(e,t,r,!1)}function resizeRealVideo(e,t,r){doResizeVideo(e,t,r,!0)}function doResizeVideo(n,o,i,a){o||(o=window.innerWidth),i||(i=window.innerHeight),n.addEventListener("loadedmetadata",function(e){var t=this.videoWidth,r=this.videoHeight;positionLarge(n,t,r,o,i,a)})}function positionLarge(e,t,r,n,o,i){var a,s=(a=i?getCameraRealVideoSize(t,r,n,o):getCameraVideoSize(t,r,n,o))[0],d=a[1],l=getCameraVideoPosition(s,d,n,o),u=l[0],c=l[1];i?positionRealVideo(e,s,d,u,c):positionVideo(e,s,d,u,c)}function getCameraVideoSize(e,t,r,n){var o=e/t;return(r=Math.max(e,r))/o<(n=Math.max(t,n))&&(r=(n=n)*o),n*o<r&&(n=(r=r)/o),[r,n]}function getCameraRealVideoSize(e,t,r,n){var o=e/t,i=Math.max(e,r),a=Math.max(t,n);e<=i&&t<=a?r/n<o?n=(r=r)/o:r=(n=n)*o:((n=a)<(r=i)/o&&(r=(n=n)*o),r<n*o&&(n=(r=r)/o));return[r,n]}function getCameraVideoPosition(e,t,r,n){return[(r-e)/2,(n-t)/2]}function positionVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r)}function positionRealVideo(e,t,r,n,o){e.setAttribute("width",t),e.setAttribute("height",r);var i=e.parentNode;i.style.top=o+"px",i.style.bottom=o+"px",i.style.left=n+"px",i.style.right=n+"px"}function fullScreenInit(){document.cancelFullScreen=document.webkitCancelFullScreen||document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.requestFullScreen,document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=displayFullScreenStatus,displayFullScreenStatus()}function doFullScreen(e,t){e.requestFullScreen=e.webkitRequestFullScreen||e.mozRequestFullScreen||e.requestFullScreen,isFullScreen()&&t.target!==e||fullScreenElement()===e?document.cancelFullScreen():(t.target,e.requestFullScreen())}function displayFullScreenStatus(){isFullScreen()}function isFullScreen(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.isFullScreen)}function fullScreenElement(){return document.webkitFullScreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullScreenElement}function doFullScreenInIE(e){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth);var t=window.createPopup(),r=t.document.body;r.style.backgroundColor="lime",r.style.border="solid black 1px",r.innerHTML="在鼠标点击窗口以外区域时自动关闭";var n=t.document.createElement("object");if(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window){var o=t.document.createElement("param");o.setAttribute("name","windowless"),o.setAttribute("value",!0),n.appendChild(o),n.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")}else n.setAttribute("type","application/avd-plugin");n.setAttribute("id","fullScreen"),n.setAttribute("width",winWidth),n.setAttribute("height",winHeight),n.src=e,r.appendChild(n),t.show(0,0,winWidth,winHeight,document.body)}function getLocalClientIP(){var o=when.defer(),e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;return e?function(){var t=new e({iceServers:[]});t.createDataChannel("",{reliable:!1}),t.onicecandidate=function(e){e.candidate&&r("a="+e.candidate.candidate)},t.createOffer(function(e){r(e.sdp),t.setLocalDescription(e)},function(e){console.warn("offer failed",e)});var n=Object.create(null);function i(e){if(!(e in n)){n[e]=!0;for(var t=Object.keys(n).filter(function(e){return n[e]}),r=0;r<t.length;r++)16<t[r].length&&(t.splice(r,1),r--);o.resolve(t[0])}}function r(e){e.split("\r\n").forEach(function(e,t,r){if(~e.indexOf("a=candidate")){var n=(o=e.split(" "))[4];"host"===o[7]&&i(n)}else if(~e.indexOf("c=")){var o;i(n=(o=e.split(" "))[2])}})}n["0.0.0.0"]=!1}():o.reject(""),o.promise}function getEffectiveType(){return navigator.connection.effectiveType}function mathPI2degree(e){var t=0;if(0==e||-0==e)return t;return t=90*Math.round(e/-1.570796326)}function degree2mathPI(e){var t=-0;if(0==e)return t;return t=e/90*-1.570796326}function getGPUInfo(){var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl"),r=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(r.UNMASKED_RENDERER_WEBGL);return n.substring(n.indexOf("(")+1,n.lastIndexOf(")")-1)}function debounce(r,n){var o=null;return function(){var e=this,t=arguments;clearTimeout(o),o=setTimeout(function(){r.apply(e,t)},n)}}if(function(){var o={},s={},i=function(){},e={define:function(e,t,r){if(!o[e]){var n={name:e,dependencies:t,factory:r};o[e]=n}return o[e]},use:function(e){var t=o[e];if(!t)return null;if(!t.entity){for(var r=[],n=0;n<t.dependencies.length;n++)o[t.dependencies[n]].entity?r.push(o[t.dependencies[n]].entity):r.push(this.use(t.dependencies[n]));t.entity=t.factory.apply(i,r)}return t.entity},require:function(r,n){for(var e=0;e<r.length;e++){var t=r[e];if(!s[t]){var o=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.async="true",i.src=t+".js",i.onload=function(){s[t]=!0,o.removeChild(i),a()},o.appendChild(i)}}function a(){for(var e=!0,t=0;t<r.length;t++)if(!s[r[t]]){e=!1;break}e&&n()}}};window.ModuleBase=e}(),ModuleBase.define("Error",[],function(){var e=function(e,t){"object"==typeof e&&void 0===t?(this.code=e.code,this.message=e.message):(this.code=e,this.message=t)};return e.prototype.errorShow=function(){return"error code:"+this.code+"; error message:"+this.message},e}),dcodeIO)var dcodeIO=dcodeIO.ProtoBuf;else var dcodeIO=module.exports;var cmdBuilder=dcodeIO.newBuilder({}).import({package:"room_pdu",messages:[{name:"Packet",fields:[{rule:"required",type:"RoomPduType",name:"type",id:1},{rule:"required",type:"int32",name:"priority",id:2,options:{default:0}},{rule:"required",type:"int32",name:"src",id:3},{rule:"required",type:"int32",name:"dst",id:4,options:{default:0}},{rule:"optional",type:"bytes",name:"body",id:5}]},{name:"MultiPacket",fields:[{rule:"repeated",type:"Packet",name:"packets",id:1}]},{name:"Webcam",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"CameraType",name:"ctype",id:7},{rule:"optional",type:"string",name:"stream_nick_name",id:8},{rule:"optional",type:"string",name:"stream_name",id:9}]},{name:"Speaker",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"Desktop",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"string",name:"stream_nick_name",id:7},{rule:"optional",type:"string",name:"stream_name",id:8}]},{name:"DocFile",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"required",type:"string",name:"uri",id:5}]},{name:"AddWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Webcam",name:"webcam",id:2}]},{name:"RemoveWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Speaker",name:"speaker",id:2}]},{name:"RemoveSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"DocFile",name:"docfile",id:2}]},{name:"RemoveDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"RoomResourceInfo",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"int32",name:"owner_id",id:2},{rule:"optional",type:"MediaStream",name:"stream",id:3},{rule:"optional",type:"MediaStream",name:"stream_assist1",id:4},{rule:"optional",type:"MediaStream",name:"stream_assist2",id:5},{rule:"optional",type:"int32",name:"publishQualities",id:6},{rule:"optional",type:"string",name:"rtmp_play_url",id:7},{rule:"optional",type:"int32",name:"keep_alive_time",id:8}]},{name:"RoomInfo",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"required",type:"RoomStatus",name:"room_status",id:2,options:{default:"init_room"}}]},{name:"UserPolicy",fields:[{rule:"optional",type:"bool",name:"join_chat",id:1},{rule:"optional",type:"bool",name:"join_audio",id:2},{rule:"optional",type:"bool",name:"join_video",id:3}]},{name:"JoinInfo",fields:[{rule:"repeated",type:"Webcam",name:"webcams",id:1},{rule:"repeated",type:"Speaker",name:"speakers",id:2},{rule:"optional",type:"string",name:"user_agent",id:3},{rule:"required",type:"UserPolicy",name:"user_policy",id:4},{rule:"optional",type:"string",name:"user_resources",id:5}]},{name:"UserInfo",fields:[{rule:"optional",type:"string",name:"user_id",id:1},{rule:"required",type:"string",name:"user_name",id:2},{rule:"required",type:"UserRole",name:"role",id:3},{rule:"required",type:"int32",name:"privileges",id:4},{rule:"required",type:"UserStatus",name:"status",id:5},{rule:"repeated",type:"Webcam",name:"webcams",id:6},{rule:"repeated",type:"Speaker",name:"speakers",id:7},{rule:"optional",type:"string",name:"user_agent",id:8},{rule:"required",type:"int32",name:"node_id",id:9},{rule:"optional",type:"UserPolicy",name:"user_policy",id:10},{rule:"repeated",type:"Desktop",name:"desktops",id:11},{rule:"optional",type:"string",name:"user_data",id:12}]},{name:"MediaStream",fields:[{rule:"required",type:"string",name:"stream_name",id:1},{rule:"required",type:"MediaType",name:"type",id:2},{rule:"optional",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"width",id:4},{rule:"optional",type:"int32",name:"height",id:5},{rule:"optional",type:"int32",name:"frame_rate",id:6},{rule:"optional",type:"int32",name:"payload",id:7},{rule:"optional",type:"uint32",name:"sdp_version",id:8}]},{name:"MediaStreamInfo",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"MediaStream",name:"stream",id:3}]},{name:"ResourceIndiction",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"ResourceOpt",name:"opt",id:2},{rule:"required",type:"int32",name:"owner_id",id:3},{rule:"required",type:"int32",name:"operator_id",id:4},{rule:"optional",type:"string",name:"host_tocken",id:5}]},{name:"AddDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Desktop",name:"desktop",id:2}]},{name:"UpdateSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Speaker",name:"speaker",id:3}]},{name:"UpdateWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Webcam",name:"webcam",id:3}]},{name:"UpdateDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Desktop",name:"desktop",id:3}]},{name:"JoinReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"version",id:2},{rule:"required",type:"string",name:"room_tocken",id:3},{rule:"optional",type:"string",name:"user_id",id:4},{rule:"required",type:"string",name:"user_name",id:5},{rule:"optional",type:"JoinInfo",name:"join_info",id:6},{rule:"optional",type:"string",name:"password",id:7}]},{name:"JoinRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomInfo",name:"room_info",id:4},{rule:"optional",type:"int32",name:"node_id",id:5},{rule:"optional",type:"UserInfo",name:"user_info",id:6}]},{name:"LeaveMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"reason",id:2}]},{name:"UpdateRoomStatusMsg",fields:[{rule:"required",type:"RoomStatus",name:"status",id:1}]},{name:"PubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"UnpubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"SubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3},{rule:"optional",type:"int32",name:"video_level",id:4}]},{name:"UnsubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3}]},{name:"PubResourceReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2}]},{name:"PubResourceRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RepResultType",name:"type",id:2},{rule:"optional",type:"int32",name:"reason",id:3}]},{name:"RoomKV",fields:[{rule:"required",type:"string",name:"key",id:1},{rule:"required",type:"string",name:"value",id:2}]},{name:"RoomDataInfo",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"repeated",type:"RoomKV",name:"kvs",id:2}]},{name:"PubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"SubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"RoomResourceInfos",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"optional",type:"string",name:"room_id",id:2}]},{name:"UpdateStreamSsrcMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"uint32",name:"old_ssrc",id:3},{rule:"required",type:"uint32",name:"new_ssrc",id:4}]},{name:"ClientTranceInfo",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"level",id:2},{rule:"required",type:"string",name:"msg",id:3}]},{name:"CloseRoomReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"node_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"CloseRoomRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"StartVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"StopVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"ModifyResourceReq",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"optional",type:"int32",name:"video_level",id:3}]},{name:"ModifyResourceRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"UnsubRoomResourceMsgRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"GetMiniProgramStreamUrlReq",fields:[{rule:"optional",type:"int32",name:"id",id:1}]},{name:"GetMiniProgramStreamUrlRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"url",id:3}]},{name:"BindAudioToVideoReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"audio_resource_id",id:2},{rule:"required",type:"string",name:"video_resouce_id",id:3}]},{name:"BindAudioToVideoRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"UnpubRoomResourceMsgRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"TextMsg",fields:[{rule:"required",type:"string",name:"content",id:1},{rule:"optional",type:"int32",name:"timestamp",id:2}]},{name:"DATA",fields:[{rule:"required",type:"bytes",name:"content",id:1}]},{name:"PrivateDataToUser",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"dst_user_id",id:2},{rule:"required",type:"bytes",name:"content",id:3},{rule:"optional",type:"string",name:"src_user_id",id:4}]},{name:"UserInfoMsg",fields:[{rule:"repeated",type:"UserInfo",name:"user",id:1}]},{name:"UserMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserMsgOpt",name:"opt",id:2},{rule:"optional",type:"int32",name:"reason",id:3},{rule:"optional",type:"int32",name:"opt_node_id",id:4}]},{name:"UpdateUserRolePriviledgeMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"old",id:2},{rule:"required",type:"int32",name:"new",id:3}]},{name:"UpdateUserStatusMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserStatus",name:"old",id:2},{rule:"required",type:"UserStatus",name:"new",id:3}]},{name:"UpdateUserRoleMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserRole",name:"old",id:2},{rule:"required",type:"UserRole",name:"new",id:3}]},{name:"UserIndiction",fields:[{rule:"required",type:"int32",name:"operator_id",id:1},{rule:"required",type:"RoomPduType",name:"type",id:2},{rule:"optional",type:"bytes",name:"body",id:3}]},{name:"UpdateUserDataMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"user_data",id:2}]},{name:"RejoinRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"CloseRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"UpdateUserName",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"optional",type:"string",name:"new_name",id:2}]},{name:"ChangeHost",fields:[{rule:"required",type:"int32",name:"host_node_id",id:1},{rule:"optional",type:"int32",name:"newhost_node_id",id:2}]},{name:"OfferReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"sdp",id:2},{rule:"required",type:"int32",name:"node_id",id:3}]},{name:"OfferRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"sdp",id:4},{rule:"optional",type:"int32",name:"node_id",id:5}]},{name:"CandidateMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"int32",name:"node_id",id:4}]},{name:"SubRoomResourceReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"required",type:"int32",name:"sub_node_id",id:3}]},{name:"SubRoomResourceRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomResourceInfo",name:"info",id:4}]},{name:"OpenReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"access_tocken",id:2},{rule:"optional",type:"string",name:"signal_tocken",id:3},{rule:"optional",type:"string",name:"version",id:4},{rule:"optional",type:"string",name:"thread_id",id:5},{rule:"optional",type:"int32",name:"is_cluster",id:6},{rule:"optional",type:"string",name:"audio_codec_payload_map",id:7}]},{name:"OpenRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"signal_tocken",id:4},{rule:"optional",type:"int32",name:"ping_timeout",id:5},{rule:"optional",type:"int32",name:"ping_interval",id:6},{rule:"optional",type:"string",name:"version",id:7}]},{name:"InviteRoomReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"node_id",id:4}]},{name:"InviteRoomReq1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"version",id:3},{rule:"required",type:"string",name:"access_tocken",id:4},{rule:"optional",type:"string",name:"user_id",id:5},{rule:"required",type:"string",name:"user_name",id:6},{rule:"optional",type:"JoinInfo",name:"join_info",id:7},{rule:"optional",type:"string",name:"password",id:8},{rule:"optional",type:"int32",name:"node_id",id:9},{rule:"optional",type:"bool",name:"is_dtls",id:10},{rule:"optional",type:"string",name:"user_data",id:11},{rule:"optional",type:"string",name:"ice_ufrag",id:12},{rule:"optional",type:"string",name:"ice_pwd",id:13},{rule:"optional",type:"bytes",name:"routes_json",id:20},{rule:"optional",type:"int32",name:"media_connect_type",id:21},{rule:"optional",type:"DataCryptoType",name:"crypto_type",id:22}]},{name:"RoomInfo1",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"topic",id:2},{rule:"optional",type:"string",name:"owner_id",id:3},{rule:"optional",type:"string",name:"host_id",id:4},{rule:"optional",type:"bool",name:"has_pwd",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"int32",name:"timezone",id:7},{rule:"optional",type:"int32",name:"start_time",id:8},{rule:"optional",type:"int32",name:"end_time",id:9},{rule:"optional",type:"RoomMode",name:"room_mode",id:10},{rule:"optional",type:"int32",name:"attendee_max",id:11},{rule:"optional",type:"int32",name:"bandwidth",id:12},{rule:"optional",type:"int32",name:"max_audio",id:13},{rule:"optional",type:"int32",name:"max_video",id:14},{rule:"optional",type:"string",name:"room_extend_id",id:15},{rule:"optional",type:"RoomStatus",name:"room_status",id:16,options:{default:"init_room"}},{rule:"optional",type:"int32",name:"attributes",id:17},{rule:"optional",type:"string",name:"is_host_room",id:18},{rule:"optional",type:"int32",name:"room_index_id",id:19}]},{name:"InviteRoomRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"string",name:"sdp",id:5},{rule:"optional",type:"RoomInfo1",name:"room_info",id:6}]},{name:"InviteRoomRep1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"RoomInfo1",name:"room_info",id:5},{rule:"optional",type:"string",name:"finger_print",id:6},{rule:"optional",type:"int32",name:"node_id",id:7},{rule:"optional",type:"int32",name:"ping_timeout",id:8},{rule:"optional",type:"int32",name:"ping_interval",id:9},{rule:"optional",type:"string",name:"ice_ufrag",id:10},{rule:"optional",type:"string",name:"ice_pwd",id:11},{rule:"optional",type:"UserRole",name:"role",id:12},{rule:"optional",type:"string",name:"setup",id:13,options:{default:"active"}},{rule:"optional",type:"string",name:"candidate_string",id:14},{rule:"optional",type:"bool",name:"fec_suported",id:15}]},{name:"CandidateMsg1",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"CloseMsg",fields:[{rule:"required",type:"string",name:"room_tocken",id:1}]},{name:"IceRestartMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"OutgoingInviteStatusNotify",fields:[{rule:"required",type:"OutgoingInviteType",name:"type",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sip_addr",id:3},{rule:"required",type:"int32",name:"status",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"RoomControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAttributeChangeNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAvcControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"int32",name:"handler",id:2}]},{name:"RoomAvcControlRep",fields:[{rule:"required",type:"int32",name:"ret",id:1},{rule:"required",type:"string",name:"msg",id:2}]},{name:"RoomSetStreamNameReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"string",name:"stream_name",id:5},{rule:"optional",type:"string",name:"stream_nick_name",id:6}]},{name:"RoomSetStreamNameRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"int32",name:"ret",id:6},{rule:"optional",type:"string",name:"msg",id:7}]},{name:"RoomStreamNameChangedNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"user_id",id:2},{rule:"required",type:"string",name:"video_resource_id",id:3},{rule:"optional",type:"string",name:"stream_name",id:4},{rule:"optional",type:"string",name:"stream_nick_name",id:5}]},{name:"UserActionEventsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"events",id:4}]},{name:"UserActionEventsRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"optional",type:"int32",name:"ret",id:4},{rule:"optional",type:"string",name:"msg",id:5},{rule:"optional",type:"string",name:"rsp_data",id:6}]},{name:"UserSetKeepAliveTimeReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"keepAliveTime",id:4}]},{name:"UserSetKeepAliveTimeRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"ret",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"UserStreamActive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"resource_id",id:4},{rule:"optional",type:"StreamActiveStatus",name:"active_base",id:5,options:{default:"StreamActiveStatusUnchanged"}},{rule:"optional",type:"StreamActiveStatus",name:"active_ass1",id:6,options:{default:"StreamActiveStatusUnchanged"}},{rule:"optional",type:"StreamActiveStatus",name:"active_ass2",id:7,options:{default:"StreamActiveStatusUnchanged"}}]},{name:"MediaPlayEventNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"play_id",id:3},{rule:"required",type:"MediaPlayEvents",name:"event",id:4},{rule:"required",type:"string",name:"user_id",id:5},{rule:"optional",type:"string",name:"file_path",id:6}]},{name:"StreamKeepAliveTimeoutNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"int32",name:"onwer_id",id:3},{rule:"required",type:"uint32",name:"ssrc",id:4},{rule:"required",type:"string",name:"resource_id",id:5},{rule:"required",type:"MediaType",name:"media_type",id:6}]},{name:"VideoStreamControlReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"int32",name:"onwer_id",id:3},{rule:"required",type:"string",name:"resource_id",id:4},{rule:"required",type:"int32",name:"bitrate_max",id:5},{rule:"required",type:"int32",name:"bitrate_min",id:6},{rule:"required",type:"int32",name:"width",id:7},{rule:"required",type:"int32",name:"heigth",id:8}]},{name:"VideoStreamControlRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"ret",id:2},{rule:"required",type:"string",name:"msg",id:3}]},{name:"Point",fields:[{rule:"required",type:"int32",name:"x",id:1},{rule:"required",type:"int32",name:"y",id:2}]},{name:"color",fields:[{rule:"required",type:"int32",name:"a",id:1},{rule:"required",type:"int32",name:"r",id:2},{rule:"required",type:"int32",name:"g",id:3},{rule:"required",type:"int32",name:"b",id:4}]},{name:"Rect",fields:[{rule:"required",type:"int32",name:"left",id:1},{rule:"required",type:"int32",name:"right",id:2},{rule:"required",type:"int32",name:"top",id:3},{rule:"required",type:"int32",name:"bottom",id:4}]},{name:"AnnotationObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"string",name:"annotationId",id:2},{rule:"required",type:"int32",name:"ownerNodeId",id:3},{rule:"required",type:"string",name:"ownerUserId",id:4},{rule:"required",type:"AnnotationType",name:"type",id:5},{rule:"required",type:"LineArrow",name:"arrow",id:6},{rule:"required",type:"int32",name:"lineWidth",id:7},{rule:"required",type:"color",name:"lineColor",id:8},{rule:"required",type:"color",name:"fillColor",id:9},{rule:"required",type:"Rect",name:"objectRect",id:10}]},{name:"Annotation2Point",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"Point",name:"start",id:2},{rule:"required",type:"Point",name:"end",id:3}]},{name:"AnnotationMultiPoint",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"Point",name:"points",id:2}]},{name:"AnnotationList",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"string",name:"eraserIds",id:2}]},{name:"ImgInfo",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"x",id:2},{rule:"required",type:"int32",name:"y",id:3},{rule:"required",type:"int32",name:"w",id:4},{rule:"required",type:"int32",name:"h",id:5},{rule:"required",type:"int32",name:"layer",id:6},{rule:"required",type:"int32",name:"boder",id:7},{rule:"required",type:"bool",name:"has_select",id:8},{rule:"required",type:"int32",name:"rotate",id:9},{rule:"required",type:"string",name:"file_url",id:10},{rule:"optional",type:"string",name:"extendData",id:11}]},{name:"AnnotationImg",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"ImgInfo",name:"im",id:2}]},{name:"Txt",fields:[{rule:"required",type:"int32",name:"line",id:1},{rule:"required",type:"string",name:"content",id:2}]},{name:"TextInfo",fields:[{rule:"required",type:"uint32",name:"fontSize",id:1},{rule:"repeated",type:"Txt",name:"txs",id:2},{rule:"required",type:"color",name:"fontColor",id:3},{rule:"optional",type:"uint32",name:"oneHeight",id:4},{rule:"optional",type:"uint32",name:"oneWidth",id:5},{rule:"optional",type:"uint32",name:"fontUnit",id:6},{rule:"optional",type:"string",name:"fontStyle",id:7},{rule:"optional",type:"string",name:"fontWeight",id:8},{rule:"optional",type:"string",name:"fontFamily",id:9},{rule:"optional",type:"string",name:"extendData",id:10}]},{name:"AnnotationTxt",fields:[{rule:"required",type:"Annotation2Point",name:"objectBase",id:1},{rule:"required",type:"TextInfo",name:"txi",id:2}]},{name:"AnnotationMsgInternal",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2},{rule:"optional",type:"string",name:"annotationId",id:3},{rule:"optional",type:"int32",name:"srcNodeId",id:4},{rule:"optional",type:"int32",name:"dstNodeId",id:5}]},{name:"AnnotationMsg",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2}]},{name:"UpdateAnnotationMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"string",name:"objectId",id:2},{rule:"required",type:"uint32",name:"annotationType",id:3},{rule:"optional",type:"string",name:"annotationId",id:4},{rule:"required",type:"int32",name:"operNodeId",id:5},{rule:"required",type:"string",name:"operUserId",id:6},{rule:"optional",type:"Annotation2Point",name:"ann2pt",id:7},{rule:"optional",type:"AnnotationMultiPoint",name:"annMutlipt",id:8},{rule:"optional",type:"AnnotationList",name:"annList",id:9},{rule:"optional",type:"AnnotationImg",name:"Img",id:10},{rule:"optional",type:"AnnotationTxt",name:"txt",id:11}]},{name:"BoardObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"int32",name:"ownerNodeId",id:2},{rule:"required",type:"string",name:"ownerUserId",id:3},{rule:"required",type:"int32",name:"width",id:4},{rule:"required",type:"int32",name:"height",id:5},{rule:"optional",type:"color",name:"bgColor",id:6},{rule:"optional",type:"string",name:"bgImage",id:7},{rule:"repeated",type:"AnnotationObject",name:"annotations",id:8},{rule:"optional",type:"string",name:"title",id:9},{rule:"optional",type:"string",name:"description",id:10},{rule:"optional",type:"string",name:"extendData",id:11}]},{name:"UpdateBoardMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"int32",name:"operNodeId",id:2},{rule:"required",type:"string",name:"operUserId",id:3},{rule:"optional",type:"string",name:"boardId",id:4},{rule:"optional",type:"BoardObject",name:"board",id:5}]},{name:"BoardsInfoMsg",fields:[{rule:"repeated",type:"BoardObject",name:"boards",id:2}]},{name:"UpdateBoardMsgRep",fields:[{rule:"required",type:"int32",name:"result",id:1},{rule:"optional",type:"string",name:"description",id:2},{rule:"required",type:"uint32",name:"operType",id:3},{rule:"optional",type:"string",name:"boardId",id:4}]},{name:"OutgoingCreateLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"liver_name",id:8},{rule:"optional",type:"string",name:"app_data",id:9}]},{name:"OutgoingCreateLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4},{rule:"optional",type:"string",name:"publish_url",id:5},{rule:"optional",type:"string",name:"rtmp_url",id:6},{rule:"optional",type:"string",name:"hls_url",id:7}]},{name:"OutgoingSelectMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingVideoInfo",fields:[{rule:"required",type:"string",name:"owner_user_id",id:1},{rule:"required",type:"int32",name:"zoder",id:2},{rule:"optional",type:"float",name:"x",id:5},{rule:"optional",type:"float",name:"y",id:6},{rule:"optional",type:"float",name:"w",id:7},{rule:"optional",type:"float",name:"h",id:8},{rule:"optional",type:"string",name:"video_resource_id",id:9},{rule:"optional",type:"string",name:"video_data",id:10}]},{name:"OutgoingMixMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingDestroyLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingPauseResumeLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"liver_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingGetLivers",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"liver_id",id:3}]},{name:"OutGoingLiverInfo",fields:[{rule:"required",type:"string",name:"liver_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"string",name:"createTime",id:4},{rule:"optional",type:"string",name:"duration",id:5},{rule:"optional",type:"string",name:"room_id",id:6},{rule:"optional",type:"LiveStatus",name:"status",id:7},{rule:"optional",type:"string",name:"publish_url",id:8},{rule:"optional",type:"string",name:"rtmp_url",id:9},{rule:"optional",type:"string",name:"hls_url",id:10}]},{name:"OutgoingGetLiversRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingLiverInfo",name:"liverInfos",id:3}]},{name:"OutgoingCreateRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"record_name",id:5},{rule:"optional",type:"string",name:"app_data",id:6},{rule:"optional",type:"int32",name:"file_type",id:7}]},{name:"OutgoingCreateRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4},{rule:"optional",type:"string",name:"play_url",id:5}]},{name:"OutgoingSelectMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingMixMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingDestroyRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingPauseResumeRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"record_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingGetRecords",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"record_id",id:3}]},{name:"OutGoingRecordInfo",fields:[{rule:"required",type:"string",name:"record_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"MediaFileType",name:"file_type",id:4},{rule:"optional",type:"string",name:"url",id:5},{rule:"optional",type:"int64",name:"file_size",id:6},{rule:"optional",type:"string",name:"create_time",id:7},{rule:"optional",type:"int64",name:"duration",id:8},{rule:"optional",type:"string",name:"room_id",id:9},{rule:"optional",type:"RecordStatus",name:"status",id:10}]},{name:"OutgoingGetRecordsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingRecordInfo",name:"recordInfos",id:3}]},{name:"OutgoingCreateStreamsExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"exporter_name",id:5},{rule:"optional",type:"ExporterType",name:"exporter_type",id:6},{rule:"optional",type:"int32",name:"viewWidth",id:7},{rule:"optional",type:"int32",name:"viewHeight",id:8},{rule:"optional",type:"int32",name:"outBitrate",id:9},{rule:"optional",type:"int32",name:"outFps",id:10},{rule:"optional",type:"string",name:"app_data",id:11},{rule:"optional",type:"bool",name:"auto_close",id:12},{rule:"optional",type:"int32",name:"view_bg_color",id:13},{rule:"optional",type:"int32",name:"view_bg_image",id:14},{rule:"optional",type:"string",name:"main_video_resource_id",id:15},{rule:"optional",type:"string",name:"exporter_nick_name",id:16},{rule:"optional",type:"int32",name:"max_video_number",id:17},{rule:"optional",type:"string",name:"pulish_urls",id:18}]},{name:"OutgoingCreateStreamsExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5},{rule:"optional",type:"string",name:"play_urls",id:6},{rule:"optional",type:"string",name:"exporter_name",id:7}]},{name:"OutgoingSelectStreamReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"string",name:"stream_name",id:7},{rule:"optional",type:"ExporterType",name:"exporter_type",id:8}]},{name:"OutgoingSelectStreamRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingMixStreamsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"ExporterType",name:"exporter_type",id:7}]},{name:"OutgoingMixStreamsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingDestroyExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingDestroyExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingPauseResumeExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"exporter_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingPauseResumeExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterErrorNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"error_no",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterSetFocusVideoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingExporterSetFocusVideoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"int32",name:"ret",id:4},{rule:"optional",type:"string",name:"msg",id:5}]},{name:"OutgoingGetExporterInfoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingGetExporterInfoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"view_stream_id",id:3},{rule:"optional",type:"string",name:"view_name",id:4},{rule:"optional",type:"int32",name:"view_bitrate",id:5},{rule:"optional",type:"int32",name:"view_fps",id:6},{rule:"optional",type:"int32",name:"view_width",id:7},{rule:"optional",type:"int32",name:"view_height",id:8},{rule:"optional",type:"int32",name:"view_bg_color",id:9},{rule:"optional",type:"int32",name:"view_bg_image",id:10},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:11},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:12},{rule:"optional",type:"string",name:"focus_video_resource_id",id:13},{rule:"optional",type:"string",name:"exporter_name",id:14},{rule:"optional",type:"string",name:"exporter_nick_name",id:15},{rule:"optional",type:"int32",name:"max_video_number",id:16},{rule:"optional",type:"int32",name:"ret",id:17},{rule:"optional",type:"string",name:"msg",id:18}]},{name:"MouseParams",fields:[{rule:"optional",type:"string",name:"paramStr",id:1},{rule:"optional",type:"int32",name:"paramInt",id:2}]},{name:"MouseMsg",fields:[{rule:"required",type:"uint32",name:"mouseT",id:1},{rule:"required",type:"int32",name:"x_pos",id:2},{rule:"required",type:"int32",name:"y_pos",id:3},{rule:"repeated",type:"MouseParams",name:"params",id:4}]},{name:"KeyCtrl",fields:[{rule:"required",type:"uint32",name:"keyC",id:1}]},{name:"KeyValue",fields:[{rule:"required",type:"uint32",name:"keyV",id:1}]},{name:"KeyBoardMsg",fields:[{rule:"repeated",type:"KeyCtrl",name:"cc",id:1},{rule:"repeated",type:"KeyValue",name:"vv",id:2}]},{name:"RequestCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"CmdType",name:"cmtype",id:2},{rule:"required",type:"ClientType",name:"client",id:3},{rule:"required",type:"string",name:"bectrluserId",id:4},{rule:"required",type:"string",name:"ctrluserid",id:5},{rule:"required",type:"int64",name:"timestamp",id:6}]},{name:"RespondCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"required",type:"string",name:"ctruserId",id:5},{rule:"required",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int32",name:"desk_width",id:7},{rule:"optional",type:"int32",name:"desk_height",id:8},{rule:"optional",type:"int64",name:"timestamp",id:9}]},{name:"RespondCtrlAsk",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"optional",type:"string",name:"ctruserId",id:5},{rule:"optional",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RequestInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"required",type:"int32",name:"desk_width",id:5},{rule:"required",type:"int32",name:"desk_height",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RespondInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"token",id:3},{rule:"required",type:"string",name:"ctruserId",id:4},{rule:"required",type:"string",name:"beCtrleduserId",id:5},{rule:"optional",type:"int64",name:"timestamp",id:6}]},{name:"RequestTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"ctruserId",id:2},{rule:"required",type:"string",name:"beCtrleduserId",id:3},{rule:"optional",type:"int64",name:"timestamp",id:4}]},{name:"RespondTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"optional",type:"int64",name:"timestamp",id:5}]},{name:"CmdCtrlMsg",fields:[{rule:"required",type:"int32",name:"otype",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"int32",name:"requestid",id:3},{rule:"required",type:"MouseMsg",name:"mouseV",id:4},{rule:"required",type:"KeyBoardMsg",name:"keyV",id:5}]},{name:"CmdCtrlMsgRespond",fields:[{rule:"required",type:"int32",name:"requestid",id:1},{rule:"required",type:"int32",name:"result",id:3}]}],enums:[{name:"RoomPduType",values:[{name:"RoomPduType_Unkonw",id:0},{name:"PING",id:1},{name:"PONG",id:2},{name:"MULTI_PACKET",id:10},{name:"ADD_WEBCAM_MSG",id:1001},{name:"REMOVE_WEBCAM_MSG",id:1002},{name:"ADD_SPEAKER_MSG",id:1003},{name:"REMOVE_SPEAKER_MSG",id:1004},{name:"ADD_DOC_MSG",id:1005},{name:"REMOVE_DOC_MSG",id:1006},{name:"VIDEO_INDICTION",id:1007},{name:"AUDIO_INDICTION",id:1008},{name:"ADD_DESKTOP_MSG",id:1009},{name:"UPDATE_SPEAKER_MSG",id:1010},{name:"UPDATE_WEBCAM_MSG",id:1011},{name:"UPDATE_DESKTOP_MSG",id:1012},{name:"JOIN_REQ",id:2001},{name:"JOIN_REP",id:2002},{name:"LEAVE_MSG",id:2003},{name:"UPDATE_ROOM_STATUS_MSG",id:2004},{name:"PUB_ROOM_RESOURCE_MSG",id:2005},{name:"UNPUB_ROOM_RESOURCE_MSG",id:2006},{name:"SUB_ROOM_RESOURCE_MSG",id:2007},{name:"UNSUB_ROOM_RESOURCE_MSG",id:2008},{name:"PUB_VIDEO_REQ",id:2009},{name:"PUB_AUDIO_REQ",id:2010},{name:"PUB_VIDEO_REP",id:2011},{name:"PUB_AUDIO_REP",id:2012},{name:"ROOM_DATA_INFO",id:2013},{name:"PUB_ROOM_RESOURCE_MSG_REP",id:2014},{name:"SUB_ROOM_RESOURCE_MSG_REP",id:2015},{name:"ROOM_RESOURCE_INFOS",id:2016},{name:"UPDATE_STREAM_SSRC_MSG",id:2017},{name:"CLIENT_TRACE_INFO",id:2018},{name:"CLOSE_ROOM_REQ",id:2019},{name:"CLOSE_ROOM_REP",id:2020},{name:"START_VIDEO_DATA_MSG",id:2021},{name:"STOP_VIDEO_DATA_MSG",id:2022},{name:"MODIFY_RESOURCE_REQ",id:2023},{name:"MODIFY_RESOURCE_REP",id:2024},{name:"UNSUB_ROOM_RESOURCE_MSG_REP",id:2025},{name:"GET_MINI_PROGRAM_STREAM_URL_REQ",id:2026},{name:"GET_MINI_PROGRAM_STREAM_URL_REP",id:2027},{name:"BIND_AUDIO_TO_VIDEO_REQ",id:2028},{name:"BIND_AUDIO_TO_VIDEO_REP",id:2029},{name:"UNPUB_ROOM_RESOURCE_MSG_REP",id:2030},{name:"PUBLIC_TEXT_MSG",id:3001},{name:"PRIVATE_TEXT_MSG",id:3002},{name:"PUBLIC_DATA",id:3003},{name:"PRIVATE_DATA",id:3004},{name:"PRIVATE_DATA_TO_USER",id:3005},{name:"USER_INFO_MSG",id:2051},{name:"USER_MSG",id:2052},{name:"UPDATA_USER_ROLE_PRIVILEDGE_MSG",id:2053},{name:"UPDATE_USER_STATUS_MSG",id:2054},{name:"UPDATE_USER_ROLE_MSG",id:2055},{name:"USER_INDICTION",id:2056},{name:"UPDATE_USER_DATA_MSG",id:2057},{name:"REJOIN_ROOM_MSG",id:2058},{name:"CLOSE_ROOM_MSG",id:2059},{name:"UPDATE_USER_NAME",id:2060},{name:"CHANGE_HOST",id:2061},{name:"OFFER_REQ",id:6001},{name:"OFFER_REP",id:6002},{name:"CANDIDATE_MSG",id:6003},{name:"SUB_ROOM_RESOURCE_REQ",id:6004},{name:"SUB_ROOM_RESOURCE_REP",id:6005},{name:"OPEN_REQ",id:7001},{name:"OPEN_REP",id:7002},{name:"INVITE_ROOM_REQ",id:7003},{name:"INVITE_ROOM_REQ1",id:7020},{name:"INVITE_ROOM_REP",id:7004},{name:"INVITE_ROOM_REP1",id:7021},{name:"CANDIDATE_MSG1",id:7005},{name:"CLOSE_MSG",id:7006},{name:"ICE_RESTART_MSG",id:7007},{name:"OUTGOING_INVITE_STATUS_NOTIFY",id:7008},{name:"ROOM_CONTROL",id:7009},{name:"ROOM_ATTRIBUTE_CHANGE_NOTIFY",id:7022},{name:"ROOM_START_AVC_MIXER_MEDIA",id:7023},{name:"ROOM_START_AVC_MIXER_MEDIA_REP",id:7024},{name:"ROOM_SET_STREAM_NAME_REQ",id:7025},{name:"ROOM_SET_STREAM_NAME_RSP",id:7026},{name:"ROOM_STREAM_NAME_CHANGED_NOTIFY",id:7027},{name:"USER_ACTION_EVENTS_REQ",id:7028},{name:"USER_ACTION_EVENTS_Rsp",id:7029},{name:"USER_SET_KEEP_ALIVE_TIME_REQ",id:7030},{name:"USER_SET_KEEP_ALIVE_TIME_RSP",id:7031},{name:"USER_STREAM_ACTIVE",id:7032},{name:"MEDIA_PLAY_EVENT_NOTIFY",id:7033},{name:"STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY",id:7034},{name:"VIDEO_STREAM_CONTROL_REQ",id:7035},{name:"VIDEO_STREAM_CONTROL_REP",id:7036},{name:"ANNOTATION_MSG",id:2100},{name:"UPDATE_ANNOTATION_MSG",id:2101},{name:"UPDATE_BOARD_MSG",id:2102},{name:"BOARDS_INFO_PDU",id:2103},{name:"UPDATE_BOARD_MSG_REP",id:2104},{name:"OUTGOING_CREATE_LIVER",id:9001},{name:"OUTGOING_CREATE_LIVER_REP",id:9002},{name:"OUTGOING_SELECT_MEDIA_LIVE",id:9003},{name:"OUTGOING_SELECT_MEDIA_LIVE_REP",id:9004},{name:"OUTGOING_MIX_MEDIA_LIVE",id:9005},{name:"OUTGOING_MIX_MEDIA_LIVE_REP",id:9006},{name:"OUTGOING_DESTROY_LIVER",id:9007},{name:"OUTGOING_DESTROY_LIVER_REP",id:9008},{name:"OUTGOING_PAUSE_RESUME_LIVE",id:9009},{name:"OUTGOING_PAUSE_RESUME_LIVE_REP",id:9010},{name:"OUTGOING_GET_LIVERS",id:9011},{name:"OUTGOING_GET_LIVERS_REP",id:9012},{name:"OUTGOING_CREATE_RECORD",id:9013},{name:"OUTGOING_CREATE_RECORD_REP",id:9014},{name:"OUTGOING_SELECT_MEDIA_RECORD",id:9015},{name:"OUTGOING_SELECT_MEDIA_RECORD_REP",id:9016},{name:"OUTGOING_MIX_MEDIA_RECORD",id:9017},{name:"OUTGOING_MIX_MEDIA_RECORD_REP",id:9018},{name:"OUTGOING_DESTROY_RECORD",id:9019},{name:"OUTGOING_DESTROY_RECORD_REP",id:9020},{name:"OUTGOING_PAUSE_RESUME_RECORD",id:9021},{name:"OUTGOING_PAUSE_RESUME_RECORD_REP",id:9022},{name:"OUTGOING_GET_RECORDS",id:9023},{name:"OUTGOING_GET_RECORDS_REP",id:9024},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REQ",id:9025},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REP",id:9026},{name:"OUTGOING_SELECT_STREAM_REQ",id:9027},{name:"OUTGOING_SELECT_STREAM_REP",id:9028},{name:"OUTGOING_MIX_STREAMS_REQ",id:9029},{name:"OUTGOING_MIX_STREAMS_REP",id:9030},{name:"OUTGOING_DESTROY_EXPORTER_REQ",id:9031},{name:"OUTGOING_DESTROY_EXPORTER_REP",id:9032},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REQ",id:9033},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REP",id:9034},{name:"OUTGOING_EXPORTER_ERROR_NOTIFY",id:9035},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ",id:9036},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP",id:9037},{name:"OUTGOING_GET_EXPORTER_INFO_REQ",id:9038},{name:"OUTGOING_GET_EXPORTER_INFO_RSP",id:9039},{name:"REQUEST_CTRL",id:20001},{name:"RESPOND_CTRL",id:20002},{name:"RESPOND_CTRL_ASK",id:20003},{name:"REQUEST_INVITE",id:20004},{name:"RESPOND_INVITE",id:20005},{name:"REQUEST_TERMIAL_CTRL",id:20006},{name:"RESPOND_TERMIAL_CTRL",id:20007},{name:"CMD_CTRL_MSG",id:20008},{name:"CMD_CTRL_MSG_RESPOND",id:20009}]},{name:"RoomStatus",values:[{name:"init_room",id:1},{name:"open_room",id:2},{name:"locked_room",id:3},{name:"closed_room",id:4}]},{name:"ResourceOpt",values:[{name:"pub",id:1},{name:"unpub",id:2},{name:"sub",id:3},{name:"unsub",id:4},{name:"mute",id:5},{name:"unmute",id:6},{name:"forbid",id:7},{name:"unforbid",id:8}]},{name:"ResourceStatus",values:[{name:"init",id:1},{name:"published",id:2},{name:"muted",id:3},{name:"forbided",id:4},{name:"subed",id:5}]},{name:"CameraType",values:[{name:"unknown",id:0},{name:"front",id:1},{name:"back",id:2}]},{name:"UserStatus",values:[{name:"online",id:0},{name:"offline",id:1}]},{name:"UserRole",values:[{name:"host",id:1},{name:"presenter",id:2},{name:"attendee",id:3}]},{name:"MediaType",values:[{name:"video",id:1},{name:"audio",id:2},{name:"desktop",id:3}]},{name:"SessionType",values:[{name:"Chat",id:1},{name:"Audio",id:2},{name:"Video",id:3},{name:"ShareScreen",id:4},{name:"ShareDoc",id:5},{name:"WhiteBoard",id:6}]},{name:"RepResultType",values:[{name:"allowed",id:1},{name:"rejected",id:2}]},{name:"UserMsgOpt",values:[{name:"leave",id:1},{name:"kickoff",id:2},{name:"server_kickoff",id:3},{name:"timeout",id:4}]},{name:"DataCryptoType",values:[{name:"DataCryptoTypeAES128",id:1},{name:"DataCryptoTypeAES256",id:2},{name:"DataCryptoTypeSM4",id:3}]},{name:"RoomMode",values:[{name:"free",id:1},{name:"host1",id:2},{name:"p2pfree",id:3},{name:"p2phost",id:4}]},{name:"OutgoingInviteType",values:[{name:"OutgoingInviteTypeSIP",id:1},{name:"OutgoingInviteTypeH323",id:2},{name:"OutgoingInviteTypeRTSP",id:3}]},{name:"StreamActiveStatus",values:[{name:"StreamActiveStatusUnchanged",id:0},{name:"StreamActiveStatusUnActive",id:1},{name:"StreamActiveStatusActive",id:2}]},{name:"MediaPlayEvents",values:[{name:"MediaPlayEventsStarted",id:0},{name:"MediaPlayEventsStoped",id:1}]},{name:"LineArrow",values:[{name:"none",id:1},{name:"begin",id:2},{name:"end",id:3},{name:"arrow2",id:4}]},{name:"AnnotationType",values:[{name:"annotation_tool_mouse",id:1},{name:"annotation_tool_line",id:2},{name:"annotation_tool_rectangle",id:3},{name:"annotation_tool_ellipse",id:4},{name:"annotation_tool_polyline",id:5},{name:"annotation_tool_polygon",id:6},{name:"annotation_tool_hlight_point",id:7},{name:"annotation_tool_hlight_texttag",id:8},{name:"annotation_tool_eraser_line",id:9},{name:"annotation_tool_eraser_rectangle",id:10},{name:"annotation_tool_rhomb",id:11},{name:"annotation_tool_arrow",id:12},{name:"annotation_tool_success",id:13},{name:"annotation_tool_failure",id:14},{name:"annotation_tool_undo",id:15},{name:"annotation_tool_redo",id:16},{name:"annotation_tool_clear",id:17},{name:"annotation_tool_img",id:18},{name:"annotation_tool_hlight_cricle",id:19},{name:"annotation_tool_txt",id:20}]},{name:"OutGoingViewLayoutMode",values:[{name:"Outgoing_View_Layout_Fixation",id:0},{name:"Outgoing_View_Layout_Auto",id:1},{name:"Outgoing_View_Layout_Auto_Orato",id:2}]},{name:"LiveStatus",values:[{name:"LIVE_STATUS_LIVEING",id:0},{name:"LIVE_STATUS_PAUSED",id:1}]},{name:"RecordStatus",values:[{name:"RECORD_STATUS_LIVEING",id:0},{name:"RECORD_STATUS_PAUSED",id:1}]},{name:"MediaFileType",values:[{name:"TbMediaFormat_AVI",id:0},{name:"TbMediaFormat_WEBM",id:1},{name:"TbMediaFormat_MP4",id:2},{name:"TbMediaFormat_WAV",id:3}]},{name:"ExporterType",values:[{name:"EXPORTER_TYPE_RECORD",id:0},{name:"EXPORTER_TYPE_RECORD_REAL_TIME",id:1},{name:"EXPORTER_TYPE_LIVER",id:2},{name:"EXPORTER_TYPE_RECORD_AUTO",id:3},{name:"EXPORTER_TYPE_LIVER_AUTO",id:4},{name:"EXPORTER_TYPE_LIVER_AUTO_VIEW",id:5},{name:"EXPORTER_TYPE_RECORD_AUTO_VIEW",id:6},{name:"EXPORTER_TYPE_AVC_MEDIA_MIXER",id:7},{name:"EXPORTER_TYPE_RECORD_ONLY_DESKTOP_AUTO",id:9},{name:"EXPORTER_TYPE_LIVE_ONLY_DESKTOP_AUTO",id:10},{name:"EXPORTER_TYPE_RECORD_ONLY_DESKTOP",id:11},{name:"EXPORTER_TYPE_LIVE_ONLY_DESKTOP",id:12}]},{name:"CmdType",values:[{name:"ctrl",id:1},{name:"cancle_ctr",id:2},{name:"extend_ctr1",id:3}]},{name:"ClientType",values:[{name:"Win_pc",id:1},{name:"android",id:2},{name:"ios",id:3}]},{name:"CmdResult",values:[{name:"allow",id:1},{name:"notallow",id:2},{name:"terminal",id:3}]}]}).build(),rtmBuilder=dcodeIO.newBuilder({}).import({package:"signal_pdu",messages:[{name:"signal_header",fields:[{rule:"required",type:"string",name:"version",id:1},{rule:"required",type:"signal_group_type",name:"group_type",id:2},{rule:"required",type:"signal_cmd_type",name:"cmd_type",id:3},{rule:"required",type:"uint32",name:"timestamp",id:4},{rule:"required",type:"string",name:"from",id:5},{rule:"required",type:"string",name:"to",id:6},{rule:"required",type:"bytes",name:"content",id:7}]},{name:"Invite",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteCancel",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteOk",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteReject",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteRinging",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteTimeOut",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteBye",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"MsgData",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3},{rule:"required",type:"uint32",name:"create_time",id:4},{rule:"required",type:"MsgType",name:"msg_type",id:5},{rule:"required",type:"bytes",name:"msg_content",id:6}]},{name:"MsgDataDelivered",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRead",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRecalled",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MouseEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"video_x",id:2},{rule:"optional",type:"int32",name:"video_y",id:3},{rule:"optional",type:"int32",name:"video_w",id:4},{rule:"optional",type:"int32",name:"video_h",id:5},{rule:"optional",type:"mouse_events_type",name:"eventsType",id:6}]},{name:"KeyBoardEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"repeated",type:"int32",name:"keyc",id:2},{rule:"repeated",type:"int32",name:"keyv",id:3},{rule:"optional",type:"keyboard_events_type",name:"eventsType",id:4}]},{name:"RpcCallRequest",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]},{name:"RpcCallResponse",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]},{name:"RpcNotification",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]}],enums:[{name:"signal_group_type",values:[{name:"SIGNALE_GROUP_TYPE_SYS",id:0},{name:"SIGNALE_GROUP_TYPE_MESSAGE",id:1},{name:"SIGNALE_GROUP_TYPE_INVITE",id:3},{name:"SIGNALE_GROUP_TYPE_RPC",id:4},{name:"SIGNALE_GROUP_TYPE_ADDRESS_BOOK",id:5},{name:"SIGNALE_GROUP_TYPE_REMOTE_CONTROL",id:6}]},{name:"signal_cmd_type",values:[{name:"SIGNALE_CMD_TYPE_INVITE",id:0},{name:"SIGNALE_CMD_TYPE_INVITE_CANCEL",id:1},{name:"SIGNALE_CMD_TYPE_INVITE_RINGING",id:2},{name:"SIGNALE_CMD_TYPE_INVITE_OK",id:3},{name:"SIGNALE_CMD_TYPE_INVITE_REJECT",id:4},{name:"SIGNALE_CMD_TYPE_INVITE_TIMEOUT",id:5},{name:"SIGNALE_CMD_TYPE_INVITE_BYE",id:6},{name:"SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS",id:32},{name:"SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS",id:33},{name:"SIGNALE_CMD_TYPE_MESSAGE_DATA",id:48},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECEIVED",id:49},{name:"SIGNALE_CMD_TYPE_MESSAGE_READ",id:50},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECALLED",id:51},{name:"SIGNALE_CMD_TYPE_RPC_CALL_REQUEST",id:64},{name:"SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE",id:65},{name:"SIGNALE_CMD_TYPE_RPC_NOTIFICATION",id:66}]},{name:"SessionType",values:[{name:"SESSION_TYPE_PEERS",id:1},{name:"SESSION_TYPE_GROUP",id:2},{name:"SESSION_TYPE_CHATROOM",id:3}]},{name:"MsgType",values:[{name:"MSG_TYPE_TEXT",id:1},{name:"MSG_TYPE_IMAGE",id:2},{name:"MSG_TYPE_FILE",id:3},{name:"MSG_TYPE_AUDIO",id:4},{name:"MSG_TYPE_VIDEO",id:5},{name:"MSG_TYPE_LOCATION",id:6}]},{name:"MsgStatus",values:[{name:"MSG_STAT_DELIVERING",id:1},{name:"MSG_STAT_DELIVERED",id:2},{name:"MSG_STAT_READ",id:3},{name:"MSG_STAT_FAILED",id:4},{name:"MSG_TYPE_RECALLED",id:5}]},{name:"mouse_events_type",values:[{name:"WM_MOUSEMOVE",id:512},{name:"WM_LBUTTONDOWN",id:513},{name:"WM_LBUTTONUP",id:514},{name:"WM_LBUTTONDBLCLK",id:515},{name:"WM_RBUTTONDOWN",id:516},{name:"WM_RBUTTONUP",id:517},{name:"WM_RBUTTONDBLCLK",id:518},{name:"WM_MBUTTONDOWN",id:519},{name:"WM_MBUTTONUP",id:520},{name:"WM_MBUTTONDBLCLK",id:521},{name:"WM_MOUSEWHEEL",id:522}]},{name:"keyboard_events_type",values:[{name:"WM_KEYDOWN",id:256},{name:"WM_KEYUP",id:257},{name:"WM_CHAR",id:258}]},{name:"keyboard_vk_type",values:[{name:"VK_BACK",id:8},{name:"VK_TAB",id:9},{name:"VK_SHIFT",id:16},{name:"VK_CONTROL",id:17},{name:"VK_MENU",id:18},{name:"VK_PAUSE",id:19},{name:"VK_CAPITAL",id:20},{name:"VK_KANA",id:21},{name:"VK_JUNJA",id:23},{name:"VK_FINAL",id:24},{name:"VK_HANJA",id:25},{name:"VK_KANJI",id:25},{name:"VK_ESCAPE",id:27},{name:"VK_CONVERT",id:28},{name:"VK_NONCONVERT",id:29},{name:"VK_ACCEPT",id:30},{name:"VK_MODECHANGE",id:31},{name:"VK_SPACE",id:32},{name:"VK_PRIOR",id:33},{name:"VK_NEXT",id:34},{name:"VK_END",id:35},{name:"VK_HOME",id:36},{name:"VK_LEFT",id:37},{name:"VK_UP",id:38},{name:"VK_RIGHT",id:39},{name:"VK_DOWN",id:40},{name:"VK_SELECT",id:41},{name:"VK_PRINT",id:42},{name:"VK_EXECUTE",id:43},{name:"VK_SNAPSHOT",id:44},{name:"VK_INSERT",id:45},{name:"VK_DELETE",id:46},{name:"VK_HELP",id:47}]}]}).build();ModuleBase.define("CmdProtobufCoded",[],function(){var y,e=function(){y=cmdBuilder.room_pdu};function a(e,t,r){for(var n=CryptoJS.enc.Utf8.parse(t),o=CryptoJS.enc.Utf8.parse(r),i=function(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,o=0;o<n;o++)t+=String.fromCharCode(r[o]);return window.btoa(t)}(e),a=CryptoJS.AES.decrypt(i,n,{iv:o,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Base64),s=atob(a),d=new ArrayBuffer(s.length),l=new Uint8Array(d),u=0;u<s.length;u++)l[u]=s.charCodeAt(u);return d}return e.prototype.getRoomPduTypeEnum=function(){return y.RoomPduType},e.prototype.getRoomStatusEnum=function(){return y.RoomStatus},e.prototype.getResourceOptEnum=function(){return y.ResourceOpt},e.prototype.getResourceStatusEnum=function(){return y.ResourceStatus},e.prototype.getCameraTypeEnum=function(){return y.CameraType},e.prototype.getUserStatusEnum=function(){return y.UserStatus},e.prototype.getUserRoleEnum=function(){return y.UserRole},e.prototype.getMediaTypeEnum=function(){return y.MediaType},e.prototype.getSessionTypeEnum=function(){return y.SessionType},e.prototype.getRepResultTypeEnum=function(){return y.RepResultType},e.prototype.getUserMsgOptEnum=function(){return y.UserMsgOpt},e.prototype.getRoomModeEnum=function(){return y.RoomMode},e.prototype.getLineArrowEnum=function(){return y.LineArrow},e.prototype.getAnnotationTypeEnum=function(){return y.AnnotationType},e.prototype.getExporterTypeEnum=function(){return y.ExporterType},e.prototype.getOutgoingInviteTypeEnum=function(){return y.OutgoingInviteType},e.prototype.getMediaPlayEventsEnum=function(){return y.MediaPlayEvents},e.prototype.getDataCryptoTypeEnum=function(){return y.DataCryptoType},e.prototype.getOutGoingViewLayoutMode=function(){return y.OutGoingViewLayoutMode},e.prototype.newWebcam=function(){return new y.Webcam},e.prototype.newWebcam=function(e,t,r,n){return new y.Webcam(e,t,r,n)},e.prototype.newSpeaker=function(){return new y.Speaker},e.prototype.newSpeaker=function(e,t,r,n){return new y.Speaker(e,t,r,n)},e.prototype.newDesktop=function(){return new y.Desktop},e.prototype.newDesktop=function(e,t,r,n){return new y.Desktop(e,t,r,n)},e.prototype.newDocFile=function(){return new y.DocFile},e.prototype.newDocFile=function(e,t,r,n,o){return new y.DocFile(e,t,r,n,o)},e.prototype.newAddWebcamMsg=function(){return new y.AddWebcamMsg},e.prototype.newAddWebcamMsg=function(e,t){return new y.AddWebcamMsg(e,t)},e.prototype.newRemoveWebcamMsg=function(){return new y.RemoveWebcamMsg},e.prototype.newRemoveWebcamMsg=function(e,t){return new y.RemoveWebcamMsg(e,t)},e.prototype.newAddSpeakerMsg=function(){return new y.AddSpeakerMsg},e.prototype.newAddSpeakerMsg=function(e,t){return new y.AddSpeakerMsg(e,t)},e.prototype.newRemoveSpeakerMsg=function(){return new y.RemoveSpeakerMsg},e.prototype.newRemoveSpeakerMsg=function(e,t){return new y.RemoveSpeakerMsg(e,t)},e.prototype.newAddDocFileMsg=function(){return new y.AddDocFileMsg},e.prototype.newAddDocFileMsg=function(e,t){return new y.AddDocFileMsg(e,t)},e.prototype.newRemoveDocFileMsg=function(){return new y.RemoveDocFileMsg},e.prototype.newRemoveDocFileMsg=function(e,t){return new y.RemoveDocFileMsg(e,t)},e.prototype.newRoomResourceInfo=function(){return new y.RoomResourceInfo},e.prototype.newRoomResourceInfo=function(e,t,r){return new y.RoomResourceInfo(e,t,r)},e.prototype.newRoomInfo=function(){return new y.RoomInfo},e.prototype.newRoomInfo=function(e,t){return new y.RoomInfo(e,t)},e.prototype.newUserPolicy=function(){return new y.UserPolicy},e.prototype.newUserPolicy=function(e,t,r){return new y.UserPolicy(e,t,r)},e.prototype.newJoinInfo=function(){return new y.JoinInfo},e.prototype.newJoinInfo=function(e,t,r,n,o){return new y.JoinInfo(e,t,r,n,o)},e.prototype.newUserInfo=function(){return new y.UserInfo},e.prototype.newUserInfo=function(e,t,r,n,o,i,a,s,d,l,u,c){return new y.UserInfo(e,t,r,n,o,i,a,s,d,l,u,c)},e.prototype.newMediaStream=function(){return new y.MediaStream},e.prototype.newMediaStream=function(e,t,r,n,o,i,a){var s=new y.MediaStream;return s.stream_name=e,s.type=t,s.sdp=r,void 0!==n&&n&&0!=n&&(s.width=n),void 0!==o&&o&&0!=o&&(s.height=o),void 0!==i&&i&&0!=i&&(s.frame_rate=i),void 0!==a&&(s.payload=a),s},e.prototype.newMediaStreamInfo=function(){return new y.MediaStreamInfo},e.prototype.newMediaStreamInfo=function(e,t,r){return new y.MediaStreamInfo(e,t,r)},e.prototype.newResourceIndiction=function(){return new y.ResourceIndiction},e.prototype.newResourceIndiction=function(e,t,r,n,o){return new y.ResourceIndiction(e,t,r,n,o)},e.prototype.newAddDesktopMsg=function(){return new y.AddDesktopMsg},e.prototype.newAddDesktopMsg=function(e,t){return new y.AddDesktopMsg(e,t)},e.prototype.newRemoveDesktopMsg=function(){return new y.RemoveDesktopMsg},e.prototype.newRemoveDesktopMsg=function(e,t){return new y.RemoveDesktopMsg},e.prototype.newUpdateWebcamMsg=function(){return new y.UpdateWebcamMsg},e.prototype.newUpdateWebcamMsg=function(e,t,r){return new y.UpdateWebcamMsg(e,t,r)},e.prototype.newUpdateSpeakerMsg=function(){return new y.UpdateSpeakerMsg},e.prototype.newUpdateSpeakerMsg=function(e,t,r){return new y.UpdateSpeakerMsg(e,t,r)},e.prototype.newUpdateDesktopMsg=function(){return new y.UpdateDesktopMsg},e.prototype.newUpdateDesktopMsg=function(e,t,r){return new y.UpdateDesktopMsg(e,t,r)},e.prototype.newLeaveMsg=function(){return new y.LeaveMsg},e.prototype.newLeaveMsg=function(e,t){return new y.LeaveMsg(e,t)},e.prototype.newUpdateRoomStatusMsg=function(){return new y.UpdateRoomStatusMsg},e.prototype.newUpdateRoomStatusMsg=function(e){return new y.UpdateRoomStatusMsg(e)},e.prototype.newPubRoomResourceMsg=function(){return new y.PubRoomResourceMsg},e.prototype.newPubRoomResourceMsg=function(e,t){return new y.PubRoomResourceMsg(e,t)},e.prototype.newUnpubRoomResourceMsg=function(){return new y.UnpubRoomResourceMsg},e.prototype.newUnpubRoomResourceMsg=function(e,t){return new y.UnpubRoomResourceMsg(e,t)},e.prototype.newSubRoomResourceMsg=function(){return new y.SubRoomResourceMsg},e.prototype.newSubRoomResourceMsg=function(e,t,r){return new y.SubRoomResourceMsg(e,t,r)},e.prototype.newSubRoomResourceMsg=function(e,t,r,n){return new y.SubRoomResourceMsg(e,t,r,n)},e.prototype.newUnsubRoomResourceMsg=function(){return new y.UnsubRoomResourceMsg},e.prototype.newUnsubRoomResourceMsg=function(e,t,r){return new y.UnsubRoomResourceMsg(e,t,r)},e.prototype.newPubResourceReq=function(){return new y.PubResourceReq},e.prototype.newPubResourceReq=function(e,t){return new y.PubResourceReq(e,t)},e.prototype.newPubResourceRep=function(){return new y.PubResourceRep},e.prototype.newPubResourceRep=function(e,t,r){return new y.PubResourceRep(e,t,r)},e.prototype.newCloseRoomReq=function(){return new y.CloseRoomReq},e.prototype.newCloseRoomReq=function(e,t,r){return new y.CloseRoomReq(e,t,r)},e.prototype.newCloseRoomRep=function(){return new y.CloseRoomRep},e.prototype.newCloseRoomRep=function(e,t,r){return new y.CloseRoomRep(e,t,r)},e.prototype.newUpdateUserName=function(){return new y.UpdateUserName},e.prototype.newUpdateUserName=function(e,t){return new y.UpdateUserName(e,t)},e.prototype.newStartVideoDataMsg=function(){return new y.StartVideoDataMsg},e.prototype.newStartVideoDataMsg=function(e){return new y.StartVideoDataMsg(e)},e.prototype.newStopVideoDataMsg=function(){return new y.StopVideoDataMsg},e.prototype.newStopVideoDataMsg=function(e){return new y.StopVideoDataMsg(e)},e.prototype.newVideoStreamControlReq=function(){return new y.VideoStreamControlReq},e.prototype.newVideoStreamControlReq=function(e,t,r,n,o,i,a,s){return new y.VideoStreamControlReq(e,t,r,n,o,i,a,s)},e.prototype.newModifyResourceReq=function(){return new y.ModifyResourceReq},e.prototype.newModifyResourceReq=function(e,t,r){return new y.ModifyResourceReq(e,t,r)},e.prototype.newModifyResourceRep=function(){return new y.ModifyResourceRep},e.prototype.newModifyResourceRep=function(e,t,r){return new y.ModifyResourceRep(e,t,r)},e.prototype.newRoomKV=function(){return new y.RoomKV},e.prototype.newRoomKV=function(e,t){return new y.RoomKV(e,t)},e.prototype.newRoomDataInfo=function(){return new y.RoomDataInfo},e.prototype.newRoomDataInfo=function(e,t){return new y.RoomDataInfo(e,t)},e.prototype.newTextMsg=function(){return new y.TextMsg},e.prototype.newTextMsg=function(e,t){return new y.TextMsg(e,t)},e.prototype.newData=function(){return new y.DATA},e.prototype.newData=function(e){return new y.DATA(e)},e.prototype.newPrivateDataToUser=function(){return new y.PrivateDataToUser},e.prototype.newPrivateDataToUser=function(e,t,r,n){return new y.PrivateDataToUser(e,t,r,n)},e.prototype.newUserInfoMsg=function(){return new y.UserInfoMsg},e.prototype.newUserInfoMsg=function(e){return new y.UserInfoMsg(e)},e.prototype.newUserMsg=function(){return new y.UserMsg},e.prototype.newUserMsg=function(e,t,r){return new y.UserMsg(e,t,r)},e.prototype.newUpdateUserRolePriviledgeMsg=function(){return new y.UpdateUserRolePriviledgeMsg},e.prototype.newUpdateUserRolePriviledgeMsg=function(e,t,r){return new y.UpdateUserRolePriviledgeMsg(e,t,r)},e.prototype.newUpdateUserStatusMsg=function(){return new y.UpdateUserStatusMsg},e.prototype.newUpdateUserStatusMsg=function(e,t,r){return new y.UpdateUserStatusMsg(e,t,r)},e.prototype.newUpdateUserRoleMsg=function(){return new y.UpdateUserRoleMsg},e.prototype.newUpdateUserRoleMsg=function(e,t,r){return new y.UpdateUserRoleMsg(e,t,r)},e.prototype.newUserIndiction=function(){return new y.UserIndiction},e.prototype.newUserIndiction=function(e,t,r){return new y.UserIndiction(e,t,r)},e.prototype.newUpdateUserDataMsg=function(){return new y.UpdateUserDataMsg},e.prototype.newUpdateUserDataMsg=function(e,t){return new y.UpdateUserDataMsg(e,t)},e.prototype.newCloseRoomMsg=function(){return new y.CloseRoomMsg},e.prototype.newCloseRoomMsg=function(e,t){return new y.CloseRoomMsg(e,t)},e.prototype.newOfferReq=function(){return new y.OfferReq},e.prototype.newOfferReq=function(e,t,r){return new y.OfferReq(e,t,r)},e.prototype.newOfferRep=function(){return new y.OfferRep},e.prototype.newOfferRep=function(e,t,r,n,o){return new y.OfferRep(e,t,r,n,o)},e.prototype.newCandidateMsg=function(){return new y.CandidateMsg},e.prototype.newCandidateMsg=function(e,t,r,n){return new y.CandidateMsg(e,t,r,n)},e.prototype.newSubRoomResourceReq=function(){return new y.SubRoomResourceReq},e.prototype.newSubRoomResourceReq=function(e,t,r){return new y.SubRoomResourceReq(e,t,r)},e.prototype.newSubRoomResourceRep=function(){return new y.SubRoomResourceRep},e.prototype.newSubRoomResourceRep=function(e,t,r,n){return new y.SubRoomResourceRep(e,t,r,n)},e.prototype.newOpenReq=function(){return new y.OpenReq},e.prototype.newOpenReq=function(e,t,r,n,o,i,a){return new y.OpenReq(e,t,r,n,o,i,a)},e.prototype.newInviteRoomReq=function(){return new y.InviteRoomReq},e.prototype.newInviteRoomReq=function(e,t,r,n){return new y.InviteRoomReq(e,t,r,n)},e.prototype.newInviteRoomReq1=function(){return new y.InviteRoomReq1},e.prototype.newInviteRoomReq1=function(e,t,r,n,o,i,a,s,d,l,u,c){var p=new y.InviteRoomReq1(e,t,r,n,o,i,a,s,d,!0,l);return p.media_connect_type=u,p.crypto_type=c,p},e.prototype.newCandidateMsg1=function(){return new y.CandidateMsg1},e.prototype.newCandidateMsg1=function(e,t,r,n){return new y.CandidateMsg1(e,t,r,n)},e.prototype.newCloseMsg=function(){return new y.CloseMsg},e.prototype.newCloseMsg=function(e){return new y.CloseMsg(e)},e.prototype.newPoint=function(){return new y.Point},e.prototype.newPoint=function(e,t){return new y.Point(e,t)},e.prototype.newcolor=function(){return new y.color},e.prototype.newcolor=function(e,t,r,n){return new y.color(e,t,r,n)},e.prototype.newRect=function(){return new y.Rect},e.prototype.newRect=function(e,t,r,n){return new y.Rect(e,t,r,n)},e.prototype.newAnnotationObject=function(){return new y.AnnotationObject},e.prototype.newAnnotationObject=function(e,t,r,n,o,i,a,s,d,l){return new y.AnnotationObject(e,t,r,n,o,i,a,s,d,l)},e.prototype.newAnnotation2Point=function(){return new y.Annotation2Point},e.prototype.newAnnotation2Point=function(e,t,r){return new y.Annotation2Point(e,t,r)},e.prototype.newAnnotationMultiPoint=function(){return new y.AnnotationMultiPoint},e.prototype.newAnnotationMultiPoint=function(e,t){return new y.AnnotationMultiPoint(e,t)},e.prototype.newAnnotationList=function(){return new y.AnnotationList},e.prototype.newAnnotationList=function(e,t){return new y.AnnotationList(e,t)},e.prototype.newImgInfo=function(){return new y.ImgInfo},e.prototype.newImgInfo=function(e,t,r,n,o,i,a,s,d,l,u){return new y.ImgInfo(e,t,r,n,o,i,a,s,d,l,u)},e.prototype.newAnnotationImg=function(){return new y.AnnotationImg},e.prototype.newAnnotationImg=function(e,t){return new y.AnnotationImg(e,t)},e.prototype.newTxt=function(){return new y.Txt},e.prototype.newTxt=function(e,t){return new y.Txt(e,t)},e.prototype.newTextInfo=function(){return new y.TextInfo},e.prototype.newTextInfo=function(e,t,r,n,o,i,a,s,d,l){return new y.TextInfo(e,t,r,n,o,i,a,s,d,l)},e.prototype.newAnnotationTxt=function(){return new y.AnnotationTxt},e.prototype.newAnnotationTxt=function(e,t){return new y.AnnotationTxt(e,t)},e.prototype.newUpdateAnnotationMsg=function(e,t,r,n,o,i,a,s,d,l,u){return new y.UpdateAnnotationMsg(e,t,r,n,o,i,a,s,d,l,u)},e.prototype.newAnnotationMsg=function(){return new y.AnnotationMsg},e.prototype.newAnnotationMsg=function(e,t){return new y.AnnotationMsg(e,t)},e.prototype.newBoardObject=function(){return new y.BoardObject},e.prototype.newBoardObject=function(e,t,r,n,o,i,a,s,d,l,u){return new y.BoardObject(e,t,r,n,o,i,a,s,d,l,u)},e.prototype.newUpdateBoardMsg=function(){return new y.UpdateBoardMsg},e.prototype.newUpdateBoardMsg=function(e,t,r,n,o){return new y.UpdateBoardMsg(e,t,r,n,o)},e.prototype.newBoardsInfoMsg=function(){return new y.BoardsInfoMsg},e.prototype.newBoardsInfoMsg=function(e){return new y.BoardsInfoMsg(e)},e.prototype.newBindAudioToVideoReq=function(e,t,r){return new y.BindAudioToVideoReq(e,t,r)},e.prototype.serverVersionCompatible=function(e){var t=2;avdEngineHandle.restServerInfo.signalData&&(t=4);var r=new ArrayBuffer(10),n=new Int8Array(r);n[0]=88,n[1]="3".charCodeAt(),n[2]="t".charCodeAt(),n[3]="e".charCodeAt(),n[4]="e".charCodeAt(),n[5]="a".charCodeAt(),n[6]="v".charCodeAt(),n[7]="d".charCodeAt(),n[8]=t,n[9]=1;for(var o=new Int8Array(e),i=10+o.length,a=new ArrayBuffer(i),s=new Int8Array(a),d=0;d<10;d++)s[d]=n[d];for(var l=0;l<o.length;l++){s[l+10]=o[l]}return a},e.prototype.encodedPacket=function(e,t,r,n,o){var i=y.Packet,a=null;o&&(a=o.toArrayBuffer());var s=new i(e,t,r,n,a).toArrayBuffer();return avdEngineHandle.restServerInfo.signalData&&(s=function(e,t,r){for(var n=CryptoJS.enc.Utf8.parse(t),o=CryptoJS.enc.Utf8.parse(r),i=CryptoJS.lib.WordArray.create(new Uint8Array(e)),a=CryptoJS.AES.encrypt(i,n,{iv:o,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),s=atob(a.toString()),d=new ArrayBuffer(s.length),l=new Uint8Array(d),u=0;u<s.length;u++)l[u]=s.charCodeAt(u);return d}(s,avdEngineHandle.restServerInfo.signalData,avdEngineHandle.restServerInfo.iv)),e==this.getRoomPduTypeEnum().OPEN_REQ&&(s=this.serverVersionCompatible(s)),s},e.prototype.decodePacket=function(e){return avdEngineHandle.restServerInfo.signalData&&(e=a(e,avdEngineHandle.restServerInfo.signalData,avdEngineHandle.restServerInfo.iv)),y.Packet.decode(e)},e.prototype.decodeUserMsg=function(e){return y.UserMsg.decode(e)},e.prototype.decodeAnnotationMultiPoint=function(e){return y.AnnotationMultiPoint.decode(e)},e.prototype.decodeAnnotation2Point=function(e){return y.Annotation2Point.decode(e)},e.prototype.decodeAnnotationList=function(e){return y.AnnotationList.decode(e)},e.prototype.decodeOutgoingVideoInfo=function(e){return y.OutgoingVideoInfo.decode(e)},e.prototype.newOutgoingCreateStreamsExporterReq=function(){return new y.OutgoingCreateStreamsExporterReq},e.prototype.newOutgoingCreateStreamsExporterReq=function(e,t,r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,v){return new y.OutgoingCreateStreamsExporterReq(e,t,r,n,o,i,a,s,d,l,u,c,p,h,f,m,g,v)},e.prototype.newOutgoingSelectStreamReq=function(){return new y.OutgoingSelectStreamReq},e.prototype.newOutgoingSelectStreamReq=function(e,t,r,n,o,i,a,s){return new y.OutgoingSelectStreamReq(e,t,r,n,o,i,a,s)},e.prototype.newOutgoingMixStreamsReq=function(){return new y.OutgoingMixStreamsReq},e.prototype.newOutgoingMixStreamsReq=function(e,t,r,n,o,i,a){return new y.OutgoingMixStreamsReq(e,t,r,n,o,i,a)},e.prototype.newOutgoingVideoInfo=function(){return new y.OutgoingVideoInfo},e.prototype.newOutgoingVideoInfo=function(e,t,r,n,o,i,a,s){return new y.OutgoingVideoInfo(e,t,r,n,o,i,a,s)},e.prototype.newOutgoingDestroyExporterReq=function(){return new y.OutgoingDestroyExporterReq},e.prototype.newOutgoingDestroyExporterReq=function(e,t,r,n){return new y.OutgoingDestroyExporterReq(e,t,r,n)},e.prototype.newOutgoingPauseResumeExporterReq=function(){return new y.OutgoingPauseResumeExporterReq},e.prototype.newOutgoingPauseResumeExporterReq=function(e,t,r,n,o){return new y.OutgoingPauseResumeExporterReq(e,t,r,n,o)},e.prototype.newRoomControl=function(e,t){return new y.RoomControl(e,t)},e.prototype.newRoomAvcControl=function(e,t){return new y.RoomAvcControl(e,t)},e.prototype.newRoomSetStreamNameReq=function(e,t,r,n,o){return new y.RoomSetStreamNameReq(e,t,r,n,o)},e.prototype.newOutgoingExporterSetFocusVideoReq=function(e,t,r,n,o){return new y.OutgoingExporterSetFocusVideoReq(e,t,r,n,o)},e.prototype.newOutgoingGetExporterInfoReq=function(e,t,r,n){return new y.OutgoingGetExporterInfoReq(e,t,r,n)},e.prototype.decodeBody=function(e){var t=y.RoomPduType,r=y.Packet;avdEngineHandle.restServerInfo.signalData&&(e=a(e,avdEngineHandle.restServerInfo.signalData,avdEngineHandle.restServerInfo.iv));var n=r.decode(e),o=n.type;if(o==t.OPEN_REP)return y.OpenRep.decode(n.body);if(o==t.INVITE_ROOM_REP1)return y.InviteRoomRep1.decode(n.body);if(o==t.ROOM_RESOURCE_INFOS)return y.RoomResourceInfos.decode(n.body);if(o==t.CANDIDATE_MSG1)return y.CandidateMsg1.decode(n.body);if(o==t.ICE_RESTART_MSG)return y.IceRestartMsg.decode(n.body);if(o==t.PUB_RESOURCE_REP)return y.PubResourceRep.decode(n.body);if(o==t.PRIVATE_TEXT_MSG)return y.TextMsg.decode(n.body);if(o==t.PUBLIC_TEXT_MSG)return y.TextMsg.decode(n.body);if(o==t.PRIVATE_DATA)return e=y.DATA.decode(n.body);if(o==t.PUBLIC_DATA)return e=y.DATA.decode(n.body);if(o==t.PRIVATE_DATA_TO_USER)return y.PrivateDataToUser.decode(n.body);if(o==t.ROOM_DATA_INFO)return y.RoomDataInfo.decode(n.body);if(o==t.UPDATE_USER_DATA_MSG)return y.UpdateUserDataMsg.decode(n.body);if(o!=t.USER_INFO_MSG)return o==t.USER_MSG?y.UserMsg.decode(n.body):o==t.USER_INDICTION?y.UserIndiction.decode(n.body):o==t.UPDATA_USER_ROLE_PRIVILEDGE_MSG?y.UpdateUserRolePriviledgeMsg.decode(n.body):o==t.ADD_WEBCAM_MSG?y.AddWebcamMsg.decode(n.body):o==t.ADD_SPEAKER_MSG?y.AddSpeakerMsg.decode(n.body):o==t.ADD_DESKTOP_MSG?y.AddDesktopMsg.decode(n.body):o==t.REMOVE_WEBCAM_MSG?y.RemoveWebcamMsg.decode(n.body):o==t.REMOVE_SPEAKER_MSG?y.RemoveSpeakerMsg.decode(n.body):o==t.UPDATE_SPEAKER_MSG?y.UpdateSpeakerMsg.decode(n.body):o==t.UPDATE_WEBCAM_MSG?y.UpdateWebcamMsg.decode(n.body):o==t.UPDATE_DESKTOP_MSG?y.UpdateDesktopMsg.decode(n.body):o==t.PUB_ROOM_RESOURCE_MSG?y.PubRoomResourceMsg.decode(n.body):o==t.PUB_ROOM_RESOURCE_MSG_REP?y.PubRoomResourceMsgRep.decode(n.body):o==t.UNPUB_ROOM_RESOURCE_MSG?y.UnpubRoomResourceMsg.decode(n.body):o==t.UNPUB_ROOM_RESOURCE_MSG_REP?y.UnpubRoomResourceMsgRep.decode(n.body):o==t.SUB_ROOM_RESOURCE_MSG_REP?y.SubRoomResourceMsgRep.decode(n.body):o==t.UNSUB_ROOM_RESOURCE_MSG_REP?y.UnsubRoomResourceMsgRep.decode(n.body):o==t.PUB_VIDEO_REQ||o==t.PUB_AUDIO_REQ?y.PubResourceReq.decode(n.body):o==t.PUB_VIDEO_REP||o==t.PUB_AUDIO_REP?y.PubResourceRep.decode(n.body):o==t.VIDEO_INDICTION?y.ResourceIndiction.decode(n.body):o==t.AUDIO_INDICTION?y.ResourceIndiction.decode(n.body):o==t.OFFER_REQ?y.OfferReq.decode(n.body):o==t.OFFER_REP?y.OfferRep.decode(n.body):o==t.CANDIDATE_MSG?y.CandidateMsg.decode(n.body):o==t.SUB_ROOM_RESOURCE_REQ?y.SubRoomResourceReq.decode(n.body):o==t.SUB_ROOM_RESOURCE_REP?y.SubRoomResourceRep.decode(n.body):o==t.SUB_ROOM_RESOURCE_MSG?y.SubRoomResourceMsg.decode(n.body):o==t.UNSUB_ROOM_RESOURCE_MSG?y.UnsubRoomResourceMsg.decode(n.body):o==t.CLOSE_ROOM_REP?y.CloseRoomRep.decode(n.body):o==t.CLOSE_ROOM_MSG?y.CloseRoomMsg.decode(n.body):o==t.UPDATE_USER_NAME?y.UpdateUserName.decode(n.body):o==t.START_VIDEO_DATA_MSG?y.StartVideoDataMsg.decode(n.body):o==t.STOP_VIDEO_DATA_MSG?y.StopVideoDataMsg.decode(n.body):o==t.MODIFY_RESOURCE_REQ?y.ModifyResourceReq.decode(n.body):o==t.MODIFY_RESOURCE_REP?y.ModifyResourceRep.decode(n.body):o==t.VIDEO_STREAM_CONTROL_REP?y.VideoStreamControlRep.decode(n.body):o==t.UPDATE_BOARD_MSG?y.UpdateBoardMsg.decode(n.body):o==t.UPDATE_BOARD_MSG_REP?y.UpdateBoardMsgRep.decode(n.body):o==t.BOARDS_INFO_PDU?y.BoardsInfoMsg.decode(n.body):o==t.UPDATE_ANNOTATION_MSG?y.UpdateAnnotationMsg.decode(n.body):o==t.BIND_AUDIO_TO_VIDEO_REP?y.BindAudioToVideoRep.decode(n.body):o==t.OUTGOING_CREATE_STREAMS_EXPORTER_REP?y.OutgoingCreateStreamsExporterRep.decode(n.body):o==t.OUTGOING_SELECT_STREAM_REP?y.OutgoingSelectStreamRep.decode(n.body):o==t.OUTGOING_MIX_STREAMS_REP?y.OutgoingMixStreamsRep.decode(n.body):o==t.OUTGOING_DESTROY_EXPORTER_REP?y.OutgoingDestroyExporterRep.decode(n.body):o==t.OUTGOING_PAUSE_RESUME_EXPORTER_REP?y.OutgoingPauseResumeExporterRep.decode(n.body):o==t.OUTGOING_EXPORTER_ERROR_NOTIFY?y.OutgoingExporterErrorNotify.decode(n.body):o==t.OUTGOING_INVITE_STATUS_NOTIFY?y.OutgoingInviteStatusNotify.decode(n.body):o==t.ROOM_ATTRIBUTE_CHANGE_NOTIFY?y.RoomAttributeChangeNotify.decode(n.body):o==t.ROOM_START_AVC_MIXER_MEDIA_REP?y.RoomAvcControlRep.decode(n.body):o==t.ROOM_SET_STREAM_NAME_RSP?y.RoomSetStreamNameRsp.decode(n.body):o==t.ROOM_STREAM_NAME_CHANGED_NOTIFY?y.RoomStreamNameChangedNotify.decode(n.body):o==t.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP?y.OutgoingExporterSetFocusVideoRsp.decode(n.body):o==t.OUTGOING_GET_EXPORTER_INFO_RSP?y.OutgoingGetExporterInfoRsp.decode(n.body):o==t.USER_STREAM_ACTIVE?y.UserStreamActive.decode(n.body):o==t.MEDIA_PLAY_EVENT_NOTIFY?y.MediaPlayEventNotify.decode(n.body):o==t.STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY?y.StreamKeepAliveTimeoutNotify.decode(n.body):void 0;var i=y.UserInfoMsg;return n.body?i.decode(n.body):null},e});var connectionQualityValues={98:"18px",81:"15px",64:"11px",47:"7px",30:"3px",0:"0px"},trackId2audioConnection={},trackId2videoConnection={},roomConnectionStats={bytesSentPrev:0,bytesReceivedPrev:0,packetsSentPrev:0,packetsReceivedPrev:0,timestampPrev:null},roomPacketsLostConnectionStats={uploadPacket:0,downloadPacket:0,uploadPacketsLost:0,downloadPacketsLost:0,timestampPrev:null},ssrc2deviceStats={},ssrc2devicePacketsLostStats={},connectionIndicator={roomHandle:null,room:{localAddress:"",localPort:0,localProtocol:"",remoteAddress:"",remotePort:0,remoteProtocol:"",uploadBitrate:0,downloadBitrate:0,uploadPacket:0,downloadPacket:0,uploadPacketLost:0,downloadPacketLost:0,uploadPacketLostRate:0,downloadPacketLostRate:0,currentRoundTripTime:0,totalRoundTripTime:0},getRoomConnection:function(){return connectionIndicator.room},getVideoConnection:function(e,t){var r=connectionIndicator.roomHandle.getUser(e);if(r){var n=r.getVideo(t);if(n&&n.track){var o=n.track.id;return trackId2videoConnection[o]}}},getAudioConnection:function(e){var t=connectionIndicator.roomHandle.getUser(e);if(t&&t.audio&&t.audio.track){var r=t.audio.track.id;return trackId2audioConnection[r]}},getScreenConnection:function(e){var t=connectionIndicator.roomHandle.getUser(e);if(t&&t.screen&&t.screen.track){var r=t.screen.track.id;return trackId2videoConnection[r]}}};function ConnectionInfoCollector(e,t){this.peerconnection=e,this.statsInterval=t,this.roomHandle=e.roomHandle,this.statsIntervalId=null,this.isRun=!1}function ConnectionInfoCollectorChrome(){}function ConnectionInfoCollectorFirefox(){}function ConnectionStatistics(e){this.peerconnection=e,this.getPeerStatusTimer=null,this.trace_id=connectionStatisticsConfig.trace_id?connectionStatisticsConfig.trace_id:"",this.samplingRate=connectionStatisticsConfig.sampling_rate?connectionStatisticsConfig.sampling_rate:3,this.logHttpServerAddr=connectionStatisticsConfig.http_server_addr,this.logHttpsServerAddr=connectionStatisticsConfig.https_server_addr,this.sendRate=1,this.app_id=connectionStatisticsConfig.app_id?connectionStatisticsConfig.app_id:"jh",this.user_agent=navigator.userAgent,this.client_type=1,this.ssrc2number={},this.report_mode=connectionStatisticsConfig.report_mode?connectionStatisticsConfig.report_mode:0,this.myDB={name:"rtcDB",version:1,db:null},this.url="";var t=document.location.protocol;"http:"==t?this.url=this.logHttpServerAddr:"https:"!=t&&"httpsionic:"!=t||(this.url=this.logHttpsServerAddr),this.sendVideoMap={bytesSent:"bytesSent",codecImplementationName:"codecImplementationName",framesEncoded:"framesEncoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsSent:"packetsSent",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googAdaptationChanges:"googAdaptationChanges",googAvgEncodeMs:"googAvgEncodeMs",googBandwidthLimitedResolution:"googBandwidthLimitedResolution",googCodecName:"googCodecName",googContentType:"googContentType",googCpuLimitedResolution:"googCpuLimitedResolution",googEncodeUsagePercent:"googEncodeUsagePercent",googFirsReceived:"googFirsReceived",googFrameHeightSent:"googFrameHeightSent",googFrameRateInput:"googFrameRateInput",googFrameRateSent:"googFrameRateSent",googFrameWidthSent:"googFrameWidthSent",googHasEnteredLowResolution:"googHasEnteredLowResolution",hugeFramesSent:"hugeFramesSent",googNacksReceived:"googNacksReceived",googPlisReceived:"googPlisReceived",googRtt:"googRtt",googTrackId:"googTrackId"},this.recvVideoMap={bytesReceived:"bytesReceived",codecImplementationName:"codecImplementationName",framesDecoded:"framesDecoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googCaptureStartNtpTimeMs:"googCaptureStartNtpTimeMs",googCodecName:"googCodecName",googContentType:"googContentType",googCurrentDelayMs:"googCurrentDelayMs",googDecodeMs:"googDecodeMs",googFirsSent:"googFirsSent",googFrameHeightReceived:"googFrameHeightReceived",googFrameRateDecoded:"googFrameRateDecoded",googFrameRateOutput:"googFrameRateOutput",googFrameRateReceived:"googFrameRateReceived",googFrameWidthReceived:"googFrameWidthReceived",googInterframeDelayMax:"googInterframeDelayMax",googJitterBufferMs:"googJitterBufferMs",googMaxDecodeMs:"googMaxDecodeMs",googMinPlayoutDelayMs:"googMinPlayoutDelayMs",googNacksSent:"googNacksSent",googPlisSent:"googPlisSent",googRenderDelayMs:"googRenderDelayMs",googTargetDelayMs:"googTargetDelayMs",googTrackId:"googTrackId"},this.sendAudioMap={audioInputLevel:"audioInputLevel",bytesSent:"bytesSent",mediaType:"mediaType",packetsSent:"packetsSent",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googCodecName:"googCodecName",googTrackId:"googTrackId",googTypingNoiseState:"googTypingNoiseState"},this.recvAudioMap={audioOutputLevel:"audioOutputLevel",bytesReceived:"bytesReceived",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googAccelerateRate:"googAccelerateRate",googCodecName:"googCodecName",googCurrentDelayMs:"googCurrentDelayMs",googDecodingCNG:"googDecodingCNG",googDecodingCTN:"googDecodingCTN",googDecodingCTSG:"googDecodingCTSG",googDecodingMuted:"googDecodingMuted",googDecodingNormal:"googDecodingNormal",googDecodingPLC:"googDecodingPLC",googDecodingPLCCNG:"googDecodingPLCCNG",googExpandRate:"googExpandRate",googJitterBufferMs:"googJitterBufferMs",googJitterReceived:"googJitterReceived",googPreemptiveExpandRate:"googPreemptiveExpandRate",googPreferredJitterBufferMs:"googPreferredJitterBufferMs",googSecondaryDecodedRate:"googSecondaryDecodedRate",googSecondaryDiscardedRate:"googSecondaryDiscardedRate",googSpeechExpandRate:"googSpeechExpandRate",googTrackId:"googTrackId"},this.candidateMap={googActiveConnection:"googActiveConnection",bytesReceived:"bytesReceived",bytesSent:"bytesSent",packetsSent:"packetSent",googReadable:"googReadable",requestsSent:"requestSent",consentRequestsSent:"consentRequestsSent",responsesSent:"responsesSent",requestsReceived:"requestsReceived",responsesReceived:"responsesReceived",googLocalAddress:"googLocalAddress",localCandidateId:"localCandidateId",googLocalCandidateType:"googLocalCandidateType",googRemoteAddress:"googRemoteAddress",remoteCandidateId:"remoteCandidateId",googRemoteCandidateType:"googRemoteCandidateType",googRtt:"googRtt",packetsDiscardedOnSend:"packetsDiscardedOnSend",googTransportType:"googTransportType",googWritable:"googWritable"}}function AudioLevel(e){this.roomHandle=e,this.audioLevelsIntervalId=null}ConnectionInfoCollector.prototype.start=function(e){var r=this;r.isRun?log.info("===ConnectionInfoCollector(),ConnectionInfoCollector is running,  ignore to start()."):(log.info("===ConnectionInfoCollector(),ConnectionInfoCollector.start()."),r.isRun=!0,e&&(r.statsInterval=e),r.statsIntervalId&&clearInterval(r.statsIntervalId),r.statsIntervalId=setInterval(function(){"closed"!=r.peerconnection.iceConnectionState&&r.peerconnection.getStats(null).then(function(e){var t;avdEngineHandle.isFirefox||(t=new ConnectionInfoCollectorChrome),avdEngineHandle.isFirefox&&(t=new ConnectionInfoCollectorFirefox),t.dumpStats(e,r.peerconnection.roomHandle)},r.errorCallback)},r.statsInterval))},ConnectionInfoCollector.prototype.errorCallback=function(e){log.error("===ConnectionInfoCollector(),getStats().errorCallback().error:",e),this.stop()},ConnectionInfoCollector.prototype.stop=function(){this.isRun=!1,this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},ConnectionInfoCollectorChrome.prototype.dumpStats=function(r,e){var n=this;connectionIndicator.roomHandle=e;for(var o=0,i=0,a=0,s=0,d=!1,t=0;t<r.length;t++){if("remote-outbound-rtp"===r[t].type){d=!0;break}}r.forEach(function(e){var t;(n.setRoomStats(r,e),n.setDeviceStat(r,e),"transport"===e.type&&(e.packetsSent&&(o=e.packetsSent),e.packetsReceived&&(i=e.packetsReceived)),avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<=85&&("outbound-rtp"===e.type&&(o+=e.packetsSent),"inbound-rtp"===e.type&&(i+=e.packetsReceived)),"remote-inbound-rtp"===e.type)&&((t=ssrc2deviceStats[e.ssrc])&&(a+=t.packetsLostPrev));d?"remote-outbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev):"inbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev)});var l=new Date;if(roomPacketsLostConnectionStats.timestampPrev){var u=o-roomPacketsLostConnectionStats.uploadPacket,c=i-roomPacketsLostConnectionStats.downloadPacket,p=a-roomPacketsLostConnectionStats.uploadPacketsLost,h=s-roomPacketsLostConnectionStats.downloadPacketsLost;u<0&&(u=0),p<0&&(p=0);var f=f=Math.round(p/u*1e4)/100;f<0&&(f=0),h<0&&(h=0),c<0&&(c=0);var m=m=Math.round(h/c*1e4)/100;m<0&&(m=0),avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<=85&&(connectionIndicator.room.uploadPacket=void 0!==u?u:"0",connectionIndicator.room.downloadPacket=void 0!==c?c:"0"),connectionIndicator.room.uploadPacketLost=p,connectionIndicator.room.downloadPacketLost=h,connectionIndicator.room.uploadPacketLostRate=f?f+"%":"0%",connectionIndicator.room.downloadPacketLostRate=m?m+"%":"0%",connectionIndicator.room.uploadPacketLossRate=connectionIndicator.room.uploadPacketLostRate,connectionIndicator.room.downloadPacketLossRate=connectionIndicator.room.downloadPacketLostRate,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.timestampPrev=l}else roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.timestampPrev=l,connectionIndicator.room.uploadPacketLost=0,connectionIndicator.room.downloadPacketLost=0,connectionIndicator.room.uploadPacketLostRate="0%",connectionIndicator.room.downloadPacketLostRate="0%";null!=e?e.eventEmitter.emit(RoomCallback.connection_indicator,connectionIndicator):this.stop()},ConnectionInfoCollectorChrome.prototype.setRoomStats=function(e,t){var r,n,o,i,a=t.timestamp;if("candidate-pair"===t.type)void 0!==t.currentRoundTripTime?connectionIndicator.room.currentRoundTripTime=t.currentRoundTripTime+"s":connectionIndicator.room.currentRoundTripTime="0s",void 0!==t.totalRoundTripTime?connectionIndicator.room.totalRoundTripTime=t.totalRoundTripTime+"s":connectionIndicator.room.totalRoundTripTime="0s";else if("transport"===t.type){var s=t.bytesSent,d=t.bytesReceived,l=t.packetsSent,u=t.packetsReceived;if(roomConnectionStats.timestampPrev&&(s&&(r=8*(s-roomConnectionStats.bytesSentPrev)/(a-roomConnectionStats.timestampPrev),r=Math.floor(r)),d&&(n=8*(d-roomConnectionStats.bytesReceivedPrev)/(a-roomConnectionStats.timestampPrev),n=Math.floor(n)),l&&(o=(l-roomConnectionStats.packetsSentPrev)/((a-roomConnectionStats.timestampPrev)/1e3),o=Math.floor(o)),u&&(i=(u-roomConnectionStats.packetsReceivedPrev)/((a-roomConnectionStats.timestampPrev)/1e3),i=Math.floor(i))),roomConnectionStats.bytesSentPrev=s,roomConnectionStats.bytesReceivedPrev=d,roomConnectionStats.packetsSentPrev=l,roomConnectionStats.packetsReceivedPrev=u,roomConnectionStats.timestampPrev=a,activeCandidatePair=e.get(t.selectedCandidatePairId),activeCandidatePair&&activeCandidatePair.localCandidateId){var c=e.get(activeCandidatePair.localCandidateId);c&&(c.address&&(connectionIndicator.room.localAddress=c.address),c.ip&&(connectionIndicator.room.localAddress=c.ip),c.ipAddress&&(connectionIndicator.room.localAddress=c.ipAddress),c.port&&(connectionIndicator.room.localPort=c.port),c.portNumber&&(connectionIndicator.room.localPort=c.portNumber),c.protocol&&(connectionIndicator.room.localProtocol=c.protocol))}if(activeCandidatePair&&activeCandidatePair.remoteCandidateId){var p=e.get(activeCandidatePair.remoteCandidateId);p&&(p.address&&(connectionIndicator.room.remoteAddress=p.address),p.ip&&(connectionIndicator.room.remoteAddress=p.ip),p.ipAddress&&(connectionIndicator.room.remoteAddress=p.ipAddress),p.port&&(connectionIndicator.room.remotePort=p.port),p.portNumber&&(connectionIndicator.room.remotePort=p.portNumber),p.port&&(connectionIndicator.room.remoteProtocol=p.protocol))}void 0!==r?r+="Kbps":r="--Kbps",connectionIndicator.room.uploadBitrate=r,void 0!==n?n+="Kbps":n="--Kbps",connectionIndicator.room.downloadBitrate=n,connectionIndicator.room.uploadPacket=void 0!==o?o:"0",connectionIndicator.room.downloadPacket=void 0!==i?i:"0"}},ConnectionInfoCollectorChrome.prototype.setDeviceStat=function(e,t){var r,n,o,i,a,s,d,l=t.timestamp;if("outbound-rtp"===t.type||"inbound-rtp"===t.type){var u,c,p=t.ssrc,h=t.qpSum,f=t.framesEncoded,m=t.framesDecoded,g=null,v=t.bytesSent,y=t.bytesReceived,_=t.packetsSent,b=t.packetsReceived,S=null,w=null;if("outbound-rtp"===t.type?(S=e.get(t.remoteId)?e.get(t.remoteId).packetsLost:0,e.get(t.remoteId)&&e.get(t.remoteId).fractionLost&&(w=e.get(t.remoteId).fractionLost)):"inbound-rtp"===t.type&&(w=(S=t.packetsLost)/(S+b)),(avdEngineHandle.isSafari||avdEngineHandle.isMicroMessenger)&&(_&&(_=Math.abs(_)),b&&(b=Math.abs(b))),avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<86)(U=e.get(t.trackId))&&("outbound-rtp"===t.type?u=U.framesSent:"inbound-rtp"===t.type&&(c=U.framesReceived));if(avdEngineHandle.isSafari||avdEngineHandle.isMicroMessenger)(U=e.get(t.trackId||t.id))&&("inbound-rtp"===t.type?c=U.framesReceived:"outbound-rtp"===t.type&&(c=U.framesSent));var E=ssrc2deviceStats[p];if(E&&E.timestampPrev){v&&(r=8*(v-E.bytesSentPrev)/(l-E.timestampPrev),r=Math.floor(r)),y&&(n=8*(y-E.bytesReceivedPrev)/(l-E.timestampPrev),n=Math.floor(n)),_&&(o=(_-E.packetsSentPrev)/((l-E.timestampPrev)/1e3),o=Math.floor(o)),b&&(i=(b-E.packetsReceivedPrev)/((l-E.timestampPrev)/1e3),i=Math.floor(i)),c&&c>E.framesReceivedPrev&&(d=(c-E.framesReceivedPrev)/((l-E.timestampPrev)/1e3),d=Math.floor(d)),u&&u>E.framesSentPrev&&(s=(u-E.framesSentPrev)/((l-E.timestampPrev)/1e3),s=Math.floor(s)),S&&(S>E.packetsLostPrev?(lostpPackets=(S-E.packetsLostPrev)/((l-E.timestampPrev)/1e3),lostpPackets=Math.round(lostpPackets)):lostpPackets=0),"outbound-rtp"===t.type?(e.get(t.remoteId)&&!e.get(t.remoteId).fractionLost&&("undefined"==typeof lostpPackets&&(lostpPackets=0),w=lostpPackets/o),a=w):"inbound-rtp"===t.type&&("undefined"==typeof lostpPackets&&(lostpPackets=0),a=lostpPackets/(lostpPackets+i));var I,T,C=0;h&&h>E.qpSumPrev&&(C=(h-E.qpSumPrev)/((l-E.timestampPrev)/1e3)),f&&f>E.framesEncodedPrev&&(I=(f-E.framesEncodedPrev)/((l-E.timestampPrev)/1e3)),m&&m>E.framesDecodedPrev&&(T=(m-E.framesDecodedPrev)/((l-E.timestampPrev)/1e3)),"outbound-rtp"===t.type?g=C/I:"inbound-rtp"===t.type&&(g=C/T)}var R="";if("outbound-rtp"===t.type){if(t.mediaSourceId)(P=e.get(t.mediaSourceId))&&P.trackIdentifier&&(R=P.trackIdentifier);""===R&&(R=t.trackId)}else if("inbound-rtp"===t.type){var P;if(void 0!==t.trackIdentifier)R=t.trackIdentifier;else R=(P=e.get(t.trackId)).trackIdentifier}var k,x,M,A={};if(A.trackId=R,A.ssrc=p,E)E.bytesSentPrev=v,E.bytesReceivedPrev=y,E.packetsSentPrev=_,E.packetsReceivedPrev=b,E.trackIdPrev=R,E.framesReceivedPrev=c,E.framesSentPrev=u,E.packetsLostPrev=S,E.qpSumPrev=h,E.framesEncodedPrev=f,E.framesDecodedPrev=m,E.timestampPrev=l;else{var O={};O.bytesSentPrev=v,O.bytesReceivedPrev=y,O.packetsSentPrev=_,O.trackIdPrev=R,O.framesReceivedPrev=c,O.framesSentPrev=u,O.packetsLostPrev=S,O.qpSumPrev=h,O.framesEncodedPrev=f,O.framesDecodedPrev=m,O.timestampPrev=l,ssrc2deviceStats[p]=O}if("outbound-rtp"===t.type){if(avdEngineHandle.isChrome&&86<=avdEngineHandle.majorVersion)k=t.frameWidth,x=t.frameHeight,M=t.framesPerSecond;else if(avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<86){(U=e.get(t.trackId))&&U.frameWidth&&(k=U.frameWidth),U&&U.frameHeight&&(x=U.frameHeight),s&&(M=s)}}else if("inbound-rtp"===t.type)if(avdEngineHandle.isChrome&&86<=avdEngineHandle.majorVersion)k=t.frameWidth,x=t.frameHeight,M=t.framesPerSecond;else if(avdEngineHandle.isChrome&&avdEngineHandle.majorVersion<86){var U;(U=e.get(t.trackId))&&U.frameWidth&&(k=U.frameWidth),U&&U.frameHeight&&(x=U.frameHeight),d&&(M=d)}if(avdEngineHandle.isSafari||avdEngineHandle.isMicroMessenger)(U=e.get(t.trackId||t.id))&&U.frameWidth&&(k=U.frameWidth),U&&U.frameHeight&&(x=U.frameHeight),d&&(M=d);A.qpSum=h||"--",A.framesEncoded=f||"--",A.framesDecoded=m||"--",A.perFrameQP=g?Math.round(100*g)/100:"--",k&&(A.resolution=k+"X"+x,A.resolutionWidth=k),x&&(A.resolutionHeight=x),A.frameRate=void 0!==M?M+"fps":"--fps",A.uploadBitrate=void 0!==r?r+"Kbps":"--Kbps",A.downloadBitrate=void 0!==n?n+"Kbps":"--Kbps",A.uploadPacket=void 0!==o?o:"0",A.downloadPacket=void 0!==i?i:"0";var D=e.get(t.codecId);if(D){var L=D.payloadType,H=D.mimeType,N=D.clockRate;A.payloadType=L,A.mimeType=H,A.clockRate=N}"undefined"!=typeof lostpPackets?A.packetsLost=lostpPackets:A.packetsLost="0",void 0!==a?"0"==A.packetsLost?A.packetLostRate="0%":A.packetLostRate=Math.round(1e4*a)/100+"%":A.packetLostRate="0%",(0<r||0<n)&&("video"===t.mediaType||"video"===t.kind?trackId2videoConnection[R]=A:"audio"!==t.mediaType&&"audio"!==t.kind||(trackId2audioConnection[R]=A))}},ConnectionInfoCollectorFirefox.prototype.dumpStats=function(r,e){var n=this;connectionIndicator.roomHandle=e;for(var o=0,i=0,a=0,s=0,d=!1,t=0;t<r.length;t++){if("remote-outbound-rtp"===r[t].type){d=!0;break}}r.forEach(function(e){var t;(n.setRoomStats(r,e),n.setDeviceStat(r,e),"outbound-rtp"===e.type&&(o+=e.packetsSent),"inbound-rtp"===e.type&&(i+=e.packetsReceived),"remote-inbound-rtp"===e.type)&&((t=ssrc2deviceStats[e.ssrc])&&(a+=t.packetsLostPrev));d?"remote-outbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev):"inbound-rtp"===e.type&&(t=ssrc2deviceStats[e.ssrc])&&(s+=t.packetsLostPrev)});var l=new Date;if(roomPacketsLostConnectionStats.timestampPrev){var u=o-roomPacketsLostConnectionStats.uploadPacket,c=i-roomPacketsLostConnectionStats.downloadPacket,p=a-roomPacketsLostConnectionStats.uploadPacketsLost,h=s-roomPacketsLostConnectionStats.downloadPacketsLost;u<0&&(u=0),p<0&&(p=0);var f=f=Math.round(p/u*1e4)/100;f<0&&(f=0),h<0&&(h=0),c<0&&(c=0);var m=m=Math.round(h/c*1e4)/100;m<0&&(m=0),connectionIndicator.room.uploadPacket=void 0!==u?u:"0",connectionIndicator.room.downloadPacket=void 0!==c?c:"0",connectionIndicator.room.uploadPacketLost=p,connectionIndicator.room.downloadPacketLost=h,connectionIndicator.room.uploadPacketLostRate=f?f+"%":"0%",connectionIndicator.room.downloadPacketLostRate=m?m+"%":"0%",connectionIndicator.room.uploadPacketLossRate=connectionIndicator.room.uploadPacketLostRate,connectionIndicator.room.downloadPacketLossRate=connectionIndicator.room.downloadPacketLostRate,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.timestampPrev=l}else roomPacketsLostConnectionStats.uploadPacket=o,roomPacketsLostConnectionStats.downloadPacket=i,roomPacketsLostConnectionStats.uploadPacketsLost=a,roomPacketsLostConnectionStats.downloadPacketsLost=s,roomPacketsLostConnectionStats.timestampPrev=l,connectionIndicator.room.uploadPacketLost=0,connectionIndicator.room.downloadPacketLost=0,connectionIndicator.room.uploadPacketLostRate="0%",connectionIndicator.room.downloadPacketLostRate="0%";null!=e?e.eventEmitter.emit(RoomCallback.connection_indicator,connectionIndicator):this.stop()},ConnectionInfoCollectorFirefox.prototype.setRoomStats=function(e,t){var r,n,o=t.timestamp;if(connectionIndicator.room.currentRoundTripTime="--s",connectionIndicator.room.totalRoundTripTime="--s","candidate-pair"===t.type&&t.nominated&&t.selected){var i=t.bytesSent,a=t.bytesReceived;roomConnectionStats.timestampPrev&&(i&&(r=8*(i-roomConnectionStats.bytesSentPrev)/(o-roomConnectionStats.timestampPrev),r=Math.floor(r)),a&&(n=8*(a-roomConnectionStats.bytesReceivedPrev)/(o-roomConnectionStats.timestampPrev),n=Math.floor(n))),roomConnectionStats.bytesSentPrev=i,roomConnectionStats.bytesReceivedPrev=a,roomConnectionStats.timestampPrev=o;var s=e.get(t.localCandidateId);s&&(s.address&&(connectionIndicator.room.localAddress=s.address),s.port&&(connectionIndicator.room.localPort=s.port),s.protocol&&(connectionIndicator.room.localProtocol=s.protocol));var d=e.get(t.remoteCandidateId);d&&(d.address&&(connectionIndicator.room.remoteAddress=d.address),d.port&&(connectionIndicator.room.remotePort=d.port),d.port&&(connectionIndicator.room.remoteProtocol=d.protocol)),void 0!==r?r+="Kbps":r="--Kbps",connectionIndicator.room.uploadBitrate=r,void 0!==n?n+="Kbps":n="--Kbps",connectionIndicator.room.downloadBitrate=n,connectionIndicator.room.uploadPacket="--",connectionIndicator.room.downloadPacket="--"}},ConnectionInfoCollectorFirefox.prototype.setDeviceStat=function(e,t){var r,n,o,i,a,s,d,l=t.timestamp;if("outbound-rtp"===t.type||"inbound-rtp"===t.type){var u,c,p=t.ssrc,h=t.qpSum,f=t.framesEncoded,m=t.framesDecoded,g=null,v=t.bytesSent,y=t.bytesReceived,_=t.packetsSent,b=t.packetsReceived,S=null,w=null;"outbound-rtp"===t.type?(S=e.get(t.remoteId)?e.get(t.remoteId).packetsLost:0,e.get(t.remoteId)&&e.get(t.remoteId).fractionLost&&(w=e.get(t.remoteId).fractionLost),u=t.framesSent):"inbound-rtp"===t.type&&(w=(S=t.packetsLost)/(S+b),c=t.framesReceived);var E=ssrc2deviceStats[p];if(E&&E.timestampPrev){v&&(r=8*(v-E.bytesSentPrev)/(l-E.timestampPrev),r=Math.floor(r)),y&&(n=8*(y-E.bytesReceivedPrev)/(l-E.timestampPrev),n=Math.floor(n)),_&&(o=(_-E.packetsSentPrev)/((l-E.timestampPrev)/1e3),o=Math.floor(o)),b&&(i=(b-E.packetsReceivedPrev)/((l-E.timestampPrev)/1e3),i=Math.floor(i)),c&&c>E.framesReceivedPrev&&(d=(c-E.framesReceivedPrev)/((l-E.timestampPrev)/1e3),d=Math.floor(d)),u&&u>E.framesSentPrev&&(s=(u-E.framesSentPrev)/((l-E.timestampPrev)/1e3),s=Math.floor(s)),S&&(S>E.packetsLostPrev?(lostpPackets=(S-E.packetsLostPrev)/((l-E.timestampPrev)/1e3),lostpPackets=Math.round(lostpPackets)):lostpPackets=0),"outbound-rtp"===t.type?(e.get(t.remoteId)&&!e.get(t.remoteId).fractionLost&&("undefined"==typeof lostpPackets&&(lostpPackets=0),w=lostpPackets/o),a=w):"inbound-rtp"===t.type&&("undefined"==typeof lostpPackets&&(lostpPackets=0),a=lostpPackets/(lostpPackets+i));var I,T,C=0;h&&h>E.qpSumPrev&&(C=(h-E.qpSumPrev)/((l-E.timestampPrev)/1e3)),f&&f>E.framesEncodedPrev&&(I=(f-E.framesEncodedPrev)/((l-E.timestampPrev)/1e3)),m&&m>E.framesDecodedPrev&&(T=(m-E.framesDecodedPrev)/((l-E.timestampPrev)/1e3)),"outbound-rtp"===t.type?g=C/I:"inbound-rtp"===t.type&&(g=C/T)}var R="";"outbound-rtp"===t.type||"inbound-rtp"===t.type&&(R=t.trackIdentifier);var P,k,x,M={};if(M.trackId=R,M.ssrc=p,E)E.bytesSentPrev=v,E.bytesReceivedPrev=y,E.packetsSentPrev=_,E.packetsReceivedPrev=b,E.trackIdPrev=R,E.framesReceivedPrev=c,E.framesSentPrev=u,E.packetsLostPrev=S,E.qpSumPrev=h,E.framesEncodedPrev=f,E.framesDecodedPrev=m,E.timestampPrev=l;else{var A={};A.bytesSentPrev=v,A.bytesReceivedPrev=y,A.packetsSentPrev=_,A.trackIdPrev=R,A.framesReceivedPrev=c,A.framesSentPrev=u,A.packetsLostPrev=S,A.qpSumPrev=h,A.framesEncodedPrev=f,A.framesDecodedPrev=m,A.timestampPrev=l,ssrc2deviceStats[p]=A}M.qpSum=h||"--",M.framesEncoded=f||"--",M.framesDecoded=m||"--",M.perFrameQP=g?Math.round(100*g)/100:"--","outbound-rtp"===t.type?(P=t.frameWidth,k=t.frameHeight,x=t.framesPerSecond):"inbound-rtp"===t.type&&(P=t.frameWidth,k=t.frameHeight,x=t.framesPerSecond),P&&(M.resolution=P+"X"+k,M.resolutionWidth=P),k&&(M.resolutionHeight=k),M.frameRate=void 0!==x?x+"fps":"--fps",M.uploadBitrate=void 0!==r?r+"Kbps":"--Kbps",M.downloadBitrate=void 0!==n?n+"Kbps":"--Kbps",M.uploadPacket=void 0!==o?o:"0",M.downloadPacket=void 0!==i?i:"0";var O=e.get(t.codecId);if(O){var U=O.payloadType,D=O.mimeType,L=O.clockRate;M.payloadType=U,M.mimeType=D,M.clockRate=L}"undefined"!=typeof lostpPackets?M.packetsLost=lostpPackets:M.packetsLost="0",void 0!==a?"0"==M.packetsLost?M.packetLostRate="0%":M.packetLostRate=Math.round(1e4*a)/100+"%":M.packetLostRate="0%",(0<r||0<n)&&("video"===t.kind?trackId2videoConnection[R]=M:"audio"===t.kind&&(trackId2audioConnection[R]=M))}},ConnectionStatistics.prototype.start2Log=function(n){var e=this;n=n||5;var o=0,i=0;clearInterval(e.getPeerStatusTimer),e.getPeerStatusTimer=setInterval(function(){e.getPeerStatus().then(function(e){e.forEach(function(e){switch(e.event_type){case connectionEventTypeEnum.sendVideo:log.info("stream sendVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthSent+"x"+e.googFrameHeightSent+" "+e.googFrameRateInput+" ] ");break;case connectionEventTypeEnum.recvVideo:log.info("stream recvVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthReceived+"x"+e.googFrameHeightReceived+" "+e.googFrameRateOutput+" ] ");break;case connectionEventTypeEnum.sendAudio:log.info("stream sendAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioInputLevel+" ] ");break;case connectionEventTypeEnum.recvAudio:log.info("stream recvAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioOutputLevel+" ] ");break;case connectionEventTypeEnum.conndidate:var t=parseInt((e.bytesSent-o)/n),r=parseInt((e.bytesReceived-i)/n);log.info("room ["+e.googTransportType+" "+e.googLocalAddress+" -> "+e.googRemoteAddress+" ] [ "+t+","+r+" ] "),o=parseInt(e.bytesSent),i=parseInt(e.bytesReceived)}})})},1e3*n)},ConnectionStatistics.prototype.start=function(){var t=this;if(log.debug("===ConnectionStatistics.start(),url:"+t.url),t.url){var r=1,n=[];t.openDB(),clearInterval(t.getPeerStatusTimer),t.getPeerStatusTimer=setInterval(function(){t.getPeerStatus().then(function(e){n=n.concat(e),r==t.sendRate&&(t.sendData(n),n=[],r=0),r++})},1e3*t.samplingRate)}},ConnectionStatistics.prototype.stop=function(){clearInterval(this.getPeerStatusTimer)},ConnectionStatistics.prototype.sendData=function(e){var t={data:{trace_id:this.trace_id,app_id:this.app_id,user_id:room.selfUser.id,user_name:room.selfUser.name,room_id:room.id,user_agent:this.user_agent,client_type:this.client_type,data_infos:e}};0==parseInt(this.report_mode)?this.fetchPost(this.url,t).then(function(e){}).catch(function(e){}):this.addData(t)},ConnectionStatistics.prototype.getPeerStatus=function(){var t=when.defer(),n=this,o=[];return n.peerconnection.getStats(function(e){e.result().forEach(function(e){var t={};if(t.timestamp=Date.parse(e.timestamp),"ssrc"==e.type){if(n.ssrc2number[e.stat("ssrc")]?n.ssrc2number[e.stat("ssrc")]++:n.ssrc2number[e.stat("ssrc")]=1,t.seq_num=n.ssrc2number[e.stat("ssrc")],room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],n.sendVideoMap)t[r]=e.stat(r);o.push(t)}else if(room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],n.recvVideoMap)t[r]=e.stat(r);o.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,n.sendAudioMap)t[r]=e.stat(r);o.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,n.recvAudioMap)t[r]=e.stat(r);o.push(t)}}else if("googCandidatePair"==e.type&&"true"==e.stat("googActiveConnection")){for(var r in t.event_type=connectionEventTypeEnum.conndidate,n.candidateMap)t[r]=e.stat(r);o.push(t)}}),t.resolve(o)}),t.promise},ConnectionStatistics.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t,{headers:{"Content-Type":"application/json"}}).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};n(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);n(t)}else{t=new Error(1e4,e.message);n(t)}n(e)})})},ConnectionStatistics.prototype.openDB=function(){var t=this,r=r||1,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){log.error("===ConnectionStatistics.openDB(), error:"+e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,log.debug("===ConnectionStatistics.openDB(),本地数据库打开成功")},e.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("body_content"))t.createObjectStore("body_content",{autoIncrement:!0});log.debug("===ConnectionStatistics.openDB(),DB version changed to:"+r)}},ConnectionStatistics.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},ConnectionStatistics.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},ConnectionStatistics.prototype.fetchStoreByCursor=function(){var r=this;r.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){var t=e.target.result;t&&(r.deleteDataByKey(t.key),t.continue(),r.fetchPost(r.url,t.value).then(function(e){}).catch(function(e){}))}},ConnectionStatistics.prototype.sendDBData=function(){this.fetchStoreByCursor()},AudioLevel.prototype.start=function(r){var e=when.defer(),t=this;return clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=setInterval(function(){t.roomHandle&&t.roomHandle.getParticipants().forEach(function(e){if(e&&e.audio){if(e.audio.track&&!e.audio.isMonitorAudioLevel){e.audio.isMonitorAudioLevel=!0;var t=new MediaStream;t.addTrack(e.audio.track),monitorAudioLevelBySteam(t,e.audio,r)}e.audio.track&&!e.audio.track.enabled&&(e.audio.audioLevel=0),e.audio.track||(e.audio.setAudioLevel(0),e.audio.isMonitorAudioLevel=!1,e.audio.monitorAudioLevelIntervalId&&(clearInterval(e.audio.monitorAudioLevelIntervalId),e.audio.monitorAudioLevelIntervalId=null))}}),e.resolve()},300),e.promise},AudioLevel.prototype.stop=function(){var e=when.defer();return this.audioLevelsIntervalId?(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null,this.roomHandle&&this.roomHandle.getParticipants().forEach(function(e){e&&e.audio&&(e.audio.setAudioLevel(0),e.audio.isMonitorAudioLevel=!1,e.audio.monitorAudioLevelIntervalId&&(clearInterval(e.audio.monitorAudioLevelIntervalId),e.audio.monitorAudioLevelIntervalId=null))}),e.resolve()):e.reject(),e.promise};var WEBAUDIO_ANALYZER_FFT_SIZE=2048,WEBAUDIO_ANALYZER_SMOOTING_TIME=.8;window.AudioContext=window.AudioContext||window.webkitAudioContext;var context=null;function timeDomainDataToAudioLevel(e){for(var t=0,r=e.length,n=0;n<r;n++)t<e[n]&&(t=e[n]);return parseFloat(((t-127)/128).toFixed(3))}function animateLevel(e,t){var r=0,n=t-e;return r=.2<n?t-.2:n<-.4?t+.4:e,parseFloat(r.toFixed(3))}function LocalStatsCollector(e,t,r){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=r}function monitorAudioLevelBySteam(e,r,t){var n,o=0;if(window.AudioContext&&!context&&(context=new AudioContext).suspend(),context){context.resume();var i=context.createAnalyser();i.smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,i.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(e).connect(i);r.monitorAudioLevelIntervalId=setInterval(function(){var e=new Uint8Array(i.frequencyBinCount);i.getByteTimeDomainData(e);var t=timeDomainDataToAudioLevel(e);t!=o&&(o=animateLevel(t,o),1===(n=audioLevelFullRange(8e4*o))&&(n=0),r.audioLevel=n)},t)}}function LoggerReport(){this.httpServerAddr="",this.httpsServerAddr="",this.reportMode=0,this.traceId="",this.appId="jh",this.reportLogLevel=1,this.userAgent=navigator.userAgent,this.clientType=1,this.reportUrl="",this.openLogger=!1,this.myDB={name:"rtcDB_logger",version:1,db:null},this.myDBOnsuccess=!1,this.sendDataCache=[],LoggerReport.prototype.start=function(){console.log("===LoggerReport.start()"),this.httpServerAddr=loggerReportConfig.http_server_addr,this.httpsServerAddr=loggerReportConfig.https_server_addr,this.reportMode=loggerReportConfig.report_mode?loggerReportConfig.report_mode:0,this.traceId=loggerReportConfig.trace_id?loggerReportConfig.trace_id:"",this.appId=loggerReportConfig.app_id?loggerReportConfig.app_id:"jh",this.reportLogLevel=loggerReportConfig.log_level?loggerReportConfig.log_level:1,this.reportUrl=this.httpServerAddr,"https:"==protocolStr&&(this.reportUrl=this.httpsServerAddr),this.openDB(),this.openLogger=!0},LoggerReport.prototype.stop=function(){console.log("===LoggerReport.stop()"),this.openLogger=!1},LoggerReport.prototype.debug=function(e){this.baseLevel(e,1)},LoggerReport.prototype.info=function(e){this.baseLevel(e,2)},LoggerReport.prototype.error=function(e){this.baseLevel(e,3)},LoggerReport.prototype.baseLevel=function(e,t){if(this.openLogger&&t>=this.reportLogLevel){var r=[],n={},o=new Date;if(n.timestamp=o.getTime(),n.log_content=e,n.log_level=t,r.push(n),room&&room.selfUser&&room.selfUser.id&&this.myDBOnsuccess){for(;0<this.sendDataCache.length;){var i=this.sendDataCache.pop();this.sendData(i)}this.sendData(r)}else this.sendDataCache.unshift(r)}},LoggerReport.prototype.sendData=function(e){var t="";room&&room.selfUser&&room.selfUser.id&&(t=room.selfUser.id);var r="";room&&room.selfUser&&room.selfUser.name&&(r=room.selfUser.name);var n="";room&&room.id&&(n=room.id);var o={data:{app_id:this.appId,user_id:t,user_name:r,room_id:n,user_agent:this.userAgent,client_type:this.clientType,trace_id:this.traceId,log_infos:e}};0==parseInt(this.reportMode)?this.fetchPost(this.reportUrl,o).then(function(e){}).catch(function(e){}):this.addData(o)},LoggerReport.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t,{headers:{"Content-Type":"application/json"}}).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};n(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);n(t)}else{t=new Error(1e4,e.message);n(t)}n(e)})})},LoggerReport.prototype.openDB=function(){console.log("===LoggerReport.openDB()");var t=this,r=r||1,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){console.log(e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,console.log("本地数据库打开成功"),t.myDBOnsuccess=!0},e.onupgradeneeded=function(e){var t=e.target.result;if(!arrayUtil.contains(t.objectStoreNames,"body_content"))t.createObjectStore("body_content",{autoIncrement:!0});console.log("DB version changed to "+r)}},LoggerReport.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},LoggerReport.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},LoggerReport.prototype.fetchStoreByCursor=function(){var r=this;r.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){var t=e.target.result;t&&(r.deleteDataByKey(t.key),t.continue(),r.fetchPost(r.reportUrl,t.value).then(function(e){}).catch(function(e){}))}},LoggerReport.prototype.sendDBData=function(){this.fetchStoreByCursor()}}LocalStatsCollector.prototype.start=function(){if(window.AudioContext&&!context&&(context=new AudioContext).suspend(),context){context.resume();var n=context.createAnalyser();n.smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,n.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(this.stream).connect(n);var o=this;this.intervalId=setInterval(function(){var e=new Uint8Array(n.frequencyBinCount);n.getByteTimeDomainData(e);var t=timeDomainDataToAudioLevel(e);if(t!=o.audioLevel){o.audioLevel=animateLevel(t,o.audioLevel);var r=audioLevelFullRange(8e4*o.audioLevel);1===r&&(r=0),o.callback(r)}},this.intervalMilis)}},LocalStatsCollector.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},audioLevelFullRange=function(e){var t=parseInt(e/1e3);0==t&&250<e&&(t=1);var r=[0,1,2,3,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,9,9,9,9,9,9,9,9][t];return r||(r=0),r},function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,t){var r,n,o=a,i=[];if(t=t||o.length,e)for(r=0;r<e;r++)i[r]=o[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="",i[14]="4",r=0;r<36;r++)i[r]||(n=0|16*Math.random(),i[r]=o[19==r?3&n|8:n]);return i.join("")},Math.uuidFast=function(){for(var e,t=a,r=new Array(36),n=0,o=0;o<36;o++)8==o||13==o||18==o||23==o?r[o]="-":14==o?r[o]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),e=15&n,n>>=4,r[o]=t[19==o?3&e|8:e]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}(),ModuleBase.define("BrowserInfo",[],function(e){return(e=function(){}).prototype.getBrowserInfo=function(){navigator.appVersion;var e,t,r=navigator.userAgent,n=navigator.appName,o=""+parseFloat(navigator.appVersion),i="",a="";-1!=(p=r.indexOf("OPR/"))?(n="Opera",o=r.substring(p+4)):-1!==(p=r.indexOf("Opera"))?(n="Opera",o=r.substring(p+6),-1!==(p=r.indexOf("Version"))&&(o=r.substring(p+8))):-1!==(p=r.indexOf("MSIE"))?(n="IE",o=r.substring(p+5)):-1!==(p=r.indexOf("FingerBrowser"))?(n="FingerBrowser",o=r.substring(p+14)):-1!==(p=r.indexOf("MicroMessenger"))?(n="MicroMessenger",o=r.substring(p+15,p+20)):-1!==(p=r.indexOf("Chrome"))?(n="Chrome",o=r.substring(p+7)):-1!==(p=r.indexOf("Safari"))?(n="Safari",o=r.substring(p+7),-1!==(p=r.indexOf("Version"))&&(o=r.substring(p+8))):-1!==(p=r.indexOf("UCBrowser"))?(n="UCBrowser",o=r.substring(p+10)):-1!==(p=r.indexOf("baiduboxapp"))?(n="Baiduboxapp",o=r.substring(p+12)):-1!==(p=r.indexOf("Firefox"))?(n="Firefox",o=r.substring(p+8)):-1!==(p=r.indexOf("HeyTapBrowser"))?(n="HeyTapBrowser",o=r.substring(p+8)):(e=r.lastIndexOf(" ")+1)<(p=r.lastIndexOf("/"))&&(n=r.substring(e,p),o=r.substring(p+1),n.toLowerCase()===n.toUpperCase()&&(n=navigator.appName));var s=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob);/rv:([^\)]+)\) like Gecko/.test(navigator.userAgent)&&(n="IE",o=RegExp.$1);var d=/QQBrowser/.test(navigator.userAgent),l=function(e,t){var r=window.external||{};for(var n in r)if(e.test(t?r[n]:n))return!0;return!1}(/^liebao/i,0),u=/3Tee/.test(navigator.userAgent),c=/web_record/.test(navigator.userAgent);if(s){n="Edge";var p=r.indexOf("Edge");a=r.substring(p+5)}if(d){i="QQ";p=r.indexOf("QQBrowser");a=r.substring(p+10)}if(l&&(i="Liebao",a=""),u){i="avdrtc";p=r.indexOf("3Tee");a=r.substring(p+5)}return-1!==(t=o.indexOf(";"))&&(o=o.substring(0,t)),-1!==(t=o.indexOf(" "))&&(o=o.substring(0,t)),{name:n,fullVersion:o,shellName:i,shellFullVersion:a,isCustomized:u,isWebRecord:c}},e}),ModuleBase.define("OSInfo",[],function(e){return(e=function(){}).prototype.getOSInfo=function(){var e="Unknown OS",t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()},getOsName:function(){var e="Unknown OS";return t.Android()&&(e="Android"),t.BlackBerry()&&(e="BlackBerry"),t.iOS()&&(e="iOS"),t.Opera()&&(e="Opera Mini"),t.Windows()&&(e="Windows"),e}};return t.any()?e=t.getOsName():(-1!==navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!==navigator.appVersion.indexOf("Mac")&&(e="OSX"),-1!==navigator.appVersion.indexOf("X11")&&(e="UNIX"),-1!==navigator.appVersion.indexOf("Linux")&&(e="Linux")),e},e}),ModuleBase.define("CheckGetUserMedia",[],function(e){return(e=function(){}).prototype.getUserMediaSupport=function(){var e=!1;return void 0!==navigator.webkitGetUserMedia||void 0!==navigator.mozGetUserMedia?e=!0:navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(e=!0),e},e}),ModuleBase.define("CheckRTCPeerConnection",[],function(e){return(e=function(){}).prototype.RTCPeerConnectionSupport=function(){var e=!1;try{e=["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].some(function(e){return e in window})}catch(e){}return e},e}),ModuleBase.define("CheckDataChannel",[],function(e){return(e=function(){}).prototype.dataChannelSupport=function(){var e=!1;try{var t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(t){var r=new t(null);e="createDataChannel"in r,r.close()}}catch(e){}return e},e}),ModuleBase.define("BrowserDetect",["BrowserInfo","OSInfo","CheckGetUserMedia","CheckRTCPeerConnection","CheckDataChannel"],function(a,s,d,l,u){var e=function(){this.detect={};location.protocol;var e=new a;this.detect.browser=e.getBrowserInfo(),this.detect.browser["is"+this.detect.browser.name]=!0;this.detect.browser.fullVersion.split(".")[0];var t=new s;if(this.detect.osName=t.getOSInfo(),navigator.userAgent){var r=UAParser(navigator.userAgent);r&&r.os&&(this.detect.osName=r.os.name,this.detect.osVersion=r.os.version)}var n=new d;this.detect.getUserMediaSupport=n.getUserMediaSupport();var o=new l;this.detect.RTCPeerConnectionSupport=o.RTCPeerConnectionSupport();var i=new u;this.detect.dataChannelSupport=i.dataChannelSupport(),this.detect.WebSocketSupport="WebSocket"in window&&2===window.WebSocket.CLOSING,this.detect.screenSharingSupport=!1,navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&(this.detect.screenSharingSupport=!0),this.detect.ORTCSupport="undefined"!=typeof RTCIceGatherer,this.detect.isChrome=this.detect.browser.isChrome,this.detect.isOpera=this.detect.browser.isOpera,this.detect.isIE=this.detect.browser.isIE,this.detect.isFirefox=this.detect.browser.isFirefox,this.detect.isSafari=this.detect.browser.isSafari,this.detect.isMicroMessenger=this.detect.browser.isMicroMessenger,this.detect.isUCBrowser=this.detect.browser.isUCBrowser,this.detect.isBaiduboxapp=this.detect.browser.isBaiduboxapp,this.detect.isFingerBrowser=this.detect.browser.isFingerBrowser,this.detect.isWebRecord=this.detect.browser.isWebRecord,this.detect.gpuInfo=getGPUInfo(),this.detect.getEnumerateDevicesSupport=function(){return new Promise(function(e,t){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(){e(!0)}).catch(function(){e(!1)}):e(!1)})}};return e.prototype.checkBrowserSupport=function(){var e=this.detect.browser.isChrome,t=this.detect.browser.isOpera,r=(this.detect.browser.isIE,this.detect.browser.isFirefox),n=this.detect.browser.isSafari,o=this.detect.browser.isMicroMessenger,i=this.detect.browser.isUCBrowser,a=this.detect.browser.isBaiduboxapp,s=this.detect.browser.isFingerBrowser,d=this.detect.browser.fullVersion,l=d.split(".")[0],u=e&&73<=Number(l)||t&&30<=Number(l);("Android"==this.detect.osName&&(u=e&&73<=Number(l)),r&&86<=Number(l)&&(u=!0),n)&&(0<=versionStringCompare(d,"12.1.1")&&(u=!0));return o&&7<=Number(l)&&(u=!0),i&&(u=!1),a&&5<=Number(l)&&(u=!0),s&&3<=Number(l)&&(u=!0),"iOS"==this.detect.osName&&"Mobile"==this.detect.browser.name&&(u=!0),"iOS"==this.detect.osName&&e&&(console.log("===iphone手机端Chrome浏览器不支持"),u=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("Alitephone")&&(console.log("===android手机端的360极速浏览器Alitephone Browser不支持"),u=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("LieBaoFast")&&(console.log("===android手机端的猎豹浏览器LieBaoFast不支持"),u=!1),"Android"!=this.detect.osName&&"iOS"!=this.detect.osName||-1===navigator.userAgent.indexOf("Mb2345Browser")||(console.log("===手机端2345浏览器不支持"),u=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("HeyTapBrowser")&&(console.log("===oppo手机自带浏览器HeyTapBrowser,虽然内核是Chrome,但本地vidoe控件显示黑屏，固给出SDK不支持的提示"),u=!1),!!(u&&this.detect.getUserMediaSupport&&this.detect.RTCPeerConnectionSupport&&this.detect.WebSocketSupport)},e.prototype.checkBrowserPluginSupport=function(){var e=!1,t=(this.detect.browser.isChrome,this.detect.browser.isOpera,this.detect.browser.isIE),r=(this.detect.browser.isFirefox,this.detect.browser.isSafari,this.detect.browser.isMicroMessenger,this.detect.browser.isUCBrowser,this.detect.browser.isBaiduboxapp,this.detect.browser.isFingerBrowser,this.detect.browser.fullVersion.split(".")[0]);return 1==t&&10<=Number(r)&&(e=!0),e},e.prototype.checkChromeSupportH264=function(){var e=!1,t=this.detect.browser.isChrome,r=(this.detect.browser.name,this.detect.browser.fullVersion.split(".")[0]);return 1==(1==t&&52<=Number(r))&&(e=!0),e},e.prototype.isChrome=function(){},e}),ModuleBase.define("Base",[],function(){var e=function(e,t){this.id=e,this.name=t,this.status=StreamStatus.init,this.element=null,this.resourceInfo=null,this.ownerId=null,this.track=null,this.mid=null,this.RTCRtpSender=null,this.ssrcStr=null,this.publishKeepAliveTime=null};return e.prototype.setPublishKeepAliveTime=function(e){e&&(this.publishKeepAliveTime=e,log.debug("===Base.setPublishKeepAliveTime(),id:"+this.id+",keepAliveTime:"+e))},e.prototype.getNewStreamByTrack=function(){var e=null;return this.track&&(e=new MediaStream).addTrack(this.track),e},e}),ModuleBase.define("Video",["Base","Error"],function(n,l){var u,d,a,e=function(e,t,r){n.call(this,e,t),this.roomHandle=r,this.level,this.description,this.resolutionSelect,this.resolution={width:avdEngineHandle.defaultVideoParamsWidth,height:avdEngineHandle.defaultVideoParamsHeight},this.setType=avdEngineHandle.defaultVideoParamsResolutionSetType,this.frameRate=avdEngineHandle.defaultVideoParamsFrameRate,this.aspectRatio=0,this.cameraType,this.maxBandwidth=null,this.clientSetMaxBandwidth=null,this.streamName,this.streamNickName,this.isPubState=!1,this.rtcRtpSenderIntervalId=null,this.spatialLayerActiveList=[],this.spatialLayerActiveDoing=!1,this.currentVideoQuality=null,this.changePublishVideoQualityInterval=null};(e.prototype=new n).setLevel=function(e){log.debug("===video.setLevel(),videoId:"+this.id+",level:"+e),this.level=e},e.prototype.setDescription=function(e){log.debug("===video.setDescription(),videoId:"+this.id+",description:"+e),this.description=e,this.saveVideoCustomConfig("description",e)},e.prototype.setStreamName=function(e){log.debug("===video.setStreamName(),videoId:"+this.id+",streamName:"+e),this.streamName=e},e.prototype.setStreamNickName=function(e){log.debug("===video.setStreamNickName(),videoId:"+this.id+",streamNickName:"+e),this.streamNickName=e},e.prototype.setResolution=function(e,t){log.debug("===video.setResolution(),videoId:"+this.id+",resolution:"+e+",resolutionSetType:"+t),this.resolutionSelect=e,this.resolution=Resolution[e],t&&(this.setType=t)},e.prototype.setResolutionWH=function(e,t,r,n){log.debug("===video.setResolutionWH(),videoId:"+this.id+",width:"+e+",height:"+t+",resolutionSetType:"+r),this.resolutionSelect=e;var o={order:1};o.width=e,o.height=t,n||(this.resolution=o,this.saveVideoCustomConfig("width",e),this.saveVideoCustomConfig("height",t),null!=r&&(this.setType=r,this.saveVideoCustomConfig("setType",r)))},e.prototype.setFrameRate=function(e){log.debug("===video.setFrameRate(),videoId:"+this.id+",frameRate:"+e),"string"==typeof e&&(e=Number(e)),this.frameRate=e,this.saveVideoCustomConfig("frameRate",e)},e.prototype.setAspectRatio=function(e){log.debug("===video.setAspectRatio(),videoId:"+this.id+",aspectRatio:"+e),"string"==typeof e&&(e=Number(e)),this.aspectRatio=e,this.saveVideoCustomConfig("aspectRatio",e)},e.prototype.applyConstraints=function(){if(this.track){var e=getApplyConstraints(this);this.track.applyConstraints(e)}},e.prototype.applyConstraintsWH=function(e,t,r){if(this.track){var n=r==ResolutionSetType.ideal?ResolutionSetType.ideal:ResolutionSetType.exact;this.setResolutionWH(e,t,n);var o=getApplyConstraints(this);this.track.applyConstraints(o);var i=this.maxBandwidth;this.clientSetMaxBandwidth&&(i=this.clientSetMaxBandwidth),this.sendVideoStreamControl(i,this.resolution.width,this.resolution.height)}},e.prototype.setBandwidth=function(t){log.debug("===video.setBandwidth(),maxBandwidth:"+t+"Kpbs, videoId:"+this.id+", userId:"+this.ownerId);var r=this;if("RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var e=r.RTCRtpSender;if(e){var n=e.getParameters();if(n.encodings?n.encodings==[]&&(n.encodings[0]={}):n.encodings=[{}],t&&0!=t){var o;if(!avdEngineHandle.isFirefox)1==(o=n.encodings.length)?n.encodings[0].maxBitrate=1e3*t:2==o?(n.encodings[0].maxBitrate=500*t,n.encodings[1].maxBitrate=1e3*t):3==o&&(n.encodings[0].maxBitrate=250*t,n.encodings[1].maxBitrate=500*t,n.encodings[2].maxBitrate=1e3*t);if(avdEngineHandle.isFirefox)1==(o=n.encodings.length)?n.encodings[0].maxBitrate=1e3*t:2==o?(n.encodings[0].maxBitrate=1e3*t,n.encodings[1].maxBitrate=500*t):3==o&&(n.encodings[0].maxBitrate=1e3*t,n.encodings[1].maxBitrate=500*t,n.encodings[2].maxBitrate=250*t)}else for(var i=0;i<n.encodings.length;i++)delete n.encodings[i].maxBitrate;e.setParameters(n).then(function(){r.clientSetMaxBandwidth=t,log.info("===video.setBandwidth(),带宽设置成功,clientSetMaxBandwidth:"+t+"Kpbs, videoId:"+r.id+", userId:"+r.ownerId),r.sendVideoStreamControl(t,r.resolution.width,r.resolution.height)}).catch(function(e){log.error("===video.setBandwidth(),带宽设置失败,clientSetMaxBandwidth:"+t+"Kpbs, videoId:"+r.id+", userId:"+r.ownerId+",error:",e)})}else r.clientSetMaxBandwidth=t,log.debug("===video.setBandwidth(),RTCRtpSender is null,clientSetMaxBandwidth:"+t+"Kpbs, videoId:"+r.id+", userId:"+r.ownerId)}},e.prototype.sendVideoStreamControl=function(r,n,o){log.info("===video.sendVideoStreamControl(),maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", videoId:"+this.id+", nodeId:"+this.roomHandle.selfUser.nodeId);var i=when.defer(),a=this,s=getRandomNum(5e4,51e3),d=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.sendVideoStreamControl(d,r,n,o,s),clearTimeout(u),u=setTimeout(function(){log.error("===video.sendVideoStreamControl(),带宽设置发送服务器端超时. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(new l(ErrorConstant.operate_timeout.code,"VIDEO_STREAM_CONTROL_REQ"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_success,function(e){e==s&&(clearTimeout(u),log.info("===video.sendVideoStreamControl(), 带宽设置发送服务器端成功. maxBandwidth:"+r+"Kpbs,width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.resolve())}),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_error,function(e,t){t==s&&(clearTimeout(u),log.error("===video.sendVideoStreamControl(),带宽设置发送服务器端失败. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(e))})},e.prototype.preview=function(t){log.info("===video.preview()");var r=when.defer(),n=this;return n.track?(n.status!=StreamStatus.published&&(n.status=StreamStatus.opened),(n.element=t).srcObject=n.getNewStreamByTrack(),r.resolve()):obtainUserMedia(null,n).then(function(e){n.track=e.videoStream.getVideoTracks()[0],null==n.roomHandle.selfUser.stream?n.roomHandle.selfUser.stream=e.videoStream:n.roomHandle.selfUser.stream.addTrack(n.track),n.status=StreamStatus.opened,(n.element=t).srcObject=n.getNewStreamByTrack(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.unpreview=function(){log.info("===video.unpreview()");this.element&&(this.element.srcObject=null,this.element=null),this.status=StreamStatus.init},e.prototype.publish=function(e){log.info("===video.publish()");var t=when.defer(),r=this;if(r.roomHandle.roomJoinState!=RoomStateEnum.CONNECTED){var n=new l(ErrorConstant.room_state_invalid);log.debug("===video publish() 发布视频流异常, room state: ",r.roomHandle.roomJoinState),t.reject(n)}return r.isPubState?(log.debug("===video publish(),isPubState =true to return"),t.resolve()):(r.isPubState=!0,this.publishHandle(null,e).then(function(){log.info("===video publish(),发布视频流成功,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId),avdEngineHandle.loggerReport.info("video publish(),发布视频流成功,Id:"+r.id+"，设备名称："+r.name+",ownerId:"+r.ownerId),t.resolve()}).otherwise(function(e){r.isPubState=!1,log.error("===video publish(),发布视频流异常,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId+",Error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("video publish(),The published video stream is abnormal , Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId+",Error:"+JSON.stringify(e)),t.reject(e)})),t.promise},e.prototype.previewAndPublish=function(e,t){log.info("===video.previewAndPublish()");var r=when.defer(),n=this;if(n.roomHandle.roomJoinState==RoomStateEnum.CONNECTED)return avdEngineHandle.loggerReport.debug("previewAndPublish()触发..."),n.isPubState?(log.debug("===video previewAndPublish(),isPubState =true to return"),r.resolve()):(n.isPubState=!0,this.publishHandle(e,t).then(function(){log.info("===video previewAndPublish(),预览摄像头及发布流成功,videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId),avdEngineHandle.loggerReport.info("video previewAndPublish(),预览摄像头及发布流成功,videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId),r.resolve()}).otherwise(function(e){n.isPubState=!1,log.error("===video previewAndPublish(),预览摄像头及发布视频流异常,videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("video previewAndPublish(), Previewing cameras and publishing video streams are abnormal, videoId:"+n.id+",videoName："+n.name+",userId:"+n.ownerId+",error:"+JSON.stringify(e)),r.reject(e)})),r.promise;var o=ErrorConstant.room_state_invalid;o.message+="（State: "+n.roomHandle.roomJoinState+"）";var i=new l(o);return log.debug("===video publish() 发布视频流异常, room state: "+n.roomHandle.roomJoinState),void r.reject(i)},e.prototype.publishHandle=function(n,e){var o=when.defer(),i=getRandomNum(1e4,11e3),a=this,t=a.roomHandle.calInitVideoBitrate(a.resolution.width,a.resolution.height);if(a.maxBandwidth=t.maxBit,a.status==StreamStatus.init)if(a.track){var r=a.roomHandle.setDeviceIdByUUID(0,a.id),s=a.getNewStreamByTrack();a.roomHandle.masterServer.videoPublishHandle(r,s,i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.init,track!=null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),null!=n&&(a.status=StreamStatus.opened,(a.element=n).srcObject=s),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),log.info("===video previewAndPublish(),callback camera_status_notify,self.track != null, status:"+a.status+",videoId:"+a.id+",videoName："+a.name+",userId:"+a.ownerId),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})}else obtainUserMedia(null,a).then(function(e){a.track=e.videoStream.getVideoTracks()[0],null==a.roomHandle.selfUser.stream?a.roomHandle.selfUser.stream=e.videoStream:a.roomHandle.selfUser.stream.addTrack(a.track),a.status=StreamStatus.opened;var t=a.getNewStreamByTrack(),r=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.videoPublishHandle(r,t,i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.init,track==null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),null!=n&&(a.status=StreamStatus.opened,(a.element=n).srcObject=t),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),log.info("===video previewAndPublish(),callback camera_status_notify,self.track= null, status:"+a.status+",videoId:"+a.id+",videoName："+a.name+",userId:"+a.ownerId),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})}).otherwise(function(e){o.reject(e)});else if(a.status==StreamStatus.opened)if(a.track){r=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.videoPublishHandle(r,a.getNewStreamByTrack(),i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,track!=null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})}else obtainUserMedia(null,a).then(function(e){a.track=e.videoStream.getVideoTracks()[0],null==a.roomHandle.selfUser.stream?a.roomHandle.selfUser.stream=e.videoStream:a.roomHandle.selfUser.stream.addTrack(a.track);var t=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.videoPublishHandle(t,a.getNewStreamByTrack(),i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,track==null),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),a.status=StreamStatus.published,a.roomHandle.hasObject(a.roomHandle.pubVideos,a)||a.roomHandle.pubVideos.push(a),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(d),o.reject(e))})}).otherwise(function(e){o.reject(e)});else if(a.status==StreamStatus.published&&e){log.debug("===TTTTTTTTT00000000000000");r=a.roomHandle.setDeviceIdByUUID(0,a.id);a.roomHandle.masterServer.videoPublishHandle(r,a.getNewStreamByTrack(),i),clearTimeout(d),d=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,&& room rejoin or reconnecting),pub_roomresourcemsg_rep timeout"),o.reject(new l(ErrorConstant.operate_timeout.code,"Publish video"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(d),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id),o.resolve())}),a.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(log.debug("===video publishHandle(status == StreamStatus.opened,&& && room rejoin or reconnecting),pub_roomresourcemsg_rep_error"),clearTimeout(d),o.reject(e))})}else log.debug("===video publishHandle() status: "+a.status);return o.promise},e.prototype.unpublish=function(){log.info("===video.unpublish()");var n=when.defer(),o=getRandomNum(11001,12e3),i=this;if(i.maxBandwidth=null,this.status==StreamStatus.published||this.status==StreamStatus.init&&(this.track||null!=this.track)){i.isPubState=!1,arrayUtil.objectSplice(i.roomHandle.pubVideos,this.id),this.status=StreamStatus.init;var e=i.roomHandle.setDeviceIdByUUID(0,this.id);i.roomHandle.masterServer.videoUnpublishHandle(e,this.getNewStreamByTrack(),o),clearTimeout(a),a=setTimeout(function(){i.isPubState=!1,log.debug("===video unpublish, unpub_roomresourcemsg_rep timeout"),n.reject(new l(ErrorConstant.operate_timeout.code,"Unpublish video"+ErrorConstant.operate_timeout.message))},3e3),i.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){if(e==o){clearTimeout(a);var t=i.roomHandle.selfUser.stream;if(t&&t.getTracks().forEach(function(e){e.id==i.track.id&&e.stop()}),i.element){var r=i.element.srcObject;r&&r.getTracks().forEach(function(e){e.stop()}),i.element.srcObject=null,i.element=null}i.track.stop(),i.track=null,i.roomHandle.currBandwidth=null,log.info("===video unpublish(),取消发布视频流成功,videoId:"+i.id+",videoName："+i.name+",userId:"+i.ownerId),avdEngineHandle.loggerReport.info("video unpublish(),取消发布视频流成功,videoId:"+i.id+",videoName："+i.name+",userId:"+i.ownerId),i.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,i.status,i.id,i.name,i.roomHandle.selfUser.id),setTimeout(function(){n.resolve()},50)}}),i.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==o&&(clearTimeout(a),log.error("===video unpublish, unpub_roomresourcemsg_rep_error,videoId:"+i.id+",videoName："+i.name+",userId:"+i.ownerId),n.reject(e))})}return n.promise};var i,o;return e.prototype.subscrible=function(t){log.info("===video subscrible(),订阅视频流,videoId:"+this.id+",userId:"+this.ownerId+",videoQuality:"+t),avdEngineHandle.loggerReport.info("video subscrible(),订阅视频流,videoId:"+this.id+",userId:"+this.ownerId+",videoQuality:"+t);var r=when.defer(),n=getRandomNum(12001,13e3),o=this;return t?o.roomHandle.masterServer.videoSubscribleHandle(o.resourceInfo,t,n):o.roomHandle.masterServer.videoSubscribleHandle(o.resourceInfo,VideoQualityType.high,n),clearTimeout(i),i=setTimeout(function(){log.debug("===video subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Subscribe video"+ErrorConstant.operate_timeout.message))},3e3),o.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(i),setTimeout(function(){log.info("===video subscrible(),订阅视频流成功,videoId:"+o.id+",userId:"+o.ownerId+",videoQuality:"+t),r.resolve()},50))}),o.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(i),r.reject(e))}),r.promise},e.prototype.unsubscrible=function(){log.info("===video unsubscrible(),取消订阅视频流,videoId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("video unsubscrible(),取消订阅视频流,videoId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(13001,14e3),t=this;return t.roomHandle.masterServer.videoUnsubscribleHandle(t.resourceInfo,n),clearTimeout(o),o=setTimeout(function(){log.debug("===video unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Unsubscribe video"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),setTimeout(function(){log.info("===video unsubscrible(),取消订阅视频流成功,videoId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))}),r.promise},e.prototype.muteCamera=function(){log.info("===video.muteCamera()");var t=this;if(this.status==StreamStatus.published){if(this.status=StreamStatus.muted,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)})}t.track&&(t.track.enabled=!1);var r=t.roomHandle.setDeviceIdByUUID(0,this.id);t.roomHandle.masterServer.updateWebcamMsg(t.roomHandle.selfUser.nodeId,r,this),log.info("===video muteCamera(),禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("video muteCamera(),禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.unmuteCamera=function(){log.info("===video.unmuteCamera()");var t=this;if(this.status==StreamStatus.muted){if(this.status=StreamStatus.published,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)})}t.track&&(t.track.enabled=!0);var r=t.roomHandle.setDeviceIdByUUID(0,this.id);t.roomHandle.masterServer.updateWebcamMsg(t.roomHandle.selfUser.nodeId,r,this),log.info("===videe unmuteCamera(),取消禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("video unmuteCamera(),取消禁视频. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},Audio.prototype.ismuteCamera=function(){var e=!1;return this.status==StreamStatus.muted&&(e=!0),e},e.prototype.changeSubscribedVideoQuality=function(e){this.roomHandle.selfUser.id==this.ownerId?log.debug("===video changeSubscribedVideoQuality(),自己发布的视频不能更改。id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e):(log.debug("===video changeSubscribedVideoQuality(),更改订阅视频的视频质量,id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e),avdEngineHandle.loggerReport.debug("video changeSubscribedVideoQuality(),更改订阅视频的视频质量,id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e),this.roomHandle.masterServer.changeSubscribedVideoQuality(this.resourceInfo,this.quality2Level(e)))},e.prototype.changePublishVideoQuality=function(e){log.info("===video.changePublishVideoQuality(),videoId:"+this.id+",userId:"+this.ownerId+",level:"+e);var t=this;t.currentVideoQuality=e,t.changePublishVideoQualityInterval&&(clearInterval(t.changePublishVideoQualityInterval),t.changePublishVideoQualityInterval=null),t.changePublishVideoQualityInterval=setInterval(function(){t.currentVideoQuality&&t.roomHandle&&(t.changePublishVideoQualityHandle(t.currentVideoQuality),t.currentVideoQuality=null,clearInterval(t.changePublishVideoQualityInterval),t.changePublishVideoQualityInterval=null)},1e3)},e.prototype.changePublishVideoQualityHandle=function(t){var r=this,e=this.level2Quality(t);log.debug("===video.changePublishVideoQualityHandle(),userName:"+r.roomHandle.selfUser.name+",videoId:"+this.id+",level:"+t+",resolution.width:"+this.resolution.width+",resolution.height:"+this.resolution.height);var n=null;if(n=this.clientSetMaxBandwidth?this.clientSetMaxBandwidth:this.maxBandwidth){var o=0;if(e==VideoQualityType.high?o=n:e==VideoQualityType.normal?o=parseInt(n/2):e==VideoQualityType.low&&(o=parseInt(n/4)),"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var i=this.RTCRtpSender;if(i){var a=i.getParameters();a.encodings?a.encodings==[]&&(a.encodings[0]={}):a.encodings=[{}],n&&0!=n?a.encodings[0]&&(a.encodings[0].maxBitrate=1e3*o):a.encodings[0]&&delete a.encodings[0].maxBitrate,i.setParameters(a).then(function(){log.info("===video.changePublishVideoQualityHandle(),userName:"+r.roomHandle.selfUser.name+",videoId:"+r.id+",level:"+t+",带宽修改成功,maxBandwidth:"+o)}).catch(function(e){log.error("===video.changePublishVideoQualityHandle(),userName:"+r.roomHandle.selfUser.name+",videoId:"+r.id+",level:"+t+",带宽修改失败,maxBandwidth:"+o+",error:",e)})}}}var s=avdEngineHandle.browserDetect.detect?avdEngineHandle.browserDetect.detect:avdEngineHandle.getBrowserDetect();if("iOS"==s.osName&&versionStringCompare(s.browser.fullVersion,"17")<0)log.debug("===video.changePublishVideoQualityHandle(), current os: "+s.osName+" "+s.osVersion+" to ignore");else{var d={width:r.resolution.width,height:r.resolution.height};e==VideoQualityType.high?(d.width=r.resolution.width,d.height=r.resolution.height):e==VideoQualityType.normal?320<=r.resolution.width/2||180<=r.resolution.height/2?(d.width=r.resolution.width/2,d.height=r.resolution.height/2):(d.width=320,d.height=180):e==VideoQualityType.low&&(320<=r.resolution.width/4||180<=r.resolution.height/4?(d.width=r.resolution.width/4,d.height=r.resolution.height/4):(d.width=320,d.height=180)),r.adjustVideoResoutionRealTime(d.width,d.height),log.debug("===video.changePublishVideoQualityHandle(),userName:"+r.roomHandle.selfUser.name+",videoId:"+r.id+",level:"+t+",修改视频分辨率, 分辨率宽:"+d.width+"，分辨率高："+d.height)}},e.prototype.quality2Level=function(e){var t=3;return e==VideoQualityType.high?t=4:e==VideoQualityType.normal?t=3:e==VideoQualityType.low&&(t=2),t},e.prototype.level2Quality=function(e){VideoQualityType.normal;return 4<=e?VideoQualityType.high:3==e?VideoQualityType.normal:VideoQualityType.low},e.prototype.updateCameraData=function(e,t){log.debug("===video.updateCameraData(),level:"+e+",description:"+t),this.level=e,this.description=t;var r=this.roomHandle.setDeviceIdByUUID(0,this.id);this.roomHandle&&this.roomHandle.selfUser&&(this.saveVideoCustomConfig("description",t),this.roomHandle.masterServer.updateWebcamMsg(this.roomHandle.selfUser.nodeId,r,this))},e.prototype.updateExporterStreamName=function(e,t){var r=when.defer();return this.streamName=e,this.streamNickName=t,this.roomHandle.masterServer.updateExporterStreamName(this).then(function(){r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.setMaxSpatialLayer=function(r){if(avdEngineHandle.simulcastEnabled){if(this.RTCRtpSender){var e=this.RTCRtpSender.getParameters();e.encodings.forEach(function(e,t){log.debug("===video.setMaxSpatialLayer(),spatialLayer:"+r+",idx:"+t),e.active=t<r}),this.RTCRtpSender.setParameters(e)}}else log.debug("===video.setMaxSpatialLayer()，设置无效因为simulcastEnabled=false")},e.prototype.setSpatialLayerActive=function(e,t,r){if(avdEngineHandle.isChrome&&73<=avdEngineHandle.majorVersion&&avdEngineHandle.majorVersion<=76)log.debug("===video.setSpatialLayerActive(),chrome版本为73-76，支持多流但不支持服务器下发的各路流active/unactive设置");else{var i=this;if(log.debug("===video.setSpatialLayerActive(),baseActive:"+e+",ass1Active:"+t+",ass2Active:"+r),avdEngineHandle.simulcastEnabled){var n={};n.baseActive=e,n.ass1Active=t,n.ass2Active=r,i.spatialLayerActiveList.push(n),setTimeout(function(){if(!i.spatialLayerActiveDoing){i.spatialLayerActiveDoing=!0;var r=0,n=0,o=0;i.spatialLayerActiveList.forEach(function(e){0!=e.baseActive&&(r=e.baseActive),0!=e.ass1Active&&(n=e.ass1Active),0!=e.ass2Active&&(o=e.ass2Active)}),log.debug("===video.setSpatialLayerActive(),baseActiveNew:"+r+",ass1ActiveNew:"+n+",ass2ActiveNew:"+o),i.RTCRtpSender&&(log.debug("===video.setSpatialLayerActive(),RTCRtpSender != null"),i.rtcRtpSenderIntervalId=setInterval(function(){var e=i.RTCRtpSender.getParameters();0<e.encodings.length&&(log.debug("===video.setSpatialLayerActive(),parameters.encodings:",JSON.stringify(e.encodings)),clearInterval(i.rtcRtpSenderIntervalId),i.rtcRtpSenderIntervalId=null,e.encodings.forEach(function(e,t){0==t&&(2==r?(log.debug("===video.setSpatialLayerActive(),baseActive active to true"),e.active=!0):1==r&&(log.debug("===video.setSpatialLayerActive(),baseActive  active to false"),e.active=!1)),1==t&&(2==n?(log.debug("===video.setSpatialLayerActive(),ass1Active active to true"),e.active=!0):1==n&&(log.debug("===video.setSpatialLayerActive(),ass1Active active to false"),e.active=!1)),2==t&&(2==o?(log.debug("===video.setSpatialLayerActive(),ass2Active active to true"),e.active=!0):1==o&&(log.debug("===video.setSpatialLayerActive(),ass2Active active to false"),e.active=!1))}),i.RTCRtpSender.setParameters(e),i.spatialLayerActiveDoing=!1)},200))}},1e3)}else log.debug("===video.setSpatialLayerActive()，设置无效因为simulcastEnabled=false")}},e.prototype.attachVideoElementMediaStream=function(e,t){null!=t&&(this.element=e),e&&(e.srcObject=t)},e.prototype.saveVideoCustomConfig=function(e,t){this.roomHandle&&this.roomHandle.selfUser&&(this.roomHandle.selfUser.reJoinVideoId2CustomSet[this.id]||(this.roomHandle.selfUser.reJoinVideoId2CustomSet[this.id]={}),this.roomHandle.selfUser.reJoinVideoId2CustomSet[this.id][e]=t)},e.prototype.adjustVideoResoutionRealTime=function(e,t){if(!isNaN(e)&&!isNaN(t)){log.debug("===video.adjustVideoResoutionRealTime, width: "+e," ,height: "+t);if(this.track){var r={width:{ideal:parseInt(e)},height:{ideal:parseInt(t)},frameRate:{ideal:this.frameRate},aspectRatio:{ideal:this.aspectRatio}};this.track.applyConstraints(r)}}},e}),ModuleBase.define("Audio",["Base","Error"],function(n,d){var l,a,o,i,e=function(e,t,r){n.call(this,e,t),this.roomHandle=r,this.audioLevel=0,this.isPubState=!1,this.isMonitorAudioLevel=!1,this.monitorAudioLevelIntervalId=null};return(e.prototype=new n).openMicrophone=function(n){log.info("===audio.openMicrophone()");var o=when.defer(),i=this;if(i.roomHandle.roomJoinState!=RoomStateEnum.CONNECTED){var e=ErrorConstant.room_state_invalid;e.message+="（State: "+i.roomHandle.roomJoinState+"）";var t=new d(e);return log.debug("===audio.openMicrophone() 发布视频流异常, room state: "+i.roomHandle.roomJoinState),void o.reject(t)}var a=getRandomNum(2e4,21e3);if(i.track){var r=i.roomHandle.setDeviceIdByUUID(2,i.id),s=i.getNewStreamByTrack();if(i.isPubState){if(i.status==StreamStatus.published)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true && self.status == StreamStatus.published to return"),o.resolve(),o.promise;if(i.status==StreamStatus.muted)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true && self.status == StreamStatus.muted to audio.unmuteMicrophone()"),i.unmuteMicrophone(),o.resolve(),o.promise}if(i.isPubState)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true  to return"),o.resolve(),o.promise;i.isPubState=!0,i.roomHandle.masterServer.audioPublishHandle(r,s,a),clearTimeout(l),l=setTimeout(function(){i.isPubState=!1,log.debug("===audio openMicrophone(self.track!=null),pub_roomresourcemsg_rep timeout"),o.reject(new d(ErrorConstant.operate_timeout.code,"Release audio"+ErrorConstant.operate_timeout.message))},3e3),i.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==a&&(clearTimeout(l),i.state=StreamStatus.opened,void 0!==n&&n&&""!=n&&((i.element=n).srcObject=s),i.status=StreamStatus.published,i.roomHandle.hasObject(i.roomHandle.pubAudios,i)||i.roomHandle.pubAudios.push(i),log.info("===audio openMicrophone(),打开音频及发布流成功,callback microphone_status_notify  (self.track!=null),status:"+i.status+",audioId:"+i.id+",userId:"+i.ownerId),avdEngineHandle.loggerReport.info("audio openMicrophone(),打开音频及发布流成功,(self.track!=null),audioId:"+i.id+",userId:"+i.ownerId),i.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,i.roomHandle.selfUser.id),o.resolve())}),i.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==a&&(clearTimeout(l),i.isPubState=!1,log.error("===audio openMicrophone(),打开音频及发布流失败,(self.track!=null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("audio openMicrophone(),Failed to open audio and publish stream,(self.track!=null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),o.reject(e))})}else obtainUserMedia(i,null).then(function(e){i.track=e.audioStream.getAudioTracks()[0],null==i.roomHandle.selfUser.stream?i.roomHandle.selfUser.stream=e.audioStream:i.roomHandle.selfUser.stream.addTrack(i.track),i.state=StreamStatus.opened;var t=i.roomHandle.setDeviceIdByUUID(2,i.id),r=i.getNewStreamByTrack();if(i.isPubState)return log.debug("===audio openMicrophone(self.track=null),isPubState =true  to return"),o.resolve(),o.promise;i.isPubState=!0,i.roomHandle.masterServer.audioPublishHandle(t,r,a),clearTimeout(l),l=setTimeout(function(){i.isPubState=!1,log.debug("===audio openMicrophone(self.track==null),pub_roomresourcemsg_rep timeout"),o.reject(new d(ErrorConstant.operate_timeout.code,"Release audio "+ErrorConstant.operate_timeout.message))},3e3),i.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==a&&(clearTimeout(l),void 0!==n&&n&&""!=n&&((i.element=n).srcObject=r),i.status=StreamStatus.published,i.roomHandle.hasObject(i.roomHandle.pubAudios,i)||i.roomHandle.pubAudios.push(i),log.info("===audio openMicrophone(),打开音频及发布流成功,callback microphone_status_notify (self.track==null),status:"+i.status+",audioId:"+i.id+",userId:"+i.ownerId),avdEngineHandle.loggerReport.info("audio openMicrophone(),打开音频及发布流成功,(self.track==null),audioId:"+i.id+",userId:"+i.ownerId),i.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,i.roomHandle.selfUser.id),o.resolve())}),i.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==a&&(clearTimeout(l),i.isPubState=!1,log.error("===audio openMicrophone(),打开音频及发布流失败,(self.track==null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("audio openMicrophone(),Failed to open audio and publish stream,(self.track==null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),o.reject(e))})}).otherwise(function(e){o.reject(e)});return o.promise},e.prototype.closeMicrophone=function(){log.info("===audio.closeMicrophone()");var n=when.defer(),o=this,i=getRandomNum(21001,22e3);if(o.status==StreamStatus.published||o.status==StreamStatus.muted){o.isPubState=!1,arrayUtil.objectSplice(o.roomHandle.pubAudios,this.id),o.status=StreamStatus.init,o.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,o.status,o.id,o.name,o.roomHandle.selfUser.id);var e=o.roomHandle.setDeviceIdByUUID(2,o.id),t=o.getNewStreamByTrack();o.roomHandle.masterServer.audioUnpublishHandle(e,t,i),clearTimeout(a),a=setTimeout(function(){o.isPubState=!1,log.debug("===audio closeMicrophone,unpub_roomresourcemsg_rep timeout"),n.reject(new d(ErrorConstant.operate_timeout.code,"Unpublish audio"+ErrorConstant.operate_timeout.message))},3e3),o.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){if(e==i){clearTimeout(a),o.setAudioLevel(0);var t=o.roomHandle.selfUser.stream;if(t&&t.getTracks().forEach(function(e){e.id==o.track.id&&e.stop()}),o.element){var r=o.element.srcObject;r&&r.getTracks().forEach(function(e){e.stop()}),o.element.srcObject=null,o.element=null}o.track.stop(),o.track=null,avdEngineHandle.safariInitAudioStream=null,log.info("===audio closeMicrophone(),关闭音频及取消发布流. audioId:"+o.id+",userId:"+o.ownerId),avdEngineHandle.loggerReport.info("audio closeMicrophone(),关闭音频及取消发布流操作. audioId:"+o.id+",userId:"+o.ownerId),setTimeout(function(){n.resolve()},50)}}),o.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(a),o.isPubState=!1,log.error("===audio closeMicrophone(),关闭音频及发布流失败. audioId:"+o.id+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),avdEngineHandle.loggerReport.error("audio closeMicrophone(),Failed to close the audio and publish stream. audioId:"+o.id+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),n.reject(e))})}return n.promise},e.prototype.subscrible=function(){log.info("===audio subscrible(),订阅音频流操作, audioId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("audio subscrible(),订阅音频流操作, audioId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(22001,23e3),t=this;return t.roomHandle.masterServer.audioSubscribleHandle(t.resourceInfo,n),clearTimeout(o),o=setTimeout(function(){log.debug("===audio subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new d(ErrorConstant.operate_timeout.code,"Subscribe to audio"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),setTimeout(function(){log.info("===audio subscrible(),订阅音频流成功,audioId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))}),r.promise},e.prototype.unsubscrible=function(){log.info("===audio unsubscrible(),取消订阅音频流操作，audioId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("audio unsubscrible(),取消订阅音频流操作，audioId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(23001,24e3),t=this;return t.roomHandle.masterServer.audioUnsubscribleHandle(this.resourceInfo,n),clearTimeout(i),i=setTimeout(function(){log.debug("===audio unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new d(ErrorConstant.operate_timeout.code,"Unsubscribe Audio"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(i),setTimeout(function(){log.info("===audio unsubscrible(),取消订阅音频流成功,audioId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(i),r.reject(e))}),r.promise},e.prototype.muteMicrophone=function(){log.info("===audio.muteMicrophone()");var t=this;if(this.status==StreamStatus.published){if(this.status=StreamStatus.muted,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)})}t.track&&(t.track.enabled=!1);var r=t.roomHandle.traceablePeerConnection.getToMCUPeerConnection().getSenders();if(r)for(var n=0;n<r.length;n++){var o=r[n];o&&o.track&&"audio"==o.track.kind&&o.track.id==t.track.id&&(o.track.enabled=!1)}var i=t.roomHandle.setDeviceIdByUUID(2,this.id);t.roomHandle.masterServer.updateSpeakerMsg(t.roomHandle.selfUser.nodeId,i,this),log.info("===audio muteMicrophone(),禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("audio muteMicrophone(),禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.unmuteMicrophone=function(){log.info("===audio.unmuteMicrophone()");var t=this;if(this.status==StreamStatus.muted){if(this.status=StreamStatus.published,t.roomHandle.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,t.roomHandle.selfUser.id),t.roomHandle.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)})}t.track&&(t.track.enabled=!0);var r=t.roomHandle.traceablePeerConnection.getToMCUPeerConnection().getSenders();if(r)for(var n=0;n<r.length;n++){var o=r[n];o&&o.track&&"audio"==o.track.kind&&o.track.id==t.track.id&&(o.track.enabled=!0)}var i=t.roomHandle.setDeviceIdByUUID(2,this.id);t.roomHandle.masterServer.updateSpeakerMsg(t.roomHandle.selfUser.nodeId,i,this),log.info("===audio unmuteMicrophone(),取消禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),avdEngineHandle.loggerReport.info("audio unmuteMicrophone(),取消禁音. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.ismuteMicrophone=function(){var e=!1;return this.status==StreamStatus.muted&&(e=!0),e},e.prototype.setAudioLevel=function(e){this.audioLevel=e},e.prototype.getAudioLevel=function(){return this.audioLevel},e}),ModuleBase.define("Screen",["Base","Error","ScreenAudio"],function(n,l,e){var o,i,a,u,s,t=function(e,t,r){n.call(this,e,t),this.roomHandle=r,this.level,this.description,this.resolution={width:avdEngineHandle.defaultScreenParamsWidth,height:avdEngineHandle.defaultScreenParamsHeight},this.frameRate=avdEngineHandle.defaultScreenParamsFrameRate,this.maxBandwidth=null,this.clientSetMaxBandwidth=null,this.extensionFlag,this.ipc=null,this.screenAudio=null,this.screenAudioEnabled=!1};return(t.prototype=new n).setLevel=function(e){this.level=e},t.prototype.setDescription=function(e){this.description=e},t.prototype.setResolution=function(e,t){var r={};r.width=e,r.height=t,this.resolution=r},t.prototype.setFrameRate=function(e){this.frameRate=e},t.prototype.preview=function(e){log.info("===screen.preview()");e&&(this.element=e,this.element.srcObject=this.getNewStreamByTrack())},t.prototype.getDisplayMedia=function(){log.info("===screen.getDisplayMedia()");var n=when.defer(),o=this;if(o.status==StreamStatus.published)n.resolve();else if(navigator.mediaDevices.getDisplayMedia){var e={};avdEngineHandle.isChrome&&(e.video={displaySurface:"",frameRate:o.frameRate,width:{ideal:o.resolution.width},height:{ideal:o.resolution.height}},e.audio=!0,96<=avdEngineHandle.majorVersion&&(e.video.displaySurface="monitor")),log.debug("===screen.getDisplayMedia(),displayMediaConstrains:"+JSON.stringify(e)),navigator.mediaDevices.getDisplayMedia(e).then(function(e){if(e){o.track=e.getVideoTracks()[0];var t=!1;if(e&&null!=e.getAudioTracks){var r=e.getAudioTracks()[0];r&&o.screenAudio&&(o.screenAudio.track=r,t=!0)}n.resolve({stream:e,audioEnable:t})}}).catch(function(e){log.error("===screen.publish(),Unable to acquire screen capture",e.name+",ownerId:"+o.ownerId);var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_overconstrainedError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_notAllowedError):new r(ErrorConstant.navigatorDisplayMediaError_unknown),n.reject(t)})}else log.debug("===screen.getDisplayMedia(),不支持 navigator.mediaDevices.getDisplayMedia."),avdEngineHandle.loggerReport.error("===screen.getDisplayMedia(),nonsupport navigator.mediaDevices.getDisplayMedia.");return n.promise},t.prototype.publish=function(e){log.info("===screen.publish()...");var t=when.defer(),r=this;if(r.roomHandle.roomJoinState==RoomStateEnum.CONNECTED)return r.status==StreamStatus.published?t.resolve():e?r.publishInner(e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}):r.getDisplayMedia().then(function(e){r.publishInner(e.stream).then(function(){e.audioEnable?r.screenAudio.publish().then(function(){t.resolve()}):t.resolve()}).otherwise(function(e){t.reject(e)})}).otherwise(function(e){t.reject(e)}),t.promise;var n=ErrorConstant.room_state_invalid;n.message+="（State: "+r.roomHandle.roomJoinState+"）";var o=new l(n);return log.debug("===video publish() 发布视频流异常, room state: "+r.roomHandle.roomJoinState),void t.reject(o)},t.prototype.publishInner=function(e){log.info("===screen.publishInner()");var t=when.defer(),r=this;if(this.status==StreamStatus.published)t.resolve();else{var n=e.getTracks()[0];void 0!==n.onended?n.addEventListener("ended",function(){log.debug("===screen track.ended,ownerId:"+r.ownerId),r.unpublish().then(function(){log.info("===screen.unpublish() success."),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),r.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1):void 0!==n.oninactive?n.addEventListener("inactive",function(){log.debug("===screen track.inactive,ownerId:"+r.ownerId),r.unpublish().then(function(){log.info("===screen.unpublish() success."),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),r.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1):void 0!==e.onended?e.addEventListener("ended",function(e){log.debug("===screen stream.ended,ownerId:"+r.ownerId),r.unpublish().then(function(){log.info("===screen.unpublish() success."),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),r.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1):void 0!==e.oninactive&&e.addEventListener("inactive",function(e){log.debug("===screen stream.inactive,ownerId:"+r.ownerId),r.unpublish().then(function(){log.info("===screen.unpublish() success."),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),r.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}).otherwise(function(e){log.error("===screen.unpublish() error, code:"+e.code+", message:"+e.message)})},!1),r.publishHandleInner(r,e,"").then(function(){t.resolve()}).otherwise(function(e){t.reject(e)})}return t.promise},t.prototype.electronPublish=function(e,t,r,n){log.info("===screen.electronPublish()");var o=when.defer();return this.ipc=e,this.ipc.setMaxListeners(50),e&&this.registerElectronIPCInner(n),avdEngineHandle.electronManager.getDesktopSources(t,r).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},t.prototype.electronPrimaryDisplayPublish=function(e){var t=when.defer(),r=this,n=avdEngineHandle.electronManager.getPrimaryDisplay();log.debug("===electronPrimaryDisplayPublish(),primaryDisplay:",n);var o="screen:"+n.id;return"win32"==require("os").platform()&&(o="screen:0:0"),log.debug("===electronPrimaryDisplayPublish(),primaryDisplaySourceId:",o),this.publishHandle(o,e).then(function(){log.info("===screen electronPrimaryDisplayPublish(),桌面共享发布流成功,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId),t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.registerElectronIPCInner=function(r){var n=this;this.ipc.once("selectScreenSourceId",function(e,t){log.info("===screen registerElectronIPCInner selectScreenSourceId, sourceId: "+t),n.roomHandle.selfUser.getScreen().publishHandle(t,r).then(function(){log.info("===screen registerElectronIPCInner(),桌面共享发布流成功,Id:"+n.id+",name："+n.name+",ownerId:"+n.ownerId)}).otherwise(function(e){})}),this.ipc.once("stopScreenSharing",function(e){n.roomHandle.selfUser.getScreen().unpublish()})},t.prototype.unpublish=function(){log.info("===screen.unpublish()");var r=when.defer(),t=this,n=getRandomNum(31001,32e3);return t.maxBandwidth=null,t.status==StreamStatus.published&&(t.status=StreamStatus.init,t.roomHandle.masterServer.screenUnpublishHandle(t.id,t.getNewStreamByTrack(),n),clearTimeout(o),o=setTimeout(function(){log.debug("===screen unpublish, unpub_roomresourcemsg_rep  timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Cancel publishing screen sharing"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),arrayUtil.objectSplice(t.roomHandle.pubScreens,t.id),log.info("===screen unpublish(),取消发布桌面共享成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),avdEngineHandle.loggerReport.info("screen unpublish(),取消发布桌面共享成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),setTimeout(function(){t.screenAudio&&t.screenAudio.status==StreamStatus.published?t.screenAudio.unpublish().then(function(){r.resolve()}):r.resolve(),t.track.stop(),t.track=null,t.roomHandle.isMcu()||(t.stream=null)},50))}),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))})),r.promise},t.prototype.subscrible=function(){log.info("===screen subscrible(),订阅桌面共享流,screenId:"+this.id+",userId:",this.ownerId),avdEngineHandle.loggerReport.info("srceen subscrible(),订阅桌面共享流,screenId:"+this.id+",userId:",this.ownerId);var r=when.defer(),n=getRandomNum(32001,33e3),t=this;return t.roomHandle.masterServer.screenSubscribleHandle(t.resourceInfo,n),clearTimeout(i),i=setTimeout(function(){log.debug("===screen subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Subscribe to screen sharing"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(i),setTimeout(function(){log.info("===screen subscrible(),订阅桌面共享流成功,screenId:"+t.id+",userId:",t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(i),r.reject(e))}),r.promise},t.prototype.unsubscrible=function(){log.info("===screen unsubscrible(),取消订阅桌面共享流,screenId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("screen unsubscrible(),取消订阅桌面共享流,screenId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(33001,34e3),t=this;return t.roomHandle.masterServer.screenUnsubscribleHandle(this.resourceInfo,n),clearTimeout(a),a=setTimeout(function(){log.debug("===screen unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new l(ErrorConstant.operate_timeout.code,"Unsubscribe from screen sharing"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(a),setTimeout(function(){log.info("===screen unsubscrible(),取消订阅桌面共享流成功,screenId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(a),r.reject(e))}),r.promise},t.prototype.setBandwidth=function(t){var e=this;if("RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var r=e.RTCRtpSender;if(r){var n=r.getParameters();n.encodings?n.encodings==[]&&(n.encodings[0]={}):n.encodings=[{}],t&&0!=t?n.encodings[0].maxBitrate=1e3*t:delete n.encodings[0].maxBitrate,r.setParameters(n).then(function(){e.clientSetMaxBandwidth=t,e.sendVideoStreamControl(t,e.resolution.width,e.resolution.height),log.info("===screen.setBandwidth(),带宽设置成功,clientSetMaxBandwidth:"+t)}).catch(function(e){log.error("===screen.setBandwidth(),带宽设置失败,clientSetMaxBandwidth:"+t+",error:",e)})}else e.clientSetMaxBandwidth=t,e.maxBandwidth=t,log.debug("===screen.setBandwidth(),RTCRtpSender is null,clientSetMaxBandwidth:"+t)}},t.prototype.sendVideoStreamControl=function(r,n,o){log.info("===Screen.sendVideoStreamControl(),maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", videoId:"+this.id+", nodeId:"+this.roomHandle.selfUser.nodeId);var i=when.defer(),a=this,s=getRandomNum(14001,15e3),d=a.roomHandle.setDeviceIdByUUID(0,a.id);return a.roomHandle.masterServer.sendVideoStreamControl(d,r,n,o,s),clearTimeout(u),u=setTimeout(function(){log.error("===Screen.sendVideoStreamControl(),带宽设置发送服务器端超时. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(new l(ErrorConstant.operate_timeout.code,"VIDEO_STREAM_CONTROL_REQ"+ErrorConstant.operate_timeout.message))},3e3),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_success,function(e){e==s&&(clearTimeout(u),log.info("===Screen.sendVideoStreamControl(), 带宽设置发送服务器端成功. maxBandwidth:"+r+"Kpbs,width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.resolve())}),a.roomHandle.addCallback(UserCallback.video_stream_control_rep_error,function(e,t){t==s&&(clearTimeout(u),log.error("===Screen.sendVideoStreamControl(),带宽设置发送服务器端失败. maxBandwidth:"+r+"Kpbs, width:"+n+", height:"+o+", resoucceId:"+d+", nodeId:"+a.roomHandle.selfUser.nodeId),i.reject(e))}),i.promise},t.prototype.updateScreenData=function(e,t){log.debug("===screen.updateScreenData(),level:"+e+",description:"+t),this.level=e,this.description=t,this.roomHandle&&this.roomHandle.selfUser&&(this.roomHandle.selfUser.reJoinScreenDescription=t,this.roomHandle.masterServer.updateScreenIdMsg(this.roomHandle.selfUser.nodeId,this.id,this))},t.prototype.publishHandle=function(n,o){log.debug("===Screen publishHandle(),sourceId :",n);var i=when.defer(),a=this,e={audio:{mandatory:{chromeMediaSource:"desktop",googEchoCancellation:avdEngineHandle.enableEchoCancellation,googNoiseSuppression:avdEngineHandle.enableNoiseSuppression,googAutoGainControl:avdEngineHandle.enableAutoGainControl,echoCancellation:avdEngineHandle.enableEchoCancellation}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxWidth:a.resolution.width,maxHeight:a.resolution.height,minFrameRate:a.frameRate,maxFrameRate:a.frameRate}}};return o||delete e.audio,log.debug("===Screen publishHandle constraints: ",JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(e){if(log.debug("===Screen publishHandle() webkitGetUserMedia success, gotShareStream.stream: ",e),e&&e.getTracks()){var t=e.getVideoTracks()[0];if(o){var r=e.getAudioTracks()[0];r&&a.screenAudio&&(a.screenAudio.track=r,a.screenAudio.publish())}void 0!==t.onended?t.onended=function(){log.debug("screen.publish(),track.onended"),a.track&&(a.unpublish(),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id)),a.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:void 0!==e.onended?e.onended=function(){log.debug("===screen.publish(),stream.onended"),a.track&&(a.unpublish(),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id)),a.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:e.oninactive=function(){log.debug("===screen.publish(),stream.oninactive"),a.track&&(a.unpublish(),a.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,a.status,a.id,a.name,a.roomHandle.selfUser.id)),a.roomHandle.eventEmitter.emit(RoomCallback.screen_sharing_ended)}}a.publishHandleInner(a,e,n,i).then(function(e){i.resolve(e)}).otherwise(function(e){i.reject(e)})}).catch(function(e){log.debug("An error occurred: "+JSON.stringify(e)),i.reject(e),a.ipc&&a.ipc.emit("screen-published-error",e)}),i.promise},t.prototype.publishHandleInner=function(r,e,t){r=this;var n=when.defer(),o=getRandomNum(3e4,31e3),i=r.roomHandle.calInitVideoBitrate(r.resolution.width,r.resolution.height);r.maxBandwidth=i.maxBit,r.track=e.getVideoTracks()[0],null==r.roomHandle.selfUser.screenStream?r.roomHandle.selfUser.screenStream=e:r.roomHandle.selfUser.screenStream.addTrack(r.track);var a=r.getNewStreamByTrack();return r.roomHandle.masterServer.screenPublishHandle(r.id,a,o),clearTimeout(s),s=setTimeout(function(){log.debug("===screen publish,pub_roomresourcemsg_rep_success  timeout"),n.reject(new l(ErrorConstant.operate_timeout.code,"Publishing screen sharing"+ErrorConstant.operate_timeout.message)),r.track&&(r.track.stop(),r.track=null)},3e3),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==o&&(clearTimeout(s),r.status=StreamStatus.published,r.roomHandle.pubScreens.push(r),log.info("===screen publishHandleInner(),桌面共享视频发布流成功,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId),r.ipc&&r.ipc.emit("screen-published"),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),n.resolve(t))}),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&(clearTimeout(s),r.track&&(r.track.stop(),r.track=null),log.info("===screen publishHandleInner(),桌面共享视频发布流失败,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId+", error:",JSON.stringify(e)),r.ipc&&r.ipc.emit("screen-published-error",e),n.reject(e))}),n.promise},t.prototype.attachScreenElementMediaStream=function(e,t){null!=t&&(this.element=e),e&&(e.srcObject=t)},t.prototype.setScreenAudioEnabled=function(e){this.screenAudioEnabled=e},t.prototype.muteScreenAudio=function(){this.screenAudio&&this.screenAudio.muteScreenAudio()},t.prototype.unmuteScreenAudio=function(){this.screenAudio&&this.screenAudio.unmuteScreenAudio()},t}),ModuleBase.define("ScreenAudio",["Base","Error"],function(n,a){var o,i,s,d,e=function(e,t,r){n.call(this,e,t),this.roomHandle=r};return(e.prototype=new n).publish=function(){log.info("===screenAudio.publish()");var t=when.defer();if(this.status==StreamStatus.published)t.resolve();else{var e=this.getNewStreamByTrack();this.publishInner(e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)})}return t.promise},e.prototype.publishInner=function(e){log.info("===screenAudio.publishInner()");var t=when.defer(),r=this;if(this.status==StreamStatus.published)t.resolve();else{var n=e.getAudioTracks()[0];void 0!==n.onended?n.onended=function(){log.debug("===screenAudio.publish(),track.onended"),r.track&&r.unpublish()}:void 0!==e.onended?e.onended=function(){log.debug("===screenAudio.publish(),stream.onended"),r.track&&r.unpublish()}:e.oninactive=function(){log.debug("===screenAudio.publish(),stream.oninactive"),r.track&&r.unpublish()},r.publishHandleInner(r,e,"").then(function(){t.resolve()}).otherwise(function(e){t.reject(e)})}return t.promise},e.prototype.unpublish=function(){log.info("===screenAudio.unpublish()");var r=when.defer(),t=this,n=getRandomNum(31001,32e3);return t.maxBandwidth=null,t.status==StreamStatus.published&&(t.status=StreamStatus.init,t.roomHandle.masterServer.screenAudioUnpublishHandle(t.id,t.getNewStreamByTrack(),n),clearTimeout(o),o=setTimeout(function(){log.debug("===screenAudio unpublish, unpub_roomresourcemsg_rep  timeout"),r.reject(new a(ErrorConstant.operate_timeout.code,"取消发布屏幕共享音频流"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(o),arrayUtil.objectSplice(t.roomHandle.pubScreens,t.id),log.info("===screenAudio unpublish(),取消发布桌面共享音频流成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),avdEngineHandle.loggerReport.info("screenAudio unpublish(),取消发布桌面共享音频流成功,screenId:"+t.id+",screenName："+t.name+",userId:"+t.ownerId),t.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,t.status,t.id,t.name,t.roomHandle.selfUser.id),setTimeout(function(){t.track.stop(),t.track=null,t.roomHandle.isMcu()||(t.stream=null),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(o),r.reject(e))})),r.promise},e.prototype.subscrible=function(){log.info("===screenAudio subscrible(),订阅桌面共享音频流,screenId:"+this.id+",userId:",this.ownerId),avdEngineHandle.loggerReport.info("ScreenAudio subscrible(),订阅桌面共享音频流,screenId:"+this.id+",userId:",this.ownerId);var r=when.defer(),n=getRandomNum(32001,33e3),t=this;return t.roomHandle.masterServer.screenAudioSubscribleHandle(t.resourceInfo,n),clearTimeout(i),i=setTimeout(function(){log.debug("===screenAudio subscrible, sub_roomresourcemsg_rep_success timeout"),r.reject(new a(ErrorConstant.operate_timeout.code,"订阅屏幕共享音频"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(i),setTimeout(function(){log.info("===screenAudio subscrible(),订阅桌面共享音频流成功,screenId:"+t.id+",userId:",t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.sub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(i),r.reject(e))}),r.promise},e.prototype.unsubscrible=function(){log.info("===screenAudio unsubscrible(),取消订阅桌面共享音频流,screenId:"+this.id+",userId:"+this.ownerId),avdEngineHandle.loggerReport.info("screen unsubscrible(),取消订阅桌面共享音频流,screenId:"+this.id+",userId:"+this.ownerId);var r=when.defer(),n=getRandomNum(33001,34e3),t=this;return t.roomHandle.masterServer.screenAudioUnsubscribleHandle(this.resourceInfo,n),clearTimeout(s),s=setTimeout(function(){log.debug("===screenAudio unsubscrible, unsub_roomresourcemsg_rep_success timeout"),r.reject(new a(ErrorConstant.operate_timeout.code,"取消订阅屏幕共享音频"+ErrorConstant.operate_timeout.message))},3e3),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(s),setTimeout(function(){log.info("===screenAudio unsubscrible(),取消订阅桌面共享音频流成功,screenId:"+t.id+",userId:"+t.ownerId),r.resolve()},50))}),t.roomHandle.addCallback(EngineCallback.unsub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(s),r.reject(e))}),r.promise},e.prototype.publishHandleInner=function(r,e,t){r=this;var n=when.defer(),o=getRandomNum(3e4,31e3);r.track=e.getAudioTracks()[0],null==r.roomHandle.selfUser.screenStream?r.roomHandle.selfUser.screenStream=e:r.roomHandle.selfUser.screenStream.addTrack(r.track),r.status=StreamStatus.published;var i=r.getNewStreamByTrack();return r.roomHandle.masterServer.screenAudioPublishHandle(r.id,i,o),clearTimeout(d),d=setTimeout(function(){log.debug("===screen publish,pub_roomresourcemsg_rep_success  timeout"),n.reject(new a(ErrorConstant.operate_timeout.code,"发布屏幕共享音频"+ErrorConstant.operate_timeout.message))},3e3),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==o&&(clearTimeout(d),log.info("===screen publishHandleInner(),桌面共享音频流发布成功,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId),r.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,r.status,r.id,r.name,r.roomHandle.selfUser.id),n.resolve(t))}),r.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&(clearTimeout(d),log.info("===screen publishHandleInner(),桌面共享音频流发布失败,Id:"+r.id+",name："+r.name+",ownerId:"+r.ownerId+"error:",e),n.reject(e))}),n.promise},e.prototype.muteScreenAudio=function(){var e=this;if(this.status==StreamStatus.published){this.status=StreamStatus.muted,e.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,this.status,this.id,this.name,e.roomHandle.selfUser.id),e.track&&(e.track.enabled=!1);var t=this.getCurrentSender();null!=t&&(t.track.enabled=!1,log.info("===screenAudio muteScreenAudio success")),e.roomHandle.masterServer.updateSpeakerMsg(e.roomHandle.selfUser.nodeId,e.id,this),log.info("===screenAudio muteScreenAudio(),禁音. Id:"+e.id+",ownerId:"+e.ownerId+",status:"+e.status),avdEngineHandle.loggerReport.info("===screenAudio muteScreenAudio(),禁音. Id:"+e.id+",ownerId:"+e.ownerId+",status:"+e.status)}},e.prototype.unmuteScreenAudio=function(){var e=this;if(this.status==StreamStatus.muted){this.status=StreamStatus.published,e.roomHandle.selfUser.eventEmitter.emit(UserCallback.screen_audio_status_notify,this.status,this.id,this.name,e.roomHandle.selfUser.id),e.track&&(e.track.enabled=!0);var t=this.getCurrentSender();null!=t&&(t.track.enabled=!0,log.info("===screenAudio muteScreenAudio success")),e.roomHandle.masterServer.updateSpeakerMsg(e.roomHandle.selfUser.nodeId,e.id,this),log.info("===screenAudio unmuteScreenAudio(),取消禁音. Id:"+e.id+",ownerId:"+e.ownerId+",status:"+e.status),avdEngineHandle.loggerReport.info("===screenAudio muteScreenAudio(),取消禁音. Id:"+e.id+",ownerId:"+e.ownerId+",status:"+e.status)}},e.prototype.getCurrentSender=function(){for(var e=null,t=this.roomHandle.traceablePeerConnection.getToMCUPeerConnection().getSenders(),r=0;r<t.length;r++)t[r].track&&t[r].track.id==this.track.id&&(e=t[r]);return e},e});var currentVideoParameter={videoWidth:!1,videoHeight:!1,frameRate:!1,aspectRatio:!1};function isAndroid(){return-1!=navigator.userAgent.indexOf("Android")}function getPreviousResolution(e){if(!Resolutions[e])return null;var t=Resolutions[e].order,r=null,n=null;for(var o in Resolutions){var i=Resolutions[o];(null==r||r.order<i.order&&i.order<t)&&(n=o,r=i)}return n}function getConstraints(e,t){var r={audio:!1,video:!1};return e&&(r.audio={}),t&&(r.video={width:{},height:{},frameRate:{}}),r.audio&&(r.audio.echoCancellation=avdEngineHandle.enableEchoCancellation,r.audio.noiseSuppression=avdEngineHandle.enableNoiseSuppression,r.audio.autoGainControl=avdEngineHandle.enableAutoGainControl,e.id&&"undefined"!=e.id&&(r.audio.deviceId={exact:e.id})),r.video&&t.id&&"undefined"!=t.id&&(r.video.deviceId={exact:t.id}),t&&(t.resolution&&setResolutionConstraints(r,t.resolution,t.setType),t.frameRate&&setFrameRateConstraints(r,t.frameRate),0<t.aspectRatio&&setAspectRatioConstraints(r,t.aspectRatio)),r}function getApplyConstraints(e){var t={};return e&&(t.video={width:{},height:{},frameRate:{}}),t&&e.id&&"undefined"!=e.id&&(t.video.deviceId={exact:e.id}),e&&(e.resolution&&setApplyResolutionConstraints(t,e.resolution,e.setType),e.frameRate&&setApplyFrameRateConstraints(t,e.frameRate),0<e.aspectRatio&&setApplyAspectRatioConstraints(t,e.aspectRatio)),t}function setResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.video.width={ideal:t.width},e.video.height={ideal:t.height}):(e.video.width={exact:t.width},e.video.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setApplyResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.width={ideal:t.width},e.height={ideal:t.height}):(e.width={exact:t.width},e.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setFrameRateConstraints(e,t){e.video.frameRate={ideal:t},currentVideoParameter.frameRate=t}function setApplyFrameRateConstraints(e,t){e.frameRate={ideal:t},currentVideoParameter.frameRate=t}function setAspectRatioConstraints(e,t){e.video.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t}function setApplyAspectRatioConstraints(e,t){e.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t}function obtainUserMedia(e,t){var r=when.defer();return getUserMediaWithConstraints(e,t).then(function(e){r.resolve(handleLocalStream(e))}).otherwise(function(e){r.reject(e)}),r.promise}function getUserMediaWithConstraints(t,r){var n=when.defer(),e=getConstraints(t,r);return log.info("===streamUtil.getUserMediaWithConstraints(),constraints:"+JSON.stringify(e)),r&&log.debug("===streamUtil.getUserMediaWithConstraints(),video getUserMedia Start"),t&&log.debug("===streamUtil.getUserMediaWithConstraints(),audio getUserMedia Start"),navigator.mediaDevices.getUserMedia(e).then(function(e){r&&log.debug("===streamUtil.getUserMediaWithConstraints(),video getUserMedia opened"),t&&log.debug("===streamUtil.getUserMediaWithConstraints(),audio getUserMedia opened"),n.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),n.reject(t)}),n.promise}function handleLocalStream(e){var t,r;if(t=new MediaStream,r=new MediaStream,e){for(var n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);var i=e.getVideoTracks();for(o=0;o<i.length;o++)r.addTrack(i[o])}return{audioStream:t,videoStream:r}}var fakeVideoConstraints={video:!0,fake:!0},fakeAudioConstraints={audio:!0,fake:!0};function getFakeVideoStream(t){navigator.mediaDevices.getUserMedia(fakeVideoConstraints).then(function(e){t(e)}).catch(function(e){})}function getFakeAudioStream(t){navigator.mediaDevices.getUserMedia(fakeAudioConstraints).then(function(e){t(e)}).catch(function(e){})}function getAllAudioVideoDevices(t,e){if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)),navigator.enumerateDevices){var o=[],i=[],a=[],s=[],d=[],l=[];navigator.enumerateDevices(function(e){e.forEach(function(e){var t,r={};for(var n in e)r[n]=e[n];o.forEach(function(e){e.id===r.id&&(t=!0)}),t||("audio"===r.kind&&(r.kind="audioinput"),"video"===r.kind&&(r.kind="videoinput"),r.deviceId||(r.deviceId=r.id),r.id||(r.id=r.deviceId),r.label||(r.label="Please invoke getUserMedia once."),"audioinput"!==r.kind&&"audio"!==r.kind||s.push(r),"audiooutput"===r.kind&&d.push(r),"videoinput"!==r.kind&&"video"!==r.kind||l.push(r),-1!==r.kind.indexOf("audio")&&i.push(r),-1!==r.kind.indexOf("video")&&a.push(r),o.push(r))}),t&&t({allMdiaDevices:o,allVideoDevices:a,allAudioDevices:i,videoInputDevices:l,audioInputDevices:s,audioOutputDevices:d})})}else e(null,"Neither navigator.mediaDevices.enumerateDevices NOR MediaStreamTrack.getSources are available.")}function captureUserMedia(e,t,r){navigator.mediaDevices.getUserMedia(e).then(t)}function saveLog(e,t,r){var n=document.location.protocol;"httpsionic:"==n&&(n="https:");var o=n+"//"+logAjax.server+"/write?db="+logAjax.db+"&u="+logAjax.userName+"&p="+logAjax.password;"undefined"!=typeof returnCitySN&&(cip=returnCitySN.cip);(new Date).getTime();var i="",a="",s="",d="",l=0;room&&(room.id&&(i=room.id),room.selfUser&&(room.selfUser.name&&(a=room.selfUser.name),room.selfUser.id&&(s=room.selfUser.id))),avdEngineHandle.browserDetect&&avdEngineHandle.browserDetect.detect&&avdEngineHandle.browserDetect.detect.browser&&(avdEngineHandle.browserDetect.detect.browser.name&&(d=avdEngineHandle.browserDetect.detect.browser.name),avdEngineHandle.browserDetect.detect.browser.fullVersion&&(l=avdEngineHandle.browserDetect.detect.browser.fullVersion));var u='js_log host_ip="'+cip+'",roomId="'+i+'",userName="'+a+'",userId="'+s+'",browserName="'+d+'",browserVersion="'+l+'",level="'+e+'",msg="'+t+'" ';$.ajax({type:"post",url:o,timeout:5e3,data:u,success:function(e){},error:function(e,t,r){}})}navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)}),ModuleBase.define("RestServer",["Error"],function(s){var e=function(e){e&&(avdEngineHandle.restServerInfo.protocolStr=e)},o=axios.create({baseURL:"",timeout:1e4,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}});return e.prototype.getServerinfo=function(e,t,r,n){var o=when.defer();"httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:");var i=avdEngineHandle.restServerInfo.protocolStr+"//"+e+"/sdk/config/serverinfo",a={params:{uri_encode:"yes",client_info:{access_tocken:t},is_use_cascade:r,room_id:n}};return this.fetchGet(i,a).then(function(e){log.debug("===restServer.getServerinfo(),serverinfo:"+JSON.stringify(e)),avdEngineHandle.connectionStatisticsConfig=e.statistic_config?e.statistic_config:{},avdEngineHandle.connectionStatisticsConfig.open_statistic=e.open_statistic?e.open_statistic:0,avdEngineHandle.connectionStatisticsConfig.trace_id=e.trace_id?e.trace_id:"",avdEngineHandle.loggerReportConfig=e.logger_config?e.logger_config:{},avdEngineHandle.loggerReportConfig.open_logger=e.open_logger?e.open_logger:0,avdEngineHandle.loggerReportConfig.trace_id=e.trace_id?e.trace_id:"",avdEngineHandle.restServerInfo.roomServerUrl=e.room_server.uri,avdEngineHandle.restServerInfo.iceServers=e.ice_servers,avdEngineHandle.restServerInfo.iceServers&&0<avdEngineHandle.restServerInfo.iceServers.length&&(avdEngineHandle.restServerInfo.stunUrl=avdEngineHandle.restServerInfo.iceServers[0].url,avdEngineHandle.restServerInfo.trunUrl=avdEngineHandle.restServerInfo.iceServers[1].url,avdEngineHandle.restServerInfo.iceusername=avdEngineHandle.restServerInfo.iceServers[1].username,avdEngineHandle.restServerInfo.iceCredential=avdEngineHandle.restServerInfo.iceServers[1].credential),e.is_cluster&&("true"!=e.is_cluster&&1!=e.is_cluster||(avdEngineHandle.restServerInfo.isCluster=!0)),e.not_query_get_mcu&&("true"!=e.not_query_get_mcu&&1!=e.not_query_get_mcu||(avdEngineHandle.restServerInfo.notQueryGetMcu=!0)),e.master_version&&(avdEngineHandle.restServerInfo.masterVersion=e.master_version),e.master_package_version&&(avdEngineHandle.restServerInfo.masterPackageVersion=e.master_package_version),e.box_version&&(avdEngineHandle.restServerInfo.boxVersion=e.box_version),e.box_package_version&&(avdEngineHandle.restServerInfo.boxPackageVersion=e.box_package_version),avdEngineHandle.supperStrongWeakNetWork=function(e){var t=!1;if(e){var r=versionStringCompare(e,"3.1.6");0<=r&&(t=!0)}t||log.info("当前服务器版本不支持强弱网抗丢包功能，客户端也将不启用支持强网抗丢包能力。");return t}(e.box_version),e.signal_data&&(avdEngineHandle.restServerInfo.signalData=e.signal_data),o.resolve()}).catch(function(e){e=new s(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.getMcu=function(e,t,r){var n=when.defer();avdEngineHandle.loggerReport.info("===restServer.getMcu(),调度服务器地址:"+avdEngineHandle.restServerInfo.mcuServerUrl),"httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:");var o=avdEngineHandle.restServerInfo.protocolStr+"//"+avdEngineHandle.restServerInfo.mcuServerUrl+"/sdk/get_mcu",i={params:{room_id:e,token:t,is_use_cascade:r}};return log.info("===restServer.getMcu(),avdEngineHandle.mcuClusterRouteParams:"+avdEngineHandle.mcuClusterRouteParams),avdEngineHandle.mcuClusterRouteParams&&(i.params.options=avdEngineHandle.mcuClusterRouteParams,log.info("===restServer.getMcu(), getMcuUrl(带mcuClusterRouteParams):"+i.params.options)),this.fetchGet(o,i).then(function(e){log.debug("===restServer.getMcu(),mcuAddr:"+JSON.stringify(e));var t=e.ret;if(0==t)avdEngineHandle.restServerInfo.roomServerUrl=e.addr,avdEngineHandle.restServerInfo.clusterRestAddr=e.cluster_rest_addr,log.info("===restServer.getMcu(),mcuAddr.addr:"+e.addr),avdEngineHandle.loggerReport.info("===restServer.getMcu(),mcuAddr.cluster_rest_addr:"+e.cluster_rest_addr),n.resolve();else{var r=new s(t,e.msg);n.reject(r)}}).catch(function(e){console.log(e);e=new s(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.getMcuWithOEM=function(e,t){var n=when.defer();"httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:");var r=avdEngineHandle.restServerInfo.protocolStr+"//"+avdEngineHandle.restServerInfo.mcuServerUrl+"/sdk/get_mcu",o={params:{room_id:e,access_token:t}};return this.fetchGet(r,o).then(function(e){var t=e.ret;if(0==t)avdEngineHandle.restServerInfo.roomServerUrl=e.addr,avdEngineHandle.restServerInfo.clusterRestAddr=e.cluster_rest_addr,avdEngineHandle.accessToken=e.access_token,log.info("===restServer.getMcuWithOEM(), roomServerUrl:"+e.addr+",accessToken："+e.access_token),n.resolve();else{var r=new s(t,e.msg);n.reject(r)}}).catch(function(e){e=new s(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.getMqttWSAddr=function(e,t){var o=when.defer();"httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:");var r=avdEngineHandle.restServerInfo.protocolStr+"//"+e+"/sdk/mqtt/serverinfo",n={params:{token:t}};return this.fetchGet(r,n).then(function(e){var t=e.ret;if(0==t){var r=e.data.mqtt_ws_addr;log.info("===restServer.getMqttWSAddr(), mqttWSAddr:"+r),o.resolve(r)}else{var n=new s(t,e.msg);o.reject(n)}}).catch(function(e){e=new s(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.uploadFile=function(e,t){var n=when.defer();"httpsionic:"==avdEngineHandle.restServerInfo.protocolStr&&(avdEngineHandle.restServerInfo.protocolStr="https:");var r=avdEngineHandle.restServerInfo.protocolStr+"//"+avdEngineHandle.restServerInfo.mcuServerUrl+"/uploadfile?token="+e,o=new FormData;return o.append("file",t),this.fetchPost(r,o).then(function(e){log.debug("===restServer.uploadFile(),fileObj:"+JSON.stringify(e));var t=e.ret;if(0==t)downloadUrl=e.download_url,n.resolve(downloadUrl);else{var r=new s(t,e.msg);n.reject(r)}}).catch(function(e){e=new s(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,n){o.get(e,t).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};n(t)}}).catch(function(e){if(e.response){var t=new s(e.response.status,e.response.data);n(t)}else{t=new s(1e4,e.message);n(t)}n(e)})})},e.prototype.fetchPost=function(e,t){return new Promise(function(r,n){o.post(e,t,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};n(t)}}).catch(function(e){if(e.response){var t=new s(e.response.status,e.response.data);n(t)}else{t=new s(1e4,e.message);n(t)}n(e)})})},e}),ModuleBase.define("MasterServer",["CmdProtobufCoded","TraceablePeerConnection","Error"],function(r,n,T){var e=function(e,t){this.signalingChannel=e,this.roomHandle=t,this.cmdProtobufCoded=new r,this.roomPduType=this.cmdProtobufCoded.getRoomPduTypeEnum(),this.mediaType=this.cmdProtobufCoded.getMediaTypeEnum(),this.sessionType=this.cmdProtobufCoded.getSessionTypeEnum(),this.resourceStatus=this.cmdProtobufCoded.getResourceStatusEnum(),this.resourceOpt=this.cmdProtobufCoded.getResourceOptEnum(),this.userMsgOpt=this.cmdProtobufCoded.getUserMsgOptEnum(),this.cameraType=this.cmdProtobufCoded.getCameraTypeEnum(),this.lineArrow=this.cmdProtobufCoded.getLineArrowEnum(),this.annotationType=this.cmdProtobufCoded.getAnnotationTypeEnum(),this.exporterType=this.cmdProtobufCoded.getExporterTypeEnum(),this.dataCryptoType=this.cmdProtobufCoded.getDataCryptoTypeEnum(),this.outGoingViewLayoutMode=this.cmdProtobufCoded.getOutGoingViewLayoutMode(),this.traceablePeerConnection=new n(t),this.roomHandle.traceablePeerConnection=this.traceablePeerConnection,this.traceablePeerConnection.getToMCUPeerConnection()};function w(t,i){var a=i.payloads.split(" "),r=[];if(!t.includes("rtx")&&"video"==i.type&&(i.rtp.forEach(function(e){t.includes(e.codec)||r.push(e)}),r.length%2==1)){var e=r[r.length-1];arrayUtil.baseSplice(a,e.payload),arrayUtil.baseSplice(i.rtp,e)}return t.forEach(function(o){i.rtp.forEach(function(e){if(e.codec==o){var t=e.payload;if(delete i.rtp[r],a.forEach(function(e){e==t&&arrayUtil.baseSplice(a,t)}),i.fmtp.forEach(function(e){e.config!="apt="+t&&e.payload!=t||arrayUtil.baseSplice(i.fmtp,e)}),i.rtcpFb)for(var r=0;r<i.rtcpFb.length;r++){var n=i.rtcpFb[r];n.payload==t&&(arrayUtil.baseSplice(i.rtcpFb,n),r--)}}})}),i.payloads=a.join(" "),i}function E(e,t){for(var r,n=t,o=0;o<e.fmtp.length;o++){var i=e.fmtp[o];i&&i.payload==n&&(arrayUtil.baseSplice(e.fmtp,i),o--),i&&i.config=="apt="+n&&(r=i.payload,arrayUtil.baseSplice(e.fmtp,i),o--)}for(o=0;o<e.rtp.length;o++){var a=e.rtp[o];!a||a.payload!=n&&a.payload!=r||(arrayUtil.baseSplice(e.rtp,a),o--)}if(e.rtcpFb)for(o=0;o<e.rtcpFb.length;o++){var s=e.rtcpFb[o];s.payload==n&&(arrayUtil.baseSplice(e.rtcpFb,s),o--)}var d=e.payloads.split(" ");for(o=0;o<d.length;o++){var l=d[o];l!=n&&l!=r||arrayUtil.baseSplice(d,n)}return e.payloads=d.join(" "),e}function s(){var e=0;return avdEngineHandle.restServerInfo.isCluster&&(e=1),e}return e.prototype.openReqSend=function(){var a=this;if(a.roomHandle.versionToServer&&a.roomHandle.audioCodecPayloadMap){a.roomHandle.answerRemoteSdp=a.roomHandle.remoteSdpTemplate;var e=s();log.debug("===masterServer.openReqSend(),000000,isClusterOfPDU:"+e);avdEngineHandle.loggerReportConfig&&avdEngineHandle.loggerReportConfig.trace_id&&avdEngineHandle.loggerReportConfig.trace_id;var t=a.cmdProtobufCoded.newOpenReq(10,avdEngineHandle.accessToken,"",a.roomHandle.versionToServer,"",e,a.roomHandle.audioCodecPayloadMap),r=a.cmdProtobufCoded.encodedPacket(a.roomPduType.OPEN_REQ,0,0,0,t);log.info("===masterServer.openReqSend(),000000,Send PDU OPEN_REQ"),avdEngineHandle.loggerReport.info("masterServer.openReqSend(),000000,Send PDU OPEN_REQ"),a.signalingChannel.send(r)}else(function(v){var y=when.defer(),_=["red","ulpfec","rtx","flexfec-03"];avdEngineHandle.supperStrongWeakNetWork&&(_=["red","ulpfec","flexfec-03"]);var b=["red","telephone-event"],S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e={offerToReceiveAudio:1,offerToReceiveVideo:1};avdEngineHandle.isFirefox||(S.addTransceiver("audio",{direction:"inactive"}),S.addTransceiver("video",{direction:"inactive"}),e={});return S.createOffer(e).then(function(e){log.debug("===masterServer.sdpPretreatment(),createOffer sessionDescription.sdp:"+e.sdp);var t=getIceInfoBySDP(e.sdp);log.debug("===masterServer.sdpPretreatment(), ice-ufrag:"+t.ufrag+", ice-pwd:"+t.pwd),v.iceUfrag=t.ufrag,v.icePwd=t.pwd,e.sdp=e.sdp.replace(/packetization-mode=0/g,"packetization-mode=1");var r=new SDPTransform,n=r.parse(e.sdp),a=new Map,s=[];n.media.forEach(function(e){if("video"==e.type){for(var t=0;t<e.fmtp.length;t++){var r=e.fmtp[t];a.get(r.config)?s.push(r):a.set(r.config,r.payload)}for(var n=0;n<s.length;n++)for(var o=s[n],i=0;i<e.fmtp.length;i++)(r=e.fmtp[i])&&r.payload==o.payload&&(delete e.fmtp[i],E(e,o.payload))}}),n.media.forEach(function(e){"video"==e.type?(v.codecPayloadVP8=[],v.codecPayloadVP9=[],v.codecPayloadH264=[],v.codecPayloadAV1=[],e.rtp.forEach(function(e){"VP8"==e.codec?v.codecPayloadVP8.push(e.payload):"VP9"==e.codec?v.codecPayloadVP9.push(e.payload):"H264"==e.codec?v.codecPayloadH264.push(e.payload):"AV1"==e.codec&&v.codecPayloadAV1.push(e.payload)})):"audio"==e.type&&(v.codecPayloadOpus=[],v.codecPayloadISAC_16K=[],v.codecPayloadISAC_32K=[],v.codecPayloadG722=[],v.codecPayloadPCMU=[],v.codecPayloadPCMA=[],v.codecPayloadCN_8k=[],v.codecPayloadCN_16k=[],v.codecPayloadCN_32k=[],e.rtp.forEach(function(e){"opus"==e.codec?v.codecPayloadOpus.push(e.payload):"ISAC"==e.codec&&16e3==e.rate?v.codecPayloadISAC_16K.push(e.payload):"ISAC"==e.codec&&32e3==e.rate?v.codecPayloadISAC_32K.push(e.payload):"G722"==e.codec?v.codecPayloadG722.push(e.payload):"PCMU"==e.codec?v.codecPayloadPCMU.push(e.payload):"PCMA"==e.codec?v.codecPayloadPCMA.push(e.payload):"CN"==e.codec&&8e3==e.rate?v.codecPayloadCN_8k.push(e.payload):"CN"==e.codec&&16e3==e.rate?v.codecPayloadCN_16k.push(e.payload):"CN"==e.codec&&32e3==e.rate&&v.codecPayloadCN_32k.push(e.payload)}))});var d="102",o=getPayloadByProfileLevel(e.sdp,avdEngineHandle.enableHardwareEncoding);o&&(d=o),log.debug("===masterServer.sdpPretreatment(), currpayloadH264:"+d);var i=0;if(v.codecPayloadH264&&0<v.codecPayloadH264.length){for(var l=0;l<v.codecPayloadH264.length;l++)if(v.codecPayloadH264[l]==d){i=l;break}if(0<i){var u=v.codecPayloadH264[0];v.codecPayloadH264[0]=d,v.codecPayloadH264[i]=u}}var c="js_v"+avdEngineHandle.avdVersion+" ";if(v.codecPayloadVP8&&0<v.codecPayloadVP8.length)for(l=0;l<v.codecPayloadVP8.length;l++)c=c+"vp8:"+v.codecPayloadVP8[l]+",";if(v.codecPayloadVP9&&0<v.codecPayloadVP9.length)for(l=0;l<v.codecPayloadVP9.length;l++)c=c+"vp9:"+v.codecPayloadVP9[l]+",";if(v.codecPayloadH264&&0<v.codecPayloadH264.length)for(l=0;l<v.codecPayloadH264.length;l++){var p=",";l==v.codecPayloadH264.length-1&&(p=""),c=c+"h264:"+v.codecPayloadH264[l]+p}var h="";if(v.codecPayloadISAC_16K&&0<v.codecPayloadISAC_16K.length)for(l=0;l<v.codecPayloadISAC_16K.length;l++)h=h+"isac_16k:"+v.codecPayloadISAC_16K[l]+",";if(v.codecPayloadISAC_32K&&0<v.codecPayloadISAC_32K.length)for(l=0;l<v.codecPayloadISAC_32K.length;l++)h=h+"isac_32k:"+v.codecPayloadISAC_32K[l]+",";if(v.codecPayloadOpus&&0<v.codecPayloadOpus.length)for(l=0;l<v.codecPayloadOpus.length;l++)h=h+"opus:"+v.codecPayloadOpus[l]+",";if(v.codecPayloadG722&&0<v.codecPayloadG722.length)for(l=0;l<v.codecPayloadG722.length;l++)h=h+"g722:"+v.codecPayloadG722[l]+",";if(v.codecPayloadPCMU&&0<v.codecPayloadPCMU.length)for(l=0;l<v.codecPayloadPCMU.length;l++)h=h+"pcmu:"+v.codecPayloadPCMU[l]+",";if(v.codecPayloadPCMA&&0<v.codecPayloadPCMA.length)for(l=0;l<v.codecPayloadPCMA.length;l++)h=h+"pcma:"+v.codecPayloadPCMA[l]+",";if(v.codecPayloadCN_8k&&0<v.codecPayloadCN_8k.length)for(l=0;l<v.codecPayloadCN_8k.length;l++)h=h+"cn_8k:"+v.codecPayloadCN_8k[l]+",";if(v.codecPayloadCN_16k&&0<v.codecPayloadCN_16k.length)for(l=0;l<v.codecPayloadCN_16k.length;l++)h=h+"cn_16k:"+v.codecPayloadCN_16k[l]+",";if(v.codecPayloadCN_32k&&0<v.codecPayloadCN_32k.length)for(l=0;l<v.codecPayloadCN_32k.length;l++)p=",",l==v.codecPayloadCN_32k.length-1&&(p=""),h=h+"cn_32k:"+v.codecPayloadCN_32k[l]+p;e.sdp=r.writer(n);var f=new SDPTransform,m=f.parse(e.sdp);m.media.forEach(function(e){if("video"==e.type){e.ext=[],e.ext.push({value:2,uri:"urn:ietf:params:rtp-hdrext:toffset"}),e.ext.push({value:3,uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),avdEngineHandle.supperStrongWeakNetWork||e.ext.push({value:5,uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),w(_,e);for(var t=e.payloads.split(" "),r=0;r<t.length;r++){var n=t[r];avdEngineHandle.videoCoding==VideoCodingType.VP8?a=v.codecPayloadVP8[0]:avdEngineHandle.videoCoding==VideoCodingType.VP9?a=v.codecPayloadVP9[0]:avdEngineHandle.videoCoding==VideoCodingType.H264&&(a=d),n==a&&(i=r)}var o=t[0];t[0]=a,t[i]=o,e.payloads=t.join(" "),e.ssrcs=[],v.videoMediaTemplate=e}else if("audio"==e.type){var i;for(e.ext=[],e.ext.push({value:1,uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"}),w(b,e),t=e.payloads.split(" "),r=0;r<t.length;r++){var a;n=t[r],avdEngineHandle.audioCoding==AudioCodingType.opus?a=v.codecPayloadOpus[0]:avdEngineHandle.audioCoding==AudioCodingType.ISAC_16k?a=v.codecPayloadISAC_16K[0]:avdEngineHandle.audioCoding==AudioCodingType.ISAC_32k?a=v.codecPayloadISAC_32K[0]:avdEngineHandle.audioCoding==AudioCodingType.G722?a=v.codecPayloadG722[0]:avdEngineHandle.audioCoding==AudioCodingType.PCMA?a=v.codecPayloadPCMA[0]:avdEngineHandle.audioCoding==AudioCodingType.PCMU&&(a=v.codecPayloadPCMU[0]),n==a&&(i=r)}o=t[0],t[0]=a,t[i]=o,e.payloads=t.join(" "),e.ssrcs=[],v.audioMediaTemplate=e}}),e.sdp=f.writer(m),v.remoteSdpTemplate=e.sdp,S.close();var g={version:v.versionToServer=c,audioCodecPayloadMap:v.audioCodecPayloadMap=h};y.resolve(g)}).catch(function(e){log.error("===masterServer.sdpPretreatment(),temp PC createOffer error:"+e.toString()),y.reject(e)}),y.promise})(a.roomHandle).then(function(e){var t=e.version,r=e.audioCodecPayloadMap;log.info("===masterServer.openReqSend(),version:"+t),log.info("===masterServer.openReqSend(),audioCodecPayloadMap:"+r),a.roomHandle.answerRemoteSdp=a.roomHandle.remoteSdpTemplate;var n=s();log.debug("===masterServer.openReqSend(),isClusterOfPDU:"+n);avdEngineHandle.loggerReportConfig&&avdEngineHandle.loggerReportConfig.trace_id&&avdEngineHandle.loggerReportConfig.trace_id;var o=a.cmdProtobufCoded.newOpenReq(10,avdEngineHandle.accessToken,"",t,"",n,r),i=a.cmdProtobufCoded.encodedPacket(a.roomPduType.OPEN_REQ,0,0,0,o);log.info("===masterServer.openReqSend(), Send PDU OPEN_REQ"),avdEngineHandle.loggerReport.info("masterServer.openReqSend(), Send PDU OPEN_REQ"),a.signalingChannel.send(i)}).otherwise(function(e){log.error("===masterServer.openReqSend(),sdpPretreatment() error:",JSON.stringify(e))})},e.prototype.openReqReconnectionSend=function(){var e=s();log.debug("===masterServer.openReqReconnectionSend(),isClusterOfPDU:"+e);var t=this.cmdProtobufCoded.newOpenReq(10,avdEngineHandle.accessToken,this.roomHandle.signalTocken,this.roomHandle.versionToServer,"",e,this.roomHandle.audioCodecPayloadMap),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OPEN_REQ,0,0,0,t);log.info("===masterServer.openReqReconnectionSend(),Send PDU OPEN_REQ"),avdEngineHandle.loggerReport.info("masterServer.openReqReconnectionSend(),Send PDU OPEN_REQ"),this.signalingChannel.send(r)},e.prototype.pingIntervalHandle=function(){var e=this;e.roomHandle.pingIntervalId=setInterval(function(){e.roomHandle&&(e.roomHandle.pingCountTime+=e.roomHandle.pingInterval,packetArray=e.cmdProtobufCoded.encodedPacket(e.roomPduType.PING,e.roomHandle.lastPDUSeq,0,0,null),e.signalingChannel.send(packetArray))},e.roomHandle.pingInterval)},e.prototype.pingTimeoutHandle=function(){var e=this,t=3*e.roomHandle.pingInterval;e.roomHandle.pingTimeoutId=setInterval(function(){e.roomHandle&&e.roomHandle.pingCountTime>=t&&0==e.roomHandle.connectionState&&(log.info("===webSocket,masterServer.pingTimeoutHandle(),Ping包饱和测试无响应时间超过指定时长"+t+"毫秒时,进行websocket重连操作。"),avdEngineHandle.loggerReport.info("webSocket，masterServer.pingTimeoutHandle(),Ping包饱和测试无响应时间超过指定时长"+t+"毫秒时，进行websocket重连操作"),log.debug("===MasterServer.pingTimeoutHandle(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connecting),e.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),e.pingInit(),e.roomHandle.reconnectionHandle())},1e3)},e.prototype.pingInit=function(){this.roomHandle.pingCountTime=0,clearInterval(this.roomHandle.pingIntervalId),clearInterval(this.roomHandle.pingTimeoutId),this.roomHandle.pingIntervalId=null,this.roomHandle.pingTimeoutId=null},e.prototype.inviteRoomReqSend=function(){var t=this,e=null;0<t.roomHandle.currentReconnectTimes&&(e=t.roomHandle.selfUser.nodeId);var r=this.cmdProtobufCoded.newUserPolicy(!0,!0,!0),n=t.roomHandle.userAgent;avdEngineHandle.clientResource.cameras&&avdEngineHandle.clientResource.cameras.forEach(function(e){e.id=t.roomHandle.setDeviceIdByUUID(0,e.id)}),avdEngineHandle.clientResource.microphones&&avdEngineHandle.clientResource.microphones.forEach(function(e){e.id=t.roomHandle.setDeviceIdByUUID(2,e.id)}),avdEngineHandle.clientResource.speakers&&avdEngineHandle.clientResource.speakers.forEach(function(e){e.id=t.roomHandle.setDeviceIdByUUID(1,e.id)});var o=JSON.stringify(avdEngineHandle.clientResource);log.debug("===masterServer.inviteRoomReqSend(),userResources:"+o);var i=this.cmdProtobufCoded.newJoinInfo([],[],n,r,o),a=this.dataCryptoType.DataCryptoTypeAES128;avdEngineHandle.dataCrypto==DataCryptoType.AES128?a=this.dataCryptoType.DataCryptoTypeAES128:avdEngineHandle.dataCrypto==DataCryptoType.AES256?a=this.dataCryptoType.DataCryptoTypeAES256:avdEngineHandle.dataCrypto==DataCryptoType.SM4&&(a=this.dataCryptoType.DataCryptoTypeSM4),log.debug("===masterServer.inviteRoomReqSend(),dataCryptoType:"+a);var s=this.cmdProtobufCoded.newInviteRoomReq1(20,t.roomHandle.id,"",avdEngineHandle.accessToken,t.roomHandle.selfUser.id,t.roomHandle.selfUser.name,i,t.roomHandle.roomPassword,e,t.roomHandle.selfUser.data,avdEngineHandle.mediaConnectType,a);s.user_data=t.roomHandle.selfUser.data,s.ice_ufrag=t.roomHandle.iceUfrag,s.ice_pwd=t.roomHandle.icePwd,log.info("===masterServer.inviteRoomReqSend(),Send PDU INVITE_ROOM_REQ1"),avdEngineHandle.loggerReport.info("masterServer.inviteRoomReqSend(),Send PDU INVITE_ROOM_REQ1");var d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.INVITE_ROOM_REQ1,0,0,0,s);this.signalingChannel.send(d)},e.prototype.sendAnswer=function(){var e=this,t=when.defer();return e.traceablePeerConnection.doSetRemoteDescription().then(function(){e.traceablePeerConnection.doSetLocalDescription().then(function(){t.resolve()}).otherwise(function(e){t.reject(e)})}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.setAddIcecandidate=function(e){if(avdEngineHandle.restServerInfo.roomServerUrl){var t=avdEngineHandle.restServerInfo.roomServerUrl.split("/")[0];if(t){var r=t.split(":");0<r.size&&(t=r[0])}e.candidate=e.candidate.replace("127.0.0.1",t)}log.debug("===masterServer.setAddIcecandidate(),mcu server send candidate:"+e.candidate),this.traceablePeerConnection.doAddIceCandidate(e)},e.prototype.addWebcamMsg=function(e,t){var r=this.cmdProtobufCoded.newWebcam(e,t.name,t.status,this.sessionType.Video);r.ctype=this.cameraType.unknown,r.level=t.level,r.description=t.description;var n=this.cmdProtobufCoded.newAddWebcamMsg(this.roomHandle.selfUser.nodeId,r);log.info("===masterServer.addWebcamMsg(),Send PDU ADD_WEBCAM_MSG, PDUDeviceId:"+e);var o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_WEBCAM_MSG,0,this.roomHandle.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.removeWebcamMsg=function(e){var t=this.cmdProtobufCoded.newRemoveWebcamMsg(this.roomHandle.selfUser.nodeId,e);log.info("===masterServer.removeWebcamMsg(),Send PDU REMOVE_WEBCAM_MSG, PDUDeviceId:"+e);var r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_WEBCAM_MSG,0,this.roomHandle.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.addScreenMsg=function(e,t){var r=this.cmdProtobufCoded.newDesktop(e,t.name,t.status,this.sessionType.ShareScreen);r.level=t.level,r.description=t.description;var n=this.cmdProtobufCoded.newAddDesktopMsg(this.roomHandle.selfUser.nodeId,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_DESKTOP_MSG,0,this.roomHandle.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.addSpeakerMsg=function(e,t){var r=this.cmdProtobufCoded.newSpeaker(e,t.name,t.status,this.sessionType.Audio),n=this.cmdProtobufCoded.newAddSpeakerMsg(this.roomHandle.selfUser.nodeId,r);log.info("===masterServer.addSpeakerMsg(),Send PDU ADD_SPEAKER_MSG, PDUDeviceId:"+e);var o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_SPEAKER_MSG,0,this.roomHandle.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.removeSpeakerMsg=function(e){var t=this.cmdProtobufCoded.newRemoveSpeakerMsg(this.roomHandle.selfUser.nodeId,e);log.info("===masterServer.removeSpeakerMsg(),Send PDU REMOVE_SPEAKER_MSG,PDUDeviceId:"+e);var r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_SPEAKER_MSG,0,this.roomHandle.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.updateUserName=function(e,t){var r=this.cmdProtobufCoded.newUpdateUserName(e,t),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_NAME,0,this.roomHandle.selfUser.nodeId,0,r);this.signalingChannel.send(n)},e.prototype.updateUserDataMsg=function(e){var t=this.cmdProtobufCoded.newUpdateUserDataMsg(this.roomHandle.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_DATA_MSG,0,this.roomHandle.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.roomDataInfo=function(e,t){var r=this.cmdProtobufCoded.newRoomKV(e,t),n=[];n.push(r);var o=this.cmdProtobufCoded.newRoomDataInfo(this.roomHandle.id,n),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_DATA_INFO,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(i)},e.prototype.pubRoomResourceMsg=function(e,t,r,n,o,i){var a,s=100;if(avdEngineHandle.videoCoding==VideoCodingType.VP8?s=100:avdEngineHandle.videoCoding==VideoCodingType.VP9?s=101:avdEngineHandle.videoCoding==VideoCodingType.H264&&(s=107),"video"==e)a=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,r,currentVideoParameter.videoWidth,currentVideoParameter.videoHeight,currentVideoParameter.frameRate,s);else if("audio"==e){var d=parseInt(avdEngineHandle.audioCoding);a=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,r,0,0,0,d)}else"screen"==e&&(a=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,r,1920,1080,5,s));if(null!=a){a.sdp_version=3;var l=this.cmdProtobufCoded.newRoomResourceInfo(n,this.roomHandle.selfUser.nodeId,a);if(l.keep_alive_time=i,"video"==e){var u=this.roomHandle.getDeviceIdByUUID(0,n),c=this.roomHandle.selfUser.getVideo(u);c&&(c.resourceInfo=l)}log.info("==="+e+" send PUB_ROOM_RESOURCE_MSG,orderId:"+o+",resource_id:"+l.resource_id+",owner_id:"+l.owner_id+",keep_alive_time:"+l.keep_alive_time);var p=this.cmdProtobufCoded.newPubRoomResourceMsg(l,o),h=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,p);this.signalingChannel.send(h),this.signalingChannel.send("")}},e.prototype.subRoomResourceMsg=function(e,t,r,n,o){var i;if(1==t){log.info("==="+e+" send SUB_ROOM_RESOURCE_MSG,updateType:"+t+",orderId:"+o+",resource_id:"+r.resource_id+",owner_id:"+r.owner_id);var a=this.cmdProtobufCoded.newSubRoomResourceMsg(r,this.roomHandle.selfUser.nodeId,o,n);i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,a)}else if(0==t){log.info("==="+e+" send UNSUB_ROOM_RESOURCE_MSG,updateType:"+t+",orderId:"+o+",resource_id:",r.resource_id+",owner_id:"+r.owner_id);var s=this.cmdProtobufCoded.newUnsubRoomResourceMsg(r,this.roomHandle.selfUser.nodeId,o);i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNSUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,s)}this.signalingChannel.send(i),this.signalingChannel.send("")},e.prototype.unpubRoomResourceMsg=function(e,t,r,n){var o,i,a=-1<r.indexOf("screen_audio");if("video"==e){var s=this.roomHandle.getDeviceIdByUUID(0,r);log.debug("===masterServer.unpubRoomResourceMsg(),video deviceId:",s),o=(l=this.roomHandle.selfUser.getVideo(s)).ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),video sdp:",o),i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,o)}else"audio"!=e||a?"audio"==e&&a?(o=this.roomHandle.selfUser.screen.screenAudio.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),screen audio sdp:",o),i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,o)):"screen"==e&&(o=this.roomHandle.selfUser.screen.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),screen sdp:",o),i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,o)):(o=this.roomHandle.selfUser.audio.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),audio sdp:",o),i=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,o));i&&(i.sdp_version=3);var d=this.cmdProtobufCoded.newRoomResourceInfo(r,this.roomHandle.selfUser.nodeId,i);if("video"==e){var l;s=this.roomHandle.getDeviceIdByUUID(0,r);(l=this.roomHandle.selfUser.getVideo(s))&&(l.resourceInfo=d)}var u=this.cmdProtobufCoded.newUnpubRoomResourceMsg(d,n);log.info("==="+e+" send UNPUB_ROOM_RESOURCE_MSG,orderId:"+n+",resource_id:"+d.resource_id+",owner_id:"+d.owner_id);var c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,u);this.signalingChannel.send(c),this.signalingChannel.send("")},e.prototype.sendVideoStreamControl=function(e,t,r,n,o){t*=1e3;var i=Math.round(t/4),a=this.cmdProtobufCoded.newVideoStreamControlReq(o,this.roomHandle.id,this.roomHandle.selfUser.nodeId,e,t,i,r,n),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_STREAM_CONTROL_REQ,0,this.roomHandle.selfUser.nodeId,0,a);this.signalingChannel.send(s),this.signalingChannel.send("")},e.prototype.updateSpeakerMsg=function(e,t,r){var n=this.roomHandle.setDeviceIdByUUID(2,r.id),o=this.cmdProtobufCoded.newSpeaker(n,r.name,r.status,this.sessionType.Audio),i=this.cmdProtobufCoded.newUpdateSpeakerMsg(e,t,o),a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_SPEAKER_MSG,0,this.roomHandle.selfUser.nodeId,0,i);this.signalingChannel.send(a),this.signalingChannel.send("")},e.prototype.updateWebcamMsg=function(e,t,r){var n=this.roomHandle.setDeviceIdByUUID(0,r.id),o=r.status;r.status!=StreamStatus.none&&r.status!=StreamStatus.opened||(o=1);var i=this.cmdProtobufCoded.newWebcam(n,r.name,o,this.sessionType.Video);i.level=r.level,i.description=r.description;var a=this.cmdProtobufCoded.newUpdateWebcamMsg(e,t,i),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_WEBCAM_MSG,0,this.roomHandle.selfUser.nodeId,0,a);this.signalingChannel.send(s),this.signalingChannel.send("")},e.prototype.updateScreenIdMsg=function(e,t,r){var n=this.cmdProtobufCoded.newDesktop(r.id,r.name,r.status,this.sessionType.ShareScreen);n.level=r.level,n.description=r.description;var o=this.cmdProtobufCoded.newUpdateDesktopMsg(e,t,n),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_DESKTOP_MSG,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(i),this.signalingChannel.send("")},e.prototype.videoIndiction=function(e,t,r){var n=this.resourceOpt.pub;e||(n=this.resourceOpt.unpub);var o=this.cmdProtobufCoded.newResourceIndiction(t,n,r,this.roomHandle.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_INDICTION,0,this.roomHandle.selfUser.nodeId,r,o);this.signalingChannel.send(i)},e.prototype.audioIndiction=function(e,t,r){var n=this.resourceOpt.pub;"pub"==e?n=this.resourceOpt.pub:"unpub"==e?n=this.resourceOpt.unpub:"mute"==e?n=this.resourceOpt.mute:"unmute"==e&&(n=this.resourceOpt.unmute);var o=this.cmdProtobufCoded.newResourceIndiction(t,n,r,this.roomHandle.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.AUDIO_INDICTION,0,this.roomHandle.selfUser.nodeId,r,o);this.signalingChannel.send(i)},e.prototype.sendMessage=function(e,t){var r=new Date;r.setMinutes(r.getMinutes()+r.getTimezoneOffset());var n=r.getTime();n=Math.round(n/1e3);var o=this.cmdProtobufCoded.newTextMsg(e,n),i=this.roomPduType.PUBLIC_TEXT_MSG,a=0;if(void 0!==t&&null!=t&&""!=t){var s=this.roomHandle.getNodeId(t);if(null==s)return!1;a=s,i=this.roomPduType.PRIVATE_TEXT_MSG}var d=this.cmdProtobufCoded.encodedPacket(i,0,this.roomHandle.selfUser.nodeId,a,o);this.signalingChannel.send(d)},e.prototype.sendData=function(e,t){var r=when.defer();if(6e4<e.byteLength){var n=new T(ErrorConstant.data_oversize);r.reject(n)}else{var o=this.cmdProtobufCoded.newData(e),i=this.roomPduType.PUBLIC_DATA,a=0;if(void 0!==t&&null!=t&&""!=t){var s=this.roomHandle.getNodeId(t);null!=s&&(a=s,i=this.roomPduType.PRIVATE_DATA)}var d=this.cmdProtobufCoded.encodedPacket(i,0,this.roomHandle.selfUser.nodeId,a,o);this.signalingChannel.send(d),r.resolve()}return r.promise},e.prototype.sendPrivateDataToUser=function(e,t){var r=when.defer();if(6e4<e.byteLength){var n=new T(ErrorConstant.data_oversize);r.reject(n)}else{var o=this.cmdProtobufCoded.newPrivateDataToUser(this.roomHandle.id,t,e,this.roomHandle.selfUser.id),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PRIVATE_DATA_TO_USER,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(i),r.resolve()}return r.promise},e.prototype.userIndiction=function(e,t){var r=this.roomHandle.getNodeId(t),n=this.cmdProtobufCoded.newUserMsg(r,this.userMsgOpt.kickoff,e),o=this.cmdProtobufCoded.newUserIndiction(this.roomHandle.selfUser.nodeId,this.roomPduType.USER_MSG,n.toArrayBuffer()),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_INDICTION,0,this.roomHandle.selfUser.nodeId,r,o);this.signalingChannel.send(i)},e.prototype.userMsg=function(e,t){var r=this.userMsgOpt.leave;if(t&&(r=this.userMsgOpt.kickoff),this.roomHandle&&this.roomHandle.selfUser&&this.roomHandle.selfUser.nodeId){var n=this.cmdProtobufCoded.newUserMsg(this.roomHandle.selfUser.nodeId,r,e),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_MSG,0,this.roomHandle.selfUser.nodeId,0,n);this.signalingChannel.send(o)}},e.prototype.closeRoom=function(e){var t=this.cmdProtobufCoded.newCloseRoomReq(50,this.roomHandle.getNodeId(e),this.roomHandle.getRoomId()),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CLOSE_ROOM_REQ,0,this.roomHandle.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.videoPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("video",e,t,r):this.pubRoomResourceMsg("video",t.id,null,e,r)},e.prototype.videoUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("video",e,t,r):this.unpublishHandleP2P("video",this.roomHandle.selfUser.subMyVideosP2P,t,e,r)},e.prototype.videoSubscribleHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("video",1,e,t,r):this.subscribleHandleP2P(e)},e.prototype.videoUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("video",0,e,null,t):this.unsubscribleHandleP2P("video",e)},e.prototype.changeSubscribedVideoQuality=function(e,t){if(this.roomHandle.isMcu()){var r=this.cmdProtobufCoded.newModifyResourceReq("60",e,t),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.MODIFY_RESOURCE_REQ,0,this.roomHandle.selfUser.nodeId,0,r);this.signalingChannel.send(n)}},e.prototype.screenPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("screen",e,t,r):this.pubRoomResourceMsg("screen",t.id,null,e,r)},e.prototype.screenAudioPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("audio",e,t,r):this.pubRoomResourceMsg("audio",t.id,null,e,r)},e.prototype.screenUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("screen",e,t,r):this.unpublishHandleP2P("screen",this.roomHandle.selfUser.subMyScreensP2P,t,e,r)},e.prototype.screenAudioUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("audio",e,t,r):this.unpublishHandleP2P("audio",this.roomHandle.selfUser.subMyScreensP2P,t,e,r)},e.prototype.screenSubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("screen",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.screenUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("screen",0,e,null,t):this.unsubscribleHandleP2P("screen",e)},e.prototype.screenAudioSubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.screenAudioUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",0,e,null,t):this.unsubscribleHandleP2P("audio",e)},e.prototype.audioPublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.addSdp("audio",e,t,r):this.pubRoomResourceMsg("audio",t.id,null,e,r)},e.prototype.audioUnpublishHandle=function(e,t,r){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.reduceSdp("audio",e,t,r):this.unpublishHandleP2P("audio",this.roomHandle.selfUser.subMyAudiosP2P,t,e,r)},e.prototype.audioBatchSubscribleHandle=function(e){this.roomHandle.traceablePeerConnection.audioBatchSdp(e)},e.prototype.audioSubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.audioUnsubscribleHandle=function(e,t){this.roomHandle.isMcu()?this.roomHandle.traceablePeerConnection.updateSdp("audio",0,e,null,t):this.unsubscribleHandleP2P("audio",e)},e.prototype.bindAudioToVideo=function(e,t,r){var n=this.cmdProtobufCoded.newBindAudioToVideoReq(e,t,r),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.BIND_AUDIO_TO_VIDEO_REQ,0,this.roomHandle.selfUser.nodeId,0,n);this.signalingChannel.send(o)},e.prototype.sendOfferP2P=function(e,t){log.debug("===sendOfferP2P(),OFFER_REQ");var r=this.cmdProtobufCoded.newOfferReq(0,e,this.roomHandle.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REQ,0,this.roomHandle.selfUser.nodeId,t,r);this.signalingChannel.send(n)},e.prototype.setRemoteP2P=function(e,t){log.debug("===masterServer.setRemoteP2P(),OFFER_REP");var r=this.cmdProtobufCoded.newOfferRep(0,1,"",e,this.roomHandle.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REP,0,this.roomHandle.selfUser.nodeId,t,r);this.signalingChannel.send(n)},e.prototype.sendCandidateMsgP2P=function(e,t){var r=this.cmdProtobufCoded.newCandidateMsg(e.candidate,e.sdpMLineIndex,e.sdpMid,this.roomHandle.selfUser.nodeId),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CANDIDATE_MSG,0,this.roomHandle.selfUser.nodeId,t,r);this.signalingChannel.send(n)},e.prototype.sendSubSdpOfferP2P=function(e,t,r){var n,o=e.info;if(o.stream.sdp=t,"offerSub"==r)log.debug("===masterServer.sendSubSdpOfferP2P(),send P2P SUB_ROOM_RESOURCE_REQ: "+this.roomHandle.selfUser.nodeId+"------\x3e"+o.owner_id),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,this.roomHandle.selfUser.nodeId,o.owner_id,e);else if("answerSub"==r){log.debug("===masterServer.sendSubSdpOfferP2P(),send P2P SUB_ROOM_RESOURCE_REP: "+this.roomHandle.selfUser.nodeId+"------\x3e"+e.sub_node_id);var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",o);n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,this.roomHandle.selfUser.nodeId,e.sub_node_id,i)}this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.sendSubSdpAnswerP2P=function(e,t,r,n){var o;if(t.stream.sdp=r,"offerSub"==e){var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",t);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,this.roomHandle.selfUser.nodeId,n,i)}else if("answerSub"==e){var a=this.cmdProtobufCoded.newSubRoomResourceMsg(t,this.roomHandle.selfUser.nodeId,1);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,n,a)}this.signalingChannel.send(o),this.signalingChannel.send("")},e.prototype.subscribleHandleP2P=function(e){if(this.roomHandle.selfUser.nodeId>e.owner_id){e.stream.sdp="";var t=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,this.roomHandle.selfUser.nodeId);log.info("===masterServer.subscribleHandleP2P(),SUB_ROOM_RESOURCE_REQ");var r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,this.roomHandle.selfUser.nodeId,e.owner_id,t);this.signalingChannel.send(r),this.signalingChannel.send("")}else{t=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,this.roomHandle.selfUser.nodeId);this.roomHandle.traceableP2PPeerConnection.sendSubSdpOfferP2P("offerSub",t)}},e.prototype.unpublishHandleP2P=function(e,t,r,n){if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){var i=t[o];this.roomHandle.traceableP2PPeerConnection.removeStreamP2P(e,i,r),this.roomHandle.selfUser.nodeId>i?this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unpubAnswer",e,i,null):this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unpubOffer",e,i,null)}var a;"video"==e?(a=this.mediaType.video,log.debug("===masterServer.unpublishHandleP2P(),send  video  UNPUB_ROOM_RESOURCE_MSG: "+this.roomHandle.selfUser.nodeId+"------\x3eservice")):"audio"==e?(a=this.mediaType.audio,log.debug("===masterServer.unpublishHandleP2P(),send  audio  UNPUB_ROOM_RESOURCE_MSG: "+this.roomHandle.selfUser.nodeId+"------\x3eservice")):"screen"==e&&(a=this.mediaType.desktop,log.debug("===masterServer.unpublishHandleP2P(),send  screen  UNPUB_ROOM_RESOURCE_MSG: "+this.roomHandle.selfUser.nodeId+"------\x3eservice"));var s=this.cmdProtobufCoded.newMediaStream(r.id,a,null),d=this.cmdProtobufCoded.newRoomResourceInfo(n,this.roomHandle.selfUser.nodeId,s),l=this.cmdProtobufCoded.newUnpubRoomResourceMsg(d),u=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,this.roomHandle.selfUser.nodeId,0,l);this.signalingChannel.send(u),this.signalingChannel.send("")},e.prototype.unsubscribleHandleP2P=function(e,t){this.roomHandle.selfUser.nodeId>t.owner_id?this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unsubAnswer",e,t.owner_id,t):this.roomHandle.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unsubOffer",e,t.owner_id,t)},e.prototype.setRoomControl=function(e,t){var r=this.cmdProtobufCoded.newRoomControl(e,t),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_CONTROL,0,this.roomHandle.selfUser.nodeId,0,r);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.addBoardMsg=function(e,t){var r=t.backgroundColor.split(","),n=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(r[3])),parseInt(r[0]),parseInt(r[1]),parseInt(r[2])),o=t.width,i=t.height;t.width!=t.outputWidth&&(o=t.outputWidth),t.height!=t.outputHeight&&(i=t.outputHeight),log.debug("===masterServer.addBoardMsg(),boardWidth:",o+",boardHeight:",i);var a=this.cmdProtobufCoded.newBoardObject(t.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,o,i,n,t.backgroundImage,null,t.title,t.description,t.extendData),s=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t.id,a),d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,s);this.signalingChannel.send(d),this.signalingChannel.send("")},e.prototype.removeBoardMsg=function(e,t){var r=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t,null),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,r);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.closeBoardMsg=function(e,t){var r=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t,null),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,r);this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.shareBoardMsg=function(e,t,r){log.debug("===masterServer.shareBoardMsg operType: ",e," boardId: ",t);var n=r.backgroundColor.split(","),o=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(n[3])),parseInt(n[0]),parseInt(n[1]),parseInt(n[2])),i=r.width,a=r.height;r.width!=r.outputWidth&&(i=r.outputWidth),r.height!=r.outputHeight&&(a=r.outputHeight);var s=this.cmdProtobufCoded.newBoardObject(r.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,i,a,o,r.backgroundImage,null,r.title,r.description,r.extendData),d=this.cmdProtobufCoded.newUpdateBoardMsg(e,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,t,s),l=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,this.roomHandle.selfUser.nodeId,0,d);this.signalingChannel.send(l),this.signalingChannel.send("")},e.prototype.sendAddAnnotationMessage=function(e,t,r,n,o,i,a){var s=null,d=null,l=null,u=null,c=OperType.add,p=t._rectWithStroke?t._rectWithStroke:{},h=t.shape?t.shape:{},f=t.id,m=parseInt(p.x)?parseInt(p.x):0,g=parseInt(p.y)?parseInt(p.y):0,v=parseInt(p.x+p.width)?parseInt(p.x+p.width):0,y=parseInt(p.y+p.height)?parseInt(p.y+p.height):0,_={type:"",start:null,end:null,pointArray:[]},b=i,S=this.annotationType.annotation_tool_mouse;if(r==shapeTypeEnum.line)S=this.annotationType.annotation_tool_line,_.type="Annotation2Point",_.start=[parseInt(h.x1),parseInt(h.y1)],_.end=[parseInt(h.x2),parseInt(h.y2)];else if(r==shapeTypeEnum.rhomb){S=this.annotationType.annotation_tool_rhomb,_.type="Annotation2Point";var w=parseInt(h.points[0][0]),E=parseInt(h.points[3][1]),I=parseInt(h.points[2][0]),T=parseInt(h.points[1][1]);_.start=[w,E],_.end=[I,T]}else if(r==shapeTypeEnum.polyline)S=this.annotationType.annotation_tool_polyline,_.type="AnnotationMultiPoint",_.pointArray=h.points;else if(r==shapeTypeEnum.ellipse){S=this.annotationType.annotation_tool_ellipse,_.type="Annotation2Point";w=parseInt(h.cx-h.rx),E=parseInt(h.cy-h.ry),I=parseInt(h.cx+h.rx),T=parseInt(h.cy+h.ry);_.start=[w,E],_.end=[I,T]}else r==shapeTypeEnum.rect?(S=this.annotationType.annotation_tool_rectangle,_.type="Annotation2Point",_.start=[parseInt(h.x),parseInt(h.y)],_.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.arrow?(S=this.annotationType.annotation_tool_arrow,_.type="Annotation2Point",_.start=[parseInt(h.x),parseInt(h.y)],_.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.hlight_texttag?(S=this.annotationType.annotation_tool_hlight_texttag,_.type="Annotation2Point",_.start=[parseInt(h.x),parseInt(h.y)],_.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.success?(S=this.annotationType.annotation_tool_success,_.type="Annotation2Point",_.start=[parseInt(h.x),parseInt(h.y)],_.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.failure?(S=this.annotationType.annotation_tool_failure,_.type="Annotation2Point",_.start=[parseInt(h.x),parseInt(h.y)],_.end=[parseInt(h.x+h.width),parseInt(h.y+h.height)]):r==shapeTypeEnum.hlight_point?(S=this.annotationType.annotation_tool_hlight_point,_.type="Annotation2Point",_.start=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)],_.end=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)]):r==shapeTypeEnum.img?(S=this.annotationType.annotation_tool_img,_.type="AnnotationImg",_.im=t):r==shapeTypeEnum.txt&&(S=this.annotationType.annotation_tool_txt,_.type="AnnotationTxt",_.txi=t);var C=function(e){var t=e.split("(")[1].split(")")[0].split(",");4<=t.length||(t[3]=1);return t}(n),R=(n=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(C[3])),parseInt(C[0]),parseInt(C[1]),parseInt(C[2])),null);R=a==fillTypeEnum.full?n:this.cmdProtobufCoded.newcolor(0,255,255,255),log.debug("===masterServer.sendAddAnnotationMessage(),room.boardOutputXRati:"+this.roomHandle.boardOutputXRatio+",room.boardOutputYRatio:"+this.roomHandle.boardOutputYRatio),log.debug("===masterServer.sendAddAnnotationMessage(),minY:",g+",maxY:",y+",minX:"+m+",maxX:"+v);var P=Math.round(g*this.roomHandle.boardOutputYRatio),k=Math.round(y*this.roomHandle.boardOutputYRatio),x=Math.round(m*this.roomHandle.boardOutputXRatio),M=Math.round(v*this.roomHandle.boardOutputXRatio);log.debug("===masterServer.sendAddAnnotationMessage(),outputMinY:",P+",outputMaxY:",k+",outputMinX:"+x+",outputMaxX:"+M);var A=this.cmdProtobufCoded.newRect(P,k,x,M),O=this.cmdProtobufCoded.newAnnotationObject(e,f,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,S,b,o,n,R,A);if("Annotation2Point"==_.type){w=_.start[0],E=_.start[1],I=_.end[0],T=_.end[1];log.debug("===masterServer.sendAddAnnotationMessage(),Annotation2Point startX:"+w+",startY:"+E+",endX:"+I+",endY:"+T);var U=Math.round(w*this.roomHandle.boardOutputXRatio),D=Math.round(E*this.roomHandle.boardOutputYRatio),L=Math.round(I*this.roomHandle.boardOutputXRatio),H=Math.round(T*this.roomHandle.boardOutputYRatio);log.debug("===masterServer.sendAddAnnotationMessage(),Annotation2Point outputStartX:"+U+",outputStartY:"+D+",outputEndX:"+L+",outputEndY:"+H);var N=this.cmdProtobufCoded.newPoint(U,D),B=this.cmdProtobufCoded.newPoint(L,H);s=this.cmdProtobufCoded.newAnnotation2Point(O,N,B)}else if("AnnotationMultiPoint"==_.type){var j=[];log.debug("===masterServer.sendAddAnnotationMessage(),pointObj.pointArray ",_.pointArray);for(var V=0;V<_.pointArray.length;V++){var F=_.pointArray[V];log.debug("===masterServer.sendAddAnnotationMessage(),pointValue:",F);var q=parseInt(F[0]),G=parseInt(F[1]);if(log.debug("===masterServer.sendAddAnnotationMessage(),AnnotationMultiPoint x:"+q+",y:"+G),q&&G){var W=Math.round(q*this.roomHandle.boardOutputXRatio),z=Math.round(G*this.roomHandle.boardOutputYRatio);log.debug("===masterServer.sendAddAnnotationMessage(),AnnotationMultiPoint outputX:"+W+",outputY:"+z);var Y=this.cmdProtobufCoded.newPoint(W,z);j.push(Y)}}d=this.cmdProtobufCoded.newAnnotationMultiPoint(O,j)}else if("AnnotationImg"==_.type){var K=this.newAnnotationImg(_.im);O.arrow||(O.arrow=this.lineArrow.none),O.lineWidth||(O.lineWidth=2),l=this.cmdProtobufCoded.newAnnotationImg(O,K)}else if("AnnotationTxt"==_.type){var X=_.txi.style,J=X.fill,Q=(N=J.indexOf("("),B=J.indexOf(")"),J.slice(N+1,B).split(",")),Z=null;Z=Q.length<4?this.cmdProtobufCoded.newcolor(255,parseInt(Q[0]),parseInt(Q[1]),parseInt(Q[2])):this.cmdProtobufCoded.newcolor(parseInt(255*Q[3]),parseInt(Q[0]),parseInt(Q[1]),parseInt(Q[2]));var $=Math.round(_.txi.getBoundingRect().width*this.roomHandle.boardOutputXRatio),ee=Math.round(_.txi.getBoundingRect().height*this.roomHandle.boardOutputYRatio),te=Math.round(_.txi.position[0]*this.roomHandle.boardOutputXRatio),re=Math.round(_.txi.position[1]*this.roomHandle.boardOutputYRatio),ne=(N=this.cmdProtobufCoded.newPoint(te,re),B=this.cmdProtobufCoded.newPoint(te+$,re+ee),this.cmdProtobufCoded.newTxt(1,X.text)),oe=this.cmdProtobufCoded.newTextInfo(X.fontSize,ne,Z,null,null,null,X.fontStyle,X.fontWeight,X.font);s=this.cmdProtobufCoded.newAnnotation2Point(O,N,B),u=this.cmdProtobufCoded.newAnnotationTxt(s,oe)}var ie=this.cmdProtobufCoded.newUpdateAnnotationMsg(c,e,r,f,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,s,d,null,l,u);this.roomHandle.addAnnotationMsg(ie,!0,void 0,t,f);var ae=this.roomPduType.UPDATE_ANNOTATION_MSG,se=this.cmdProtobufCoded.encodedPacket(ae,0,this.roomHandle.selfUser.nodeId,0,ie);this.signalingChannel.send(se)},e.prototype.sendUpdateAnnotationMessage=function(e,t,r){var n=OperType.update;if(r==shapeTypeEnum.img){var o=this.newAnnotationImg(t),i=this.annotationType.annotation_tool_img,a=this.lineArrow.none,s=this.cmdProtobufCoded.newcolor(0,255,255,255),d=this.cmdProtobufCoded.newcolor(0,255,255,255),l=this.cmdProtobufCoded.newRect(0,0,10,10),u=this.cmdProtobufCoded.newAnnotationObject(e,t.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,i,a,2,s,d,l),c=this.cmdProtobufCoded.newAnnotationImg(u,o),p=this.cmdProtobufCoded.newUpdateAnnotationMsg(n,e,r,t.id,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id,null,null,null,c,null);this.roomHandle.addAnnotationMsg(p,!0,void 0,t,t.id);var h=this.roomPduType.UPDATE_ANNOTATION_MSG,f=this.cmdProtobufCoded.encodedPacket(h,0,this.roomHandle.selfUser.nodeId,0,p);this.signalingChannel.send(f)}},e.prototype.sendRemoveAnnotationMessage=function(e,t,r){var n=r,o=OperType.remove;t==shapeTypeEnum.clear&&(n=null);var i=this.cmdProtobufCoded.newUpdateAnnotationMsg(o,e,t,n,this.roomHandle.selfUser.nodeId,this.roomHandle.selfUser.id);t==shapeTypeEnum.clear?this.roomHandle.addAnnotationMsg(i,!0,!0,void 0,r):this.roomHandle.addAnnotationMsg(i,!0,void 0,void 0,r);var a=this.roomPduType.UPDATE_ANNOTATION_MSG,s=this.cmdProtobufCoded.encodedPacket(a,0,this.roomHandle.selfUser.nodeId,0,i);this.signalingChannel.send(s)},e.prototype.newAnnotationImg=function(e){var t=e.id,r=e.position[0],n=e.position[1];e.customPositionX&&(r=e.customPositionX,n=e.customPositionY);var o=Math.round(r*this.roomHandle.boardOutputXRatio),i=Math.round(n*this.roomHandle.boardOutputYRatio),a=Math.round(e.style.width*e.scale[0]*this.roomHandle.boardOutputXRatio),s=Math.round(e.style.height*e.scale[1]*this.roomHandle.boardOutputYRatio),d=e.zlevel,l=mathPI2degree(e.rotation),u=e.style.image;return this.cmdProtobufCoded.newImgInfo(t,o,i,a,s,d,10,!1,l,u,null)},e.prototype.createServerRecorder=function(e,t,r,n,o,i,a,s,d,l,u,c){var p,h=when.defer(),f=getRandomNum(2e3,8e3);switch(o){case exporterTypeEnum.record:p=this.exporterType.EXPORTER_TYPE_RECORD;break;case exporterTypeEnum.record_real_time:p=this.exporterType.EXPORTER_TYPE_RECORD_REAL_TIME;break;case exporterTypeEnum.liver:p=this.exporterType.EXPORTER_TYPE_LIVER;break;case exporterTypeEnum.avc_media_mixer:p=this.exporterType.EXPORTER_TYPE_AVC_MEDIA_MIXER}var m=this.cmdProtobufCoded.newOutgoingCreateStreamsExporterReq(f,e,t,r,n,p,i,a,s,d,u,!0,0,0,"","",l,c),g=this.roomPduType.OUTGOING_CREATE_STREAMS_EXPORTER_REQ;log.debug("===masterServer.createServerRecorder(),outgoingCreateStreamsExporterReq:",m);var v=this.cmdProtobufCoded.encodedPacket(g,0,this.roomHandle.selfUser.nodeId,0,m);this.signalingChannel.send(v);var y=setTimeout(function(){var e=new T(1e4,"createServerRecorder time out");h.reject(e)},5e3);return this.roomHandle.addCallback(ExporderCallBack.create_server_recorder_rep_success,function(e,t,r,n){if(e==f){var o={exporter_id:t,exporter_name:r,play_urls:n};h.resolve(o),clearTimeout(y)}}),this.roomHandle.addCallback(ExporderCallBack.create_server_recorder_rep_error,function(e,t){t==f&&(h.reject(e),clearTimeout(y))}),h.promise},e.prototype.selectStream4Exporter=function(e,t,r,n,o,i,a){var s=when.defer(),d=getRandomNum(2e3,8e3),l=this.cmdProtobufCoded.newOutgoingSelectStreamReq(d,e,t,r,n,o,i,a),u=this.roomPduType.OUTGOING_SELECT_STREAM_REQ,c=this.cmdProtobufCoded.encodedPacket(u,0,this.roomHandle.selfUser.nodeId,0,l);this.signalingChannel.send(c);var p=setTimeout(function(){var e=new T(1e4,"selectStream4Exporter time out");s.reject(e)},5e3);return this.roomHandle.addCallback(ExporderCallBack.select_stream_rep_success,function(e,t){if(e==d){var r={exporter_id:t};s.resolve(r),clearTimeout(p)}}),this.roomHandle.addCallback(ExporderCallBack.select_stream_rep_error,function(e,t){t==d&&(s.reject(e),clearTimeout(p))}),s.promise},e.prototype.mixMedia4Exporter=function(e,t,r,n,o,i){log.debug("===masterServer.mixMedia4Exporter(),videoItems:",n);var a,s=when.defer(),d=getRandomNum(2e3,8e3),l=[];if(log.debug("===masterServer.mixMedia4Exporter(),videoItems:",n),n&&0<n.length)for(var u=0;u<n.length;u++){var c=n[u];log.debug("===masterServer.mixMedia4Exporter(),videoItem:",c);var p=c.userId,h=c.zorder,f=c.x,m=c.y,g=c.width,v=c.height,y=c.deviceId,_=c.videoData,b=this.cmdProtobufCoded.newOutgoingVideoInfo(p,h,f,m,g,v,y,_);log.debug("===masterServer.mixMedia4Exporter(),videoInfo:",b),l.push(b)}r==viewLayoutModeEnum.fixation?a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Fixation:r==viewLayoutModeEnum.auto?a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto:r==viewLayoutModeEnum.auto_orato&&(a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto_Orato);var S=this.cmdProtobufCoded.newOutgoingMixStreamsReq(d,e,t,a,l,o,i);log.debug("===masterServer.mixMedia4Exporter(),mixStreamsReq:",S);var w=this.roomPduType.OUTGOING_MIX_STREAMS_REQ,E=this.cmdProtobufCoded.encodedPacket(w,0,this.roomHandle.selfUser.nodeId,0,S);this.signalingChannel.send(E);var I=setTimeout(function(){var e=new T(1e4,"mixMedia4Exporter time out");s.reject(e)},5e3);return this.roomHandle.addCallback(ExporderCallBack.mix_media_rep_success,function(e,t){if(e==d){var r={exporter_id:t};s.resolve(r),clearTimeout(I)}}),this.roomHandle.addCallback(ExporderCallBack.mix_media_rep_error,function(e,t){t==d&&(s.reject(e),clearTimeout(I))}),s.promise},e.prototype.pauseResumeExporter=function(e,t,r,n){var o=when.defer(),i=getRandomNum(2e3,8e3),a=this.cmdProtobufCoded.newOutgoingPauseResumeExporterReq(i,e,t,r,n),s=this.roomPduType.OUTGOING_PAUSE_RESUME_EXPORTER_REQ,d=this.cmdProtobufCoded.encodedPacket(s,0,this.roomHandle.selfUser.nodeId,0,a);this.signalingChannel.send(d);var l=setTimeout(function(){var e=new T(1e4,"pauseResumeExporter time out");o.reject(e)},5e3);return this.roomHandle.addCallback(ExporderCallBack.pause_stream_rep_success,function(e,t){if(e==i){var r={exporter_id:t};o.resolve(r),clearTimeout(l)}}),this.roomHandle.addCallback(ExporderCallBack.pause_stream_rep_error,function(e,t){t==i&&(o.reject(e),clearTimeout(l))}),o.promise},e.prototype.destroyExporter=function(e,t,r){var n=when.defer(),o=getRandomNum(2e3,8e3),i=this.cmdProtobufCoded.newOutgoingDestroyExporterReq(o,e,t,r),a=this.roomPduType.OUTGOING_DESTROY_EXPORTER_REQ,s=this.cmdProtobufCoded.encodedPacket(a,0,this.roomHandle.selfUser.nodeId,0,i);this.signalingChannel.send(s);var d=setTimeout(function(){var e=new T(1e4,"destroyExporter time out");n.reject(e)},5e3);return this.roomHandle.addCallback(ExporderCallBack.stop_stream_rep_success,function(e,t){if(e==o){var r={exporter_id:t};n.resolve(r),clearTimeout(d)}}),this.roomHandle.addCallback(ExporderCallBack.stop_stream_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(d))}),n.promise},e.prototype.updateExporterStreamName=function(e){var r=when.defer(),n=getRandomNum(8e3,9e3),t=this.roomHandle.setDeviceIdByUUID(0,e.id),o=this.cmdProtobufCoded.newRoomSetStreamNameReq(n,this.roomHandle.id,e.ownerId,t,e.streamName,e.streamNickName),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_SET_STREAM_NAME_REQ,0,this.roomHandle.selfUser.nodeId,0,o);this.signalingChannel.send(i),this.signalingChannel.send("");var a=setTimeout(function(){var e=new T(1e4,"updateExporterStreamName time out");r.reject(e)},5e3);return this.roomHandle.addCallback(UserCallback.room_set_stream_name_rep_success,function(e){e==n&&(r.resolve(),clearTimeout(a))}),this.roomHandle.addCallback(UserCallback.room_set_stream_name_rep_error,function(e,t){t==n&&(r.reject(e),clearTimeout(a))}),r.promise},e.prototype.outgoingExporterSetFocusVideo=function(e,t,r){var n=when.defer(),o=getRandomNum(8e3,9e3),i=this.cmdProtobufCoded.newOutgoingExporterSetFocusVideoReq(o,this.roomHandle.id,e,t,r),a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ,0,this.roomHandle.selfUser.nodeId,0,i);this.signalingChannel.send(a),this.signalingChannel.send("");var s=setTimeout(function(){var e=new T(1e4,"outgoingExporterSetFocusVideo time out");n.reject(e)},5e3);return this.roomHandle.addCallback(ExporderCallBack.set_focus_video_rep_success,function(e){e==o&&(n.resolve(),clearTimeout(s))}),this.roomHandle.addCallback(ExporderCallBack.set_focus_video_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(s))}),n.promise},e.prototype.outgoingGetExporterInfo=function(e,t,r){var n=when.defer(),o=getRandomNum(8e3,9e3),i=this.cmdProtobufCoded.newOutgoingGetExporterInfoReq(o,e,t,r);log.debug("===masterServer.outgoingGetExporterInfo(),outgoingGetExporterInfoReq:",i);var a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_GET_EXPORTER_INFO_REQ,0,this.roomHandle.selfUser.nodeId,0,i);this.signalingChannel.send(a),this.signalingChannel.send("");var s=setTimeout(function(){var e=new T(1e4,"outgoingGetExporterInfo time out");n.reject(e)},5e3);return this.roomHandle.addCallback(ExporderCallBack.get_exporter_info_rep_success,function(e,t,r){e==o&&(n.resolve(t,r),clearTimeout(s))}),this.roomHandle.addCallback(ExporderCallBack.get_exporter_info_rep_error,function(e,t){t==o&&(n.reject(e),clearTimeout(s))}),n.promise},e}),ModuleBase.define("P2PServer",["TraceableP2PPeerConnection"],function(e){var t=function(){this.selfNodeIntervalId=null,this.traceableP2PPeerConnection=new e,room.traceableP2PPeerConnection=this.traceableP2PPeerConnection};function r(e){room.selfUser.nodeId<e&&(null!=this.selfNodeIntervalId&&(clearInterval(this.selfNodeIntervalId),this.selfNodeIntervalId=null),room.traceableP2PPeerConnection.getToP2PPeerConnection(e))}return t.prototype.createP2PPeerConnection=function(e){null!=room.selfUser&&null!=room.selfUser.nodeId?r(e):this.selfNodeIntervalId=setInterval(function(){null!=room.selfUser&&null!=room.selfUser.nodeId&&r(e)},200)},t});var log=log4javascript.getLogger(),avdEngineHandle,remoteSDPInit;function getFingerPrint(e){var t=null;console.log(e);for(var r=e.split("\r\n"),n=0;n<r.length;n++)if(-1<r[n].indexOf("a=fingerprint")){t=r[n].split(" ")[1];break}return console.log(t),t}function updateSDPFingerPrint(e,t){var r=preferLineSdp(e,"a=","fingerprint");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=fingerprint:sha-1 "+t)}return e}function updateSDPIceUfrag(e,t){var r=preferLineSdp(e,"a=","ice-ufrag");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-ufrag:"+t)}return e}function updateSDPIcePwd(e,t){var r=preferLineSdp(e,"a=","ice-pwd");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=ice-pwd:"+t)}return e}function updateSDPSetup(e,t){var r=preferLineSdp(e,"a=","setup");if(null!=r&&0<r.length)for(var n=0;n<r.length;n++){var o=r[n];e=e.replace(o,"a=setup:"+t)}return e}function preferLineSdp(e,t,r){var n=[],o=e.split("\r\n"),i=findLine(o,t,r);if(null!=i&&0<i.length)for(var a=0;a<i.length;a++)n.push(o[i[a]]);return n}function findLine(e,t,r){return findLineInRange(e,0,-1,t,r)}function findLineInRange(e,t,r,n,o){for(var i=[],a=-1!==r?r:e.length,s=t;s<a;++s)0===e[s].indexOf(n)&&(o&&-1===e[s].toLowerCase().indexOf(o.toLowerCase())||i.push(s));return i}function findLine1(e,t,r){return findLineInRange1(e,0,-1,t,r)}function findLineInRange1(e,t,r,n,o){for(var i=-1!==r?r:e.length,a=t;a<i;++a)if(0===e[a].indexOf(n)&&(!o||-1!==e[a].toLowerCase().indexOf(o.toLowerCase())))return a;return null}function preferBitRate(e,t,r){if(null==t||t<=0)return-1===e.indexOf("b=AS:")||(e=e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")),e;var n=e.split("\r\n"),o=findLine1(n,"m=",r);if(null===o)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;var i=findLineInRange1(n,o+1,-1,"m=");null===i&&(i=n.length);var a=findLineInRange1(n,o+1,i,"c=");if(null===a)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=findLineInRange1(n,a+1,i,"b=AS");s&&n.splice(s,1);var d="b=AS:"+t;return n.splice(a+1,0,d),e=n.join("\r\n")}function addAudioNack(e,t){var r=e.split("\r\n"),n=findLine(r,"m=","audio");if(null===n)return console.log("addAudioNack(),Failed to add audio nack line to sdp, as no m-line found"),e;var o=findLineInRange1(r,n+1,-1,"m=");null===o&&(o=r.length);for(var i,a=!1,s=null,d=n;d<o;++d)if(0<=r[d].indexOf(t)){s=r[d].split(" ")[0].split(":")[1],i=d;break}if(s){var l="a=rtcp-fb:"+s+" nack";for(d=n;d<o;++d)if(0<=r[d].indexOf(l)){a=!0;break}a||(r.splice(i+1,0,l),e=r.join("\r\n"))}return e}ModuleBase.define("AVDEngine",["Room","RestServer","Error","BrowserDetect","Record","Live","Outgoing","StreamExporterManager","ElectronManager","RtmManager","InviteManager"],function(n,e,c,t,r,o,i,a,s,d,l){var u=function(){this.avdVersion="4.0.7.9",this.accessToken,this.clientIsUseCascade=!1,this.restServerInfo={mcuServerUrl:null,clusterRestAddr:null,roomServerUrl:null,iceServers:null,stunUrl:null,trunUrl:null,iceusername:null,iceCredential:null,isCluster:!1,protocolStr:document.location.protocol,notQueryGetMcu:!1,masterVersion:null,masterPackageVersion:null,boxVersion:null,boxPackageVersion:null,signalData:null,iv:"0000000000000000"},"httpsionic:"==this.restServerInfo.protocolStr&&(this.restServerInfo.protocolStr="https:"),"http:"!=this.restServerInfo.protocolStr&&"https:"!=this.restServerInfo.protocolStr&&"httpsionic:"!=this.restServerInfo.protocolStr&&(this.restServerInfo.protocolStr="http:"),this.loggerReportConfig=null,this.loggerReport=null,this.logReportWait=[],this.connectionStatisticsConfig=null,this.browserDetect,this.levelValue=log4javascript.Level.INFO.level,this.appSign=null,this.appFunName=null,this.bugout=null,this.supperStrongWeakNetWork=!1,this.videoCoding=VideoCodingType.H264,this.audioCoding=AudioCodingType.opus,this.audioAutoSub=!0,this.audioBatchEnabled=!1,this.enableEchoCancellation=!0,this.enableNoiseSuppression=!0,this.enableAutoGainControl=!0,this.simulcastEnabled=!1,this.dataCrypto=DataCryptoType.AES128,this.mediaConnectType=0,this.cameraMap={},this.microphoneMap={},this.speakerMap={},this.hasCamera=!1,this.hasMicrophone=!1,this.hasSpeaker=!1,this.checkVideoStream=null,this.checkAudioStream=null,this.checkAudioLocalStatsCollector=null,this.checkMicrophoneId=null,this.checkMicrophoneName=null,this.mcuClusterRouteParams=null,this.defaultVideoParamsWidth=640,this.defaultVideoParamsHeight=480,this.defaultVideoParamsResolutionSetType=ResolutionSetType.ideal,this.defaultVideoParamsFrameRate=20,this.defaultScreenParamsWidth=1920,this.defaultScreenParamsHeight=1080,this.defaultScreenParamsFrameRate=10,this.defaultMediaPublishKeepAliveTime=15e3,this.detect=this.getBrowserDetect(),this.browserName=this.detect.browser.name,this.fullVersion=this.detect.browser.fullVersion,this.majorVersion=this.fullVersion.split(".")[0],this.browserOsName=this.detect.osName,this.isChrome=this.detect.isChrome,this.isOpera=this.detect.isOpera,this.isIE=this.detect.isIE,this.isFirefox=this.detect.isFirefox,this.isSafari=this.detect.isSafari,this.isMicroMessenger=this.detect.isMicroMessenger,this.isUCBrowser=this.detect.isUCBrowser,this.clientResource=new Object,this.restFullProtocol=null,this.applyToElectron=!1,this.electronProtocol="http:",this.electronManager=null,this.appender=new log4javascript.BrowserConsoleAppender,this.appender.setThreshold(log4javascript.Level.INFO),h(this.appender),this.loggerReport=new LoggerReport,this.eventEmitter=new EventEmitter,this.deviceChangeListener(),this.rooms=[],this.eraserCustomIconPath="",this.ignoreModifyResourceReq=!1,this.enableHardwareEncoding=!1,this.isSafari&&this.fullVersion&&"15"==this.fullVersion.split(".")[0]&&"1"==this.fullVersion.split(".")[1]&&(this.videoCoding=VideoCodingType.VP8),(this.isChrome&&"Android"==this.detect.osName||this.isMicroMessenger&&"Android"==this.detect.osName)&&(log.debug("===avdEngine, Android Chrome or Android MM detected, set default video codec to VP8"),this.videoCoding=VideoCodingType.VP8),log.info("===avdEngine, browserName:"+this.browserName+", fullVersion:"+this.fullVersion+", checkBrowserSupport:"+this.checkBrowserSupport()+", GetUserMedia:"+this.detect.getUserMediaSupport+", RTCPeerConnection:"+this.detect.RTCPeerConnectionSupport+", WebSocket:"+this.detect.WebSocketSupport),avdEngineHandle=this};function p(e,t){for(var r=null,n=0;n<t.length;n++){var o=t[n];if(o.id==e){r=o;break}}return r}function h(e){var t=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n");e.setLayout(t),log.addAppender(e)}return u.prototype.getVersion=function(){return"rtc-"+this.avdVersion},u.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},u.prototype.setApplyToElectron=function(e,t){log.info("===avdEngine.setApplyToElectron(),islectron:"+e+",protocolStr:"+t),this.logReportWait.push("avdEngine.setApplyToElectron(),islectron:"+e+",protocolStr:"+t),e&&(this.applyToElectron=e),t&&(this.electronProtocol=t,this.restServerInfo.protocolStr=t)},u.prototype.setRestFullProtocol=function(e){log.info("===avdEngine.setRestFullProtocol(),protocolStr:"+e),e&&(this.restFullProtocol=e)},u.prototype.getElectronManager=function(){return this.electronManager=new s,this.electronManager},u.prototype.setSimulcastEnabled=function(e){this.isChrome&&this.majorVersion<73?(this.simulcastEnabled=!1,log.info("===avdEngine.setSimulcastEnabled(),当前Chromer版本小于73，不支持视频多流功能"),this.logReportWait.push("avdEngine.setSimulcastEnabled(),当前Chromer版本小于73，不支持视频多流功能")):this.isFirefox?(this.simulcastEnabled=!1,log.info("===avdEngine.setSimulcastEnabled(),当前为firefox浏览器，不支持视频多流功能")):(this.simulcastEnabled=e,log.info("===avdEngine.setSimulcastEnabled(),设置视频是否开启多流:"+e),this.logReportWait.push("avdEngine.setSimulcastEnabled(),设置视频是否开启多流:"+e))},u.prototype.getSimulcastEnabled=function(){return this.simulcastEnabled},u.prototype.setAudioBatchEnabled=function(e){this.audioBatchEnabled=e,log.info("===avdEngine.setAudioBatchEnabled(),音频自动订阅时,多路音频是否开启批量订阅处理:"+e),this.logReportWait.push("avdEngine.setAudioBatchEnabled(),音频自动订阅时,多路音频是否开启批量订阅处理:"+e)},u.prototype.getAudioBatchEnabled=function(){return this.audioBatchEnabled},u.prototype.getBrowserDetect=function(){return this.browserDetect||(this.browserDetect=new t),this.browserDetect.detect},u.prototype.checkBrowserSupport=function(){return this.browserDetect||(this.browserDetect=new t),this.browserDetect.checkBrowserSupport()},u.prototype.checkBrowserPluginSupport=function(){return this.browserDetect||(this.browserDetect=new t),this.browserDetect.checkBrowserPluginSupport()},u.prototype.setLog=function(e,t){e==Appender.alert?this.appender=new log4javascript.AlertAppender:e==Appender.inpage?this.appender=new log4javascript.InPageAppender:e==Appender.popup?this.appender=new log4javascript.PopUpAppender:Appender.browserConsole,t==LogLevel.all?(this.levelValue=log4javascript.Level.ALL.level,this.appender.setThreshold(log4javascript.Level.ALL)):t==LogLevel.trace?(this.levelValue=log4javascript.Level.TRACE.level,this.appender.setThreshold(log4javascript.Level.TRACE)):t==LogLevel.debug?(this.levelValue=log4javascript.Level.DEBUG.level,this.appender.setThreshold(log4javascript.Level.DEBUG)):t==LogLevel.info?(this.levelValue=log4javascript.Level.INFO.level,this.appender.setThreshold(log4javascript.Level.INFO)):t==LogLevel.warn?(this.levelValue=log4javascript.Level.WARN.level,this.appender.setThreshold(log4javascript.Level.WARN)):t==LogLevel.error?(this.levelValue=log4javascript.Level.ERROR.level,this.appender.setThreshold(log4javascript.Level.ERROR)):t==LogLevel.fatal?(this.levelValue=log4javascript.Level.FATAL.level,this.appender.setThreshold(log4javascript.Level.FATAL)):t==LogLevel.off&&(this.levelValue=log4javascript.Level.OFF.level,this.appender.setThreshold(log4javascript.Level.OFF)),h(this.appender)},u.prototype.setBugout=function(e){this.bugout=new debugout,this.bugout.realTimeLoggingOn=!1,this.bugout.useTimestamps=!0,e&&(this.bugout.logFilename=e,log.info("===avdEngine.setBugout(),logFilename:"+e),this.logReportWait.push("avdEngine.setBugout(),logFilename:"+e))},u.prototype.setReportLogger=function(e,t){"string"==typeof e?"function"==typeof t?(this.appSign=e,this.appFunName=t):log.error("===avdEngine.setReportLogger(),appFunName setting invalid"):log.error("===avdEngine.setReportLogger(),appSign setting invalid")},u.prototype.setVideoCoding=function(e){var t=when.defer();if(void 0===e){log.error("===avdEngine.setVideoCoding(),设置视频编解码失败。videoCodingType："+e);var r=new c(ErrorConstant.set_videCoding_failed);t.reject(r)}else{var n=!1,o="";if(this.isSafari&&this.fullVersion&&"15"==this.fullVersion.split(".")[0]&&"1"==this.fullVersion.split(".")[1]&&e==VideoCodingType.H264&&(n=!0,o="In Safari 15.1.X, H264 encoding may cause page crash. Therefore, you are advised to set it to VP8"),n)log.error("===avdEngine.setVideoCoding(),设置视频编解码失败."+o),(r=new c(ErrorConstant.set_videCoding_failed)).message=r.message+","+o,t.reject(r);else this.videoCoding=e,log.info("===avdEngine.setVideoCoding(),设置视频编解码:"+this.videoCoding),this.logReportWait.push("avdEngine.setVideoCoding(),设置视频编解码:"+this.videoCoding),t.resolve()}return t.promise},u.prototype.getVideoCoding=function(){return this.videoCoding},u.prototype.setAudioCoding=function(e){var t=when.defer();if(void 0===e){log.error("===avdEngine.setAudioCoding(),设置音频编解码失败。audioCodingType："+e);var r=new c(ErrorConstant.set_audioCoding_failed);t.reject(r)}else{var n=!1,o="";if(this.isChrome&&110<=this.majorVersion&&(e!=AudioCodingType.ISAC_16k&&e!=AudioCodingType.ISAC_32k||(n=!0,o="Chrome version 110 no longer supports ISAC")),this.isFirefox&&(e!=AudioCodingType.ISAC_16k&&e!=AudioCodingType.ISAC_32k||(n=!0,o="Firefox no longer supports ISAC")),this.isSafari&&e==AudioCodingType.ISAC_32k&&(n=!0,o="Safari no longer supports ISAC_32K"),n)log.error("===avdEngine.setAudioCoding(),设置音频编解码失败."+o),(r=new c(ErrorConstant.set_audioCoding_failed)).message=r.message+","+o,t.reject(r);else this.audioCoding=e,log.info("===avdEngine.setAudioCoding(),设置音频编解码:"+this.audioCoding),this.logReportWait.push("avdEngine.setAudioCoding(),设置音频编解码:"+this.audioCoding),t.resolve()}return t.promise},u.prototype.getAudioCoding=function(){return this.audioCoding},u.prototype.setAudioAutoSub=function(e){this.audioAutoSub=e,log.info("===avdEngine.setAudioAutoSub(),设置音频自动订阅:"+e),this.logReportWait.push("avdEngine.setAudioAutoSub(),设置音频自动订阅:"+e)},u.prototype.getAudioAutoSub=function(){return this.audioAutoSub},u.prototype.setMediaConnectType=function(e){this.mediaConnectType=e,log.info("===avdEngine.setMediaConnectType(),设置媒体通道协议:"+this.mediaConnectType),this.logReportWait.push("avdEngine.setMediaConnectType(),设置媒体通道协议:"+this.mediaConnectType)},u.prototype.getMediaConnectType=function(){return this.mediaConnectType},u.prototype.setDataCryptoType=function(e){void 0===e?log.error("===avdEngine.setDataCryptoType(),设置数据加密类型失败。dataCryptoType："+e):(this.dataCrypto=e,log.info("===avdEngine.setDataCryptoType(),设置数据加密类型:"+this.dataCrypto),this.logReportWait.push("avdEngine.setDataCryptoType(),设置数据加密类型:"+this.dataCrypto))},u.prototype.getDataCryptoType=function(){return this.dataCrypto},u.prototype.getResolutionEnum=function(){var e=when.defer();return e.resolve(Resolution),e.promise},u.prototype.setMcuClusterRouteParams=function(e){this.mcuClusterRouteParams=e},u.prototype.setDefaultVideoParams=function(e,t,r,n){e&&(this.defaultVideoParamsWidth=e),t&&(this.defaultVideoParamsHeight=t),r&&(this.defaultVideoParamsResolutionSetType=r),n&&(this.defaultVideoParamsFrameRate=n),log.info("===avdEngine.setDefaultVideoParams(),设置视频相关的默认参数值,分辨率宽:"+e+",分辨率高:"+t+",分辨率设置类型:"+r+",视频帧率:"+n),this.logReportWait.push("avdEngine.setDefaultVideoParams(),设置视频相关的默认参数值,分辨率宽:"+e+",分辨率高:"+t+",分辨率设置类型:"+r+",视频帧率:"+n)},u.prototype.setDefaultScreenParams=function(e,t,r,n){e&&(this.defaultScreenParamsWidth=e),t&&(this.defaultScreenParamsHeight=t),n&&(this.defaultScreenParamsFrameRate=n),log.info("===avdEngine.setDefaultScreenParams(),设置桌面共享相关的默认参数值, 分辨率最大宽度:"+e+", 分辨率最大高度:"+t+", 最小帧率:"+r+", 最大帧率:"+n),this.logReportWait.push("avdEngine.setDefaultScreenParams(),设置桌面共享相关的默认参数值,分辨率最大宽度:"+e+",分辨率最大高度:"+t+",最小帧率:"+r+",最大帧率:"+n)},u.prototype.setDefaultMediaPublishKeepAliveTime=function(e){e&&(this.defaultMediaPublishKeepAliveTime=e),log.info("===avdEngine.setDefaultMediaPublishKeepAliveTime(),设置媒体流发布的保活时长(单位为毫秒), keepAliveTime:"+e)},u.prototype.init=function(e,t,r){var n=this,o=when.defer();if(void 0===r&&(r=!1),log.info("===avdEngine.init(),引擎初始化开始, serverURI:"+e+", accessToken:"+t+", isUseCascade:"+r),this.logReportWait.push("avdEngine.init(),引擎初始化开始, serverURI:"+e+", accessToken:"+t+", isUseCascade:"+r),!t||!e){var i=new c(ErrorConstant.avdEngine_init_failed);return log.error("===avdEngine.init(), error, code:"+i.code+", message:"+i.message),o.reject(i),o.promise}this.restServerInfo.mcuServerUrl=e,this.clientIsUseCascade=r,this.accessToken=t.replace(/%3D%3D/g,"=="),this.accessToken=this.accessToken.replace(/%3d%3d/g,"==");var a={};a.userAgent=navigator.userAgent;var s=new UAParser(navigator.userAgent);if(s){var d=s.getOS();d&&(n.clientResource.os=d.name+"_"+d.version);var l=s.getBrowser();l&&(a.browser=l.name+"_"+l.version)}if(n.detect.browser.isCustomized&&(a.browserShell=n.detect.browser.shellName+"_"+n.detect.browser.shellFullVersion),n.clientResource.endpoint=a,void 0!==navigator.Promise&&getLocalClientIP().then(function(e){log.debug("===avdEngine.init(),localClientIP:",e),n.clientResource.ips=e}),void 0!==navigator.connection){var u=getEffectiveType();log.debug("===avdEngine.init(),effectiveType:"+u),n.clientResource.net=u}return log.debug("===avdEngine.init(),clientResource:"+JSON.stringify(n.clientResource)),log.info("===avdEngine.init(),引擎初始化成功"),this.logReportWait.push("引擎初始化成功！"),o.resolve(),o.promise},u.prototype.initWithOEM=function(e,t){var r=when.defer();if(log.info("===avdEngine.initWithOEM(), OEM  init begin"),"qiniu.com"!=t){var n=new c(ErrorConstant.oemname_notfound);r.reject(n)}else this.restServerInfo.mcuServerUrl=e,this.restServerInfo.roomServerUrl=e,this.restServerInfo.isCluster=!0,r.resolve();return r.promise},u.prototype.obtainRoom=function(e){if(null!=e&&""!=e){if("string"==typeof e){var t=p(e,this.rooms);return null==t&&(t=new n(e),this.rooms.push(t)),t}r=new c(ErrorConstant.exporter_parameter_type_error);log.error("===avdEngine.obtainRoom() error, code:"+r.code+", message:"+r.message+"[roomId需字符串类型]")}else{var r=new c(ErrorConstant.roomId_required);log.error("===avdEngine.obtainRoom() error, code:"+r.code+", message:"+r.message)}},u.prototype.getRoom=function(e){if(null!=e&&""!=e){if("string"==typeof e)return p(e,this.rooms);t=new c(ErrorConstant.exporter_parameter_type_error);log.error("===avdEngine.getRoom() error, code:"+t.code+", message:"+t.message+"[roomId需字符串类型]")}else{var t=new c(ErrorConstant.roomId_required);log.error("===avdEngine.getRoom() error, code:"+t.code+", message:"+t.message)}},u.prototype.getAllDevices=function(){var t=when.defer();if(void 0!==navigator.mediaDevices)log.debug("===avdEngine.getAllDevices(), by navigator.mediaDevices.enumerateDevices()"),navigator.mediaDevices.enumerateDevices().then(function(e){t.resolve(e)});else if("undefined"!=typeof MediaStreamTrack)if(void 0!==MediaStreamTrack.getSources)log.debug("===avdEngine.getAllDevices(),by MediaStreamTrack.getSources"),MediaStreamTrack.getSources(function(e){t.resolve(e)});else{var e=new c(ErrorConstant.navigatorUserMediaError_notSupportedError);t.reject(e)}else{e=new c(ErrorConstant.not_support_mediaStreamTrack);t.reject(e)}return t.promise},u.prototype.initDevice=function(){var n=when.defer(),r=this;if(log.info("===avdEngine.initDevice():Camera and Microphone begin..."),r.isChrome&&r.majorVersion<81)r.initDeviceHandler().then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)});else if(r.isFirefox){var e={audio:{deviceId:"undefined"},video:{deviceId:"undefined"}};log.debug("===avdEngine.initDevice(),firefox constraints:"+JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(t){r.initDeviceHandler().then(function(e){t&&(t.getTracks().forEach(function(e){e.stop()}),t=null),n.resolve(e)}).otherwise(function(e){n.reject(e)})}).catch(function(e){log.error("===avdEngine.initDevice(),navigator.MediaDevices.getUserMedia of firfox error: ",e.message,e.name);var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),n.reject(t)})}else r.checkDevice().then(function(e){if(e.deviceIdIsUndefined){log.debug("===AVDEngine.initDevice(),chrome Version >= 81 or Other browsers ,deviceId is Undefined");var t={};if(e.video&&(t.video={deviceId:"undefined"}),e.audio&&(t.audio={deviceId:"undefined"}),log.debug("===avdEngine.initDevice(),chrome version>=81 or Other browsers,constraints:"+JSON.stringify(t)),!e.video&&!e.audio)return n.resolve(1),n.promise;navigator.mediaDevices.getUserMedia(t).then(function(e){e&&(e.getTracks().forEach(function(e){e.stop()}),e=null),r.initDeviceHandler().then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)})}).catch(function(e){log.error("===avdEngine.initDevice(),navigator.MediaDevices.getUserMedia error: ",e.message,e.name);var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),n.reject(t)})}else log.debug("===AVDEngine.initDevice(),chrome Version >= 81 or Other browsers,deviceId is not Undefined"),r.initDeviceHandler().then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)})}).otherwise(function(e){n.reject(e)});return n.promise},u.prototype.initDeviceHandler=function(){var _=when.defer(),b=this;return this.getAllDevices().then(function(e){for(var t={},r=0,n={},o=0,i=null,a=null,s={},d=0,l=null,u=null,c=0;c!=e.length;++c){var p=e[c],h=p.deviceId||p.id;if("videoinput"===p.kind||"video"===p.kind)b.hasCamera=!0,r+=1,t[h]=p.label||"camera"+r;else if("audioinput"===p.kind||"audio"===p.kind){if(b.hasMicrophone=!0,"default"==p.deviceId)i=p.label.split(" - ")[1],a=p.groupId;else p.groupId==a&&p.label==i&&(o+=1,n[h]=p.label||"microphone"+o),p.groupId!=a&&(o+=1,n[h]=p.label||"microphone"+o)}else if("audiooutput"===p.kind){if(b.hasSpeaker=!0,"default"==p.deviceId)l=p.label.split(" - ")[1],u=p.groupId;else p.groupId==u&&p.label==l&&(d+=1,s[h]=p.label||"speaker"+d),p.groupId!=u&&(d+=1,s[h]=p.label||"speaker"+d)}}for(var f in b.cameraMap=t,log.info("===avdEngine.initDevice(),Camera finish,cameraMap:",JSON.stringify(t)),b.clientResource.cameras=[],t){var m=t[f],g=new Object;g.id=f,g.name=m,b.clientResource.cameras.push(g)}for(var f in b.microphoneMap=n){m=n[f];b.checkMicrophoneId||(b.checkMicrophoneId=f,b.checkMicrophoneName=m);break}for(var f in log.info("===avdEngine.initDevice(),Microphone finish,microphoneMap:",JSON.stringify(n)),b.clientResource.microphones=[],n){m=n[f];var v=new Object;v.id=f,v.name=m,b.clientResource.microphones.push(v)}for(var f in b.speakerMap=s,log.info("===avdEngine.initDevice(),Speaker finish,speakerMap:",JSON.stringify(s)),b.clientResource.speakers=[],s){m=s[f];var y=new Object;y.id=f,y.name=m,b.clientResource.speakers.push(y)}_.resolve(1)}).otherwise(function(e){log.error("===avdEngine.initDevice() error, code:"+e.code+"; message:"+e.message),_.reject(e)}),_.promise},u.prototype.refreshDevice=function(){var e=when.defer(),g=this,v=[];for(key in g.microphoneMap)v.push(key);var y=[];for(key in g.cameraMap)y.push(key);return this.getAllDevices().then(function(e){for(var t={},r=0,n={},o=0,i=null,a=null,s={},d=0,l=null,u=null,c=0;c!=e.length;++c){var p=e[c],h=p.deviceId||p.id;if("videoinput"===p.kind||"video"===p.kind)r+=1,t[h]=p.label||"camera"+r;else if("audioinput"===p.kind||"audio"===p.kind){if("default"==p.deviceId)i=p.label.split(" - ")[1],a=p.groupId;else p.groupId==a&&p.label==i&&(o+=1,n[h]=p.label||"microphone"+o),p.groupId!=a&&(o+=1,n[h]=p.label||"microphone"+o)}else if("audiooutput"===p.kind){if("default"==p.deviceId)l=p.label.split(" - ")[1],u=p.groupId;else p.groupId==u&&p.label==l&&(d+=1,s[h]=p.label||"speaker"+d),p.groupId!=u&&(d+=1,s[h]=p.label||"speaker"+d)}}for(var f in function(e,t,r,n){var o=[];for(var i in t)o.push(i);var a=arrayUtil.inANotInB(o,e),s=arrayUtil.inANotInB(e,o);if(0==s.length&&0==a.length)return;{if(this.isSafari)return;for(var d=0;d<r.length;d++){var l=r[d];if(l.selfUser){if(0<a.length)for(var u=0;u<a.length;u++){var c=t[a[u]];n[a[u]]=c,l.selfUser.initVideo(a[u],c)}if(0<s.length)for(var u=0;u<s.length;u++)delete n[s[u]],l.selfUser.deleteVideo(s[u])}}}}(y,t,g.rooms,g.cameraMap),n){var m=n[f];g.checkMicrophoneId=f,g.checkMicrophoneName=m;break}!function(e,t,r,n){var o=[];for(var i in t)o.push(i);var a=arrayUtil.inANotInB(o,e),s=arrayUtil.inANotInB(e,o);if(0==s.length&&0==a.length)return;for(var d=0;d<this.rooms.length;d++){var l=r[d];if(l.selfUser){if(0<a.length)for(var u=0;u<a.length;u++){var c=t[a[u]];n[a[u]]=c}if(0<s.length)for(var u=0;u<s.length;u++){var c=n[s[u]];s[u]==self.checkMicrophoneId&&l.selfUser.deleteAudio(s[u]),delete n[s[u]]}}}}(v,n,g.rooms,g.microphoneMap),g.speakerMap=s}).otherwise(function(e){log.error("===avdEngine.refreshDevice(),get device error!error code:"+e.code+"; error message:"+e.message)}),setTimeout(function(){e.resolve()},2e3),e.promise},u.prototype.setRecordingMicrophone=function(t){log.info("===avdEngine.setRecordingMicrophone(),microphoneId:"+t);for(var r=this,e=0;e!=r.rooms.length;++e){var n=r.rooms[e];if(n&&n.selfUser){var o=n.selfUser.audio;if(o){if(t!=o.id)if(o.status==StreamStatus.init){n.selfUser.deleteAudio(o.id);a=r.microphoneMap[t];n.selfUser.initAudio(t,a),r.checkMicrophoneId=t,r.checkMicrophoneName=a,log.info("===avdEngine.setRecordingMicrophone(),microphoneId:"+t+",microphoneName:"+a+" success!")}else if(o.status==StreamStatus.published||o.status==StreamStatus.muted){var i=o.element;o.closeMicrophone().then(function(){n.selfUser.deleteAudio(o.id);var e=r.microphoneMap[t];n.selfUser.initAudio(t,e),n.selfUser.audio.openMicrophone(i),r.checkMicrophoneId=t,r.checkMicrophoneName=e,log.info("===avdEngine.setRecordingMicrophone(),microphoneId:"+t+",microphoneName:"+e+" success!")})}}else{var a=r.microphoneMap[t];n.selfUser.initAudio(t,a)}}}},u.prototype.checkDevice=function(){var o=when.defer();return log.debug("===checkDevice(),start..."),this.getAllDevices().then(function(e){for(var t={video:!1,audio:!1,speaker:!1,deviceIdIsUndefined:!1},r=0;r!=e.length;++r){var n=e[r];n.deviceId||n.id||(t.deviceIdIsUndefined=!0),"videoinput"===n.kind||"video"===n.kind?t.video=!0:"audioinput"===n.kind||"audio"===n.kind?t.audio=!0:"audiooutput"===n.kind&&(t.speaker=!0)}log.debug("===checkDevice(),sucess end..."),o.resolve(t)}).otherwise(function(e){log.debug("===checkDevice(),error end..."),o.reject(e)}),o.promise},u.prototype.checkOpenVideo=function(e,t,r){var n=when.defer(),o=this;o.checkCloseVideo();var i={video:{},audio:!1};if(e&&"undefined"!=e&&(i.video.deviceId={exact:e}),t){var a=Resolution[t];i.video.width={min:a.width,max:a.width},i.video.height={min:a.height,max:a.height}}r&&(o.isChrome||o.isOpera)&&("string"==typeof r&&(r=Number(r)),i.video.frameRate={min:r,max:r});try{log.info("===avdEngine.checkOpenVideo(),constraints:"+JSON.stringify(i)),navigator.mediaDevices.getUserMedia(i).then(function(e){o.checkVideoStream=e,n.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),log.error("===avdEngine.checkOpenVideo(),errorName:"+e.name),n.reject(t)})}catch(e){var s=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n.reject(s)}return n.promise},u.prototype.checkOpenAudio=function(e){var n=when.defer(),t=this;t.checkCloseAudio();var r={video:!1,audio:{}};e&&"undefined"!=e&&(r.audio.deviceId={exact:e});try{log.info("===avdEngine.checkOpenAudio(),constraints:"+JSON.stringify(r)),navigator.mediaDevices.getUserMedia(r).then(function(e){t.checkAudioStream=e,n.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),n.reject(t)})}catch(e){var o=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);n.reject(o)}return n.promise},u.prototype.checkOpenVideoAndAudio=function(e,t,r,n){var s=when.defer(),d=this;d.checkCloseVideo(),d.checkCloseAudio();var o={video:{},audio:{}};if(e&&"undefined"!=e&&(o.video.deviceId={exact:e}),t&&"undefined"!=t&&(o.audio.deviceId={exact:t}),r){var i=Resolution[r];o.video.width={min:i.width,max:i.width},o.video.height={min:i.height,max:i.height}}n&&(d.isChrome||d.isOpera)&&("string"==typeof n&&(n=Number(n)),o.video.frameRate={min:n,max:n});try{log.info("===avdEngine.checkOpenVideoAndAudio(),constraints:"+JSON.stringify(o)),navigator.mediaDevices.getUserMedia(o).then(function(e){var t=new MediaStream,r=new MediaStream;if(e){for(var n=e.getAudioTracks(),o=0;o<n.length;o++)t.addTrack(n[o]);var i=e.getVideoTracks();for(o=0;o<i.length;o++)r.addTrack(i[o])}var a={audioStream:t,videoStream:r};d.checkVideoStream=a.videoStream,d.checkAudioStream=a.audioStream,s.resolve(a)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),s.reject(t)})}catch(e){var a=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);s.reject(a)}return s.promise},u.prototype.checkAudioLevel=function(e,t){this.checkAudioStream&&(checkAudioLocalStatsCollector=new LocalStatsCollector(this.checkAudioStream,e,t),checkAudioLocalStatsCollector.start())},u.prototype.checkCloseVideo=function(){this.checkVideoStream&&(this.checkVideoStream.getTracks().forEach(function(e){e.stop()}),log.debug("===avdEngine.checkCloseVideo finished")),this.checkVideoStream=null},u.prototype.checkCloseAudio=function(){this.checkAudioLocalStatsCollector&&this.checkAudioLocalStatsCollector.stop(),this.checkAudioLocalStatsCollector=null,this.checkAudioStream&&(this.checkAudioStream.getTracks().forEach(function(e){e.stop()}),log.debug("===avdEngine.checkCloseAudio() finished")),this.checkAudioStream=null},u.prototype.obtainRecord=function(e){return new r(e)},u.prototype.obtainLive=function(e){return new o(e)},u.prototype.obtainOutgoing=function(e){return new i(e)},u.prototype.getStreamExporterManager=function(){return new a},u.prototype.deviceChangeListenerHandler=function(){var u=this;log.debug("===avdEngine.deviceChangeListenerHandler(), device change detected.");var c=Object.keys(u.microphoneMap),p=Object.keys(u.cameraMap),h=null;u.initDeviceHandler().then(function(e){if(1==e){if(h=Object.keys(u.microphoneMap),i=Object.keys(u.cameraMap),h.length>c.length){var t=h.filter(function(t){return c.findIndex(function(e){return t===e})<0});log.debug("===avdEngine.deviceChangeListenerHandler(), Microphone device change detected. type:add, deviceIds: "+t),u.eventEmitter.emit(EngineCallback.device_microphone_change,changeTypeEnum.add,t)}else if(h.length<c.length){var r=c.filter(function(t){return h.findIndex(function(e){return e===t})<0});if(log.debug("===avdEngine.deviceChangeListenerHandler(), Microphone device change detected. type:remove, deviceIds: "+r),u.eventEmitter.emit(EngineCallback.device_microphone_change,changeTypeEnum.remove,r),0<r.length)for(var n=0;n<r.length;n++)if(r[n]==u.checkMicrophoneId)for(var o=0;o<u.rooms.length;o++){(l=u.rooms[o]).selfUser&&l.selfUser.deleteAudio(r[n])}}if(i.length>p.length){var i=i.filter(function(t){return p.findIndex(function(e){return t===e})<0});log.debug("===avdEngine.deviceChangeListenerHandler(), Camera device change detected. type:add, deviceIds: "+i),u.eventEmitter.emit(EngineCallback.device_camera_change,changeTypeEnum.add,i);for(n=0;n<i.length;n++){var a=i[n],s=u.cameraMap[a];for(o=0;o<u.rooms.length;o++){(l=u.rooms[o]).selfUser&&l.selfUser.initVideo(a,s)}}}else if(i.length<p.length){var d=p.filter(function(t){return i.findIndex(function(e){return e===t})<0});log.debug("===avdEngine.deviceChangeListenerHandler(), Camera device change detected. type: remove, deviceIds: "+d),u.eventEmitter.emit(EngineCallback.device_camera_change,changeTypeEnum.remove,d);for(n=0;n<d.length;n++)for(a=d[n],o=0;o<u.rooms.length;o++){var l;(l=u.rooms[o]).selfUser&&l.selfUser.deleteVideo(a)}}}})},u.prototype.deviceChangeListener=function(){var e=this;navigator&&navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=debounce(function(){e.deviceChangeListenerHandler()},2e3))},u.prototype.setEchoCancellation=function(e){"boolean"==typeof e?(log.info("===avdEngine.setEchoCancellation(), enable: "+e),this.enableEchoCancellation=e):log.error("===avdEngine.setEchoCancellation() faild, true or false is needed")},u.prototype.setNoiseSuppression=function(e){"boolean"==typeof e?(log.info("===avdEngine.setNoiseSuppression(), enable: "+e),this.enableNoiseSuppression=e):log.error("===avdEngine.setNoiseSuppression() faild, true or false is needed")},u.prototype.setAutoGainControl=function(e){"boolean"==typeof e?(log.info("===avdEngine.setAutoGainControl(), enable: "+e),this.enableAutoGainControl=e):log.error("===avdEngine.setAutoGainControl() faild, true or false is needed")},u.prototype.setIgnoreModifyResourceReq=function(e){"boolean"==typeof e?(log.info("===avdEngine.setIgnoreModifyResourceReq(), isIgnore: "+e),this.ignoreModifyResourceReq=e):log.error("===avdEngine.setIgnoreModifyResourceReq() faild, true or false is needed")},u.prototype.setEnableHardwareEncoding=function(e){var t=getGPUInfo();log.info("===avdEngine.setEnableHardwareEncoding(), isEnable: ",e,", current gpu info is: ",t),"boolean"==typeof e?!0===e&&-1<t.indexOf("Intel(R) HD Graphics")?log.error("===avdEngine.setEnableHardwareEncoding() faild, Detected Intel graphics card, ignored"):this.enableHardwareEncoding=e:log.error("===avdEngine.setEnableHardwareEncoding() faild, true or false is needed")},u}),ModuleBase.define("Room",["SignalFactory","RestServer","MasterServer","P2PServer","User","Error"],function(e,s,n,t,d,c){var r=function(e){this.id=e,this.roomTocken=null,this.signalTocken=null,this.outgoingAddr=null,this.userAgent=USER_AGENT_AVD_DEFAULT,this.roomPassword=null,this.pingTimeout,this.pingInterval,this.pingCountTime=0,this.pingIntervalId=null,this.pingTimeoutId=null,this.lastPDUSeq=0,this.roomInfo=null,this.status=RoomStatus.opening,this.appData={},this.selfUser=null,this.participants=[],this.muteSpeakerFlag=!1,this.masterServer=null,this.p2pServer=null,this.cmdProtobufCoded=null,this.setRemoteDescriptionSuccess=!1,this.addIcecandidateList=[],this.traceablePeerConnection=null,this.traceableP2PPeerConnection=null,this.eventEmitter=new EventEmitter,this.fingerPrint,this.setup,this.iceUfrag,this.icePwd,this.codecPayloadVP8=null,this.codecPayloadVP9=null,this.codecPayloadH264=null,this.codecPayloadAV1=null,this.codecPayloadISAC_16K=null,this.codecPayloadISAC_32K=null,this.codecPayloadOpus=null,this.codecPayloadG722=null,this.codecPayloadPCMU=null,this.codecPayloadPCMA=null,this.codecPayloadCN_8k=null,this.codecPayloadCN_16k=null,this.codecPayloadCN_32k=null,this.versionToServer,this.audioCodecPayloadMap,this.remoteSdpTemplate,this.videoMediaTemplate,this.audioMediaTemplate,this.remoteDescriptionSDP,this.midNum=1,this.midObjSet=[{mid:0,type:"audio",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}},{mid:1,type:"video",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}}],this.audioMediaSDPInit,this.videoMediaSDPInit,this.mediaMid=0,this.connectionInfoCollector=null,this.audioLevel=null,this.connectionStatistics=null,this.toMCUReconnectionPC=null,this.isExistReJoinState=!1,this.reconnectMaxTimes=3,this.reconnectTimeout=15e3,this.currentReconnectTimes=0,this.currentConnectTimeout=0,this.connectionState=0,this.rejoinTimeout=6e4,this.currentRejoinTimeout=0,this.rejoinAlways=!1,this.rejoinInterval=3e3,this.rejoinLastTimeStamp=null,this.rejoinTemp,this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],this.pubVideos=[],this.pubAudios=[],this.pubScreens=[],this.currMinBandwidth=null,this.currMaxBandwidth=null,this.currScreenMinBandwidth=1200,this.currScreenMaxBandwidth=3200,this.currScreenHandle=!1,this.updateMinBandwidth=null,this.videoSsrc2user={},this.audioSsrc2user={},this.screenSsrc2user={},this.videoSsrc2deviceId={},this.addSdpLocalStates=0,log.debug("===DDDDDDDDDDDDD init this.addSdpLocalStates:"+this.addSdpLocalStates),this.boardId2userId={},this.annotation2boardId={},this.style2annotation={},this.isDoPDUSeq=0,this.videoSsrc=null,this.audioSsrc=null,this.updateTimer=null,this.boardOutputXRatio=1,this.boardOutputYRatio=1,this.boardInputXRatio=1,this.boardInputYRatio=1,this.baseMediaPalyEventStopTime=null,this.mediaPalyEventStopIntervalId=null,this.cameraId2uuid={},this.microphoneId2uuid={},this.speakerId2uuid={},this.mp4ImporterUserAudioStateIntervalId=null,this.mp4ImporterUserAudioRtpPacketTemp=0,this.mp4ImporterUserAudioRtpPacketReal=0,this.mp4ImporterUserAudioRate=20,this.websocketConnectTime=0,this.roomJoinState=RoomStateEnum.DISCONNECTED,this.isReceivedAddBoardId="",this.isReceivedRemoveBoardId="",this.clientSetSpeakerDeviceId=null,this.clientSetSpeakerVolume=null,this.boardAddOrShareMsgMap=new Map,this.boardCloseOrRemoveMsgMap=new Map};return r.prototype.setUserAgent=function(e){this.userAgent=e},r.prototype.setReconnectMaxTimes=function(e){log.info("===room.setReconnectMaxTimes(),count:"+e),this.reconnectMaxTimes=e},r.prototype.setReconnectTimeout=function(e){log.info("===room.setReconnectTimeout(),timeout:"+e),this.reconnectTimeout=e},r.prototype.MaxReconnectTimeout=function(e){log.info("===room.MaxReconnectTimeout(),pingInterval:"+e),this.reconnectTimeout<3*e&&(this.reconnectTimeout=3*e,log.info("===room.MaxReconnectTimeout(),reconnectTimeout:"+this.reconnectTimeout))},r.prototype.joinEfficient=function(e,t,r,n,o,i){var a=when.defer(),s=this;return avdEngineHandle.init(e,t,!1).then(function(){s.join(r,n,o,i).then(function(){a.resolve()}).otherwise(function(e){s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e)})}).otherwise(function(e){s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e)}),a.promise},r.prototype.serverinfoHandle=function(){log.info("===room.serverinfoHandle()...");var t=this,r=when.defer(),e=null;return(e=avdEngineHandle.applyToElectron?new s(avdEngineHandle.electronProtocol):avdEngineHandle.restFullProtocol?new s(avdEngineHandle.restFullProtocol):new s).getServerinfo(avdEngineHandle.restServerInfo.mcuServerUrl,avdEngineHandle.accessToken,avdEngineHandle.isUseCascade,t.id).then(function(){!avdEngineHandle.restServerInfo.notQueryGetMcu&&avdEngineHandle.restServerInfo.isCluster?(log.info("===room.serverinfoHandle(),restServer.getMcu()"),e.getMcu(t.id,avdEngineHandle.accessToken,avdEngineHandle.clientIsUseCascade).then(function(){r.resolve()}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,r.reject(e)})):r.resolve()}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,log.error("===room.serverinfoHandle(),restServer.getServerinfo()失败！error:"+e.message),r.reject(e)}),r.promise},r.prototype.websocketConnect=function(r){var n=this;r||(r=when.defer()),n.masterServer&&n.masterServer.signalingChannel&&n.masterServer.signalingChannel.close();var o=(new e).getDataChannel(SignalType.websocket,n);return o.connect().then(function(e){n.currentReconnectTimes=0,n.currentConnectTimeout=0,r.resolve(e)}).otherwise(function(e){o.close(),0===n.currentConnectTimeout&&(n.currentConnectTimeout=new Date);var t=new Date-n.currentConnectTimeout;0<n.currentReconnectTimes&&log.error("===room.websocketConnect(),Websocket第"+n.currentReconnectTimes+"次重连,累计耗时"+t+"毫秒"),n.currentReconnectTimes<n.reconnectMaxTimes||t<n.reconnectTimeout?(n.currentReconnectTimes++,n.websocketConnect(r)):(n.roomJoinState=RoomStateEnum.DISCONNECTED,r.reject())}),r.promise},r.prototype.join=function(r,n,o,i){var a=when.defer(),s=this;if(s.roomJoinState!=RoomStateEnum.CONNECTING&&s.roomJoinState!=RoomStateEnum.CONNECTED){if(s.roomJoinState=RoomStateEnum.CONNECTING,null!=r&&""!=r)return"string"!=typeof r?((e=new c(ErrorConstant.exporter_parameter_type_error)).message=e.message+"[ UserId required string type]",log.error("===room.join() error, code:"+e.code+", message:"+e.message),s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e)):(void 0===o&&(o=""),void 0===i&&(i=""),s.serverinfoHandle().then(function(){if(avdEngineHandle.loggerReportConfig.open_logger&&1==parseInt(avdEngineHandle.loggerReportConfig.open_logger)){avdEngineHandle.loggerReport.start();for(var e=0;e<avdEngineHandle.logReportWait.length;e++){var t=avdEngineHandle.logReportWait[e];avdEngineHandle.loggerReport.info(t)}}log.info("===room.join(), JS SDK 版本号："+avdEngineHandle.getVersion()),avdEngineHandle.loggerReport.info("JS SDK 版本号："+avdEngineHandle.getVersion()),log.info("===room.join(), 浏览器内核名称："+avdEngineHandle.browserName+", 内核版本:"+avdEngineHandle.fullVersion+", 操作系统名称:"+avdEngineHandle.browserOsName+" "+avdEngineHandle.detect.osVersion+", checkBrowserSupport:"+avdEngineHandle.checkBrowserSupport()+", GetUserMedia:"+avdEngineHandle.detect.getUserMediaSupport+", RTCPeerConnection:"+avdEngineHandle.detect.RTCPeerConnectionSupport+", WebSocket:"+avdEngineHandle.detect.WebSocketSupport),avdEngineHandle.loggerReport.info("浏览器内核名称："+avdEngineHandle.browserName+", 内核版本:"+avdEngineHandle.fullVersion+", 操作系统名称:"+avdEngineHandle.browserOsName),avdEngineHandle.isFirefox&&"Android"==avdEngineHandle.browserOsName&&avdEngineHandle.videoCoding==VideoCodingType.VP8&&(log.info("===room.join(), Android Firefox不支持VP8, 自动调整成H264"),avdEngineHandle.videoCoding=VideoCodingType.H264),log.info("===room.join(), 视频编解码:"+avdEngineHandle.videoCoding),avdEngineHandle.loggerReport.info("视频编解码:"+avdEngineHandle.videoCoding),log.info("===room.join(), 音频编解码:"+avdEngineHandle.audioCoding),avdEngineHandle.loggerReport.info("音频编解码:"+avdEngineHandle.audioCoding),avdEngineHandle.restServerInfo.isCluster?(log.info("===room.join(), 服务器是集群版本"),avdEngineHandle.loggerReport.info("room.join(),服务器是集群版本")):(log.info("===room.join(), 服务器是单机版本"),avdEngineHandle.loggerReport.info("room.join(),服务器是单机版本")),avdEngineHandle.restServerInfo.masterVersion&&(log.info("===room.join(), 服务器端 masterVersion:"+avdEngineHandle.restServerInfo.masterVersion),avdEngineHandle.loggerReport.info(" 服务器端masterVersion:"+avdEngineHandle.restServerInfo.masterVersion)),avdEngineHandle.restServerInfo.masterPackageVersion&&(log.info("===room.join(), 服务器端 masterPackageVersion:"+avdEngineHandle.restServerInfo.masterPackageVersion),avdEngineHandle.loggerReport.info(" 服务器端masterPackageVersion:"+avdEngineHandle.restServerInfo.masterPackageVersion)),avdEngineHandle.restServerInfo.boxVersion&&(log.info("===room.join(), 服务器端 boxVersion:"+avdEngineHandle.restServerInfo.boxVersion),avdEngineHandle.loggerReport.info(" 服务器端boxVersion:"+avdEngineHandle.restServerInfo.boxVersion)),avdEngineHandle.restServerInfo.boxPackageVersion&&(log.info("===room.join(), 服务器端 boxPackageVersion:"+avdEngineHandle.restServerInfo.boxPackageVersion),avdEngineHandle.loggerReport.info(" 服务器端boxPackageVersion:"+avdEngineHandle.restServerInfo.boxPackageVersion)),s.doJoin(r,n,o,i,a)}).otherwise(function(e){if(e)log.error("===room.join(), error, code:"+e.code+", message:"+e.message),a.reject(e);else{var t=new c(ErrorConstant.avdEngine_init_failed);log.error("===room.join(), error, code:"+e.code+", message:"+e.message),a.reject(t)}})),a.promise;var e=new c(ErrorConstant.userId_required);return log.error("===room.join() error, code:"+e.code+", message:"+e.message),s.roomJoinState=RoomStateEnum.DISCONNECTED,a.reject(e),a.promise}log.debug("===room.join(), return by curr room state:",s.roomJoinState)},r.prototype.joinWithOEM=function(e,t,r,n,o){var i=when.defer(),a=this;return(new s).getMcuWithOEM(a.id,o).then(function(){a.doJoin(e,t,r,n,i)}).otherwise(function(e){i.reject(e)}),i.promise},r.prototype.doJoin=function(e,t,r,n,o){var i=this,a=avdEngineHandle.getBrowserDetect();i.roomPassword=n,i.selfUser=new d(e,t,r,i),i.selfUser.userAgent=i.userAgent,a.isWebRecord&&(i.selfUser.userAgent=USER_AGENT_AVD_WEB_RECORD,i.userAgent=USER_AGENT_AVD_WEB_RECORD),i.websocketConnect().then(function(e){i.openReqSend(webSocket).then(function(e){i.roomJoinState=RoomStateEnum.CONNECTED,o.resolve(e)}).otherwise(function(e){log.error("===room.doJoin(),openReqSend faild, reason: "+JSON.stringify(e)),i.roomJoinState=RoomStateEnum.DISCONNECTED,o.reject(e)})}).otherwise(function(){log.error("===room.doJoin(),登录加会超时："+ErrorConstant.join_room_timeout.code),avdEngineHandle.loggerReport.debug("room.doJoin(),登录加会超时."),i.roomJoinState=RoomStateEnum.DISCONNECTED;var e=new c(ErrorConstant.join_room_timeout);o.reject(e)})},r.prototype.reconnectionHandle=function(){var t=this;t.connectionState=1,t.websocketConnect().then(function(e){log.info("===WebSocket,room.reconnectionHandle(),websocket重连成功"),t.masterServer.pingInit(),t.masterServer.signalingChannel=e,log.info("===WebSocket,room.reconnectionHandle(),to masterServer.openReqReconnectionSend()"),t.openReqReconnectionSend().then(function(){log.debug("===WebSocket,room.reconnectionHandle(),OPEN_RQP Send, acception OPEN_REP result=0")}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,log.info("===WebSocket,room.reconnectionHandle(),OPEN_RQP 发送失败,进行重新加会处理。 reason: "+JSON.stringify(e)),log.debug("===Room.reconnectionHandle(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),t.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),t.roomJoinState!=RoomStateEnum.RECONNECTING&&(log.info("===to room.reJoin() by room.reconnectionHandle(),openReqReconnectionSend() failed"),t.reJoin())})}).otherwise(function(){log.info("===WebSocket,room.reconnectionHandle(),websocket重连超出预设次数及超时,进行重新加会处理。"),log.debug("===Room.reconnectionHandle(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),t.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),t.roomJoinState!=RoomStateEnum.RECONNECTING&&(log.info("===to room.reJoin() by room.reconnectionHandle(), websocketConnect() failed"),t.reJoin())})},r.prototype.reJoin=function(){var e=this;if(log.info("===room.reJoin(), current roomJoinState: "+e.roomJoinState),e.roomJoinState!=RoomStateEnum.RECONNECTING){0==e.currentRejoinTimeout&&(e.currentRejoinTimeout=new Date);var t=new Date-e.currentRejoinTimeout;if(log.info("===room.reJoin(), duration since first rejoin: "+t+",rejoinTimeout: "+e.rejoinTimeout),0==e.rejoinAlways){if(t>e.rejoinTimeout)return log.info("===room.reJoin(), rejoinAlways false, rejoinTimeout, rejoinDurationFromFirst: "+t),log.debug("===Room.reJoin(),callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.reJoinRoomTimeOut),void e.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinRoomTimeOut);log.info("===room.reJoin(), rejoinAlways false, to room.reJoinHandle()"),e.rejoinLastTimeStamp=new Date,e.reJoinHandle()}else if(e.rejoinLastTimeStamp){var r=new Date-e.rejoinLastTimeStamp;if(r<e.rejoinInterval){var n=e.rejoinInterval-r;clearTimeout(e.rejoinTemp),e.rejoinTemp=setTimeout(function(){e.rejoinLastTimeStamp=new Date,log.info("===room.reJoin(), rejoinAlways true, rejoinInterval Not established, by setTimeout  to room.reJoinHandle()"),e.reJoinHandle()},n)}else log.info("===room.reJoin(), rejoinAlways true, rejoinInterval established, to room.reJoinHandle()"),e.rejoinLastTimeStamp=new Date,e.reJoinHandle()}else log.info("===room.reJoin(), rejoinAlways true, self.rejoinLastTimeStamp is null, to room.reJoinHandle()"),e.rejoinLastTimeStamp=new Date,e.reJoinHandle()}else log.debug("===room.rejoin(), roomJoinState is reconnecting to return")},r.prototype.reJoinHandle=function(){var t=this;if(log.info("===room.reJoinHandle()..."),t.connectionInfoCollector&&t.connectionInfoCollector.stop(),t.connectionStatistics&&t.connectionStatistics.stop(),t.connectionState=2,t.roomJoinState=RoomStateEnum.RECONNECTING,t.isDoPDUSeq=0,t&&t.participants&&0<t.participants.length&&t.participants.forEach(function(e){e.id!=t.selfUser.id&&arrayUtil.objectSplice(t.participants,e.id)}),t.selfUser.reJoinPubVideoIds&&0<t.selfUser.reJoinPubVideoIds.length);else{t.selfUser.reJoinPubVideoIds=[],t.selfUser.reJoinPubVideoElements=[];var e=t.pubVideos;if(e&&0<e.length){log.debug("===room.reJoinHandle(),重新加会初始化videos之前先把自己pub的视频unpub掉，room.pubVideos.length:"+e.length);for(var r=0;r<e.length;r++)if(e[r].ownerId==t.selfUser.id){var n=t.selfUser.getVideo(e[r].id);if(t.selfUser.reJoinPubVideoIds.push(e[r].id),t.selfUser.reJoinPubVideoElements.push(n.element),n){log.debug("===room.reJoinHandle(),重新加会初始化videos之前先把自己pub的视频unpub掉,selfUser.video.id:"+e[r].id);var o=t.selfUser.stream.getVideoTracks();0<o.length&&o.forEach(function(e){e.stop()}),log.info("===video.unpublish()不会被执行，因为当前是在重新加会的流程中，这里不需要执行。")}}}}if(t.selfUser.reJoinPubAudioId&&""!=t.selfUser.reJoinPubAudioId);else{t.selfUser.reJoinPubAudioId="";var i=t.pubAudios;if(i&&0<i.length){log.debug("===room.reJoinHandle(),重新加会初始化audio之前先把自己pub的音频unpub掉,room.pubAudios.length:"+i.length);for(r=0;r<i.length;r++)if(i[r].ownerId==t.selfUser.id){var a=t.selfUser.getAudio(i[r].id);if(t.selfUser.reJoinPubAudioId=i[r].id,a){a.status===StreamStatus.muted&&(log.debug("===room.reJoinHandle(),后重新加会初始化audio之前先把自己pub的音频unpub掉,当前audio的状态为Mute"),t.selfUser.reJoinPubAudioButMute=!0),log.debug("===room.reJoinHandle(),后重新加会初始化audio之前先把自己pub的音频unpub掉,selfUser.audio.id:"+i[r].id);var s=t.selfUser.stream.getAudioTracks();0<s.length&&s.forEach(function(e){e.stop()}),log.info("===audio.closeMicrophone()不会被执行，因为当前是在重新加会的流程中，这里不需要执行。")}}}}var d=t.pubScreens;if(d&&0<d.length){log.debug("===room.reJoinHandle(),重新加会初始化screen之前先把自己pub的桌面共享unpub掉,room.pubScreens.length:"+d.length);for(r=0;r<d.length;r++){if(d[r].ownerId==t.selfUser.id)t.selfUser.getScreen(d[r].id)&&(log.debug("===room.reJoinHandle(),重新加会初始化screen之前先把自己pub的桌面共享unpub掉,selfUser.screen.id:"+d[r].id),t.selfUser.reJoinPubScreenStram=t.selfUser.screenStream,log.info("===screen.unpublish()不会被执行，因为当前是在重新加会的流程中，这里不需要执行。"))}}clearTimeout(t.reJoinAfterTimer),t.reJoinAfterUsers=[],t.selfUser&&t.selfUser.toMCUPC&&(t.selfUser.toMCUPC.msgQueue=[],t.selfUser.toMCUPC.close(),t.selfUser.toMCUPC=null),log.debug("===room.reJoinHandle(),重新加会之前sub的视频subVideoIds:"+JSON.stringify(t.selfUser.subVideoIds)),t.selfUser.reJoinSubVideoIds=t.selfUser.subVideoIds,log.debug("===room.reJoinHandle(),重新加会之前sub的音频subAudioIds:"+JSON.stringify(t.selfUser.subAudioIds)),t.selfUser.reJoinSubAudioIds=t.selfUser.subAudioIds,log.debug("===room.reJoinHandle(),重新加会之前sub的桌面共享subScreenIds:"+JSON.stringify(t.selfUser.subScreenIds)),t.selfUser.reJoinSubScreenIds=t.selfUser.subScreenIds,t.selfUser.init();var l=avdEngineHandle.getBrowserDetect();t.selfUser.userAgent=t.userAgent,l.isWebRecord&&(t.selfUser.userAgent=USER_AGENT_AVD_WEB_RECORD,t.userAgent=USER_AGENT_AVD_WEB_RECORD);var u=when.defer();return t.toMCUReconnectionPC&&(t.traceablePeerConnection.close(t.toMCUReconnectionPC),t.toMCUReconnectionPC.msgQueue=[],t.toMCUReconnectionPC=null),t.serverinfoHandle().then(function(){t.websocketConnect().then(function(e){t.openReqSend(e).then(function(e){t.pingTimeout=e.pingTimeout,t.pingInterval=e.pingInterval,t.signalTocken=e.signalTocken,t.masterServer=e.masterServer,t.pubVideos=[],t.pubAudios=[],t.pubScreens=[],t.midNum=1,t.midObjSet=[{mid:0,type:"audio",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}},{mid:1,type:"video",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}}],t.roomJoinState=RoomStateEnum.CONNECTED,u.resolve(t)}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,log.debug("===room.reJoinHandle(),openReqSend faild, reason: "+JSON.stringify(e)),t.reJoin(),u.reject(e)})}).otherwise(function(e){t.roomJoinState=RoomStateEnum.DISCONNECTED,log.debug("===room.reJoinHandle(),websocketConnect faild, reason: "+JSON.stringify(e)),t.reJoin(),u.reject(e)})}).otherwise(function(e){(log.debug("===room.reJoinHandle(),serverinfoHandle faild, reason: "+JSON.stringify(e)),t.roomJoinState=RoomStateEnum.DISCONNECTED,e)?log.error("===room.reJoinHandle(), error code:"+e.code+", error message:"+e.message):(e=new c(ErrorConstant.avdEngine_init_failed),log.error("===room.reJoinHandle(), error code:"+e.code+", error message:"+e.message));t.reJoin(),u.reject(e)}),u.promise},r.prototype.continuousReJoin=function(){this.rejoinAlways||(log.info("===room.continuousReJoin(),重新加会超时后,开启持续永久重新加会"),this.rejoinAlways=!0,avdEngineHandle.setRemoteDescriptionSuccess=!1,this.addSdpLocalStates=0,log.debug("===DDDDDDD0000000000,room.continuousReJoin(),this.addSdpLocalStates:",this.addSdpLocalStates),addIcecandidateList=[],this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],this.reJoin())},r.prototype.getMcuByReJoin=function(){var t=this,e=when.defer();return(new s).getMcu(t.id,avdEngineHandle.accessToken).then(function(){log.debug("===room.getMcuByReJoin(),  getMcu success"),t.reJoin()}).otherwise(function(e){log.error("===room.getMcuByReJoin(), getMcu error,code:"+e.code+",message:"+e.message),t.reJoin()}),e.promise},r.prototype.getRoomId=function(){return this.roomInfo.room_id},r.prototype.getRoomTopic=function(){return this.roomInfo.topic},r.prototype.getOwnerId=function(){return this.roomInfo.owner_id},r.prototype.isMcu=function(){var e=!0;if(null==this.roomInfo)return e;var t=this.roomInfo.room_mode;return 3!=t&&4!=t||(e=!1),e},r.prototype.getRoomType=function(e){var t=!1;if(this.roomInfo&&this.roomInfo.room_type){var r=this.roomInfo.room_type.toString(2);e==RoomTypeEnum.join_host_first?t=this.isHasPrivilige(roomTypePrivilige.join_host_first,r):e==RoomTypeEnum.net_acc?t=this.isHasPrivilige(roomTypePrivilige.net_acc,r):e==RoomTypeEnum.host_control?t=this.isHasPrivilige(roomTypePrivilige.host_control,r):e==RoomTypeEnum.free_speech&&(t=!this.isHasPrivilige(roomTypePrivilige.host_control,r))}return t},r.prototype.isHasPrivilige=function(e,t){var r=!1;return 0<(e&t)&&(r=!0),r},r.prototype.getMaxAudio=function(){return this.roomInfo.max_audio},r.prototype.getMaxVideo=function(){return this.roomInfo.max_video},r.prototype.getMaxAttendee=function(){return this.roomInfo.attendee_max},r.prototype.getUsableVideo=function(){var e=this.getMaxVideo()-this.pubVideos.length;return e<0&&(e=0),e},r.prototype.getUsableAudio=function(){var e=this.getMaxAudio()-this.pubAudios.length;return e<0&&(e=0),e},r.prototype.updateRoomStatus=function(e){this.status=e},r.prototype.getRoomStatus=function(){return this.status},r.prototype.getSelfUser=function(){return this.selfUser},r.prototype.getSelfUserId=function(){return this.selfUser.id},r.prototype.getParticipants=function(){return this.participants},r.prototype.getUser=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.id==e){t=n;break}}return t},r.prototype.getUserByUserIdAndNodeId=function(e,t){for(var r,n=0;n<this.participants.length;n++){var o=this.participants[n];if(o.id==e&&o.nodeId==t){r=o;break}}return r},r.prototype.hasUser=function(e){for(var t=!1,r=0;r<this.participants.length;r++){if(this.participants[r].id==e){t=!0;break}}return t},r.prototype.hasUserByUserIdAndNodeId=function(e,t){for(var r=!1,n=0;n<this.participants.length;n++){var o=this.participants[n];if(o.id==e&&o.nodeId==t){r=!0;break}}return r},r.prototype.iCERestart=function(){var a=this,e={type:"offer",sdp:a.remoteDescriptionSDP};log.debug("===room.iCERestart(), calling pc.setRemoteDescription(), remoteDescriptionSDP:",e.sdp),a.selfUser.toMCUPC.setRemoteDescription(e).then(function(){log.info("===room.iCERestart(), doSetRemoteDescription(), set remote sessionDescription success");a.selfUser.toMCUPC.createAnswer({iceRestart:!0}).then(function(e){var t=e.sdp,r=Math.uuid(4),n=Math.uuid(24);t=updateSDPIcePwd(t=updateSDPIceUfrag(t,r),n),log.debug("===room.iCERestart(), calling pc.setLocalDescription(), LocalDescriptionSDP:",t);var o={};o.sdp=t,o.type="answer";var i=new RTCSessionDescription(o);a.selfUser.toMCUPC.setLocalDescription(i).then(function(){log.info("===room.iCERestart(), doSetLocalDescription(), set local sessionDescription success")})})})},r.prototype.getPublishedCameraCount=function(){return this.pubVideos.length},r.prototype.getPublishedCamera=function(){return this.pubVideos},r.prototype.getPublishedScreenCount=function(){return this.pubScreens.length},r.prototype.getPublishedScreen=function(){return this.pubScreens},r.prototype.addUser=function(e){this.hasUser(e.id)||this.participants.push(e)},r.prototype.addUserByUserIdAndUserId=function(e){this.hasUserByUserIdAndNodeId(e.id,e.nodeId)||this.participants.push(e)},r.prototype.removeUser=function(e){this.participants&&0<this.participants.length&&arrayUtil.objectSplice(this.participants,e)},r.prototype.removeUserByUserIdAndNodeId=function(e,t){this.participants&&0<this.participants.length&&arrayUtil.userIdAndNodeIdSplice(this.participants,e,t)},r.prototype.getUserByNodeId=function(e){for(var t,r=0;r<this.participants.length;r++){var n=this.participants[r];if(n.nodeId==e){t=n;break}}return t},r.prototype.getNodeId=function(e){var t=null,r=this.getUser(e);return r&&(t=r.nodeId),t},r.prototype.getUserId=function(e){var t=null,r=this.getUserByNodeId(e);return r&&(t=r.id),t},r.prototype.sendPublicMessage=function(e){var t=when.defer();return this.masterServer.sendMessage(e),t.resolve(),t.promise},r.prototype.sendPrivateMessage=function(e,t){var r=when.defer();return this.masterServer.sendMessage(e,t),r.resolve(),r.promise},r.prototype.sendPublicData=function(e){var t=when.defer();return this.masterServer.sendData(e).then(function(){t.resolve()}).otherwise(function(e){log.error("===room.sendPublicData() faild, error:"+JSON.stringify(ErrorConstant.data_oversize)),t.reject(e)}),t.promise},r.prototype.sendPrivateData=function(e,t){var r=when.defer();return this.masterServer.sendData(e,t).then(function(){r.resolve()}).otherwise(function(e){log.error("===room.sendPrivateData() faild, error:"+JSON.stringify(ErrorConstant.data_oversize)),r.reject(e)}),r.promise},r.prototype.sendPrivateDataToUser=function(e,t){var r=when.defer();return this.masterServer.sendPrivateDataToUser(e,t).then(function(){r.resolve()}).otherwise(function(e){log.error("===room.sendPrivateDataToUser() faild, error:"+JSON.stringify(ErrorConstant.data_oversize)),r.reject(e)}),r.promise},r.prototype.updateAppData=function(e,t){this.appData[e]=t,this.masterServer.roomDataInfo(e,t)},r.prototype.getAppData=function(e){return void 0===e||null==e||""==e?this.appData:this.appData[e]},r.prototype.setCameraResolutionOrFrameRate=function(e,t,r,n,o){log.info("===room.setCameraResolutionOrFrameRate(),cameraId:"+e+",resolution:"+t+",frameRate:"+r+",resolutionSetType:"+n+",aspectRatio:"+o);var i=when.defer(),a=this.selfUser.getVideo(e);if(a)"string"==typeof r&&(r=Number(r)),"string"==typeof o&&(o=Number(o)),a.resolution==Resolution[t]&&a.setType==n&&a.frameRate==r&&a.aspectRatio==o||(a.setResolution(t,n),a.setFrameRate(r),a.setAspectRatio(o),a.track&&a.applyConstraints(),i.resolve());else{var s=new c(ErrorConstant.cameraId_does_not_exist);i.reject(s)}return i.promise},r.prototype.setCameraResolutionWHOrFrameRate=function(e,t,r,n,o,i){log.info("===room.setCameraResolutionWHOrFrameRate(),cameraId:"+e+",resolutionWidth:"+t+",resolutionHeight:"+r+",frameRate:"+n+",resolutionSetType:"+o+",aspectRatio:"+i);var a=when.defer(),s=this.selfUser.getVideo(e);if(s)"string"==typeof n&&(n=Number(n)),"string"==typeof i&&(i=Number(i)),void 0===s.resolution?(s.setResolutionWH(t,r,o),s.setFrameRate(n),a.resolve()):s.resolution.width==t&&s.resolution.height==r&&s.setType==o&&s.frameRate==n&&s.aspectRatio==i||(s.setResolutionWH(t,r,o),s.setFrameRate(n),s.setAspectRatio(i),s.track&&s.applyConstraints(),a.resolve());else{var d=new c(ErrorConstant.cameraId_does_not_exist);a.reject(d)}return a.promise},r.prototype.muteSpeaker=function(){log.info("===room.muteSpeaker()");var r=this;r.muteSpeakerFlag=!0,r.participants.forEach(function(e){if(e.id!=r.selfUser.id){var t=e.audio.track;t&&(t.enabled=!1)}})},r.prototype.unmuteSpeaker=function(){log.info("===room.unmuteSpeaker()");var r=this;r.muteSpeakerFlag=!1,r.participants.forEach(function(e){if(e.id!=r.selfUser.id){var t=e.audio.track;t&&(t.enabled=!0)}})},r.prototype.ismuteSpeaker=function(){return this.muteSpeakerFlag},r.prototype.hasObject=function(e,t){for(var r=!1,n=0;n<e.length;n++){var o=e[n];if(o.id==t.id&&o.ownerId==t.ownerId){r=!0;break}}return r},r.prototype.kickoffUser=function(e,t){log.info("===room.kickoffUser(),reason:"+e+",userId:"+t),this.masterServer.userIndiction(e,t)},r.prototype.leave=function(e,t){log.info("===room.leave(),reason:"+e+",kickoffOpt:"+t);var r=this,n=when.defer();return r.mp4ImporterUserAudioRtpPacketTemp=0,r.mp4ImporterUserAudioRtpPacketReal=0,r.mp4ImporterUserAudioStateIntervalId&&(clearInterval(r.mp4ImporterUserAudioStateIntervalId),r.mp4ImporterUserAudioStateIntervalId=null),r.userClearInfo(),setTimeout(function(){r.masterServer.userMsg(e,t),r.roomClearInfo(!0),n.resolve()},1e3),n.promise},r.prototype.closeRoom=function(e){log.info("===room.closeRoom(),userId:",e);var t=this;t.mp4ImporterUserAudioRtpPacketTemp=0,t.mp4ImporterUserAudioRtpPacketReal=0,t.mp4ImporterUserAudioStateIntervalId&&(clearInterval(t.mp4ImporterUserAudioStateIntervalId),t.mp4ImporterUserAudioStateIntervalId=null),t.userClearInfo(),setTimeout(function(){t.masterServer.closeRoom(e),t.roomClearInfo()},1e3)},r.prototype.userClearInfo=function(){var e=this.selfUser.videos;e&&0<e.length&&e.forEach(function(e){e.status==StreamStatus.published&&(e.track&&e.track.stop(),e.unpreview(),e.unpublish())});var t=this.selfUser.audio;t&&t.status==StreamStatus.published&&(t.track&&t.track.stop(),t.closeMicrophone());var r=this.selfUser.screen;r&&r.status==StreamStatus.published&&(r.track&&r.track.stop(),r.unpublish())},r.prototype.roomClearInfo=function(e){var t=this;t&&(t.pingIntervalId&&(clearInterval(t.pingIntervalId),t.pingIntervalId=null),t.pingTimeoutId&&(clearInterval(t.pingTimeoutId),t.pingTimeoutId=null),t.selfUser.changePublishVideoQualityInterval&&(clearInterval(t.selfUser.changePublishVideoQualityInterval),t.selfUser.changePublishVideoQualityInterval=null),t.selfUser&&t.selfUser.toMCUPC&&(t.selfUser.toMCUPC.msgQueue=[],t.selfUser.toMCUPC.close(),t.selfUser.toMCUPC=null),avdEngineHandle.setRemoteDescriptionSuccess=!1,addIcecandidateList=[],t.connectionInfoCollector&&t.connectionInfoCollector.stop(),t.connectionStatistics&&t.connectionStatistics.stop(),e&&(t.roomJoinState=RoomStateEnum.DISCONNECTED,t.masterServer.signalingChannel.close(),t=null),avdEngineHandle.rooms=[])},r.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},r.prototype.getRoomControl=function(){return this.roomControl},r.prototype.setRoomControl=function(e){this.masterServer.setRoomControl(this.id,e)},r.prototype.setDeviceIdByUUID=function(e,t){if(0==e){var r=this.cameraId2uuid[t];return r||(this.selfUser&&this.selfUser.screen&&this.selfUser.screen.id==t?r=t:(r=Math.uuid(),this.cameraId2uuid[t]=r)),r}if(1==e){var n=this.speakerId2uuid[t];return n||(n=Math.uuid(),this.speakerId2uuid[t]=n),n}if(2==e){var o=this.microphoneId2uuid[t];return o||(o=Math.uuid(),this.microphoneId2uuid[t]=o),o}},r.prototype.getDeviceIdByUUID=function(e,t){var r=t;if(0==e){for(key in this.cameraId2uuid){if(this.cameraId2uuid[key]==t){r=key;break}}return r}if(1==e){for(key in this.speakerId2uuid){if(this.speakerId2uuid[key]==t){r=key;break}}return r}if(2==e){for(key in this.microphoneId2uuid){if(this.microphoneId2uuid[key]==t){r=key;break}}return r}},r.prototype.calInitVideoBitrate=function(e,t){var r=e*t,n=Math.sqrt(r),o=Math.log10(r),i=Math.log10(n),a=o*n/Math.pow(i,2)/10;1280<e&&(a*=Math.sqrt(e/1280));var s=2*parseInt(8*a);return{startBit:s,minBit:s/2,maxBit:2*s}},r.prototype.sendAddAnnotation=function(e,t,r,n,o,i,a){log.debug("===Room.sendAddAnnotation(),objectId:"+e+",shapeType:"+r+"，arrowtype:"+i+",fillType:"+a),this.masterServer.sendAddAnnotationMessage(e,t,r,n,o,i,a)},r.prototype.sendUpdateAnnotation=function(e,t,r){log.debug("===Room.sendUpdateAnnotation(),objectId:"+e+",shapeType:"+r),this.masterServer.sendUpdateAnnotationMessage(e,t,r)},r.prototype.sendRemoveAnnotation=function(e,t,r){log.debug("===Room.sendRemoveAnnotation(),objectId:"+e+",annotationType:"+t+",eraserIds:"+r),this.masterServer.sendRemoveAnnotationMessage(e,t,r)},r.prototype.initFakeVideoStream=function(e){for(var t=0;t<e;t++)getFakeVideoStream(function(e){this.fakeVideoStreams.push(e)})},r.prototype.initFakeAudioStream=function(e){for(var t=0;t<e;t++)getFakeAudioStream(function(e){this.fakeAudioStreams.push(e)})},r.prototype.addAnnotationMsg=function(e,t,r,n,o){log.debug("===room.addAnnotationMsg, updateAnnotationMsg:"+e.objectId+",isSelf:"+t+",isClear: "+r);if(this.annotation2boardId[e.objectId]){var i=this.annotation2boardId[e.objectId].storageArr,a=this.annotation2boardId[e.objectId].queueArr;if(e.annotationType!=shapeTypeEnum.hlight_point)if(0<i.length){for(var s=!1,d=0;d<i.length;d++)i[d].annotationId==e.annotationId&&(i[d].operType!=e.operType&&e.operType==OperType.remove&&(log.debug("===room.addAnnotationMsg, updateAnnotationMsg.remove, remove annotation from annotation2BoardId"),i.splice(d,1)),s=!0);s||e.operType==OperType.remove||i.push(e)}else i.push(e);t||a.push(e)}else this.annotation2boardId[e.objectId]={storageArr:[],queueArr:[]},e.annotationType!=shapeTypeEnum.hlight_point&&this.annotation2boardId[e.objectId].storageArr.push(e),t||this.annotation2boardId[e.objectId].queueArr.push(e);if(r&&this.annotation2boardId[e.objectId]&&0<this.annotation2boardId[e.objectId].storageArr.length)for(d=0;d<this.annotation2boardId[e.objectId].storageArr.length;d++){(l=this.annotation2boardId[e.objectId].storageArr[d]).operUserId==this.selfUser.id&&l.operType==OperType.add&&(this.annotation2boardId[e.objectId].storageArr.splice(d,1),d--)}if(e.operType==OperType.remove)for(d=0;d<this.annotation2boardId[e.objectId].storageArr.length;d++){if((l=this.annotation2boardId[e.objectId].storageArr[d]).annotationId==o&&l.operUserId==this.selfUser.id&&l.operType==OperType.add){delete l.imgZrender;break}}else for(d=0;d<this.annotation2boardId[e.objectId].storageArr.length;d++){var l;if((l=this.annotation2boardId[e.objectId].storageArr[d]).annotationId==o&&l.operUserId==this.selfUser.id&&l.operType==OperType.add){l.imgZrender=n,this.style2annotation[n.id]={style:JSON.stringify(n.style),position:JSON.stringify(n.position),scale:JSON.stringify(n.scale),origin:JSON.stringify(n.origin),rotation:JSON.stringify(n.rotation)};break}}},r.prototype.updateAnnotationDrow=function(e){log.debug("===room.updateAnnotationDrow, annotations: ",e);for(var t=this;0<e.length;){var r=e[0],n=this.getUser(this.boardId2userId[r.objectId]);if(!n)break;var o=n.getBoard(r.objectId);if(!o.annotation){clearTimeout(t.updateTimer),t.updateTimer=setTimeout(function(){t.updateAnnotationDrow(e)},100);break}switch(e.shift(),r.operType){case OperType.add:r.annotationType==shapeTypeEnum.line||r.annotationType==shapeTypeEnum.ellipse||r.annotationType==shapeTypeEnum.rect||r.annotationType==shapeTypeEnum.arrow||r.annotationType==shapeTypeEnum.success||r.annotationType==shapeTypeEnum.failure||r.annotationType==shapeTypeEnum.rhomb||r.annotationType==shapeTypeEnum.hlight_texttag||r.annotationType==shapeTypeEnum.hlight_point?o.annotation.drawToBoard(r.ann2pt):r.annotationType==shapeTypeEnum.polyline?o.annotation.drawToBoard(r.annMutlipt):r.annotationType==shapeTypeEnum.img?o.annotation.drawToBoard(r.Img):r.annotationType==shapeTypeEnum.txt&&o.annotation.drawTextToBoard(r);break;case OperType.remove:o.annotation.removeToBoard(r);break;case OperType.update:r.annotationType==shapeTypeEnum.img&&o.annotation.updateDrawToBoard(r.Img)}}},r.prototype.voiceActivatedHandler=function(){this.audioLevel&&this.audioLevel.start(500).then(function(e){var d=e;if(!d)return;clearInterval(d.statsIntervalId),d.statsIntervalId=setInterval(function(){var t={},e=0,r="",n=d.getParticipants(),o=d.getAppData(appDataKeyEnum.lecturer)?d.getAppData(appDataKeyEnum.lecturer):"",i=0;for(var a in n.forEach(function(e){e.audio&&(t[e.id]=e.audio.getAudioLevel())}),t)try{var s=t[a];a==o&&(i=s),e<s&&(e=s,r=a)}catch(e){log.error(e)}o!=r&&i<4&&3<=e-i&&(log.debug("===audioLevelHandler()发送更改语音激励通知，语音激励id:"+r+",值为"+e),d.updateAppData(appDataKeyEnum.lecturer,r))},3e3)}(this))},r.prototype.mp4ImporterUserAudioStateStart=function(e){log.debug("===room.mp4ImporterUserAudioStateStart()");var i=this;this&&(clearInterval(i.mp4ImporterUserAudioStateIntervalId),i.mp4ImporterUserAudioStateIntervalId=setInterval(function(){var e=function(e){var t=null;if(e){var r=e.participants.length;if(0<r)for(var n=0;n<r;n++){var o=e.participants[n];if("avd_mp4_importer"==o.userAgent){o.audio&&o.audio.track&&(t=o.audio.track.id);break}}}return t}(i);if(e&&i){for(var t,r=i.traceablePeerConnection.getToMCUPeerConnection().getReceivers(),n=0;n<r.length;n++){var o=r[n];if(o&&o.track&&o.track.id&&o.track.id==e){t=o;break}}t&&t.getStats().then(function(e){e.forEach(function(e){if("inbound-rtp"===e.type){var t=e.packetsLost,r=e.packetsReceived;i.mp4ImporterUserAudioRtpPacketTemp=t+r;var n=(i.mp4ImporterUserAudioRtpPacketTemp-i.mp4ImporterUserAudioRtpPacketReal)*i.mp4ImporterUserAudioRate;i.eventEmitter.emit(RoomCallback.mediaplay_progress_notify,n)}})})}else i.mp4ImporterUserAudioRtpPacketTemp=0,i.mp4ImporterUserAudioRtpPacketReal=0},e))},r.prototype.mp4ImporterUserAudioStateStop=function(){this.mp4ImporterUserAudioRtpPacketReal=this.mp4ImporterUserAudioRtpPacketTemp,this.mp4ImporterUserAudioStateIntervalId&&(clearInterval(this.mp4ImporterUserAudioStateIntervalId),this.mp4ImporterUserAudioStateIntervalId=null)},r.prototype.openReqSend=function(e){log.debug("===room.openReqSend()...");var t=when.defer();this.masterServer=new n(e,this),this.masterServer.openReqSend();var r=setTimeout(function(){var e=new c(1e4,"openReq send time out");t.reject(e)},5e3);return this.addCallback(EngineCallback.open_rep_return_0,function(){clearTimeout(r)}),this.addCallback(EngineCallback.room_join_success,function(e){clearTimeout(r),t.resolve(e)}),this.addCallback(EngineCallback.room_join_error,function(e){clearTimeout(r),t.reject(e)}),t.promise},r.prototype.openReqReconnectionSend=function(){log.debug("===room.openReqReconnectionSend()...");var t=when.defer();this.masterServer.openReqReconnectionSend();var r=setTimeout(function(){var e=new c(1e4,"openReq Reconnection send time out");t.reject(e)},5e3);return this.addCallback(EngineCallback.open_rep_return_0,function(){clearTimeout(r),t.resolve()}),this.addCallback(EngineCallback.room_join_error,function(e){clearTimeout(r),t.reject(e)}),t.promise},r.prototype.setRejoinTimeout=function(e){null!=e&&("number"!=typeof e||e<=6e4)?log.info("===room.setRejoinTimeout(), timeout: "+e+" is invalid to return"):this.rejoinTimeout=e},r.prototype.setRejoinInterval=function(e){null==e||"number"==typeof e?this.rejoinInterval=e:log.info("===room.setRejoinInterval(), rejoinInterval: "+e+" is invalid to return")},r.prototype.setSpeakerDevice=function(e,t){log.info("===room.setSpeakerDevice(),deviceId:"+e);var r=when.defer();if(t||(t=document.getElementsByTagName("audio")),void 0===t[0].sinkId){log.error("===room.setSpeakerDevice(),Browser does not support output device selection.");var n=new c(ErrorConstant.set_speakerDevice_notsupport_failed);return r.reject(n),r.promise}for(var o=0;o<t.length;o++){var i=t[o];i.setSinkId(e).then(function(){log.info("===room.setSpeakerDevice() Success, audio output device attached:"+e+"to element with "+i.title+"as source.")}).catch(function(e){var t;return t=("SecurityError"===e.name?log.error("===room.setSpeakerDevice(),You need to use HTTPS for selecting audio output device"):log.error("===room.setSpeakerDevice(),Error setting audio output device, error:"+JSON.stringify(e)),new c(ErrorConstant.set_speakerDevice_notsupport_failed)),r.reject(t),r.promise})}this.clientSetSpeakerDeviceId=e,r.resolve()},r.prototype.setSpeakerVolume=function(e,t){log.info("===room.setSpeakerVolume(),volume:"+e);var r=when.defer();t||(t=document.getElementsByTagName("audio"));for(var n=0;n<t.length;n++){t[n].volume=e}this.clientSetSpeakerVolume=e,r.resolve()},r}),sdpLines=function(e){return e.split("\r\n").filter(function(e){return 0<e.length})},sdpMline=function(e){for(var t=e.substr(2).split(" "),r={media:t[0],port:t[1],proto:t[2],formats:[]},n=3;n<t.length;n++)t[n]&&r.formats.push(t[n]);return r},findLineInFirefox=function(e,t,r){for(var n=e.length,o=0;o<t.length;o++)if(t[o].substr(0,n)===e)return t[o];if(!r)return!1;for(var i=0;i<r.length;i++)if(r[i].substr(0,n)===e)return r[i];return!1},findLinesInFirefox=function(e,t,r){for(var n=[],o=e.length,i=0;i<t.length;i++)t[i].substr(0,o)===e&&n.push(t[i]);if(n.length||!r)return n;for(var a=0;a<r.length;a++)r[a].substr(0,o)===e&&n.push(r[a]);return n},rtpmap=function(e){var t=e.substr(9).split(" "),r={id:t.shift()};return t=t[0].split("/"),r.name=t[0],r.clockrate=t[1],r.channels=3==t.length?t[2]:"1",r},sctpmap=function(e){var t=e.substr(10).split(" ");return{number:t.shift(),protocol:t.shift(),streams:t.shift()}},fmtp=function(e){for(var t,r,n,o=e.substr(e.indexOf(" ")+1).split(";"),i=[],a=0;a<o.length;a++)r=(t=o[a].split("="))[0].trim(),n=t[1],r&&n?i.push({key:r,value:n}):r&&i.push({key:"",value:r});return i},crypto=function(e){var t=e.substr(9).split(" ");return{tag:t[0],cipherSuite:t[1],keyParams:t[2],sessionParams:t.slice(3).join(" ")}},fingerprint=function(e){var t=e.substr(14).split(" ");return{hash:t[0],value:t[1]}},extmap=function(e){var t=e.substr(9).split(" "),r={},n=t.shift(),o=n.indexOf("/");return 0<=o?(r.id=n.substr(0,o),r.senders=n.substr(o+1)):(r.id=n,r.senders="sendrecv"),r.uri=t.shift()||"",r},rtcpfb=function(e){var t=e.substr(10).split(" "),r={};return r.id=t.shift(),r.type=t.shift(),"trr-int"===r.type?r.value=t.shift():r.subtype=t.shift()||"",r.parameters=t,r},sdpCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},n=8;n<t.length;n+=2)"raddr"===t[n]?r.relAddr=t[n+1]:"rport"===t[n]?r.relPort=t[n+1]:"generation"===t[n]?r.generation=t[n+1]:"tcptype"===t[n]&&(r.tcpType=t[n+1]);return r.network="1",r},sourceGroups=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].substr(13).split(" ");t.push({semantics:n.shift(),sources:n})}return t},sources=function(e){for(var t=[],r={},n=0;n<e.length;n++){var o=e[n].substr(7).split(" "),i=o.shift();if(!r[i]){var a={ssrc:i,parameters:[]};t.push(a),r[i]=a}var s=(o=o.join(" ").split(":")).shift(),d=o.join(":")||null;r[i].parameters.push({key:s,value:d})}return t},groups=function(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n].substr(8).split(" "),r.push({semantics:t.shift(),contents:t});return r},msidSemantics=function(e){for(var t,r=[],n=0;n<e.length;n++)t=e[n].substr(17).split(" "),r.push({semantics:t.shift(),contents:t});return r},bandwidth=function(e){var t=e.substr(2).split(":"),r={};return r.type=t.shift(),r.bandwidth=t.shift(),r},getSsrcBySdp=function(e){for(var t,r=e.split("\r\n"),n=0,o=0;o<r.length;o++)0<=r[o].indexOf("a=ssrc-group:SIM")&&(n=o);return 0<n?t=r[n].split(" ")[1]:(r[0]&&(t=r[0].split(" ")[0].split(":")[1]),t)},getCodecPayloadType=function(e,t){for(var r=[],n=e.split("\r\n"),o=findLine(n,"a=rtpmap",t),i=0;i<o.length;i++)r[i]=o?getCodecPayloadTypeFromLine(n[o[i]]):null;return r},getIceInfoBySDP=function(e){var t=e.split("\r\n"),r={},n=findLine(t,"a=","ice-ufrag");if(n&&0<n.length){var o=t[n[0]];r.ufrag=o.split(":")[1]}var i=findLine(t,"a=","ice-pwd");if(i&&0<i.length){o=t[i[0]];r.pwd=o.split(":")[1]}return r},getPayloadByProfileLevel=function(e,t){var r="",n=e.split("\r\n"),o=findLine(n,"a=fmtp","profile-level-id=42e01f");(null!=typeof t&&!0===t&&(o=findLine(n,"a=fmtp","profile-level-id=42001f")),o&&0<o.length)&&(r=n[o[0]].split(" ")[0].split(":")[1]);return r},getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},setReplaceCoding=function(e,t,r){var n=e.join(" "),o=t.split("\r\n"),i=findLine(o,"m=",r),a=o[i].split(" ").slice(0,3);a.push(n);var s=a.join(" ");return t=t.replace(o[i],s)},setReplaceMediaPayloads=function(e,t,r){var n=e.join(" "),o=t.split("\r\n"),i=findLine(o,"m=",r);if(0==i.length)return t;var a=o[i].split(" "),s=a.slice(0,3);s.push(n);var d=s.join(" ");t=t.replace(o[i],d);var l=a.slice(3,a.length),u=diff(l,e);t=(t=(t=setDeletedMediaPayloads(u,t)).replace(/a=setup:actpass/g,"a=setup:active")).replace(/a=recvonly/g,"a=sendrecv");for(var c=0;c<e.length;c++){t=t+"a=fmtp:"+e[c]+" x-google-max-bitrate=10000; x-google-min-bitrate=300; x-google-start-bitrate=645\r\n"}return t},setDeletedMediaPayloads=function(e,t){for(var r=0;r<e.length;r++)for(var n=t.split("\r\n"),o=findLine(n,"a=",":"+e[r]+" "),i=0;i<o.length;i++)t=t.replace(n[o[i]]+"\r\n","");return t},diff=function(e,t){for(var r=[],n=0;n<e.length;n++)-1===t.indexOf(e[n])&&r.push(e[n]);for(var o=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&o.push(t[i]);return r.concat(o)};var idCounter=Math.random();if(_setIdCounter=function(e){idCounter=e},toSessionJSON=function(e,t){var r,n=t.creators||[],o=t.role||"initiator",i=t.direction||"outgoing",a=e.split("\r\nm=");for(r=1;r<a.length;r++)a[r]="m="+a[r],r!==a.length-1&&(a[r]+="\r\n");var s=a.shift()+"\r\n",d=sdpLines(s),l={},u=[];for(r=0;r<a.length;r++)u.push(toMediaJSON(a[r],s,{role:o,direction:i,creator:n[r]||"initiator"}));l.contents=u;var c=findLinesInFirefox("a=group:",d);c.length&&(l.groups=groups(c));var p=findLinesInFirefox("a=msid-semantic:",d);return p.length&&(l.msidSemantics=msidSemantics(p)),l},toMediaJSON=function(e,t,r){var n=r.creator||"initiator",o=r.role||"initiator",i=r.direction||"outgoing",a=sdpLines(e),s=sdpLines(t),d=sdpMline(a[0]),l={creator:n,role:o,direction:i,name:d.media,description:{descType:"rtp",media:d.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};"application"==d.media&&(l.description={descType:"datachannel"},l.transport.sctp=[]);var u=l.description,c=l.transport,p=findLineInFirefox("a=mid:",a);if(p&&(l.name=p.substr(6)),findLineInFirefox("a=sendrecv",a,s)?l.senders="both":findLineInFirefox("a=sendonly",a,s)?l.senders=SENDERS[o][i].sendonly:findLineInFirefox("a=recvonly",a,s)?l.senders=SENDERS[o][i].recvonly:findLineInFirefox("a=inactive",a,s)&&(l.senders="none"),"rtp"==u.descType){var h=findLineInFirefox("b=",a);h&&(u.bandwidth=h(h));var f=findLineInFirefox("a=msid:",a);if(f.length){var m=f.substr(7).split(" "),g={};g.msid=f,g.streamId=m[0],g.trackId=m[1],u.msid=g}var v=findLineInFirefox("a=ssrc:",a);v&&(u.ssrc=v.substr(7).split(" ")[0]),findLinesInFirefox("a=rtpmap:",a).forEach(function(e){var t=rtpmap(e);t.parameters=[],t.feedback=[],findLinesInFirefox("a=fmtp:"+t.id,a).forEach(function(e){t.parameters=fmtp(e)}),findLinesInFirefox("a=rtcp-fb:"+t.id,a).forEach(function(e){t.feedback.push(rtcpfb(e))}),u.payloads.push(t)}),findLinesInFirefox("a=crypto:",a,s).forEach(function(e){u.encryption.push(crypto(e))}),findLineInFirefox("a=rtcp-mux",a)&&(u.mux=!0),findLinesInFirefox("a=rtcp-fb:*",a).forEach(function(e){u.feedback.push(rtcpfb(e))}),findLinesInFirefox("a=extmap:",a).forEach(function(e){var t=extmap(e);t.senders=SENDERS[o][i][t.senders],u.headerExtensions.push(t)});var y=findLinesInFirefox("a=ssrc-group:",a);u.sourceGroups=sourceGroups(y||[]);var _=findLinesInFirefox("a=ssrc:",a);u.sources=sources(_||[]),findLineInFirefox("a=x-google-flag:conference",a,s)&&(u.googConferenceFlag=!0)}var b=findLinesInFirefox("a=fingerprint:",a,s),S=findLineInFirefox("a=setup:",a,s);b.forEach(function(e){var t=fingerprint(e);S&&(t.setup=S.substr(8)),c.fingerprints.push(t)});var w=findLineInFirefox("a=ice-ufrag:",a,s),E=findLineInFirefox("a=ice-pwd:",a,s);w&&E&&(c.ufrag=w.substr(12),c.pwd=E.substr(10),c.candidates=[],findLinesInFirefox("a=candidate:",a,s).forEach(function(e){c.candidates.push(toCandidateJSON(e))}));"datachannel"==u.descType&&findLinesInFirefox("a=sctpmap:",a).forEach(function(e){var t=sctpmap(e);c.sctp.push(t)});return l},toCandidateJSON=function(e){var t=sdpCandidate(e.split("\r\n")[0]);return t.id=(idCounter++).toString(36).substr(0,12),t},toSessionSDP=function(e,t){t.role,t.direction;var r=["v=0","o=- "+(t.sid||e.sid||Date.now())+" "+(t.time||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"];return(e.groups||[]).forEach(function(e){r.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),(e.msidSemantics||[]).forEach(function(e){navigator.mozGetUserMedia?r.push("a=msid-semantic:"+e.semantics+" "+e.contents.join(" ")):r.push("a=msid-semantic: "+e.semantics+" "+e.contents.join(" "))}),(e.contents||[]).forEach(function(e){r.push(toMediaSDP(e,t))}),r.join("\r\n")+"\r\n"},toMediaSDP=function(e,t){var o=[],r=t.role||"initiator",n=t.direction||"outgoing",i=e.description,a=e.transport,s=i.payloads||[],d=a&&a.fingerprints||[],l=[];if("datachannel"==i.descType?(l.push("application"),l.push("1"),l.push("DTLS/SCTP"),a.sctp&&a.sctp.forEach(function(e){l.push(e.number)})):(l.push(i.media),l.push("1"),i.encryption&&0<i.encryption.length||0<d.length?l.push("RTP/SAVPF"):l.push("RTP/AVPF"),s.forEach(function(e){l.push(e.id)})),o.push("m="+l.join(" ")),o.push("c=IN IP4 0.0.0.0"),i.bandwidth&&i.bandwidth.type&&i.bandwidth.bandwidth&&o.push("b="+i.bandwidth.type+":"+i.bandwidth.bandwidth),"rtp"==i.descType&&o.push("a=rtcp:1 IN IP4 0.0.0.0"),a){a.ufrag&&o.push("a=ice-ufrag:"+a.ufrag),a.pwd&&o.push("a=ice-pwd:"+a.pwd);d.forEach(function(e){o.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&o.push("a=setup:"+e.setup)}),a.sctp&&a.sctp.forEach(function(e){o.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}return"rtp"==i.descType&&o.push("a="+(SENDERS[r][n][e.senders]||"sendrecv")),o.push("a=mid:"+e.name),i.msid&&o.push(i.msid.msid),i.mux&&o.push("a=rtcp-mux"),(i.encryption||[]).forEach(function(e){o.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),i.googConferenceFlag&&o.push("a=x-google-flag:conference"),s.forEach(function(t){var e="a=rtpmap:"+t.id+" "+t.name+"/"+t.clockrate;if(t.channels&&"1"!=t.channels&&(e+="/"+t.channels),o.push(e),t.parameters&&t.parameters.length){var r=["a=fmtp:"+t.id],n=[];t.parameters.forEach(function(e){n.push((e.key?e.key+"=":"")+e.value)}),r.push(n.join(";")),o.push(r.join(" "))}t.feedback&&t.feedback.forEach(function(e){"trr-int"===e.type?o.push("a=rtcp-fb:"+t.id+" trr-int "+e.value?e.value:"0"):o.push("a=rtcp-fb:"+t.id+" "+e.type+(e.subtype?" "+e.subtype:""))})}),i.feedback&&i.feedback.forEach(function(e){"trr-int"===e.type?o.push((e.value,e.value)):o.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))}),(i.headerExtensions||[]).forEach(function(e){o.push("a=extmap:"+e.id+(e.senders?"/"+SENDERS[r][n][e.senders]:"")+" "+e.uri)}),(i.sourceGroups||[]).forEach(function(e){o.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))}),(i.sources||[]).forEach(function(e){for(var t=0;t<e.parameters.length;t++){var r=e.parameters[t];o.push("a=ssrc:"+(e.ssrc||i.ssrc)+" "+r.key+(r.value?":"+r.value:""))}}),(a.candidates||[]).forEach(function(e){o.push(toCandidateSDP(e))}),o.join("\r\n")},toCandidateSDP=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"srflx"!==r&&"prflx"!==r&&"relay"!==r||e.relAddr&&e.relPort&&(t.push("raddr"),t.push(e.relAddr),t.push("rport"),t.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(t.push("tcptype"),t.push(e.tcpType)),t.push("generation"),t.push(e.generation||"0"),"a=candidate:"+t.join(" ")},ModuleBase.define("TraceableWebsocket",["MessageManager","Error"],function(a,s){var e=function(e){this.roomHandle=e,this.webSocket};return e.prototype.connect=function(){var t=this,r=when.defer();try{var e=document.location.protocol;"httpsionic:"==e&&(e="https:"),"http:"!=e&&"https:"!=e&&"httpsionic:"!=e&&(e="http:"),avdEngineHandle.applyToElectron&&(e=avdEngineHandle.electronProtocol),avdEngineHandle.restFullProtocol&&(e=avdEngineHandle.restFullProtocol);var n="ws://";"https:"==e&&(n="wss://");var o=n+avdEngineHandle.restServerInfo.roomServerUrl+"/ws";log.info("===webSocket,connect(), websocket URL:"+o),avdEngineHandle.loggerReport.info("websocket,connect(), websocket url:"+o),webSocket=new WebSocket(o),webSocket.binaryType="arraybuffer",webSocket.readyState==WebSocket.CONNECTING&&(log.info("===webSocket,connect(), 连接正在建立..."),avdEngineHandle.loggerReport.info("webSocket,connect(),连接正在建立...")),webSocket.onopen=function(){webSocket.readyState==WebSocket.OPEN&&(log.info("===webSocket,onopen(), 连接已打开!"),avdEngineHandle.loggerReport.info("webSocket,onopen(),连接已打开!")),r.resolve(webSocket)},webSocket.onmessage=function(e){new a(t.roomHandle).OnWebSocketMessage(e.data)},webSocket.onclose=function(e){log.info("===webSocket,onclose(), 连接已关闭！关闭原因："+e.code),avdEngineHandle.loggerReport.info("webSocket,onclose(),连接已关闭！关闭原因："+e.code+"，需要处理")},webSocket.onerror=function(e){log.info("===webSocket,onerror(), 连接发生错误。"),avdEngineHandle.loggerReport.info("webSocket,onerror(), 连接发生错误。");var t=new s(ErrorConstant.websock_catch_exception);r.reject(t)}}catch(e){log.info("===websocket Operation  failed. with exception:"+e);var i=new s(ErrorConstant.websock_catch_exception);r.reject(i)}return r.promise},e.prototype.close=function(){webSocket&&webSocket.readyState==WebSocket.OPEN&&webSocket.close()},e}),ModuleBase.define("TraceablePeerConnection",["Error"],function(e){var t=function(e){this.roomHandle=e,avdEngineHandle.restServerInfo.iceServers&&0<avdEngineHandle.restServerInfo.iceServers.length?this.iceConfig={iceServers:[{url:avdEngineHandle.restServerInfo.stunUrl},{url:avdEngineHandle.restServerInfo.trunUrl,credential:avdEngineHandle.restServerInfo.iceCredential,username:avdEngineHandle.restServerInfo.iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googCpuOveruseDetection:!1}]},this.constraints={}};t.prototype.getToMCUPeerConnection=function(){return 0<this.roomHandle.currentReconnectTimes?(null==this.roomHandle.toMCUReconnectionPC&&(this.roomHandle.toMCUReconnectionPC=this.createMCUPeerConnection()),this.roomHandle.toMCUReconnectionPC):(null==this.roomHandle.selfUser.toMCUPC&&(this.roomHandle.selfUser.toMCUPC=this.createMCUPeerConnection()),this.roomHandle.selfUser.toMCUPC)},t.prototype.createMCUPeerConnection=function(){var e=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnection(e,this.roomHandle),"getConfiguration"in window.RTCPeerConnection.prototype&&log.debug("===createPeerConnectionInner(),PeerConnection Configuration:"+JSON.stringify(e.getConfiguration())),e},t.prototype.handleMCUPeerConnection=function(r,e){var t=when.defer();return r.msgQueue=[],r.forLog=!1,r.roomHandle=e,r.onicecandidate=function(e){},r.onopen=function(){},r.ontrack=function(e){log.debug("===pc.ontrack()")},r.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("===oniceconnectionstatechange(),MCU iceConnectionState:"+t),avdEngineHandle.loggerReport.info("===Peerconnection iceConnectionState:"+t),t){case"disconnected":log.debug("===TraceablePeerConnection.handleMCUPeerConnection() oniceconnectionstatechange iceConnectionState= disconnected,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connecting),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),log.info("===oniceconnectionstatechange(),iceConnectionState is disconnected, to room.iCERestart()"),this.roomHandle.iCERestart();break;case"failed":log.info("===oniceconnectionstatechange(),iceConnectionState is failed, to room.iCERestart()"),this.roomHandle.iCERestart();break;case"completed":break;case"connected":this.roomHandle.connectionInfoCollector||(this.roomHandle.connectionInfoCollector=new ConnectionInfoCollector(r,1e3)),log.debug("===TraceablePeerConnection.handleMCUPeerConnection() oniceconnectionstatechange iceConnectionState= connected,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connected),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected),this.roomHandle.eventEmitter.emit(RoomCallback.mcu_peerconnection_completed,MCUPeerConnectionStatus.completed)}},r.onsignalingstatechange=function(e){log.debug("===onsignalingstatechange(),MCU signalingState:"+e.target.signalingState),"stable"==e.target.signalingState?0==r.forLog&&(r.forLog=!0,r.intervalSet(r)):"closed"==e.target.signalingState&&this.roomHandle.connectionInfoCollector&&(log.debug("===PC.onsignalingstatechange(),signalingState=closed,Peerconnection已关闭，停止网络连接情况指示器收集"),this.roomHandle.connectionInfoCollector.stop())},r.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},100)},r.processSignalingMessage=function(e){var t=this;if(t.roomHandle&&0!=t.roomHandle.addSdpLocalStates&&log.debug("===DDDDDDD_9999999999999,pc.processSignalingMessage(),room.addSdpLocalStates:"+t.roomHandle.addSdpLocalStates),t.roomHandle&&0==t.roomHandle.addSdpLocalStates&&0==t.roomHandle.currentReconnectTimes&&"stable"==e.signalingState&&0==t.roomHandle.pingCountTime&&0<e.msgQueue.length){var r=e.msgQueue.pop();"add"==r.operationType?(log.debug("===操作对列:operationType:add,resourceType:"+r.para1+",resourceId:"+r.para2),function(g,o,e,s,v){v.addSdpLocalStates=1,log.debug("===DDDDDDD_1111111111_0000000000,addSdpHandle(),room.addSdpLocalStates:"+v.addSdpLocalStates),clearTimeout(w),w=setTimeout(function(){v&&(v.addSdpLocalStates=0,log.debug("===DDDDDDD_11111111111_111111111,addSdpHandle(),setTimeout room.addSdpLocalStates:"+v.addSdpLocalStates))},3e3);for(var y,t,i=null,r=0;r<v.midObjSet.length;r++){var n=v.midObjSet[r];if(n.type==g&&!n.isSender){i=n;break}}var _=!1,a=null;-1<o.indexOf("screen_audio")&&(_=!0);if("audio"!=g||_)if("video"==g){var d=v.getDeviceIdByUUID(0,o);y=v.selfUser.getVideo(d),t=v.videoMediaTemplate,a=v.selfUser.stream}else"screen"==g?(y=v.selfUser.getScreen(o),t=v.videoMediaTemplate,a=v.selfUser.screenStream):"audio"==g&&_&&(y=v.selfUser.screen.screenAudio,t=v.audioMediaTemplate,a=v.selfUser.screenStream);else{var d=v.getDeviceIdByUUID(2,o);y=v.selfUser.getAudio(d),t=v.audioMediaTemplate,a=v.selfUser.stream}t.fingerprint&&(t.fingerprint.type="sha-1",t.fingerprint.hash=v.fingerPrint);var l=e.getTracks()[0],b=null,u=null,S=new SDPTransform;if(i){if(log.debug("===addSdpHandle(), resourceType:"+g+", currMidObj:"+JSON.stringify(i)),u=U(i.mid,v),log.debug("===addSdpHandle(), resourceType:"+g+", currMidObj.mid:"+i.mid+",currTransceiver:",u),!u)return log.debug("===addSdpHandle(), resourceType:"+g+", currMidObj.mid:"+i.mid+", currTransceiver is null, to return"),v.addSdpLocalStates=0;u.sender.replaceTrack(l),void 0!==u.sender.setStreams&&u.sender.setStreams(a),i.isReceiver?u.direction="sendrecv":u.direction="sendonly",i.isSender=!0,y.RTCRtpSender=u.sender,y.mid=u.mid;var c=S.parse(v.remoteDescriptionSDP);c.media.forEach(function(e){e.mid==i.mid&&(i.isReceiver?e.direction="sendrecv":e.direction="recvonly")}),v.remoteDescriptionSDP=S.writer(c)}else{v.midNum=v.midNum+1;var p={mid:v.midNum,type:g,isReceiver:!1,isSender:!0,receiverInfo:{trackId:"",nodeId:"",deviceId:""}};v.midObjSet.push(p),t.mid=v.midNum,t.direction="recvonly";var h=S.mediaWriter(t);v.remoteDescriptionSDP=v.remoteDescriptionSDP+h;var c=S.parse(v.remoteDescriptionSDP);c.groups[0].mids=c.groups[0].mids+" "+v.midNum,v.remoteDescriptionSDP=S.writer(c)}var f={};f.sdp=v.remoteDescriptionSDP,f.type="offer",log.debug("===addSdpHandle(),resourceType:"+g+",remote offer description:"+f.sdp);var m=new RTCSessionDescription(f);v.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(m).then(function(){if(log.info("===addSdpHandle(),resourceType:"+g+",success to add remote description"),!i){var e=U(v.midNum,v);if(log.debug("===addSdpHandle(),room.midNum:"+v.midNum+",transceiver:",e),!e)return log.debug("===addSdpHandle(), resourceType:"+g+", room.midNum:"+v.midNum+", transceiver is null, to return"),void(v.addSdpLocalStates=0);e.sender.replaceTrack(l),void 0!==e.sender.setStreams&&e.sender.setStreams(a),e.direction="sendonly",y.RTCRtpSender=e.sender,y.mid=e.mid}if(avdEngineHandle.simulcastEnabled&&avdEngineHandle.isFirefox&&"video"==g){var t=y.RTCRtpSender,r={},n=E(y)+1;1==n?r.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1}]:2==n?r.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1},{rid:"medium",active:!0,priority:"medium",scaleResolutionDownBy:2}]:3==n&&(r.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1},{rid:"medium",active:!0,priority:"medium",scaleResolutionDownBy:2},{rid:"low",active:!0,priority:"low",scaleResolutionDownBy:4}]),t.setParameters(r)}v.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,v.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,v.icePwd);var m="",t=S.parse(e.sdp);t.media.forEach(function(r){if(avdEngineHandle.simulcastEnabled&&!avdEngineHandle.isFirefox&&"video"==g&&"video"==r.type&&r.ssrcs&&0<r.ssrcs.length){for(var e=null,t=0;t<v.selfUser.videos.length;t++){var n=v.selfUser.videos[t];if(r.mid==n.mid){e=E(n);break}}e&&function(t,e){for(var r=(i=t.ssrcs)[0].id,n=i.length-1;0<=n;n--){var o=i[n];o.id!=r&&i.splice(n,1)}var i=[r],a=r+2e3,s=r+4e3,d=I(t.ssrcs),l=I(t.ssrcs);if(1<=e){for(var u=!1,c=0;c<t.ssrcs.length;c++){var o=t.ssrcs[c];if(o.id==a){u=!0;break}}u||(d.forEach(function(e){e.id=a,t.ssrcs.push(e)}),i.push(a))}if(2<=e){for(var p=!1,c=0;c<t.ssrcs.length;c++){var o=t.ssrcs[c];if(o.id==s){p=!0;break}}p||(l.forEach(function(e){e.id=s,t.ssrcs.push(e)}),i.push(s))}t.ssrcGroups=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:i.join(" ")})}(r,e)}var o=_?"audio":g;if("screen"==o&&(o="video"),log.debug("===addSdpHandle(),mediaObj.type:"+r.type+",mediaType:"+o+",mediaObj.mid:"+r.mid+",media.mid:"+y.mid),r.type==o&&r.mid==y.mid){var i=r.msid;i?(log.debug("===addSdpHandle(),msid:"+i),b=i.split(" ")[1]):r.ssrcs.forEach(function(e){if("msid"==e.attribute){var t=e.value;t&&(b=t.split(" ")[1])}});for(var a=!1,t=0;t<r.ssrcs.length;t++){var s=r.ssrcs[t];if("msid"==s.attribute){a=!0;break}}if(!a){log.debug("===addSdpHandle(),ssrc片段中不含有msid信息，做手动补上处理。");for(var d=[],t=0;t<r.ssrcs.length;t++){var s=r.ssrcs[t],l={id:s.id,attribute:"msid",value:i};d.push(l)}r.ssrcs=r.ssrcs.concat(d)}if(m=S.ssrcGroupsAndSsrcsWriter(r.ssrcGroups,r.ssrcs),avdEngineHandle.isFirefox){var u=i.split(" "),c=u[0],p=u[1];if(avdEngineHandle.simulcastEnabled){var h="a=ssrc-group:SIM";r.ssrcs.forEach(function(e){var t=e.id;h=h+" "+t,m=(m=(m=m+"a=ssrc:"+t+" msid:"+i)+"\r\na=ssrc:"+t+" mslabel:"+c)+"\r\na=ssrc:"+t+" label:"+p,key<r.ssrcs.length&&(m+="\r\n")}),m=h+"\r\n"+m}else if(1==r.ssrcs.length){var f=r.ssrcs[0].id;m=(m=(m=m+"a=ssrc:"+f+" msid:"+i)+"\r\na=ssrc:"+f+" mslabel:"+c)+"\r\na=ssrc:"+f+" label:"+p}}y.ssrcStr=m}}),log.debug("===addSdpHandle(),resourceType:"+g+",trackId:"+b+",ssrc:"+m),e.sdp=S.writer(t),log.debug("===addSdpHandle(),resourceType:"+g+",local answer description:"+e.sdp),v.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){log.info("===addSdpHandle(),resourceType:"+g+",success to add local description");var e=y.publishKeepAliveTime;e||(e=avdEngineHandle.defaultMediaPublishKeepAliveTime),v.masterServer.pubRoomResourceMsg(g,b,m,o,s,e),v.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){if(e==s&&(clearTimeout(w),v.addSdpLocalStates=0,log.debug("===DDDDDDD_1111111111_222222222,addSdpHandle() pub_roomresourcemsg_rep_success,room.addSdpLocalStates:"+v.addSdpLocalStates),"audio"!=g&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype)){var t=y.RTCRtpSender;if(t){var r=t.getParameters();r.encodings?r.encodings==[]&&(r.encodings[0]={}):r.encodings=[{}];var n=null,o=!1;if(y.clientSetMaxBandwidth?(n=y.clientSetMaxBandwidth,o=!0):n=y.maxBandwidth,n&&0!=n){if(!avdEngineHandle.isFirefox){var i=r.encodings.length;1==i?r.encodings[0].maxBitrate=1e3*n:2==i?(r.encodings[0].maxBitrate=500*n,r.encodings[1].maxBitrate=1e3*n):3==i&&(r.encodings[0].maxBitrate=250*n,r.encodings[1].maxBitrate=500*n,r.encodings[2].maxBitrate=1e3*n)}if(avdEngineHandle.isFirefox){var i=r.encodings.length;1==i?r.encodings[0].maxBitrate=1e3*n:2==i?(r.encodings[0].maxBitrate=1e3*n,r.encodings[1].maxBitrate=500*n):3==i&&(r.encodings[0].maxBitrate=1e3*n,r.encodings[1].maxBitrate=500*n,r.encodings[2].maxBitrate=250*n)}}else for(var a=0;a<r.encodings.length;a++)delete r.encodings[a].maxBitrate;t.setParameters(r).then(function(){log.info("===addSdpHandle(),resourceType:"+g+",带宽值由应用层调接口设置:"+o+",带宽设置成功,maxBitrate:"+n+",id:"+y.id),"video"==g&&y.sendVideoStreamControl(n,y.resolution.width,y.resolution.height)}).catch(function(e){log.error("===addSdpHandle(),resourceType:"+g+",带宽值由应用层调接口设置:"+o+",带宽设置失败,maxBitrate:"+n+",error:",e)})}}}),v.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==s&&(clearTimeout(w),v.addSdpLocalStates=0,log.debug("===DDDDDDD_11111111111_4444444444,addSdpHandle() pub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+v.addSdpLocalStates),log.error("===addSdpHandle(),resourceType:"+g+",Failed to pub, by acception PUB_ROOM_RESOURCE_MSG_REP result !=0."))})}).catch(function(e){v.addSdpLocalStates=0,log.debug("===DDDDDDD_11111111111_3333333333,addSdpHandle() pub_roomresourcemsg_rep_success  error,room.addSdpLocalStates:"+v.addSdpLocalStates),log.error("===addSdpHandle(), resourceType:"+g+",Failed to add local description: "+e.toString())})}).catch(function(e){O(e,v)})}).catch(function(e){log.error("===addSdpHandle(),resourceType:"+g+", Failed to add remote description: "+e.toString())})}(r.para1,r.para2,r.para3,r.para4,t.roomHandle)):"update"==r.operationType?(log.debug("===操作对列:operationType:update,resourceType:"+r.para1+",updateType:"+r.para2+",resourceId:"+r.resourceId),function(e,v,y,_,r,b,S){if(!_)return;if("video"==v){var t=new SDPTransform,n=t.parse(_.stream.sdp),o=-1,i=!1,a=!1;if(null!=n.ssrcGroups&&0<n.ssrcGroups.length){for(var s=0;s<n.ssrcGroups.length;s++){var d=n.ssrcGroups[s];"FEC-FR"==d.semantics&&(i=!0),"SIM"==d.semantics&&(a=!0)}if(i&&a){for(var s=0;s<n.ssrcGroups.length;s++){var d=n.ssrcGroups[s];"FEC-FR"==d.semantics&&(o=s)}n.ssrcGroups.splice(o,1),_.stream.sdp=t.writer(n)}}}S.addSdpLocalStates=1,log.debug("===DDDDDDD_2222222222_0000000000,updateSdpHandle(),room.addSdpLocalStates:"+S.addSdpLocalStates+",resourceType:"+v+",updateType:"+y+",resourceId:"+e),clearTimeout(A),A=setTimeout(function(){S.addSdpLocalStates=0,log.debug("===DDDDDDD_2222222222_1111111111,updateSdpHandle(),setTimeout room.addSdpLocalStates:"+S.addSdpLocalStates)},3e3);var w,E=_.stream.stream_name,l=null;if(0==y){for(var u=0;u<S.midObjSet.length;u++){var I=S.midObjSet[u];if(I.type==v&&I.receiverInfo&&I.receiverInfo.trackId==E){l=I;break}}var c="null";if(l&&(c=JSON.stringify(l)),log.debug("===updateSdpHandle(),updateType:0,resourceType:"+v+",ownerId:"+_.owner_id+",trackId:"+E+",currMidObj:"+c),l){if(w=l.mid,!(g=U(l.mid,S)))return log.debug("===updateSdpHandle(),updateType:0,resourceType:"+v+",ownerId:"+_.owner_id+",currMidObj.mid:"+l.mid+", currTransceiver is null, to return"),S.addSdpLocalStates=0;l.isSender?g.direction="sendonly":g.direction="recvonly",l.isReceiver=!1}for(var p=new SDPTransform,h=p.parse(S.remoteDescriptionSDP),f=p.parse(_.stream.sdp),u=0;u<h.media.length;u++){var m=h.media[u];if(l&&m.mid==l.mid){m.ssrcGroups=[],m.ssrcs=[],"audio"==v?l.isSender?m.direction="recvonly":m.direction="sendonly":m.direction="sendrecv";break}}S.remoteDescriptionSDP=p.writer(h)}else if(1==y){for(var l=null,u=0;u<S.midObjSet.length;u++){var I=S.midObjSet[u];if(I.type==v&&!I.isReceiver&&I.receiverInfo&&""==I.receiverInfo.trackId){l=I;break}}var c="null";l&&(c=JSON.stringify(l)),log.debug("===updateSdpHandle(),updateType:1,resourceType:"+v+",ownerId:"+_.owner_id+",trackId:"+E+",currMidObj:"+c);var g=null;if(l){if(w=l.mid,!(g=U(l.mid,S)))return log.debug("===updateSdpHandle(),updateType:1,resourceType:"+v+",ownerId:"+_.owner_id+",currMidObj.mid:"+l.mid+", currTransceiver is null, to return"),S.addSdpLocalStates=0;l.isSender?g.direction="sendrecv":g.direction="recvonly",l.isReceiver=!0,l.receiverInfo={trackId:E,nodeId:_.owner_id,deviceId:_.resource_id},log.debug("===updateSdpHandle(),updateType:1,resourceType:"+v+",ownerId:"+_.owner_id+",trackId:"+E+",currMidObj != null,trackId:"+E+",currMidObj:"+JSON.stringify(l))}else{S.midNum=S.midNum+1,w=S.midNum;var T={mid:S.midNum,type:v,isReceiver:!0,isSender:!1,receiverInfo:{trackId:E,nodeId:_.owner_id,deviceId:_.resource_id}};log.debug("===updateSdpHandle(),updateType:1,resourceType:"+v+",ownerId:"+_.owner_id+",trackId:"+E+",currMidObj = null,trackId:"+E+",newMidObj:"+JSON.stringify(T)),S.midObjSet.push(T)}var p=new SDPTransform;if(l){for(var h=p.parse(S.remoteDescriptionSDP),f=p.parse(_.stream.sdp),u=0;u<h.media.length;u++){var m=h.media[u];if(m.mid==l.mid){m.ssrcGroups=f.ssrcGroups,m.ssrcs=f.ssrcs,f.msid&&(m.msid=f.msid),l.isSender?m.direction="sendrecv":m.direction="sendonly";break}}if(f.msid){var C=f.msid.split(" ")[0];h.msidSemantic.token=h.msidSemantic.token+" "+C}S.remoteDescriptionSDP=p.writer(h)}else{var R;"audio"==v?R=S.audioMediaTemplate:"video"!=v&&"screen"!=v||(R=S.videoMediaTemplate),R.fingerprint&&(R.fingerprint.type="sha-1",R.fingerprint.hash=S.fingerPrint),R.mid=S.midNum,R.direction="sendonly";var P=p.mediaWriter(R);S.remoteDescriptionSDP=S.remoteDescriptionSDP+P+_.stream.sdp;var k=p.parse(S.remoteDescriptionSDP);k.groups[0].mids=k.groups[0].mids+" "+S.midNum,S.remoteDescriptionSDP=p.writer(k)}}var x={};x.sdp=S.remoteDescriptionSDP,x.type="offer";var M=new RTCSessionDescription(x);log.debug("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",remote offer description:"+x.sdp),S.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(M).then(function(){log.info("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",success to add remote description"),S.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,S.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,S.icePwd),log.debug("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",local answer description:"+e.sdp),S.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){S.addSdpLocalStates=0,log.debug("===DDDDDDD_2222222222_2222222222,updateSdpHandle(),room.addSdpLocalStates:"+S.addSdpLocalStates),log.info("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",success to add local description"),S.masterServer.subRoomResourceMsg(v,y,_,r,b);var e=EngineCallback.sub_roomresourcemsg_rep_success,t=EngineCallback.sub_roomresourcemsg_rep_error;0==y&&(e=EngineCallback.unsub_roomresourcemsg_rep_success,t=EngineCallback.unsub_roomresourcemsg_rep_error),S.addCallback(e,function(e){if(clearTimeout(A),e==b){var t=S.getUserByNodeId(_.owner_id),r=!1;-1<_.resource_id.indexOf("screen_audio")&&(r=!0);for(var n=null,o=0;o<S.midObjSet.length;o++)if(I.type==v&&I.mid==w){n=I;break}var i,a=U(w,S);if(a&&(i=a.receiver.track),t&&("audio"==v||r)){var s=null;if("audio"!=v||r?"audio"==v&&r&&(s=t.getScreenAudio()):s=t.getAudio(_.resource_id),s)if(1==y){var d=!1;S.selfUser.subAudioIds.forEach(function(e){e==s.id&&(d=!0)}),d||S.selfUser.subAudioIds.push(s.id),s.track=i;var l=new MediaStream;l.addTrack(i),log.info("===audio updateSdpHandle() add, callback subscrible_microphone_result userId:"+t.id+",userName:"+t.name+",resourceId:"+_.resource_id),"audio"!=v||r?"audio"==v&&r&&t.eventEmitter.emit(UserCallback.subscrible_screen_audio_result,l,t.id,t.name):t.eventEmitter.emit(UserCallback.subscrible_microphone_result,l,t.id,t.name)}else 0==y&&(arrayUtil.baseSplice(S.selfUser.subAudioIds,s.id),s.track=null,log.info("===audio updateSdpHandle() remove,callback unsubscrible_microphone_result userId:"+t.id+",userName:"+t.name),"audio"!=v||r?"audio"==v&&r&&t.eventEmitter.emit(UserCallback.unsubscrible_screen_audio_result,t.id,t.name):t.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,t.id,t.name),n&&(n.receiverInfo={trackId:"",nodeId:"",deviceId:""}))}else if(t&&"video"==v){var u=t.getVideo(_.resource_id);if(u)if(1==y){var d=!1;S.selfUser.subVideoIds.forEach(function(e){e==u.id&&(d=!0)}),d||S.selfUser.subVideoIds.push(u.id),u.track=i;var c=new MediaStream;c.addTrack(i),log.info("===video updateSdpHandle add,callback subscrible_camera_result userId:"+t.id+",userName:"+t.name+",resourceId:"+_.resource_id),t.eventEmitter.emit(UserCallback.subscrible_camera_result,c,t.id,t.name,_.resource_id)}else if(0==y){arrayUtil.baseSplice(S.selfUser.subVideoIds,u.id),u.track=null;var p="null";n&&(p=n.mid),log.info("===video updateSdpHandle remove,callback unsubscrible_camera_result userId:"+t.id+",userName:"+t.name+",videoId:"+_.resource_id+",trackId:"+E+",tempMidObjMid:"+p),t.eventEmitter.emit(UserCallback.unsubscrible_camera_result,t.id,t.name,_.resource_id),n&&(n.receiverInfo={trackId:"",nodeId:"",deviceId:""})}}else if(t&&"screen"==v){var h=t.getScreen(_.resource_id);if(h)if(1==y){var f=!1;S.selfUser.subScreenIds.forEach(function(e){e==h.id&&(f=!0)}),f||S.selfUser.subScreenIds.push(h.id),h.track=i;var m=new MediaStream;m.addTrack(i);var g=_.stream;log.info("===screen updateSdpHandle add,callback subscrible_screen_result userId:"+t.id+",userName:"+t.name+",resourceId:"+_.resource_id),t.eventEmitter.emit(UserCallback.subscrible_screen_result,m,t.id,t.name,_.resource_id,g.width,g.height,g.frame_rate)}else 0==y&&(arrayUtil.baseSplice(S.selfUser.subScreenIds,h.id),h.track=null,log.info("===screen updateSdpHandle remove,callback unsubscrible_screen_result  userId:"+t.id+",userName:"+t.name),t.eventEmitter.emit(UserCallback.unsubscrible_screen_result,t.id,t.name,_.resource_id),n&&(n.receiverInfo={trackId:"",nodeId:"",deviceId:""}))}}}),S.addCallback(t,function(e,t){clearTimeout(A),S.addSdpLocalStates=0,1==y?(log.debug("===DDDDDDD_2222222222_3333333333,upateSdpHandle() sub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+S.addSdpLocalStates),log.error("===updateSdpHandle(), resourceType:"+v+",updateType:"+y+",Failed to sub, by acception SUB_ROOM_RESOURCE_MSG_REP result !=0.")):(log.debug("===DDDDDDD_2222222222_4444444444,upateSdpHandle() unsub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+S.addSdpLocalStates),log.error("===updateSdpHandle(), resourceType:"+v+",updateType:"+y+",Failed to sub, by acception UNSUB_ROOM_RESOURCE_MSG_REP result !=0."))})}).catch(function(e){S.addSdpLocalStates=0,log.debug("===DDDDDDD_2222222222_5555555555,updateSdpHandle() error,room.addSdpLocalStates:"+S.addSdpLocalStates),log.error("===updateSdpHandle(),resourceType:"+v+",Failed to add local description,error:"+e.toString())})}).catch(function(e){O(e,S)})}).catch(function(e){log.error("===updateSdpHandle(),resourceType:"+v+",Failed to add remote description,error:"+e.toString())})}(r.resourceId,r.para1,r.para2,r.para3,r.para4,r.para5,t.roomHandle)):"reduce"==r.operationType?(log.debug("===操作对列:operationType:reduce,resourceType:"+r.para1+",resourceId:"+r.para2),function(r,t,n,o,i){var a;i.addSdpLocalStates=1,log.debug("===DDDDDDD_4444444444_0000000000,reduceSdpHandle(),room.addSdpLocalStates:"+i.addSdpLocalStates),clearTimeout(m),m=setTimeout(function(){i&&(i.addSdpLocalStates=0,log.debug("===DDDDDDD_4444444444_1111111111,reduceSdpHandle(),setTimeout room.addSdpLocalStates:"+i.addSdpLocalStates))},3e3);var e=!1;-1<t.indexOf("screen_audio")&&(e=!0);if("audio"!=r||e)if("video"==r){var s=i.getDeviceIdByUUID(0,t);a=i.selfUser.getVideo(s)}else"screen"==r?a=i.selfUser.screen:"audio"==r&&e&&(a=i.selfUser.screen.screenAudio);else a=i.selfUser.audio;for(var d=null,l=0;l<i.midObjSet.length;l++){var u=i.midObjSet[l];if(u.type==r&&u.mid==a.mid){d=u;break}}if(!d)return log.debug("===reduceSdpHandle(),resourceType:"+r+", currMidObj is null, to return"),i.addSdpLocalStates=0;a&&a.RTCRtpSender&&i.traceablePeerConnection.getToMCUPeerConnection().removeTrack(a.RTCRtpSender);d.isSender=!1,U(a.mid,i).direction="recvonly";var c=new SDPTransform,p=c.parse(i.remoteDescriptionSDP);p.media.forEach(function(e){e.mid==a.mid&&(e.direction="sendonly")}),i.remoteDescriptionSDP=c.writer(p);var h={};h.sdp=i.remoteDescriptionSDP,h.type="offer",log.debug("===reduceSdpHandle(),resourceType:"+r+",remote offer description:"+h.sdp);var f=new RTCSessionDescription(h);i.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(f).then(function(){log.info("===reduceSdpHandle(),resourceType:"+r+",success to add remote description"),i.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,i.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,i.icePwd),log.debug("===reduceSdpHandle(),resourceType:"+r+",local answer description:"+e.sdp),i.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){log.info("===reduceSdpHandle(),resourceType:"+r+",success to add local description");var e=n.getTracks()[0];i.masterServer.unpubRoomResourceMsg(r,e.id,t,o),i.addCallback(EngineCallback.unpub_roomresourcemsg_rep_success,function(e){e==o&&(clearTimeout(m),i.addSdpLocalStates=0,log.debug("===DDDDDDD_4444444444_2222222222,reduceSdpHandle(),room.addSdpLocalStates:"+i.addSdpLocalStates))}),i.addCallback(EngineCallback.unpub_roomresourcemsg_rep_error,function(e,t){t==o&&(clearTimeout(m),log.debug("===DDDDDDD_4444444444_4444444444,reduceSdpHandle() unpub_roomresourcemsg_rep_error ,room.addSdpLocalStates:"+i.addSdpLocalStates),log.error("===reduceSdpHandle(),resourceType:"+r+",Failed to unpub, by acception UNPUB_ROOM_RESOURCE_MSG_REP result !=0."))})}).catch(function(e){i.addSdpLocalStates=0,log.debug("===DDDDDDD_4444444444_3333333333,reduceSdpHandle() error,room.addSdpLocalStates:"+i.addSdpLocalStates),log.error("===reduceSdpHandle(),resourceType:"+r+",Failed to add local description,error:"+e.toString())})}).catch(function(e){i.addSdpLocalStates=0,O(e,i)})}).catch(function(e){i.addSdpLocalStates=0,log.error("===reduceSdpHandle(),resourceType:"+r+",Failed to add remote description,error:"+e.toString())})}(r.para1,r.para2,r.para3,r.para4,t.roomHandle)):"audioBatch"==r.operationType&&(log.debug("===操作对列:operationType:audioBatch"),function(r,p){if(!r)return;for(key in p.addSdpLocalStates=1,log.debug("===DDDDDDD_3333333333_0000000000,audioBatchSdpHandle(),room.addSdpLocalStates:"+p.addSdpLocalStates),clearTimeout(b),b=setTimeout(function(){p&&(p.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_1111111111,audioBatchSdpHandle(),setTimeout room.addSdpLocalStates:"+p.addSdpLocalStates))},3e3),r){for(var e=r[key],t=e.stream.stream_name,n=e.owner_id,o=null,i=0;i<p.midObjSet.length;i++){var a=p.midObjSet[i];if("audio"==a.type&&!a.isReceiver){o=a;break}}log.debug("===audioBatchSdpHandle(),ownerId:"+n+",currMidObj:",o);var s=null;if(o)o.mid,s=U(o.mid,p),o.isSender?s.direction="sendrecv":s.direction="recvonly",o.isReceiver=!0,o.receiverInfo={trackId:t,nodeId:n,deviceId:e.resource_id};else{p.midNum=p.midNum+1,p.midNum;var d={mid:p.midNum,type:"audio",isReceiver:!0,isSender:!1,receiverInfo:{trackId:t,nodeId:n,deviceId:e.resource_id}};p.midObjSet.push(d)}var l=new SDPTransform;if(o){for(var u=l.parse(p.remoteDescriptionSDP),c=l.parse(e.stream.sdp),i=0;i<u.media.length;i++){var h=u.media[i];if(h.mid==o.mid){h.ssrcGroups=c.ssrcGroups,h.ssrcs=c.ssrcs,c.msid&&(h.msid=c.msid),o.isSender?h.direction="sendrecv":h.direction="sendonly";break}}if(c.msid){var f=c.msid.split(" ")[0];u.msidSemantic.token=u.msidSemantic.token+" "+f}p.remoteDescriptionSDP=l.writer(u)}else{var m=p.audioMediaTemplate;m.fingerprint&&(m.fingerprint.type="sha-1",m.fingerprint.hash=p.fingerPrint),m.mid=p.midNum,m.direction="sendonly";var g=l.mediaWriter(m);p.remoteDescriptionSDP=p.remoteDescriptionSDP+g+e.stream.sdp;var v=l.parse(p.remoteDescriptionSDP);v.groups[0].mids=v.groups[0].mids+" "+p.midNum,p.remoteDescriptionSDP=l.writer(v)}}var y={};y.sdp=p.remoteDescriptionSDP,y.type="offer";var _=new RTCSessionDescription(y);log.debug("===audioBatchSdpHandle(),remote offer description:"+y.sdp),p.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(_).then(function(){log.info("===audioBatchSdpHandle(),success to add remote description"),p.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,p.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,p.icePwd),log.debug("===audioBatchSdpHandle(),local answer description:"+e.sdp),p.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){p.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_2222222222,audioBatchSdpHandle(),room.addSdpLocalStates:"+p.addSdpLocalStates),log.info("===audioBatchSdpHandle(),success to add local description");var c=[];for(key in r)!function(){var l=r[key],u=getRandomNum(1e4,13e3);p.masterServer.subRoomResourceMsg("audio",1,l,null,u);var e=EngineCallback.sub_roomresourcemsg_rep_success,t=EngineCallback.sub_roomresourcemsg_rep_error;p.addCallback(e,function(e){if(clearTimeout(b),!c.includes(e)&&e==u){c.push(e);for(var t=null,r=0;r<p.midObjSet.length;r++){var n=p.midObjSet[r];if("audio"==n.type&&n.receiverInfo.nodeId==l.owner_id){t=n.mid;break}}var o,i=U(t,p);i&&(o=i.receiver.track);var a=p.getUserByNodeId(l.owner_id),s=a.getAudio(l.resource_id);if(s){s.track=o;var d=new MediaStream;d.addTrack(o),log.info("===audio audioBatchSdpHandle() add, callback subscrible_microphone_result userId:"+a.id+",userName:"+a.name+",resourceId:"+l.resource_id),a.eventEmitter.emit(UserCallback.subscrible_microphone_result,d,a.id,a.name)}}}),p.addCallback(t,function(e,t){clearTimeout(b),self.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_3333333333,upateSdpHandle() sub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+self.roomHandle.addSdpLocalStates),log.error("===audioBatchSdpHandle(),Failed to sub, by acception SUB_ROOM_RESOURCE_MSG_REP result !=0.")})}(key)}).catch(function(e){p.addSdpLocalStates=0,log.debug("===DDDDDDD_3333333333_4444444444,audioBatchSdpHandle() error,room.addSdpLocalStates:"+p.addSdpLocalStates),log.error("===audioBatchSdpHandle(),Failed to add local description,error:"+e.toString())})}).catch(function(e){p.addSdpLocalStates=0,O(e,p)})}).catch(function(e){p.addSdpLocalStates=0,log.error("===audioBatchSdpHandle(),Failed to add remote description,error:"+e.toString())})}(r.para1,t.roomHandle))}},t.promise},t.prototype.close=function(e){e&&"closed"!=e.signalingState&&e.close()},t.prototype.doSetLocalDescription=function(){var i=this,a=when.defer();return i.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){var t=e.sdp;t=updateSDPIcePwd(t=updateSDPIceUfrag(t,i.roomHandle.iceUfrag),i.roomHandle.icePwd);var r="active";"active"==i.roomHandle.setup&&(r="passive"),t=updateSDPSetup(t,r),log.debug("===doSetLocalDescription(),local answer description:"+t);var n={};n.sdp=t,n.type="answer";var o=new RTCSessionDescription(n);i.getToMCUPeerConnection().setLocalDescription(o).then(function(){log.info("===doSetLocalDescription(), set local sessionDescription success"),a.resolve()}).catch(function(e){log.error("===doSetLocalDescription(), set local sessionDescription error: "+e.toString()),a.reject(e)})}).catch(function(e){O(e,roomHandle)}),a.promise},t.prototype.doSetRemoteDescription=function(){var r=this,n=when.defer(),e=updateSDPFingerPrint(r.roomHandle.remoteSdpTemplate,r.roomHandle.fingerPrint);e=updateSDPSetup(e=updateSDPIcePwd(e=updateSDPIceUfrag(e,r.roomHandle.iceUfrag),r.roomHandle.icePwd),"actpass"),r.roomHandle.remoteDescriptionSDP=e;var t={};t.sdp=e,t.type="offer",log.debug("===doSetRemoteDescription, remote sessionDescription:"+e);var o=new RTCSessionDescription(t);return this.getToMCUPeerConnection().setRemoteDescription(o).then(function(){if(log.info("===doSetRemoteDescription(), set remote sessionDescription success"),r.roomHandle.setRemoteDescriptionSuccess=!0,null!=r.roomHandle.addIcecandidateList&&0<r.roomHandle.addIcecandidateList.length){for(var e=0;e<r.roomHandle.addIcecandidateList.length;e++){var t=r.roomHandle.addIcecandidateList[e];r.roomHandle.masterServer.setAddIcecandidate(t)}r.roomHandle.addIcecandidateList=[]}n.resolve()}).catch(function(e){log.error("===doSetRemoteDescription(), setRemoteDescription error:"+e),n.reject(e)}),n.promise},t.prototype.doAddIceCandidate=function(e){var t="";-1<e.candidate.indexOf("=")&&(t=e.candidate.split("=")[1]);var r=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:"0",candidate:t});log.info("===pc.addIceCandidate,audio:"+r.candidate),avdEngineHandle.loggerReport.info("PeerConnection add audio IceCandidate:"+r.candidate),this.getToMCUPeerConnection().addIceCandidate(r).then(function(){log.info("===PeerConnection.addIceCandidate,audio Success to add remote candidate["+r.candidate+"]")}).catch(function(e){log.error("===PeerConnection.addIceCandidate,audio Failed to add remote candidate["+r.candidate+"],"+e.toString())});var n=new RTCIceCandidate({sdpMLineIndex:1,sdpMid:"1",candidate:t});log.info("===pc.addIceCandidate,video:"+n.candidate),avdEngineHandle.loggerReport.info("PeerConnection add video IceCandidate："+r.candidate),this.getToMCUPeerConnection().addIceCandidate(n).then(function(){log.info("===PeerConnection.addIceCandidate,video Success to add remote candidate["+n.candidate+"]")}).catch(function(e){log.error("===PeerConnection.addIceCandidate,video Failed to add remote candidate["+n.candidate+"],"+e.toString())})},t.prototype.addSdp=function(e,t,r,n){log.debug("===traceablePeerConnection.addSdp(),resourceType:"+e+", resourceId:"+t+", orderId:"+n),a(i("add",t,e,t,r,n),this.roomHandle)},t.prototype.updateSdp=function(e,t,r,n,o){log.debug("===traceablePeerConnection.updateSdp(),resourceType:"+e+",updateType:"+t+",ownerId:"+r.owner_id+",resourceId:"+r.resource_id+",sdp:"+r.stream.sdp),a(i("update",r.resource_id,e,t,r,n,o),this.roomHandle)},t.prototype.reduceSdp=function(e,t,r,n){log.debug("===traceablePeerConnection.reduceSdp(),resourceType:"+e+",resourceId:"+t+", orderId:"+n),a(i("reduce",t,e,t,r,n),this.roomHandle)},t.prototype.audioBatchSdp=function(e){log.debug("===traceablePeerConnection.audioBatchSdp(),resourceInfosLength:"+e.length),a(i("audioBatch",null,e),this.roomHandle)},t.prototype.isContainsReconnectionSub=function(e,t){var r=!1;if(null!=t&&0<t.length)for(var n=0;n<t.length;n++){if(e==t[n]){r=!0;break}}return r};var w,A,b,m;function i(e,t,r,n,o,i,a){var s={};return s.operationType=e,s.resourceId=t,s.para1=r,s.para2=n,s.para3=o,s.para4=i,s.para5=a,s}function O(e,t){t.addSdpLocalStates=0,log.debug("===DDDDDDDDDD252525252525,onCreateSessionDescriptionError(),room.addSdpLocalStates:"+t.addSdpLocalStates),log.error("===onCreateSessionDescriptionError(),Failed to add local description,error:"+e.toString())}function a(e,t){if(e){var r=t.traceablePeerConnection.getToMCUPeerConnection().msgQueue,n=e.operationType;if("audioBatch"==n)return log.debug("===msgQueue insertQueueHandle(),operationType=audioBatch"),void r.unshift(e);if("update"==n){var o=e.resourceId,i=e.para1,a=e.para2;return s(o,t)?void function(e,t,r,n){var o,i;log.debug("===msgQueue updateHandle(),resourceId:"+e+",updateType:"+t);for(var a=n.traceablePeerConnection.getToMCUPeerConnection().msgQueue,s=0;s<a.length;s++){var d=a[s];"update"==d.operationType&&d.resourceId==e&&(o=d.para2,i=s)}log.debug("===msgQueue updateHandle(),existUpdateType="+o+",resourceId:"+e),0==o||1==o?(log.debug("===msgQueue updateHandle(),existUpdateType11111111111111"),1==t?0==o?(log.debug("===msgQueue updateHandle(),operationType==update,updateType==1，existUpdateType == 0,resourceId:"+e),a.splice(i,1)):log.debug("===msgQueue updateHandle(),operationType==update,updateType==1，existUpdateType == 1,resourceId:"+e):1==o?(log.debug("===msgQueue updateHandle(),operationType==update,updateType==0，existUpdateType == 1,resourceId:"+e),a.splice(i,1)):log.debug("===msgQueue updateHandle(),operationType==update,updateType==0，existUpdateType == 0,resourceId:"+e)):(log.debug("===msgQueue updateHandle(),existUpdateType000000000000000"),a.unshift(r))}(o,a,e,t):(log.debug("===msgQueue insertQueueHandle(),operationType=update,isExist=false,resourceType:"+i+",updateType:"+a+",resourceId:"+o),void r.unshift(e))}if("add"==n||"reduce"==n){o=e.resourceId,i=e.para1;return s(o,t)?void function(e,t,r,n){var o,i,a,s;log.debug("===msgQueue addOrReduceHandle(),operationType:"+e+",resourceId:"+t);for(var d=n.traceablePeerConnection.getToMCUPeerConnection().msgQueue,l=0;l<d.length;l++){var u=d[l];u.resourceId==t&&("add"==u.operationType?(o=!0,a=l):"reduce"==u.operationType&&(i=!0,s=l))}{if(!o&&!i)return d.unshift(r);if("add"==e){if(i)return log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==add，existReduceOperationType == true,resourceId:"+t),d.splice(s,1);if(o)return log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==add，existAddOperationType == true,resourceId:"+t)}if("reduce"==e){if(o)return log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==reduce，existAddOperationType == true,resourceId:"+t),d.splice(a,1);if(i)log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==reduce，existReduceOperationType == true,resourceId:"+t)}}}(n,o,e,t):(log.debug("===msgQueue insertQueueHandle(),operationType=="+n+",isExist == false,resourceType:"+i+",resourceId:"+o),void r.unshift(e))}}}function s(e,t){for(var r=!1,n=t.traceablePeerConnection.getToMCUPeerConnection().msgQueue,o=0;o<n.length;o++){if(n[o].resourceId==e){r=!0;break}}return r}function U(e,t){for(var r=null,n=t.traceablePeerConnection.getToMCUPeerConnection().getTransceivers(),o=0;o<n.length;o++){var i=n[o];if(i.mid==e){r=i;break}}return r||log.debug("===getTransceiver() get transceiver is null,mid:"+e+", transceivers:"+JSON.stringify(n)),r}function E(e){var t=0,r=e.resolution.width,n=e.resolution.height;if(log.debug("===getMockssrcNume(),resolution Width:",r+",Height:"+n),e.track){var o=e.track.getSettings(),i=o.width,a=o.height;log.debug("===getMockssrcNume(), trackSetting Width:",i+",Height:"+a);var s=i;i<a&&(s=a),s<480?t=0:640<=s&&s<960?t=1:960<=s&&(t=2)}else log.debug("===getMockssrcNume(), media.track is null");return log.debug("===getMockssrcNume(), mockNume:",t),t}function I(e){var t;if(e instanceof Array){t=[];for(var r=e.length;r--;)t[r]=I(e[r]);return t}if(e instanceof Object){for(var n in t={},e)t[n]=I(e[n]);return t}return e}return t}),ModuleBase.define("TraceableP2PPeerConnection",["Error"],function(e){var t=function(){iceServers&&0<iceServers.length?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};t.prototype.getToP2PPeerConnection=function(e){var t=room.selfUser.toP2PPCs[e];return null==t&&(t=this.createP2PPeerConnection(e),room.selfUser.toP2PPCs[e]=t,room.selfUser.nodeId<e&&this.sendOfferP2P(t,e)),t},t.prototype.createP2PPeerConnection=function(e){var t=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleP2PPeerConnection(e,t),t},t.prototype.sendOfferP2P=function(t,r,e){var n=this.constraints;n.iceRestart=1==e;var o=this;t.createOffer(function(e){log.debug("sendOfferP2P(): P2P  local sessionDescription:"+e.sdp),t.setLocalDescription(e,l,f),room.masterServer.sendOfferP2P(e.sdp,r),o.constraints.iceRestart=!1},function(e){},n)},t.prototype.setRemoteP2P=function(t){var e={};e.sdp=t.sdp,e.type="offer";var r=new RTCSessionDescription(e);room.sdp=e.sdp,log.debug("setRemoteP2P(): P2P  session Description:"+e.sdp);var n=this.getToP2PPeerConnection(t.node_id);n.setRemoteDescription(r,function(){log.info("setRemoteP2P(): P2P  Set remote session description success."),n.createAnswer(function(e){log.debug("setRemoteP2P(): createAnswer  P2P  local sessionDescription:"+e.sdp),n.setLocalDescription(e,l,f),room.masterServer.setRemoteP2P(e.sdp,t.node_id)},function(e){log.error("setRemoteP2P(): createAnswer  P2P  local sessionDescription false.event:"+e)},this.constraints)},function(e){log.error("setRemoteP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.setAnswerP2P=function(e){var t={};t.sdp=e.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("setAnswerP2P():  P2P  session Description:"+t.sdp),this.getToP2PPeerConnection(e.node_id).setRemoteDescription(r,function(){log.debug("setAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("setAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.addIceCandidateP2P=function(e){var t=this.getToP2PPeerConnection(e.node_id);log.debug("addIceCandidateP2P(), P2P candidate:"+e.candidate);var r=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid,candidate:e.candidate});t.addIceCandidate(r,n,o)},t.prototype.addStreamP2P=function(e){var t=this.getToP2PPeerConnection(e.sub_node_id),r=e.info.resource_id;if(1==e.info.stream.type){var n=room.selfUser.getVideo(r).stream;null!=n&&(t.addStream(n),room.selfUser.subMyVideosP2P.push(e.sub_node_id))}else if(2==e.info.stream.type){var o=room.selfUser.getAudio(r).stream;null!=o&&(t.addStream(o),room.selfUser.subMyAudiosP2P.push(e.sub_node_id))}else if(3==e.info.stream.type){var i=room.selfUser.getScreen(r).stream;null!=i&&(t.addStream(i),room.selfUser.subMyScreensP2P.push(e.sub_node_id))}},t.prototype.sendSubSdpOfferP2P=function(e,t){var r;"offerSub"==e?r=this.getToP2PPeerConnection(t.info.owner_id):"answerSub"==e&&(r=this.getToP2PPeerConnection(t.sub_node_id)),r.msgQueue.unshift(i("sub",r,e,t,null))},t.prototype.sendSubSdpAnswerP2P=function(r,n,o,e,i,a){var s=i.stream.sdp,t={};t.sdp=s,t.type="offer";var d=new RTCSessionDescription(t);log.debug("sendSubSdpAnswerP2P(), P2P remote sessionDescription:"+t.sdp),log.debug("sendSubSdpAnswerP2P(): P2P  signalingState: "+n.signalingState),n.setRemoteDescription(d,function(){log.debug("sendSubSdpAnswerP2P(): P2P  Set remote session description success.");var e,t=new SdpSerializer(room.selfUser.sdpP2PMap[i.owner_id]=s);"video"==o?(e=u(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add video sdp:"+e),room.selfUser.videoSdpSsrcMapP2PMap[i.owner_id]=e):"audio"==o?(e=t._inner.audio.ssrcStr,log.debug("sendSubSdpAnswerP2P(), new add audio sdp:"+e),room.selfUser.audioSdpSsrcP2PMap[i.owner_id]=e):"desktop"==o&&(e=u(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add screen sdp:"+e),room.selfUser.screenSdpSsrcP2PMap[i.owner_id]=e),n.createAnswer(function(e){log.debug("sendSubSdpAnswerP2P(), P2P local sessionDescription:"+e.sdp),n.setLocalDescription(e,l,f),room.masterServer.sendSubSdpAnswerP2P(r,i,e.sdp,a)},h,this.constraints)},function(e){log.error(e)})},t.prototype.getSubSdpAnswerP2P=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2P(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.sub_node_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.getSubSdpAnswerP2PByRep=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2PByRep(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.info.owner_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2PByRep(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2PByRep(): P2P  Set remote session description false.event:"+e)})},t.prototype.removeStreamP2P=function(e,t,r){var n=this.getToP2PPeerConnection(t);"video"==e?null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove video  stream")):"audio"==e?null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove audio  stream")):"screen"==e&&null!=n&&"closed"!=n.signalingState&&null!=r&&(n.removeStream(r),log.debug("removeStreamP2P(): P2P  remove screen  stream"))},t.prototype.sendUnSubSdpOfferP2P=function(e,t,r,n){var o=this.getToP2PPeerConnection(r);null!=o&&"closed"!=o.signalingState&&o.msgQueue.unshift(i("unsub",o,e,t,n))},t.prototype.sendUnSubSdpAnswerP2P=function(e,t,r,n){var o,i=this.getToP2PPeerConnection(r),a={};if("unsubAnswer"==e){var s,d=n.stream.stream_name;"video"==t?s=room.selfUser.videoSdpSsrcMapP2PMap[n.owner_id]:"audio"==t?s=room.selfUser.audioSdpSsrcP2PMap[n.owner_id]:"screen"==t&&(s=room.selfUser.screenSdpSsrcP2PMap[n.owner_id]);for(var l=room.selfUser.sdpP2PMap[n.owner_id],u=s.split("\r\n"),c=0;c<u.length;c++){var p=u[c]+"\r\n";l=l.replace(p,"")}0<l.indexOf(d)&&(l=l.replace(d,"")),room.selfUser.sdpP2PMap[n.owner_id]=l,a.sdp=l,a.type="offer",o=new RTCSessionDescription(a)}else"unpubAnswer"==e&&(a.sdp=i.remoteDescription.sdp,a.type="offer",o=new RTCSessionDescription(a));log.debug("sendUnSubSdpAnswerP2P(): P2P  Remote sessionDescription:"+o.sdp),i.setRemoteDescription(o,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error(e)}),i.createAnswer(function(e){room.sdp=e.sdp,log.debug("sendUnSubSdpAnswerP2P(): P2P  local sessionDescription:"+room.sdp),i.setLocalDescription(e,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set local session description success.")},f)},h,this.constraints)},t.prototype.handleP2PPeerConnection=function(t,r){var e=when.defer();return r.msgQueue=[],r.forLog=!1,r.nodeId=t,r.onicecandidate=function(e){e.candidate?(log.debug("onicecandidate(),P2P event.candidate.candidate :"+e.candidate.candidate),room.masterServer.sendCandidateMsgP2P(e.candidate,t)):log.debug("P2P  End of candidates.")},r.onopen=function(){},r.onaddstream=function(e){if(log.debug("onaddstream(), P2P  stream id:"+e.stream.id),"default"!=e.stream.id)if(0<e.stream.getVideoTracks().length){var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.subScreenStream2ResourceInfo[e.stream.id];if(null!=t){log.debug("onaddstream(), P2P  stream type: video");(n=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(t.resource_id);n.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,n.id,n.name,t.resource_id)}if(null!=r){log.debug("onaddstream(), P2P  stream type: screen");(n=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(r.resource_id);n.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,n.id,n.name,r.resource_id)}}else if(0<e.stream.getAudioTracks().length){log.debug("onaddstream(), P2P  stream type: audio");var n;t=room.selfUser.subAudioStream2ResourceInfo[e.stream.id];(n=room.selfUser.getUserByAudioStreamLabel(e.stream.id)).getAudio(t.resource_id).stream=e.stream,n.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,n.id,n.name)}},r.onremovestream=function(e){!function(e){if("default"!=e.id){var t=room.selfUser.subVideoStream2ResourceInfo[e.id],r=room.selfUser.getUserByVideoStreamLabel(e.id);null!=r&&(delete room.selfUser.subVideoStream2ResourceInfo[e.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id));var n=room.selfUser.subScreenStream2ResourceInfo[e.id],o=room.selfUser.getUserByScreenStreamLabel(e.id);null!=o&&(delete room.selfUser.subScreenStream2ResourceInfo[e.id],o.eventEmitter.emit(UserCallback.unsubscrible_screen_result,o.id,o.name,n.resource_id));var i=room.selfUser.subAudioStream2ResourceInfo[e.id],a=room.selfUser.getUserByAudioStreamLabel(e.id);if(null!=a){var s=a.getAudio(i.resource_id);s.stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.id],a.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,a.id,a.name)}}}(e.stream)},r.ondatachannel=function(e){},r.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),P2P iceConnectionState :"+t),t){case"disconnected":room.isMcu()||room.selfUser.nodeId<r.nodeId&&(log.debug("=======PeerConnection reconnection，send off.  self user nodeId:"+room.selfUser.nodeId+" ----\x3e download user nodeId:"+r.nodeId),room.traceableP2PPeerConnection.sendOfferP2P(r,r.nodeId,!0))}},r.onsignalingstatechange=function(e){log.debug("onsignalingstatechange(), P2P signalingState :"+e.target.signalingState),"stable"==e.target.signalingState&&0==r.forLog&&(r.forLog=!0,r.intervalSet(r))},r.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},400)},r.processSignalingMessage=function(e){if("stable"==e.signalingState&&0<e.msgQueue.length){var t=e.msgQueue.pop();log.debug("P2P 操作对列:"+t.operationType),"sub"==t.operationType?room.traceableP2PPeerConnection.sendSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4):"unsub"==t.operationType&&room.traceableP2PPeerConnection.sendUnSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4)}},e.promise},t.prototype.sendSubSdpOfferP2PHandle=function(t,r,n){t.createOffer(function(e){log.debug("sendSubSdpOfferP2P():  P2P  local sessionDescription:"+e.sdp),room.sdp=e.sdp,t.setLocalDescription(e,l,f),room.masterServer.sendSubSdpOfferP2P(n,e.sdp,r)},h,this.constraints)},t.prototype.sendUnSubSdpOfferP2PHandle=function(l,u,c,p){l.createOffer(function(e){log.debug("sendUnSubSdpOfferP2PHandle(): P2P  local sessionDescription:"+e.sdp),l.setLocalDescription(e,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set local session description success.");var e={};if("unpubOffer"==u){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unpubOffer"),e.sdp=l.remoteDescription.sdp,e.type="answer";var t=new RTCSessionDescription(e)}else if("unsubOffer"==u){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unsubOffer");var r,n=l.remoteDescription.sdp,o=new SdpSerializer(n);"video"==c?r=o._inner.video.ssrcStr:"audio"==c?r=o._inner.audio.ssrcStr:"screen"==c&&(r=o._inner.video.ssrcStr);for(var i=r.split("\r\n"),a=0;a<i.length;a++){var s=i[a]+"\r\n";n=n.replace(s,"")}var d=p.stream.stream_name;0<n.indexOf(d)&&(n=n.replace(d,"")),e.sdp=n,e.type="answer",t=new RTCSessionDescription(e)}log.debug("sendUnSubSdpOfferP2PHandle(): P2P  remote  sessionDescription:"+e.sdp),l.setRemoteDescription(t,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description success.")},function(e){log.error("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description false.event:"+e)})},f)},h,this.constraints)};var h=function(){};function l(){}function f(){}var n=function(){},o=function(e){log.error("onAddIceCandidateError(),Failed to add remote  P2P  candidate: "+e.toString())};function u(e,t){var r=e,n=r.split("\r\n");if(9<n.length){var o="";if(0<n[4].indexOf(t))for(var i=0;i<9;i++)""==o?o=n[i]:o+="\r\n"+n[i];else for(i=9;i<18;i++)""==o?o=n[i]:o+="\r\n"+n[i];return o}return r}function i(e,t,r,n,o){var i={};return i.operationType=e,i.para1=t,i.para2=r,i.para3=n,i.para4=o,i}return t}),ModuleBase.define("SignalFactory",["TraceableWebsocket"],function(n){var e=function(){};return e.prototype.getDataChannel=function(e,t){var r;switch(e){case SignalType.websocket:r=new n(t)}return r},e}),ModuleBase.define("MessageManager",["CmdProtobufCoded","User","Board","Error"],function(pt,ht,ft,mt){var e=function(e){this.roomHandle=e};function gt(e,t,r){var n=r.getUserByNodeId(e),o=new Object,i=new Date(1e3*t.timestamp);i.setMinutes(i.getMinutes()-i.getTimezoneOffset());var a=i.getTime();return o.timestamp=a,o.fromId=n.id,o.fromName=n.name,o.message=t.content,o}return e.prototype.OnWebSocketMessage=function(e){var t;this.roomHandle&&null==this.roomHandle.cmdProtobufCoded?(t=new pt,this.roomHandle.cmdProtobufCoded=t):t=this.roomHandle.cmdProtobufCoded;var r=t.getRoomPduTypeEnum(),n=t.getMediaTypeEnum(),o=t.getResourceStatusEnum(),i=t.getResourceOptEnum(),a=t.getMediaPlayEventsEnum(),s=t.decodePacket(e),d=s.type,l=s.priority;if(d==r.INVITE_ROOM_REP1&&0<l&&(this.roomHandle.isDoPDUSeq=1),1==this.roomHandle.isDoPDUSeq&&d!=r.PONG&&d!=r.OPEN_REP&&d!=r.INVITE_ROOM_REP1){if(l<=this.roomHandle.lastPDUSeq)return;if(0<this.roomHandle.connectionState)return void log.debug("===&&&&&&&&&&&&&MessageManager.OnWebSocketMessage(), connectionState>0, no todo,packetType:"+d+",pduSeq:"+l);this.roomHandle.lastPDUSeq=l}switch(d){case r.OPEN_REP:log.debug("===acception OPEN_REP init"),avdEngineHandle.loggerReport.info("acception OPEN_REP init");var u=t.decodeBody(e);if(this.roomHandle.selfUser.toMCUPC&&!this.roomHandle.selfUser.toMCUPC.iceConnectionState&&(log.info("===acception OPEN_REP, openRep.result："+u.result+" PeerConnection的iceConnectionState不存在，当作402重新加会处理"),u.result=402),0==u.result){if(log.info("===acception OPEN_REP result=0"),this.roomHandle.eventEmitter.emit(EngineCallback.open_rep_return_0),1==this.roomHandle.connectionState)this.roomHandle.masterServer.pingIntervalHandle(),this.roomHandle.masterServer.pingTimeoutHandle(),this.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_66666666666666,room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),log.debug("===acception OPEN_REP 重连成功,room.addSdpLocalStates:",this.roomHandle.addSdpLocalStates),this.roomHandle.selfUser.audio&&log.debug("===acception OPEN_REP 重连成功,room.selfUser.audio.status:",this.roomHandle.selfUser.audio.status),this.roomHandle&&this.roomHandle.selfUser.toMCUPC&&("disconnected"==this.roomHandle.selfUser.toMCUPC.iceConnectionState||"failed"==this.roomHandle.selfUser.toMCUPC.iceConnectionState)&&(log.info("===acception OPEN_REP 重连成功,oniceconnectionstatechange(),iceConnectionState is disconnected or failed, to room.iCERestart()"),this.roomHandle.iCERestart()),log.debug("===acception OPEN_REP openRep.result == 0,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.reconnected),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reconnected);else{if(this.roomHandle.pingInterval=u.ping_interval,this.roomHandle.pingTimeout=u.ping_timeout,this.roomHandle.signalTocken=u.signal_tocken,this.roomHandle.MaxReconnectTimeout(u.ping_interval),log.info("===acception OPEN_REP, room.pingInterval:"+this.roomHandle.pingInterval+", room.pingTimeout:"+this.roomHandle.pingTimeout+", room.signalTocken:"+this.roomHandle.signalTocken),this.roomHandle.masterServer.pingInit(),2==this.roomHandle.connectionState){this.roomHandle.lastPDUSeq=0,this.roomHandle.isExistReJoinState=!0,log.debug("===acception OPEN_REP 重新加会连接成功,room.addSdpLocalStates:",this.roomHandle.addSdpLocalStates),this.roomHandle.selfUser.audio&&log.debug("===acception OPEN_REP 重新加会连接成功,room.selfUser.audio.status:",this.roomHandle.selfUser.audio.status);var c=this;setTimeout(function(){for(var e in c.roomHandle.selfUser.boards)c.roomHandle.selfUser.boards[e];log.debug("===acception OPEN_REP openRep.result == 0,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.reJoinConnected),c.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinConnected)},500)}else 0==this.roomHandle.connectionState&&(this.roomHandle.isExistReJoinState=!1,log.debug("===acception OPEN_REP 连接成功,room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),this.roomHandle.selfUser.audio&&log.debug("===acception OPEN_REP 连接成功,room.selfUser.audio.status:"+this.roomHandle.selfUser.audio.status),log.debug("===acception OPEN_REP openRep.result == 0,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connected),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected));this.roomHandle.joinTimeoutState=!1,this.roomHandle.masterServer.pingIntervalHandle(),this.roomHandle.masterServer.pingTimeoutHandle(),this.roomHandle.masterServer.inviteRoomReqSend()}this.roomHandle.connectionState=0}else if(402==u.result)log.info("===acception OPEN_REP result=402"),avdEngineHandle.loggerReport.error("acception OPEN_REP result=402"),this.roomHandle.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&this.roomHandle.masterServer.signalingChannel.close(),this.roomHandle.currentReconnectTimes=0,this.roomHandle.setRemoteDescriptionSuccess=!1,this.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_7777777777777,openRep.result=402 room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),this.roomHandle.addIcecandidateList=[],log.debug("===acception OPEN_REP openRep.result == 402,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),this.roomHandle&&this.roomHandle.connectionInfoCollector&&this.roomHandle.connectionInfoCollector.stop(),this.roomHandle&&this.roomHandle.connectionStatistics&&this.roomHandle.connectionStatistics.stop(),log.info("===to room.reJoin() by OPEN_REP result == 402."),this.roomHandle.reJoin();else if(436==u.result){log.info("===acception OPEN_REP result:"+u.result+",description:"+u.description),avdEngineHandle.loggerReport.info("acception OPEN_REP result:"+u.result+",description:"+u.description);var p=new mt(u.result,"客户端版本过高");this.roomHandle.eventEmitter.emit(EngineCallback.room_join_error,p)}else{log.error("===acception OPEN_REP result:"+u.result+",description:"+u.description),avdEngineHandle.loggerReport.error("acception OPEN_REP result:"+u.result+",description:"+u.description);p=new mt(u.result,u.description);this.roomHandle.eventEmitter.emit(EngineCallback.room_join_error,p)}break;case r.PONG:this.roomHandle.pingCountTime=0;break;case r.INVITE_ROOM_REP1:c=this;log.debug("===acception INVITE_ROOM_REP1 init"),avdEngineHandle.loggerReport.info("acception INVITE_ROOM_REP1 init");var h=t.decodeBody(e);if(0==h.result){this.roomHandle.fingerPrint=h.finger_print,this.roomHandle.setup=h.setup,this.roomHandle.roomTocken=h.room_tocken,this.roomHandle.roomInfo=h.room_info,this.roomHandle.iceUfrag=h.ice_ufrag,this.roomHandle.icePwd=h.ice_pwd,log.debug("===acception INVITE_ROOM_REP1,iceUfrag:"+h.ice_ufrag+", icePwd:"+h.ice_pwd+", fingerPrint:"+h.finger_print),this.roomHandle.roomInfo.room_id!=this.roomHandle.id&&(this.roomHandle.outgoingAddr=this.roomHandle.id,this.roomHandle.id=this.roomHandle.roomInfo.room_id),this.roomHandle.roomJoinState=RoomStateEnum.CONNECTED,this.roomHandle.setRemoteDescriptionSuccess=!1,this.roomHandle.masterServer.sendAnswer().then(function(){if(0==c.roomHandle.currentReconnectTimes){c.roomHandle.selfUser.nodeId=h.node_id,c.roomHandle.selfUser.role=1,null!=h.role&&(c.roomHandle.selfUser.role=h.role);var e=avdEngineHandle.cameraMap;for(var t in e){var r=e[t];r&&c.roomHandle.selfUser.initVideo(t,r)}if(null!=avdEngineHandle.checkMicrophoneId&&c.roomHandle.selfUser.initAudio(avdEngineHandle.checkMicrophoneId,avdEngineHandle.checkMicrophoneName),c.roomHandle.selfUser.initScreen(),c.roomHandle.addUser(c.roomHandle.selfUser),c.roomHandle.reJoinRoomCount=0,c.roomHandle.audioLevel=new AudioLevel(c.roomHandle),log.info("===acception INVITE_ROOM_REP1 join room  Success, roomId:"+c.roomHandle.id+",nodeId:"+c.roomHandle.selfUser.nodeId+",userId:"+c.roomHandle.selfUser.id+", userName:"+c.roomHandle.selfUser.name),avdEngineHandle.loggerReport.info("acception INVITE_ROOM_REP1 加会成功！房间号:"+c.roomHandle.id+",nodeId:"+c.roomHandle.selfUser.nodeId+",userId:"+c.roomHandle.selfUser.id+",userName:"+c.roomHandle.selfUser.name),null!=c.roomHandle.selfUser.reJoinPubVideoIds&&0<c.roomHandle.selfUser.reJoinPubVideoIds.length){for(var n=0;n<c.roomHandle.selfUser.reJoinPubVideoIds.length;n++){var o=c.roomHandle.selfUser.getVideo(c.roomHandle.selfUser.reJoinPubVideoIds[n]);c.roomHandle.selfUser.reJoinPubVideoElements[n]?o.previewAndPublish(c.roomHandle.selfUser.reJoinPubVideoElements[n],!0).then(function(){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,有视频控件，videoId:"+o.id)}).otherwise(function(e){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,有视频控件，videoId:"+o.id+",pub error:"+JSON.stringify(e))}):o.publish(!0).then(function(){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频,没有视频控件，videoId:"+o.id)}).otherwise(function(e){log.debug("===重新加会，加会前如已经pub过视频，重新加会后需要再次pub视频，没有视频控件，videoId:"+o.id+",pub error:"+JSON.stringify(e))})}c.roomHandle.selfUser.reJoinPubVideoIds=[],c.roomHandle.selfUser.reJoinPubVideoElements=[]}if(c.roomHandle.selfUser.reJoinPubAudioId){var i=c.roomHandle.selfUser.getAudio(c.roomHandle.selfUser.reJoinPubAudioId);log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开音频，重新加会后需要再次打开音频，audioId:"+i.id),i.openMicrophone().then(function(){c.roomHandle.selfUser.reJoinPubAudioId="",c.roomHandle.selfUser.reJoinPubAudioButMute&&(log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前已经打开音频但已静音，重新加会打开麦克风后还原为静音状态"),i.muteMicrophone(),delete c.roomHandle.selfUser.reJoinPubAudioButMute)}).otherwise(function(e){log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开音频，重新加会后需要再次打开音频，audioId:"+i.id+",pub error:"+JSON.stringify(e))})}if(c.roomHandle.selfUser.reJoinPubScreenStram)c.roomHandle.selfUser.screenStream=c.roomHandle.selfUser.reJoinPubScreenStram,log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开桌面共享，重新加会后需要再次打开桌面共享"),c.roomHandle.selfUser.getScreen().publish(c.roomHandle.selfUser.reJoinPubScreenStram).then(function(){c.roomHandle.selfUser.reJoinPubScreenStram=null,log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开桌面共享，重新加会后需要再次打开桌面共享 成功")}).otherwise(function(e){log.debug("===acception INVITE_ROOM_REP1 重新加会，加会前如已经打开桌面共享，重新加会后需要再次打开桌面共享, pub error:"+JSON.stringify(e))});c.roomHandle.isExistReJoinState&&(clearTimeout(c.roomHandle.reJoinAfterTimer),c.roomHandle.reJoinAfterTimer=setTimeout(function(){if(c.roomHandle&&c.roomHandle.participants){var e=arrayUtil.chajiObject(c.roomHandle.participants,c.roomHandle.reJoinAfterUsers);if(null!=e&&0<e.length)for(var t=0;t<e.length;t++){var r=e[t];if(r!=c.roomHandle.selfUser.nodeId){var n=c.roomHandle.getUserByNodeId(r);null!=n&&(log.debug("===acception INVITE_ROOM_REP1 重新加会后，已离开的用户退出操作，nodeId:"+r+"，name:"+n.name),c.roomHandle.removeUser(n.id),c.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,1,null,n))}}c.roomHandle.reJoinAfterUsers=[]}},3e4))}c.roomHandle.eventEmitter.emit(EngineCallback.room_join_success,c.roomHandle),c.roomHandle.connectionState=0}).otherwise(function(e){log.info("===INVITE_ROOM_REP1, inviteRoomRep1.result：0, error:"+JSON.stringify(e)),c.roomHandle.eventEmitter.emit(EngineCallback.room_join_error,e)});break}if(402==h.result)log.info("===INVITE_ROOM_REP1,inviteRoomRep1.result：402"),avdEngineHandle.loggerReport.error("INVITE_ROOM_REP1 Result：402"),this.roomHandle.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&this.roomHandle.masterServer.signalingChannel.close(),this.roomHandle.currentReconnectTimes=0,this.roomHandle.setRemoteDescriptionSuccess=!1,this.roomHandle.addSdpLocalStates=0,log.debug("===DDDDDDD_88888888888,inviteRoomRep1.result=402 room.addSdpLocalStates:"+this.roomHandle.addSdpLocalStates),this.roomHandle.addIcecandidateList=[],log.debug("===acception INVITE_ROOM_REP1 inviteRoomRep1.result == 402,callback RoomCallback.connection_status,connectionStatus:"+ConnectionStatus.connectFailed),this.roomHandle.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),log.info("===to room.reJoin() by INVITE_ROOM_REP1 result == 402."),this.roomHandle.reJoin();else{avdEngineHandle.loggerReport.error("INVITE_ROOM_REP1 Result Error,result:"+h.result+",description:"+h.description),log.info("===INVITE_ROOM_REP1,Result Error,inviteRoomRep1.result: "+h.result+",inviteRoomRep1.description:"+h.description);p=new mt(h.result,h.description);this.roomHandle.eventEmitter.emit(EngineCallback.room_join_error,p)}break;case r.CANDIDATE_MSG1:log.debug("===acception CANDIDATE_MSG1 init");var f=t.decodeBody(e);log.info("===acception CANDIDATE_MSG1,candidateMsg:"+f.candidate),this.roomHandle.setRemoteDescriptionSuccess?this.roomHandle.masterServer.setAddIcecandidate(f):this.roomHandle.addIcecandidateList.push(f);break;case r.ICE_RESTART_MSG:log.debug("===acception ICE_RESTART_MSG init");var m=t.decodeBody(e);this.roomHandle.remoteICERestart(m);break;case r.ROOM_RESOURCE_INFOS:log.debug("===acception ROOM_RESOURCE_INFOS init");var g=t.decodeBody(e).resource_infos;log.debug("===acception ROOM_RESOURCE_INFOS, resourceInfos:"+JSON.stringify(g));for(var v=[],y=0;y<g.length;y++){if(log.debug("===acception ROOM_RESOURCE_INFOS, i: "+y),j=g[y])if(j.stream){var _=j.stream.type;switch(_){case n.video:if(log.info("===acception ROOM_RESOURCE_INFOS, video resourceInfo.owner_id: "+j.owner_id+",this.roomHandle.selfUser.nodeI:"+this.roomHandle.selfUser.nodeId+",resourceInfo.resource_id:"+j.resource_id),b=this.roomHandle.traceablePeerConnection.isContainsReconnectionSub(j.resource_id,this.roomHandle.selfUser.reJoinSubVideoIds)){if(log.debug("===ROOM_RESOURCE_INFOS, video contains true, resourceInfo.resource_id: "+j.resource_id),(k=this.roomHandle.getUserByNodeId(j.owner_id))&&k.id!=this.roomHandle.selfUser.id)null==(U=k.getVideo(j.resource_id))&&(log.debug("===ROOM_RESOURCE_INFOS, video contains is true but video is null, create video"),U=k.createVideo(j.resource_id,"")),U.resourceInfo=j,U.subscrible()}else if(log.debug("===ROOM_RESOURCE_INFOS, video contains false,resourceInfo.resource_id:"+j.resource_id),(k=this.roomHandle.getUserByNodeId(j.owner_id))&&k.id!=this.roomHandle.selfUser.id)null==(U=k.getVideo(j.resource_id))&&(U=k.createVideo(j.resource_id,"")),U.resourceInfo=j,U.ownerId=k.id,this.roomHandle.hasObject(this.roomHandle.pubVideos,U)?log.debug("===ROOM_RESOURCE_INFOS, video contains false,room.pubVideos not to push ,videoId:"+U.id):(log.debug("===ROOM_RESOURCE_INFOS, video contains false,room.pubVideos to push, videoId:"+U.id),this.roomHandle.pubVideos.push(U)),(V=[]).push(U),log.info("===ROOM_RESOURCE_INFOS, video contains false，callback camera_status_notify,userId:"+k.id+",videoId:"+U.id),k.eventEmitter.emit(UserCallback.camera_status_notify,U.status,U.id,U.name,k.id),log.info("===ROOM_RESOURCE_INFOS, video contains false，callback publish_camera_notify,userId:"+k.id+",videoId:"+U.id),k.eventEmitter.emit(UserCallback.publish_camera_notify,V);break;case n.audio:log.info("===acception ROOM_RESOURCE_INFOS, audio resourceInfo.owner_id: "+j.owner_id+",room.selfUser.nodeId:"+this.roomHandle.selfUser.nodeId);var b=this.roomHandle.traceablePeerConnection.isContainsReconnectionSub(j.resource_id,this.roomHandle.selfUser.reJoinSubAudioIds),S=!1;if(-1<j.resource_id.indexOf("screen_audio")&&(S=!0),b)if(log.debug("===ROOM_RESOURCE_INFOS, audio contains true,nodeId:"+j.owner_id),log.info("===audio subscrible(),订阅音频流,resourceId:"+j.resource_id+",ownerId:"+j.owner_id),avdEngineHandle.loggerReport.info("===audio subscrible(),订阅音频流,resourceId:"+j.resource_id+",ownerId:"+j.owner_id),avdEngineHandle.audioBatchEnabled)v.push(j);else(k=this.roomHandle.getUserByNodeId(j.owner_id))&&k.id!=this.roomHandle.selfUser.id&&(S?k.screen&&k.screen.screenAudio&&k.screen.screenAudio.id==j.resource_id&&(k.screen.screenAudio.resourceInfo=j,log.debug("===screen audio subscrible(),订阅屏幕共享音频流,to  user.screen.screenAudio.subscrible()"),k.screen.screenAudio.subscrible()):k.audio&&k.audio.id==j.resource_id&&(k.audio.resourceInfo=j,log.debug("===audio subscrible(),订阅音频流,to  user.audio.subscrible()"),k.audio.subscrible()));else if(log.debug("===ROOM_RESOURCE_INFOS, audio contains false,nodeId:"+j.owner_id),(k=this.roomHandle.getUserByNodeId(j.owner_id))&&k.id!=this.roomHandle.selfUser.id){var w=null;if(S){w=(Z=k.getScreenAudio())||k.createScreenAudio(j.resource_id,"")}else{var E=k.getAudio(j.resource_id);w=E||k.createAudio(j.resource_id,"")}w.resourceInfo=j,this.roomHandle.hasObject(this.roomHandle.pubAudios,w)||this.roomHandle.pubAudios.push(w),(F=[]).push(w),S?(log.info("===audio subscrible(),订阅屏幕共享音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+j.resource_id+",ownerId:",j.owner_id),avdEngineHandle.loggerReport.info("===audio subscrible(),订阅屏幕共享音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+j.resource_id+",ownerId:",j.owner_id),w.subscrible()):(avdEngineHandle.audioAutoSub?(this.roomHandle.selfUser.subAudioIds.push(w.id),avdEngineHandle.audioBatchEnabled?v.push(j):(log.info("===audio subscrible(),订阅音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+j.resource_id+",ownerId:",j.owner_id),avdEngineHandle.loggerReport.info("===audio subscrible(),订阅音频流,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+j.resource_id+",ownerId:",j.owner_id),w.subscrible())):k.eventEmitter.emit(UserCallback.publish_microphone_notify,F),log.info("===ROOM_RESOURCE_INFOS, audio contains false,callback microphone_status_notify,userId:"+k.id+",audioId:"+w.id),k.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,k.id))}break;case n.desktop:if(log.info("===acception ROOM_RESOURCE_INFOS, desktop resourceInfo.owner_id: "+j.owner_id+",room.selfUser.nodeId:"+this.roomHandle.selfUser.nodeId),b=this.roomHandle.traceablePeerConnection.isContainsReconnectionSub(j.resource_id,this.roomHandle.selfUser.reJoinSubScreenIds)){if(log.debug("===ROOM_RESOURCE_INFOS, screen contains true,nodeId:"+j.owner_id),(k=this.roomHandle.getUserByNodeId(j.owner_id))&&k.id!=this.roomHandle.selfUser.id)(Q=k.getScreen(j.resource_id)).resourceInfo=j,Q.subscrible()}else if(log.debug("===ROOM_RESOURCE_INFOS, screen contains false,nodeId:"+j.owner_id),(k=this.roomHandle.getUserByNodeId(j.owner_id))&&k.id!=this.roomHandle.selfUser.id)null==(Q=k.getScreen(j.resource_id))&&(Q=k.createScreen(j.resource_id,"")),Q.resourceInfo=j,Q.ownerId=k.id,this.roomHandle.pubScreens.push(Q),(q=[]).push(Q),log.info("===ROOM_RESOURCE_INFOS, screen contains false,callback screen_status_notify,userId:"+k.id+",screenId:"+Q.id),k.eventEmitter.emit(UserCallback.screen_status_notify,Q.status,Q.id,Q.name,k.id),k.eventEmitter.emit(UserCallback.publish_screen_notify,q);break;default:log.info("===acception ROOM_RESOURCE_INFOS, switch default, streamType:"+_)}}else log.info("===acception ROOM_RESOURCE_INFOS, resourceInfo stream is null by i: "+y+", resourceInfo:"+JSON.stringify(j));else log.info("===acception ROOM_RESOURCE_INFOS, resourceInfo is null by i: "+y)}0<v.length&&(log.debug("===audio batchSubscrible(),acception ROOM_RESOURCE_INFOS 音频自动订阅时,对多路音频进行批量订阅处理,只进行一次SDP交互提高性能. audioResourceInfoBatch.length:"+v.length),this.roomHandle.masterServer.audioBatchSubscribleHandle(v));break;case r.USER_INFO_MSG:log.debug("===acception USER_INFO_MSG init");c=this;var I=t.decodeBody(e);if(null==I)return;var T=[];I.user.forEach(function(e){var r=new ht(e.user_id,e.user_name,null,c.roomHandle);for(var t in r.nodeId=e.node_id,r.role=e.role,r.userAgent=e.user_agent,r.data=e.user_data,log.info("===acception USER_INFO_MSG userId:"+e.user_id+",userName:"+e.user_name+",nodeId:"+r.nodeId),c.roomHandle.reJoinAfterUsers.push(r),c.roomHandle.boardId2userId)c.roomHandle.boardId2userId[t]==e.user_id&&delete c.roomHandle.boardId2userId[t];e.webcams.forEach(function(e){var t=r.createVideo(e.id,e.name);t.status=e.status,t.cameraType=e.ctype,t.level=e.level,t.description=e.description,t.streamName=e.stream_name,t.streamNickName=e.stream_nick_name});var n=null;e.speakers.forEach(function(e){-1<e.id.indexOf("screen_audio")?n=e:r.createAudio(e.id,e.name).status=e.status}),e.desktops.forEach(function(e){var t=r.createScreen(e.id,e.name);(t.status=e.status,t.level=e.level,t.description=e.description,n)&&(r.createScreenAudio(n.id,n.name).status=n.status)});var o=c.roomHandle.getUser(e.user_id);o?o.waitingDelete?(log.debug("===acception USER_INFO_MSG,tempUser !=null,tempUser.waitingDelete= true,to add user. userId:"+r.id+", nodeId:"+r.nodeId+", userName:"+r.name),c.roomHandle.addUserByUserIdAndUserId(r),T.push(r)):(log.debug("===acception USER_INFO_MSG,tempUser!=null,tempUser.waitingDelete=false. 402重新加会后nodeId会变，更新处理. userId:"+r.id+", nodeId:"+e.node_id+", userName:"+r.name),c.roomHandle.getUser(r.id).nodeId=e.node_id):(log.debug("===acception USER_INFO_MSG,tempUser =null,to add user. userId:"+r.id+",nodeId:"+r.nodeId+",userName:"+r.name),c.roomHandle.addUser(r),T.push(r)),c.roomHandle.isMcu()||c.roomHandle.p2pServer.createP2PPeerConnection(r.nodeId)}),log.info("===acception USER_INFO_MSG, callback user_join_notify,usersLength:"+T.length),c.roomHandle.eventEmitter.emit(RoomCallback.user_join_notify,T);break;case r.ADD_WEBCAM_MSG:log.debug("===acception ADD_WEBCAM_MSG init");var C=t.decodeBody(e);if(k=this.roomHandle.getUserByNodeId(C.node_id)){var R=C.webcam;(U=k.createVideo(R.id,R.name)).status=R.status,U.cameraType=R.ctype,U.level=R.level,U.description=R.description,U.streamName=R.stream_name,U.streamNickName=R.stream_nick_name,log.info("===acception ADD_WEBCAM_MSGk,callback camera_status_notify, webcamStatus:"+R.status+",webcamId:"+R.id+",webcamName:"+R.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.camera_status_notify,R.status,R.id,R.name,k.id)}break;case r.ADD_SPEAKER_MSG:log.debug("===acception ADD_SPEAKER_MSG init");var P=t.decodeBody(e),k=this.roomHandle.getUserByNodeId(P.node_id);S=P.speaker&&-1<P.speaker.id.indexOf("screen_audio");if(k){var x=P.speaker;if(S)(Z=k.createScreenAudio(x.id,x.name)).status=x.status,log.info("===acception ADD_SPEAKER_MSG,callback, speakerStatus:"+x.status+",speakerId:"+x.id+",speakerName:"+x.name+",userId:"+k.id);else(w=k.createAudio(x.id,x.name)).status=x.status,log.info("===acception ADD_SPEAKER_MSG,callback microphone_status_notify, speakerStatus:"+x.status+",speakerId:"+x.id+",speakerName:"+x.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.microphone_status_notify,x.status,x.id,x.name,k.id)}break;case r.ADD_DESKTOP_MSG:log.debug("===acception ADD_DESKTOP_MSG init");var M=t.decodeBody(e);if(k=this.roomHandle.getUserByNodeId(M.node_id)){var A=M.desktop;(Q=k.createScreen(A.id,A.name)).status=A.status,Q.level=A.level,Q.description=A.description,log.info("===acception ADD_DESKTOP_MSG, callback screen_status_notify,desktopStatus:"+A.status+",desktopId:"+A.id+",desktopName:"+A.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_status_notify,A.status,A.id,A.name,k.id)}break;case r.REMOVE_WEBCAM_MSG:log.debug("===acception REMOVE_WEBCAM_MSG init");var O=t.decodeBody(e);if(k=this.roomHandle.getUserByNodeId(O.node_id)){var U=k.getVideo(O.resource_id);log.info("===acception REMOVE_WEBCAM_MSG, callback camera_status_notify videoStatus:"+U.status+",videoId:"+U.id+",videoName:"+U.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,U.id,U.name,k.id),setTimeout(function(){arrayUtil.objectSplice(k.videos,O.resource_id)},1500)}break;case r.REMOVE_SPEAKER_MSG:log.debug("===acception REMOVE_SPEAKER_MSG init");var D=t.decodeBody(e);(k=this.roomHandle.getUserByNodeId(D.node_id))&&(log.info("===acception REMOVE_SPEAKER_MSG,callback microphone_status_notify, audioStatus:"+k.audio.status+",audioId:"+k.audio.id+",audioName:"+k.audio.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,k.audio.id,k.audio.name,k.id),k.audio.id==D.resource_id&&(k.audio=null));break;case r.REMOVE_DESKTOP_MSG:log.debug("===acception REMOVE_DESKTOP_MSG init");var L=t.decodeBody(e);(k=this.roomHandle.getUserByNodeId(L.node_id))&&(log.info("===acception REMOVE_DESKTOP_MSG, callback screen_status_notify, screenStatus:"+k.screen.status+",screenId:"+k.screen.id+",screenName:"+k.screen.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_status_notify,StreamStatus.none,k.screen.id,k.screen.name,k.id),k.screen.id==L.resource_id&&(k.screen=null));break;case r.UPDATE_SPEAKER_MSG:log.debug("===acception UPDATE_SPEAKER_MSG init");var H=t.decodeBody(e);k=this.roomHandle.getUserByNodeId(H.node_id),S=!1;if(-1<H.resource_id.indexOf("screen_audio")&&(S=!0),k)if(S)(Z=k.getScreenAudio(H.resource_id)).status=H.speaker.status,log.info("===acception UPDATE_SPEAKER_MSG, callback screen_audio_status_notify, audioId:"+Z.id+",audioName:"+Z.name+",audioStatus:"+Z.status+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_audio_status_notify,Z.status,Z.id,Z.name,k.id);else(w=k.getAudio(H.resource_id)).status=H.speaker.status,log.info("===acception UPDATE_SPEAKER_MSG, callback microphone_status_notify, audioId:"+w.id+",audioName:"+w.name+",audioStatus:"+w.status+",userId:"+k.id),k.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,k.id);break;case r.UPDATE_WEBCAM_MSG:log.debug("===acception UPDATE_WEBCAM_MSG init");var N=t.decodeBody(e);if(k=this.roomHandle.getUserByNodeId(N.node_id))null==(U=k.getVideo(N.resource_id))&&(log.debug("===acception UPDATE_WEBCAM_MSG init, video is null, create video"),U=k.createVideo(j.resource_id,"")),U.level=N.webcam.level,U.description=N.webcam.description,U.streamName=N.webcam.stream_name,U.streamNickName=N.webcam.stream_nick_name,U.status!=N.webcam.status&&(U.status=N.webcam.status,k.eventEmitter.emit(UserCallback.camera_status_notify,U.status,U.id,U.name,k.id),log.info("===acception UPDATE_WEBCAM_MSG, callback camera_status_notify  videoId:"+U.id+",status:"+U.status+",videoId:"+U.id+",videoName:"+U.name+",userId:"+k.id)),log.info("===acception UPDATE_WEBCAM_MSG, callback camera_data_notify, videoId:"+U.id+",videoName:"+U.name+",videoStatus:"+U.status+",userId:"+k.id),k.eventEmitter.emit(UserCallback.camera_data_notify,U.level,U.description,U.id,U.name,k.id);break;case r.UPDATE_DESKTOP_MSG:log.debug("===acception UPDATE_DESKTOP_MSG init");var B=t.decodeBody(e);if(k=this.roomHandle.getUserByNodeId(B.node_id))(Q=k.getScreen(B.resource_id)).level=B.desktop.level,Q.description=B.desktop.description,Q.status=B.desktop.status,log.info("===acception UPDATE_DESKTOP_MSG, callback screen_data_notify, screenId:"+Q.id+",screenName:"+Q.name+",screenStatus:"+Q.status+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_data_notify,Q.level,Q.description,Q.id,Q.name,k.id);break;case r.PUB_ROOM_RESOURCE_MSG:log.debug("===acception PUB_ROOM_RESOURCE_MSG init");var j=t.decodeBody(e).info;if(log.debug("===acception PUB_ROOM_RESOURCE_MSG,mediaType:"+j.stream.type+",ownerId:"+j.owner_id),j.stream.type==n.video){var V=[];if(k=this.roomHandle.getUserByNodeId(j.owner_id))log.debug("===acception PUB_ROOM_RESOURCE_MSG,owner_id:"+j.owner_id+",userId:"+k.id),null==(U=k.getVideo(j.resource_id))&&(U=k.createVideo(j.resource_id,"")),log.debug("===acception PUB_ROOM_RESOURCE_MSG,video,userId:"+k.id+",userName:"+k.name+",resourceInfo.stream.sdp:"+j.stream.sdp),U.resourceInfo=j,U.status=StreamStatus.published,U.ownerId=k.id,V.push(U),this.roomHandle.hasObject(this.roomHandle.pubVideos,U)?log.debug("===video accept PUB_ROOM_RESOURCE_MSG, this.roomHandle.pubVideos not to push(), videoId:"+U.id):(log.debug("===video accept PUB_ROOM_RESOURCE_MSG, room.pubVideos to push(), videoId:"+U.id),this.roomHandle.pubVideos.push(U)),setTimeout(function(){log.info("===video accept PUB_ROOM_RESOURCE_MSG, callback camera_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+U.status+",videoId:"+U.id+",videoName:"+U.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.camera_status_notify,U.status,U.id,U.name,k.id),log.info("===video accept PUB_ROOM_RESOURCE_MSG, callback publish_camera_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",videosLength:",V.length),k.eventEmitter.emit(UserCallback.publish_camera_notify,V)},400)}else if(j.stream.type==n.audio){var F=[];if(k=this.roomHandle.getUserByNodeId(j.owner_id)){S=!1;-1!=j.resource_id.indexOf("screen_audio")&&(S=!0);w=null;null==(w=S?(log.debug("===acception PUB_ROOM_RESOURCE_MSG,screen audio,userId:"+k.id+",userName:"+k.name+",resourceInfo.stream.sdp:"+j.stream.sdp),k.getScreenAudio()):(log.debug("===acception PUB_ROOM_RESOURCE_MSG,audio,userId:"+k.id+",userName:"+k.name+",resourceInfo.stream.sdp:"+j.stream.sdp),k.getAudio(j.resource_id)))&&(w=S?k.createScreenAudio(j.resource_id,""):k.createAudio(j.resource_id,"")),w.resourceInfo=j,w.status=StreamStatus.published,w.ownerId=k.id,F.push(w),S?(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback screen_audio_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_audio_status_notify,w.status,w.id,w.name,k.id),w.subscrible()):(this.roomHandle.hasObject(this.roomHandle.pubAudios,w)?log.info("===audio accept PUB_ROOM_RESOURCE_MSG, room.pubAudios not to push(), audioId:"+w.id):(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, room.pubAudios to push(), audioId:"+w.id),this.roomHandle.pubAudios.push(w)),log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback microphone_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,k.id),avdEngineHandle.audioAutoSub?(this.roomHandle.selfUser.subAudioIds.push(w.id),log.info("===audio accept PUB_ROOM_RESOURCE_MSG,自动订阅音频流,to audio.subscrible(),ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+w.id),avdEngineHandle.loggerReport.info("audio accept PUB_ROOM_RESOURCE_MSG,自动订阅音频流,to audio.subscrible(),ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+w.id),w.subscrible()):(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback  publish_microphone_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",audiosLength:",F.length),k.eventEmitter.emit(UserCallback.publish_microphone_notify,F)))}}else if(j.stream.type==n.desktop){var q=[];if(k=this.roomHandle.getUserByNodeId(j.owner_id))null==(Q=k.getScreen(j.resource_id))&&(Q=k.createScreen(j.resource_id,"")),log.debug("===acception PUB_ROOM_RESOURCE_MSG,screen,userId:"+k.id+",userName:"+k.name+",resourceInfo.stream.sdp:"+j.stream.sdp),Q.resourceInfo=j,Q.status=StreamStatus.published,Q.ownerId=k.id,q.push(Q),this.roomHandle.hasObject(this.roomHandle.pubScreens,Q)?log.info("===screen accept PUB_ROOM_RESOURCE_MSG, room.pubScreens not to push(), screenId:"+Q.id):(log.info("===screen accept PUB_ROOM_RESOURCE_MSG, room.pubScreens to push(), screenId:"+Q.id),this.roomHandle.pubScreens.push(Q)),log.info("===screen accept PUB_ROOM_RESOURCE_MSG, callback screen_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+Q.status+",screenId:"+Q.id+",screenName:"+Q.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_status_notify,Q.status,Q.id,Q.name,k.id),log.info("===screen accept PUB_ROOM_RESOURCE_MSG,callback publish_screen_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",screensLength:",q.length),k.eventEmitter.emit(UserCallback.publish_screen_notify,q)}break;case r.PUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception PUB_ROOM_RESOURCE_MSG_REP init");var G=t.decodeBody(e),W=G.id,z=G.result,Y=G.description;if(log.info("===acception PUB_ROOM_RESOURCE_MSG_REP,orderId:"+W+",result:"+z+",description:",Y),0==z)this.roomHandle.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_success,W);else{var K=new mt(z,Y);this.roomHandle.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_error,K,W)}break;case r.SUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception SUB_ROOM_RESOURCE_MSG_REP init");var X=t.decodeBody(e);W=X.id,z=X.result,Y=X.description;if(log.info("===acception SUB_ROOM_RESOURCE_MSG_REP,orderId:"+W+",result:"+z+",description:",Y),0==z)this.roomHandle.eventEmitter.emit(EngineCallback.sub_roomresourcemsg_rep_success,W);else{var J=new mt(z,Y);this.roomHandle.eventEmitter.emit(EngineCallback.sub_roomresourcemsg_rep_error,J,W)}break;case r.UNPUB_ROOM_RESOURCE_MSG:log.debug("===acception UNPUB_ROOM_RESOURCE_MSG init");j=t.decodeBody(e).info,k=this.roomHandle.getUserByNodeId(j.owner_id),S=j.resource_id&&-1<j.resource_id.indexOf("screen_audio");if(k)if(j.stream.type==n.video)(U=k.getVideo(j.resource_id))?(U.status=o.init,arrayUtil.objectSplice(this.roomHandle.pubVideos,j.resource_id),log.info("===video accept UNPUB_ROOM_RESOURCE_MSG,取消订阅视频流, callback camera_status_notify videoStatus:"+U.status+",videoId:"+U.id+",videoName:"+U.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.camera_status_notify,U.status,U.id,U.name,k.id),log.info("===video accept UNPUB_ROOM_RESOURCE_MSG,取消订阅视频流, callback unpublish_camera_notify  ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",videoId:"+U.id),k.eventEmitter.emit(UserCallback.unpublish_camera_notify,U)):log.info("===video accept UNPUB_ROOM_RESOURCE_MSG, video is null, resourceInfo.resource_id:"+j.resource_id);else if(j.stream.type==n.audio){w=null;(w=S?k.getScreenAudio():k.getAudio(j.resource_id))?(w.status=o.init,S?(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback screen_audio_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_audio_status_notify,w.status,w.id,w.name,k.id),w.unsubscrible()):(arrayUtil.objectSplice(this.roomHandle.pubAudios,j.resource_id),log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,取消订阅音频流, callback microphone_status_notify audioStatus:"+w.status+",audioId:"+w.id+",audioName:"+w.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.microphone_status_notify,w.status,w.id,w.name,k.id),avdEngineHandle.audioAutoSub?(log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,自动取消订阅音频流,to audio.unsubscrible(),ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+w.id),w.unsubscrible()):(log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,取消订阅音频流, callback unpublish_microphone_notify,ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+w.id),k.eventEmitter.emit(UserCallback.unpublish_microphone_notify,w)))):log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG, audio is null, resourceInfo.resource_id:"+j.resource_id)}else if(j.stream.type==n.desktop){var Q=k.getScreen(j.resource_id),Z=k.getScreenAudio();Q?(Q.status=o.init,arrayUtil.objectSplice(this.roomHandle.pubScreens,j.resource_id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG,取消订阅桌面共享流,, callback screen_status_notify screenStatus:"+Q.status+",screenId:"+Q.id+",videoName:"+Q.name+",userId:"+k.id),k.eventEmitter.emit(UserCallback.screen_status_notify,Q.status,Q.id,Q.name,k.id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG,取消订阅桌面共享流, callback unpublish_screen_notify  ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",screenId:"+Q.id),k.eventEmitter.emit(UserCallback.unpublish_screen_notify,Q)):log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG, screen is null, resourceInfo.resource_id:"+j.resource_id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG, screen is null, resourceInfo.resource_id:"+j.resource_id)}break;case r.UNPUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception UNPUB_ROOM_RESOURCE_MSG_REP init");var $=t.decodeBody(e);W=$.id,z=$.result,Y=$.description;if(log.info("===acception UNPUB_ROOM_RESOURCE_MSG_REP,orderId:"+W+",result:"+z+",description:",Y),0==z)this.roomHandle.eventEmitter.emit(EngineCallback.unpub_roomresourcemsg_rep_success,W);else{var ee=new mt(z,Y);this.roomHandle.eventEmitter.emit(EngineCallback.unpub_roomresourcemsg_rep_error,ee,W)}break;case r.UNSUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception UNSUB_ROOM_RESOURCE_MSG_REP init");var te=t.decodeBody(e);W=te.id,z=te.result;if(log.info("===acception UNSUB_ROOM_RESOURCE_MSG_REP,orderId:"+W+",result:"+z),0==z)this.roomHandle.eventEmitter.emit(EngineCallback.unsub_roomresourcemsg_rep_success,W);else{var re=new mt(z,"");this.roomHandle.eventEmitter.emit(EngineCallback.unsub_roomresourcemsg_rep_error,re,W)}break;case r.VIDEO_INDICTION:log.debug("===acception VIDEO_INDICTION init");var ne=t.decodeBody(e),oe=this.roomHandle.getDeviceIdByUUID(0,ne.resource_id);U=this.roomHandle.selfUser.getVideo(oe);log.debug("===acception VIDEO_INDICTION resource_id:"+ne.resource_id+",opt:"+ne.opt),ne.opt==i.pub?U.publish():ne.opt==i.unpub&&U.unpublish();break;case r.AUDIO_INDICTION:log.debug("===acception AUDIO_INDICTION init");ne=t.decodeBody(e);var ie=this.roomHandle.getDeviceIdByUUID(2,ne.resource_id);w=this.roomHandle.selfUser.getAudio(ie);log.debug("===acception AUDIO_INDICTION resource_id:"+ne.resource_id+",opt:"+ne.opt),ne.opt==i.pub?w.openMicrophone():ne.opt==i.unpub?w.closeMicrophone():ne.opt==i.mute?w.muteMicrophone():ne.opt==i.unmute&&w.unmuteMicrophone();break;case r.PUBLIC_TEXT_MSG:log.debug("===acception PUBLIC_TEXT_MSG init");var ae=t.decodeBody(e),se=gt(s.src,ae,this.roomHandle);this.roomHandle.eventEmitter.emit(RoomCallback.public_message,se);break;case r.PRIVATE_TEXT_MSG:log.debug("===acception PRIVATE_TEXT_MSG init");ae=t.decodeBody(e),se=gt(s.src,ae,this.roomHandle);this.roomHandle.eventEmitter.emit(RoomCallback.private_message,se);break;case r.PUBLIC_DATA:log.debug("===acception PUBLIC_DATA init");var de=t.decodeBody(e);k=this.roomHandle.getUserByNodeId(s.src);this.roomHandle.eventEmitter.emit(RoomCallback.public_data,de.content.toArrayBuffer(),k.id);break;case r.PRIVATE_DATA:log.debug("===acception PRIVATE_DATA init");de=t.decodeBody(e),k=this.roomHandle.getUserByNodeId(s.src);this.roomHandle.eventEmitter.emit(RoomCallback.private_data,de.content.toArrayBuffer(),k.id);break;case r.PRIVATE_DATA_TO_USER:var le=t.decodeBody(e);this.roomHandle.eventEmitter.emit(RoomCallback.private_data_to_user,le.content.toArrayBuffer(),le.src_user_id);break;case r.UPDATE_USER_DATA_MSG:log.debug("===acception UPDATE_USER_DATA_MSG init");var ue=t.decodeBody(e);(k=this.roomHandle.getUserByNodeId(ue.node_id)).data=ue.user_data,this.roomHandle.eventEmitter.emit(RoomCallback.user_data_notify,ue.user_data,k.id);break;case r.ROOM_DATA_INFO:log.debug("===acception ROOM_DATA_INFO init");var ce=t.decodeBody(e).kvs;if(null!=ce)for(y=0;y<ce.length;++y){var pe=ce[y];this.roomHandle.appData[pe.key]=pe.value,this.roomHandle.eventEmitter.emit(RoomCallback.app_data_notify,pe.key,pe.value),pe.key==appDataKeyEnum.voiceActivated&&pe.value==this.roomHandle.selfUser.id&&(log.debug("===acception ROOM_DATA_INFO voice_activated key:"+pe.key+",value:"+pe.value),this.roomHandle.voiceActivatedHandler())}break;case r.USER_INDICTION:log.debug("===acception USER_INDICTION init");var he=t.decodeBody(e);if(he.type==r.USER_MSG){var fe=t.decodeUserMsg(he.body),me=this.roomHandle.getUserId(he.operator_id);log.info("===acception USER_INDICTION,callback leave_indication,reason:"+fe.reason+",userId:"+me),this.roomHandle.eventEmitter.emit(RoomCallback.leave_indication,fe.reason,me);this.roomHandle.leave(fe.reason,!0)}break;case r.USER_MSG:c=this;log.debug("===acception USER_MSG init");fe=t.decodeBody(e);if(k=this.roomHandle.getUserByNodeId(fe.node_id)){log.info("===acception USER_MSG reason:"+fe.reason+",userId:"+k.id+",userName:"+k.name+",nodeId:"+fe.node_id),"avd_mp4_importer"==k.userAgent&&(this.roomHandle.mp4ImporterUserAudioRtpPacketTemp=0,this.roomHandle.mp4ImporterUserAudioRtpPacketReal=0),k.videos&&0<k.videos.length&&k.videos.forEach(function(e){c.roomHandle&&c.roomHandle.pubVideos&&0<c.roomHandle.pubVideos.length&&arrayUtil.objectSplice(c.roomHandle.pubVideos,e.id),c.roomHandle&&c.roomHandle.selfUser.subVideoIds&&0<c.roomHandle.selfUser.subVideoIds.length&&-1<c.roomHandle.selfUser.subVideoIds.indexOf(e.id)&&(log.debug("===acception USER_MSG,to video.unsubscrible(),userId:"+k.id+",userName:"+k.name+",videoId:"+e.id),e.unsubscrible())}),k.audio&&(this.roomHandle&&this.roomHandle.pubAudios&&0<this.roomHandle.pubAudios.length&&arrayUtil.objectSplice(this.roomHandle.pubAudios,k.audio.id),this.roomHandle&&this.roomHandle.selfUser.subAudioIds&&0<this.roomHandle.selfUser.subAudioIds.length&&k.audio.resourceInfo&&(log.debug("===acception USER_MSG,to audio.unsubscrible(),userId:"+k.id+",userName:"+k.name+",audioId:"+k.audio.id),-1<this.roomHandle.selfUser.subAudioIds.indexOf(k.audio.id)&&k.audio.unsubscrible())),k.screen&&(this.roomHandle&&this.roomHandle.pubScreens&&0<this.roomHandle.pubScreens.length&&arrayUtil.objectSplice(this.roomHandle.pubScreens,k.screen.id),this.roomHandle&&this.roomHandle.selfUser.subScreenIds&&0<this.roomHandle.selfUser.subScreenIds.length&&k.screen.resourceInfo&&(log.debug("===acception USER_MSG,to screen.unsubscrible(),userId:"+k.id+",userName:"+k.name+",screenId:"+k.screen.id),-1<this.roomHandle.selfUser.subScreenIds.indexOf(k.screen.id)&&k.screen.unsubscrible()));c=this;if(setTimeout(function(){c.roomHandle&&(c.roomHandle.selfUser.nodeId!=k.nodeId||c.roomHandle.selfUser.waitingDelete)&&(log.debug("===acception USER_MSG,to remove user,userId:"+k.id+",nodeId:"+k.nodeId+",userName:"+k.name),c.roomHandle.removeUserByUserIdAndNodeId(k.id,k.nodeId))},3500),804==fe.reason)return void(k.id==this.roomHandle.selfUser.id?(this.roomHandle.selfUser.mulLanding=!0,this.roomHandle.masterServer.pingInit(),log.info("===acception USER_MSG,callback leave_indication,reason:"+fe.reason+",userId:"+this.roomHandle.selfUser.id+",userName:"+this.roomHandle.selfUser.name),this.roomHandle.eventEmitter.emit(RoomCallback.leave_indication,fe.reason,this.roomHandle.selfUser.id),this.roomHandle.leave(fe.reason,!0)):(k.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+fe.reason+",userId:"+k.id+",userName:"+k.name),this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,fe.opt,fe.reason,k)));if(807==fe.reason)return k.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+fe.reason+",userId:"+k.id+",userName:"+k.name),void this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,fe.opt,fe.reason,k);if(808==fe.reason)return void(k.id==this.roomHandle.selfUser.id?(this.roomHandle.masterServer.pingInit(),log.info("===acception USER_MSG,callback leave_indication,reason:"+fe.reason+",userId:"+this.roomHandle.selfUser.id+",userName:"+this.roomHandle.selfUser.name),this.roomHandle.eventEmitter.emit(RoomCallback.leave_indication,fe.reason,this.roomHandle.selfUser.id),this.roomHandle.leave(fe.reason,!0)):(k.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+fe.reason+",userId:"+k.id+",userName:"+k.name),this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,fe.opt,fe.reason,k)));if(812==fe.reason)return void(k.id!=this.roomHandle.selfUser.id&&(k.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+fe.reason+",userId:"+k.id+",userName:"+k.name),this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,fe.opt,fe.reason,k)));var ge=[];if(null!=this.roomHandle.boardId2userId&&0<Object.keys(this.roomHandle.boardId2userId).length)for(var ve in this.roomHandle.boardId2userId)this.roomHandle.boardId2userId[ve]==k.id&&(ge.push(ve),delete this.roomHandle.boardId2userId[ve]);if(null!=this.roomHandle.annotation2boardId&&0<Object.keys(this.roomHandle.annotation2boardId).length)for(var ve in this.roomHandle.annotation2boardId)-1<ge.indexOf(ve)&&delete this.roomHandle.annotation2boardId[ve];return k.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+fe.reason+",userId:"+k.id+",userName:"+k.name),void this.roomHandle.eventEmitter.emit(RoomCallback.user_leave_notify,fe.opt,fe.reason,k)}break;case r.CLOSE_ROOM_REP:log.debug("===acception CLOSE_ROOM_REP init");var ye=t.decodeBody(e);log.info("===acception CLOSE_ROOM_REP,callback close_room_result,result:"+ye.result+",description:"+ye.description),this.roomHandle.eventEmitter.emit(RoomCallback.close_room_result,ye.result,ye.description),this.roomHandle.masterServer.signalingChannel.close(),this.roomHandle=null;break;case r.CLOSE_ROOM_MSG:log.debug("===acception CLOSE_ROOM_MSG init");var _e=t.decodeBody(e);this.roomHandle.userClearInfo(),log.info("===acception CLOSE_ROOM_MSG,callback close_room_notify,reason:"+_e.reason+",roomId:"+_e.room_id),this.roomHandle.eventEmitter.emit(RoomCallback.close_room_notify,_e.room_id,_e.reason);break;case r.UPDATE_USER_NAME:log.debug("===acception UPDATE_USER_NAME init");var be=t.decodeBody(e);k=this.roomHandle.getUserByNodeId(be.node_id);this.roomHandle.participants.forEach(function(e){e.id==e.id&&(e.name=be.new_name)}),log.info("===acception UPDATE_USER_NAME,callback user_name_notify,newName:"+be.new_name+",userId:"+k.id),this.roomHandle.eventEmitter.emit(RoomCallback.user_name_notify,be.new_name,k.id);break;case r.MODIFY_RESOURCE_REQ:log.debug("===acception MODIFY_RESOURCE_REQ init");var Se=t.decodeBody(e);log.debug("===acception MODIFY_RESOURCE_REQ,on modify resource req,resource_id:"+Se.info.resource_id);var we=this.roomHandle.getDeviceIdByUUID(0,Se.info.resource_id);if(avdEngineHandle.ignoreModifyResourceReq){log.info("===acception MODIFY_RESOURCE_REQ, avdEngineHandle.ignoreModifyResourceReq is true to return, resource_id:"+Se.info.resource_id+",video_level:"+Se.video_level);break}(U=this.roomHandle.selfUser.getVideo(we))&&(log.info("===acception MODIFY_RESOURCE_REQ,to video.changePublishVideoQuality(),videoId:"+U.id+",video_level:"+Se.video_level),U.changePublishVideoQuality(Se.video_level));break;case r.VIDEO_STREAM_CONTROL_REP:log.debug("===acception VIDEO_STREAM_CONTROL_REP init");var Ee=t.decodeBody(e),Ie=(W=Ee.id,z=Ee.ret,Ee.msg);if(log.info("===acception VIDEO_STREAM_CONTROL_REP,orderId:"+W+",result:"+z+",msg:",Ie),0==z)this.roomHandle.eventEmitter.emit(UserCallback.video_stream_control_rep_success,W);else{var Te=new mt(z,Ie);this.roomHandle.eventEmitter.emit(UserCallback.video_stream_control_rep_error,Te,W)}break;case r.BIND_AUDIO_TO_VIDEO_REP:log.debug("===acception BIND_AUDIO_TO_VIDEO_REP init");var Ce=t.decodeBody(e);Ce&&0==Ce.result?this.roomHandle.eventEmitter.emit(RoomCallback.bind_audio2video_rep_success,Ce.id):this.roomHandle.eventEmitter.emit(RoomCallback.bind_audio2video_rep_error,Ce.id);break;case r.USER_STREAM_ACTIVE:log.debug("===acception USER_STREAM_ACTIVE init");var Re=t.decodeBody(e);if(Re&&Re.resource_id){var Pe=Re.resource_id,ke=Re.active_base,xe=Re.active_ass1,Me=Re.active_ass2;log.debug("===acception USER_STREAM_ACTIVE resource_id:"+Pe+",active_base:"+ke+",active_ass1:"+xe+",active_ass2:"+Me);we=this.roomHandle.getDeviceIdByUUID(0,Pe);(U=this.roomHandle.selfUser.getVideo(we))&&U.setSpatialLayerActive(ke,xe,Me)}break;case r.ROOM_ATTRIBUTE_CHANGE_NOTIFY:log.debug("===acception ROOM_ATTRIBUTE_CHANGE_NOTIFY init");var Ae=t.decodeBody(e);if(Ae){var Oe=Ae.attributes;if(Oe){var Ue=JSON.parse(Oe);Ue.record&&(this.roomHandle.roomControl.record=Ue.record),Ue.mix_record&&(this.roomHandle.roomControl.mix_record=Ue.mix_record),Ue.avc_model&&(this.roomHandle.roomControl.avc_model=Ue.avc_model),Ue.resolution&&(this.roomHandle.roomControl.resolution=Ue.resolution),Ue.liver&&(this.roomHandle.roomControl.liver=Ue.liver),Ue.mixer_liver&&(this.roomHandle.roomControl.mixer_liver=Ue.mixer_liver),this.roomHandle.eventEmitter.emit(RoomCallback.room_control_change_notify,this.roomHandle.roomControl)}}break;case r.MEDIA_PLAY_EVENT_NOTIFY:c=this;log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY init");var De=t.decodeBody(e);if(De){if(De.event==a.MediaPlayEventsStarted)this.roomHandle.mp4ImporterUserAudioStateStart(200),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY callback mediaplay_started_notify, id:"+De.id+",roomId:"+De.room_id+",userId:"+De.user_id+",playId:"+De.play_id+",filePath:"+De.file_path),this.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_started_notify,De.id,De.room_id,De.user_id,De.play_id,De.file_path);else if(De.event==a.MediaPlayEventsStoped){(k=this.roomHandle.getUser(De.user_id))?k.audio?0==k.audio.audioLevel?(this.roomHandle.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY callback mediaplay_stoped_notify, id:"+De.id+",roomId:"+De.room_id+",userId:"+De.user_id+",playId:"+De.play_id+",filePath:"+De.file_path),this.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,De.id,De.room_id,De.user_id,De.play_id,De.file_path)):(null==this.roomHandle.baseMediaPalyEventStopTime&&(this.roomHandle.baseMediaPalyEventStopTime=new Date),this.roomHandle.mediaPalyEventStopIntervalId=setInterval(function(){1e3<=new Date-c.roomHandle.baseMediaPalyEventStopTime&&(clearInterval(c.roomHandle.mediaPalyEventStopIntervalId),c.roomHandle.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY timeout callback mediaplay_stoped_notify, id:"+De.id+",roomId:"+De.room_id+",userId:"+De.user_id+",playId:"+De.play_id+",filePath:"+De.file_path),c.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,De.id,De.room_id,De.user_id,De.play_id,De.file_path)),0==k.audio.audioLevel&&(clearInterval(c.roomHandle.mediaPalyEventStopIntervalId),c.roomHandle.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY IntervalId callback mediaplay_stoped_notify, id:"+De.id+",roomId:"+De.room_id+",userId:"+De.user_id+",playId:"+De.play_id+",filePath:"+De.file_path),c.roomHandle.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,De.id,De.room_id,De.user_id,De.play_id,De.file_path))},100)):log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY user.audio is null"):log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY user is null")}}else log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY mediaPlayEventNotify is null");break;case r.STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY:log.debug("===acception STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY init");var Le=t.decodeBody(e);if(Le&&Le.onwer_id)(k=this.roomHandle.getUserByNodeId(Le.onwer_id))&&(log.info("===acception STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY callback stream_keep_alive_timeout_notify, userId:"+k.id+", userName:"+k.name+", mediaType:"+Le.media_type+", resourceId:"+Le.resource_id+", ssrc:"+Le.ssrc),this.roomHandle.eventEmitter.emit(RoomCallback.stream_keep_alive_timeout_notify,k.id,k.name,Le.media_type,Le.resource_id,Le.ssrc));break;case r.OFFER_REQ:log.debug("===P2P acception OFFER_REQ");var He=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.setRemoteP2P(He);break;case r.OFFER_REP:log.debug("===P2P acception OFFER_REP");var Ne=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.setAnswerP2P(Ne);break;case r.CANDIDATE_MSG:log.debug("===P2P acception CANDIDATE_MSG");f=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.addIceCandidateP2P(f);break;case r.SUB_ROOM_RESOURCE_REQ:log.debug("===P2P acception SUB_ROOM_RESOURCE_REQ");var Be=t.decodeBody(e);if(this.roomHandle.selfUser.nodeId>Be.sub_node_id){this.roomHandle.traceableP2PPeerConnection.addStreamP2P(Be);var je=Be.info,Ve=this.roomHandle.traceableP2PPeerConnection.getToP2PPeerConnection(Be.sub_node_id);je.stream.type==n.video?(log.info("===accept video P2P SUB_ROOM_RESOURCE_REQ: "+Be.sub_node_id+"------\x3e"+this.roomHandle.selfUser.nodeId),this.roomHandle.selfUser.subVideoStream2ResourceInfo[je.stream.stream_name]=je,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Ve,"video",1,je,Be.sub_node_id)):je.stream.type==n.audio?(log.info("===accept audio P2P SUB_ROOM_RESOURCE_REQ: "+Be.sub_node_id+"------\x3e"+this.roomHandle.selfUser.nodeId),this.roomHandle.selfUser.subAudioStream2ResourceInfo[je.stream.stream_name]=je,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Ve,"audio",1,je,Be.sub_node_id)):je.stream.type==n.desktop&&(log.info("===accept desktop P2P  SUB_ROOM_RESOURCE_REQ: "+Be.sub_node_id+"------\x3e"+this.roomHandle.selfUser.nodeId),this.roomHandle.selfUser.subScreenStream2ResourceInfo[je.stream.stream_name]=je,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Ve,"desktop",1,je,Be.sub_node_id))}else this.roomHandle.traceableP2PPeerConnection.addStreamP2P(Be),this.roomHandle.traceableP2PPeerConnection.sendSubSdpOfferP2P("answerSub",Be);break;case r.SUB_ROOM_RESOURCE_REP:log.debug("===P2P acception SUB_ROOM_RESOURCE_REP, TO sub");var Fe=t.decodeBody(e);if(this.roomHandle.selfUser.nodeId>Fe.info.owner_id){je=Fe.info,Ve=this.roomHandle.traceableP2PPeerConnection.getToP2PPeerConnection(je.owner_id);je.stream.type==n.video?(this.roomHandle.selfUser.subVideoStream2ResourceInfo[je.stream.stream_name]=je,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Ve,"video",1,je,je.owner_id)):je.stream.type==n.audio?(this.roomHandle.selfUser.subAudioStream2ResourceInfo[je.stream.stream_name]=je,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Ve,"audio",1,je,je.owner_id)):je.stream.type==n.desktop&&(this.roomHandle.selfUser.subScreenStream2ResourceInfo[je.stream.stream_name]=je,this.roomHandle.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Ve,"desktop",1,je,je.owner_id))}else this.roomHandle.traceableP2PPeerConnection.getSubSdpAnswerP2PByRep(Fe);break;case r.SUB_ROOM_RESOURCE_MSG:log.debug("===P2P acception SUB_ROOM_RESOURCE_MSG");var qe=t.decodeBody(e);this.roomHandle.traceableP2PPeerConnection.getSubSdpAnswerP2P(qe);break;case r.UPDATE_BOARD_MSG:log.debug("===acception UPDATE_BOARD_MSG init");var Ge=t.decodeBody(e);log.debug("===acception UPDATE_BOARD_MSG,operType:"+Ge.operType+",operNodeId:"+Ge.operNodeId+",operUserId:"+Ge.operUserId+",boardId:"+Ge.boardId);c=this;setTimeout(function(){function e(e){var t=e.board.bgColor,r=t.r+","+t.g+","+t.b+","+t.a/255,n=new ft(c.roomHandle,e.board.ownerUserId,e.board.width,e.board.height,r,e.board.bgImage,e.board.title,"","",e.board.description,e.board.extendData);n.setBoardId(e.board.objectId),d.boards&&d.boards.push(n),c.roomHandle.boardId2userId[n.id]=d.id,d.eventEmitter.emit(UserCallback.board_add_result,n)}function t(e){var t=c.roomHandle.getUser(c.roomHandle.boardId2userId[e.boardId]),r=t.getBoard(e.boardId),n=[],o=[];if(r.status=boardStatusEnum.open,c.roomHandle.annotation2boardId[e.boardId]){if(n=c.roomHandle.annotation2boardId[e.boardId].storageArr,(o=c.roomHandle.annotation2boardId[e.boardId].queueArr).length<0)for(var i in n)o.push(n[i]);else for(var a in o)for(var i in n)n[i].annotationType!=shapeTypeEnum.img&&n[i].annotationId!=o[a].annotationId&&n[i].operType!=o[a].operType&&o.push(n[i]);c.roomHandle.updateAnnotationDrow(o)}t.eventEmitter.emit(UserCallback.board_share_result,r)}function r(e){arrayUtil.objectSplice(d.boards,e.boardId),delete c.roomHandle.boardId2userId[d.id],delete c.roomHandle.annotation2boardId[e.boardId],d.eventEmitter.emit(UserCallback.board_remove_result,e.boardId)}function n(e){var t=c.roomHandle.getUser(c.roomHandle.boardId2userId[e.boardId]),r=t.getBoard(e.boardId);if(r.status=boardStatusEnum.close,r.annotation=null,c.roomHandle.annotation2boardId[e.boardId])for(var n in c.roomHandle.annotation2boardId[e.boardId].storageArr)c.roomHandle.annotation2boardId[e.boardId].queueArr.push(c.roomHandle.annotation2boardId[e.boardId].storageArr[n]);t.eventEmitter.emit(UserCallback.board_close_result,e.boardId)}if(d=c.roomHandle.getUser(Ge.operUserId)){var o=Ge.boardId;if(Ge.operType==OperType.add)log.debug("===acception UPDATE_BOARD_MSG,operType=add"),c.roomHandle.boardAddOrShareMsgMap.get(o)&&c.roomHandle.boardAddOrShareMsgMap.get(o).share?(e(Ge),t(Ge),c.roomHandle.boardAddOrShareMsgMap.delete(o)):(c.roomHandle.boardAddOrShareMsgMap.set(o,{add:!0,share:!1}),setTimeout(function(){c.roomHandle.boardAddOrShareMsgMap.delete(o)},1e3));else if(Ge.operType==OperType.update){log.debug("===acception UPDATE_BOARD_MSG,operType=update");var i=Ge.board.bgColor,a=i.r+","+i.g+","+i.b+","+i.a/255,s=Ge.board.bgImage;o=Ge.board.objectId;log.debug("===acception UPDATE_BOARD_MSG,operType=update,boardId:"+o+",backgroundColor:"+a+",backgroundImage:"+s),d.eventEmitter.emit(UserCallback.board_update_result,o,a,s)}else if(Ge.operType==OperType.remove){if(log.debug("===acception UPDATE_BOARD_MSG,operType=remove"),c.roomHandle.boardCloseOrRemoveMsgMap.get(o)&&c.roomHandle.boardCloseOrRemoveMsgMap.get(o).close)n(Ge),r(Ge),c.roomHandle.boardCloseOrRemoveMsgMap.delete(o);else(d=c.roomHandle.getUser(c.roomHandle.boardId2userId[Ge.boardId])).getBoard(Ge.boardId)?(r(Ge),c.roomHandle.boardCloseOrRemoveMsgMap.delete(o)):(c.roomHandle.boardCloseOrRemoveMsgMap.set(o,{close:!1,remove:!0}),setTimeout(function(){c.roomHandle.boardCloseOrRemoveMsgMap.delete(o)},1e3))}else if(Ge.operType==OperType.share){if(log.debug("===acception UPDATE_BOARD_MSG,operType=share"),c.roomHandle.boardAddOrShareMsgMap.get(o)&&c.roomHandle.boardAddOrShareMsgMap.get(o).add)e(Ge),t(Ge),c.roomHandle.boardAddOrShareMsgMap.delete(o);else(d=c.roomHandle.getUser(Ge.operUserId)).getBoard(Ge.boardId)?(t(Ge),c.roomHandle.boardAddOrShareMsgMap.delete(o)):(e(Ge),t(Ge),c.roomHandle.boardAddOrShareMsgMap.set(o,{add:!1,share:!0}),setTimeout(function(){c.roomHandle.boardAddOrShareMsgMap.delete(o)},1e3))}else if(Ge.operType==OperType.close){var d;if(log.debug("===acception UPDATE_BOARD_MSG,operType=close"),c.roomHandle.boardCloseOrRemoveMsgMap.get(o)&&c.roomHandle.boardCloseOrRemoveMsgMap.get(o).remove)n(Ge),r(Ge),c.roomHandle.boardCloseOrRemoveMsgMap.delete(o);else(d=c.roomHandle.getUser(c.roomHandle.boardId2userId[Ge.boardId])).getBoard(Ge.boardId)?(n(Ge),c.roomHandle.boardCloseOrRemoveMsgMap.delete(o)):(c.roomHandle.boardCloseOrRemoveMsgMap.set(o,{close:!0,remove:!1}),setTimeout(function(){c.roomHandle.boardCloseOrRemoveMsgMap.delete(o)},1e3))}}},500);break;case r.UPDATE_BOARD_MSG_REP:log.debug("===acception UPDATE_BOARD_MSG_REP init");var We=t.decodeBody(e);log.info("===acception UPDATE_BOARD_MSG_REP, boardId:"+We.boardId+", result:"+We.result+", description:"+We.description);k=this.roomHandle.getUser(this.roomHandle.boardId2userId[We.boardId]);if(0==We.result)k.eventEmitter.emit(EngineCallback.updateboardmsg_rep_success,We.boardId);else{var ze=new mt(We.result,We.description);k.eventEmitter.emit(EngineCallback.updateboardmsg_rep_error,ze,We.boardId)}break;case r.BOARDS_INFO_PDU:log.debug("===acception BOARDS_INFO_PDU init");var Ye=t.decodeBody(e);break;case r.UPDATE_ANNOTATION_MSG:log.debug("===acception UPDATE_ANNOTATION_MSG init");var Ke=t.decodeBody(e);console.log("===acception UPDATE_ANNOTATION_MSG updateAnnotationMsg:",Ke),log.debug("===acception UPDATE_ANNOTATION_MSG, operType:"+Ke.operType+",objectId:"+Ke.objectId+",annotationType:"+Ke.annotationType+",annotationId:"+Ke.annotationId+",operNodeId:"+Ke.operNodeId+",operUserId:"+Ke.operUserId),this.roomHandle.addAnnotationMsg(Ke);k=this.roomHandle.getUser(this.roomHandle.boardId2userId[Ke.objectId]);if(Ke.annotationType==shapeTypeEnum.clear&&this.roomHandle.annotation2boardId[Ke.objectId]&&0<this.roomHandle.annotation2boardId[Ke.objectId].storageArr.length)for(y=0;y<this.roomHandle.annotation2boardId[Ke.objectId].storageArr.length;y++){var Xe=this.roomHandle.annotation2boardId[Ke.objectId].storageArr[y];Xe.operUserId==Ke.operUserId&&Xe.operType==OperType.add&&(this.roomHandle.annotation2boardId[Ke.objectId].storageArr.splice(y,1),y--)}if(k){var Je=k.getBoard(Ke.objectId),Qe=this.roomHandle.annotation2boardId[Ke.objectId];log.debug("===acception UPDATE_ANNOTATION_MSG"),Je&&Je.status==boardStatusEnum.open&&Qe&&(log.debug("===acception UPDATE_ANNOTATION_MSG, board.status == boardStatusEnum.open"),this.roomHandle.updateAnnotationDrow(Qe.queueArr))}break;case r.OUTGOING_CREATE_STREAMS_EXPORTER_REP:log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP init");var Ze=t.decodeBody(e);if(0==Ze.result)log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP,callback create_server_recorder_rep_success,result:0,outgoingCreateStreamsExporterRep.exporter_id:",Ze.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_success,Ze.id,Ze.exporter_id,Ze.exporter_name,Ze.play_urls);else{log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP,callbakc create_server_recorder_rep_error, result:"+Ze.result+",msg:"+Ze.msg+",exporter_id:",Ze.exporter_id);var $e=new mt(Ze.result,Ze.msg);this.roomHandle.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_error,$e,Ze.id)}break;case r.OUTGOING_SELECT_STREAM_REP:log.debug("===acception OUTGOING_SELECT_STREAM_REP init");var et=t.decodeBody(e);if(0==et.result)log.debug("===acception OUTGOING_SELECT_STREAM_REP,callback select_stream_rep_success,result:0,selectStreamRep.exporter_id:",et.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.select_stream_rep_success,et.id,et.exporter_id);else{log.debug("===acception OUTGOING_SELECT_STREAM_REP,callbakc select_stream_rep_error, result:"+et.result+",msg:"+et.msg+",exporter_id:",et.exporter_id);var tt=new mt(et.result,et.msg);this.roomHandle.eventEmitter.emit(ExporderCallBack.select_stream_rep_error,tt,et.id)}break;case r.OUTGOING_MIX_STREAMS_REP:log.debug("===acception OUTGOING_MIX_STREAMS_REP init");var rt=t.decodeBody(e);if(0==rt.result)log.debug("===acception OUTGOING_MIX_STREAMS_REP,callback mix_media_rep_success,result:0,mixStreamsRep.exporter_id:",rt.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.mix_media_rep_success,rt.id,rt.exporter_id);else{log.debug("===acception OUTGOING_MIX_STREAMS_REP,callbakc mix_media_rep_error, result:"+rt.result+",msg:"+rt.msg+",exporter_id:",rt.exporter_id);tt=new mt(rt.result,rt.msg);this.roomHandle.eventEmitter.emit(ExporderCallBack.mix_media_rep_error,tt,rt.id)}break;case r.OUTGOING_PAUSE_RESUME_EXPORTER_REP:log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP init");var nt=t.decodeBody(e);if(0==nt.result)log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP,callback pause_stream_rep_success,result:0,pauseResumeRep.exporter_id:",nt.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.pause_stream_rep_success,nt.id,nt.exporter_id);else{log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP,callbakc pause_stream_rep_error, result:"+nt.result+",msg:"+nt.msg+",exporter_id:",nt.exporter_id);tt=new mt(nt.result,nt.msg);this.roomHandle.eventEmitter.emit(ExporderCallBack.pause_stream_rep_error,tt,nt.id)}log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP pauseResumeRep:",nt);break;case r.OUTGOING_DESTROY_EXPORTER_REP:log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP init ");var ot=t.decodeBody(e);if(0==ot.result)log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP,callback stop_stream_rep_success, result:0, stopStreamRep.exporter_id:",ot.exporter_id),this.roomHandle.eventEmitter.emit(ExporderCallBack.stop_stream_rep_success,ot.id,ot.exporter_id);else{log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP,callback stop_stream_rep_error, result:"+ot.result+",msg"+ot.msg+", stopStreamRep.exporter_id:",ot.exporter_id);tt=new mt(ot.result,ot.msg);this.roomHandle.eventEmitter.emit(ExporderCallBack.stop_stream_rep_error,tt,ot.id)}break;case r.OUTGOING_EXPORTER_ERROR_NOTIFY:log.debug("===acception OUTGOING_EXPORTER_ERROR_NOTIFY init");Ye=t.decodeBody(e);log.debug("===acception OUTGOING_EXPORTER_ERROR_NOTIFY boardsInfoMsg:",Ye);break;case r.OUTGOING_INVITE_STATUS_NOTIFY:log.debug("===acception SIP_INVITE_STATUS_NOTIFY init");var it=t.decodeBody(e);log.debug("===acception SIP_INVITE_STATUS_NOTIFY,callbakc outgoing_invite_status_notify,statusNotify:",it.outgoing_invite_status_notify),this.roomHandle.eventEmitter.emit(RoomCallback.outgoing_invite_status_notify,it.type,it.room_id,it.sip_addr,it.status,it.msg);break;case r.ROOM_SET_STREAM_NAME_RSP:log.debug("===acception ROOM_SET_STREAM_NAME_RSP init");var at=t.decodeBody(e);if(0==at.ret)log.debug("===acception ROOM_SET_STREAM_NAME_RSP,callback room_set_stream_name_rep_success, result:0, roomSetStreamNameRsp.id:",at.id),this.roomHandle.eventEmitter.emit(UserCallback.room_set_stream_name_rep_success,at.id);else{log.debug("===acception ROOM_SET_STREAM_NAME_RSP,callback room_set_stream_name_rep_error, result:"+at.result+",msg:"+at.msg+", roomSetStreamNameRsp.id:",at.id);var st=new mt(at.ret,at.msg);this.roomHandle.eventEmitter.emit(UserCallback.room_set_stream_name_rep_error,st,at.id)}break;case r.ROOM_STREAM_NAME_CHANGED_NOTIFY:log.debug("===acception ROOM_STREAM_NAME_CHANGED_NOTIFY init");var dt=t.decodeBody(e);log.debug("===acception ROOM_STREAM_NAME_CHANGED_NOTIFY roomStreamNameChangedNotify",dt),(k=this.roomHandle.getUser(dt.user_id))&&k.id!=this.roomHandle.selfUser.id&&(U=k.getVideo(dt.video_resource_id))&&(U.streamName=dt.stream_name,U.streamNickName=dt.stream_nick_name);break;case r.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP:log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP init");var lt=t.decodeBody(e);if(0==lt.ret)log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP,callback set_focus_video_rep_success, result:0, outgoingExporterSetFocusVideoRsp.id:",lt.id),this.roomHandle.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_success,lt.id);else{log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP,callback set_focus_video_rep_error, result:"+lt.result+",msg:"+lt.msg+", outgoingExporterSetFocusVideoRsp.id:",lt.id);var ut=new mt(lt.ret,lt.msg);this.roomHandle.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_error,ut,lt.id)}break;case r.OUTGOING_GET_EXPORTER_INFO_RSP:log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP init");var ct=t.decodeBody(e);log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP outgoingGetExporterInfoRsp:",ct);V=null;log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP outgoingGetExporterInfoRsp.videos:",ct.videos),ct.videos&&0<ct.videos.length&&(V=t.decodeOutgoingVideoInfo(ct.videos)),this.roomHandle.eventEmitter.emit(ExporderCallBack.get_exporter_info_rep_success,ct.id,ct,V)}},e}),ModuleBase.define("User",["Video","Audio","Screen","ScreenAudio","Board","Error"],function(n,o,i,a,h,f){var e=function(e,t,r,n){this.roomHandle=n,this.id=e,this.name=t,this.data=r,this.eventEmitter=new EventEmitter,this.subVideoTrack2ResourceInfo={},this.subAudioTrack2ResourceInfo={},this.subScreenTrack2ResourceInfo={},this.reJoinSubVideoIds=[],this.reJoinSubAudioIds=[],this.reJoinSubScreenIds=[],this.reJoinVideoId2CustomSet={},this.reJoinScreenDescription=null,this.boards=[],this.screenStream=null,this.init()};return e.prototype.init=function(){this.nodeId=null,this.role=null,this.userAgent=null,this.stream=null,this.waitingDelete=!1,this.videos=[],this.audio,this.screen,this.toMCUPC,this.mulLanding=!1,this.deviceId2VideoSdpSsrc={},this.audioSdpSsrc,this.screenSdpSsrc,this.subVideoIds=[],this.subAudioIds=[],this.subScreenIds=[],this.toP2PPCs={},this.sdpP2PMap={},this.videoSdpSsrcMapP2PMap={},this.audioSdpSsrcP2PMap={},this.screenSdpSsrcP2PMap={},this.subMyVideosP2P=[],this.subMyAudiosP2P=[],this.subMyScreensP2P=[]},e.prototype.createVideo=function(e,t){var r=new n(e,t,this.roomHandle);return r.ownerId=this.id,this.videos.push(r),r},e.prototype.createAudio=function(e,t){var r=new o(e,t,this.roomHandle);return r.ownerId=this.id,this.audio=r},e.prototype.createScreen=function(e,t){var r=new i(e,t,this.roomHandle);return r.ownerId=this.id,this.screen=r},e.prototype.createScreenAudio=function(e,t){var r=new a(e,t,this.roomHandle);return r.ownerId=this.id,this.screen.screenAudio=r},e.prototype.initScreen=function(){var e=Math.uuid(),t=this.name+"-screen",r=e+"_screen_audio",n=this.name+"-screen-audio",o=this.createScreen(e,t),i=this.createScreenAudio(r,n);o.level=0,o.description="",o.screenAudio=i,this.reJoinScreenDescription&&(o.description=this.reJoinScreenDescription),this.eventEmitter.emit(UserCallback.screen_status_notify,o.status,o.id,o.name,this.id),this.roomHandle.masterServer.addScreenMsg(e,o),this.roomHandle.masterServer.addSpeakerMsg(r,i)},e.prototype.initVideo=function(e,t){var r=this.createVideo(e,t);r.cameraType=CameraType.unknown,r.level=0,r.description="";var n=this.reJoinVideoId2CustomSet[e];n&&(n.aspectRatio&&(r.aspectRatio=n.aspectRatio),n.description&&(r.description=n.description),n.width&&(r.resolution.width=n.width),n.height&&(r.resolution.height=n.height),n.setType&&(r.setType=n.setType),n.frameRate&&(r.frameRate=n.frameRate)),this.eventEmitter.emit(UserCallback.camera_status_notify,r.status,r.id,r.name,this.id);var o=this.roomHandle.setDeviceIdByUUID(0,e);this.roomHandle.masterServer.addWebcamMsg(o,r)},e.prototype.deleteVideo=function(t){var r=this,n=r.getVideo(t);if(n)if(n.status==StreamStatus.published)n.unpublish().then(function(){arrayUtil.objectSplice(r.videos,t),r.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,n.id,n.name,r.id);var e=r.roomHandle.setDeviceIdByUUID(0,t);r.roomHandle.masterServer.removeWebcamMsg(e)});else{n.status==StreamStatus.opened&&n.unpreview(),arrayUtil.objectSplice(r.videos,t),r.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,n.id,n.name,r.id);var e=r.roomHandle.setDeviceIdByUUID(0,t);r.roomHandle.masterServer.removeWebcamMsg(e)}},e.prototype.initAudio=function(e,t){var r=this.createAudio(e,t);avdEngineHandle.checkAudioId=e,avdEngineHandle.checkAudioName=t,this.eventEmitter.emit(UserCallback.microphone_status_notify,r.status,r.id,r.name,this.id);var n=this.roomHandle.setDeviceIdByUUID(2,e);this.roomHandle.masterServer.addSpeakerMsg(n,r)},e.prototype.deleteAudio=function(t){var r=this,n=r.getAudio(t);if(n)if(n.status==StreamStatus.published)n.closeMicrophone().then(function(){var e=r.roomHandle.setDeviceIdByUUID(2,t);r.roomHandle.masterServer.removeSpeakerMsg(e),r.audio=null,r.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,n.id,n.name,r.id)});else{var e=r.roomHandle.setDeviceIdByUUID(2,t);r.roomHandle.masterServer.removeSpeakerMsg(e),r.audio=null,r.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,n.id,n.name,r.id)}},e.prototype.getVideo=function(e){for(var t=null,r=0;r<this.videos.length;r++){var n=this.videos[r];if(n.id==e){t=n;break}}return t},e.prototype.getScreen=function(){return this.screen},e.prototype.getScreenAudio=function(){return this.screen.screenAudio},e.prototype.getAudio=function(e){var t=null;return this.audio&&this.audio.id==e&&(t=this.audio),t},e.prototype.openCameraAndMicrophone=function(s,d,l,u){log.info("===user.openCameraAndMicrophone(),预览摄像头及发布流和打开麦克风"),avdEngineHandle.loggerReport.info("预览摄像头及发布流和打开麦克风");var c=when.defer(),p=this;return s&&null==d?s.publish():null==s&&d?d.openMicrophone():s&&d&&obtainUserMedia(d,s,function(e){var r=getRandomNum(1,3e3);s.status=StreamStatus.opened,s.track=e.videoStream.getVideoTracks()[0],null==p.roomHandle.selfUser.stream?p.roomHandle.selfUser.stream=e.videoStream:p.roomHandle.selfUser.stream.addTrack(s.track);var t=p.roomHandle.setDeviceIdByUUID(0,s.id),n=p.getNewStreamByTrack(s.track);p.roomHandle.masterServer.videoPublishHandle(t,n,r),p.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==r&&((s.element=l).srcObject=n,s.status=StreamStatus.published,p.roomHandle.hasObject(p.roomHandle.pubVideos,s)||p.roomHandle.pubVideos.push(s),p.eventEmitter.emit(UserCallback.camera_status_notify,s.status,s.id,s.name,p.id))}),p.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==r&&c.reject(e)});var o=getRandomNum(30001,6e3);d.state=StreamStatus.opened,d.track=e.audioStream.getAudioTracks()[0],null==p.roomHandle.selfUser.stream?p.roomHandle.selfUser.stream=e.audioStream:p.roomHandle.selfUser.stream.addTrack(d.track);var i=p.roomHandle.setDeviceIdByUUID(2,d.id),a=p.getNewStreamByTrack(d.track);p.roomHandle.masterServer.audioPublishHandle(i,a,o),p.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==o&&(u&&((d.element=u).srcObject=a),d.status=StreamStatus.published,p.roomHandle.hasObject(p.roomHandle.pubAudios,d)||p.roomHandle.pubAudios.push(d),p.eventEmitter.emit(UserCallback.microphone_status_notify,d.status,d.id,d.name,p.id))}),p.roomHandle.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==o&&c.reject(e)})},function(e){var t=new f(ErrorConstant.failed_access_localMedia);c.reject(t)}),c.promise},e.prototype.remotecmdPublishCamera=function(e){log.info("===user.remotecmdPublishCamera(),userId:"+e.ownerId+",设备Id:"+e.id),avdEngineHandle.loggerReport.info("命令远端用户发布某一摄像头视频,userId:"+e.ownerId+",设备Id:"+e.id);var t=this.roomHandle.getNodeId(e.ownerId);this.roomHandle.masterServer.videoIndiction(!0,e.id,t)},e.prototype.remotecmdUnpublishCamera=function(e,t){log.info("===user.remotecmdUnpublishCamera(),userId:"+e+",cameraId:"+t),avdEngineHandle.loggerReport.info("命令远端用户取消发布摄像头视频, userId:"+e+",cameraId:"+t);var r=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.videoIndiction(!1,t,r)},e.prototype.remotecmdOpenMicrophone=function(e){log.info("===user.remotecmdOpenMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户打开麦克风, userId:"+e);var t=this.roomHandle.getUser(e),r=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("pub",t.audio.id,r)},e.prototype.remotecmdCloseMicrophone=function(e){log.info("===user.remotecmdCloseMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户关闭麦克风, userId:"+e);var t=this.roomHandle.getUser(e),r=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("unpub",t.audio.id,r)},e.prototype.remotecmdMuteMicrophone=function(e){log.info("===user.remotecmdMuteMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户麦克风静音, userId:"+e);var t=this.roomHandle.getUser(e),r=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("mute",t.audio.id,r)},e.prototype.remotecmdUnmuteMicrophone=function(e){log.info("===user.remotecmdUnmuteMicrophone(),userId:"+e),avdEngineHandle.loggerReport.info("命令远端用户麦克风取消静音, userId:"+e);var t=this.roomHandle.getUser(e),r=this.roomHandle.getNodeId(e);this.roomHandle.masterServer.audioIndiction("unmute",t.audio.id,r)},e.prototype.updateUserName=function(t){log.info("===user.updateUserName(),userName:"+t),avdEngineHandle.loggerReport.info("===user.updateUserName(), userName:"+t),this.roomHandle.participants.forEach(function(e){e.id==this.id&&(e.name=t)}),this.roomHandle.masterServer.updateUserName(this.nodeId,t)},e.prototype.updateUserData=function(e){this.data=e,this.roomHandle.masterServer.updateUserDataMsg(e)},e.prototype.getUserData=function(e){if(void 0===e||null==e||""==e)return this.data;var t=this.roomHandle.getUser(e);return t?t.data:void 0},e.prototype.attachVideoElementMediaStream=function(e,t){if(t){var r=t.getTracks()[0],n=this.subVideoTrack2ResourceInfo[r.id],o=this.getUserByVideoTrackId(r.id);if(o){var i=o.getVideo(n.resource_id);i&&(i.element=e)}}e&&(log.debug("===attachVideoElementMediaStream(),userId:"+this.id+",userName:"+this.name+",elementId:"+e.id),e.srcObject=t)},e.prototype.attachScreenElementMediaStream=function(e,t){if(t){var r=t.getTracks()[0],n=this.subScreenTrack2ResourceInfo[r.id],o=this.getUserByScreenTrackId(r.id);if(o){var i=o.getScreen(n.resource_id);i&&(i.element=e)}}e&&(e.srcObject=t)},e.prototype.attachScreenAudioElementMediaStream=function(e,t){e&&(e.srcObject=t)},e.prototype.attachAudioElementMediaStream=function(e,t){if(t){var r=t.getTracks()[0],n=this.subAudioTrack2ResourceInfo[r.id],o=this.getUserByAudioTrackId(r.id);if(o){var i=o.getAudio(n.resource_id);i&&(i.element=e)}}e&&(e.srcObject=t)},e.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},e.prototype.getUserByVideoTrackId=function(e){var t=this.subVideoTrack2ResourceInfo[e];if(t){var r=t.owner_id;return this.roomHandle.getUserByNodeId(r)}return null},e.prototype.getUserByAudioTrackId=function(e){var t=this.subAudioTrack2ResourceInfo[e];if(t){var r=t.owner_id;return this.roomHandle.getUserByNodeId(r)}return null},e.prototype.getUserByScreenTrackId=function(e){var t=this.subScreenTrack2ResourceInfo[e];if(t){var r=t.owner_id;return this.roomHandle.getUserByNodeId(r)}return null},e.prototype.getNewStreamByTrack=function(e){var t=null;e&&this.stream&&0<this.stream.getTracks().length&&((t=this.stream.clone()).getTracks().forEach(function(e){t.removeTrack(e)}),t.addTrack(e));return t},e.prototype.bindAudioToVideo=function(e,t){var r=when.defer();return this.roomHandle.masterServer.bindAudioToVideo(109,e,t),this.roomHandle.addCallback(EngineCallback.bind_audio2video_rep_success,function(e){109==e&&r.resolve()}),this.roomHandle.addCallback(EngineCallback.bind_audio2video_rep_error,function(e){109==e&&r.reject()}),r.promise},e.prototype.createBoard=function(e,t,r,n,o,i,a,s,d){var l=when.defer(),u=this,c=new h(this.roomHandle,this.id,e,t,r,n,o,i,a,s,d);if(function(e){var t=!1;if(e){var r=versionStringCompare(e,"3.1.7");0<=r&&(t=!0)}t||log.info("===user 当前服务器版本不支持白板功能授权校验，客户端也将不启用校验。");return t}(avdEngineHandle.restServerInfo.boxVersion)){this.roomHandle.boardId2userId[c.id]=this.id,this.roomHandle.masterServer.addBoardMsg(OperType.add,c);var p=setTimeout(function(){var e=new f(1e4,"user.createBoard(), addBoardMsg send time out");delete u.roomHandle.boardId2userId[c.id],l.reject(e)},5e3);return this.addCallback(EngineCallback.updateboardmsg_rep_success,function(e){c.id==e&&(clearTimeout(p),u.boards.push(c),u.shareBoardById(c.id),l.resolve(c))}),this.addCallback(EngineCallback.updateboardmsg_rep_error,function(e,t){c.id==t&&(clearTimeout(p),delete u.roomHandle.boardId2userId[c.id],l.reject(e))}),l.promise}return this.boards.push(c),this.roomHandle.boardId2userId[c.id]=this.id,this.roomHandle.masterServer.addBoardMsg(OperType.add,c),this.shareBoardById(c.id),l.resolve(c),l.promise},e.prototype.updateBoard=function(e){this.roomHandle.masterServer.addBoardMsg(OperType.update,e)},e.prototype.getBoard=function(e){for(var t,r=0;r<this.boards.length;r++){var n=this.boards[r];if(n.id==e){t=n;break}}return t},e.prototype.getAllBoards=function(){return this.roomHandle.boards},e.prototype.removeBoardById=function(e){arrayUtil.objectSplice(this.boards,e),delete this.roomHandle.boardId2userId[e],delete this.roomHandle.annotation2boardId[e],this.roomHandle.masterServer.removeBoardMsg(OperType.remove,e)},e.prototype.closeBoardById=function(e){var t=this.getBoard(e);if(t.status!=boardStatusEnum.close){if(t.status=boardStatusEnum.close,t.annotation=null,this.roomHandle.annotation2boardId[e])for(var r in this.roomHandle.annotation2boardId[e].queueArr=[],this.roomHandle.annotation2boardId[e].storageArr)this.roomHandle.annotation2boardId[e].queueArr.push(this.roomHandle.annotation2boardId[e].storageArr[r]);this.roomHandle.masterServer.closeBoardMsg(OperType.close,e)}},e.prototype.shareBoardById=function(l,u){var c=this,p=this.getBoard(l);if(u||p.status!=boardStatusEnum.open){p.status=boardStatusEnum.open,u&&this.roomHandle.masterServer.addBoardMsg(OperType.add,p);var h=this.roomHandle.annotation2boardId[l];h&&setTimeout(function(){if(u&&0<p.annotation.shapeArray.length){for(var e in p.annotation.shapeArray){var t=p.annotation.shapeArray[e];t.color||(t.color="rgba(0,0,0,0)"),c.roomHandle.sendAddAnnotation(l,t.shape,t.shapeType,t.color,t.lineWidth,t.arrowtype,t.fillType)}var r=p.annotation.otherShapeMap;for(var n in r){var o=r[n];for(var e in o){var i=c.roomHandle.annotation2boardId[p.id].storageArr;for(var a in i)if(i[a].annotationId==o[e].id){var s={boardId:p.id,shapeObj:o[e].shape,shapeType:i[a].ann2pt.objectBase.type,lineColor:"",lineWidth:i[a].ann2pt.objectBase.lineWidth,arrowType:i[a].ann2pt.objectBase.arrow,fillType:1},d=i[a].ann2pt.objectBase.lineColor;s.lineColor="rgba("+d.r+","+d.g+","+d.b+","+d.a,0==c.roomHandle.annotation2boardId[p.id].storageArr[a].ann2pt.objectBase.fillColor.a?s.fillType=1:s.fillType=2,s.lineColor||(s.lineColor="rgba(0,0,0,0)"),c.roomHandle.sendAddAnnotation(p.id,s.shapeObj,s.shapeType,s.lineColor,s.lineWidth,s.arrowType,s.fillType)}}}}else c.roomHandle.updateAnnotationDrow(h.queueArr)},50),this.roomHandle.masterServer.shareBoardMsg(OperType.share,l,p)}},e.prototype.removeBoard=function(){this.boards.forEach(function(e){delete this.roomHandle.boardId2userId[e.id],delete this.roomHandle.annotation2boardId[e.id]}),arrayUtil.objectSplice(this.boards,this.id)},e.prototype.openMobileFrontVideo=function(t){log.info("===video openMobileFrontVideo...");var r=when.defer(),n=this,o=n.videos[0],e={audio:!1,video:{facingMode:{exact:"user"}}};return o.setType==ResolutionSetType.ideal?(e.video.width={ideal:o.resolution.width},e.video.height={ideal:o.resolution.height}):(e.video.width={exact:o.resolution.width},e.video.height={exact:o.resolution.height}),e.video.frameRate={ideal:o.frameRate},log.info("===video openMobileFrontVideo(),constraints:"+JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(e){log.debug("===video openMobileFrontVideo(),stream:",e),currentVideoParameter.videoWidth=o.resolution.width,currentVideoParameter.videoHeight=o.resolution.height,currentVideoParameter.frameRate=o.frameRate,o.track=e.getVideoTracks()[0],null==n.roomHandle.selfUser.stream?n.roomHandle.selfUser.stream=e:n.roomHandle.selfUser.stream.addTrack(o.track),o.isPubState=!0,o.publishHandle(t).then(function(){log.info("===video openMobileFrontVideo(),预览前置摄像头及发布流成功,videoId:"+o.id+",videoName："+o.name+",userId:"+o.ownerId),r.resolve()}).otherwise(function(e){o.isPubState=!1,log.error("===video openMobileFrontVideo(),预览前置摄像头及发布视频流失败,videoId:"+o.id+",videoName："+o.name+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),r.reject(e)})}).catch(function(e){log.error("===video openMobileFrontVideo() failed,error: ",e),o.isPubState=!1,r.reject(e)}),r.promise},e.prototype.closeMobileFrontVideo=function(){log.info("===video closeMobileFrontVideo...");var t=when.defer(),e=this.videos[0];return e.unpreview(),e.unpublish().then(function(){log.info("===video closeMobileFrontVideo success"),t.resolve()}).otherwise(function(e){log.info("===video closeMobileFrontVideo error"),t.reject(e)}),t.promise},e.prototype.closeMobileBackVideo=function(){log.info("===video closeMobileBackVideo...");var t=when.defer(),e=this.videos[1];return e.unpreview(),e.unpublish().then(function(){log.info("===video closeMobileBackVideo success"),t.resolve()}).otherwise(function(e){log.info("===video closeMobileBackVideo error"),t.reject(e)}),t.promise},e.prototype.openMobileBackVideo=function(t){log.info("===video openMobileBackVideo...");var e,r,n=when.defer(),o=this,i=!1,a=0;if("Android"==avdEngineHandle.detect.osName){for(var s in avdEngineHandle.cameraMap){a++,e=s,r=avdEngineHandle.cameraMap[s]}2<a&&(i=!0,log.debug("===video openMobileBackVideo(), detect.osName:Android, cameraLen:"+a+", customiseCameraId:"+e+", customiseCameraName:"+r))}var d=o.videos[1],l={audio:!1,video:{facingMode:{exact:"environment"}}};return i&&(l={audio:!1,video:{deviceId:{exact:e}}}),d.setType==ResolutionSetType.ideal?(l.video.width={ideal:d.resolution.width},l.video.height={ideal:d.resolution.height}):(l.video.width={exact:d.resolution.width},l.video.height={exact:d.resolution.height}),l.video.frameRate={ideal:d.frameRate},log.info("===video openMobileBackVideo(),constraints:"+JSON.stringify(l)),navigator.mediaDevices.getUserMedia(l).then(function(e){log.debug("===video openMobileBackVideo(),stream:",e),currentVideoParameter.videoWidth=d.resolution.width,currentVideoParameter.videoHeight=d.resolution.height,currentVideoParameter.frameRate=d.frameRate,d.track=e.getVideoTracks()[0],null==o.roomHandle.selfUser.stream?o.roomHandle.selfUser.stream=e:o.roomHandle.selfUser.stream.addTrack(d.track),d.isPubState=!0,d.publishHandle(t).then(function(){log.info("===video openMobileBackVideo(),预览后置摄像头及发布流成功,videoId:"+d.id+",videoName："+d.name+",userId:"+d.ownerId),n.resolve()}).otherwise(function(e){d.isPubState=!1,log.error("===video openMobileBackVideo(),预览后置摄像头及发布视频流失败,videoId:"+d.id+",videoName："+d.name+",userId:"+d.ownerId+",error:"+JSON.stringify(e)),n.reject(e)})}).catch(function(e){log.error("===video openMobileBackVideo() failed,error: ",e),d.isPubState=!1,n.reject(e)}),n.promise},e}),ModuleBase.define("Record",["RecordRestServer","Error"],function(t,o){var e=function(e){this.restServerURI=e,this.recordRestServer=new t,this.recordInfo={name:"",tag:"",roomId:"",userId:"",audioType:RecordEnum.AudioType.singleuser,videoType:RecordEnum.VideoType.mainflow,fileType:RecordEnum.FileType.mp4}};return e.prototype.createUserRecord=function(e,t){var r=when.defer();if(!t){n=new o(ErrorConstant.params_require);return r.reject(n),r.promise}if(""==t.roomId){var n=new o(ErrorConstant.roomId_required);return r.reject(n),r.promise}if(""!=t.userId)return this.recordRestServer.createUserRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var n=new o(ErrorConstant.userId_required);return r.reject(n),r.promise},e.prototype.stopRecord=function(e,t){var r=when.defer();return this.recordRestServer.stopRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.getRecord=function(e,t){var r=when.defer();return this.recordRestServer.getRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.deleteRecord=function(e,t){var r=when.defer();return this.recordRestServer.deleteRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.findRecords=function(e,t,r,n){var o=when.defer();return this.recordRestServer.findRecords(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},e}),ModuleBase.define("RecordRestServer",["Error"],function(l){var e=function(){};return e.prototype.createUserRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/record/createUserRecord?accessToken="+t,a={params:r};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.stopRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/record/stop",a={params:{id:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.getRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/record/getRecord",a={params:{id:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.deleteRecord=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/record/delete",a={params:{id:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.findRecords=function(e,t,r,n,o){var i=when.defer(),a=document.location.protocol;"httpsionic:"==a&&(a="https:");var s=a+"//"+e+"/avd/api/record/findRecords",d={params:{begin:r,count:n,filter:o,accessToken:t}};return this.fetchGet(s,d).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new l(e.result,e.err);i.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,n){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);n(t)}else{t=new l(1e4,e.message);n(t)}n(e)})})},e.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);n(t)}else{t=new l(1e4,e.message);n(t)}n(e)})})},e}),ModuleBase.define("Live",["LiveRestServer","Error"],function(t,o){var e=function(e){this.restServerURI=e,this.liveRestServer=new t,this.liveInfo={name:"",tag:"",roomId:"",userId:"",audioType:LiveEnum.AudioType.singleuser,videoType:LiveEnum.VideoType.mainflow,publishurl:"",rtmpurl:"",hlsurl:""}};return e.prototype.createUserLive=function(e,t){var r=when.defer();if(!t){n=new o(ErrorConstant.params_require);return r.reject(n),r.promise}if(""==t.roomId){var n=new o(ErrorConstant.roomId_required);return r.reject(n),r.promise}if(""!=t.userId)return this.liveRestServer.createUserLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var n=new o(ErrorConstant.userId_required);return r.reject(n),r.promise},e.prototype.stopLive=function(e,t){var r=when.defer();return this.liveRestServer.stopLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.getLive=function(e,t){var r=when.defer();return this.liveRestServer.getLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.deleteLive=function(e,t){var r=when.defer();return this.liveRestServer.deleteLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.findLives=function(e,t,r,n){var o=when.defer();return this.liveRestServer.findLives(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},e}),ModuleBase.define("LiveRestServer",["Error"],function(l){var e=function(){};return e.prototype.createUserLive=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/live/createUserLive?accessToken="+t,a={params:r};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.stopLive=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/live/stop",a={params:{accessToken:t,id:r}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.getLive=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/live/getLive",a={params:{accessToken:t,id:r}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.deleteLive=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/live/delete",a={params:{accessToken:t,id:r}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new l(e.result,e.err);n.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.findLives=function(e,t,r,n,o){var i=when.defer(),a=document.location.protocol;"httpsionic:"==a&&(a="https:");var s=a+"//"+e+"/avd/api/live/findLives",d={params:{begin:r,count:n,filter:o,accessToken:t}};return this.fetchGet(s,d).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new l(e.result,e.err);i.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,n){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);n(t)}else{t=new l(1e4,e.message);n(t)}n(e)})})},e.prototype.fetchPost=function(e,t){return new Promise(function(r,n){axios.post(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);n(t)}else{t=new l(1e4,e.message);n(t)}n(e)})})},e}),ModuleBase.define("Board",["Annotation","RestServer","Error"],function(r,s,d){var e=function(e,t,r,n,o,i,a,s,d,l,u){this.roomHandle=e,this.id=Math.uuid(),this.status=boardStatusEnum.close,this.title=a||"",this.description=l||"",this.extendData=u||"",this.userId=t,this.width=r,this.height=n,this.backgroundColor=o,this.backgroundImage=i,this.annotation,this.outputWidth=r,s&&(this.outputWidth=s),this.outputHeight=n,d&&(this.outputHeight=d),this.inputWidth=r,this.inputHeight=n,this.roomHandle.boardOutputXRatio=this.outputWidth/this.width,this.roomHandle.boardOutputYRatio=this.outputHeight/this.height,this.roomHandle.boardInputXRatio=this.width/this.outputWidth,this.roomHandle.boardInputYRatio=this.height/this.outputHeight};return e.prototype.setRenderWidthAndHeight=function(e,t){log.debug("===Board.setRenderWidthAndHeight, width: ",e,",height: ",t),this.width=e,this.height=t,this.roomHandle.boardInputXRatio=this.width/this.inputWidth,this.roomHandle.boardInputYRatio=this.height/this.inputHeight,this.roomHandle.boardOutputXRatio=this.inputWidth/this.width,this.roomHandle.boardOutputYRatio=this.inputHeight/this.height},e.prototype.setBoardId=function(e){this.id=e},e.prototype.uploadImg2Server=function(e,t){var r=when.defer(),n=t.files[0];if(!n){var o=new d(ErrorConstant.upload_filer_required);r.reject(o)}var i=n.size,a=n.type;if(log.info("===Board.uploadImg2Server(),fileSize:"+i+", fileType"+a),["image/jpeg","image/png"].includes(a))if(15728640<i){t.value="",(o=new d(ErrorConstant.upload_filer_fileSize)).message=o.message+",Within 15M only",r.reject(o)}else{(new s).uploadFile(e,n).then(function(e){t.value="",log.info("===Board.uploadImg2Server(),fileUrl:"+e),r.resolve(e)}).otherwise(function(e){console.info("===Board.uploadImg2Server(),error:",e),r.reject(e)})}else t.value="",(o=new d(ErrorConstant.upload_filer_fileType)).message=o.message+",Support jpeg/jpg/png only ",r.reject(o);return r.promise},e.prototype.updateBackgroundImage=function(e){var t=this;t.backgroundImage=e,t.annotation.updateBackgroundImage(e).then(function(){log.debug("===Board.updateBackgroundImage, backgroundImage: ",e),t.userId==t.roomHandle.selfUser.id&&t.roomHandle.selfUser.updateBoard(t)}).otherwise(function(e){log.debug("===Board.updateBackgroundImage, backgroundImage error:",e)})},e.prototype.updateBackgroundColor=function(e){this.backgroundImage="",this.backgroundColor=e,this.annotation.updateBackgroundColor(e),this.userId==this.roomHandle.selfUser.id&&this.roomHandle.selfUser.updateBoard(this)},e.prototype.updateWidthAndHeight=function(e,t){this.width=e,this.height=t},e.prototype.createAnnotation=function(){var e=when.defer();if(this.annotation)e.reject();else{var t=new r(this.id,this.roomHandle,this);this.annotation=t,e.resolve(this.annotation)}return e.promise},e.prototype.updateAnnotation=function(){},e.prototype.removeAnnotation=function(){this.annotation=null},e.prototype.getAnnotation=function(){return this.annotation},e}),ModuleBase.define("Annotation",["RestServer","Error","TextInfo"],function(d,l,t){var e=function(e,t,r){this.roomHandle=t,this.boardId=e,this.shapeType=shapeTypeEnum.mouse,this.color="rgba(0,0,0,1)",this.backgroundColor="",this.lineWidth=2,this.arrowLength=10,this.arrowtype=arrowTypeEnum.end,this.fillType=fillTypeEnum.none,this.fillColor="none",this.initType=AnnotationInitTypeEnum.full,this.shapeArray=[],this.redoArray=[],this.undoArray=[],this.zr=null,this.annoDiv=null,this.renderDiv=null,this.renderBackground=null,this.currentIndex=-1,this.drawOrEraser=annoSelectTypeEnum.draw,this.isEraser=!1,this.eraserShape=null,this.eraserImageWidth=32,this.eraserImageHeight=32,this.otherShapeMap={},this.screenSize={width:0,height:0},this.hlightPointInfo={imgUrl:"",width:"",height:"",intervalTime:200,isSend:!0},this.hlightPointShape=null,this.textTagShape=null,this.arrowLineStartPoint={x:0,y:0},this.currentX=0,this.currentY=0,this.x=0,this.y=0,this.shapeData=[],this.rhombData=[],this.shapeObj={},this.shape=null,this.imgZlevel=-99999,this.normalZlevel=1e4,this.tempHighZlevel=99999,this.currActiveImg=null,this.isAllowEditImg=!1,this.dragData={drag:!1,pos:[0,0]},this.shapeGroup=new zrender.Group({slient:!1}),this.textInfo=null,this.positionInfo={scaleWidth:0,scaleHeight:0,zrWidth:0,zrHeight:0,scaleRatioX:1,scaleRatioY:1,scaleRatioXR:1,scaleRatioYR:1,originalWidth:0,originalHeight:0},this.imgScaleoffset={x:0,y:0},this.board=r,this.backgroundColor=r.backgroundColor},Z=zrender.Path.extend({type:"Successright",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/3*2,o=t.x+t.width/2,i=t.y+t.height,a=t.x+t.width,s=t.y;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(a,s)}}),$=zrender.Path.extend({type:"Failure",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y,o=t.width,i=t.height,a=r-o/2,s=r+o/2,d=n-i/2,l=n+i/2;e.moveTo(a,d),e.lineTo(s,l),e.closePath(),e.moveTo(s,d),e.lineTo(a,l),e.closePath()}}),ee=zrender.Path.extend({type:"Arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/3,o=t.x,i=t.y+t.height/3*2,a=t.x+t.width/3*2,s=t.y+t.height/3*2,d=t.x+t.width/3*2,l=t.y+t.height,u=t.x+t.width,c=t.y+t.height/2,p=t.x+t.width/3*2,h=t.y,f=t.x+t.width/3*2,m=t.y+t.height/3;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(a,s),e.lineTo(d,l),e.lineTo(u,c),e.lineTo(p,h),e.lineTo(f,m),e.closePath()}}),te=zrender.Path.extend({type:"Texttag",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,n=t.y+t.height/4,o=t.x,i=t.y+t.height/4*3,a=t.x+t.width/5*4,s=t.y+t.height/4*3,d=t.x+t.width/5*4,l=t.y+t.height,u=t.x+t.width,c=t.y+t.height/2,p=t.x+t.width/5*4,h=t.y,f=t.x+t.width/5*4,m=t.y+t.height/4;e.moveTo(r,n),e.lineTo(o,i),e.lineTo(a,s),e.lineTo(d,l),e.lineTo(u,c),e.lineTo(p,h),e.lineTo(f,m),e.closePath()}});function s(e,t,r,n){var o=0,i=0,a=r/n,s=e/t;return 1<a&&1<s?s<a?i=(o=e)<r?n/(r/e):n*(e/r):a<s?o=(i=t)<n?r/(n/t):r*(t/n):(o=e,i=t):1<a&&s<=1?i=(o=e)<r?n/(r/e):n*(e/r):a<1&&1<s?o=(i=t)<n?r/(n/t):r*(t/n):a<1&&s<=1?a<s?o=(i=t)<n?r/(n/t):r*(t/n):i=(o=e)<r?n/(r/e):n*(e/r):1==a&&(1<s?o=(i=t)<n?r/(n/t):r*(t/n):i=(o=e)<r?n/(r/e):n*(e/r)),log.debug("===annotation getCompatibleSize, outWidht: "+e+",outHeight: "+t+",contentWidth: "+r+",contentHeight: "+n+",renderWidth: "+o+",renderHeight: "+i),[o,i]}function re(e){return"rgba("+e.r+","+e.g+","+e.b+","+parseFloat(e.a/255)+")"}return e.prototype.initAndGetRenderCanvasByBoardAndWrapBox=function(){var e,t,r=document.createElement("canvas"),n=s(this.annoDiv.clientWidth,this.annoDiv.clientHeight,this.board.width,this.board.height);return e=n[0],t=n[1],r.width=e,r.height=t,r.style.width=e+"px",r.style.height=t+"px",r.style.background="rgba(0,0,0,0)",this.board.setRenderWidthAndHeight(e,t),log.debug("===annotation initAndGetRenderCanvasByBoardAndWrapBox, result: bw: "+this.board.width+",bh: "+this.board.height+",ww: "+this.annoDiv.clientWidth+",wh: "+this.annoDiv.clientHeight+",rw: "+e+",rh: "+t),r},e.prototype.updateBackgroundColor=function(e){if(this.renderBackground&&!(!this.renderBackground instanceof HTMLCanvasElement)){var t=this.renderBackground.getContext("2d");e?(t.fillStyle="rgba("+e+")",t.fillRect(0,0,this.renderBackground.width,this.renderBackground.height),this.backgroundColor=e):t.clearRect(0,0,this.renderBackground.width,this.renderBackground.height)}},e.prototype.updateBackgroundImage=function(e){var n=when.defer();log.debug("===annotation updateBackgroundImage, imageUrl:"+e);var o=this;e||n.reject("===annotation updateBackgroundImage error, reason: imageUrl is invalid!"),this.renderBackground||n.reject("===annotation updateBackgroundImage error, reason: board background is not exist!"),!this.renderBackground instanceof HTMLCanvasElement&&n.reject("===annotation updateBackgroundImage error, reason: board background element is not canvas");try{this.updateBackgroundColor(this.backgroundColor);var i=this.renderBackground.getContext("2d"),a=document.createElement("img");a.src=e,a.onload=function(){var e=s(o.renderBackground.width,o.renderBackground.height,a.width,a.height),t=o.renderBackground.width/2-e[0]/2,r=o.renderBackground.height/2-e[1]/2;log.debug("===annotation updateBackgroundImage, startX:"+t+",startY:"+r+",compatibleSize:"+e),i.drawImage(a,t,r,e[0],e[1]),n.resolve()}}catch(e){log.debug("===annotation updateBackgroundImage, err:"+e),n.reject(e)}return n.promise},e.prototype.init=function(e,t){var r=when.defer(),A=this;if(!(e instanceof HTMLDivElement||e instanceof HTMLCanvasElement))return log.error("===annotation init faild, must be given a div or canvas element!"),r.reject("Must be given a div or canvas element!"),r.promise;if(A.annoDiv=e,t&&t==AnnotationInitTypeEnum.proportional){if(A.initType=t,!(e instanceof HTMLDivElement))return log.error("===annotation init faild, proportional type must be given a div element!"),r.reject("Proportional type must be given a div element!"),r.promise;e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",this.renderDiv=A.initAndGetRenderCanvasByBoardAndWrapBox(),this.renderBackground=A.initAndGetRenderCanvasByBoardAndWrapBox(),this.renderDiv.style.position="relative",this.renderDiv.style.zIndex=1001,e.appendChild(this.renderDiv),this.renderBackground.style.position="absolute",this.renderBackground.style.zIndex=1e3,this.renderBackground.className="annotation-canvas-background",e.appendChild(this.renderBackground)}else this.renderDiv=e;if(A.zr=zrender.init(this.renderDiv),A.zr.add(A.shapeGroup),A.positionInfo.originalWidth=A.zr.getWidth(),A.positionInfo.originalHeight=A.zr.getHeight(),"100%"==A.annoDiv.style.width){var n=A.annoDiv.firstChild;A.screenSize.width=parseInt(n.style.width),A.screenSize.height=parseInt(n.style.height),log.debug("===Annotation.init(),childDiv.style.width:"+n.style.width+",childDiv.style.height:"+n.style.height)}else A.screenSize.width=parseInt(A.annoDiv.style.width),A.screenSize.height=parseInt(A.annoDiv.style.height),log.debug("===Annotation.init(),annoDiv.style.width:"+e.style.width+",annoDiv.style.height:"+e.style.height);function s(t){A.shapeType==shapeTypeEnum.eraser&&A.isEraser&&A.shapeArray.forEach(function(e){e.shape.id==t.target.id&&(A.zr.remove(e.shape),A.shapeGroup.remove(e.shape),A.roomHandle.sendRemoveAnnotation(A.boardId,A.shapeType,e.shape.id),A.undoArray.push({type:"delete",shapeObj:e}),A.shapeArray.splice(k,1))})}return this.updateBackgroundColor(this.backgroundColor),A.zr.on("mousedown",function(e){if(A.isAllowEditImg){if(A.dragData.pos=[e.event.zrX,e.event.zrY],e.target&&e.target.type&&"image"==e.target.type&&null!=e.target.draggable)if(A.currActiveImg=e.target,A.currActiveImg.attr("zlevel",A.tempHighZlevel),A.currActiveImg.parent.eachChild(function(e){"image"===e.type&&(e.id==A.currActiveImg.id?e.attr("style",{shadowColor:"red",shadowBlur:5}):e.attr("style",{shadowColor:void 0,shadowBlur:void 0}))}),1==A.currActiveImg.scale[0])A.imgScaleoffset.x=0,A.imgScaleoffset.y=0;else{var t=A.currActiveImg.scale[0]-1;A.imgScaleoffset.x=A.currActiveImg.getWidth()*t/2,A.imgScaleoffset.y=A.currActiveImg.getHeight()*t/2}void 0===e.target?A.dragData.drag=!1:A.dragData.drag=!0}}),A.zr.on("mouseup",function(e){A.isAllowEditImg&&A.currActiveImg&&(A.dragData.drag=!1,A.currActiveImg.customPositionX=A.currActiveImg.position[0]-A.imgScaleoffset.x,A.currActiveImg.customPositionY=A.currActiveImg.position[1]-A.imgScaleoffset.y,log.debug("===Annotation.drawImg, currActiveImg customPosition: ",[A.currActiveImg.customPositionX,A.currActiveImg.customPositionY].toString()),A.currActiveImg.attr("zlevel",++A.imgZlevel),A.roomHandle.sendUpdateAnnotation(A.boardId,A.currActiveImg,shapeTypeEnum.img))}),A.zr.on("mouseout",function(e){A.isAllowEditImg&&(A.dragData.drag=!1)}),A.zr.on("mousemove",function(e){var t=[e.event.zrX,e.event.zrY];if(!1!==A.dragData.drag){if(null!=A.currActiveImg&&!0===A.isAllowEditImg){var r=[t[0]-A.dragData.pos[0],t[1]-A.dragData.pos[1]];A.currActiveImg.position[0]+=r[0]*A.positionInfo.scaleRatioXR,A.currActiveImg.position[1]+=r[1]*A.positionInfo.scaleRatioYR,A.currActiveImg.dirty()}A.dragData.pos=t}else A.currActiveImg&&(A.currActiveImg.draggable=!1)}),A.renderDiv.onmousedown=function(e){if(!A.isAllowEditImg&&A.shapeType!=shapeTypeEnum.mouse&&A.shapeType!=shapeTypeEnum.hlight_point){A.shapeType==shapeTypeEnum.eraser&&(A.isEraser=!0);var n,o,t=A.handleScaledXY(e.clientX-this.getBoundingClientRect().left,e.clientY-this.getBoundingClientRect().top);A.currentX=t.x,A.currentY=t.y,shapeData=[],shapeData.push([A.currentX,A.currentY]);var i=null;switch(A.shapeType){case shapeTypeEnum.failure:i=new $({shape:{x:A.currentX,y:A.currentY,width:20,height:20},style:{stroke:A.color,lineWidth:A.lineWidth},zlevel:A.normalZlevel,onmouseover:s});break;case shapeTypeEnum.success:i=new Z({shape:{x:A.currentX-10,y:A.currentY-10,width:20,height:20},style:{stroke:A.color,fill:"none",lineWidth:A.lineWidth},onmouseover:s});break;case shapeTypeEnum.arrow:i=new ee({shape:{x:A.currentX-15,y:A.currentY-10,width:30,height:20},style:{stroke:A.color,fill:A.fillColor,lineWidth:A.lineWidth},zlevel:A.normalZlevel,onmouseover:s});break;case shapeTypeEnum.hlight_texttag:var r=A.roomHandle.selfUser.name,a=r;7<r.split("").length&&(a=r.substr(0,7)+"..."),A.textTagShape?A.textTagShape.attr({shape:{x:A.currentX-40,y:A.currentY-20},style:{text:a},zlevel:A.normalZlevel,textContent:new zrender.Text({x:A.currentX-40+5,y:A.currentY-20+13,style:{text:a,fill:"#ffffff",textRect:{x:A.currentX-40+5,y:A.currentY-20+13,width:50},truncate:{outerWidth:50}},zlevel:A.normalZlevel})}):(A.textTagShape=new te({shape:{x:A.currentX-40,y:A.currentY-20,width:80,height:40},style:{stroke:"red",fill:"red",text:a,truncate:{outerWidth:50},lineWidth:A.lineWidth},zlevel:A.normalZlevel,textContent:new zrender.Text({x:A.currentX-40+5,y:A.currentY-20+13,style:{text:a,fill:"#ffffff",textRect:{x:A.currentX-40+5,y:A.currentY-20+13,width:50},truncate:{outerWidth:50}},zlevel:A.normalZlevel}),onmouseover:s}),A.textTagShape.id=Math.uuid(),A.shapeGroup.add(A.textTagShape)),A.roomHandle.sendAddAnnotation(A.boardId,A.textTagShape,A.shapeType,A.color,A.lineWidth,A.arrowtype,A.fillType);break;case shapeTypeEnum.rhomb:i=new zrender.Polygon({shape:{points:[],smooth:0},style:{stroke:A.color,fill:"none",lineWidth:A.lineWidth},zlevel:A.normalZlevel,onmouseover:s});break;case shapeTypeEnum.line:i=new zrender.Arrowline({shape:{x1:A.currentX,y1:A.currentY,x2:A.currentX,y2:A.currentY,arrowlength:10,arrowtype:A.arrowtype},style:{stroke:A.color,lineWidth:A.lineWidth},zlevel:A.normalZlevel,onmouseover:s});break;case shapeTypeEnum.polyline:i=new zrender.Polyline({shape:{points:[],smooth:0},style:{stroke:A.color,lineWidth:A.lineWidth},zlevel:A.normalZlevel,onmouseover:s});break;case shapeTypeEnum.rect:i=new zrender.Rect({shape:{x:A.currentX,y:A.currentY},style:{stroke:A.color,fill:A.fillColor,lineWidth:A.lineWidth},zlevel:A.normalZlevel,onmouseover:s});break;case shapeTypeEnum.ellipse:i=new zrender.Ellipse({shape:{cx:A.currentX,cy:A.currentY,rx:0,ry:0},style:{stroke:A.color,fill:A.fillColor,lineWidth:A.lineWidth},zlevel:A.normalZlevel,onmouseover:s})}i&&(i.id=Math.uuid(),A.shapeGroup.add(i),A.renderDiv.onmousemove=function(e){if(!A.isAllowEditImg&&A.shapeType!=shapeTypeEnum.eraser){var t=A.handleScaledXY(e.clientX-this.getBoundingClientRect().left,e.clientY-this.getBoundingClientRect().top);n=t.x,o=t.y,shapeData.push([n,o]);var r=[[A.currentX,A.currentY+(o-A.currentY)/2],[A.currentX+(n-A.currentX)/2,o],[n,A.currentY+(o-A.currentY)/2],[A.currentX+(n-A.currentX)/2,A.currentY]];switch(A.shapeType){case shapeTypeEnum.rhomb:i.attr("shape",{points:r});break;case shapeTypeEnum.line:i.attr("shape",{x2:n,y2:o});break;case shapeTypeEnum.polyline:i.attr("shape",{points:shapeData});break;case shapeTypeEnum.rect:i.attr("shape",{width:n-A.currentX,height:o-A.currentY});break;case shapeTypeEnum.ellipse:i.attr("shape",{cx:n+(A.currentX-n)/2,cy:o+(A.currentY-o)/2,rx:Math.abs(n-A.currentX)/2,ry:Math.abs(o-A.currentY)/2})}}},A.renderDiv.onmouseup=function(){if(A.renderDiv.onmousemove=null,A.renderDiv.onmouseup=null,A.renderDiv.onmouseleave=null,!A.isAllowEditImg)if(A.shapeType!=shapeTypeEnum.eraser){var e={shape:i,shapeType:A.shapeType,color:A.color,lineWidth:A.lineWidth,arrowtype:A.arrowtype,fillType:A.fillType};A.shapeArray.push(e),A.undoArray.push({type:"add",shapeObj:e}),A.redoArray=[],A.roomHandle.sendAddAnnotation(A.boardId,i,A.shapeType,A.color,A.lineWidth,A.arrowtype,A.fillType)}else A.isEraser=!1},A.renderDiv.onmouseleave=function(){if(A.renderDiv.onmousemove=null,A.renderDiv.onmouseup=null,A.renderDiv.onmouseleave=null,!A.isAllowEditImg)if(A.shapeType!=shapeTypeEnum.eraser){parseInt(A.renderDiv.style.width),parseInt(A.renderDiv.style.height);A.shapeArray.push({shape:i,shapeType:A.shapeType,color:A.color,lineWidth:A.lineWidth,arrowtype:A.arrowtype,fillType:A.fillType}),A.redoArray=[],A.roomHandle.sendAddAnnotation(A.boardId,i,A.shapeType,A.color,A.lineWidth,A.arrowtype,A.fillType)}else A.isEraser=!1})}},A.renderDiv.ontouchstart=function(e){if(!A.isAllowEditImg&&(e.preventDefault(),A.shapeType!=shapeTypeEnum.mouse&&A.shapeType!=shapeTypeEnum.hlight_point&&(A.currentX=e.touches[0].clientX-this.getBoundingClientRect().left,A.currentY=e.touches[0].clientY-this.getBoundingClientRect().top,A.shapeType!=shapeTypeEnum.eraser))){switch(A.arrowLineStartPoint.x=e.touches[0].clientX-this.getBoundingClientRect().left,A.arrowLineStartPoint.y=e.touches[0].clientY-this.getBoundingClientRect().top,A.shapeData=[],A.shapeData.push([A.currentX,A.currentY]),A.shapeType){case shapeTypeEnum.failure:A.shape=new $({shape:{x:A.currentX,y:A.currentY,width:20,height:20},style:{stroke:A.color,lineWidth:A.lineWidth}});break;case shapeTypeEnum.success:A.shape=new Z({shape:{x:A.currentX-10,y:A.currentY-10,width:20,height:20},style:{stroke:A.color,fill:"none",lineWidth:A.lineWidth}});break;case shapeTypeEnum.arrow:A.shape=new ee({shape:{x:A.currentX-15,y:A.currentY-10,width:30,height:20},style:{stroke:A.color,fill:A.fillColor,lineWidth:A.lineWidth}});break;case shapeTypeEnum.hlight_texttag:A.textTagShape?A.textTagShape.attr({shape:{x:A.currentX-40,y:A.currentY-20},style:{text:A.roomHandle.selfUser.name}}):(A.textTagShape=new te({shape:{x:A.currentX-40,y:A.currentY-20,width:80,height:40},style:{stroke:"red",fill:"red",text:A.roomHandle.selfUser.name,truncate:{outerWidth:50},lineWidth:A.lineWidth}}),A.textTagShape.id=Math.uuid(),A.shapeGroup.add(A.textTagShape)),A.roomHandle.sendAddAnnotation(A.boardId,A.textTagShape,A.shapeType,A.color,A.lineWidth,A.arrowtype,A.fillType),A.shape&&(A.shape=null);break;case shapeTypeEnum.rhomb:A.shape=new zrender.Polygon({shape:{points:[],smooth:0},style:{stroke:A.color,fill:"none",lineWidth:A.lineWidth}});break;case shapeTypeEnum.line:A.shape=new zrender.Arrowline({shape:{arrowlength:10,arrowtype:A.arrowtype},style:{stroke:A.color,lineWidth:A.lineWidth}});break;case shapeTypeEnum.polyline:A.shape=new zrender.Polyline({shape:{points:[],smooth:0},style:{stroke:A.color,lineWidth:A.lineWidth}});break;case shapeTypeEnum.rect:A.shape=new zrender.Rect({shape:{x:A.currentX,y:A.currentY},style:{stroke:A.color,fill:A.fillColor,lineWidth:A.lineWidth}});break;case shapeTypeEnum.ellipse:A.shape=new zrender.Ellipse({shape:{cx:A.currentX,cy:A.currentY,rx:0,ry:0},style:{stroke:A.color,fill:A.fillColor,lineWidth:A.lineWidth}})}if(A.shape){if(A.shape.id=Math.uuid(),A.shapeType==shapeTypeEnum.success||A.shapeType==shapeTypeEnum.failure||A.shapeType==shapeTypeEnum.arrow){var t={shape:A.shape,shapeType:A.shapeType,color:A.color,lineWidth:A.lineWidth,arrowtype:A.arrowtype,fillType:A.fillType};A.shapeArray.push(t),A.undoArray.push({type:"add",shapeObj:t}),A.roomHandle.sendAddAnnotation(A.boardId,A.shape,A.shapeType,A.color,A.lineWidth,A.arrowtype,A.fillType)}A.shapeGroup.add(A.shape)}}},A.renderDiv.ontouchmove=function(e){if(!A.isAllowEditImg){if(A.x=e.touches[0].clientX-this.getBoundingClientRect().left,A.y=e.touches[0].clientY-this.getBoundingClientRect().top,A.shapeType==shapeTypeEnum.eraser){A.isEraser=!0;var t=A.x-A.eraserImageWidth/2,r=A.y-A.eraserImageHeight/2;return A.eraserShape&&A.eraserShape.attr("position",[t,r]),void A.shapeArray.forEach(function(n){switch(n.shapeType){case shapeTypeEnum.line:var e=n.shape.shape,t=e.x1,r=e.x2,o=e.y1,i=e.y2;t<r&&o<i?A.x>=t&&A.x<=r&&A.y>=o&&A.y<=i&&A.excuteRemoveAnnotation(n):r<t&&o<i?A.x>=r&&A.x<=t&&A.y>=o&&A.y<=i&&A.excuteRemoveAnnotation(n):t<r&&i<o?A.x>=t&&A.x<=r&&A.y>=i&&A.y<=o&&A.excuteRemoveAnnotation(n):r<t&&i<o&&A.x>=r&&A.x<=t&&A.y>=i&&A.y<=o&&A.excuteRemoveAnnotation(n);break;case shapeTypeEnum.polyline:var a=A.shapeArray[k].shape.shape.points,s=A.x-A.eraserImageWidth/2,d=A.x+A.eraserImageWidth/2,l=A.y-A.eraserImageWidth/2,u=A.y+A.eraserImageWidth/2;0<a.length&&a.forEach(function(e){var t=e[0],r=e[1];s<=t&&t<=d&&l<=r&&r<=u&&A.excuteRemoveAnnotation(n)});break;case shapeTypeEnum.success:var c=n.shape.shape.width,p=n.shape.shape.height,h=n.shape.shape.x,f=n.shape.shape.y;A.x>=h&&A.x<=h+c&&A.y>=f&&A.y<=f+p&&A.excuteRemoveAnnotation(n);break;case shapeTypeEnum.failure:c=n.shape.shape.width,p=n.shape.shape.height;var m=n.shape.shape.x,g=n.shape.shape.y;A.x>=m&&A.x<=m+c&&A.y>=g&&A.y<=g+p&&A.excuteRemoveAnnotation(n);break;case shapeTypeEnum.rhomb:var v=n.shape.shape.points[0],y=n.shape.shape.points[1],_=n.shape.shape.points[2],b=n.shape.shape.points[3];t=v[0],r=_[0],o=y[1],i=b[1];if(A.x>=t&&A.x<=r&&A.y>=o&&A.y<=i){A.excuteRemoveAnnotation(n);break}if(A.x<=t&&A.x>=r&&A.y>=o&&A.y<=i){A.excuteRemoveAnnotation(n);break}if(A.x>=t&&A.x<=r&&A.y<=o&&A.y>=i){A.excuteRemoveAnnotation(n);break}if(A.x<=t&&A.x>=r&&A.y<=o&&A.y>=i){A.excuteRemoveAnnotation(n);break}break;case shapeTypeEnum.arrow:c=n.shape.shape.width,p=n.shape.shape.height;var S=n.shape.shape.x,w=n.shape.shape.y;A.x>=S&&A.x<=S+c&&A.y>=w&&A.y<=w+p&&A.excuteRemoveAnnotation(n);break;case shapeTypeEnum.ellipse:var E=n.shape.shape.cx,I=n.shape.shape.cy,T=n.shape.shape.rx,C=n.shape.shape.ry;A.x>=E-T&&A.x<=E+T&&A.y>=I-C&&A.y<=I+C&&A.excuteRemoveAnnotation(n);break;case shapeTypeEnum.rect:var R=n.shape.shape.width,P=n.shape.shape.height,x=n.shape.shape.x,M=n.shape.shape.y;0<=R&&0<=P?A.x>=x&&A.x<=x+R&&A.y>=M&&A.y<=M+P&&A.excuteRemoveAnnotation(n):R<=0&&0<=P?A.x>=x+R&&A.x<=x&&A.y>=M&&A.y<=M+P&&A.excuteRemoveAnnotation(n):0<=R&&P<=0?A.x>=x&&A.x<=x+R&&A.y>=M+P&&A.y<=M&&A.excuteRemoveAnnotation(n):R<=0&&P<=0&&A.x>=x+R&&A.x<=x&&A.y>=M+P&&A.y<=M&&A.excuteRemoveAnnotation(n)}})}A.shapeData.push([A.x,A.y]);var n=[[A.currentX,A.currentY+(A.y-A.currentY)/2],[A.currentX+(A.x-A.currentX)/2,A.y],[A.x,A.currentY+(A.y-A.currentY)/2],[A.currentX+(A.x-A.currentX)/2,A.currentY]];switch(A.shapeType){case shapeTypeEnum.rhomb:A.shape.attr("shape",{points:n});break;case shapeTypeEnum.line:A.arrowLineStartPoint.x,A.arrowLineStartPoint.y,A.x,A.y;A.shape.attr("shape",{x1:A.arrowLineStartPoint.x,y1:A.arrowLineStartPoint.y,x2:A.x,y2:A.y});break;case shapeTypeEnum.polyline:A.shape.attr("shape",{points:A.shapeData});break;case shapeTypeEnum.rect:A.shape.attr("shape",{width:A.x-A.currentX,height:A.y-A.currentY});break;case shapeTypeEnum.ellipse:A.shape.attr("shape",{cx:A.x+(A.currentX-A.x)/2,cy:A.y+(A.currentY-A.y)/2,rx:Math.abs(A.x-A.currentX)/2,ry:Math.abs(A.y-A.currentY)/2});break;case shapeTypeEnum.hlight_point:var o=A.hlightPointInfo.width,i=A.hlightPointInfo.height;t=A.x-o/2,r=A.y-i/2;A.hlightPointShape.attr("position",[t,r]),A.hlightPointInfo.isSend&&(A.hlightPointInfo.isSend=!1,A.roomHandle.sendAddAnnotation(A.boardId,A.hlightPointShape,shapeTypeEnum.hlight_point,A.color,A.lineWidth,A.arrowtype,A.fillType),setTimeout(function(){A.hlightPointInfo.isSend=!0},A.hlightPointInfo.intervalTime))}}},A.renderDiv.ontouchend=function(){if(!A.isAllowEditImg&&A.shapeType!=shapeTypeEnum.hlight_texttag&&A.shapeType!=shapeTypeEnum.mouse&&A.shapeType!=shapeTypeEnum.success&&A.shapeType!=shapeTypeEnum.failure&&A.shapeType!=shapeTypeEnum.arrow)if(A.shapeType!=shapeTypeEnum.eraser){var e={shape:A.shape,shapeType:A.shapeType,color:A.color,lineWidth:A.lineWidth,arrowtype:A.arrowtype,fillType:A.fillType};A.shapeArray.push(e),A.redoArray=[],A.shapeType!=shapeTypeEnum.hlight_point&&(A.undoArray.push({type:"add",shapeObj:e}),A.roomHandle.sendAddAnnotation(A.boardId,A.shape,A.shapeType,A.color,A.lineWidth,A.arrowtype,A.fillType))}else A.isEraser=!1},A.initType==AnnotationInitTypeEnum.proportional&&""!=A.board.backgroundColor&&A.updateBackgroundColor(A.board.backgroundColor),A.initType==AnnotationInitTypeEnum.proportional&&""!=A.board.backgroundImage&&A.updateBackgroundImage(A.board.backgroundImage),r.promise},e.prototype.excuteRemoveAnnotation=function(r){var n=this;n.zr.remove(r.shape),n.shapeGroup.remove(r.shape),n.roomHandle.sendRemoveAnnotation(n.boardId,n.shapeType,r.shape.id),n.shapeArray.forEach(function(e,t){e.shape.id==r.shape.id&&(n.undoArray.push({type:"delete",shapeObj:e}),n.shapeArray.splice(t,1))});var e=n.zr.storage._displayList;for(var t in e)e[t].id==r.shape.id&&(n.zr.remove(e[t]),n.shapeGroup.remove(e[t]))},e.prototype.initEraserShape=function(e){this.eraserShape=new zrender.Image({position:[0,0],scale:[1,1],style:{image:e,width:this.eraserImageWidth,height:this.eraserImageHeight},draggable:!0}),this.shapeGroup.add(this.eraserShape),this.eraserShape.id=Math.uuid()},e.prototype.removeToBoard=function(e){log.debug("===annotation removeToBoard");var t=this,r="userId"+e.operUserId,n=(t.shapeArray,t.zr.storage.getDisplayList()),o=t.shapeGroup.children();if(e.annotationType==shapeTypeEnum.clear){if(e.operUserId==t.roomHandle.selfUser.id){for(var i in t.shapeArray)t.zr.remove(t.shapeArray[i].shape),t.shapeGroup.remove(t.shapeArray[i].shape);t.shapeArray=[]}else for(var i in t.otherShapeMap)if(i==r)for(var a in t.otherShapeMap[i]){t.zr.remove(t.otherShapeMap[i][a].shape),t.shapeGroup.remove(t.otherShapeMap[i][a].shape);for(var s=n.length-1;0<=s;s--)n[s].id==t.otherShapeMap[i][a].shape.id&&t.zr.remove(n[s]);for(var d=o.length-1;0<=d;d--)o[d].id==t.otherShapeMap[i][a].shape.id&&t.shapeGroup.remove(o[d])}delete t.otherShapeMap[r]}else if(e.annotationType==shapeTypeEnum.eraser)if(t.hlightPointShape&&t.hlightPointShape.id==e.annotationId)t.clearCurrHlightPoint();else if(t.textTagShape&&t.textTagShape.id==e.annotationId)t.clearCurrHlightPoint();else if(e.operUserId==t.roomHandle.selfUser.id)for(var i in t.shapeArray)t.shapeArray[i].shape.id==e.annotationId&&(t.zr.remove(t.shapeArray[i].shape),t.shapeGroup.remove(t.shapeArray[i].shape),t.shapeArray.splice(i,1));else{for(var i in t.otherShapeMap)if(i==r)for(var a in t.otherShapeMap[i])t.otherShapeMap[i][a].id==e.annotationId&&(t.zr.remove(t.otherShapeMap[i][a].shape),t.shapeGroup.remove(t.otherShapeMap[i][a].shape));var l=t.zr.storage._displayList;for(var s in l)l[s].id==e.annotationId&&(t.zr.remove(l[s]),t.shapeGroup.remove(l[s]))}else if(e.annotationType==shapeTypeEnum.img)for(var i in t.otherShapeMap)if(i==r)for(a=t.otherShapeMap[i].length-1;0<=a;a--)(t.otherShapeMap[i][a].shape.id==e.annotationId||e.Img&&t.otherShapeMap[i][a].shape.id==e.Img.im.id)&&(t.zr.remove(t.otherShapeMap[i][a].shape),t.shapeGroup.remove(t.otherShapeMap[i][a].shape),t.otherShapeMap[i].splice(a,1))},e.prototype.drawTextToBoard=function(e){var t,r=this,n=e.txt,o=n.txi,i=o.txs,a=n.objectBase.objectBase,s=parseInt(n.objectBase.type),d=parseInt(a.lineWidth),l=parseInt(a.arrow),u=re(a.lineColor),c=re(a.fillColor),p=new zrender.Text({style:{text:i[0].content,fontSize:o.fontSize,fontStyle:o.fontStyle,fontWeight:o.fontWeight,fill:(t=o.fontColor,"rgb("+t.r+","+t.g+","+t.b+")")},position:[n.objectBase.start.x*r.roomHandle.boardInputXRatio,n.objectBase.start.y*r.roomHandle.boardInputYRatio],origin:[n.objectBase.start.x*r.roomHandle.boardInputXRatio,n.objectBase.start.y*r.roomHandle.boardInputYRatio],onmouseover:function(e){if(r.shapeType==shapeTypeEnum.eraser&&r.isEraser)for(var t in r.shapeArray)r.shapeArray[t].shape.id==e.target.parent.id&&(r.zr.remove(e.target.parent),r.shapeGroup.remove(e.target.parent),r.roomHandle.sendRemoveAnnotation(r.boardId,r.shapeType,r.shapeArray[t].shape.id),r.undoArray.push({type:"delete",shapeObj:r.shapeArray[t]}),r.shapeArray.splice(t,1))}});r.shapeGroup.add(p);var h={id:e.annotationId,shape:p,shapeType:s,lineWidth:d,arrowtype:l,color:u,fillColor:c};if(e.operUserId===r.roomHandle.selfUser.id)r.shapeArray.push(h);else{var f="userId"+a.ownerUserId;r.otherShapeMap[f]||(r.otherShapeMap[f]=[]),r.otherShapeMap[f].push(h)}},e.prototype.drawToBoard=function(e){var o=this,t=parseInt(e.objectBase.type),r=parseInt(e.objectBase.lineWidth),n=parseInt(e.objectBase.arrow),i=re(e.objectBase.lineColor),a=re(e.objectBase.fillColor),s=null;function d(e){if(o.shapeType==shapeTypeEnum.eraser&&o.isEraser)for(var t in o.shapeArray)if(e.target.id&&o.shapeArray[t].shape.id==e.target.id){o.zr.remove(o.shapeArray[t].shape),o.shapeGroup.remove(o.shapeArray[t].shape);var r=o.zr.storage._displayList;for(var n in r)r[n].id==e.target.id&&(o.zr.remove(r[n]),o.shapeGroup.remove(r[n]));o.roomHandle.sendRemoveAnnotation(o.boardId,o.shapeType,o.shapeArray[t].shape.id),o.shapeArray.splice(t,1)}}switch(t){case shapeTypeEnum.rhomb:var l=e.start.x,u=e.start.y,c=e.end.x,p=e.end.y;log.debug("===annotation.drawToBoard(),room.boardInputXRatio:"+o.roomHandle.boardInputXRatio+",room.boardInputYRatio:"+o.roomHandle.boardInputYRatio),log.debug("===annotation.drawToBoard(),shapeTypeEnum.rhomb,currentX:",l+",currentY:",u+",x:"+c+",y:"+p);var h=Math.round(l*o.roomHandle.boardInputXRatio),f=Math.round(u*o.roomHandle.boardInputYRatio),m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),ishapeTypeEnum.rhomb,nputCurrentX:",h+",inputCurrentY:",f+",inputX:"+m+",inputY:"+g);var v=[[h,f+(g-f)/2],[h+(m-h)/2,g],[m,f+(g-f)/2],[h+(m-h)/2,f]];s=new zrender.Polygon({shape:{points:v,smooth:0},style:{stroke:i,fill:"none",lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.line:var y=e.start.x,_=e.start.y,b=e.end.x,S=e.end.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.line,x1:",y+",y1:",_+",x2:"+b+",y2:"+S);var w=Math.round(y*o.roomHandle.boardInputXRatio),E=Math.round(_*o.roomHandle.boardInputYRatio),I=Math.round(b*o.roomHandle.boardInputXRatio),T=Math.round(S*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.line,inputx1:",w+",inputy1:",E+",inputx2:"+I+",inputy2:"+T),s=new zrender.Arrowline({shape:{x1:w,y1:E,x2:I,y2:T,arrowlength:10,arrowtype:n},style:{stroke:i,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.failure:c=e.start.x,p=e.start.y;var C=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.failure,x:",c+",y:",p+",width:"+C+",height:"+R);m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio);var P=Math.round(C*o.roomHandle.boardInputXRatio),k=Math.round(R*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.failure,inputX:",m+",inputY:",g+",inputWidth:"+P+",inputHeight:"+k),s=new $({shape:{x:m,y:g,width:P,height:k},style:{stroke:i,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.success:c=e.start.x,p=e.start.y,C=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.success,x:",c+",y:",p+",width:"+C+",height:"+R);m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio),P=Math.round(C*o.roomHandle.boardInputXRatio),k=Math.round(R*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.success,inputX:",m+",inputY:",g+",inputWidth:"+P+",inputHeight:"+k),s=new Z({shape:{x:m,y:g,width:P,height:k},style:{stroke:i,fill:"none",lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.arrow:c=e.start.x,p=e.start.y,C=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.arrow,x:",c+",y:",p+",width:"+C+",height:"+R);m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio),P=Math.round(C*o.roomHandle.boardInputXRatio),k=Math.round(R*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.arrow,inputX:",m+",inputY:",g+",inputWidth:"+P+",inputHeight:"+k),s=new ee({shape:{x:m,y:g,width:P,height:k},style:{stroke:i,fill:a,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.hlight_texttag:var x=o.roomHandle.getUser(e.objectBase.ownerUserId);c=e.start.x,p=e.start.y,C=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_texttag,x:",c+",y:",p+",width:"+C+",height:"+R);m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio),P=Math.round(C*o.roomHandle.boardInputXRatio),k=Math.round(R*o.roomHandle.boardInputYRatio);if(log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_texttag,inputX:",m+",inputY:",g+",inputWidth:"+P+",inputHeight:"+k),!x)return;o.textTagShape?o.textTagShape.attr({shape:{x:m,y:g},style:{text:x.name},zlevel:o.normalZlevel}):(o.textTagShape=new te({shape:{x:m,y:g,width:P,height:k},style:{stroke:"red",fill:"red",text:x.name,truncate:{outerWidth:50},lineWidth:r},zlevel:o.normalZlevel,onmouseover:d}),o.shapeGroup.add(o.textTagShape),o.textTagShape.id=e.objectBase.annotationId);break;case shapeTypeEnum.polyline:var M=[];for(var A in console.log("===annotation.drawToBoard(),shapeTypeEnum.polyline,points：",M),e.points){c=e.points[A].x,p=e.points[A].y;var O=[m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio)];M.push(O)}s=new zrender.Polyline({shape:{points:M,smooth:0},style:{stroke:i,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.rect:c=e.start.x,p=e.start.y,C=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.rect,x:",c+",y:",p+",width:"+C+",height:"+R);m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio),P=Math.round(C*o.roomHandle.boardInputXRatio),k=Math.round(R*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.rect,inputX:",m+",inputY:",g+",inputWidth:"+P+",inputHeight:"+k),s=new zrender.Rect({shape:{x:m,y:g,width:P,height:k},style:{stroke:i,fill:a,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.ellipse:var U=e.start.x,D=e.end.x,L=e.start.y,H=e.end.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.ellipse,startX :",U+",endX:",D+",startY:"+L+",endY:"+H);var N=Math.round(U*o.roomHandle.boardInputXRatio),B=Math.round(D*o.roomHandle.boardInputXRatio),j=Math.round(L*o.roomHandle.boardInputYRatio),V=Math.round(H*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.ellipse,inputStartX :",N+",inputEndX:",B+",inputStartY:"+j+",inputEndY:"+V);var F=(B-N)/2,q=(V-j)/2,G=N+F,W=j+q;s=new zrender.Ellipse({shape:{cx:G,cy:W,rx:F,ry:q},style:{stroke:i,fill:a,lineWidth:r},zlevel:o.normalZlevel,onmouseover:d});break;case shapeTypeEnum.hlight_point:c=e.start.x,p=e.start.y,C=o.hlightPointInfo.width,R=o.hlightPointInfo.height;console.log("===annotation.drawToBoard(),shapeTypeEnum.hlight_point,x:",c+",y:",p+",width:"+C+",height:"+R);m=Math.round(c*o.roomHandle.boardInputXRatio),g=Math.round(p*o.roomHandle.boardInputYRatio),P=Math.round(C*o.roomHandle.boardInputXRatio),k=Math.round(R*o.roomHandle.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_point,inputX:",m+",inputY:",g+",inputWidth:"+P+",inputHeight:"+k),o.hlightPointShape?o.hlightPointShape.attr("position",[m-P/2,g-k/2]):(o.hlightPointShape=new zrender.Image({position:[m,g],scale:[1,1],style:{image:o.hlightPointInfo.imgUrl,width:P,height:k},draggable:!0,zlevel:o.normalZlevel}),o.shapeGroup.add(o.hlightPointShape),o.hlightPointShape.id=e.objectBase.annotationId);break;case shapeTypeEnum.img:console.log("===annotation.drawToBoard(),shapeTypeEnum.img, annotationInfo:",e);var z=degree2mathPI(e.im.rotate),Y=null,K={id:e.im.id,shape:null,shapeType:t,lineWidth:r,arrowtype:n,color:i,fillColor:a};if(e.objectBase.ownerUserId===o.roomHandle.selfUser.id)for(var X=0;X<o.roomHandle.annotation2boardId[e.objectBase.objectId].storageArr.length;X++){var J=o.roomHandle.annotation2boardId[e.objectBase.objectId].storageArr[X];if(J.annotationType==shapeTypeEnum.img&&J.annotationId==e.im.id&&J.operUserId==o.roomHandle.selfUser.id){Y=J.imgZrender,K.shape=Y,o.shapeArray.push(K);break}}else{Y=new zrender.Image({style:{image:e.im.file_url,x:e.im.x*o.roomHandle.boardInputXRatio,y:e.im.y*o.roomHandle.boardInputYRatio,width:e.im.w*o.roomHandle.boardInputXRatio,height:e.im.h*o.roomHandle.boardInputYRatio},zlevel:e.im.layer,id:e.im.id,rotation:z,originX:e.im.x*o.roomHandle.boardInputXRatio+e.im.w/2*o.roomHandle.boardInputXRatio,originY:e.im.y*o.roomHandle.boardInputYRatio+e.im.h/2*o.roomHandle.boardInputYRatio}),K.shape=Y;var Q="userId"+e.objectBase.ownerUserId;if(o.otherShapeMap[Q]){for(X=o.otherShapeMap[Q].length-1;0<=X;X--)o.otherShapeMap[Q][X].shape.id===e.im.id&&o.otherShapeMap[Q].splice(X,1);o.otherShapeMap[Q].push(K)}else o.otherShapeMap[Q]=[],o.otherShapeMap[Q].push(K)}o.shapeGroup.add(Y),o.setAllowEditImg(!1)}if(s){K={id:e.objectBase.annotationId,shape:s};if(o.shapeGroup.add(s),s.id=e.objectBase.annotationId,e.objectBase.ownerUserId==o.roomHandle.selfUser.id)o.shapeArray.push({shape:s,shapeType:t,color:i,lineWidth:r,arrowtype:n,fillType:fillTypeEnum.none});else{Q="userId"+e.objectBase.ownerUserId;o.otherShapeMap[Q]||(o.otherShapeMap[Q]=[]),o.otherShapeMap[Q].push(K)}}},e.prototype.updateDrawToBoard=function(t){var r=this;switch(parseInt(t.objectBase.type)){case shapeTypeEnum.img:for(var e in r.shapeGroup.eachChild(function(e){e.id===t.im.id&&r.shapeGroup.remove(e)}),r.shapeArray)r.shapeArray[e].shape.id==t.im.id&&(r.zr.remove(r.shapeArray[e].shape),r.shapeArray.splice(e,1));var n=degree2mathPI(t.im.rotate),o=(t.im.x,r.roomHandle.boardInputXRatio,t.im.w,r.roomHandle.boardInputXRatio,t.im.y,r.roomHandle.boardInputYRatio,t.im.h,r.roomHandle.boardInputYRatio,new zrender.Image({style:{image:t.im.file_url,x:t.im.x*r.roomHandle.boardInputXRatio,y:t.im.y*r.roomHandle.boardInputYRatio,width:t.im.w*r.roomHandle.boardInputXRatio,height:t.im.h*r.roomHandle.boardInputYRatio},zlevel:t.im.layer,id:t.im.id,rotation:n,origin:[t.im.x*r.roomHandle.boardInputXRatio+t.im.w*r.roomHandle.boardInputXRatio/2,t.im.y*r.roomHandle.boardInputYRatio+t.im.h*r.roomHandle.boardInputYRatio/2]}));r.roomHandle.style2annotation[t.im.id]&&(o.attr("style",JSON.parse(r.roomHandle.style2annotation[t.im.id].style)),o.attr("position",JSON.parse(r.roomHandle.style2annotation[t.im.id].position)),o.attr("scale",JSON.parse(r.roomHandle.style2annotation[t.im.id].scale)),o.attr("rotation",JSON.parse(r.roomHandle.style2annotation[t.im.id].rotation)),o.attr("origin",JSON.parse(r.roomHandle.style2annotation[t.im.id].origin))),r.shapeGroup.add(o);var i={shape:o,shapeType:r.shapeType};if(t.objectBase.ownerUserId===r.roomHandle.selfUser.id)r.shapeArray.push(i);else{var a="userId"+t.objectBase.ownerUserId;if(r.otherShapeMap[a]){for(var s=r.otherShapeMap[a].length-1;0<=s;s--)r.otherShapeMap[a][s].shape.id===t.im.id&&r.otherShapeMap[a].splice(s,1);r.otherShapeMap[a].push(i)}else r.otherShapeMap[a]=[],r.otherShapeMap[a].push(i)}if(r.roomHandle.annotation2boardId[t.objectBase.objectId])for(s=0;s<r.roomHandle.annotation2boardId[t.objectBase.objectId].storageArr.length;s++){var d=r.roomHandle.annotation2boardId[t.objectBase.objectId].storageArr[s];if(d.Img&&d.annotationType==shapeTypeEnum.img&&(d.Img.im.id==t.im.id||d.annotationId==t.im.id)&&d.operUserId==t.objectBase.ownerUserId){d.Img.im.x=t.im.x,d.Img.im.y=t.im.y,d.Img.im.w=t.im.w,d.Img.im.h=t.im.h,d.Img.im.rotate=t.im.rotate;break}}}},e.prototype.setShapeType=function(e,t){var r=avdEngineHandle.getBrowserDetect().osName;this.shapeType==shapeTypeEnum.hlight_point&&this.hlightPointShape&&this.clearCurrHlightPoint(),this.eraserShape&&this.clearCurrEraser(),(e==shapeTypeEnum.eraser&&t&&"Android"==r||"iOS"==r)&&this.initEraserShape(t),this.shapeType==shapeTypeEnum.hlight_texttag&&this.textTagShape&&this.clearCurrHlightPoint();var n="";t&&(n="url("+t+"),auto"),null!=this.textInfo?e==shapeTypeEnum.txt?(this.textInfo.setTextEditEnable(!0),this.zr.handler.proxy.cursor="text"):this.textInfo.setTextEditEnable(!1):avdEngineHandle.eraserCustomIconPath=n,this.shapeType=parseInt(e)},e.prototype.clearCurrEraser=function(){this.eraserShape&&(this.zr.remove(this.eraserShape),this.shapeGroup.remove(this.eraserShape),this.eraserShape=null)},e.prototype.setColor=function(e){this.color=e,"none"!=this.fillColor&&(this.fillColor=e)},e.prototype.setColorOpacity=function(e){var t=this.color.split(",");t[t.length-1]=e+")";var r=t.join(",");console.log(r),this.color=r,"none"!=this.fillColor&&(this.fillColor=r)},e.prototype.setLineWidth=function(e){this.lineWidth=parseInt(e)},e.prototype.setArrowLength=function(e){this.arrowLength=parseInt(e)},e.prototype.setArrowType=function(e){this.arrowtype=parseInt(e)},e.prototype.download=function(){if(null!=this.renderBackground||null!=this.annoDiv){var e=document.createElement("canvas");e.width=this.renderDiv.width,e.height=this.renderDiv.height;var t=e.getContext("2d");this.renderBackground&&t.drawImage(this.renderBackground,0,0),t.drawImage(this.renderDiv,0,0),function(e){var t=e.toDataURL("image/png");imgData=t.replace((r="png","image/"+(r=r.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]),"image/octet-stream");var r;var n="个人画板_"+(new Date).getTime()+".png";!function(e,t){var r=document.createElementNS("http://www.w3.org/1999/xhtml","a");r.href=e,r.download=t;var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(n)}(imgData,n)}(e)}},e.prototype.setFillColor=function(e){(this.fillType=e)==fillTypeEnum.none?this.fillColor="none":this.fillColor=this.color},e.prototype.clear=function(){for(var e=this,t=e.shapeArray,r=e.zr.storage.getDisplayList(),n=e.shapeGroup.children(),o=t.length-1;0<=o;o--){e.zr.remove(t[o].shape);for(var i=r.length-1;0<=i;i--)r[i].id==t[o].shape.id&&e.zr.remove(r[i]);for(var a=n.length-1;0<=a;a--)n[a].id==t[o].shape.id&&e.shapeGroup.remove(n[a])}e.shapeArray=[],e.undoArray=[],e.redoArray=[],e.roomHandle.sendRemoveAnnotation(e.boardId,shapeTypeEnum.clear,"")},e.prototype.undo=function(){if(!(this.undoArray.length<1)){var e=this.undoArray.pop();this.undoShape(e)}},e.prototype.undoShape=function(e){var r=this;switch(e.type){case"delete":r.shapeGroup.add(e.shapeObj.shape),r.shapeArray.push(e.shapeObj),r.roomHandle.sendAddAnnotation(r.boardId,e.shapeObj.shape,e.shapeObj.shapeType,e.shapeObj.color,e.shapeObj.lineWidth,e.shapeObj.arrowtype,e.shapeObj.fillType),r.redoArray.push(e);break;case"add":r.zr.remove(e.shapeObj.shape),r.shapeGroup.remove(e.shapeObj.shape),function(e){if(r.shapeArray.length<1)return;for(var t=0;t<r.shapeArray.length;t++)r.shapeArray[t].shape.id===e&&r.shapeArray.splice(t,1)}(e.shapeObj.shape.id),r.roomHandle.sendRemoveAnnotation(r.boardId,shapeTypeEnum.eraser,e.shapeObj.shape.id),r.redoArray.push(e)}},e.prototype.redo=function(){if(!(this.redoArray.length<1)){var e=this.redoArray.pop();this.redoShape(e)}},e.prototype.redoShape=function(e){var r=this;switch(e.type){case"delete":r.zr.remove(e.shapeObj.shape),r.shapeGroup.remove(e.shapeObj.shape),function(e){if(r.shapeArray.length<1)return;for(var t=0;t<r.shapeArray.length;t++)r.shapeArray[t].shape.id===e&&r.shapeArray.splice(t,1)}(e.shapeObj.shape.id),r.roomHandle.sendRemoveAnnotation(r.boardId,shapeTypeEnum.eraser,e.shapeObj.shape.id),r.undoArray.push(e);break;case"add":r.shapeGroup.add(e.shapeObj.shape),r.shapeArray.push(e.shapeObj),r.roomHandle.sendAddAnnotation(r.boardId,e.shapeObj.shape,e.shapeObj.shapeType,e.shapeObj.color,e.shapeObj.lineWidth,e.shapeObj.arrowtype,e.shapeObj.fillType),r.undoArray.push(e)}},e.prototype.hlightPointInit=function(e,t,r,n){this.hlightPointInfo.imgUrl=e,this.hlightPointInfo.width=parseInt(t)?parseInt(t):this.hlightPointInfo.width,this.hlightPointInfo.height=parseInt(r)?parseInt(r):this.hlightPointInfo.height,this.hlightPointInfo.intervalTime=parseInt(n)?parseInt(n):this.hlightPointInfo.intervalTime},e.prototype.clearCurrHlightPoint=function(){var e=this;e.hlightPointShape&&(e.roomHandle.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.hlightPointShape.id),e.zr.remove(e.hlightPointShape),e.shapeGroup.remove(e.hlightPointShape),e.hlightPointShape=null),e.textTagShape&&(e.roomHandle.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.textTagShape.id),e.zr.remove(e.textTagShape),e.shapeGroup.remove(e.textTagShape),e.textTagShape=null)},e.prototype.startHlightPoint=function(){var o=this;o.setShapeType(shapeTypeEnum.hlight_point);var i=o.hlightPointInfo.width,a=o.hlightPointInfo.height;o.hlightPointShape=new zrender.Image({position:[-100,-100],scale:[1,1],style:{image:o.hlightPointInfo.imgUrl,width:o.hlightPointInfo.width,height:o.hlightPointInfo.height},draggable:!0}),o.shapeGroup.add(o.hlightPointShape),o.hlightPointShape.id=Math.uuid(),o.renderDiv.onmousemove=function(e){if(!o.isAllowEditImg&&o.shapeType==shapeTypeEnum.hlight_point){var t=o.handleScaledXY(e.clientX-this.getBoundingClientRect().left,e.clientY-this.getBoundingClientRect().top);x=t.x,y=t.y;var r=x-i/2,n=y-a/2;o.hlightPointShape.attr("position",[r,n]),o.hlightPointInfo.isSend&&(o.hlightPointInfo.isSend=!1,o.roomHandle.sendAddAnnotation(o.boardId,o.hlightPointShape,shapeTypeEnum.hlight_point,o.color,o.lineWidth,o.arrowtype,o.fillType),setTimeout(function(){o.hlightPointInfo.isSend=!0},o.hlightPointInfo.intervalTime))}}},e.prototype.changeScreen=function(e,t){if(this.zr&&0<this.shapeArray.length)for(var r in this.boardReRenderWH(e,t),this.shapeArray){var n=e/this.screenSize.width,o=t/this.screenSize.height;console.log("===Annotation.changeScreen(),x:"+n+",y:"+o),this.shapeArray[r].shape.animateTo({scale:[n,o]},function(){console.log("changeScreen")})}this.screenSize.width=e,this.screenSize.width=t},e.prototype.uploadImg=function(e,t){var o=when.defer(),i=this,r=t.files[0];if(!r){var n=new l(ErrorConstant.upload_filer_required);o.reject(n)}var a=r.size,s=r.type;if(log.info("===annotation.uploadImg(),fileSize:"+a+", fileType"+s),["image/jpeg","image/png"].includes(s))if(15728640<a){t.value="",(n=new l(ErrorConstant.upload_filer_fileSize)).message=n.message+",Within 15M only",o.reject(n)}else{(new d).uploadFile(e,r).then(function(r){t.value="",log.info("===annotation.uploadImg(),fileUrl:"+r);var n=new Image;n.src=r,n.onload=function(){var e=n.width,t=n.height;log.info("===annotation.uploadImg(),img width:"+e+", height:"+t),i.drawImg(r,e,t),n=null,o.resolve()}}).otherwise(function(e){console.info("===annotation.uploadImg(),error:",e),o.reject(e)})}else t.value="",(n=new l(ErrorConstant.upload_filer_fileType)).message=n.message+",Support jpeg/jpg/png only ",o.reject(n);return o.promise},e.prototype.drawImg=function(e,t,r){log.info("===annotation.drawImg(),imgUrl:"+e+", imgWidth:"+t+", imgHeight:"+r);var n=t/r,o=t,i=r;(150<t||150<r)&&(1<n?(o=150,i=Math.round(o/n)):(i=150,o=Math.round(i*n))),log.info("===annotation.drawImg(),targetWidth:"+o+", targetHeight:"+i);var a=this;a.shapeType=shapeTypeEnum.img;var s=new zrender.Image({style:{image:e,x:0,y:0,width:o,height:i,shadowColor:"red",shadowBlur:5},zlevel:a.imgZlevel,id:Math.uuid(),rotation:0,originX:0,originY:0}),d={shape:s,shapeType:a.shapeType,color:a.color,lineWidth:a.lineWidth,arrowtype:a.arrowtype,fillType:a.fillType};a.shapeArray.push(d),a.shapeGroup.add(s),a.undoArray.push({type:"add",shapeObj:d}),a.setAllowEditImg(!0),s.attr("zlevel",++a.imgZlevel),a.currActiveImg=s,a.shapeGroup.eachChild(function(e){"image"===e.type&&(e.id==a.currActiveImg.id?e.attr("style",{shadowColor:"red",shadowBlur:5}):e.attr("style",{shadowColor:void 0,shadowBlur:void 0}))}),a.roomHandle.sendAddAnnotation(a.boardId,s,shapeTypeEnum.img,a.color,a.lineWidth,a.arrowtype,a.fillType)},e.prototype.setAllowEditImg=function(e){var t=this;this.isAllowEditImg=null==e?!this.isAllowEditImg:e,this.shapeGroup.eachChild(function(e){e.type&&"image"!==e.type&&e.attr("silent",t.isAllowEditImg)}),this.isAllowEditImg?this.setShapeType(shapeTypeEnum.img):this.currActiveImg=null,this.shapeGroup.eachChild(function(e){"image"===e.type&&(t.isAllowEditImg||e.attr("style",{shadowColor:void 0,shadowBlur:void 0}))}),this.textInfo&&this.shapeType===shapeTypeEnum.txt&&this.textInfo.setTextEditEnable(!this.isAllowEditImg)},e.prototype.getAllowEditImg=function(){return this.isAllowEditImg},e.prototype.scaleImg=function(e,t){if(this.isAllowEditImg&&this.currActiveImg){var r=this.currActiveImg.scale[0],n=this.currActiveImg.scale[1];if(e)r+=t,n+=t;else{if(r-t<=.1||n-t<=.1)return;r-=t,n-=t}this.currActiveImg.attr("scale",[r,n]),this.currActiveImg.attr("origin",[this.currActiveImg.style.width/2,this.currActiveImg.style.height/2]),e?(this.currActiveImg.customPositionX=this.currActiveImg.customPositionX-this.currActiveImg.style.width/2*t,this.currActiveImg.customPositionY=this.currActiveImg.customPositionY-this.currActiveImg.style.height/2*t):(this.currActiveImg.customPositionX=this.currActiveImg.customPositionX+this.currActiveImg.style.width/2*t,this.currActiveImg.customPositionY=this.currActiveImg.customPositionY+this.currActiveImg.style.height/2*t),this.roomHandle.sendUpdateAnnotation(this.boardId,this.currActiveImg,shapeTypeEnum.img)}},e.prototype.rotateImg=function(){if(this.isAllowEditImg&&this.currActiveImg){var e=this.currActiveImg.rotation-Math.PI/2;this.currActiveImg.attr("rotation",[e]),this.currActiveImg.attr("origin",[this.currActiveImg.style.width/2,this.currActiveImg.style.height/2]),this.roomHandle.sendUpdateAnnotation(this.boardId,this.currActiveImg,shapeTypeEnum.img)}},e.prototype.delImg=function(){if(this.isAllowEditImg&&this.currActiveImg){this.roomHandle.sendRemoveAnnotation(this.boardId,shapeTypeEnum.img,this.currActiveImg.id),this.shapeGroup.remove(this.currActiveImg);for(var e=0;e<this.shapeArray.length;e++){var t=this.shapeArray[e];this.undoArray.push({type:"delete",shapeObj:t}),t.shape&&t.shape.id==this.currActiveImg.id&&this.shapeArray.splice(e,1)}this.currActiveImg=null}},e.prototype.handleScaledXY=function(e,t){var r={x:e,y:t};return 1==this.positionInfo.scaleRatioX&&1==this.positionInfo.scaleRatioX||(1<this.positionInfo.scaleRatioX?r.x/=this.positionInfo.scaleRatioX:this.positionInfo.scaleRatioX<1&&(r.x*=this.positionInfo.scaleRatioXR),1<this.positionInfo.scaleRatioY?r.y/=this.positionInfo.scaleRatioY:this.positionInfo.scaleRatioY<1&&(r.y*=this.positionInfo.scaleRatioYR)),r},e.prototype.boardReRenderWH=function(e,t){e===this.positionInfo.originalWidth&&t===this.positionInfo.originalHeight||(console.log("===scale on based position before scale"),this.boardReRenderWH(this.positionInfo.originalWidth,this.positionInfo.originalHeight));var r=this.zr.getWidth(),n=this.zr.getHeight();log.debug("===boardReRenderWH, width: "+e+"height: "+t+" currWidth: "+r+" currHeight: "+n);var o={scaleWidth:e,scaleHeight:t,zrWidth:r,zrHeight:n,scaleRatioX:e/r,scaleRatioY:t/n,scaleRatioXR:r/e,scaleRatioYR:n/t};e===this.positionInfo.originalWidth&&t===this.positionInfo.originalHeight&&(o.scaleRatioXR=1,o.scaleRatioYR=1),Object.assign(this.positionInfo,o),1==this.positionInfo.scaleRatioX&&1==this.positionInfo.scaleRatioY||(this.positionInfo.scaleRatioX*=this.shapeGroup.scaleX,this.positionInfo.scaleRatioY*=this.shapeGroup.scaleY,this.zr.resize({width:e,height:t}),this.zr.dom.style.width=e+"px",this.zr.dom.style.height=t+"px",this.renderBackground&&(this.renderBackground.width=e,this.renderBackground.height=t,this.renderBackground.style.width=e+"px",this.renderBackground.style.height=t+"px",this.board.backgroundColor&&this.updateBackgroundColor(this.board.backgroundColor),this.board.backgroundImage&&this.updateBackgroundImage(this.board.backgroundImage)),this.shapeGroup.attr({scaleX:this.positionInfo.scaleRatioX,scaleY:this.positionInfo.scaleRatioY,originX:0,originY:0}),log.debug("===Annotation boardReRenderWH positionInfo: ",this.positionInfo))},e.prototype.startTextInput=function(e){var o=this;function i(e){if(o.shapeType==shapeTypeEnum.eraser&&o.isEraser)for(var t in o.shapeArray)o.shapeArray[t].shape.id==e.target.parent.id&&(o.zr.remove(e.target.parent),o.shapeGroup.remove(e.target.parent),o.roomHandle.sendRemoveAnnotation(o.boardId,o.shapeType,o.shapeArray[t].shape.id),o.undoArray.push({type:"delete",shapeObj:o.shapeArray[t]}),o.shapeArray.splice(t,1))}o.setShapeType(shapeTypeEnum.txt),this.isAllowEditImg||(this.isAllowEditImg||null==this.textInfo||null==this.textInfo.currTextElParentNode?(this.textInfo=new t(e,this),this.setShapeType(shapeTypeEnum.txt),this.textInfo.setParentElement(this.annoDiv),this.textInfo.setCanvasParentElement("CANVAS"===this.annoDiv.tagName?this.annoDiv.parentElement:this.annoDiv),this.textInfo.initToolBar(),this.textInfo.setColorChoosePanelDisplay(!1),this.textInfo.setTextEditEnable(!0),this.textInfo.setZrender(o.zr),this.textInfo.textEventEmitter.on("confirm",function(e){!function(e){var t=o.handleScaledXY(e.position[0],e.position[1]),r=new zrender.Text({style:{text:e.content,fontSize:e.fontSize,fontStyle:e.fontStyle,fontWeight:e.fontWeight,fill:e.fontColor},zlevel:o.normalZlevel,position:[t.x,t.y],origin:[t.x,t.y-50],onmouseover:i});r.id=Math.uuid(),o.shapeGroup.add(r);var n={shape:r,shapeType:o.shapeType,color:o.color,lineWidth:o.lineWidth,arrowtype:o.arrowtype,fillType:o.fillType};o.shapeArray.push(n),o.roomHandle.sendAddAnnotation(o.boardId,r,shapeTypeEnum.txt,o.color,o.lineWidth,o.arrowtype,o.fillType)}(e)}),log.debug("===Annotation.startTextInput success")):this.textInfo.setTextEditEnable(!0))},e}),ModuleBase.define("TextInfo",[],function(){var e=function(e,t){this.currTextElStyleList=null,this.currTextElParentNode=null,this.currTextInputMap=new Map,this.currTextInputElBind=null,this.currTextIsEdit=!1,this.currTextDefaultFontSize=14,this.currTextColorChoosePanel=null,this.currTextFontSizeEl=null,this.currTextColorBtn=null,this.currTextColorChoosePanelIsShow=!1,this.currTextToolBarEl=null,this.currClickPos=null,this.textEditEnable=!1,this.canvasParentElement=null,this.confirmBtnConfig={confirm:{color:e&&e.confirm?e.confirm.color:"#5090c6",text:e&&e.confirm?e.confirm.text:"确认"},cancel:{color:e&&e.cancel?e.cancel.color:"#94ddb0",text:e&&e.cancel?e.cancel.text:"取消"}},this.textEventEmitter=new EventEmitter,this.clickPosOffset={x:0,y:0},this.zr=null,this.annotation=t},S=function(e){e.style.display="inline-block",e.style.width="30px",e.style.height="30px",e.style.cursor="pointer",e.style.textAlign="center",e.style.lineHeight="30px",e.style.transition="all ease .2s",e.style.userSelect="none",e.onmouseover=function(){e.style.background="rgba(0,0,0,.1)"},e.onmouseleave=function(){e.style.background="#ffffff"}},w=function(e){return document.createElement(e)};return e.prototype.setParentElement=function(e){this.currTextElParentNode=e,this.currTextElParentNode.style.position="relative",this.annotation.initType==AnnotationInitTypeEnum.proportional?this.annotation.renderDiv.onclick=this.initCanvasClick.bind(this):this.currTextElParentNode.onclick=this.initCanvasClick.bind(this)},e.prototype.initToolBar=function(){var e=this,t=w("div");t.id="avdrtc-tool-bar",t.style.display="none",t.style.width="280px",t.style.boxShadow="0 0 10px rgba(0,0,0,.3)",t.style.padding="5px 10px",t.style.borderRadius="5px",t.style.height="30px",t.style.zIndex="1001",t.style.background="#ffffff",t.style.position="absolute",t.style.left=this.annotation.renderDiv.offsetLeft+"px",t.style.top=this.annotation.renderDiv.offsetTop+"px",this.currTextToolBarEl=t;var r=w("span");r.style.fontWeight="bold",S(r),r.innerText="B",r.onclick=this._bold.bind(e);var n=w("span");n.style.fontStyle="italic",S(n),n.innerText="I",n.onclick=this._italic.bind(e);var o=w("span");S(o),o.innerText="T",o.onclick=this._changeColor.bind(e),this.currTextColorBtn=o;var i=w("div");i.style.background="#FFFFFF",i.style.borderRadius="5px",i.style.width="132px",i.style.height="110px",i.style.boxSizing="border-box",i.style.padding="10px",i.style.display="flex",i.style.flexWrap="wrap",i.style.flexDirection="row",i.style.justifyContent="flex-start",i.style.alignItems="center",i.style.boxShadow="0 3px 6px #0000001f",i.style.position="absolute",i.style.top="60px",i.style.left="8px",this.currTextColorChoosePanel=i;var a=w("span");this._setColorBtnStyle(a,"#e02020");var s=w("span");this._setColorBtnStyle(s,"#fa6400");var d=w("span");this._setColorBtnStyle(d,"#f7b500");var l=w("span");this._setColorBtnStyle(l,"#6dd400");var u=w("span");this._setColorBtnStyle(u,"#44d7b6");var c=w("span");this._setColorBtnStyle(c,"#32c5ff");var p=w("span");this._setColorBtnStyle(p,"#0091ff");var h=w("span");this._setColorBtnStyle(h,"#6236ff");var f=w("span");this._setColorBtnStyle(f,"#b620e0");var m=w("span");this._setColorBtnStyle(m,"#6d7278");var g=w("span");this._setColorBtnStyle(g,"#000000");var v=w("span");this._setColorBtnStyle(v,"#ffffff");var y=w("input");S(y),y.type="number",y.value="14",y.style.border="none",y.style.width="50px",y.style.height="30px",y.style.display="inline-block",y.style.boxSizing="border-box",y.style.fontSize="14px",y.style.outline="none",y.onchange=this._changeFontSize.bind(e),this.currTextFontSizeEl=y;var _=w("span");S(_),this._setBtnStyle(e,_,"confirm"),_.innerText=this.confirmBtnConfig.confirm.text,_.style.background=this.confirmBtnConfig.confirm.color,_.onclick=e._inputConfirm.bind(e);var b=w("span");S(b),this._setBtnStyle(e,b,"cancel"),b.innerText=this.confirmBtnConfig.cancel.text,b.style.background=this.confirmBtnConfig.cancel.color,b.onclick=e._inputCancel.bind(e),this.currTextToolBarEl.appendChild(r),this.currTextToolBarEl.appendChild(n),this.currTextToolBarEl.appendChild(o),this.currTextToolBarEl.appendChild(i),this.currTextToolBarEl.appendChild(y),this.currTextToolBarEl.appendChild(_),this.currTextToolBarEl.appendChild(b),this.canvasParentElement.appendChild(this.currTextToolBarEl)},e.prototype.setTextEditEnable=function(e){this.textEditEnable=e},e.prototype.initCanvasClick=function(e){if(this.textEditEnable){var t,r,n,o=e.offsetX,i=e.offsetY,a=e.target,s=o,d=i,l=a.clientWidth-o,u=a.clientHeight-i,c=(t=d,r=l,n=u,!(s<10||t<10||r<20||n<10));!this.currTextIsEdit&&c&&(this._setClickPos({x:o,y:i-7}),this._setToolBarPos(s,d-7,l,u),this.renderToBoard({x:s,y:d,offsetRight:l,offsetBottom:u}),this._setToolBarDisplay(!0),this.currTextIsEdit=!0)}},e.prototype._changeFontSize=function(e){var t=e.target.value;if(30<parseInt(t)||parseInt(t)<10)return 30<t&&(e.target.value=30),void(t<10&&(e.target.value=10));this.currTextElStyleList.fontSize=parseInt(t)+"px"},e.prototype.setColorChoosePanelDisplay=function(e){this.currTextColorChoosePanelIsShow=e,this.currTextColorChoosePanel.style.display=1==e?"flex":"none"},e.prototype._setToolBarPos=function(e,t,r,n){var o=e+this.currTextToolBarEl.offsetWidth,i=t-this.currTextToolBarEl.offsetHeight-60;40<t&&280<r?(o=o,i=i):t<40&&280<r?i+=90:t<40||r<280?(o-=310,i+=40):t<40&&(o+=280,i+=30),this.currTextToolBarEl.style.position="absolute",this.currTextToolBarEl.style.left=o+this.clickPosOffset.x+"px",this.currTextToolBarEl.style.top=i+this.clickPosOffset.y+"px"},e.prototype.setTextInputPos=function(e,t,r){e.style.left=t+this.clickPosOffset.x+"px",e.style.top=r+this.clickPosOffset.y-7+"px",this.canvasParentElement.appendChild(e)},e.prototype.renderToBoard=function(e){var t=Math.round(1e7*Math.random()),r=w("span");this.currTextInputElBind=t,r.contentEditable=!0,r.style.fontSize=this.currTextDefaultFontSize+"px",r.style.display="flex",r.style.paddingRight="20px",r.style.background="rgba(0,0,0,0",r.style.outline="orange dotted 1px",r.style.position="absolute",r.style.zIndex="1001",this.setTextInputPos(r,e.x,e.y),this.currTextInputMap.set(t,r),this.setCurrBindTextEl(t),r.focus()},e.prototype.setCurrBindTextEl=function(e){var t=this.currTextInputMap.get(e);t&&(this.currTextElStyleList=t.style)},e.prototype._setToolBarDisplay=function(e){this.currTextToolBarEl.style.display=!0===e?"flex":"none"},e.prototype._setTextFinished=function(){var e=this.currTextInputMap.get(this.currTextInputElBind);e.style.outline="none",e.contentEditable=!1,this.currTextColorBtn.style.color="#000000"},e.prototype.handleColorClick=function(e){this.currTextElStyleList.color=e.target.getAttribute("color"),this.currTextColorBtn.style.color=e.target.getAttribute("color"),this.setColorChoosePanelDisplay(!1)},e.prototype._setClickPos=function(e){if(e){var t=e.x,r=e.y;this.currClickPos={x:t,y:r}}else this.currClickPos=null},e.prototype._getClickPos=function(){return this.currClickPos},e.prototype._setColorBtnStyle=function(e,t){e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.cursor="pointer",e.style.margin="4px",e.style.width="20px",e.style.height="20px",e.style.boxSizing="border-box",e.style.borderRadius="50%",e.style.border="1px solid rgba(0,0,0,.2)",e.style.background=t,e.setAttribute("color",t),this.currTextColorChoosePanel.appendChild(e),e.onclick=this.handleColorClick.bind(this)},e.prototype._bold=function(){"bold"===this.currTextElStyleList.fontWeight?this.currTextElStyleList.fontWeight="":this.currTextElStyleList.fontWeight="bold"},e.prototype._italic=function(e){"italic"===this.currTextElStyleList.fontStyle?this.currTextElStyleList.fontStyle="":this.currTextElStyleList.fontStyle="italic"},e.prototype._changeColor=function(){this.currTextColorChoosePanelIsShow?this.setColorChoosePanelDisplay(!1):this.setColorChoosePanelDisplay(!0)},e.prototype._inputConfirm=function(e){e&&null!=e.cancelBubble&&(e.cancelBubble=!0),this._checkTextIsEmpty()?this._inputCancel():(this._setTextFinished(),this.textEventEmitter.emit("confirm",this._getCurrTextInfo()),this._setToolBarDisplay(!1),this.currTextIsEdit=!1,this.currTextFontSizeEl.value=this.currTextDefaultFontSize,this.canvasParentElement.removeChild(this.currTextInputMap.get(this.currTextInputElBind)),this._setClickPos(null),this.currTextInputElBind=null)},e.prototype._inputCancel=function(e){e&&null!=e.cancelBubble&&(e.cancelBubble=!0),this.canvasParentElement.removeChild(this.currTextInputMap.get(this.currTextInputElBind)),this.currTextInputMap.delete(this.currTextInputElBind),this._setToolBarDisplay(!1),this.currTextInputElBind=null,this.currTextIsEdit=!1,this.currTextColorBtn.style.color="#000000"},e.prototype._checkTextIsEmpty=function(){var e=!1;return""===this.currTextInputMap.get(this.currTextInputElBind).innerText&&(e=!0),e},e.prototype._getCurrTextInfo=function(){var e=this._getClickPos(),t=e.x,r=e.y,n=this.currTextInputMap.get(this.currTextInputElBind),o=this.currTextElStyleList.color,i=this.currTextElStyleList.fontSize,a=this.currTextElStyleList.fontStyle,s=this.currTextElStyleList.fontWeight,d=n.innerText,l=(parseInt(r-n.offsetHeight/2),[t,r]);return{fontColor:o||"rgb(0,0,0)",fontSize:parseInt(i.split("px")[0]),fontStyle:a,fontWeight:s,content:d,position:l}},e.prototype._setBtnStyle=function(e,t,r){t.style.marginLeft="10px",t.style.fontSize="13px",t.style.borderRadius="3px",t.style.color="#ffffff",t.style.width="60px","confirm"==r?(t.onmouseover=function(){t.style.opacity="0.9"},t.onmouseleave=function(){t.style.background=e.confirmBtnConfig.confirm.color,t.style.opacity="1"}):(t.onmouseover=function(){t.style.opacity="0.9"},t.onmouseleave=function(){t.style.background=e.confirmBtnConfig.cancel.color,t.style.opacity="1"})},e.prototype.setZrender=function(e){log.debug("===Textinfo setZrender zr: ",null!=e),this.zr=e;var t=this.zr.dom;this.clickPosOffset.x=t.offsetLeft,this.clickPosOffset.y=t.offsetTop},e.prototype.setCanvasParentElement=function(e){this.canvasParentElement=e},e}),ModuleBase.define("Outgoing",["OutgoingRestServer","Error"],function(t,l){var e=function(e){this.restServerURI=e,this.outgoingRestServer=new t};return e.prototype.createOutgoingUser=function(e,t,r,n,o,i,a){var s=when.defer();if(""==t){var d=new l(ErrorConstant.roomId_required);return s.reject(d),s.promise}if(""==r){d=new l(ErrorConstant.userId_required);return s.reject(d),s.promise}if(""!=o)return this.outgoingRestServer.createOutgoingUser(this.restServerURI,e,t,r,n,o,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise;d=new l(ErrorConstant.userAddress_require);return s.reject(d),s.promise},e.prototype.destroyOutgoingUser=function(e,t,r,n){var o=when.defer();return this.outgoingRestServer.destroyOutgoingUser(this.restServerURI,e,t,r,n).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},e.prototype.getOutgoingUsers=function(e,t){var r=when.defer();return this.outgoingRestServer.getOutgoingUsers(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e}),ModuleBase.define("OutgoingRestServer",["Error"],function(p){var e=function(){};return e.prototype.createOutgoingUser=function(e,t,r,n,o,i,a,s){var d=when.defer(),l=document.location.protocol;"httpsionic:"==l&&(l="https:");var u=l+"//"+e+"/avd/api/outgoing/createOutgoingUser",c={params:{roomId:r,userAddress:i,userId:n,accessToken:t,userName:o,userData:a,options:s}};return this.fetchGet(u,c).then(function(e){if(e&&0==e.result)d.resolve(e.data);else{var t=new p(e.result,e.err);d.reject(t)}}).catch(function(e){e=new p(e.code,e.message);return d.reject(e),!1}),d.promise},e.prototype.destroyOutgoingUser=function(e,t,r,n,o){var i=when.defer(),a=document.location.protocol;"httpsionic:"==a&&(a="https:");var s=a+"//"+e+"/avd/api/outgoing/destroyOutgoingUser",d={params:{roomId:r,userAddress:n,userId:o,accessToken:t}};return this.fetchGet(s,d).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new p(e.result,e.err);i.reject(t)}}).catch(function(e){e=new p(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.getOutgoingUsers=function(e,t,r){var n=when.defer(),o=document.location.protocol;"httpsionic:"==o&&(o="https:");var i=o+"//"+e+"/avd/api/outgoing/getOutgoingUsers",a={params:{roomId:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)n.resolve(e.data);else{var t=new p(e.result,e.err);n.reject(t)}}).catch(function(e){e=new p(e.code,e.message);return n.reject(e),!1}),n.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,n){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};n(t)}}).catch(function(e){if(e.response){var t=new p(e.response.status,e.response.data);n(t)}else{t=new p(1e4,e.message);n(t)}n(e)})})},e}),ModuleBase.define("StreamExporterManager",["StreamExporterServer","Error"],function(u,e){var t=function(){this.streamExporterServers=[]};return t.prototype.createServerRecorder=function(e,t,r,n,o,i,a){var s=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.record,e,t,r,n,o,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createServerRealtimeRecorder=function(e,t,r,n,o,i,a){var s=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.record_real_time,e,t,r,n,o,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createServerLivecast=function(e,t,r,n,o,i,a){var s=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.liver,e,t,r,n,o,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createExportServer=function(r,e,n,o,i,a,t,s){var d=this,l=when.defer();return t||(t=10),room.masterServer.createServerRecorder(Math.uuid(),room.id,room.selfUser.id,e,r,n,o,i,a,t,"",s).then(function(e){var t=new u;t.exporterId=e.exporter_id,t.name=e.exporter_name,t.viewWidth=n,t.viewHeight=o,t.outBitrate=i,t.outFps=a,t.playurls=e.play_urls,t.exporterType=r,d.streamExporterServers.push(t),l.resolve(t)}).otherwise(function(e){l.reject(e)}),l.promise},t.prototype.getExporter=function(e){var t=null;for(var r in streamExporterServers){var n=streamExporterServers[r];(n.exporterId=e)&&(t=n,brea)}return t},t.prototype.getStreamExporterServer=function(e,t,s){var d=when.defer();return room.masterServer.outgoingGetExporterInfo(e,t,s).then(function(e,t){var r=new u;r.exporterId=e.view_stream_id,r.name=e.exporter_name,r.viewWidth=e.view_width,r.viewHeight=e.view_height,r.outBitrate=e.view_bitrate,r.outFps=e.view_fps,r.maxVideoNumber=e.max_video_number,r.viewLayoutMode=e.layoutMode,r.exporterType=s;var n=[];if(t)for(var o in t){var i=t[o],a={userId:i.owner_user_id,deviceId:i.video_resource_id,x:i.x,y:i.y,width:i.w,height:i.h,zorder:i.zoder,data:i.video_data};n.push(a)}r.videoItems=n,d.resolve(r)}).otherwise(function(e){d.reject(e)}),d.promise},t.prototype.setFocusVideo=function(e,t,r){var n=when.defer();return room.masterServer.outgoingExporterSetFocusVideo(e,t,r).then(function(){n.resolve()}).otherwise(function(e){n.reject(e)}),n.promise},t}),ModuleBase.define("StreamExporterServer",["Error"],function(m){var e=function(){this.exporterId="",this.name="",this.appdata=null,this.exporterType=null,this.playurls="",this.viewWidth=0,this.viewHeight=0,this.outBitrate=0,this.outFps=0,this.maxVideoNumber=4,this.createTime="",this.status=exporterStatusEnum.live,this.size=0,this.desturl="",this.videoItems=[],this.audioUserId="",this.viewLayoutMode=viewLayoutModeEnum.fixation,this.pause_resume=!1};return e.prototype.updateStreamsExporter=function(t,e,r,n,o,i,a,s){var d=this,l=when.defer();return room.masterServer.createServerRecorder(e,room.id,room.selfUser.id,r,t,n,o,i,a,s,"").then(function(e){d.exporterId=e.exporter_id,d.name=e.exporter_name,d.viewWidth=n,d.viewHeight=o,d.outBitrate=i,d.outFps=a,d.playurls=e.play_urls,d.exporterType=t,l.resolve()}).otherwise(function(e){l.reject(e)}),l.promise},e.prototype.selectSingleVideo4Exporter=function(e,t,r,n){var o=when.defer(),i=t;if(e==room.selfUser.id&&(i=room.setDeviceIdByUUID(0,t)),arguments.length<3){var a=new m(ErrorConstant.exporter_parameter_lack_error);o.reject(a)}else this.audioUserId=r,n||(n=""),room.masterServer.selectStream4Exporter(this.exporterId,room.id,e,i,this.audioUserId,n,this.exporterType).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)});return o.promise},e.prototype.selectMixedVideos4Exporter=function(){var t=when.defer();return room.masterServer.mixMedia4Exporter(this.exporterId,room.id,this.viewLayoutMode,this.videoItems,this.audioUserId,this.exporterType).then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.selectMixedVideos4ExporterStart=function(){var e=this,t=when.defer();return setTimeout(function(){e.selectMixedVideos4Exporter().then(function(e){t.resolve(e)},function(e){t.reject(e)})},0),t.promise},e.prototype.setAudioUserId=function(e){this.audioUserId=e},e.prototype.setAutoLayout=function(e){var t=when.defer(),r=!1;for(var n in viewLayoutModeEnum)if(e==viewLayoutModeEnum[n]){r=!0;break}if(r)this.viewLayoutMode=e,self.selectMixedVideos4Exporter().then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)});else{var o=new m(ErrorConstant.exporter_parameter_type_error);t.reject(o)}return t.promise},e.prototype.addVideoItem=function(t,e,r,n,o,i,a,s,d,l){var u=this,c=when.defer(),p=e;if(t==room.selfUser.id&&(p=room.setDeviceIdByUUID(0,e)),arguments.length<7){var h=new m(ErrorConstant.exporter_parameter_lack_error);c.reject(h)}else u.checkoutArguments(r,n,o,i,a).then(function(){var e={userId:t,deviceId:p,x:parseFloat(r),y:parseFloat(n),width:parseFloat(o),height:parseFloat(i),zorder:parseFloat(a),videoData:l};u.videoItems.push(e),c.resolve()}).otherwise(function(e){c.reject(e)});return c.promise},e.prototype.removeAllVideoItem=function(){this.videoItems=[]},e.prototype.addSubVideo=function(e,t,r,n,o,i,a,s,d){var l=this,u=when.defer(),c=t;if(e==room.selfUser.id&&(c=room.setDeviceIdByUUID(0,t)),arguments.length<7){var p=new m(ErrorConstant.exporter_parameter_lack_error);u.reject(p)}else{var h=!1;for(var f in l.videoItems)if(l.videoItems[f].deviceId==c){h=!0;break}if(h){p=new m(ErrorConstant.video_has_exporter_error);u.reject(p)}else l.addVideoItem(e,c,r,n,o,i,a,s,d).then(function(){l.selectMixedVideos4Exporter().then(function(e){u.resolve(e)}).otherwise(function(e){u.reject(e)})},function(e){u.reject(e)})}return u.promise},e.prototype.updataVideo=function(e,t,r){var n=!1,o=when.defer(),i=r;if(t==room.selfUser.id&&(i=room.setDeviceIdByUUID(0,r)),arguments.length<3){var a=new m(ErrorConstant.exporter_parameter_lack_error);o.reject(a)}else{for(var s in this.videoItems)if(this.videoItems[s].deviceId==e){n=!0,this.videoItems[s].deviceId=i,this.videoItems[s].userId=t;break}if(n)this.selectMixedVideos4Exporter().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)});else{a=new m(ErrorConstant.video_not_exporter_error);o.reject(a)}}},e.prototype.modSubVideo=function(e,t,r,n,o,i,a,s,d){var l=this,u=!1,c=when.defer(),p=t;if(e==room.selfUser.id&&(p=room.setDeviceIdByUUID(0,t)),arguments.length<7){var h=new m(ErrorConstant.exporter_parameter_lack_error);c.reject(h)}else this.checkoutArguments(r,n,o,i,a).then(function(){for(var e in l.videoItems)if(l.videoItems[e].deviceId==p){u=!0,l.videoItems[e].x=parseFloat(r),l.videoItems[e].y=parseFloat(n),l.videoItems[e].width=parseFloat(o),l.videoItems[e].height=parseFloat(i),l.videoItems[e].zorder=parseFloat(a);break}if(u)l.selectMixedVideos4Exporter().then(function(e){c.resolve(e)}).otherwise(function(e){c.reject(e)});else{var t=new m(ErrorConstant.video_not_exporter_error);c.reject(t)}},function(e){c.reject(e)});return c.promise},e.prototype.rmvSubVideo=function(e,t){var r=!1,n=when.defer(),o=t;for(var i in e==room.selfUser.id&&(o=room.setDeviceIdByUUID(0,t)),this.videoItems)if(this.videoItems[i].deviceId==o){r=!0,this.videoItems.splice(i,1);break}if(r)this.selectMixedVideos4Exporter().then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)});else{var a=new m(ErrorConstant.video_not_exporter_error);n.reject(a)}return n.promise},e.prototype.pauseResume=function(){var t=this,r=when.defer(),n=!1;if(t.status!=exporterStatusEnum.stop)return t.status==exporterStatusEnum.live&&(n=!0),room.masterServer.pauseResumeExporter(t.exporterId,room.id,n,t.exporterType).then(function(e){t.status=n?exporterStatusEnum.pause:exporterStatusEnum.live,r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var e=new m(ErrorConstant.exporter_has_stop_error);return r.reject(e),r.promise},e.prototype.stopExporter=function(){var t=this,r=when.defer();return room.masterServer.destroyExporter(t.exporterId,room.id,t.exporterType).then(function(e){t.status=exporterStatusEnum.stop,r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.checkoutArguments=function(e,t,r,n,o){var i=when.defer();if("number"!=typeof e||"number"!=typeof t||"number"!=typeof r||"number"!=typeof n||"number"!=typeof o){var a=new m(ErrorConstant.exporter_parameter_type_error);i.reject(a)}else if(1<e||e<0||1<t||t<0||1<r||r<0||1<n||n<0){a=new m(ErrorConstant.exporter_parameter_number_error);i.reject(a)}else if(o<0||10<o){a=new m(ErrorConstant.exporter_parameter_number1_error);i.reject(a)}else i.resolve();return i.promise},e}),ModuleBase.define("ElectronManager",["PeerConnection","Error"],function(p,e){var t=function(){"undefined"!=typeof require&&(this.mainVersion=require("process").versions.electron.split(".")[0],this.electron=require("electron"),this.path=require("path"),this.remote=12<this.mainVersion?require("@electron/remote"):require("electron").remote,this.ipc=12<this.mainVersion?require("@electron/remote/renderer"):require("electron").ipcRenderer,this.ipcRenderer=12<this.mainVersion?require("@electron/remote/renderer"):require("electron").ipcRenderer,this.BrowserWindow=12<this.mainVersion?this.ipcRenderer.BrowserWindow:this.remote.BrowserWindow,this.curWindId=12<this.mainVersion?this.ipcRenderer.getCurrentWindow().id:this.remote.getCurrentWindow().id),this.desktopTypes=["window","screen"],this.appThumbnailSize={width:150,height:150},this.winId2PeerConnection={},this.renderPeerConnection=null,this.ipc&&this.registerElectronIPCInner()};return t.prototype.getDesktopSources=function(e,t){e&&(this.desktopTypes=e),t&&(this.appThumbnailSize=t);var r={types:this.desktopTypes,thumbnailSize:this.appThumbnailSize},i=when.defer();return(12<this.mainVersion?this.remote.desktopCapturer:this.electron.desktopCapturer).getSources(r).then(function(e){var t=[];for(var r in e){var n=e[r];console.log("===ElectronManager.getDesktopSources(),source:",n);var o={sourceId:n.id?n.id:"",sourceName:n.name?n.name:"",thumbnail:n.thumbnail?n.thumbnail.toDataURL():""};t.push(o)}i.resolve(t)}).catch(function(e){i.reject(e)}),i.promise},t.prototype.getAllDisplays=function(){return this.remote.screen.getAllDisplays()},t.prototype.getPrimaryDisplay=function(){return this.remote.screen.getPrimaryDisplay()},t.prototype.getExternalDisplays=function(){for(var e=[],t=this.remote.screen.getAllDisplays(),r=0;r<t.length;r++){var n=t[r];0===n.bounds.x&&0===n.bounds.y||e.push(n)}return e},t.prototype.renderToDisplay=function(e,t,r,n,o,i,a,s,d,l){var u=this.createWindowInner(t,r,n,o,i,a,s,d,l);if(u){var c=this.getPeerConnectionInner(u.id);c||((c=new p).createPeerConnectionInner(),c.startInner(e.srcObject,u,this.curWindId),this.winId2PeerConnection[u.id]=c)}return u.id},t.prototype.cancelRenderToDisplay=function(e){if(e){var t=this.getPeerConnectionInner(e);t&&(t.close(),t=null,delete this.winId2PeerConnection[e],this.remote.BrowserWindow.fromId(e).close())}},t.prototype.getRender=function(e){var t=new p(e);this.renderPeerConnection=t},t.prototype.closeRenderWindow=function(){this.remote.BrowserWindow.fromId(this.renderPeerConnection.parentWindId).webContents.send("closeWindow",this.remote.getCurrentWindow().id),this.remote.getCurrentWindow().close()},t.prototype.createWindowInner=function(e,t,r,n,o,i,a,s,d){var l=this,u=new this.BrowserWindow({x:e.bounds.x+r,y:e.bounds.y+n,webPreferences:{webSecurity:!1,nodeIntegration:"boolean"==typeof a&&a,enableRemoteModule:"boolean"==typeof s&&s,contextIsolation:"boolean"==typeof d&&d}}),c=u.id;return u.on("close",function(){l.remote.getCurrentWindow().webContents.send("closeWindow",c),u=null}),u.loadURL(t),o&&u.webContents.openDevTools(),i&&u.maximize(),u.show(),u},t.prototype.getPeerConnectionInner=function(e){return this.winId2PeerConnection[e]},t.prototype.registerElectronIPCInner=function(){var o=this,e=o.ipc;12<o.mainVersion&&(e=o.ipc.ipcMain),e.once("closeWindow",function(e,t){log.debug("==closeWindow,winId:",t);var r=o.winId2PeerConnection[t];r&&(r.close(),r=null,delete o.winId2PeerConnection[t])}),e.once("remoteSDP",function(e,t,r){log.debug("===ElectronManager.registerElectronIPCInner(),remoteSDP id:",t);var n=o.winId2PeerConnection[t];n&&n.setAnswerRemoteDescriptionInner(r)}),e.once("candidates",function(e,t,r){var n=o.winId2PeerConnection[t];n&&(log.debug("===ElectronManager.registerElectronIPCInner(),candidates remoteCandidates:",r),n.remoteCandidates=r)})},t}),ModuleBase.define("PeerConnection",["Error"],function(e){var t=function(e){"undefined"!=typeof require&&(this.mainVersion=require("process").versions.electron.split(".")[0],this.remote=12<this.mainVersion?require("@electron/remote"):require("electron").remote,this.ipc=12<this.mainVersion?require("@electron/remote/renderer"):require("electron").ipcRenderer,this.curWindId=this.remote.getCurrentWindow().id),this.pc=null,this.localSDP=null,this.remoteSDP=null,this.localCandidates=[],this.remoteCandidates=null,this.renderVideoElement=e,this.parentWindId=null,this.subWin=null,this.remoteCandidatesIntervalId=null,this.ipc&&this.registerElectronIPCInner()};return t.prototype.createPeerConnectionInner=function(){var r=this,e=new RTCPeerConnection({iceServers:[],sdpSemantics:"plan-b"});(r.pc=e).onicecandidate=function(e){if(e.candidate){var t=JSON.stringify(e.candidate.toJSON());r.localCandidates.push(t)}else console.debug("===electron onicecandidate(),candidates:",r.localCandidates),r.subWin?r.subWin.webContents.send("candidates",r.localCandidates):r.remote.BrowserWindow.fromId(r.parentWindId).webContents.send("candidates",r.curWindId,r.localCandidates)},e.ontrack=function(e){console.debug("===ontrack(),track: ",e.track);var t=new window.MediaStream;t.addTrack(e.track),r.renderVideoElement.srcObject=t},e.oniceconnectionstatechange=function(e){console.info("electron oniceconnectionstatechange(),  iceConnectionState :"+e.target.iceConnectionState)},e.onsignalingstatechange=function(e){console.debug("electron onsignalingstatechange(),  signalingState :"+e.target.signalingState)}},t.prototype.startInner=function(r,n,e){var o=this;o.parentWindId=e,(o.subWin=n).webContents.on("did-finish-load",function(e){if(r){var t=r.getVideoTracks()[0];o.pc.addTrack(t,r)}o.createOfferInner().then(function(e){o.localSDP=e.sdp,o.setLocalDescriptionInner(e).then(function(){n.webContents.send("extrnal-show",o.parentWindId,o.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createOfferInner(),error:",e)})})},t.prototype.registerElectronIPCInner=function(){var i=this;i.ipc.once("extrnal-show",function(e,t,r){if(i.pc||i.createPeerConnectionInner(),i.parentWindId=t,i.remoteSDP=r){var n={type:"offer",sdp:i.remoteSDP},o=new RTCSessionDescription(n);i.setRemoteDescriptionInner(o).then(function(){i.createAnswerInner().then(function(e){i.localSDP=e.sdp,i.setLocalDescriptionInner(e).then(function(){i.remote.BrowserWindow.fromId(i.parentWindId).webContents.send("remoteSDP",i.curWindId,i.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createAnswerInner(),error:",e)})}).catch(function(e){console.error("electron setRemoteDescriptionInner(),error:",e)})}})},t.prototype.createOfferInner=function(){var e=this;return new Promise(function(t,r){e.pc.createOffer(function(e){console.log("===electron createOffer sessionDescription:",e),t(e)},function(e){console.error("===electron createOffer,error:",e),r(e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1})})},t.prototype.createAnswerInner=function(){var e=this;return new Promise(function(t,r){e.pc.createAnswer(function(e){console.log("===electron  createAnswer sessionDescription:",e),t(e)},function(e){console.error("===electron createAnswer,error:",e),r(e)})})},t.prototype.setLocalDescriptionInner=function(r){var n=this;return new Promise(function(e,t){console.log("===electron Local SDP:",r.sdp),n.pc.setLocalDescription(r,function(){console.debug("===electron setLocalDescription Success"),e()},function(e){console.error("===electron setLocalDescription error,error:",e),t(e)})})},t.prototype.setAnswerRemoteDescriptionInner=function(e){var t=new RTCSessionDescription({type:"answer",sdp:e});this.setRemoteDescriptionInner(t).then(function(){}).catch(function(e){console.error("===electron setRemoteDescription(),error:",e)})},t.prototype.setRemoteDescriptionInner=function(r){var n=this;return new Promise(function(e,t){r.sdp=r.sdp.replace(/a=inactive/g,"a=recvonly"),"answer"==r.type&&(n.subWin?r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:active"):r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:passive")),r.sdp=r.sdp.replace(/96 97 98 99 100 101 102 122 127/g,"127 96 97 98 99 100 101 102 122"),console.log("===electron Remote  SDP:",r.sdp),n.pc.setRemoteDescription(r,function(){console.debug("===electron setRemoteDescription Success"),n.addIceCandidateInner(),e()},function(e){console.error("===electron setRemoteDescription error,error:",e),t(e)})})},t.prototype.addIceCandidateInner=function(){var e=this;e.remoteCandidates?e.addIceCandidateHandleInner():e.remoteCandidatesIntervalId=setInterval(function(){e.remoteCandidates&&(e.addIceCandidateHandleInner(),null!=e.remoteCandidatesIntervalId&&(clearInterval(e.remoteCandidatesIntervalId),e.remoteCandidatesIntervalId=null))},500)},t.prototype.addIceCandidateHandleInner=function(){for(var e in this.remoteCandidates)if(this.remoteCandidates.hasOwnProperty(e)){var t=JSON.parse(this.remoteCandidates[e]);this.pc.addIceCandidate(t,function(){console.log("===electron addIceCandidate Success")},function(e){console.error("===electron addIceCandidate error:",e)})}},t.prototype.close=function(){this.pc&&"closed"!=this.pc.signalingState&&this.pc.close()},t}),ModuleBase.define("RtmManager",["RtmMessageManager","Error"],function(s,d){var e=function(e,t,r){this.mqttWSAddr=e,this.account=t,this.password=r};return e.prototype.connect=function(){var r=when.defer();try{var e=document.location.protocol;"httpsionic:"==e&&(e="https:"),"http:"!=e&&"https:"!=e&&"httpsionic:"!=e&&(e="http:"),avdEngineHandle&&avdEngineHandle.applyToElectron&&(e=avdEngineHandle.electronProtocol);var t="ws://";"https:"==e&&(t="wss://");var n=t+this.mqttWSAddr;log.debug("===mqtt webSocket URL:"+n);var o={clientId:this.account,username:this.account,password:this.password},i=mqtt.connect(n,o);console.log("===client:",i),i.on("connect",function(){console.log("mqtt connect success!"),r.resolve(i)}),i.on("error",function(e){console.log("mqtt connect error:",e);var t=new d(e.code,e.message);i.end(),r.reject(t)}),i.on("message",function(e,t){console.log([e,t]),(new s).OnWebSocketMessage(e,t)})}catch(e){log.info("MQTT  Operation  failed. with exception:"+e);var a=new d(ErrorConstant.websock_catch_exception);r.reject(a)}return r.promise},e}),ModuleBase.define("RtmMessageManager",["Error"],function(e){var t=function(){};return t.prototype.OnWebSocketMessage=function(e,t){log.info("===RtmMessageManager.OnWebSocketMessage(),topic:"+e);var r=arrayUtil.contains(signalClient.topicReservedWords,e);if(log.info("===RtmMessageManager.OnWebSocketMessage(),isExit:"+r),r){var n=signalClient.rtmServer.rtmProtobufCoded.decodePacket(t);console.log("===RtmMessageManager.OnWebSocketMessage(),signalHeader:",n);var o=n.group_type,i=n.cmd_type,a=n.content,s=n.from,d=n.to,l=signalClient.rtmServer.signalGroupTypeEnum,u=signalClient.rtmServer.signalCmdTypeEnum;switch(o){case l.SIGNALE_GROUP_TYPE_INVITE:switch(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_INVITE"),i){case u.SIGNALE_CMD_TYPE_INVITE:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE");var c=signalClient.rtmServer.rtmProtobufCoded.decodeInvite(a);console.log("===RtmMessageManager.OnWebSocketMessage(),invite:",c),signalClient.inviteManager.emitCallNotify(c.id,s,d,c.options);break;case u.SIGNALE_CMD_TYPE_INVITE_CANCEL:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_CANCEL");var p=signalClient.rtmServer.rtmProtobufCoded.decodeInviteCancel(a);console.log("===RtmMessageManager.OnWebSocketMessage(),decodeInviteCancel:",p),(c=signalClient.inviteManager.getInvite(p.id)).emitCallCancelNotify();break;case u.SIGNALE_CMD_TYPE_INVITE_RINGING:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_RINGING");var h=signalClient.rtmServer.rtmProtobufCoded.decodeInviteRinging(a);console.log("===RtmMessageManager.OnWebSocketMessage(),decodeInviteRinging:",h),(c=signalClient.inviteManager.getInvite(h.id)).emitCallRingingNotify();break;case u.SIGNALE_CMD_TYPE_INVITE_OK:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_OK");var f=signalClient.rtmServer.rtmProtobufCoded.decodeInviteOk(a);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteOk:",f),(c=signalClient.inviteManager.getInvite(f.id)).emitCallAcceptNotify(c.options);break;case u.SIGNALE_CMD_TYPE_INVITE_REJECT:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_REJECT");var m=signalClient.rtmServer.rtmProtobufCoded.decodeInviteReject(a);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteReject:",m),(c=signalClient.inviteManager.getInvite(m.id)).emitCallRejectNotify(m.reson);break;case u.SIGNALE_CMD_TYPE_INVITE_BYE:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_INVITE_BYE");var g=signalClient.rtmServer.rtmProtobufCoded.decodeInviteBye(a);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteBye:",g),(c=signalClient.inviteManager.getInvite(g.id)).emitCallCloseNotify(g.reson)}break;case l.SIGNALE_GROUP_TYPE_REMOTE_CONTROL:switch(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_REMOTE_CONTROL"),i){case u.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS");var v=signalClient.rtmServer.rtmProtobufCoded.decodeMouseEvents(a);console.log("===RtmMessageManager.OnWebSocketMessage(),mouseEvents:",v),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendMouseMessage(v.eventsType,v.video_x,v.video_y,v.video_w,v.video_h);break;case u.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS:log.debug("===acception cmdType = SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS");var y=signalClient.rtmServer.rtmProtobufCoded.decodeKeyBoardEvents(a);console.log("===RtmMessageManager.OnWebSocketMessage(),keyBoardEvents:",y),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendKeyboardMessage(y.eventsType,y.keyc,y.keyv)}break;case l.SIGNALE_GROUP_TYPE_MESSAGE:switch(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_MESSAGE"),i){case u.SIGNALE_CMD_TYPE_MESSAGE_DATA:if(s==signalClient.selfUser.userId)return;var _=signalClient.rtmServer.rtmProtobufCoded.decodeMsgData(a);console.log("===RtmMessageManager.OnWebSocketMessage(),msgData:",_),signalClient.chatManager.emitReceiveMessageNotify(s,_.msg_id,_.session_type,_.session_id,_.create_time,_.msg_type,_.msg_content.toArrayBuffer())}break;case l.SIGNALE_GROUP_TYPE_RPC:switch(log.debug("===acception  groupType = SIGNALE_GROUP_TYPE_RPC"),i){case u.SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE:var b=signalClient.rtmServer.rtmProtobufCoded.decodeRpcCallResponse(a);console.log("===RtmMessageManager.OnWebSocketMessage(),rpcCallResponse:",b),b&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+b.id,b.id,b.rpc_data);break;case u.SIGNALE_CMD_TYPE_RPC_NOTIFICATION:var S=signalClient.rtmServer.rtmProtobufCoded.decodeRpcNotification(a);console.log("===RtmMessageManager.OnWebSocketMessage(),rpcNotification:",S),S&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.RPC_NOTIFICATION,S.rpc_data)}}}else{log.info("===RtmMessageManager.OnWebSocketMessage(),Native payload");var w=new Uint8Array(t),E=typeConversionUtil.Uint8ArrayToString(w);signalClient.eventEmitter.emit(signalClient.ClientCallbackEnum.NATIVE_PAYLOAD_NOTIFY,e,E)}},t}),ModuleBase.define("RtmServer",["RtmProtobufCoded","Error"],function(t,c){var e=function(e){this.signalingChannel=e,this.rtmProtobufCoded=new t,this.signalGroupTypeEnum=this.rtmProtobufCoded.getSignalGroupTypeEnum(),this.signalCmdTypeEnum=this.rtmProtobufCoded.getSignalCmdTypeEnum(),this.mouseEventsTypeEnum=this.rtmProtobufCoded.getMouseEventsTypeEnum(),this.keyboardEventsTypeEnum=this.rtmProtobufCoded.getKeyboardEventsTypeEnum(),this.keyboardVKTypeEnum=this.rtmProtobufCoded.getKeyboardVKTypeEnum()};return e.prototype.publish=function(e,t){log.debug("===RtmServer.publish(),topic:"+e),this.signalingChannel&&this.signalingChannel.publish(e,t)},e.prototype.subscribe=function(e){log.info("===RtmServer.subscribe(),topic:"+e),this.signalingChannel&&this.signalingChannel.subscribe(e)},e.prototype.unsubscribe=function(e){log.info("===RtmServer.unsubscribe(),topic:"+e),this.signalingChannel&&this.signalingChannel.unsubscribe(e)},e.prototype.end=function(){log.debug("===RtmServer.end()"),this.signalingChannel&&this.signalingChannel.end()},e.prototype.sendInviteCall=function(e,t,r,n){log.debug("===RtmServer.sendInviteCall()");var o=when.defer();try{var i="/u/"+r,a="";n&&(a=JSON.stringify(n));var s=this.rtmProtobufCoded.newInvite(e,a),d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE,t,r,s);log.info("===RtmServer.sendInviteCall(),headerBuffer:"+d);var l=new Uint8Array(d);this.publish(i,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteCancel=function(e,t,r){log.debug("===RtmServer.sendInviteCancel()");var n=when.defer();try{var o="/u/"+r,i=this.rtmProtobufCoded.newInviteCancel(e),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_CANCEL,t,r,i);log.info("===RtmServer.sendInviteCancel(),headerBuffer:"+a);var s=new Uint8Array(a);this.publish(o,s),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteRinging=function(e,t,r){log.debug("===RtmServer.sendInviteRinging()");var n=when.defer();try{var o="/u/"+r,i=this.rtmProtobufCoded.newInviteRinging(e),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_RINGING,t,r,i);log.info("===rtmServer.sendInviteRinging(),headerBuffer:",a);var s=new Uint8Array(a);this.publish(o,s),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteAccept=function(e,t,r,n){log.debug("===RtmServer.sendInviteAccept()");var o=when.defer();try{var i="/u/"+r,a="";n&&(a=JSON.stringify(n));var s=this.rtmProtobufCoded.newInviteOk(e,a),d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_OK,t,r,s);log.info("===RtmServer.sendInviteAccept(),headerBuffer:"+d);var l=new Uint8Array(d);this.publish(i,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteReject=function(e,t,r,n){log.debug("===RtmServer.sendInviteReject()");var o=when.defer();try{var i="/u/"+r,a=this.rtmProtobufCoded.newInviteReject(e,n),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_REJECT,t,r,a);log.info("===RtmServer.sendInviteReject(),headerBuffer:"+s);var d=new Uint8Array(s);this.publish(i,d),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteClose=function(e,t,r,n){log.debug("===RtmServer.sendInviteClose()");var o=when.defer();try{var i="/u/"+r,a=this.rtmProtobufCoded.newInviteBye(e,n),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_BYE,t,r,a);log.info("===RtmServer.sendInviteClose(),headerBuffer:"+s);var d=new Uint8Array(s);this.publish(i,d),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendMouseMessage=function(e,t,r,n,o,i,a,s){log.debug("===RtmServer.sendMouseMessage()");var d=when.defer();try{var l="/u/"+r,u=this.rtmProtobufCoded.newMouseEvents(e,o,i,a,s,n);log.debug("===RtmServer.sendMouseMessage(),mouseEvents:"+u);var c=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS,t,r,u);log.debug("===RtmServer.sendMouseMessage(),headerBuffer:",c);var p=new Uint8Array(c);this.publish(l,p),d.resolve()}catch(e){d.reject(e)}return d.promise},e.prototype.sendKeyboardMessage=function(e,t,r,n,o,i){log.debug("===RtmServer.sendKeyboardMessage()");var a=when.defer();try{var s="/u/"+r,d=this.rtmProtobufCoded.newKeyBoardEvents(e,o,i,n);log.info("===RtmServer.sendKeyboardMessage(),keyBoardEvents:"+d);var l=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS,t,r,d);log.info("===RtmServer.sendKeyboardMessage(),headerBuffer:"+l);var u=new Uint8Array(l);this.publish(s,u),a.resolve()}catch(e){a.reject(e)}return a.promise},e.prototype.sendMsgData=function(e,t){log.debug("===RtmServer.sendMsgData()");var r=when.defer();try{var n=typeConversionUtil.stringToUint8Array(t.content),o=this.rtmProtobufCoded.newMsgData(t.messageId,t.sessionType,t.sessionId,t.createTime,t.messageType,n);log.info("===RtmServer.sendMsgData(),msgData:",o);var i=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_MESSAGE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_MESSAGE_DATA,t.sendUserId,t.sessionId,o);log.info("===RtmServer.sendMsgData(),headerBuffer:",i);var a=new Uint8Array(i);this.publish(e,a),r.resolve()}catch(e){r.reject(e)}return r.promise},e.prototype.sendRpcCall=function(e,t,r,n){log.debug("===RtmServer.sendRpcCall()");var o=when.defer(),i=++Task_Id,a=JSON.stringify(n),s=this.rtmProtobufCoded.newRpcCallRequest(i,a);log.info("===RtmServer.sendRpcCall(),rpcCallRequest:",s);var d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_CALL_REQUEST,e,t,s);log.info("===RtmServer.sendMsgData(),headerBuffer:",d);var l=new Uint8Array(d);this.publish(r,l);var u=setTimeout(function(){var e=new c(1e4,"sendRpcCall time out");o.reject(e)},5e3);return signalClient.rpcManager.addCallback(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i,function(e,t){log.info("===RtmServer.sendRpcCall().addCallback(),id:",e,"parameters:",t),e==i&&(signalClient.rpcManager.offCallback([signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i]),o.resolve(t),clearTimeout(u))}),o.promise},e.prototype.sendRpcNotification=function(e,t,r,n){log.debug("===RtmServer.sendRpcNotification()");var o=when.defer();try{var i=++Task_Id,a=JSON.stringify(n),s=this.rtmProtobufCoded.newRpcNotification(i,a);log.info("====RtmServer.sendRpcNotification(),rpcNotification:",s);var d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_NOTIFICATION,e,t,s);log.info("===RtmServer.sendRpcNotification(),headerBuffer:",d);var l=new Uint8Array(d);this.publish(r,l),o.resolve()}catch(e){o.reject(e)}return o.promise},e}),ModuleBase.define("RtmProtobufCoded",[],function(){var s,e=function(){s=rtmBuilder.signal_pdu};return e.prototype.getSignalGroupTypeEnum=function(){return s.signal_group_type},e.prototype.getSignalCmdTypeEnum=function(){return s.signal_cmd_type},e.prototype.getMouseEventsTypeEnum=function(){return s.mouse_events_type},e.prototype.getKeyboardEventsTypeEnum=function(){return s.keyboard_events_type},e.prototype.getKeyboardVKTypeEnum=function(){return s.keybaord_vk_type},e.prototype.getSessionTypeEnum=function(){return s.SessionType},e.prototype.getMsgTypeEnum=function(){return s.MsgType},e.prototype.getMsgStatusEnum=function(){return s.MsgStatus},e.prototype.encodedHeader=function(e,t,r,n,o){var i=null;null!=o&&(i=o.toArrayBuffer());var a=Math.round((new Date).getTime()/1e3),s=this.newSignalHeader("1.0",e,t,a,r,n,i);return console.log("===encodedHeader(),signalHeader:",s),s.toArrayBuffer()},e.prototype.newSignalHeader=function(e,t,r,n,o,i,a){return new s.signal_header(e,t,r,n,o,i,a)},e.prototype.newInvite=function(e,t){return new s.Invite(e,t)},e.prototype.newInviteCancel=function(e){return new s.InviteCancel(e)},e.prototype.newInviteRinging=function(e){return new s.InviteRinging(e)},e.prototype.newInviteOk=function(e,t){return new s.InviteOk(e,t)},e.prototype.newInviteReject=function(e,t){return new s.InviteReject(e,t)},e.prototype.newInviteBye=function(e,t){return new s.InviteBye(e,t)},e.prototype.newMouseEvents=function(e,t,r,n,o,i){return new s.MouseEvents(e,t,r,n,o,i)},e.prototype.newKeyBoardEvents=function(e,t,r,n){return new s.KeyBoardEvents(e,t,r,n)},e.prototype.newMsgData=function(e,t,r,n,o,i){return new s.MsgData(e,t,r,n,o,i)},e.prototype.newMsgDataDelivered=function(e,t,r){return new s.MsgDataDelivered(e,t,r)},e.prototype.newMsgDataRead=function(e,t,r){return new s.MsgDataRead(e,t,r)},e.prototype.newMsgDataRecalled=function(e,t,r){return new s.MsgDataRecalled(e,t,r)},e.prototype.newRpcCallRequest=function(e,t){return new s.RpcCallRequest(e,t)},e.prototype.newRpcNotification=function(e,t){return new s.RpcNotification(e,t)},e.prototype.decodePacket=function(e){return s.signal_header.decode(e)},e.prototype.decodeInvite=function(e){return s.Invite.decode(e)},e.prototype.decodeInviteCancel=function(e){return s.InviteCancel.decode(e)},e.prototype.decodeInviteRinging=function(e){return s.InviteRinging.decode(e)},e.prototype.decodeInviteOk=function(e){return s.InviteOk.decode(e)},e.prototype.decodeInviteReject=function(e){return s.InviteReject.decode(e)},e.prototype.decodeInviteBye=function(e){return s.InviteBye.decode(e)},e.prototype.decodeMouseEvents=function(e){return s.MouseEvents.decode(e)},e.prototype.decodeKeyBoardEvents=function(e){return s.KeyBoardEvents.decode(e)},e.prototype.decodeMsgData=function(e){return s.MsgData.decode(e)},e.prototype.decodeRpcCallResponse=function(e){return s.RpcCallResponse.decode(e)},e.prototype.decodeRpcNotification=function(e){return s.RpcNotification.decode(e)},e}),ModuleBase.define("ClientUser",["Error"],function(e){return function(e,t){this.userId=e,this.account=e,this.password=t,this.userName}}),ModuleBase.define("InviteManager",["Invite","Error"],function(a,e){var t=function(){this.InviteManagerCallbackEnum={CALL_NOTIFY:"call.notify"},this.invites={},this.eventEmitter=new EventEmitter};return t.prototype.createInvite=function(e,t,r){var n=new a(e,t,r);return this.invites[n.inviteId]=n},t.prototype.getInvite=function(e){return this.invites[e]},t.prototype.call=function(e){var t=when.defer();return e.callInner().then(function(){log.debug("===InviteManager.call(),success"),t.resolve()}).otherwise(function(e){log.debug("===InviteManager.call(),error:",e),t.reject(e)}),t.promise},t.prototype.emitCallNotify=function(e,t,r,n){var o=null;n&&(o=JSON.parse(n));var i=new a(r,t,o);i.inviteId=e,(this.invites[i.inviteId]=i).onCallTimeOutInner(),this.eventEmitter.emit(this.InviteManagerCallbackEnum.CALL_NOTIFY,i)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("Invite",["Error"],function(e){var t=function(e,t,r){this.InviteCallbackEnum={CALL_ACCEPT_NOTIFY:"call.accept.notify",CALL_REJECT_NOTIFY:"call.reject.notify",CALL_TIMEOUT_NOTIFY:"call.timeout.notify",CALL_RINGING_NOTIFY:"call.ringing.notify",CALL_CANCEL_NOTIFY:"call.cancel.notify",RESPONSE_CALL_TIMEOUT_NOTIFY:"response.call.timeout.notify",CALL_CLOSE_NOTIFY:"call.close.notify"},this.eventEmitter=new EventEmitter,this.inviteId=++Task_Id,this.fromUserId=e,this.toUserId=t,this.options=r,this.callTimeout=6e4,this.callBaseTime=null,this.callTimeoutIntervalId=null,this.onCallTimeout=55e3,this.onCallBaseTime=null,this.onCallTimeoutIntervalId=null};return t.prototype.callInner=function(){console.debug("===invite.callInner()");var e=this;null==e.callBaseTime&&(e.callBaseTime=new Date),e.callTimeoutIntervalId=setInterval(function(){new Date-e.callBaseTime>=e.callTimeout&&(e.clearanceInner(),e.eventEmitter.emit(e.InviteCallbackEnum.CALL_TIMEOUT_NOTIFY,e.toUserId))},500);var t=when.defer();return signalClient.rtmServer.sendInviteCall(e.inviteId,e.fromUserId,e.toUserId,e.options).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.onCallTimeOutInner=function(){console.debug("===invite.onCallTimeOutInner()");var e=this;null==e.onCallBaseTime&&(e.onCallBaseTime=new Date),e.onCallTimeoutIntervalId=setInterval(function(){new Date-e.onCallBaseTime>=e.onCallTimeout&&(e.clearanceInnerOnCall(),e.eventEmitter.emit(e.InviteCallbackEnum.RESPONSE_CALL_TIMEOUT_NOTIFY,e.fromUserId))},500)},t.prototype.clearanceInner=function(){clearInterval(this.callTimeoutIntervalId),this.callTimeoutIntervalId=null,this.callBaseTime=null},t.prototype.clearanceInnerOnCall=function(){clearInterval(this.onCallTimeoutIntervalId),this.onCallTimeoutIntervalId=null,this.onCallBaseTime=null},t.prototype.cancel=function(){var t=when.defer(),e=this;return signalClient.rtmServer.sendInviteCancel(e.inviteId,e.fromUserId,e.toUserId).then(function(){e.clearanceInner(),t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.ringing=function(){var t=when.defer();return signalClient.rtmServer.sendInviteRinging(this.inviteId,this.fromUserId,this.toUserId).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.accept=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteAccept(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.reject=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteReject(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.close=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteClose(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInner(),t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.emitCallCancelNotify=function(){this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CANCEL_NOTIFY,this.toUserId)},t.prototype.emitCallRingingNotify=function(){this.callBaseTime=new Date,this.eventEmitter.emit(this.InviteCallbackEnum.CALL_RINGING_NOTIFY,this.toUserId)},t.prototype.emitCallAcceptNotify=function(e){console.log("options: ",e),this.clearanceInner();var t=null;e&&(t=JSON.parse(JSON.stringify(e))),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_ACCEPT_NOTIFY,this.toUserId,t)},t.prototype.emitCallRejectNotify=function(e){this.clearanceInner(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_REJECT_NOTIFY,this.toUserId,e)},t.prototype.emitCallCloseNotify=function(e){this.clearanceInner(),this.clearanceInnerOnCall(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CLOSE_NOTIFY,this.toUserId,e)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("RemoteControlManager",["Error"],function(e){var t=function(){this.MouseEventsTypeEnum={WM_MOUSEMOVE:512,WM_LBUTTONDOWN:513,WM_LBUTTONUP:514,WM_LBUTTONDBLCLK:515,WM_RBUTTONDOWN:516,WM_RBUTTONUP:517,WM_RBUTTONDBLCLK:518,WM_MBUTTONDOWN:519,WM_MBUTTONUP:520,WM_MBUTTONDBLCLK:521,WM_MOUSEWHEEL:522},this.KeyboardEventsTypeEnum={WM_KEYDOWN:256,WM_KEYUP:257,WM_CHAR:258},this.KeyboardVKTypeEnum={VK_BACK:8,VK_TAB:9,VK_SHIFT:16,VK_CONTROL:17,VK_MENU:18,VK_PAUSE:19,VK_CAPITAL:20,VK_KANA:21,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_ESCAPE:27,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SPACE:32,VK_PRIOR:33,VK_NEXT:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SNAPSHOT:44,VK_INSERT:45,VK_DELETE:46,VK_HELP:47},this.RemoteControlManagerCallbackEnum={MOUSE_EVENTS_NOTIFY:"mouse.events.notify",KEYBOARD_EVENTS_NOTIFY:"KeyBoard.events.notify"},this.fromUserId="",this.toUserId="",this.baseRemotectrl=null,this.sendMouseMoveMessageInterval=200,this.sendMouseMoveMessageLastTime=null};return t.prototype.setSendMouseMoveMessageInterval=function(e){console.log("===RemoteControlManager.setSendMouseMoveMessageInterval(),sendMouseMoveMessageInterval:"+e),this.sendMouseMoveMessageInterval=e},t.prototype.setBaseRemotectrl=function(e){this.baseRemotectrl=e},t.prototype.setFromUserAndToUser=function(e,t){this.fromUserId=e,this.toUserId=t},t.prototype.sendMouseMessage=function(e,t,r,n,o){var i=this,a=when.defer(),s=++Task_Id;if(e==i.MouseEventsTypeEnum.WM_MOUSEMOVE&&i.sendMouseMoveMessageLastTime&&(new Date).getTime()-i.sendMouseMoveMessageLastTime<i.sendMouseMoveMessageInterval)return;return signalClient.rtmServer.sendMouseMessage(s,i.fromUserId,i.toUserId,e,t,r,n,o).then(function(){e==i.MouseEventsTypeEnum.WM_MOUSEMOVE&&(i.sendMouseMessageLastTime=(new Date).getTime()),a.resolve()}).otherwise(function(e){a.reject(e)}),a.promise},t.prototype.sendKeyboardMessage=function(e,t,r){var n=++Task_Id,o=when.defer();return signalClient.rtmServer.sendKeyboardMessage(n,this.fromUserId,this.toUserId,e,t,r).then(function(){o.resolve()}).otherwise(function(e){o.reject(e)}),o.promise},t}),ModuleBase.define("ChatManager",["Message","Error"],function(l,e){var t=function(){this.ChatManagerCallbackEnum={RECEIVE_MESSAGE_NOTIFY:"receive.message.notify",MESSAGE_STATUS_CHANGED_NOTIFY:"message.status.changed.notify"},this.SessionTypeEnum={peers:1,group:2,chatroom:3},this.MessageTypeEnum={text:1,image:2,file:3,audio:4,video:5,location:6},this.MessageStatussEnum={delivering:1,delivered:2,read:3,failed:4,recalled:5},this.eventEmitter=new EventEmitter};return t.prototype.registerGroups=function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t];signalClient.rtmServer.subscribe("/g/"+r)}},t.prototype.unregisterGroup=function(e){e&&signalClient.rtmServer.unsubscribe("/g/"+e)},t.prototype.newTextMessage=function(e,t,r){var n=Math.uuid(),o=new l(n,e,t);return o.sendUserId=signalClient.selfUser.userId,o.messageType=this.MessageTypeEnum.text,o.content=r,o.createTime=signalClient.getServeTime(),o.status=this.MessageStatussEnum.delivering,o},t.prototype.sendMessage=function(e){var t=when.defer(),r="/u/"+e.sessionId;return e.sessionType!=this.SessionTypeEnum.peers&&(r="/g/"+e.sessionId),signalClient.rtmServer.sendMsgData(r,e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.emitReceiveMessageNotify=function(e,t,r,n,o,i,a){var s=new l(t,r,n);s.sendUserId=e,s.messageType=i;var d=new Uint8Array(a);s.content=typeConversionUtil.Uint8ArrayToString(d),s.createTime=o,s.status=this.MessageStatussEnum.delivered,this.eventEmitter.emit(this.ChatManagerCallbackEnum.RECEIVE_MESSAGE_NOTIFY,s)},t.prototype.sendImageMessage=function(e,t,r,n){},t.prototype.sendFileMessage=function(e,t,r,n){},t.prototype.sendAudioMessage=function(e,t,r,n){},t.prototype.readMessage=function(e){},t.prototype.recallMessage=function(e){},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.off(r)}},t}),ModuleBase.define("Message",["Error"],function(e){return function(e,t,r){this.messageId=e,this.sessionType=t,this.sessionId=r,this.sendUserId=null,this.messageType=null,this.content=null,this.createTime=null,this.status=null}}),ModuleBase.define("RpcManager",["Error"],function(o){var e=function(){this.RpcManagerCallbackEnum={CALL_RESPONSE_SUCCESS:"call.response.success",CALL_RESPONSE_ERROR:"call.response.error",RPC_NOTIFICATION:"rpc.notification"},this.eventEmitter=new EventEmitter};return e.prototype.call=function(e){var n=when.defer(),t=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcCall(t,"root","/s",e).then(function(e){console.log("===RpcManager.call(),result rpcData:",e);var t=JSON.parse(e);if(console.log("===RpcManager.call(),result Json:",t),t.error){var r=new o(t.error.code,t.error.message);n.reject(r)}else n.resolve(t.result)}).otherwise(function(e){n.reject(e)}),n.promise},e.prototype.notification=function(e){var t=when.defer(),r=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcNotification(r,"root","/s",e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},e.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.removeAllListeners(r)}},e}),!log)var log=log4javascript.getLogger();if(!bugout)var bugout=null;var signalClient=null,Task_Id=0,rtmVersion="1.0.0.0";ModuleBase.define("Client",["RestServer","RtmManager","RtmServer","ClientUser","InviteManager","RemoteControlManager","ChatManager","RpcManager","Error"],function(r,t,a,s,e,n,o,i,d){var l=function(e,t){this.ClientCallbackEnum={NATIVE_PAYLOAD_NOTIFY:"native.payload"},this.serverURI=e,this.accessToken=t,this.mqttWSAddr=null,this.restServer=new r,this.rtmManager=null,this.rtmServer=null,this.inviteManager=null,this.remoteControlManager=null,this.chatManager=null,this.rpcManager=null,this.selfUser=null,this.eventEmitter=new EventEmitter,this.topicReservedWords=["/u/","/g/","/s"],signalClient=this};return l.prototype.getVersion=function(){return"rtm-"+rtmVersion},l.prototype.setLog=function(e,t){var r,n,o;e==Appender.alert?r=new log4javascript.AlertAppender:e==Appender.inpage?r=new log4javascript.InPageAppender:e==Appender.popup?r=new log4javascript.PopUpAppender:e==Appender.browserConsole&&(r=new log4javascript.BrowserConsoleAppender),t==LogLevel.all?r.setThreshold(log4javascript.Level.ALL):t==LogLevel.trace?r.setThreshold(log4javascript.Level.TRACE):t==LogLevel.debug?r.setThreshold(log4javascript.Level.DEBUG):t==LogLevel.info?r.setThreshold(log4javascript.Level.INFO):t==LogLevel.warn?r.setThreshold(log4javascript.Level.WARN):t==LogLevel.error?r.setThreshold(log4javascript.Level.ERROR):t==LogLevel.fatal?r.setThreshold(log4javascript.Level.FATAL):t==LogLevel.off&&r.setThreshold(log4javascript.Level.OFF),n=r,o=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n"),n.setLayout(o),log.addAppender(n)},l.prototype.login=function(r,n){var o=when.defer(),i=this;return i.restServer.getMqttWSAddr(i.serverURI,i.accessToken).then(function(e){log.info("===client.login(),restServer.getMqttWSAddr(), mqttWSAddr:",e),i.mqttWSAddr=e,i.rtmManager=new t(i.mqttWSAddr,r,n),i.rtmManager.connect().then(function(e){signalClient.rtmServer=new a(e),signalClient.rtmServer.subscribe("/u/"+r);var t=new s(r,n);i.selfUser=t,o.resolve()}).otherwise(function(e){o.reject(e)})}).otherwise(function(e){log.error("===client.login(),error:",e),o.reject(e)}),o.promise},l.prototype.logout=function(e){var t=when.defer();try{this.rtmServer.end(),signalClient=null,this.selfUser=null,t.resolve()}catch(e){t.reject(e)}return t.promise},l.prototype.getInviteManager=function(){return this.inviteManager||(this.inviteManager=new e),this.inviteManager},l.prototype.getRemoteControlManager=function(){return this.remoteControlManager||(this.remoteControlManager=new n),this.remoteControlManager},l.prototype.getChatManager=function(){return this.chatManager||(this.chatManager=new o),this.chatManager},l.prototype.getRpcManager=function(){return this.rpcManager||(this.rpcManager=new i),this.rpcManager},l.prototype.getServeTime=function(){var e=new Date;e.setMinutes(e.getMinutes()+e.getTimezoneOffset());var t=e.getTime();return t=Math.round(t/1e3)},l.prototype.nativePublish=function(e,t){var r=when.defer();if(arrayUtil.contains(this.topicReservedWords,e)){var n=new d(ErrorConstant.mqtt_topic_reservedword_error);r.reject(n)}else this.rtmServer.publish(e,t),r.resolve();return r.promise},l.prototype.nativeSubscribe=function(e){var t=when.defer();if(arrayUtil.contains(this.topicReservedWords,e)){var r=new d(ErrorConstant.mqtt_topic_reservedword_error);t.reject(r)}else this.rtmServer.subscribe(e),t.resolve();return t.promise},l.prototype.getTopicReservedWords=function(){return this.topicReservedWords},l.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},l.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.off(r)}},l}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.axios=t():e.axios=t()}(this,function(){return function(r){function n(e){if(o[e])return o[e].exports;var t=o[e]={exports:{},id:e,loaded:!1};return r[e].call(t.exports,t,t.exports,n),t.loaded=!0,t.exports}var o={};return n.m=r,n.c=o,n.p="",n(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function n(e){var t=new a(e),r=i(a.prototype.request,t);return o.extend(r,a.prototype,t),o.extend(r,t),r}var o=r(2),i=r(3),a=r(4),s=r(5),d=n(s);d.Axios=a,d.create=function(e){return n(o.merge(s,e))},d.Cancel=r(22),d.CancelToken=r(23),d.isCancel=r(19),d.all=function(e){return Promise.all(e)},d.spread=r(24),e.exports=d,e.exports.default=d},function(e,t,r){"use strict";function i(e){return"[object Array]"===d.call(e)}function n(e){return null!==e&&"object"==typeof e}function o(e){return"[object Function]"===d.call(e)}function a(e,t){if(null!=e)if("object"==typeof e||i(e)||(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var s=r(3),d=Object.prototype.toString;e.exports={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===d.call(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:n,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===d.call(e)},isFile:function(e){return"[object File]"===d.call(e)},isBlob:function(e){return"[object Blob]"===d.call(e)},isFunction:o,isStream:function(e){return n(e)&&o(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement},forEach:a,merge:function r(){function e(e,t){"object"==typeof n[t]&&"object"==typeof e?n[t]=r(n[t],e):n[t]=e}for(var n={},t=0,o=arguments.length;t<o;t++)a(arguments[t],e);return n},extend:function(r,e,n){return a(e,function(e,t){r[t]=n&&"function"==typeof e?s(e,n):e}),r},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){"use strict";e.exports=function(r,n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(n,e)}}},function(e,t,r){"use strict";function o(e){this.defaults=e,this.interceptors={request:new a,response:new a}}var n=r(5),i=r(2),a=r(16),s=r(17),d=r(20),l=r(21);o.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(n,this.defaults,{method:"get"},e)).baseURL&&!d(e.url)&&(e.url=l(e.baseURL,e.url));var t=[s,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head"],function(r){o.prototype[r]=function(e,t){return this.request(i.merge(t||{},{method:r,url:e}))}}),i.forEach(["post","put","patch"],function(n){o.prototype[n]=function(e,t,r){return this.request(i.merge(r||{},{method:n,url:e,data:t}))}}),e.exports=o},function(e,t,r){"use strict";function n(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var o,i=r(2),a=r(6),s=/^\)\]\}',?\n/,d={"Content-Type":"application/x-www-form-urlencoded"},l={adapter:("undefined"!=typeof XMLHttpRequest?o=r(7):"undefined"!=typeof process&&(o=r(7)),o),transformRequest:[function(e,t){return a(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(n(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(n(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e){e=e.replace(s,"");try{e=JSON.parse(e)}catch(e){}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},i.forEach(["delete","get","head"],function(e){l.headers[e]={}}),i.forEach(["post","put","patch"],function(e){l.headers[e]=i.merge(d)}),e.exports=l},function(e,t,r){"use strict";var o=r(2);e.exports=function(r,n){o.forEach(r,function(e,t){t!==n&&t.toUpperCase()===n.toUpperCase()&&(r[n]=e,delete r[t])})}},function(e,t,p){"use strict";var h=p(2),f=p(8),m=p(11),g=p(12),v=p(13),y=p(9),_="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||p(14);e.exports=function(c){return new Promise(function(r,n){var o=c.data,i=c.headers;h.isFormData(o)&&delete i["Content-Type"];var a=new XMLHttpRequest,e="onreadystatechange",s=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in a||v(c.url)||(a=new window.XDomainRequest,e="onload",s=!0,a.onprogress=function(){},a.ontimeout=function(){}),c.auth){var t=c.auth.username||"",d=c.auth.password||"";i.Authorization="Basic "+_(t+":"+d)}if(a.open(c.method.toUpperCase(),m(c.url,c.params,c.paramsSerializer),!0),a.timeout=c.timeout,a[e]=function(){if(a&&(4===a.readyState||s)&&(0!==a.status||a.responseURL&&0===a.responseURL.indexOf("file:"))){var e="getAllResponseHeaders"in a?g(a.getAllResponseHeaders()):null,t={data:c.responseType&&"text"!==c.responseType?a.response:a.responseText,status:1223===a.status?204:a.status,statusText:1223===a.status?"No Content":a.statusText,headers:e,config:c,request:a};f(r,n,t),a=null}},a.onerror=function(){n(y("Network Error",c)),a=null},a.ontimeout=function(){n(y("timeout of "+c.timeout+"ms exceeded",c,"ECONNABORTED")),a=null},h.isStandardBrowserEnv()){var l=p(15),u=(c.withCredentials||v(c.url))&&c.xsrfCookieName?l.read(c.xsrfCookieName):void 0;u&&(i[c.xsrfHeaderName]=u)}if("setRequestHeader"in a&&h.forEach(i,function(e,t){void 0===o&&"content-type"===t.toLowerCase()?delete i[t]:a.setRequestHeader(t,e)}),c.withCredentials&&(a.withCredentials=!0),c.responseType)try{a.responseType=c.responseType}catch(e){if("json"!==a.responseType)throw e}"function"==typeof c.onDownloadProgress&&a.addEventListener("progress",c.onDownloadProgress),"function"==typeof c.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",c.onUploadProgress),c.cancelToken&&c.cancelToken.promise.then(function(e){a&&(a.abort(),n(e),a=null)}),void 0===o&&(o=null),a.send(o)})}},function(e,t,r){"use strict";var o=r(9);e.exports=function(e,t,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(o("Request failed with status code "+r.status,r.config,null,r)):e(r)}},function(e,t,r){"use strict";var i=r(10);e.exports=function(e,t,r,n){var o=new Error(e);return i(o,t,r,n)}},function(e,t){"use strict";e.exports=function(e,t,r,n){return e.config=t,r&&(e.code=r),e.response=n,e}},function(e,t,r){"use strict";function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var a=r(2);e.exports=function(e,t,r){if(!t)return e;var n;if(r)n=r(t);else if(a.isURLSearchParams(t))n=t.toString();else{var o=[];a.forEach(t,function(e,t){null!=e&&(a.isArray(e)&&(t+="[]"),a.isArray(e)||(e=[e]),a.forEach(e,function(e){a.isDate(e)?e=e.toISOString():a.isObject(e)&&(e=JSON.stringify(e)),o.push(i(t)+"="+i(e))}))}),n=o.join("&")}return n&&(e+=(-1===e.indexOf("?")?"?":"&")+n),e}},function(e,t,r){"use strict";var i=r(2);e.exports=function(e){var t,r,n,o={};return e&&i.forEach(e.split("\n"),function(e){n=e.indexOf(":"),t=i.trim(e.substr(0,n)).toLowerCase(),r=i.trim(e.substr(n+1)),t&&(o[t]=o[t]?o[t]+", "+r:r)}),o}},function(e,t,r){"use strict";var a=r(2);e.exports=a.isStandardBrowserEnv()?function(){function r(e){var t=e;return o&&(i.setAttribute("href",t),t=i.href),i.setAttribute("href",t),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}var n,o=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");return n=r(window.location.href),function(e){var t=a.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0}},function(e,t){"use strict";function s(){this.message="String contains an invalid character"}(s.prototype=new Error).code=5,s.prototype.name="InvalidCharacterError",e.exports=function(e){for(var t,r,n=String(e),o="",i=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|i)||(a="=",i%1);o+=a.charAt(63&t>>8-i%1*8)){if(255<(r=n.charCodeAt(i+=.75)))throw new s;t=t<<8|r}return o}},function(e,t,r){"use strict";var s=r(2);e.exports=s.isStandardBrowserEnv()?{write:function(e,t,r,n,o,i){var a=[];a.push(e+"="+encodeURIComponent(t)),s.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),s.isString(n)&&a.push("path="+n),s.isString(o)&&a.push("domain="+o),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";function n(){this.handlers=[]}var o=r(2);n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(t){o.forEach(this.handlers,function(e){null!==e&&t(e)})},e.exports=n},function(e,t,r){"use strict";function n(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var o=r(2),i=r(18),a=r(19),s=r(5);e.exports=function(t){return n(t),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=o.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),o.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||s.adapter)(t).then(function(e){return n(t),e.data=i(e.data,e.headers,t.transformResponse),e},function(e){return a(e)||(n(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(e,t,r){"use strict";var n=r(2);e.exports=function(t,r,e){return n.forEach(e,function(e){t=e(t,r)}),t}},function(e,t){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){"use strict";e.exports=function(e,t){return e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}},function(e,t){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t,r){"use strict";function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new o(e),t(r.reason))})}var o=r(22);n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var t;return{token:new n(function(e){t=e}),cancel:t}},e.exports=n},function(e,t){"use strict";e.exports=function(t){return function(e){return t.apply(null,e)}}}])});